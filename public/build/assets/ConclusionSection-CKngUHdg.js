import{x as $e,d as C,m as he,z as W,e as r,o as n,a as t,f as k,b as ae,p as ne,v as me,u as Q,F as G,h as X,t as R,g as te,w as ce,l as z,n as ee,C as Ie,D as ue,k as Ve,E as fe,G as Se,c as K,r as we,T as Ce,H as ge,W as _e}from"./app-DDbkdHwV.js";import{l as be}from"./lodash-nYPKdAxv.js";import{_ as Me}from"./PrimaryButton-DVC9FkFX.js";import{_ as Ue}from"./ActionMessage-CWKXTutn.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ne}from"./InputNumber-BraCoIwT.js";const qe={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Re={key:0,class:"p-4 space-y-4"},je={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},Be={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},Fe={class:"relative"},Pe={key:0,class:"absolute right-3 top-3"},Te={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},De={key:0},Le=["onMousedown"],Ae={class:"font-medium text-gray-900"},He={class:"text-sm text-gray-500"},Ee={key:1,class:"p-4 text-sm text-gray-500 text-center"},ze={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Oe={key:0,class:"mb-4"},We={class:"text-gray-600 text-sm"},Ke={key:1},Ge={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},Xe=["src","alt"],Ze={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Je={class:"text-white text-xs text-center"},Ye={key:2,class:"text-center py-4 text-gray-500 text-sm"},Qe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},et={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(e,{emit:j}){var N,F,q,b;const a=e,w=j,i=$e({plate_number:((N=a.inspection)==null?void 0:N.plate_number)||"",car_id:((F=a.inspection)==null?void 0:F.car_id)||null,car_name:((b=(q=a.inspection)==null?void 0:q.car)==null?void 0:b.name)||""}),c=C(i.car_name),v=C(!1),g=C(!1),d=C([]),f=C(null),I=C([]);he(()=>{var h,u,_,H;if((h=a.inspection)!=null&&h.car_id&&((u=a.CarDetail)==null?void 0:u.length)>0){const O=a.CarDetail.find(A=>A.id===a.inspection.car_id);O&&S(O)}else!((_=a.inspection)!=null&&_.car_id)&&((H=a.inspection)!=null&&H.car_name)&&(c.value=a.inspection.car_name)}),W(c,h=>{i.car_id&&s(f.value)!==h&&(i.car_id=null,f.value=null,I.value=[]),i.car_name=h});const s=h=>{var _,H,O;if(!h)return"";const u=[];return(_=h.brand)!=null&&_.name&&u.push(h.brand.name),(H=h.model)!=null&&H.name&&u.push(h.model.name),(O=h.type)!=null&&O.name&&u.push(h.type.name),h.cc&&u.push(`${h.cc}cc`),h.transmission&&u.push(h.transmission),h.fuel_type&&u.push(h.fuel_type),h.year&&u.push(h.year.toString()),h.production_period&&u.push(`(${h.production_period})`),u.join(" ")},y=be.debounce(()=>{if(!c.value.trim()){d.value=[],v.value=!1;return}g.value=!0;try{const h=c.value.toLowerCase().trim();d.value=a.CarDetail.filter(u=>s(u).toLowerCase().includes(h)),v.value=!0}finally{g.value=!1}},300),p=()=>{setTimeout(()=>{v.value=!1},200)},S=async h=>{f.value=h,c.value=s(h),i.car_id=h.id,i.car_name=s(h),v.value=!1,await $(h.id),B()},$=async h=>{try{const u=await fetch(`/api/cars/${h}/images`);u.ok?I.value=await u.json():I.value=[]}catch{I.value=[]}},B=()=>{const h={plate_number:i.plate_number,car_id:i.car_id,car_name:i.car_name};w("update-vehicle",h)},T=()=>{a.inspection&&i.post(route("inspections.updateVehicleDetails",{inspection:a.inspection.id}),{preserveScroll:!0})};return W(()=>a.inspection,h=>{var u;if(h)if(i.plate_number=h.plate_number||"",i.car_id=h.car_id||null,h.car_id&&((u=a.CarDetail)==null?void 0:u.length)>0){const _=a.CarDetail.find(H=>H.id===h.car_id);_&&S(_)}else h.car_name&&(c.value=h.car_name,i.car_name=h.car_name)},{deep:!0}),(h,u)=>(n(),r("div",qe,[u[13]||(u[13]=t("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[t("h2",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),e.inspection?(n(),r("div",Re,[t("div",je,[u[5]||(u[5]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nomor Plat Kendaraan ",-1)),ne(t("input",{"onUpdate:modelValue":u[0]||(u[0]=_=>Q(i).plate_number=_),type:"text",placeholder:"Contoh: B 1234 ABC",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:B},null,544),[[me,Q(i).plate_number]])]),t("div",Be,[u[8]||(u[8]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",Fe,[ne(t("input",{"onUpdate:modelValue":u[1]||(u[1]=_=>c.value=_),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:u[2]||(u[2]=(..._)=>Q(y)&&Q(y)(..._)),onFocus:u[3]||(u[3]=_=>v.value=!0),onBlur:p},null,544),[[me,c.value]]),g.value?(n(),r("div",Pe,u[6]||(u[6]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):k("",!0),v.value?(n(),r("div",Te,[d.value.length>0?(n(),r("div",De,[(n(!0),r(G,null,X(d.value,_=>(n(),r("div",{key:_.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:H=>S(_)},[t("div",Ae,R(s(_)),1),t("div",He,R(_.year)+" • "+R(_.cc)+"cc • "+R(_.transmission)+" • "+R(_.fuel_type),1)],40,Le))),128))])):(n(),r("div",Ee,u[7]||(u[7]=[te(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),te(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):k("",!0)]),ne(t("input",{type:"hidden","onUpdate:modelValue":u[4]||(u[4]=_=>Q(i).car_id=_)},null,512),[[me,Q(i).car_id]])]),Q(i).car_id&&f.value?(n(),r("div",ze,[f.value.description?(n(),r("div",Oe,[u[9]||(u[9]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("p",We,R(f.value.description),1)])):k("",!0),I.value.length>0?(n(),r("div",Ke,[u[10]||(u[10]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",Ge,[(n(!0),r(G,null,X(I.value,_=>(n(),r("div",{key:_.id,class:"relative group"},[t("img",{src:_.file_path,alt:_.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200"},null,8,Xe),_.note?(n(),r("div",Ze,[t("p",Je,R(_.note),1)])):k("",!0)]))),128))])])):(n(),r("div",Ye," Tidak ada gambar tersedia untuk mobil ini "))])):k("",!0),ae(Me,{type:"button",onClick:T,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},{default:ce(()=>[Q(i).processing?(n(),r("svg",Qe,u[11]||(u[11]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):k("",!0),t("span",null,R(Q(i).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),ae(Ue,{on:Q(i).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:ce(()=>u[12]||(u[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),te(" Tersimpan. ")])),_:1,__:[12]},8,["on"])]),_:1})])):k("",!0)]))}},Ea=ie(et,[["__scopeId","data-v-7573ffe7"]]),tt={class:"mt-1"},st=["value","required","minlength","maxlength","pattern","placeholder"],at={key:0,class:"mt-2 text-sm text-red-600"},ot={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:j}){const a=e,w=j,i=c=>{w("update:modelValue",c.target.value),w("save",a.pointId)};return(c,v)=>(n(),r("div",tt,[t("input",{value:e.modelValue,onInput:i,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,pattern:e.pattern,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,st),e.error?(n(),r("p",at,R(e.error),1)):k("",!0)]))}},nt={class:"mt-1"},it=["value","required","min","max"],lt={key:0,class:"mt-2 text-sm text-red-600"},rt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:j}){const a=e,w=j,i=c=>{w("update:modelValue",c.target.value),w("save",a.pointId)};return(c,v)=>(n(),r("div",nt,[t("input",{value:e.modelValue,onChange:i,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,it),e.error?(n(),r("p",lt,R(e.error),1)):k("",!0)]))}},dt={class:"mt-1"},ut=["value","required","placeholder"],ct={key:0,class:"mt-2 text-sm text-red-600"},mt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:j}){const a=e,w=j,i=C(""),c=C(!1),v=z(()=>{var p,S,$,B;return{currency_symbol:((p=a.settings)==null?void 0:p.currency_symbol)||"Rp",thousands_separator:((S=a.settings)==null?void 0:S.thousands_separator)||",",min_value:(($=a.settings)==null?void 0:$.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((B=a.settings)==null?void 0:B.max_value)!==void 0?Number(a.settings.max_value):1e9}}),g=p=>{if(p==null||p==="")return"";const S=Number(p);if(isNaN(S))return"";let $=S.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return v.value.thousands_separator!==","&&($=$.replace(/,/g,v.value.thousands_separator)),$},d=p=>p?p.replace(/[^\d]/g,""):"",f=z(()=>{if(c.value)return i.value;const p=g(a.modelValue);return p?`${v.value.currency_symbol} ${p}`:""}),I=p=>{const S=p.target.value;i.value=S;const $=d(S);w("update:modelValue",$),w("save",a.pointId)},s=()=>{var p;c.value=!0,i.value=((p=a.modelValue)==null?void 0:p.toString())||""},y=()=>{c.value=!1;const p=d(i.value);if(p){const S=Number(p);let $=p;v.value.min_value!==void 0&&S<v.value.min_value&&($=v.value.min_value.toString()),v.value.max_value!==void 0&&S>v.value.max_value&&($=v.value.max_value.toString()),$!==p&&(w("update:modelValue",$),w("save",a.pointId))}};return W(()=>a.modelValue,p=>{!c.value&&p!==void 0&&p!==null&&(i.value=p.toString())},{immediate:!0}),(p,S)=>(n(),r("div",dt,[t("input",{value:f.value,onInput:I,onBlur:y,onFocus:s,type:"text",required:e.required,placeholder:e.placeholder,class:ee(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,ut),e.error?(n(),r("p",ct,R(e.error),1)):k("",!0)]))}},gt={class:"mt-1 space-y-3"},vt={key:0,class:"space-y-2"},ht={class:"flex flex-wrap gap-2"},pt=["onClick"],ft=["value","required","minlength","maxlength","placeholder"],wt={class:"flex justify-between items-center mt-1"},bt={class:"text-xs text-gray-500"},yt={key:0,class:"text-xs text-red-600"},ye={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:j}){const a=e,w=j,i=C([]),c=C(""),v=I=>i.value.some(s=>s.value===I),g=I=>{v(I.value)?i.value=i.value.filter(S=>S.value!==I.value):i.value.push(I);const y=[...i.value.map(S=>S.value)];c.value.trim()&&y.push(c.value.trim());const p=y.join(", ");w("update:modelValue",p),w("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:p})},d=I=>{const s=I.target.value;w("update:modelValue",s),w("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:s}),f(s)},f=I=>{var S,$,B,T;if(!I){i.value=[],c.value="";return}const s=I.split(",").map(N=>N.trim()).filter(N=>N),y=(($=(S=a.settings)==null?void 0:S.damage_options)==null?void 0:$.map(N=>N.value))||[];i.value=((T=(B=a.settings)==null?void 0:B.damage_options)==null?void 0:T.filter(N=>s.includes(N.value)))||[];const p=s.filter(N=>!y.includes(N));c.value=p.join(", ")};return W(()=>a.modelValue,I=>{I!=null&&f(I)},{immediate:!0}),(I,s)=>{var y,p,S;return n(),r("div",gt,[(y=e.settings)!=null&&y.enable_damage&&((p=e.settings)!=null&&p.damage_options)?(n(),r("div",vt,[s[0]||(s[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",ht,[(n(!0),r(G,null,X(e.settings.damage_options,($,B)=>(n(),r("button",{key:B,type:"button",onClick:T=>g($),class:ee(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":v($.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!v($.value)}])},R($.label),11,pt))),128))])])):k("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:d,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,ft),t("div",wt,[t("span",bt,R(((S=e.modelValue)==null?void 0:S.length)||0)+"/"+R(e.maxLength||400),1),e.error?(n(),r("p",yt,R(e.error),1)):k("",!0)])])])}}},xt={class:"mt-1"},kt=["value","required"],$t={key:0,class:"mt-2 text-sm text-red-600"},It={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:j}){const a=e,w=j,i=c=>{w("update:modelValue",c.target.value),w("save",a.pointId)};return(c,v)=>(n(),r("div",xt,[t("select",{value:e.modelValue,onChange:i,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},v[0]||(v[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,kt),e.error?(n(),r("p",$t,R(e.error),1)):k("",!0)]))}},Vt=ie(It,[["__scopeId","data-v-c34a74db"]]),St={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Ct={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},_t={class:"flex flex-row space-x-4 mb-6"},Mt={class:"mt-4 text-right"},Ut={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(j,a)=>e.show?(n(),r("div",St,[t("div",Ct,[a[5]||(a[5]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),t("div",_t,[t("button",{onClick:a[0]||(a[0]=w=>j.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[3]||(a[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:a[1]||(a[1]=w=>j.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[4]||(a[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",Mt,[t("button",{onClick:a[2]||(a[2]=w=>j.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):k("",!0)}},Nt={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},qt={class:"webcam-content-box"},Rt={class:"webcam-header"},jt={class:"inspection-point-name"},Bt={key:0,class:"screen-flash-overlay"},Ft={key:2,class:"focus-status"},Pt={class:"webcam-footer"},Tt={class:"camera-controls"},Dt=["disabled"],Lt={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,inspectionPoint:String,point:Object,pointname:String},emits:["close","photoCaptured"],setup(e,{emit:j}){const a=e,w=j,i=C(null),c=C(null);let v=null,g=null;const d=C("environment"),f=C(!1),I=C(!1),s=C(!1),y=C(!1),p=C(a.inspectionPoint||"Camera"),S=C(!1),$=C({}),B=C(""),T=C("continuous"),N=C("high"),F=z(()=>{switch(N.value){case"high":return{width:1920,height:1080};case"medium":return{width:1280,height:720};case"low":return{width:640,height:480};default:return{width:1920,height:1080}}}),q=z(()=>a.aspectRatio?{aspectRatio:`${a.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),b=z(()=>{if(!a.aspectRatio)return{};const V=a.aspectRatio,o=V>1?80:60,x=V>1?80/V:60*V;return{width:`${o}%`,height:`${x}%`}}),h=z(()=>{var V;return((V=a.settings)==null?void 0:V.max_size)||2048}),u=async()=>{v&&v.getTracks().forEach(V=>V.stop()),s.value=!1,S.value=!1,B.value="";try{const V={facingMode:d.value,width:{ideal:F.value.width},height:{ideal:F.value.height},aspectRatio:{ideal:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30}};N.value==="high"&&(V.width={ideal:1920,max:3840},V.height={ideal:1080,max:2160},V.frameRate={ideal:30,max:60}),T.value!=="manual"&&(V.advanced=[{focusMode:T.value}]),d.value==="environment"&&(V.advanced||(V.advanced=[]),V.advanced.push({focusMode:T.value})),v=await navigator.mediaDevices.getUserMedia({video:V,audio:!1}),g=v.getVideoTracks()[0],i.value.srcObject=v,i.value.onloadedmetadata=async()=>{await H(),(T.value==="continuous"||T.value==="single-shot")&&await O()}}catch(V){console.error("Error accessing camera: ",V),alert("Failed to access camera. Please allow camera permission."),w("close")}},_=()=>{v&&v.getTracks().forEach(V=>V.stop()),w("close")},H=async()=>{if(g)try{const V=await navigator.mediaDevices.enumerateDevices();f.value=V.filter(m=>m.kind==="videoinput").length>1;const o=g.getCapabilities();I.value=o.torch||o.fillLightMode&&o.fillLightMode.includes("torch");const x=o.focusDistance||{};console.log("Camera capabilities:",o)}catch(V){console.error("Error checking camera capabilities:",V)}},O=async()=>{if(g)try{const V=g.getCapabilities();V.focusMode&&V.focusMode.includes("continuous")&&(await g.applyConstraints({advanced:[{focusMode:"continuous"}]}),B.value="Auto Focus Enabled",setTimeout(()=>{B.value=""},2e3))}catch(V){console.warn("Auto focus not supported:",V)}},A=async()=>{if(!(!g||!a.settings.enable_flash)){if(d.value==="user"){s.value=!s.value,y.value=s.value;return}try{g.getCapabilities().torch&&(await g.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value)}catch(V){console.error("Flash toggle failed:",V)}}},Z=async()=>{f.value&&(d.value=d.value==="environment"?"user":"environment",p.value=`${a.inspectionPoint||"Camera"} (${d.value==="environment"?"Rear":"Front"})`,await u())},oe=async()=>{if(!g)return;const V=g.getCapabilities();if(V.focusMode&&V.focusMode.includes("continuous"))try{await g.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(o){console.warn("Focus not supported",o)}},le=async V=>new Promise(o=>{const x=h.value*1024;if(V.size<=x){o(V);return}const m=new Image,U=new FileReader;U.onload=l=>{m.onload=()=>{const P=document.createElement("canvas"),M=P.getContext("2d"),L=Math.sqrt(x/V.size);P.width=m.width*L,P.height=m.height*L,M.drawImage(m,0,0,P.width,P.height);let D=.9;const E=()=>{P.toBlob(J=>{J.size>x&&D>.1?(D-=.1,E()):o(J)},"image/png",D)};E()},m.src=l.target.result},U.readAsDataURL(V)}),re=async()=>{const V=i.value,o=c.value;if(!(!V||!o||V.readyState!==4))try{const x=o.getContext("2d"),m=V.videoWidth,U=V.videoHeight;let l,P,M,L;m/U>a.aspectRatio?(P=U,l=U*a.aspectRatio,M=(m-l)/2,L=0):(l=m,P=m/a.aspectRatio,M=0,L=(U-P)/2),o.width=l,o.height=P,x.drawImage(V,M,L,l,P,0,0,l,P);const D=await new Promise(J=>{o.toBlob(J,"image/png",1)}),E=await le(D);if(E){const J=new File([E],`capture_${Date.now()}.png`,{type:"image/png",lastModified:Date.now()});w("photoCaptured",J),y.value=!0,setTimeout(()=>{y.value=!1},100)}}catch(x){console.error("Error capturing photo:",x),alert("Failed to capture photo. Please try again.")}};return W(()=>a.show,V=>{V?u():_()}),W(()=>a.inspectionPoint,V=>{p.value=V||"Camera"}),W(()=>a.aspectRatio,()=>{a.show&&u()}),Ie(()=>{v&&v.getTracks().forEach(V=>V.stop())}),(V,o)=>{var x;return e.show?(n(),r("div",Nt,[t("div",qt,[t("div",Rt,[t("div",jt,R(((x=e.point)==null?void 0:x.name)||"Camera"),1),t("button",{onClick:_,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},o[0]||(o[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:ue(q.value),onClick:oe},[t("video",{ref_key:"webcamVideo",ref:i,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:c,class:"hidden"},null,512),y.value?(n(),r("div",Bt)):k("",!0),t("div",{class:"aspect-ratio-guide",style:ue(b.value)},null,4),S.value?(n(),r("div",{key:1,class:"focus-indicator",style:ue($.value)},o[1]||(o[1]=[t("div",{class:"focus-ring"},null,-1)]),4)):k("",!0),o[2]||(o[2]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),B.value?(n(),r("div",Ft,R(B.value),1)):k("",!0)],4),t("div",Pt,[t("div",Tt,[e.settings.enable_flash?(n(),r("button",{key:0,onClick:A,disabled:!I.value,class:ee(["control-button",{active:s.value,disabled:!I.value}])},o[3]||(o[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),10,Dt)):k("",!0),t("button",{onClick:re,class:"capture-button"},o[4]||(o[4]=[t("div",{class:"camera-icon-container"},[t("div",{class:"camera-body"},[t("div",{class:"camera-lens"}),t("div",{class:"camera-flash"})])],-1)])),e.settings.enable_camera_switch&&f.value?(n(),r("button",{key:1,onClick:Z,class:"control-button"},o[5]||(o[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):k("",!0)])])])])):k("",!0)}}},At=ie(Lt,[["__scopeId","data-v-73221082"]]),Ht={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Et={class:"w-full h-full flex flex-col"},zt={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Ot={class:"text-lg font-semibold"},Wt={class:"flex items-center gap-2"},Kt={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Gt=["src"],Xt={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Zt={class:"flex justify-between items-center w-full"},Jt=["disabled"],Yt={key:1,class:"flex-1"},Qt=["disabled"],es={class:"flex gap-3 w-full"},ts=["disabled"],ss={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},as={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos"],setup(e,{emit:j}){const a=e,w=j,i=C(0),c=C([]),v=C(0),g=C(0),d=z(()=>c.value.length>0?c.value[i.value]:null);W(()=>a.images,q=>{c.value=q.map(b=>({...b})),a.show&&q.length>0?i.value=q.length-1:i.value=0,q.length===0&&a.show&&T()},{deep:!0,immediate:!0}),W(()=>a.show,q=>{q&&a.images.length>0&&(i.value=a.images.length-1)});const f=q=>q.preview||(q.image_path?`/${q.image_path}`:""),I=()=>{d.value&&(d.value.rotation=(d.value.rotation+90)%360)},s=()=>{i.value=i.value<c.value.length-1?i.value+1:0},y=()=>{i.value=i.value>0?i.value-1:c.value.length-1},p=q=>{v.value=q.touches[0].clientX},S=q=>{g.value=q.touches[0].clientX},$=()=>{v.value-g.value>50?s():g.value-v.value>50&&y(),v.value=0,g.value=0},B=()=>{a.isUploading||w("saveImages",c.value)},T=()=>{a.isUploading||w("close")},N=()=>{if(d.value&&!a.isUploading){const q=d.value;w("removePreviewImage",q);const b=c.value.findIndex(h=>h.isNew&&q.isNew&&h.preview===q.preview||!h.isNew&&!q.isNew&&h.id===q.id);b!==-1&&c.value.splice(b,1),i.value>=c.value.length&&(i.value=Math.max(0,c.value.length-1)),c.value.length===0&&w("close")}},F=()=>{a.isUploading||w("triggerAddMorePhotos")};return(q,b)=>{var h;return e.show?(n(),r("div",Ht,[t("div",Et,[t("div",zt,[t("button",{onClick:T,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},b[0]||(b[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",Ot,R(((h=e.point)==null?void 0:h.name)||"Preview")+" ("+R(i.value+1)+"/"+R(c.value.length)+") ",1),t("div",Wt,[d.value&&d.value.isNew?(n(),r("button",{key:0,onClick:N,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},b[1]||(b[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):k("",!0),t("button",{onClick:I,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},b[2]||(b[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))])]),t("div",Kt,[t("div",{class:"relative w-full max-w-full",style:ue({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"}),onTouchstart:p,onTouchmove:S,onTouchend:$},[d.value?(n(),r("img",{key:0,src:f(d.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ue({transform:`rotate(${d.value.rotation}deg)`})},null,12,Gt)):k("",!0)],36),c.value.length>1?(n(),r("button",{key:0,onClick:y,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},b[3]||(b[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):k("",!0),c.value.length>1?(n(),r("button",{key:1,onClick:s,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},b[4]||(b[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):k("",!0)]),t("div",Xt,[t("div",Zt,[d.value&&!d.value.isNew?(n(),r("button",{key:0,onClick:N,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:e.isUploading},b[5]||(b[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),te(" Hapus Foto ")]),8,Jt)):(n(),r("div",Yt)),e.allowMultiple&&c.value.length<e.maxFiles?(n(),r("button",{key:2,onClick:F,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:e.isUploading},b[6]||(b[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),te(" Tambah Foto ")]),8,Qt)):k("",!0)]),t("div",es,[t("button",{onClick:T,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:e.isUploading}," Batal ",8,ts),e.isUploading?(n(),r("button",ss,b[7]||(b[7]=[te(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(n(),r("button",{key:0,onClick:B,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):k("",!0)}}},os=ie(as,[["__scopeId","data-v-c3d47220"]]),ns=["accept","multiple","disabled"],is=["disabled"],ls={class:"h-full flex flex-col items-center justify-center p-4 text-center"},rs={class:"text-xs text-gray-400 mt-1"},ds={key:0,class:"flex items-center gap-4"},us=["src"],cs=["disabled"],ms={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},gs=["disabled"],vs=["onClick"],hs=["src"],ps={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},fs={key:0},ws={key:1,class:"ml-1"},bs={key:2,class:"mt-1 text-xs text-red-600"},ys={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:j}){const a=e,w=j,i=C(null),c=C(null),v=C(!1),g=C(!1),d=C(!1),f=C([]),I=C(0),s=C(!1),y=z(()=>Number(a.settings.max_files)>1),p=z(()=>a.settings.allowed_types.map(o=>`.${o}`).join(", ")),S=z(()=>{const o=a.settings.camera_aspect_ratio.split(":");if(o.length===2){const x=parseFloat(o[0]),m=parseFloat(o[1]);if(!isNaN(x)&&!isNaN(m)&&m!==0)return x/m}return 4/3});W(()=>a.modelValue,o=>{if(!o||o.length===0)f.value=[];else{const x=o.filter(U=>!U.isNew),m=f.value.filter(U=>U.isNew);f.value=[...m,...x]}},{immediate:!0,deep:!0});const $=z(()=>{const o=[],x=new Set;for(const m of f.value)m.id&&x.add(m.id),o.push(m);for(const m of a.modelValue)m.inspection_id&&String(m.inspection_id)==String(a.inspectionId)||x.has(m.id)||o.push({...m,rotation:m.rotation||0,isNew:!1,preview:m.preview||(m.image_path?`/${m.image_path}`:null)});return o}),B=o=>o.preview||(o.image_path?`/${o.image_path}`:""),T=()=>{d.value&&(d.value=!1),v.value=!0},N=()=>{v.value=!1,i.value.click()},F=()=>{v.value=!1,g.value=!0},q=()=>{v.value=!1,$.value.length>0&&(d.value=!0)},b=()=>{g.value=!1,$.value.length>0&&(d.value=!0)},h=()=>{d.value=!1,f.value.forEach(o=>{o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview)}),f.value=[]},u=o=>new Promise(x=>{const m=new FileReader;m.onload=U=>{const l=new Image;l.onload=()=>{x({file:o,preview:URL.createObjectURL(o),rotation:0,width:l.naturalWidth,height:l.naturalHeight,isNew:!0})},l.onerror=()=>{console.error("Failed to load image for dimensions:",o.name),x({file:o,preview:URL.createObjectURL(o),rotation:0,width:0,height:0,isNew:!0})},l.src=U.target.result},m.readAsDataURL(o)}),_=o=>{const x=o.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes(x)},H=async o=>{const m=(a.settings.max_size||2048)*1024;return new Promise(U=>{const l=new Image,P=new FileReader;P.onload=M=>{l.onload=()=>{const L=document.createElement("canvas"),D=L.getContext("2d"),E=Math.max(l.width,l.height);L.width=E,L.height=E,D.fillStyle="white",D.fillRect(0,0,E,E);const J=(E-l.width)/2,Y=(E-l.height)/2;D.drawImage(l,J,Y,l.width,l.height);let de=.9;const se=()=>{L.toBlob(pe=>{if(pe.size>m&&de>.1)de-=.1,se();else{const ke=new File([pe],o.name,{type:"image/jpeg",lastModified:Date.now()});U(ke)}},"image/jpeg",de)};se()},l.src=M.target.result},P.readAsDataURL(o)})},O=async o=>{const x=Array.from(o.target.files);if(!x.length){v.value=!1,$.value.length>0&&(d.value=!0);return}try{const m=x.filter(D=>!_(D));if(m.length>0){const D=m.map(E=>E.name.split(".").pop()).join(", ");alert(`File type not allowed: ${D}. Allowed types: ${a.settings.allowed_types.join(", ")}`),o.target.value="";return}const U=$.value.length,l=a.settings.max_files-U,P=await Promise.all(x.slice(0,l).map(async D=>await H(D))),M=await Promise.all(P.map(u)),L=y.value?M:M.slice(0,1);y.value?f.value.push(...L):(f.value.forEach(D=>{D.preview&&D.preview.startsWith("blob:")&&URL.revokeObjectURL(D.preview)}),f.value=L),v.value=!1,L.length>0?(I.value=Math.max(0,$.value.length-L.length),d.value=!0):$.value.length>0&&(d.value=!0),o.target.value=""}catch(m){console.error("Error processing selected images:",m),alert("Failed to process selected images. Please try again."),v.value=!1,$.value.length>0&&(d.value=!0)}},A=async o=>{const x=$.value.length;if(!y.value||x<a.settings.max_files)try{const m=await H(o),U=new Image;U.onload=()=>{const l={file:m,preview:URL.createObjectURL(m),rotation:0,width:U.naturalWidth,height:U.naturalHeight,isNew:!0};y.value?f.value.push(l):(f.value.forEach(P=>{P.preview&&P.preview.startsWith("blob:")&&URL.revokeObjectURL(P.preview)}),f.value=[l]),g.value=!1,v.value=!1,I.value=$.value.length-1,d.value=!0},U.src=URL.createObjectURL(m)}catch(m){console.error("Error processing captured image:",m),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),g.value=!1,v.value=!1,$.value.length>0&&(d.value=!0)},Z=(o=0)=>{I.value=o,d.value=!0},oe=o=>new Promise(x=>{if(o.rotation===0||!c.value){if(!o.isNew&&!o.file){x({file:null,width:o.width,height:o.height,isOriginal:!0});return}x({file:o.file,width:o.width,height:o.height});return}const m=new Image;m.onload=async()=>{try{const U=c.value,l=U.getContext("2d"),P=m.width,M=m.height;let L,D;o.rotation===90||o.rotation===270?(L=M,D=P):(L=P,D=M),U.width=L,U.height=D,l.clearRect(0,0,U.width,U.height),l.translate(U.width/2,U.height/2),l.rotate(o.rotation*Math.PI/180),l.drawImage(m,-P/2,-M/2,P,M),l.setTransform(1,0,0,1,0,0);const E=await new Promise(de=>{U.toBlob(de,"image/jpeg",.9)}),J=new File([E],o.file?o.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),Y=await H(J);x({file:Y,width:L,height:D})}catch(U){console.error("Error processing rotated image:",U),x({file:o.file,width:o.width,height:o.height})}},m.onerror=()=>{console.error("Failed to load image for rotation processing:",o.preview),x({file:o.file,width:o.width,height:o.height})},m.src=o.preview}),le=async o=>{var m,U,l,P;s.value=!0;const x=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),s.value=!1;return}try{for(const M of o){if(!M.isNew&&M.rotation===0&&M.id&&M.image_path){x.push({id:M.id,image_path:M.image_path,width:M.width,height:M.height,rotation:0,preview:M.preview});continue}const{file:L,width:D,height:E,isOriginal:J}=await oe(M);if(J&&!M.isNew){x.push({id:M.id,image_path:M.image_path,width:M.width,height:M.height,rotation:0,preview:M.preview});continue}const Y=new FormData;Y.append("inspection_id",a.inspectionId),Y.append("point_id",a.pointId),Y.append("image",L),Y.append("width",D),Y.append("height",E),Y.append("rotation",0),M.id&&!M.isNew&&Y.append("image_id",M.id);const se=(await fe.post(route("inspections.upload-image"),Y,{headers:{"Content-Type":"multipart/form-data"}})).data.image;x.push({id:se.id,image_path:se.image_path,width:se.width,height:se.height,rotation:se.rotation,preview:se.public_url}),M.preview&&M.preview.startsWith("blob:")&&URL.revokeObjectURL(M.preview)}w("update:modelValue",x),w("save",a.pointId),w("uploaded",{pointId:a.pointId,images:x}),h()}catch(M){if(console.error("Error during image processing/upload:",M),(U=(m=M.response)==null?void 0:m.data)!=null&&U.message)alert(`Failed to save images: ${M.response.data.message}`);else if((P=(l=M.response)==null?void 0:l.data)!=null&&P.errors){const L=Object.values(M.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${L}`)}else alert(`Failed to save images: ${M.message}`)}finally{s.value=!1}},re=o=>{if(o){if(o.id&&!o.isNew)V(o);else{const x=f.value.findIndex(m=>m.preview&&m.preview===o.preview&&m.isNew||m.id&&m.id===o.id);if(x!==-1){const m=f.value.splice(x,1)[0];m.preview&&m.preview.startsWith("blob:")&&URL.revokeObjectURL(m.preview)}w("update:modelValue",a.modelValue.filter(m=>!(m.id&&m.id===o.id)&&!(m.preview&&m.preview===o.preview)))}I.value>=$.value.length&&(I.value=Math.max(0,$.value.length-1)),$.value.length===0&&h()}},V=async o=>{var m,U;if(o.id||o.image_path)try{await fe.delete(route("inspections.delete-image"),{data:{image_id:o.id,image_path:o.image_path}})}catch(l){console.error("Error deleting image from server:",l),(U=(m=l.response)==null?void 0:m.data)!=null&&U.message?alert(`Failed to delete image from server: ${l.response.data.message}`):alert(`Failed to delete image from server: ${l.message}`);return}o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview);const x=a.modelValue.filter(l=>l.id!==o.id);w("update:modelValue",x),f.value=f.value.filter(l=>l.isNew&&o.isNew?l.preview!==o.preview:l.id!==o.id),w("removeImage",{image:o}),d.value&&$.value.length===0?h():d.value&&I.value>=$.value.length&&(I.value=Math.max(0,$.value.length-1))};return(o,x)=>(n(),r("div",null,[t("input",{ref_key:"galleryInput",ref:i,type:"file",accept:p.value,class:"hidden",onChange:O,multiple:y.value,disabled:s.value},null,40,ns),t("canvas",{ref_key:"processingCanvas",ref:c,class:"hidden"},null,512),$.value.length===0?(n(),r("label",{key:0,onClick:T,class:ee(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:s.value},[t("div",ls,[x[2]||(x[2]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),x[3]||(x[3]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),x[4]||(x[4]=t("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),t("p",rs,"Allowed types: "+R(p.value),1)])],8,is)):(n(),r("div",{key:1,class:ee(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":e.settings.max_files==1,"bg-transparent":e.settings.max_files>1}]),"aria-label":"Image gallery"},[e.settings.max_files===1?(n(),r("div",ds,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:x[0]||(x[0]=m=>Z(0))},[t("img",{src:B($.value[0]),class:"w-full h-full object-cover"},null,8,us)]),t("button",{onClick:x[1]||(x[1]=Ve(m=>V($.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:s.value},x[5]||(x[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),te(" Hapus Foto ")]),8,cs)])):(n(),r("div",ms,[y.value&&$.value.length<e.settings.max_files?(n(),r("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:T,disabled:s.value},x[6]||(x[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,gs)):k("",!0),(n(!0),r(G,null,X($.value,(m,U)=>(n(),r("div",{key:m.id||m.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:l=>Z(U)},[t("img",{src:B(m),class:"w-full h-full object-cover"},null,8,hs),m.isNew||m.rotation!==0?(n(),r("div",ps,[m.isNew?(n(),r("span",fs,"BARU")):k("",!0),m.rotation!==0?(n(),r("span",ws,"ROTASI")):k("",!0)])):k("",!0)],8,vs))),128))]))],2)),e.error?(n(),r("p",bs,R(e.error),1)):k("",!0),ae(Ut,{show:v.value,onClose:q,onOpenWebcam:F,onTriggerGallery:N},null,8,["show"]),ae(At,{show:g.value,"aspect-ratio":S.value,settings:e.settings,point:e.point,onClose:b,onPhotoCaptured:A},null,8,["show","aspect-ratio","settings","point"]),ae(os,{show:d.value,images:$.value,point:e.point,"initial-index":I.value,"allow-multiple":y.value,"max-files":e.settings.max_files,"is-uploading":s.value,"aspect-ratio":S.value,onClose:h,onSaveImages:le,onRemovePreviewImage:re,onTriggerAddMorePhotos:T},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},ve=ie(ys,[["__scopeId","data-v-f8e05d93"]]),xs={key:0,class:"fixed inset-0 z-50 overflow-hidden"},ks={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},$s={class:"px-4 pb-2 border-b border-gray-200"},Is={class:"text-lg font-semibold text-gray-900"},Vs={key:0,class:"text-sm text-gray-500 mt-1"},Ss={class:"flex-1 overflow-y-auto p-4"},Cs={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},_s={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:j}){const a=j,w=()=>{a("close")},i=c=>{c.key==="Escape"&&w()};return he(()=>{document.addEventListener("keydown",i)}),Se(()=>{document.removeEventListener("keydown",i)}),(c,v)=>(n(),K(Ce,{name:"bottom-sheet"},{default:ce(()=>[e.show?(n(),r("div",xs,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:w}),t("div",ks,[v[0]||(v[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",$s,[t("h3",Is,R(e.title),1),e.subtitle?(n(),r("p",Vs,R(e.subtitle),1)):k("",!0)]),t("div",Ss,[we(c.$slots,"default",{},void 0,!0)]),c.$slots.footer?(n(),r("div",Cs,[we(c.$slots,"footer",{},void 0,!0)])):k("",!0)])])):k("",!0)]),_:3}))}},Ms=ie(_s,[["__scopeId","data-v-7893c2dc"]]),Us={class:"space-y-4"},Ns={key:0,class:"mt-2"},qs={class:"text-sm font-medium text-gray-700 mb-2"},Rs={key:0,class:"text-red-500"},js={key:0,class:"text-xs text-red-500"},Bs={key:1,class:"grid grid-cols-2 gap-2"},Fs=["name","value","checked"],Ps={key:2,class:"space-y-2"},Ts={key:0,class:"text-red-500"},Ds={key:1,class:"text-xs text-red-500"},Ls={key:3,class:"mt-4"},As={class:"text-sm font-medium text-gray-700 mb-2"},Hs={key:0,class:"text-red-500"},Es={key:0,class:"text-xs text-red-500"},zs={class:"flex gap-2"},Os=["disabled"],xe={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(e,{emit:j}){const a=e,w=j,i=g=>w("hapus",g),c=z(()=>a.options.find(g=>g.value===a.selectedValue)),v=z(()=>{var d,f,I;if(a.point.input_type==="imageTOradio"&&a.imagesValue.length===0||a.options.length&&!a.selectedValue)return!1;const g=c.value;return!(a.showTextarea&&((d=g==null?void 0:g.settings)!=null&&d.show_textarea)&&(!((f=a.notesValue)!=null&&f.trim())||g.settings.min_length&&a.notesValue.length<g.settings.min_length||g.settings.max_length&&a.notesValue.length>g.settings.max_length)||a.showImageUpload&&((I=g==null?void 0:g.settings)!=null&&I.show_image_upload)&&(a.imagesValue.length===0||g.settings.max_files&&a.imagesValue.length>g.settings.max_files))});return(g,d)=>(n(),K(Ms,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:d[10]||(d[10]=f=>g.$emit("close"))},{footer:ce(()=>[e.selectedPoint?(n(),r("button",{key:0,onClick:d[7]||(d[7]=f=>i(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},d[12]||(d[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),te(" Hapus Data ")]))):k("",!0),t("div",zs,[t("button",{type:"button",onClick:d[8]||(d[8]=f=>g.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:d[9]||(d[9]=f=>g.$emit("save")),disabled:!v.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Os)])]),default:ce(()=>{var f,I,s,y,p,S,$,B,T,N,F,q,b,h;return[t("div",Us,[e.point.input_type==="imageTOradio"?(n(),r("div",Ns,[t("h4",qs,[(f=e.point.settings)!=null&&f.required?(n(),r("span",Rs,"*")):k("",!0)]),ae(ve,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":d[0]||(d[0]=u=>g.$emit("update:imagesValue",u)),onSave:d[1]||(d[1]=u=>g.$emit("saveImage",u))},null,8,["model-value","point-id","point","inspection-id","settings"]),(I=e.point.settings)!=null&&I.required&&e.imagesValue.length===0?(n(),r("p",js," Foto wajib diupload ")):k("",!0)])):k("",!0),e.options.length?(n(),r("div",Bs,[(n(!0),r(G,null,X(e.options,(u,_)=>(n(),r("label",{key:_,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:u.value,checked:e.selectedValue===u.value,onChange:d[2]||(d[2]=H=>g.$emit("update:selectedValue",H.target.value)),class:"hidden peer"},null,40,Fs),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===u.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==u.value}])},R(u.label),3)]))),128))])):k("",!0),e.showTextarea&&((y=(s=c.value)==null?void 0:s.settings)!=null&&y.show_textarea)?(n(),r("div",Ps,[(p=c.value.settings)!=null&&p.required?(n(),r("span",Ts,"*")):k("",!0),ae(ye,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:c.value.settings,required:(S=c.value.settings)==null?void 0:S.required,"min-length":($=c.value.settings)==null?void 0:$.min_length,"max-length":(B=c.value.settings)==null?void 0:B.max_length,placeholder:((T=c.value.settings)==null?void 0:T.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":d[3]||(d[3]=u=>g.$emit("update:notesValue",u)),onSave:d[4]||(d[4]=u=>g.$emit("saveTextarea",u))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(N=c.value.settings)!=null&&N.required&&!e.notesValue?(n(),r("p",Ds," Keterangan wajib diisi ")):k("",!0)])):k("",!0),e.showImageUpload&&((q=(F=c.value)==null?void 0:F.settings)!=null&&q.show_image_upload)?(n(),r("div",Ls,[t("h4",As,[d[11]||(d[11]=te(" Upload Foto ")),(b=c.value.settings)!=null&&b.required?(n(),r("span",Hs,"*")):k("",!0)]),ae(ve,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:c.value.settings,"onUpdate:modelValue":d[5]||(d[5]=u=>g.$emit("update:imagesValue",u)),onSave:d[6]||(d[6]=u=>g.$emit("saveImage",u))},null,8,["model-value","point-id","point","inspection-id","settings"]),(h=c.value.settings)!=null&&h.required&&e.imagesValue.length===0?(n(),r("p",Es," Foto wajib diupload ")):k("",!0)])):k("",!0)])]}),_:1},8,["show","title","subtitle"]))}},Ws={class:"mt-2 space-y-4"},Ks={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Gs=["name","value","checked","onChange","required"],Xs={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},Zs={key:0,class:"mt-3"},Js={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Ys=["src"],Qs={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ea={key:1,class:"mt-2"},ta={class:"text-sm text-gray-600"},sa={key:2,class:"mt-2 text-sm text-red-600"},aa={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:j}){const a=e,w=j,i=C(a.notes),c=C([...a.images]),v=C(!1),g=C(""),d=C([]),f=C(""),I=C([]),s=z(()=>a.options.find(b=>b.value===a.modelValue)),y=b=>b.settings&&(b.settings.show_textarea||b.settings.show_image_upload);W(()=>a.notes,b=>{i.value=b}),W(()=>a.images,b=>{c.value=[...b]}),W(()=>a.modelValue,b=>{b&&(f.value=b)});const p=b=>{w("update:modelValue",b.value),y(b)?$():w("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:b.value,notes:"",images:[]})},S=b=>b.preview||(b.image_path?`/${b.image_path}`:b),$=()=>{f.value=a.modelValue,g.value=i.value,d.value=[...c.value],I.value=[...c.value],v.value=!0},B=()=>{g.value="",d.value=[],f.value="",v.value=!1},T=b=>{d.value=b,c.value=[...b],w("update:images",[...b]),w("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:i.value,images:[...b]})},N=b=>{},F=()=>{f.value!==a.modelValue&&w("update:modelValue",f.value),i.value=g.value,w("update:notes",g.value),c.value=[...d.value],w("update:images",[...d.value]),w("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:f.value,notes:g.value,images:d.value}),v.value=!1},q=b=>{w("hapus",b),v.value=!1};return(b,h)=>{var u,_,H,O;return n(),r("div",Ws,[t("div",Ks,[(n(!0),r(G,null,X(e.options,(A,Z)=>(n(),r("label",{key:Z,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:A.value,checked:e.modelValue===A.value,onChange:oe=>p(A),class:"hidden peer",required:e.required},null,40,Gs),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===A.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==A.value}])},R(A.label),3)]))),128))]),e.modelValue&&s.value&&y(s.value)?(n(),r("div",Xs,[t("div",{class:"flex justify-between items-start"},[h[4]||(h[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:$,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((u=s.value.settings)!=null&&u.show_image_upload)?(n(),r("div",Zs,[t("div",Js,[(n(!0),r(G,null,X(e.images,(A,Z)=>(n(),r("div",{key:Z,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:S(A),class:"w-full h-full object-cover rounded"},null,8,Ys),Z===3&&e.images.length>4?(n(),r("span",Qs," +"+R(e.images.length-4),1)):k("",!0)]))),128))])])):k("",!0),e.notes&&((_=s.value.settings)!=null&&_.show_textarea)?(n(),r("div",ea,[t("p",ta,R(e.notes),1)])):k("",!0)])):k("",!0),v.value?(n(),K(xe,{key:(H=e.selectedPoint)==null?void 0:H.id,show:v.value,title:e.pointName||"Detail",subtitle:(O=s.value)==null?void 0:O.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":f.value,"notes-value":g.value,"images-value":d.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":h[0]||(h[0]=A=>f.value=A),"onUpdate:notesValue":h[1]||(h[1]=A=>g.value=A),"onUpdate:imagesValue":h[2]||(h[2]=A=>T(A)),onClose:B,onSave:F,onSaveTextarea:b.handleTextareaSave,onSaveImage:N,onHapus:h[3]||(h[3]=A=>q(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):k("",!0),e.error?(n(),r("p",sa,R(e.error),1)):k("",!0)])}}},oa={class:"mt-2 space-y-4"},na={key:0,class:"flex flex-wrap gap-3"},ia={key:1,class:"p-4 border rounded-lg bg-gray-50"},la={key:0,class:"mt-3"},ra={class:"flex gap-2 overflow-x-auto scrollbar-hide"},da=["src"],ua={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ca={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},ma=["name","value","checked"],ga={key:1,class:"mt-2"},va={class:"text-sm text-gray-600"},ha={key:3,class:"mt-2 text-sm text-red-600"},pa={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:j}){const a=e,w=j,i=C(a.notes),c=C([...a.images]),v=C(!1),g=C(""),d=C([]),f=C(""),I=C([]),s=z(()=>a.options.find(N=>N.value===a.modelValue)),y=N=>N.preview||(N.image_path?`/${N.image_path}`:N),p=()=>{f.value=a.modelValue||"",g.value=i.value,d.value=[...c.value],I.value=[...c.value],v.value=!0},S=()=>{g.value="",d.value=[],f.value="",v.value=!1},$=N=>{d.value=N,c.value=[...N],w("update:images",[...N]),w("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:i.value,images:[...N]})},B=()=>{f.value!==a.modelValue&&w("update:modelValue",f.value),i.value=g.value,w("update:notes",g.value),c.value=[...d.value],w("update:images",[...d.value]),w("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:f.value,notes:g.value,images:d.value}),v.value=!1},T=N=>{w("hapus",N),v.value=!1};return(N,F)=>{var q,b,h;return n(),r("div",oa,[!e.modelValue&&c.value.length===0&&!i.value?(n(),r("div",na,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:p},F[4]||(F[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),r("div",ia,[t("div",{class:"flex justify-between items-start"},[F[5]||(F[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:p,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),c.value.length>0?(n(),r("div",la,[t("div",ra,[(n(!0),r(G,null,X(c.value,(u,_)=>(n(),r("div",{key:_,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:y(u),class:"w-full h-full object-cover rounded"},null,8,da),_===3&&c.value.length>4?(n(),r("span",ua," +"+R(c.value.length-4),1)):k("",!0)]))),128))])])):k("",!0),t("div",ca,[(n(!0),r(G,null,X(e.options,(u,_)=>(n(),r("label",{key:_,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:u.value,checked:e.modelValue===u.value,disabled:!0,class:"hidden peer"},null,8,ma),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===u.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==u.value}])},R(u.label),3)]))),128))]),i.value&&((q=s.value.settings)!=null&&q.show_textarea)?(n(),r("div",ga,[t("p",va,R(i.value),1)])):k("",!0)])),v.value?(n(),K(xe,{key:(b=e.selectedPoint)==null?void 0:b.id,show:v.value,title:e.pointName||"Detail",subtitle:(h=s.value)==null?void 0:h.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":f.value,"notes-value":g.value,"images-value":d.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":F[0]||(F[0]=u=>f.value=u),"onUpdate:notesValue":F[1]||(F[1]=u=>g.value=u),"onUpdate:imagesValue":F[2]||(F[2]=u=>$(u)),onClose:S,onSave:B,onHapus:F[3]||(F[3]=u=>T(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):k("",!0),e.error?(n(),r("p",ha,R(e.error),1)):k("",!0)])}}},fa={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},wa={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},ba={class:"text-xl font-semibold text-indigo-700"},ya={class:"p-4 space-y-4"},xa={class:"flex items-start justify-between"},ka={class:"block text-sm font-medium text-gray-700"},$a={key:0,class:"text-red-500"},Ia={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Va={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(e,{emit:j}){const a=e,w=j,i=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],c=f=>{var s;const I=a.form.results[f.id];if(!I)return!1;switch(f.input_type){case"text":case"number":case"date":case"account":return!!I.note;case"select":case"radio":return!!I.status;case"image":return((s=I.images)==null?void 0:s.length)>0;default:return!1}},v=(f,I)=>{w("updateResult",{pointId:f,value:I})},g=f=>{w("saveResult",f)},d=f=>{w("hapusPoint",f)};return(f,I)=>(n(),r("div",fa,[t("div",wa,[t("h2",ba,R(e.category.name),1)]),t("div",ya,[(n(!0),r(G,null,X(e.category.points,s=>{var y,p,S,$,B,T,N,F,q,b,h,u,_,H,O,A,Z,oe,le,re,V,o,x,m,U;return n(),r("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",xa,[t("label",ka,[te(R(s.name)+" ",1),(y=s.settings)!=null&&y.is_required?(n(),r("span",$a,"*")):k("",!0)]),c(s)?(n(),r("span",Ia," ✓ ")):k("",!0)]),s.input_type==="text"?(n(),K(ot,{key:0,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[l=>e.form.results[s.id].note=l,l=>v(s.id,l)],required:(p=s.settings)==null?void 0:p.is_required,"min-length":(S=s.settings)==null?void 0:S.min_length,"max-length":($=s.settings)==null?void 0:$.max_length,pattern:(B=s.settings)==null?void 0:B.pattern,placeholder:((T=s.settings)==null?void 0:T.placeholder)||"Masukan text",error:e.form.errors[`results.${s.id}.note`],onSave:l=>g(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):k("",!0),s.input_type==="number"?(n(),K(Ne,{key:1,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[l=>e.form.results[s.id].note=l,l=>v(s.id,l)],required:(N=s.settings)==null?void 0:N.is_required,min:(F=s.settings)==null?void 0:F.min,max:(q=s.settings)==null?void 0:q.max,step:((b=s.settings)==null?void 0:b.step)||1,placeholder:((h=s.settings)==null?void 0:h.placeholder)||"Masukan number",error:e.form.errors[`results.${s.id}.note`],onSave:l=>g(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):k("",!0),s.input_type==="account"?(n(),K(mt,{key:2,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[l=>e.form.results[s.id].note=l,l=>v(s.id,l)],required:(u=s.settings)==null?void 0:u.is_required,placeholder:((_=s.settings)==null?void 0:_.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:l=>g(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):k("",!0),s.input_type==="date"?(n(),K(rt,{key:3,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[l=>e.form.results[s.id].note=l,l=>v(s.id,l)],required:(H=s.settings)==null?void 0:H.is_required,"min-date":(O=s.settings)==null?void 0:O.min_date,"max-date":(A=s.settings)==null?void 0:A.max_date,error:e.form.errors[`results.${s.id}.note`],onSave:l=>g(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):k("",!0),s.input_type==="textarea"?(n(),K(ye,{key:4,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[l=>e.form.results[s.id].note=l,l=>v(s.id,l)],required:(Z=s.settings)==null?void 0:Z.is_required,"min-length":(oe=s.settings)==null?void 0:oe.min_length,"max-length":(le=s.settings)==null?void 0:le.max_length,placeholder:((re=s.settings)==null?void 0:re.placeholder)||"Masukkan teks di sini",settings:s.settings,error:e.form.errors[`results.${s.id}.note`],onSave:l=>g(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):k("",!0),s.input_type==="radio"?(n(),K(aa,{key:5,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[l=>e.form.results[s.id].status=l,l=>v(s.id,l)],notes:e.form.results[s.id].note,images:e.form.results[s.id].images,required:(V=s.settings)==null?void 0:V.is_required,"point-id":s.id,point:s,"inspection-id":e.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((o=s.settings)==null?void 0:o.radios)||i,error:e.form.errors[`results.${s.id}.status`],"onUpdate:notes":l=>e.form.results[s.id].note=l,"onUpdate:images":l=>e.form.results[s.id].images=l,onSave:l=>g(s.id),onHapus:l=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):k("",!0),s.input_type==="imageTOradio"?(n(),K(pa,{key:6,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[l=>e.form.results[s.id].status=l,l=>v(s.id,l)],notes:e.form.results[s.id].note,images:e.form.results[s.id].images,required:(x=s.settings)==null?void 0:x.is_required,"point-id":s.id,"inspection-id":e.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((m=s.settings)==null?void 0:m.radios)||i,error:e.form.errors[`results.${s.id}.status`],"onUpdate:notes":l=>e.form.results[s.id].note=l,"onUpdate:images":l=>e.form.results[s.id].images=l,onSave:l=>g(s.id),onHapus:l=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):k("",!0),s.input_type==="image"?(n(),K(ve,{key:7,modelValue:e.form.images[s.id],"onUpdate:modelValue":l=>e.form.images[s.id]=l,error:e.form.errors[`images.${s.id}`],"inspection-id":e.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,"onUpdate:notes":l=>e.form.results[s.id].note=l,"onUpdate:status":l=>e.form.results[s.id].status=l},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):k("",!0),s.input_type==="select"?(n(),K(Vt,{key:8,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[l=>e.form.results[s.id].status=l,l=>v(s.id,l)],required:(U=s.settings)==null?void 0:U.is_required,error:e.form.errors[`results.${s.id}.status`],onSave:l=>g(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):k("",!0)])}),128))])]))}},za=ie(Va,[["__scopeId","data-v-c1854ea6"]]),Sa={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ca={class:"p-4 space-y-4-6"},_a={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ma=["value"],Ua={class:"p-4 space-y-4-6"},Na={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},qa=["value"],Ra={key:0,class:"p-4 space-y-4-6"},ja={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ba=["value"],Fa={class:"p-4 space-y-4-6"},Oa={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const j=e,a=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(y){return console.error("Error parsing settings JSON:",y),{}}return typeof s=="object"&&s!==null?s:{}},w=z(()=>a(j.inspection.settings).conclusion||{}),i=C({flooded:w.value.flooded||"",collision:w.value.collision||"",collision_severity:w.value.collision_severity||"",conclusion_note:j.inspection.notes||""}),c=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],v=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],g=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],d=()=>{const s={flooded:i.value.flooded,collision:i.value.collision,collision_severity:i.value.collision==="yes"?i.value.collision_severity:null,conclusion_note:i.value.conclusion_note};_e.post(route("inspections.updateConclusion",j.inspectionId),s,{preserveScroll:!0,preserveState:!0,onError:y=>{console.error("Error saving conclusion:",y)}})},f=be.debounce(d,500);W([()=>i.value.flooded,()=>i.value.collision,()=>i.value.collision_severity],()=>{d()}),he(()=>{I()}),W(()=>j.inspection,()=>{I()},{deep:!0});const I=()=>{const y=a(j.inspection.settings).conclusion||{};i.value={flooded:y.flooded||"",collision:y.collision||"",collision_severity:y.collision_severity||"",conclusion_note:j.inspection.notes||""}};return(s,y)=>(n(),r("div",Sa,[y[9]||(y[9]=t("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[t("h2",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),t("div",Ca,[y[5]||(y[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),t("div",_a,[(n(),r(G,null,X(c,p=>t("label",{key:p.value,class:"cursor-pointer"},[ne(t("input",{type:"radio","onUpdate:modelValue":y[0]||(y[0]=S=>i.value.flooded=S),value:p.value,class:"hidden peer"},null,8,Ma),[[ge,i.value.flooded]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.flooded===p.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.flooded!==p.value}])},R(p.label),3)])),64))])]),t("div",Ua,[y[7]||(y[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),t("div",Na,[(n(),r(G,null,X(v,p=>t("label",{key:p.value,class:"cursor-pointer"},[ne(t("input",{type:"radio","onUpdate:modelValue":y[1]||(y[1]=S=>i.value.collision=S),value:p.value,class:"hidden peer"},null,8,qa),[[ge,i.value.collision]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.collision===p.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.collision!==p.value}])},R(p.label),3)])),64))]),i.value.collision==="yes"?(n(),r("div",Ra,[y[6]||(y[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),t("div",ja,[(n(),r(G,null,X(g,p=>t("label",{key:p.value,class:"cursor-pointer"},[ne(t("input",{type:"radio","onUpdate:modelValue":y[2]||(y[2]=S=>i.value.collision_severity=S),value:p.value,class:"hidden peer"},null,8,Ba),[[ge,i.value.collision_severity]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.collision_severity===p.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.collision_severity!==p.value}])},R(p.label),3)])),64))])])):k("",!0)]),t("div",Fa,[y[8]||(y[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),ne(t("textarea",{"onUpdate:modelValue":y[3]||(y[3]=p=>i.value.conclusion_note=p),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:y[4]||(y[4]=(...p)=>Q(f)&&Q(f)(...p))},null,544),[[me,i.value.conclusion_note]])])]))}};export{Ms as B,za as C,Ea as V,Oa as _,xe as a};
