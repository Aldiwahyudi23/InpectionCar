import{x as Te,d as _,m as ke,z as _e,A as re,e as l,o as a,a as e,f as y,b as de,p as ce,v as pe,u as K,F as oe,h as ae,t as B,g as ue,k as be,w as me,l as Z,n as ne,C as ye,D as Ue,c as se,r as je,T as Ce,E as Ie,W as Ve,G as De}from"./app-Bjj8Aq0D.js";import{l as xe}from"./lodash-rbhcT_Mg.js";import{_ as qe}from"./PrimaryButton-CUtrL_G1.js";import{_ as Be}from"./ActionMessage-B4N0p6LI.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Le}from"./InputNumber-t5Pwca0b.js";const Pe={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ae={key:0,class:"p-4 space-y-4"},Fe={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},Ee={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},ze={class:"relative"},He={key:0,class:"absolute right-3 top-3"},Oe={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},We={key:0},Ke=["onMousedown"],Xe={class:"font-medium text-gray-900"},Ge={class:"text-sm text-gray-500"},Ze={key:1,class:"p-4 text-sm text-gray-500 text-center"},Je={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ye={key:0,class:"mb-4"},Qe=["innerHTML"],et={key:1},tt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},st=["onClick"],ot=["src","alt"],at={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},nt={class:"text-white text-xs text-center"},lt={key:2,class:"text-center py-4 text-gray-500 text-sm"},it={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},rt=["src","alt"],ut={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},dt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},ct={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},mt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(t,{emit:S}){var E,W,J,le;const o=t,k=S,r=Te({plate_number:((E=o.inspection)==null?void 0:E.plate_number)||"",car_id:((W=o.inspection)==null?void 0:W.car_id)||null,car_name:((le=(J=o.inspection)==null?void 0:J.car)==null?void 0:le.name)||""}),i=_(r.car_name),h=_(!1),d=_(!1),m=_([]),b=_(null),v=_([]),s=_(!1),f=_(0);ke(()=>{var V,u,C,n;if((V=o.inspection)!=null&&V.car_id&&((u=o.CarDetail)==null?void 0:u.length)>0){const w=o.CarDetail.find(p=>p.id===o.inspection.car_id);w&&H(w)}else!((C=o.inspection)!=null&&C.car_id)&&((n=o.inspection)!=null&&n.car_name)&&(i.value=o.inspection.car_name);window.addEventListener("keydown",D)}),_e(()=>{window.removeEventListener("keydown",D)}),re(i,V=>{r.car_id&&I(b.value)!==V&&(r.car_id=null,b.value=null,v.value=[]),r.car_name=V});const I=V=>{var C,n,w;if(!V)return"";const u=[];return(C=V.brand)!=null&&C.name&&u.push(V.brand.name),(n=V.model)!=null&&n.name&&u.push(V.model.name),(w=V.type)!=null&&w.name&&u.push(V.type.name),V.cc&&u.push(`${V.cc}cc`),V.transmission&&u.push(V.transmission),V.fuel_type&&u.push(V.fuel_type),V.year&&u.push(V.year.toString()),V.production_period&&u.push(`(${V.production_period})`),u.join(" ")},L=xe.debounce(()=>{if(!i.value.trim()){m.value=[],h.value=!1;return}d.value=!0;try{const V=i.value.toLowerCase().trim();m.value=o.CarDetail.filter(u=>I(u).toLowerCase().includes(V)),h.value=!0}finally{d.value=!1}},300),U=()=>{setTimeout(()=>{h.value=!1},200)},H=async V=>{b.value=V,i.value=I(V),r.car_id=V.id,r.car_name=I(V),h.value=!1,await N(V.id),X()},A=V=>!V||!V.file_path?"":`/storage/${V.file_path}`,N=async V=>{try{const u=await fetch(`/api/cars/${V}/images`);if(u.ok){const C=await u.json();v.value=Array.isArray(C)?C:[]}else v.value=[]}catch(u){console.error("Error loading car images:",u),v.value=[]}},F=V=>{f.value=V,s.value=!0,document.body.style.overflow="hidden"},P=()=>{s.value=!1,document.body.style.overflow=""},$=()=>{f.value=(f.value+1)%v.value.length},T=()=>{f.value=(f.value-1+v.value.length)%v.value.length},D=V=>{if(s.value)switch(V.key){case"Escape":P();break;case"ArrowRight":$();break;case"ArrowLeft":T();break}},X=()=>{const V={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name};k("update-vehicle",V)},ee=()=>{o.inspection&&r.post(route("inspections.updateVehicleDetails",{inspection:o.inspection.id}),{preserveScroll:!0})};return re(()=>o.inspection,V=>{var u;if(V)if(r.plate_number=V.plate_number||"",r.car_id=V.car_id||null,V.car_id&&((u=o.CarDetail)==null?void 0:u.length)>0){const C=o.CarDetail.find(n=>n.id===V.car_id);C&&H(C)}else V.car_name&&(i.value=V.car_name,r.car_name=V.car_name)},{deep:!0}),(V,u)=>{var C;return a(),l("div",Pe,[u[17]||(u[17]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(a(),l("div",Ae,[e("div",Fe,[u[6]||(u[6]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nomor Plat Kendaraan ",-1)),ce(e("input",{"onUpdate:modelValue":u[0]||(u[0]=n=>K(r).plate_number=n),type:"text",placeholder:"Contoh: B 1234 ABC",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:X},null,544),[[pe,K(r).plate_number]])]),e("div",Ee,[u[9]||(u[9]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",ze,[ce(e("input",{"onUpdate:modelValue":u[1]||(u[1]=n=>i.value=n),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:u[2]||(u[2]=(...n)=>K(L)&&K(L)(...n)),onFocus:u[3]||(u[3]=n=>h.value=!0),onBlur:U},null,544),[[pe,i.value]]),d.value?(a(),l("div",He,u[7]||(u[7]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):y("",!0),h.value?(a(),l("div",Oe,[m.value.length>0?(a(),l("div",We,[(a(!0),l(oe,null,ae(m.value,n=>(a(),l("div",{key:n.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:w=>H(n)},[e("div",Xe,B(I(n)),1),e("div",Ge,B(n.year)+" • "+B(n.cc)+"cc • "+B(n.transmission)+" • "+B(n.fuel_type),1)],40,Ke))),128))])):(a(),l("div",Ze,u[8]||(u[8]=[ue(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),ue(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):y("",!0)]),ce(e("input",{type:"hidden","onUpdate:modelValue":u[4]||(u[4]=n=>K(r).car_id=n)},null,512),[[pe,K(r).car_id]])]),K(r).car_id&&b.value?(a(),l("div",Je,[b.value.description?(a(),l("div",Ye,[u[10]||(u[10]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:b.value.description},null,8,Qe)])):y("",!0),v.value.length>0?(a(),l("div",et,[u[11]||(u[11]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",tt,[(a(!0),l(oe,null,ae(v.value,(n,w)=>(a(),l("div",{key:n.id||w,class:"relative group cursor-pointer",onClick:p=>F(w)},[e("img",{src:A(n),alt:n.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ot),n.note?(a(),l("div",at,[e("p",nt,B(n.note),1)])):y("",!0)],8,st))),128))])])):(a(),l("div",lt," Tidak ada gambar tersedia untuk mobil ini "))])):y("",!0),s.value?(a(),l("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:P},[e("div",it,[e("button",{onClick:P,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},u[12]||(u[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),v.value.length>1?(a(),l("button",{key:0,onClick:be(T,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},u[13]||(u[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),v.value.length>1?(a(),l("button",{key:1,onClick:be($,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},u[14]||(u[14]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0),e("img",{src:A(v.value[f.value]),alt:"Car Image "+(f.value+1),class:"max-w-full max-h-full object-contain",onClick:u[5]||(u[5]=be(()=>{},["stop"]))},null,8,rt),v.value.length>1?(a(),l("div",ut,B(f.value+1)+" / "+B(v.value.length),1)):y("",!0),(C=v.value[f.value])!=null&&C.note?(a(),l("div",dt,B(v.value[f.value].note),1)):y("",!0)])])):y("",!0),de(qe,{type:"button",onClick:ee,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},{default:me(()=>[K(r).processing?(a(),l("svg",ct,u[15]||(u[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),e("span",null,B(K(r).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),de(Be,{on:K(r).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:me(()=>u[16]||(u[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ue(" Tersimpan. ")])),_:1,__:[16]},8,["on"])]),_:1})])):y("",!0)])}}},gt=ge(mt,[["__scopeId","data-v-04b281af"]]),vt={class:"mt-1"},pt=["value","required","minlength","maxlength","allowSpace","placeholder"],ht={key:0,class:"mt-2 text-sm text-red-600"},ft={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:S}){const o=t,k=S,r=Z(()=>{if(!o.modelValue)return"";let h=o.modelValue;switch(o.allowSpace||(h=h.replace(/\s+/g,"")),o.textTransform){case"uppercase":return h.toUpperCase();case"lowercase":return h.toLowerCase();case"capitalize":return h.replace(/\b\w/g,d=>d.toUpperCase());default:return h}}),i=h=>{let d=h.target.value;switch(o.allowSpace||(d=d.replace(/\s+/g,"")),o.textTransform){case"uppercase":d=d.toUpperCase();break;case"lowercase":d=d.toLowerCase();break;case"capitalize":d=d.replace(/\b\w/g,m=>m.toUpperCase());break}k("update:modelValue",d),k("save",o.pointId)};return(h,d)=>(a(),l("div",vt,[e("input",{value:r.value,onInput:i,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,pt),t.error?(a(),l("p",ht,B(t.error),1)):y("",!0)]))}},wt={class:"mt-1"},yt=["value","required","min","max"],bt={key:0,class:"mt-2 text-sm text-red-600"},xt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:S}){const o=t,k=S,r=i=>{k("update:modelValue",i.target.value),k("save",o.pointId)};return(i,h)=>(a(),l("div",wt,[e("input",{value:t.modelValue,onChange:r,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,yt),t.error?(a(),l("p",bt,B(t.error),1)):y("",!0)]))}},kt={class:"mt-1"},$t=["value","required","placeholder"],It={key:0,class:"mt-2 text-sm text-red-600"},Ct={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:S}){const o=t,k=S,r=_(""),i=Z(()=>{var v,s,f,I;return{currency_symbol:((v=o.settings)==null?void 0:v.currency_symbol)||"Rp",thousands_separator:((s=o.settings)==null?void 0:s.thousands_separator)||",",min_value:((f=o.settings)==null?void 0:f.min_value)!==void 0?Number(o.settings.min_value):0,max_value:((I=o.settings)==null?void 0:I.max_value)!==void 0?Number(o.settings.max_value):1e9}}),h=v=>{if(v==null||v==="")return"";const s=Number(v);if(isNaN(s))return"";let f=s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return i.value.thousands_separator!==","&&(f=f.replace(/,/g,i.value.thousands_separator)),f},d=v=>v?v.replace(/[^\d]/g,""):"",m=Z(()=>r.value?`${i.value.currency_symbol} ${h(r.value)}`:""),b=v=>{let s=d(v.target.value),f=Number(s);i.value.min_value!==void 0&&f<i.value.min_value&&(s=i.value.min_value.toString()),i.value.max_value!==void 0&&f>i.value.max_value&&(s=i.value.max_value.toString()),r.value=s,k("update:modelValue",s),k("save",o.pointId)};return re(()=>o.modelValue,v=>{v!=null&&(r.value=v.toString())},{immediate:!0}),(v,s)=>(a(),l("div",kt,[e("input",{value:m.value,onInput:b,type:"text",required:t.required,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,$t),t.error?(a(),l("p",It,B(t.error),1)):y("",!0)]))}},Vt={class:"mt-1 space-y-3"},St={key:0,class:"space-y-2"},_t={class:"flex flex-wrap gap-2"},Mt=["onClick"],Ut=["value","required","minlength","maxlength","placeholder"],jt={class:"flex justify-between items-center mt-1"},Tt={class:"text-xs text-gray-500"},Rt={key:0,class:"text-xs text-red-600"},Re={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:S}){const o=t,k=S,r=_([]),i=_(""),h=v=>r.value.some(s=>s.value===v),d=v=>{h(v.value)?r.value=r.value.filter(L=>L.value!==v.value):r.value.push(v);const f=[...r.value.map(L=>L.value)];i.value.trim()&&f.push(i.value.trim());const I=f.join(", ");k("update:modelValue",I),k("save",{pointId:o.pointId,inspectionId:o.inspectionId,notes:I})},m=v=>{const s=v.target.value;k("update:modelValue",s),k("save",{pointId:o.pointId,inspectionId:o.inspectionId,notes:s}),b(s)},b=v=>{var L,U,H,A;if(!v){r.value=[],i.value="";return}const s=v.split(",").map(N=>N.trim()).filter(N=>N),f=((U=(L=o.settings)==null?void 0:L.damage_options)==null?void 0:U.map(N=>N.value))||[];r.value=((A=(H=o.settings)==null?void 0:H.damage_options)==null?void 0:A.filter(N=>s.includes(N.value)))||[];const I=s.filter(N=>!f.includes(N));i.value=I.join(", ")};return re(()=>o.modelValue,v=>{v!=null&&b(v)},{immediate:!0}),(v,s)=>{var f,I,L;return a(),l("div",Vt,[(f=t.settings)!=null&&f.enable_damage&&((I=t.settings)!=null&&I.damage_options)?(a(),l("div",St,[s[0]||(s[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",_t,[(a(!0),l(oe,null,ae(t.settings.damage_options,(U,H)=>(a(),l("button",{key:H,type:"button",onClick:A=>d(U),class:ne(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":h(U.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!h(U.value)}])},B(U.label),11,Mt))),128))])])):y("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:m,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Ut),e("div",jt,[e("span",Tt,B(((L=t.modelValue)==null?void 0:L.length)||0)+"/"+B(t.maxLength||400),1),t.error?(a(),l("p",Rt,B(t.error),1)):y("",!0)])])])}}},Nt={class:"mt-1"},Dt=["value","required"],qt={key:0,class:"mt-2 text-sm text-red-600"},Bt={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:S}){const o=t,k=S,r=i=>{k("update:modelValue",i.target.value),k("save",o.pointId)};return(i,h)=>(a(),l("div",Nt,[e("select",{value:t.modelValue,onChange:r,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},h[0]||(h[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Dt),t.error?(a(),l("p",qt,B(t.error),1)):y("",!0)]))}},Lt=ge(Bt,[["__scopeId","data-v-c34a74db"]]),Pt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},At={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Ft={class:"flex flex-row space-x-4 mb-6"},Et={class:"mt-4 text-right"},zt={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(S,o)=>t.show?(a(),l("div",Pt,[e("div",At,[o[5]||(o[5]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),e("div",Ft,[e("button",{onClick:o[0]||(o[0]=k=>S.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},o[3]||(o[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:o[1]||(o[1]=k=>S.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},o[4]||(o[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",Et,[e("button",{onClick:o[2]||(o[2]=k=>S.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):y("",!0)}},Ht={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Ot={class:"webcam-content-box"},Wt={class:"webcam-header"},Kt={class:"inspection-point-name"},Xt={key:0,class:"screen-flash-overlay"},Gt={key:2,class:"zoom-controls"},Zt=["max"],Jt={class:"webcam-footer"},Yt={class:"camera-controls"},Qt=["disabled"],es={class:"camera-icon-container"},ts={key:0,class:"camera-spinner"},ss={key:1,class:"camera-body"},os={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:S}){const o=t,k=S,r=_(null),i=_(null);let h=null,d=null;const m=_("environment"),b=_(!1),v=_(!1),s=_(!1),f=_(!1),I=_(!1),L=_({}),U=_(!1),H=_(1),A=_(1),N=_(!1),F=Z(()=>{var u;return((u=o.settings)==null?void 0:u.max_size)||2048}),P=Z(()=>o.aspectRatio?{aspectRatio:`${o.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),$=Z(()=>{if(!o.aspectRatio)return{};const u=o.aspectRatio,C=u>1?80:60,n=u>1?80/u:60*u;return{width:`${C}%`,height:`${n}%`}}),T=async()=>{h&&h.getTracks().forEach(u=>u.stop());try{const u={facingMode:m.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:o.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};h=await navigator.mediaDevices.getUserMedia({video:u,audio:!1}),d=h.getVideoTracks()[0],r.value.srcObject=h,r.value.onloadedmetadata=async()=>{await X(),await r.value.play()}}catch(u){console.error("Error accessing camera: ",u),alert("Failed to access camera. Please allow camera permission."),k("close")}},D=()=>{h&&h.getTracks().forEach(u=>u.stop()),k("close")},X=async()=>{if(d)try{const u=await navigator.mediaDevices.enumerateDevices();b.value=u.filter(n=>n.kind==="videoinput").length>1;const C=d.getCapabilities();C.zoom?(N.value=!0,A.value=C.zoom.max,console.log(`Zoom supported. Max zoom: ${A.value}`)):(N.value=!1,console.warn("Zoom is not supported by this camera.")),v.value=C.torch||C.fillLightMode&&C.fillLightMode.includes("torch")}catch(u){console.error("Error checking camera capabilities:",u)}},ee=async u=>{if(!d)return;const C=r.value.getBoundingClientRect(),n=u.clientX-C.left,w=u.clientY-C.top;I.value=!0,L.value={left:`${n}px`,top:`${w}px`,transform:"translate(-50%, -50%)"};try{if(d.getCapabilities().pointsOfInterest){const q=n/C.width,M=w/C.height;await d.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:q,y:M}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(p){console.warn("Manual focus failed:",p)}setTimeout(()=>{I.value=!1,d.getCapabilities().focusMode.includes("continuous")&&d.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},E=async u=>{if(!d||!N.value)return;const C=Math.min(Math.max(u,1),A.value);H.value=C;try{await d.applyConstraints({advanced:[{zoom:C}]})}catch(n){console.error("Failed to set zoom:",n)}},W=async()=>{if(!(!d||!v.value))try{m.value==="user"?(s.value=!s.value,f.value=s.value):(await d.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value)}catch(u){console.error("Flash toggle failed:",u)}},J=async()=>{b.value&&(m.value=m.value==="environment"?"user":"environment",h&&h.getTracks().forEach(u=>u.stop()),await T())},le=async u=>new Promise(C=>{const n=F.value*1024;if(u.size<=n){C(u);return}const w=new Image,p=new FileReader;p.onload=q=>{w.onload=()=>{const M=document.createElement("canvas"),x=M.getContext("2d"),Y=Math.sqrt(n/u.size);M.width=w.width*Y,M.height=w.height*Y,x.drawImage(w,0,0,M.width,M.height);let R=.9;const g=()=>{M.toBlob(c=>{c.size>n&&R>.1?(R-=.1,g()):C(c)},"image/jpeg",R)};g()},w.src=q.target.result},p.readAsDataURL(u)}),V=async()=>{if(!(U.value||!r.value||!i.value)){U.value=!0;try{const u=r.value,C=i.value,n=u.videoWidth,w=u.videoHeight;let p,q,M,x;n/w>o.aspectRatio?(q=w,p=w*o.aspectRatio,M=(n-p)/2,x=0):(p=n,q=n/o.aspectRatio,M=0,x=(w-q)/2),C.width=p,C.height=q,C.getContext("2d").drawImage(u,M,x,p,q,0,0,p,q);const R=await new Promise(c=>{C.toBlob(c,"image/jpeg",1)}),g=await le(R);if(g){const c=new File([g],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});k("photoCaptured",c),f.value=!0,setTimeout(()=>{f.value=!1},100)}}catch(u){console.error("Error capturing photo:",u),alert("Failed to capture photo. Please try again.")}finally{U.value=!1}}};return re(()=>o.show,u=>{u?T():D()}),_e(()=>{h&&h.getTracks().forEach(u=>u.stop())}),(u,C)=>{var n;return t.show?(a(),l("div",Ht,[e("div",Ot,[e("div",Wt,[e("div",Kt,B(((n=t.point)==null?void 0:n.name)||"Camera"),1),e("button",{onClick:D,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},C[2]||(C[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:ye(P.value),onClick:ee,onTouchstart:ee},[e("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:i,class:"hidden"},null,512),f.value?(a(),l("div",Xt)):y("",!0),e("div",{class:"aspect-ratio-guide",style:ye($.value)},null,4),I.value?(a(),l("div",{key:1,class:"focus-indicator",style:ye(L.value)},C[3]||(C[3]=[e("div",{class:"focus-ring"},null,-1)]),4)):y("",!0),C[4]||(C[4]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),N.value?(a(),l("div",Gt,[ce(e("input",{type:"range",min:"1",max:A.value,step:"0.1","onUpdate:modelValue":C[0]||(C[0]=w=>H.value=w),onInput:C[1]||(C[1]=w=>E(parseFloat(w.target.value))),class:"zoom-slider"},null,40,Zt),[[pe,H.value]])])):y("",!0)],36),e("div",Jt,[e("div",Yt,[t.settings.enable_flash&&v.value?(a(),l("button",{key:0,onClick:W,class:ne(["control-button",{active:s.value,disabled:!v.value}])},C[5]||(C[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):y("",!0),e("button",{onClick:V,class:"capture-button",disabled:U.value},[e("div",es,[U.value?(a(),l("div",ts)):(a(),l("div",ss,C[6]||(C[6]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,Qt),t.settings.enable_camera_switch&&b.value?(a(),l("button",{key:1,onClick:J,class:"control-button"},C[7]||(C[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):y("",!0)])])])])):y("",!0)}}},as=ge(os,[["__scopeId","data-v-a032b4ac"]]),ns={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},ls={class:"w-full h-full flex flex-col"},is={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},rs={class:"text-lg font-semibold"},us={class:"flex items-center gap-2"},ds={class:"flex-1 flex items-center justify-center overflow-hidden relative"},cs=["src"],ms={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},gs={class:"flex justify-between items-center w-full"},vs=["disabled"],ps={key:1,class:"flex-1"},hs=["disabled"],fs={class:"flex gap-3 w-full"},ws=["disabled"],ys={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},bs={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(t,{emit:S}){const o=t,k=S,r=_(0),i=_([]),h=_(0),d=_(0),m=Z(()=>i.value.length>0?i.value[r.value]:null);re(()=>o.images,P=>{i.value=P.map($=>({...$,rotation:$.rotation||0})),P.length===0&&o.show&&A()},{deep:!0,immediate:!0}),re(()=>o.show,P=>{P&&o.images.length>0&&(r.value=o.initialIndex)});const b=P=>P.preview||(P.image_path?`/${P.image_path}`:""),v=()=>{if(m.value){const P=(m.value.rotation+90)%360;i.value[r.value].rotation=P,k("update:images",i.value)}},s=()=>{r.value=r.value<i.value.length-1?r.value+1:0},f=()=>{r.value=r.value>0?r.value-1:i.value.length-1},I=P=>{h.value=P.touches[0].clientX},L=P=>{d.value=P.touches[0].clientX},U=()=>{h.value-d.value>50?s():d.value-h.value>50&&f(),h.value=0,d.value=0},H=()=>{o.isUploading||k("saveImages",i.value)},A=()=>{o.isUploading||k("close")},N=()=>{if(m.value&&!o.isUploading){const P=m.value,$=i.value.findIndex(T=>T.isNew&&P.isNew&&T.preview===P.preview||!T.isNew&&!P.isNew&&T.id===P.id);$!==-1&&(k("removePreviewImage",P),i.value.splice($,1),k("update:images",i.value)),r.value>=i.value.length&&(r.value=Math.max(0,i.value.length-1)),i.value.length===0&&k("close")}},F=()=>{o.isUploading||k("triggerAddMorePhotos")};return(P,$)=>{var T;return t.show?(a(),l("div",ns,[e("div",ls,[e("div",is,[e("button",{onClick:A,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},$[0]||($[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",rs,B(((T=t.point)==null?void 0:T.name)||"Preview")+" ("+B(r.value+1)+"/"+B(i.value.length)+") ",1),e("div",us,[m.value&&m.value.isNew?(a(),l("button",{key:0,onClick:N,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},$[1]||($[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):y("",!0),e("button",{onClick:v,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},$[2]||($[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))])]),e("div",ds,[e("div",{class:"relative w-full max-w-full",style:ye({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"}),onTouchstart:I,onTouchmove:L,onTouchend:U},[m.value?(a(),l("img",{key:0,src:b(m.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ye({transform:`rotate(${m.value.rotation}deg)`})},null,12,cs)):y("",!0)],36),i.value.length>1?(a(),l("button",{key:0,onClick:f,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},$[3]||($[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),i.value.length>1?(a(),l("button",{key:1,onClick:s,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},$[4]||($[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0)]),e("div",ms,[e("div",gs,[m.value&&!m.value.isNew?(a(),l("button",{key:0,onClick:N,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},$[5]||($[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,vs)):(a(),l("div",ps)),t.allowMultiple&&i.value.length<t.maxFiles?(a(),l("button",{key:2,onClick:F,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},$[6]||($[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ue(" Tambah Foto ")]),8,hs)):y("",!0)]),e("div",fs,[e("button",{onClick:A,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:t.isUploading}," Batal ",8,ws),t.isUploading?(a(),l("button",ys,$[7]||($[7]=[ue(" Menyimpan"),e("span",{class:"loading-dots ml-1"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1)]))):(a(),l("button",{key:0,onClick:H,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):y("",!0)}}},xs=ge(bs,[["__scopeId","data-v-4ea64c3d"]]),ks=["accept","multiple","disabled"],$s=["disabled"],Is={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Cs={class:"text-xs text-gray-400 mt-1"},Vs={key:0,class:"flex items-center gap-4"},Ss=["src"],_s=["disabled"],Ms={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Us=["disabled"],js=["onClick"],Ts=["src"],Rs={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ns={key:0},Ds={key:1,class:"ml-1"},qs={key:2,class:"mt-1 text-xs text-red-600"},Bs={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(t,{emit:S}){const o=t,k=S,r=_(null),i=_(null),h=_(!1),d=_(!1),m=_(!1),b=_([]),v=_(0),s=_(!1),f=Z(()=>Number(o.settings.max_files)>1),I=Z(()=>o.settings.allowed_types.map(n=>`.${n}`).join(", ")),L=Z(()=>{const n=o.settings.camera_aspect_ratio.split(":");if(n.length===2){const w=parseFloat(n[0]),p=parseFloat(n[1]);if(!isNaN(w)&&!isNaN(p)&&p!==0)return w/p}return 3/4}),U=Z(()=>{const n=[],w=new Set;for(const p of b.value)p.id&&w.add(p.id),n.push(p);for(const p of o.modelValue)w.has(p.id)||n.push({...p,rotation:p.rotation||0,isNew:!1,preview:p.preview||(p.image_path?`/${p.image_path}`:null)});return n}),H=n=>n.preview||(n.image_path?`/${n.image_path}`:""),A=()=>{m.value&&(m.value=!1),h.value=!0},N=()=>{h.value=!1,r.value.click()},F=()=>{h.value=!1,d.value=!0},P=()=>{h.value=!1,U.value.length>0&&(m.value=!0)},$=()=>{d.value=!1,U.value.length>0&&(m.value=!0)},T=()=>{m.value=!1,b.value.forEach(n=>{n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview)}),b.value=[]},D=n=>new Promise(w=>{const p=new FileReader;p.onload=q=>{const M=new Image;M.onload=()=>{w({file:n,preview:URL.createObjectURL(n),rotation:0,width:M.naturalWidth,height:M.naturalHeight,isNew:!0})},M.onerror=()=>{console.error("Failed to load image for dimensions:",n.name),w({file:n,preview:URL.createObjectURL(n),rotation:0,width:0,height:0,isNew:!0})},M.src=q.target.result},p.readAsDataURL(n)}),X=n=>{const w=n.name.split(".").pop().toLowerCase();return o.settings.allowed_types.includes(w)},ee=async n=>{const p=(o.settings.max_size||2048)*1024;return new Promise(q=>{const M=new Image,x=new FileReader;x.onload=Y=>{M.onload=()=>{const R=document.createElement("canvas"),g=R.getContext("2d"),c=Math.max(M.width,M.height);R.width=c,R.height=c,g.fillStyle="white",g.fillRect(0,0,c,c);const j=(c-M.width)/2,z=(c-M.height)/2;g.drawImage(M,j,z,M.width,M.height);let G=.9;const Q=()=>{R.toBlob(te=>{if(te.size>p&&G>.1)G-=.1,Q();else{const ie=new File([te],n.name,{type:"image/jpeg",lastModified:Date.now()});q(ie)}},"image/jpeg",G)};Q()},M.src=Y.target.result},x.readAsDataURL(n)})},E=async n=>{const w=Array.from(n.target.files);if(!w.length){h.value=!1,U.value.length>0&&(m.value=!0);return}try{const p=w.filter(g=>!X(g));if(p.length>0){const g=p.map(c=>c.name.split(".").pop()).join(", ");alert(`File type not allowed: ${g}. Allowed types: ${o.settings.allowed_types.join(", ")}`),n.target.value="";return}const q=U.value.length,M=o.settings.max_files-q,x=await Promise.all(w.slice(0,M).map(async g=>await ee(g))),Y=await Promise.all(x.map(D)),R=f.value?Y:Y.slice(0,1);f.value?b.value.push(...R):(b.value.forEach(g=>{g.preview&&g.preview.startsWith("blob:")&&URL.revokeObjectURL(g.preview)}),b.value=R),h.value=!1,R.length>0?(v.value=Math.max(0,U.value.length-R.length),m.value=!0):U.value.length>0&&(m.value=!0),n.target.value=""}catch(p){console.error("Error processing selected images:",p),alert("Failed to process selected images. Please try again."),h.value=!1,U.value.length>0&&(m.value=!0)}},W=async n=>{const w=U.value.length;if(!f.value||w<o.settings.max_files)try{const p=await ee(n),q=new Image;q.onload=()=>{const M={file:p,preview:URL.createObjectURL(p),rotation:0,width:q.naturalWidth,height:q.naturalHeight,isNew:!0};f.value?b.value.push(M):(b.value.forEach(x=>{x.preview&&x.preview.startsWith("blob:")&&URL.revokeObjectURL(x.preview)}),b.value=[M]),d.value=!1,h.value=!1,v.value=U.value.length-1,m.value=!0},q.src=URL.createObjectURL(p)}catch(p){console.error("Error processing captured image:",p),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${o.settings.max_files} files allowed.`),d.value=!1,h.value=!1,U.value.length>0&&(m.value=!0)},J=(n=0)=>{v.value=n,m.value=!0},le=n=>new Promise(w=>{if(n.rotation===0||!i.value){if(!n.isNew&&!n.file){w({file:null,width:n.width,height:n.height,isOriginal:!0});return}w({file:n.file,width:n.width,height:n.height});return}const p=new Image;p.onload=async()=>{try{const q=i.value,M=q.getContext("2d"),x=p.width,Y=p.height;let R,g;n.rotation===90||n.rotation===270?(R=Y,g=x):(R=x,g=Y),q.width=R,q.height=g,M.clearRect(0,0,q.width,q.height),M.translate(q.width/2,q.height/2),M.rotate(n.rotation*Math.PI/180),M.drawImage(p,-x/2,-Y/2,x,Y),M.setTransform(1,0,0,1,0,0);const c=await new Promise(G=>{q.toBlob(G,"image/jpeg",.9)}),j=new File([c],n.file?n.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),z=await ee(j);w({file:z,width:R,height:g})}catch(q){console.error("Error processing rotated image:",q),w({file:n.file,width:n.width,height:n.height})}},p.onerror=()=>{console.error("Failed to load image for rotation processing:",n.preview),w({file:n.file,width:n.width,height:n.height})},p.src=n.preview}),V=async n=>{var q,M,x,Y;s.value=!0;const w=[],p=[];if(!o.pointId){alert("Error: Point ID is missing. Cannot upload image."),s.value=!1;return}try{for(const R of n){if(!R.isNew&&R.rotation===0&&R.id&&R.image_path){w.push({id:R.id,image_path:R.image_path,width:R.width,height:R.height,rotation:0,preview:R.preview});continue}const{file:g,width:c,height:j,isOriginal:z}=await le(R);if(z&&!R.isNew){w.push({id:R.id,image_path:R.image_path,width:R.width,height:R.height,rotation:0,preview:R.preview});continue}g&&p.push({file:g,width:c,height:j,rotation:0})}if(p.length>0){const R=new FormData;R.append("inspection_id",o.inspectionId),R.append("point_id",o.pointId),p.forEach(j=>{R.append("images[]",j.file)});const c=(await Ue.post(route("inspections.upload-image"),R,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const j of c)w.push({id:j.image_id,image_path:j.path,width:j.width||0,height:j.height||0,rotation:j.rotation||0,preview:j.public_url});p.forEach(j=>{j.file&&j.file.preview&&j.file.preview.startsWith("blob:")&&URL.revokeObjectURL(j.file.preview)})}k("update:modelValue",w),k("save",o.pointId),k("uploaded",{pointId:o.pointId,images:w}),T()}catch(R){if(console.error("Error during image processing/upload:",R),(M=(q=R.response)==null?void 0:q.data)!=null&&M.message)alert(`Failed to save images: ${R.response.data.message}`);else if((Y=(x=R.response)==null?void 0:x.data)!=null&&Y.errors){const g=Object.values(R.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${g}`)}else alert(`Failed to save images: ${R.message}`)}finally{s.value=!1}},u=n=>{if(n){if(n.id&&!n.isNew)C(n);else{const w=b.value.findIndex(p=>p.preview&&p.preview===n.preview&&p.isNew||p.id&&p.id===n.id);if(w!==-1){const p=b.value.splice(w,1)[0];p.preview&&p.preview.startsWith("blob:")&&URL.revokeObjectURL(p.preview)}k("update:modelValue",o.modelValue.filter(p=>!(p.id&&p.id===n.id)&&!(p.preview&&p.preview===n.preview)))}v.value>=U.value.length&&(v.value=Math.max(0,U.value.length-1)),U.value.length===0&&T()}},C=async n=>{var p,q;if(n.id||n.image_path)try{await Ue.delete(route("inspections.delete-image"),{data:{image_id:n.id,image_path:n.image_path}})}catch(M){console.error("Error deleting image from server:",M),(q=(p=M.response)==null?void 0:p.data)!=null&&q.message?alert(`Failed to delete image from server: ${M.response.data.message}`):alert(`Failed to delete image from server: ${M.message}`);return}n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview);const w=o.modelValue.filter(M=>M.id!==n.id);k("update:modelValue",w),b.value=b.value.filter(M=>M.isNew&&n.isNew?M.preview!==n.preview:M.id!==n.id),k("removeImage",{image:n}),m.value&&U.value.length===0?T():m.value&&v.value>=U.value.length&&(v.value=Math.max(0,U.value.length-1))};return(n,w)=>(a(),l("div",null,[e("input",{ref_key:"galleryInput",ref:r,type:"file",accept:I.value,class:"hidden",onChange:E,multiple:f.value,disabled:s.value},null,40,ks),e("canvas",{ref_key:"processingCanvas",ref:i,class:"hidden"},null,512),U.value.length===0?(a(),l("label",{key:0,onClick:A,class:ne(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:s.value},[e("div",Is,[w[2]||(w[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),w[3]||(w[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),w[4]||(w[4]=e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),e("p",Cs,"Allowed types: "+B(I.value),1)])],8,$s)):(a(),l("div",{key:1,class:ne(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[t.settings.max_files===1?(a(),l("div",Vs,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:w[0]||(w[0]=p=>J(0))},[e("img",{src:H(U.value[0]),class:"w-full h-full object-cover"},null,8,Ss)]),e("button",{onClick:w[1]||(w[1]=be(p=>C(U.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:s.value},w[5]||(w[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,_s)])):(a(),l("div",Ms,[f.value&&U.value.length<t.settings.max_files?(a(),l("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:A,disabled:s.value},w[6]||(w[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Us)):y("",!0),(a(!0),l(oe,null,ae(U.value,(p,q)=>(a(),l("div",{key:p.id||p.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:M=>J(q)},[e("img",{src:H(p),class:"w-full h-full object-cover"},null,8,Ts),p.isNew||p.rotation!==0?(a(),l("div",Rs,[p.isNew?(a(),l("span",Ns,"BARU")):y("",!0),p.rotation!==0?(a(),l("span",Ds,"ROTASI")):y("",!0)])):y("",!0)],8,js))),128))]))],2)),t.error?(a(),l("p",qs,B(t.error),1)):y("",!0),de(zt,{show:h.value,onClose:P,onOpenWebcam:F,onTriggerGallery:N},null,8,["show"]),de(as,{show:d.value,"aspect-ratio":L.value,settings:t.settings,point:t.point,onClose:$,onPhotoCaptured:W},null,8,["show","aspect-ratio","settings","point"]),de(xs,{show:m.value,images:U.value,point:t.point,"initial-index":v.value,"allow-multiple":f.value,"max-files":t.settings.max_files,"is-uploading":s.value,"aspect-ratio":L.value,onClose:T,onSaveImages:V,onRemovePreviewImage:u,onTriggerAddMorePhotos:A},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},Se=ge(Bs,[["__scopeId","data-v-396cd9aa"]]),Ls={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Ps={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},As={class:"px-4 pb-2 border-b border-gray-200"},Fs={class:"text-lg font-semibold text-gray-900"},Es={key:0,class:"text-sm text-gray-500 mt-1"},zs={class:"flex-1 overflow-y-auto p-4"},Hs={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Os={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:S}){const o=S,k=()=>{o("close")},r=i=>{i.key==="Escape"&&k()};return ke(()=>{document.addEventListener("keydown",r)}),_e(()=>{document.removeEventListener("keydown",r)}),(i,h)=>(a(),se(Ce,{name:"bottom-sheet"},{default:me(()=>[t.show?(a(),l("div",Ls,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:k}),e("div",Ps,[h[0]||(h[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",As,[e("h3",Fs,B(t.title),1),t.subtitle?(a(),l("p",Es,B(t.subtitle),1)):y("",!0)]),e("div",zs,[je(i.$slots,"default",{},void 0,!0)]),i.$slots.footer?(a(),l("div",Hs,[je(i.$slots,"footer",{},void 0,!0)])):y("",!0)])])):y("",!0)]),_:3}))}},Ne=ge(Os,[["__scopeId","data-v-7893c2dc"]]),Ws={class:"space-y-4"},Ks={key:0,class:"mt-2"},Xs={class:"text-sm font-medium text-gray-700 mb-2"},Gs={key:0,class:"text-red-500"},Zs={key:0,class:"text-xs text-red-500"},Js={key:1,class:"grid grid-cols-2 gap-2"},Ys=["name","value","checked"],Qs={key:2,class:"space-y-2"},eo={key:0,class:"text-red-500"},to={key:1,class:"text-xs text-red-500"},so={key:3,class:"mt-4"},oo={class:"text-sm font-medium text-gray-700 mb-2"},ao={key:0,class:"text-red-500"},no={key:0,class:"text-xs text-red-500"},lo={class:"flex gap-2"},io=["disabled"],Me={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(t,{emit:S}){const o=t,k=S,r=d=>k("hapus",d),i=Z(()=>o.options.find(d=>d.value===o.selectedValue)),h=Z(()=>{var m,b,v;if(o.point.input_type==="imageTOradio"&&o.imagesValue.length===0||o.options.length&&!o.selectedValue)return!1;const d=i.value;return!(o.showTextarea&&((m=d==null?void 0:d.settings)!=null&&m.show_textarea)&&(!((b=o.notesValue)!=null&&b.trim())||d.settings.min_length&&o.notesValue.length<d.settings.min_length||d.settings.max_length&&o.notesValue.length>d.settings.max_length)||o.showImageUpload&&((v=d==null?void 0:d.settings)!=null&&v.show_image_upload)&&(o.imagesValue.length===0||d.settings.max_files&&o.imagesValue.length>d.settings.max_files))});return(d,m)=>(a(),se(Ne,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:m[10]||(m[10]=b=>d.$emit("close"))},{footer:me(()=>[t.selectedPoint?(a(),l("button",{key:0,onClick:m[7]||(m[7]=b=>r(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},m[12]||(m[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ue(" Hapus Data ")]))):y("",!0),e("div",lo,[e("button",{type:"button",onClick:m[8]||(m[8]=b=>d.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:m[9]||(m[9]=b=>d.$emit("save")),disabled:!h.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,io)])]),default:me(()=>{var b,v,s,f,I,L,U,H,A,N,F,P,$,T;return[e("div",Ws,[t.point.input_type==="imageTOradio"?(a(),l("div",Ks,[e("h4",Xs,[(b=t.point.settings)!=null&&b.required?(a(),l("span",Gs,"*")):y("",!0)]),de(Se,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":m[0]||(m[0]=D=>d.$emit("update:imagesValue",D)),onSave:m[1]||(m[1]=D=>d.$emit("saveImage",D))},null,8,["model-value","point-id","point","inspection-id","settings"]),(v=t.point.settings)!=null&&v.required&&t.imagesValue.length===0?(a(),l("p",Zs," Foto wajib diupload ")):y("",!0)])):y("",!0),t.options.length?(a(),l("div",Js,[(a(!0),l(oe,null,ae(t.options,(D,X)=>(a(),l("label",{key:X,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:D.value,checked:t.selectedValue===D.value,onChange:m[2]||(m[2]=ee=>d.$emit("update:selectedValue",ee.target.value)),class:"hidden peer"},null,40,Ys),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===D.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==D.value}])},B(D.label),3)]))),128))])):y("",!0),t.showTextarea&&((f=(s=i.value)==null?void 0:s.settings)!=null&&f.show_textarea)?(a(),l("div",Qs,[(I=i.value.settings)!=null&&I.required?(a(),l("span",eo,"*")):y("",!0),de(Re,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:i.value.settings,required:(L=i.value.settings)==null?void 0:L.required,"min-length":(U=i.value.settings)==null?void 0:U.min_length,"max-length":(H=i.value.settings)==null?void 0:H.max_length,placeholder:((A=i.value.settings)==null?void 0:A.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":m[3]||(m[3]=D=>d.$emit("update:notesValue",D)),onSave:m[4]||(m[4]=D=>d.$emit("saveTextarea",D))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(N=i.value.settings)!=null&&N.required&&!t.notesValue?(a(),l("p",to," Keterangan wajib diisi ")):y("",!0)])):y("",!0),t.showImageUpload&&((P=(F=i.value)==null?void 0:F.settings)!=null&&P.show_image_upload)?(a(),l("div",so,[e("h4",oo,[m[11]||(m[11]=ue(" Upload Foto ")),($=i.value.settings)!=null&&$.required?(a(),l("span",ao,"*")):y("",!0)]),de(Se,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:i.value.settings,"onUpdate:modelValue":m[5]||(m[5]=D=>d.$emit("update:imagesValue",D)),onSave:m[6]||(m[6]=D=>d.$emit("saveImage",D))},null,8,["model-value","point-id","point","inspection-id","settings"]),(T=i.value.settings)!=null&&T.required&&t.imagesValue.length===0?(a(),l("p",no," Foto wajib diupload ")):y("",!0)])):y("",!0)])]}),_:1},8,["show","title","subtitle"]))}},ro={class:"mt-2 space-y-4"},uo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},co=["name","value","checked","onChange","required"],mo={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},go={key:0,class:"mt-3"},vo={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},po=["src"],ho={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},fo={key:1,class:"mt-2"},wo={class:"text-sm text-gray-600"},yo={key:2,class:"mt-2 text-sm text-red-600"},bo={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:S}){const o=t,k=S,r=_(o.notes),i=_([...o.images]),h=_(!1),d=_(""),m=_([]),b=_(""),v=_([]),s=Z(()=>o.options.find($=>$.value===o.modelValue)),f=$=>$.settings&&($.settings.show_textarea||$.settings.show_image_upload);re(()=>o.notes,$=>{r.value=$}),re(()=>o.images,$=>{i.value=[...$]}),re(()=>o.modelValue,$=>{$&&(b.value=$)});const I=$=>{k("update:modelValue",$.value),f($)?U():k("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:$.value,notes:"",images:[]})},L=$=>$.preview||($.image_path?`/${$.image_path}`:$),U=()=>{b.value=o.modelValue,d.value=r.value,m.value=[...i.value],v.value=[...i.value],h.value=!0},H=()=>{d.value="",m.value=[],b.value="",h.value=!1},A=$=>{m.value=$,i.value=[...$],k("update:images",[...$]),k("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:o.modelValue,notes:r.value,images:[...$]})},N=$=>{},F=()=>{b.value!==o.modelValue&&k("update:modelValue",b.value),r.value=d.value,k("update:notes",d.value),i.value=[...m.value],k("update:images",[...m.value]),k("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:b.value,notes:d.value,images:m.value}),h.value=!1},P=$=>{k("hapus",$),h.value=!1};return($,T)=>{var D,X,ee,E;return a(),l("div",ro,[e("div",uo,[(a(!0),l(oe,null,ae(t.options,(W,J)=>(a(),l("label",{key:J,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:W.value,checked:t.modelValue===W.value,onChange:le=>I(W),class:"hidden peer",required:t.required},null,40,co),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===W.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==W.value}])},B(W.label),3)]))),128))]),t.modelValue&&s.value&&f(s.value)?(a(),l("div",mo,[e("div",{class:"flex justify-between items-start"},[T[4]||(T[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:U,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((D=s.value.settings)!=null&&D.show_image_upload)?(a(),l("div",go,[e("div",vo,[(a(!0),l(oe,null,ae(t.images,(W,J)=>(a(),l("div",{key:J,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:L(W),class:"w-full h-full object-cover rounded"},null,8,po),J===3&&t.images.length>4?(a(),l("span",ho," +"+B(t.images.length-4),1)):y("",!0)]))),128))])])):y("",!0),t.notes&&((X=s.value.settings)!=null&&X.show_textarea)?(a(),l("div",fo,[e("p",wo,B(t.notes),1)])):y("",!0)])):y("",!0),h.value?(a(),se(Me,{key:(ee=t.selectedPoint)==null?void 0:ee.id,show:h.value,title:t.pointName||"Detail",subtitle:(E=s.value)==null?void 0:E.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":b.value,"notes-value":d.value,"images-value":m.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":T[0]||(T[0]=W=>b.value=W),"onUpdate:notesValue":T[1]||(T[1]=W=>d.value=W),"onUpdate:imagesValue":T[2]||(T[2]=W=>A(W)),onClose:H,onSave:F,onSaveTextarea:$.handleTextareaSave,onSaveImage:N,onHapus:T[3]||(T[3]=W=>P(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):y("",!0),t.error?(a(),l("p",yo,B(t.error),1)):y("",!0)])}}},xo={class:"mt-2 space-y-4"},ko={key:0,class:"flex flex-wrap gap-3"},$o={key:1,class:"p-4 border rounded-lg bg-gray-50"},Io={key:0,class:"mt-3"},Co={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Vo=["src"],So={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},_o={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},Mo=["name","value","checked"],Uo={key:1,class:"mt-2"},jo={class:"text-sm text-gray-600"},To={key:3,class:"mt-2 text-sm text-red-600"},Ro={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:S}){const o=t,k=S,r=_(o.notes),i=_([...o.images]),h=_(!1),d=_(""),m=_([]),b=_(""),v=_([]),s=Z(()=>o.options.find(N=>N.value===o.modelValue)),f=N=>N.preview||(N.image_path?`/${N.image_path}`:N),I=()=>{b.value=o.modelValue||"",d.value=r.value,m.value=[...i.value],v.value=[...i.value],h.value=!0},L=()=>{d.value="",m.value=[],b.value="",h.value=!1},U=N=>{m.value=N,i.value=[...N],k("update:images",[...N]),k("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:o.modelValue,notes:r.value,images:[...N]})},H=()=>{b.value!==o.modelValue&&k("update:modelValue",b.value),r.value=d.value,k("update:notes",d.value),i.value=[...m.value],k("update:images",[...m.value]),k("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:b.value,notes:d.value,images:m.value}),h.value=!1},A=N=>{k("hapus",N),h.value=!1};return(N,F)=>{var P,$,T;return a(),l("div",xo,[!t.modelValue&&i.value.length===0&&!r.value?(a(),l("div",ko,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:I},F[4]||(F[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(a(),l("div",$o,[e("div",{class:"flex justify-between items-start"},[F[5]||(F[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:I,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),i.value.length>0?(a(),l("div",Io,[e("div",Co,[(a(!0),l(oe,null,ae(i.value,(D,X)=>(a(),l("div",{key:X,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:f(D),class:"w-full h-full object-cover rounded"},null,8,Vo),X===3&&i.value.length>4?(a(),l("span",So," +"+B(i.value.length-4),1)):y("",!0)]))),128))])])):y("",!0),e("div",_o,[(a(!0),l(oe,null,ae(t.options,(D,X)=>(a(),l("label",{key:X,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:D.value,checked:t.modelValue===D.value,disabled:!0,class:"hidden peer"},null,8,Mo),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===D.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==D.value}])},B(D.label),3)]))),128))]),r.value&&((P=s.value.settings)!=null&&P.show_textarea)?(a(),l("div",Uo,[e("p",jo,B(r.value),1)])):y("",!0)])),h.value?(a(),se(Me,{key:($=t.selectedPoint)==null?void 0:$.id,show:h.value,title:t.pointName||"Detail",subtitle:(T=s.value)==null?void 0:T.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":b.value,"notes-value":d.value,"images-value":m.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":F[0]||(F[0]=D=>b.value=D),"onUpdate:notesValue":F[1]||(F[1]=D=>d.value=D),"onUpdate:imagesValue":F[2]||(F[2]=D=>U(D)),onClose:L,onSave:H,onHapus:F[3]||(F[3]=D=>A(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):y("",!0),t.error?(a(),l("p",To,B(t.error),1)):y("",!0)])}}},No={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Do={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},qo={class:"text-xl font-semibold text-indigo-700"},Bo={class:"p-4 space-y-4"},Lo={class:"flex items-start justify-between"},Po={class:"block text-sm font-medium text-gray-700"},Ao={key:0,class:"text-red-500"},Fo={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Eo={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:S}){const o=t,k=S,r=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],i=b=>{var f,I,L,U,H;const v=o.form.results[b.id],s=o.form.images[b.id];if(!v)return!1;switch(b.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!v.note;case"select":case"radio":if(!v.status)return!1;const A=(f=b.settings.radios)==null?void 0:f.find(F=>F.value===v.status);return!(A!=null&&A.settings&&(A.settings.show_textarea&&!((I=v.note)!=null&&I.trim())||A.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!v.status)return!1;const N=(L=b.settings.radios)==null?void 0:L.find(F=>F.value===v.status);return!(N!=null&&N.settings&&N.settings.show_textarea&&!((U=v.note)!=null&&U.trim()));case"image":return s.length>0;default:return!!v.status||!!((H=v.note)!=null&&H.trim())}},h=(b,v)=>{k("updateResult",{pointId:b,value:v})},d=b=>{k("saveResult",b)},m=b=>{k("hapusPoint",b)};return(b,v)=>(a(),l("div",No,[e("div",Do,[e("h2",qo,B(t.category.name),1)]),e("div",Bo,[(a(!0),l(oe,null,ae(t.category.points,s=>{var f,I,L,U,H,A,N,F,P,$,T,D,X,ee,E,W,J,le,V,u,C,n,w,p,q,M;return a(),l("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",Lo,[e("label",Po,[ue(B(s.name)+" ",1),(f=s.settings)!=null&&f.is_required?(a(),l("span",Ao,"*")):y("",!0)]),i(s)?(a(),l("span",Fo," ✓ ")):y("",!0)]),s.input_type==="text"?(a(),se(ft,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[x=>t.form.results[s.id].note=x,x=>h(s.id,x)],required:(I=s.settings)==null?void 0:I.is_required,"min-length":(L=s.settings)==null?void 0:L.min_length,"max-length":(U=s.settings)==null?void 0:U.max_length,allowSpace:(H=s.settings)==null?void 0:H.allow_space,textTransform:(A=s.settings)==null?void 0:A.text_transform,placeholder:((N=s.settings)==null?void 0:N.placeholder)||"Masukan text",error:t.form.errors[`results.${s.id}.note`],onSave:x=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):y("",!0),s.input_type==="number"?(a(),se(Le,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[x=>t.form.results[s.id].note=x,x=>h(s.id,x)],required:(F=s.settings)==null?void 0:F.is_required,min:(P=s.settings)==null?void 0:P.min,max:($=s.settings)==null?void 0:$.max,step:((T=s.settings)==null?void 0:T.step)||1,placeholder:((D=s.settings)==null?void 0:D.placeholder)||"Masukan number",error:t.form.errors[`results.${s.id}.note`],onSave:x=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):y("",!0),s.input_type==="account"?(a(),se(Ct,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[x=>t.form.results[s.id].note=x,x=>h(s.id,x)],required:(X=s.settings)==null?void 0:X.is_required,placeholder:((ee=s.settings)==null?void 0:ee.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:x=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):y("",!0),s.input_type==="date"?(a(),se(xt,{key:3,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[x=>t.form.results[s.id].note=x,x=>h(s.id,x)],required:(E=s.settings)==null?void 0:E.is_required,"min-date":(W=s.settings)==null?void 0:W.min_date,"max-date":(J=s.settings)==null?void 0:J.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:x=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):y("",!0),s.input_type==="textarea"?(a(),se(Re,{key:4,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[x=>t.form.results[s.id].note=x,x=>h(s.id,x)],required:(le=s.settings)==null?void 0:le.is_required,"min-length":(V=s.settings)==null?void 0:V.min_length,"max-length":(u=s.settings)==null?void 0:u.max_length,placeholder:((C=s.settings)==null?void 0:C.placeholder)||"Masukkan teks di sini",settings:s.settings,error:t.form.errors[`results.${s.id}.note`],onSave:x=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):y("",!0),s.input_type==="radio"?(a(),se(bo,{key:5,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[x=>t.form.results[s.id].status=x,x=>h(s.id,x)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(n=s.settings)==null?void 0:n.is_required,"point-id":s.id,point:s,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((w=s.settings)==null?void 0:w.radios)||r,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":x=>t.form.results[s.id].note=x,"onUpdate:images":x=>t.form.images[s.id]=x,onSave:x=>d(s.id),onHapus:x=>m(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="imageTOradio"?(a(),se(Ro,{key:6,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[x=>t.form.results[s.id].status=x,x=>h(s.id,x)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(p=s.settings)==null?void 0:p.is_required,"point-id":s.id,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((q=s.settings)==null?void 0:q.radios)||r,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":x=>t.form.results[s.id].note=x,"onUpdate:images":x=>t.form.images[s.id]=x,onSave:x=>d(s.id),onHapus:x=>m(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="image"?(a(),se(Se,{key:7,modelValue:t.form.images[s.id],"onUpdate:modelValue":x=>t.form.images[s.id]=x,error:t.form.errors[`images.${s.id}`],"inspection-id":t.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,"onUpdate:notes":x=>t.form.results[s.id].note=x,"onUpdate:status":x=>t.form.results[s.id].status=x},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):y("",!0),s.input_type==="select"?(a(),se(Lt,{key:8,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[x=>t.form.results[s.id].status=x,x=>h(s.id,x)],required:(M=s.settings)==null?void 0:M.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:x=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):y("",!0)])}),128))])]))}},zo=ge(Eo,[["__scopeId","data-v-54d0f511"]]),Ho={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Oo={class:"p-4 space-y-4-6"},Wo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ko=["value"],Xo={class:"p-4 space-y-4-6"},Go={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Zo=["value"],Jo={key:0,class:"p-4 space-y-4-6"},Yo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Qo=["value"],ea={class:"p-4 space-y-4-6"},ta={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(t){const S=t,o=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(f){return console.error("Error parsing settings JSON:",f),{}}return typeof s=="object"&&s!==null?s:{}},k=Z(()=>o(S.inspection.settings).conclusion||{}),r=_({flooded:k.value.flooded||"",collision:k.value.collision||"",collision_severity:k.value.collision_severity||"",conclusion_note:S.inspection.notes||""}),i=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],h=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],d=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],m=()=>{const s={flooded:r.value.flooded,collision:r.value.collision,collision_severity:r.value.collision==="yes"?r.value.collision_severity:null,conclusion_note:r.value.conclusion_note};Ve.post(route("inspections.updateConclusion",S.inspectionId),s,{preserveScroll:!0,preserveState:!0,onError:f=>{console.error("Error saving conclusion:",f)}})},b=xe.debounce(m,500);re([()=>r.value.flooded,()=>r.value.collision,()=>r.value.collision_severity],()=>{m()}),ke(()=>{v()}),re(()=>S.inspection,()=>{v()},{deep:!0});const v=()=>{const f=o(S.inspection.settings).conclusion||{};r.value={flooded:f.flooded||"",collision:f.collision||"",collision_severity:f.collision_severity||"",conclusion_note:S.inspection.notes||""}};return(s,f)=>(a(),l("div",Ho,[f[9]||(f[9]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),e("div",Oo,[f[5]||(f[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),e("div",Wo,[(a(),l(oe,null,ae(i,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":f[0]||(f[0]=L=>r.value.flooded=L),value:I.value,class:"hidden peer"},null,8,Ko),[[Ie,r.value.flooded]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.flooded===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.flooded!==I.value}])},B(I.label),3)])),64))])]),e("div",Xo,[f[7]||(f[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),e("div",Go,[(a(),l(oe,null,ae(h,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":f[1]||(f[1]=L=>r.value.collision=L),value:I.value,class:"hidden peer"},null,8,Zo),[[Ie,r.value.collision]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision!==I.value}])},B(I.label),3)])),64))]),r.value.collision==="yes"?(a(),l("div",Jo,[f[6]||(f[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),e("div",Yo,[(a(),l(oe,null,ae(d,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":f[2]||(f[2]=L=>r.value.collision_severity=L),value:I.value,class:"hidden peer"},null,8,Qo),[[Ie,r.value.collision_severity]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision_severity===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision_severity!==I.value}])},B(I.label),3)])),64))])])):y("",!0)]),e("div",ea,[f[8]||(f[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),ce(e("textarea",{"onUpdate:modelValue":f[3]||(f[3]=I=>r.value.conclusion_note=I),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:f[4]||(f[4]=(...I)=>K(b)&&K(b)(...I))},null,544),[[pe,r.value.conclusion_note]])])]))}},sa={class:"container mx-auto px-4 py-2"},oa={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},aa={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},na=["onClick"],la={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ia={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ra={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},ua={class:"relative overflow-hidden"},da={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},ca=["disabled"],ma={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ga={class:"space-y-4"},va={class:"relative"},pa={class:"max-h-64 overflow-y-auto"},ha={key:0,class:"text-center py-4 text-gray-500"},fa=["onClick"],wa={class:"font-medium text-gray-900"},ya={class:"text-sm text-gray-500"},ba={class:"text-xs text-gray-400 mt-1"},xa={key:0,class:"text-xs text-green-600 mt-1"},ka={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup(t){var R;const S=t,o=_(!1),k=_(!1),r=_(""),i=_(null),h=_(""),d=_(""),m=_([]),b=_(""),v=(g,c)=>g.filter(j=>c?I(j.id):!0),s=Z(()=>S.damagePoints||[]),f=Z(()=>{if(!r.value.trim())return s.value;const g=r.value.toLowerCase().trim();return s.value.filter(c=>{var j,z,G;return((j=c.name)==null?void 0:j.toLowerCase().includes(g))||((z=c.description)==null?void 0:z.toLowerCase().includes(g))||((G=L(c))==null?void 0:G.toLowerCase().includes(g))})}),I=g=>{var j;const c=E.results[g];return c&&(c.status||c.note||((j=c.images)==null?void 0:j.length)>0)},L=g=>{const c=S.components.find(j=>j.id===g.component_id);return c?c.name:"Komponen Tidak Diketahui"},U=g=>g&&Array.isArray(S.existingResults)?S.existingResults.find(c=>c.point_id===g):null,H=g=>{i.value=g;const c=E.results[g.id]||{};h.value=c.status||"",d.value=c.note||"",m.value=Array.isArray(c.images)?[...c.images]:[],o.value=!1,k.value=!0},A=()=>{i.value&&(E.results[i.value.id]={...E.results[i.value.id],status:h.value,note:d.value,images:Array.isArray(m.value)?[...m.value]:[]},w(i.value.id),b.value="Data berhasil disimpan!",setTimeout(()=>{b.value=""},1e3)),F()},N=()=>{o.value=!1,r.value=""},F=()=>{k.value=!1,i.value=null,h.value="",d.value="",m.value=[]},$=De().props.inspection,T=_(((R=S.appMenu[0])==null?void 0:R.id)||"conclusion"),D=_(0),X=Z(()=>T.value!=="conclusion"?S.appMenu.find(g=>g.id===T.value):null);function ee(){const g={},c={};return S.appMenu.forEach(j=>{(j.points||[]).forEach(z=>{var te;const G=Array.isArray(S.existingResults)?S.existingResults.find(ie=>ie.point_id===z.id):null;g[z.id]={status:(G==null?void 0:G.status)||"",note:(G==null?void 0:G.note)||""};const Q=((te=S.existingImages)==null?void 0:te[z.id])||[];c[z.id]=Q.map(ie=>({id:ie.id,image_path:ie.image_path,preview:`/${ie.image_path}`,rotation:ie.rotation||0,isNew:!1}))})}),{inspection_id:S.inspection.id,results:g,images:c,overall_note:S.inspection.overall_note||""}}const E=Te(ee()),W=g=>g.input_type==="damage"?!0:g.id==="conclusion"?le():g.points.every(c=>{var Q,te,ie,he,fe,we;const j=E.results[c.id],z=E.images[c.id];if(!j)return!1;const G=J(c.settings);switch(c.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((Q=j.note)!=null&&Q.trim());case"select":case"radio":if(!j.status)return!1;const O=(te=G.radios)==null?void 0:te.find($e=>$e.value===j.status);return!(O!=null&&O.settings&&(O.settings.show_textarea&&!((ie=j.note)!=null&&ie.trim())||O.settings.show_image_upload&&(z==null?void 0:z.length)===0));case"imageTOradio":if((z==null?void 0:z.length)===0||!j.status)return!1;const ve=(he=G.radios)==null?void 0:he.find($e=>$e.value===j.status);return!(ve!=null&&ve.settings&&ve.settings.show_textarea&&ve.settings.required&&!((fe=j.note)!=null&&fe.trim()));case"image":return(z==null?void 0:z.length)>0;default:return!!j.status||!!((we=j.note)!=null&&we.trim())}}),J=g=>{if(!g)return{};if(typeof g=="string")try{return JSON.parse(g)||{}}catch(c){return console.error("Error parsing settings JSON:",c),{}}return typeof g=="object"&&g!==null?g:{}},le=()=>{var te;const c=J(S.inspection.settings).conclusion||{},j=!!c.flooded,z=!!c.collision,G=c.collision==="yes"?!!c.collision_severity:!0,Q=!!((te=S.inspection.notes)!=null&&te.trim());return j&&z&&G&&Q},V=Z(()=>{const c=J(S.inspection.settings).conclusion||{};return{flooded:c.flooded||null,collision:c.collision||null,collision_severity:c.collision_severity||null,note:S.inspection.notes||null,isComplete:le()}}),u=g=>{T.value=g},C=g=>{var z;let c=D.value+g;const j=S.appMenu.length;c>=0&&c<=j&&(D.value=c,T.value=((z=S.appMenu[c])==null?void 0:z.id)||"conclusion")},n=()=>{let g=0,c=0;const j=te=>{g=te.changedTouches[0].screenX},z=te=>{c=te.changedTouches[0].screenX,G()},G=()=>{c<g-150?C(1):c>g+150&&C(-1)},Q=document.querySelector(".relative.overflow-hidden");return Q&&(Q.addEventListener("touchstart",j,!1),Q.addEventListener("touchend",z,!1)),()=>{Q&&(Q.removeEventListener("touchstart",j),Q.removeEventListener("touchend",z))}},w=xe.debounce(async g=>{try{await Ve.post(route("inspections.save-result"),{inspection_id:S.inspection.id,point_id:g,status:E.results[g].status,note:E.results[g].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(c){console.error("Error menyimpan hasil:",c)}},500),p=({pointId:g,type:c,value:j})=>{E.results[g].hasOwnProperty(c)&&(E.results[g][c]=j),w(g)},q=async g=>{if(g&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await Ve.post(route("inspections.delete-result"),{inspection_id:S.inspection.id,point_id:g},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{E.results[g]&&delete E.results[g],b.value="Data berhasil dihapus!",setTimeout(()=>{b.value=""},2e3)}})}catch(c){console.error("Error menghapus hasil:",c)}F()}},M=g=>{Object.assign(E.conclusion,g),saveConclusion()},x=()=>{if(!Y.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}E.post(route("inspections.final-submit",{id:S.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:g=>{console.error("Kesalahan pengiriman:",g)}})};re(T,g=>{const c=document.querySelector(`.flex-shrink-0[data-category-id="${g}"]`);c&&c.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const Y=Z(()=>{const g=S.appMenu.every(j=>W(j)),c=le();return g&&c});return re(r,xe.debounce(()=>{},300)),ke(()=>{n()}),(g,c)=>{var j,z,G,Q,te,ie,he,fe,we;return a(),l("div",sa,[e("div",oa,[e("div",aa,[e("button",{onClick:c[0]||(c[0]=O=>u("vehicle")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":T.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":T.value!=="vehicle"}])}," Detail Kendaraan ",2),(a(!0),l(oe,null,ae(t.appMenu,O=>(a(),l("button",{key:O.id,onClick:ve=>u(O.id),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":T.value===O.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":T.value!==O.id}])},[ue(B(O.name)+" ",1),W(O)?(a(),l("span",la," ✓ ")):y("",!0)],10,na))),128)),e("button",{onClick:c[1]||(c[1]=O=>u("conclusion")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":T.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":T.value!=="conclusion"}])},[c[7]||(c[7]=ue(" Kesimpulan ")),V.value.isComplete?(a(),l("span",ia," ✓ ")):y("",!0)],2)])]),de(Ce,{name:"fade"},{default:me(()=>[b.value?(a(),l("div",ra,B(b.value),1)):y("",!0)]),_:1}),e("div",ua,[de(Ce,{name:"category-slide",mode:"out-in"},{default:me(()=>[T.value==="vehicle"?(a(),se(gt,{key:0,inspection:K($),CarDetail:t.CarDetail,onUpdateVehicle:g.updateVehicleDetails,onSaveCarDetails:g.saveNewCarDetails},null,8,["inspection","CarDetail","onUpdateVehicle","onSaveCarDetails"])):X.value&&T.value!=="conclusion"?(a(),se(zo,{key:X.value.id,category:{...X.value,points:v(X.value.points||[],X.value.input_type==="damage")},"inspection-id":K($).id,form:K(E),onSaveResult:K(w),onUpdateResult:p,onHapusPoint:q,onRemoveImage:g.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):T.value==="conclusion"?(a(),se(ta,{key:2,form:K(E),"inspection-id":K($).id,inspection:K($),settings:K($).settings||{},onUpdateConclusion:M},null,8,["form","inspection-id","inspection","settings"])):y("",!0)]),_:1})]),T.value==="conclusion"?(a(),l("div",da,[e("button",{type:"button",onClick:x,disabled:!Y.value||K(E).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[K(E).processing?(a(),l("svg",ma,c[8]||(c[8]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),e("span",null,B(K(E).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ca)])):y("",!0),!o.value&&!k.value?(a(),l("button",{key:1,onClick:c[2]||(c[2]=O=>o.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},c[9]||(c[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):y("",!0),de(Ne,{show:o.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:N},{default:me(()=>[e("div",ga,[e("div",va,[ce(e("input",{"onUpdate:modelValue":c[3]||(c[3]=O=>r.value=O),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[pe,r.value]]),c[10]||(c[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",pa,[f.value.length===0?(a(),l("div",ha," Tidak ada point yang ditemukan ")):y("",!0),(a(!0),l(oe,null,ae(f.value,O=>(a(),l("button",{key:O.id,onClick:ve=>H(O),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",wa,B(O.name),1),e("div",ya,B(O.description),1),e("div",ba,B(L(O)),1),I(O.id)?(a(),l("div",xa," ✓ Sudah ada data ")):y("",!0)],8,fa))),128))])])]),_:1},8,["show"]),k.value?(a(),se(Me,{key:(j=i.value)==null?void 0:j.id,show:k.value,title:((z=i.value)==null?void 0:z.name)||"Detail Point",subtitle:(G=i.value)==null?void 0:G.description,name:`point-${(Q=i.value)==null?void 0:Q.id}`,"inspection-id":K($).id,"point-id":(te=i.value)==null?void 0:te.id,settings:((ie=i.value)==null?void 0:ie.settings)||{},options:((fe=(he=i.value)==null?void 0:he.settings)==null?void 0:fe.radios)||[],"selected-Point":i.value,"selected-value":h.value,"images-value":K(E).images[i.value.id],"notes-value":d.value,point:i.value,"existing-data":U((we=i.value)==null?void 0:we.id),"onUpdate:selectedValue":c[4]||(c[4]=O=>h.value=O),"onUpdate:notesValue":c[5]||(c[5]=O=>d.value=O),"onUpdate:imagesValue":c[6]||(c[6]=O=>K(E).images[i.value.id]=O),onSave:A,onClose:F,onHapus:q},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):y("",!0)])}}},Ma=ge(ka,[["__scopeId","data-v-f5189791"]]);export{Ma as default};
