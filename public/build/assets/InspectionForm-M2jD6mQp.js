import{d as b,k as x,x as D,W as f,A as K,B as N,e as p,o as c,a as i,F as j,h as A,n as w,b as P,w as X,c as q,f as _,u as m,l as $,q as G,g as I,t as k,T as H}from"./app-D_Upjxf_.js";import{l as L}from"./lodash-Cp2EK_x4.js";import{C as W}from"./CategorySection-CvJ-n9pn.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"container mx-auto px-4 py-2"},Y={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Z={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},ee=["onClick","data-category-id"],te={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ae={class:"relative overflow-hidden"},se={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},ne={class:"mb-4"},re={class:"mt-6"},oe={class:"list-disc pl-5"},ie={key:0},le={key:1},ue={class:"flex justify-end gap-4 mt-8"},ce=["disabled"],de={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},pe={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,components:Array},setup(y){var R;const s=y,l=b(((R=s.appMenu[0])==null?void 0:R.id)||"summary"),h=b(0);b(null);const v=x(()=>l.value!=="summary"?s.appMenu.find(a=>a.id===l.value):null);x(()=>s.components||[]);const o=D((()=>{const a={};return s.appMenu.forEach(t=>{(t.points||[]).forEach(e=>{var r,u;if(e.input_type!=="damage"){const n=Array.isArray(s.existingResults)?s.existingResults.find(d=>d.point_id===e.id):null;a[e.id]={status:(n==null?void 0:n.status)||"",note:(n==null?void 0:n.note)||"",images:((u=(r=s.existingImages)==null?void 0:r[e.id])==null?void 0:u.map(d=>({image_path:d.image_path,preview:null})))||[]}}})}),{inspection_id:s.inspection.id,results:a,overall_note:s.inspection.overall_note||""}})()),S=L.debounce(()=>{f.post(route("inspections.save-overall-note"),{inspection_id:s.inspection.id,overall_note:o.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:a=>{console.error("Error menyimpan catatan keseluruhan:",a)}})},800),g=a=>a.points.every(t=>{var r;if(t.input_type==="damage")return!0;const e=o.results[t.id];if(!e)return!1;switch(t.input_type){case"text":case"number":case"date":case"account":return!!e.note;case"select":case"radio":return!!e.status;case"image":return((r=e.images)==null?void 0:r.length)>0;default:return!!e.status||!!e.note}}),E=a=>{if(a==="summary")h.value=s.appMenu.length;else{const t=s.appMenu.findIndex(e=>e.id===a);t>=0&&(h.value=t)}l.value=a},M=a=>{let t=h.value+a;const e=s.appMenu.length;t>=0&&t<=e&&(h.value=t,t===e?l.value="summary":l.value=s.appMenu[t].id)},B=()=>{let a=0,t=0;const e=d=>{a=d.changedTouches[0].screenX},r=d=>{t=d.changedTouches[0].screenX,u()},u=()=>{t<a-100?M(1):t>a+100&&M(-1)},n=document.querySelector(".relative.overflow-hidden");return n&&(n.addEventListener("touchstart",e,!1),n.addEventListener("touchend",r,!1)),()=>{n&&(n.removeEventListener("touchstart",e),n.removeEventListener("touchend",r))}},C=L.debounce(async a=>{try{await f.post(route("inspections.save-result"),{inspection_id:s.inspection.id,point_id:a,status:o.results[a].status,note:o.results[a].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(t){console.error("Error menyimpan hasil:",t)}},500),F=({pointId:a,type:t,value:e})=>{o.results[a].hasOwnProperty(t)&&(o.results[a][t]=e),C(a)},U=async(a,t)=>{const e=a.target.files[0];if(!e)return;const r=URL.createObjectURL(e);try{const u=new FormData;u.append("inspection_id",s.inspection.id),u.append("point_id",t),u.append("image",e),await f.post(route("inspections.upload-image"),u,{preserveScroll:!0,onSuccess:n=>{var T;const d=((T=n.props.flash)==null?void 0:T.imagePath)||n.props.imagePath;d?o.results[t].images.push({image_path:d,preview:r}):console.error("Path gambar tidak dikembalikan dari unggahan")},onError:n=>{console.error("Error mengunggah gambar:",n),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(u){console.error("Error mengunggah gambar:",u),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{a.target.value=""}},V=async(a,t)=>{const e=o.results[a].images[t];if(e)try{await f.delete(route("inspections.delete-image"),{data:{image_path:e.image_path,point_id:a,inspection_id:s.inspection.id},preserveScroll:!0,onSuccess:()=>{o.results[a].images.splice(t,1),e.preview&&URL.revokeObjectURL(e.preview)},onError:r=>{console.error("Error menghapus gambar:",r),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(r){console.error("Error menghapus gambar:",r),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},z=()=>{o.post(route("inspections.final-submit",{inspection:s.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:a=>{console.error("Kesalahan pengiriman:",a)}})};K(()=>{B()}),N(l,a=>{const t=document.querySelector(`.flex-shrink-0[data-category-id="${a}"]`);t&&t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const O=x(()=>s.appMenu.every(a=>g(a)));return(a,t)=>(c(),p("div",Q,[i("div",Y,[i("div",Z,[(c(!0),p(j,null,A(y.appMenu,e=>(c(),p("button",{key:e.id,onClick:r=>E(e.id),class:w(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":l.value===e.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":l.value!==e.id}]),"data-category-id":e.id},[I(k(e.name)+" ",1),g(e)?(c(),p("span",te," ✓ ")):_("",!0)],10,ee))),128)),i("button",{onClick:t[0]||(t[0]=e=>E("summary")),class:w(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":l.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":l.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),i("div",ae,[P(H,{name:"category-slide",mode:"out-in"},{default:X(()=>[v.value&&l.value!=="summary"?(c(),q(W,{key:v.value.id,category:v.value,form:m(o),onSaveResult:m(C),onUpdateResult:F,onRemoveImage:V,onHandleImageUpload:t[1]||(t[1]=(e,r)=>U(e,r,v.value.name))},null,8,["category","form","onSaveResult"])):l.value==="summary"?(c(),p("div",se,[t[7]||(t[7]=i("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),i("div",ne,[t[4]||(t[4]=i("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),$(i("textarea",{id:"overall_note","onUpdate:modelValue":t[2]||(t[2]=e=>m(o).overall_note=e),onInput:t[3]||(t[3]=(...e)=>m(S)&&m(S)(...e)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[G,m(o).overall_note]])]),i("div",re,[t[5]||(t[5]=i("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Menu:",-1)),i("ul",oe,[(c(!0),p(j,null,A(y.appMenu,e=>(c(),p("li",{key:e.id,class:w({"text-green-600":g(e),"text-red-600":!g(e)})},[I(k(e.name)+" ",1),g(e)?(c(),p("span",ie,"(Selesai ✓)")):(c(),p("span",le,"(Belum Selesai ✗)"))],2))),128))])]),i("div",ue,[i("button",{type:"button",onClick:z,disabled:!O.value||m(o).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[m(o).processing?(c(),p("svg",de,t[6]||(t[6]=[i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):_("",!0),i("span",null,k(m(o).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ce)])])):_("",!0)]),_:1})])]))}},ye=J(pe,[["__scopeId","data-v-185fadf3"]]);export{ye as default};
