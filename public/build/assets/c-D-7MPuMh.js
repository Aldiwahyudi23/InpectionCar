import{x as pe,p as be,r as g,q as A,g as ve,E as fe,G as Y,H as X,j as ye,o as n,w as ke,k as he,d as a,u as r,v as xe,c as l,b as i,t as p,z as f,A as C,F as V,m as N,f as ee,I as ae,C as _e,n as we,y as z}from"./vendor-g77w9U1W.js";import{l as Be}from"./lodash-CGXsUT3p.js";import{A as Ce}from"./AppLayout-BYvORzTL.js";import{_ as Se}from"./app-BGIduf-G.js";const Me={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},Ie={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},Ae={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},Te={class:"mb-6"},Pe={class:"flex items-center space-x-2"},De=["disabled"],je=["disabled"],Ke={key:0,class:"mt-2 text-sm text-red-600"},Le={key:1,class:"mt-2 text-sm text-red-600"},Ve={key:2,class:"mt-2 text-sm text-green-600"},Ne={key:3,class:"mt-2 text-sm text-yellow-600"},Ue={class:"mb-6"},$e={class:"relative"},Ee={key:0,class:"absolute right-3 top-3"},Ge={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ze={key:0},Je=["onMousedown"],He={class:"font-medium text-gray-900"},Fe={key:1,class:"p-4 text-sm text-gray-500 text-center"},qe={class:"mb-6"},Re={class:"block text-sm font-medium text-gray-700 mb-2",for:"category"},We=["value"],Ze={class:"mb-6 flex items-center justify-between"},Oe={class:"relative inline-flex items-center cursor-pointer"},Qe=["disabled"],Ye={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Xe={key:0,class:"mb-6"},ea=["value"],aa={class:"mt-6 flex justify-end"},ta=["disabled"],oa={key:2,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},sa={key:0,class:"mb-4"},na=["innerHTML"],la={key:1},ra={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ia=["onClick"],ua=["src","alt"],da={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},ca={class:"text-white text-xs text-center"},ga={key:2,class:"text-center py-4 text-gray-500 text-sm"},ma={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},pa=["src","alt"],ba={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},va={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},fa={__name:"c",props:{CarDetail:Array,Category:Array,team:Array,inspection:Array,activeInspections:Boolean},setup(J){const T=J,s=pe({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null,inspector_id:null}),P=be(),w=P.props.global.user,H=P.props.global.region,y=P.props.global.has_roles;P.props.global.permissions;const m=g(""),h=g(""),S=g(""),v=g(""),B=g(!1),U=g(!1),D=g([]),x=g(null),u=g([]),j=g(""),M=g(""),k=g(!0),K=g(""),L=g(!1),b=g(0),F=A(()=>T.activeInspections),te=()=>{const t=`${m.value}${h.value}${S.value}`.toUpperCase();s.plate_number=t},$={BL:"Aceh",BB:"Tapanuli (Sumatera Utara)",BK:"Medan, Deli Serdang, Binjai (Sumatera Utara)",BA:"Sumatera Barat",BM:"Riau",BH:"Jambi",BD:"Bengkulu",BG:"Sumatera Selatan",BN:"Bangka Belitung",BE:"Lampung",A:"Banten (Serang, Pandeglang, Cilegon, Lebak)",B:"Jakarta, Depok, Tangerang, Bekasi (Jadetabek)",D:"Bandung, Cimahi",E:"Cirebon, Indramayu, Majalengka, Kuningan",F:"Bogor, Sukabumi, Cianjur",T:"Karawang, Purwakarta, Subang, Bekasi Kabupaten, sebagian Cikampek",Z:"Garut, Tasikmalaya, Ciamis, Banjar, Sumedang",G:"Pekalongan, Tegal, Brebes, Pemalang, Batang",H:"Semarang, Kendal, Salatiga, Demak",K:"Pati, Kudus, Rembang, Blora, Jepara",R:"Banyumas, Cilacap, Purbalingga, Banjarnegara",AA:"Magelang, Temanggung, Purworejo, Wonosobo",AB:"DI Yogyakarta (Sleman, Bantul, Gunungkidul, Kulonprogo, Kota Jogja)",AD:"Surakarta (Solo), Sragen, Boyolali, Klaten, Wonogiri, Sukoharjo, Karanganyar",L:"Surabaya",M:"Madura (Bangkalan, Sampang, Pamekasan, Sumenep)",N:"Malang, Pasuruan, Probolinggo, Lumajang, Batu",P:"Jember, Banyuwangi, Bondowoso, Situbondo",S:"Bojonegoro, Lamongan, Tuban, Mojokerto, Jombang",W:"Sidoarjo, Gresik",AE:"Madiun, Magetan, Ngawi, Ponorogo, Pacitan",AG:"Kediri, Blitar, Tulungagung, Trenggalek",DK:"Bali",DR:"Lombok (NTB)",EA:"Sumbawa, Dompu, Bima (NTB)",DH:"Nusa Tenggara Timur (Kupang, Timor)",EB:"Flores, Lembata",ED:"Sumba",DA:"Kalimantan Selatan (Banjarmasin, Banjarbaru, dll.)",KB:"Kalimantan Barat (Pontianak, Singkawang, dll.)",KH:"Kalimantan Tengah (Palangkaraya, Sampit, dll.)",KT:"Kalimantan Timur (Balikpapan, Samarinda, Bontang, dll.)",KU:"Kalimantan Utara (Tarakan, Nunukan, Malinau, Tana Tidung, Bulungan)",DB:"Sulawesi Utara (Manado, Bitung, Minahasa, dll.)",DL:"Sangihe, Talaud (Sulut)",DM:"Gorontalo",DN:"Sulawesi Tengah (Palu, Poso, Banggai, dll.)",DT:"Sulawesi Tenggara (Kendari, Bau-bau, Kolaka, dll.)",DD:"Sulawesi Selatan (Makassar, Gowa, Bone, dll.)",DC:"Polewali Mandar, Majene, Mamasa (Sulbar)",DW:"Mamuju, Pasangkayu, Mamuju Tengah (Sulbar)",DE:"Maluku (Ambon, Maluku Tengah, dll.)",DG:"Maluku Utara (Ternate, Halmahera, dll.)",PA:"Papua (Jayapura, Merauke, dll.)",PB:"Papua Barat (Manokwari, Sorong, Fakfak, dll.)"},E=t=>{t==="area"?m.value=m.value.toUpperCase().replace(/[^A-Z]/g,""):t==="number"?h.value=h.value.replace(/[^0-9]/g,""):t==="suffix"&&(S.value=S.value.toUpperCase().replace(/[^A-Z]/g,"")),te(),oe()},oe=()=>{m.value&&$[m.value]?(M.value=`âœ… ${m.value} = ${$[m.value]}`,k.value=!1):m.value&&!$[m.value]?(M.value=`ðŸš« Kode wilayah "${m.value}" tidak valid`,k.value=!0):(M.value="âš  Masukkan kode wilayah (contoh: D, B, DK)",k.value=!0)},se=A(()=>m.value.trim().length>0&&h.value.trim().length>0),ne=A(()=>{const t=m.value.trim().length>=1,e=h.value.trim().length>=1;return!(!(t&&e)||!s.plate_number.trim()||!s.category_id||!s.car_id&&!v.value.trim()||s.is_scheduled&&(!s.scheduled_at_date||!s.scheduled_at_time)||(y.includes("Admin")||y.includes("coordinator"))&&!s.inspector_id)}),le=A(()=>s.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),re=A(()=>{const t=T.team.filter(o=>o.status==="active"),e=y.includes("Admin"),d=y.includes("coordinator");if(e)return t;if(d){const o=H.id;return t.filter(c=>c.region_id===o)}return[]}),I=t=>{var d,o,c;if(!t)return"";const e=[];return(d=t.brand)!=null&&d.name&&e.push(t.brand.name),(o=t.model)!=null&&o.name&&e.push(t.model.name),(c=t.type)!=null&&c.name&&e.push(t.type.name),t.cc&&e.push((t.cc/1e3).toFixed(1)),t.transmission&&e.push(t.transmission),t.year&&e.push(t.year.toString()),t.fuel_type&&e.push(t.fuel_type),t.production_period&&e.push(`(${t.production_period})`),e.join(" ")},q=Be.debounce(()=>{if(!v.value.trim()){D.value=[],B.value=!1;return}U.value=!0;const t=v.value.toLowerCase().trim();D.value=T.CarDetail.filter(e=>I(e).toLowerCase().includes(t)),B.value=!0,U.value=!1},300),ie=()=>{setTimeout(()=>{B.value=!1},200)},R=async t=>{x.value=t,v.value=I(t),s.car_id=t.id,s.car_name=I(t),B.value=!1,await ue(t.id)},ue=async t=>{try{const e=await fetch(`/api/cars/${t}/images`);if(e.ok){const d=await e.json();u.value=Array.isArray(d)?d:[]}else u.value=[]}catch(e){console.error("Error loading car images:",e),u.value=[]}},W=t=>!t||!t.file_path?"":`/storage/${t.file_path}`,de=t=>{b.value=t,L.value=!0,document.body.style.overflow="hidden"},G=()=>{L.value=!1,document.body.style.overflow=""},Z=()=>{b.value=(b.value+1)%u.value.length},O=()=>{b.value=(b.value-1+u.value.length)%u.value.length},Q=t=>{if(L.value)switch(t.key){case"Escape":G();break;case"ArrowRight":Z();break;case"ArrowLeft":O();break}};ve(()=>{window.addEventListener("keydown",Q)}),fe(()=>{window.removeEventListener("keydown",Q)}),Y(v,t=>{(!x.value||I(x.value)!==t)&&(s.car_id=null,s.car_name=t,x.value=null,u.value=[])}),X(()=>{const t=y.includes("Admin")||y.includes("coordinator");s.inspector_id=(w==null?void 0:w.id)||null}),X(()=>{F.value&&(s.is_scheduled=!0)}),Y(()=>s.plate_number,t=>{if(j.value="",k.value=!1,K.value="",s.car_id=null,s.car_name="",v.value="",t.length>=3){const e=T.inspection.filter(d=>d.plate_number===t);if(e.length>0){const d=["draft","in_progress","pending","pending_review","revision"],o=e.find(c=>d.includes(c.status));if(o)k.value=!0,j.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${o.status.replace(/_/g," ").toUpperCase()}. Silakan selesaikan inspeksi tersebut terlebih dahulu.`;else{const c=e.filter(_=>["approved","rejected","completed","cancelled"].includes(_.status));if(c.length>0){c.sort((ge,me)=>new Date(me.created_at)-new Date(ge.created_at));const _=c[0];s.car_id=_.car_id,s.car_name=_.car_name,v.value=_.car_name,R(_.car),K.value=`Nomor plat ini sudah pernah diperiksa ${c.length} kali sebelumnya.`}}}}});const ce=()=>{s.plate_number,s.car_id,s.car_name,s.category_id,s.is_scheduled,s.inspector_id,s.is_scheduled&&`${s.scheduled_at_date}${s.scheduled_at_time}`,s.post(route("inspections.store"),{preserveScroll:!0,onSuccess:t=>{},onError:()=>{}})};return(t,e)=>(n(),ye(Ce,{title:"Buat Inspeksi Baru"},{default:ke(()=>{var d;return[he(r(xe),{title:"Inspek Baru"}),a("div",Me,[a("div",Ie,[e[31]||(e[31]=a("div",{class:"mb-4"},[a("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),a("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),r(s).errors.form_error?(n(),l("div",Ae,p(r(s).errors.form_error),1)):i("",!0),a("div",Te,[e[15]||(e[15]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),a("div",Pe,[f(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),type:"text",placeholder:"D",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[1]||(e[1]=o=>E("area")),maxlength:"2"},null,544),[[C,m.value]]),f(a("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[3]||(e[3]=o=>E("number")),disabled:k.value,maxlength:"4"},null,40,De),[[C,h.value]]),f(a("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>S.value=o),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[5]||(e[5]=o=>E("suffix")),disabled:k.value,maxlength:"3"},null,40,je),[[C,S.value]])]),M.value?(n(),l("div",Ke,p(M.value),1)):i("",!0),j.value?(n(),l("div",Le,p(j.value),1)):i("",!0),K.value?(n(),l("div",Ve,p(K.value),1)):i("",!0),se.value?i("",!0):(n(),l("div",Ne," âš  Kolom kode wilayah dan nomor plat harus diisi "))]),a("div",Ue,[e[18]||(e[18]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),a("div",$e,[f(a("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>v.value=o),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:e[7]||(e[7]=(...o)=>r(q)&&r(q)(...o)),onFocus:e[8]||(e[8]=o=>B.value=!0),onBlur:ie},null,544),[[C,v.value]]),U.value?(n(),l("div",Ee,e[16]||(e[16]=[a("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):i("",!0),B.value?(n(),l("div",Ge,[D.value.length>0?(n(),l("div",ze,[(n(!0),l(V,null,N(D.value,o=>(n(),l("div",{key:o.id,class:"px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:c=>R(o)},[a("div",He,p(I(o)),1)],40,Je))),128))])):(n(),l("div",Fe,e[17]||(e[17]=[ee(" Tidak ada data mobil yang cocok. "),a("br",null,null,-1),ee(" Silakan input manual dengan format: "),a("br",null,null,-1),a("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):i("",!0)])]),a("div",qe,[a("label",Re," Kategori Inspeksi "+p(r(H).id),1),f(a("select",{id:"category","onUpdate:modelValue":e[9]||(e[9]=o=>r(s).category_id=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[19]||(e[19]=a("option",{value:"",disabled:""},"Pilih Kategori",-1)),(n(!0),l(V,null,N(J.Category,o=>(n(),l("option",{key:o.id,value:o.id},p(o.name),9,We))),128))],512),[[ae,r(s).category_id]])]),a("div",Ze,[e[21]||(e[21]=a("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),a("label",Oe,[f(a("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=o=>r(s).is_scheduled=o),id:"schedule-toggle",class:"sr-only peer",disabled:F.value},null,8,Qe),[[_e,r(s).is_scheduled]]),e[20]||(e[20]=a("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),r(s).is_scheduled?(n(),l("div",Ye,[a("div",null,[e[22]||(e[22]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),f(a("input",{type:"date",id:"schedule-date","onUpdate:modelValue":e[11]||(e[11]=o=>r(s).scheduled_at_date=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[C,r(s).scheduled_at_date]])]),a("div",null,[e[23]||(e[23]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),f(a("input",{type:"time",id:"schedule-time","onUpdate:modelValue":e[12]||(e[12]=o=>r(s).scheduled_at_time=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[C,r(s).scheduled_at_time]])]),r(y).includes("Admin")||r(y).includes("coordinator")?(n(),l("div",Xe,[e[25]||(e[25]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"inspector"}," Pilih Inspektor ",-1)),f(a("select",{id:"inspector","onUpdate:modelValue":e[13]||(e[13]=o=>r(s).inspector_id=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[24]||(e[24]=a("option",{value:"",disabled:""},"Pilih Inspektor",-1)),(n(!0),l(V,null,N(re.value,o=>(n(),l("option",{key:o.id,value:o.user.id},p(o.user.name),9,ea))),128))],512),[[ae,r(s).inspector_id]])])):i("",!0)])):i("",!0),a("div",aa,[a("button",{onClick:ce,disabled:!ne.value||r(s).processing||k.value,class:we({"px-6 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600  border border-transparent text-white hover:bg-blue-700":!r(s).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600  border-transparent text-white hover:bg-green-700":r(s).is_scheduled})},p(le.value),11,ta)]),r(s).car_id&&x.value?(n(),l("div",oa,[x.value.description?(n(),l("div",sa,[e[26]||(e[26]=a("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),a("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:x.value.description},null,8,na)])):i("",!0),u.value.length>0?(n(),l("div",la,[e[27]||(e[27]=a("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),a("div",ra,[(n(!0),l(V,null,N(u.value,(o,c)=>(n(),l("div",{key:o.id||c,class:"relative group cursor-pointer",onClick:_=>de(c)},[a("img",{src:W(o),alt:o.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ua),o.note?(n(),l("div",da,[a("p",ca,p(o.note),1)])):i("",!0)],8,ia))),128))])])):(n(),l("div",ga," Tidak ada gambar tersedia untuk mobil ini "))])):i("",!0),L.value?(n(),l("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:G},[a("div",ma,[a("button",{onClick:G,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},e[28]||(e[28]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),u.value.length>1?(n(),l("button",{key:0,onClick:z(O,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[29]||(e[29]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):i("",!0),u.value.length>1?(n(),l("button",{key:1,onClick:z(Z,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[30]||(e[30]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):i("",!0),a("img",{src:W(u.value[b.value]),alt:"Car Image "+(b.value+1),class:"max-w-full max-h-full object-contain",onClick:e[14]||(e[14]=z(()=>{},["stop"]))},null,8,pa),u.value.length>1?(n(),l("div",ba,p(b.value+1)+" / "+p(u.value.length),1)):i("",!0),(d=u.value[b.value])!=null&&d.note?(n(),l("div",va,p(u.value[b.value].note),1)):i("",!0)])])):i("",!0)])])]}),_:1}))}},_a=Se(fa,[["__scopeId","data-v-3e2588a7"]]);export{_a as default};
