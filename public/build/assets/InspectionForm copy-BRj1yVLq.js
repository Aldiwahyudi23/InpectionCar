import{d as b,k as O,x as D,W as v,A as N,B as P,e as m,o as u,a as n,F as T,h as A,n as x,b as M,w as X,c as q,f as w,u as p,l as H,q as $,g as L,t as _,T as G,z as U}from"./app-DoQIzpLY.js";import{l as j}from"./lodash-GWgwOUcT.js";import{C as W}from"./CategorySection-d_sqOMCw.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"container mx-auto px-4 py-2"},Y={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Z={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},ee=["onClick","data-category-id"],te={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},se={class:"relative overflow-hidden"},ae={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},re={class:"mb-4"},oe={class:"mt-6"},ne={class:"list-disc pl-5"},ie={key:0},le={key:1},ce={class:"flex justify-end gap-4 mt-8"},ue=["disabled"],de={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},me={__name:"InspectionForm copy",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(f){var R;const r=f,l=b(((R=r.categories[0])==null?void 0:R.id)||"summary"),g=b(0);b(null);const y=O(()=>l.value!=="summary"?r.categories.find(s=>s.id===l.value):null),o=D((()=>{const s={};return r.categories.forEach(t=>{(t.points||[]).forEach(e=>{var c,i;const a=Array.isArray(r.existingResults)?r.existingResults.find(d=>d.point_id===e.id):null;s[e.id]={status:(a==null?void 0:a.status)||"",note:(a==null?void 0:a.note)||"",images:((i=(c=r.existingImages)==null?void 0:c[e.id])==null?void 0:i.map(d=>({image_path:d.image_path,preview:null})))||[]}})}),{inspection_id:r.inspection.id,results:s,overall_note:r.inspection.overall_note||""}})()),k=j.debounce(()=>{v.post(route("inspections.save-overall-note"),{inspection_id:r.inspection.id,overall_note:o.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:s=>{console.error("Error menyimpan catatan keseluruhan:",s)}})},800),h=s=>s.points.every(t=>{var a;const e=o.results[t.id];if(!e)return!1;switch(t.input_type){case"text":case"number":case"date":return!!e.note;case"select":case"radio":return!!e.status;case"image":return((a=e.images)==null?void 0:a.length)>0;default:return!!e.status||!!e.note}}),S=s=>{if(s==="summary")g.value=r.categories.length;else{const t=r.categories.findIndex(e=>e.id===s);t>=0&&(g.value=t)}l.value=s},E=s=>{let t=g.value+s;const e=r.categories.length;t>=0&&t<=e&&(g.value=t,t===e?l.value="summary":l.value=r.categories[t].id)},B=()=>{let s=0,t=0;const e=d=>{s=d.changedTouches[0].screenX},a=d=>{t=d.changedTouches[0].screenX,c()},c=()=>{t<s-100?E(1):t>s+100&&E(-1)},i=document.querySelector(".relative.overflow-hidden");return i&&(i.addEventListener("touchstart",e,!1),i.addEventListener("touchend",a,!1)),()=>{i&&(i.removeEventListener("touchstart",e),i.removeEventListener("touchend",a))}},C=j.debounce(async s=>{try{await v.post(route("inspections.save-result"),{inspection_id:r.inspection.id,point_id:s,status:o.results[s].status,note:o.results[s].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(t){console.error("Error menyimpan hasil:",t)}},500),F=({pointId:s,type:t,value:e})=>{o.results[s].hasOwnProperty(t)&&(o.results[s][t]=e),C(s)},z=async(s,t)=>{const e=s.target.files[0];if(!e)return;const a=URL.createObjectURL(e);try{const c=new FormData;c.append("inspection_id",r.inspection.id),c.append("point_id",t),c.append("image",e),await v.post(route("inspections.upload-image"),c,{preserveScroll:!0,onSuccess:i=>{var I;const d=((I=i.props.flash)==null?void 0:I.imagePath)||i.props.imagePath;d?o.results[t].images.push({image_path:d,preview:a}):console.error("Path gambar tidak dikembalikan dari unggahan, tidak dapat memperbarui UI.")},onError:i=>{console.error("Error mengunggah gambar:",i),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(c){console.error("Error mengunggah gambar:",c),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{s.target.value=""}},V=async(s,t)=>{const e=o.results[s].images[t];if(e)try{await v.delete(route("inspections.delete-image"),{data:{image_path:e.image_path,point_id:s,inspection_id:r.inspection.id},preserveScroll:!0,onSuccess:()=>{o.results[s].images.splice(t,1),e.preview&&URL.revokeObjectURL(e.preview)},onError:a=>{console.error("Error menghapus gambar:",a),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(a){console.error("Error menghapus gambar:",a),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},K=()=>{o.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{U().props.flash.success="Inspeksi berhasil dikirim!"},onError:s=>{console.error("Kesalahan pengiriman:",s),U().props.flash.error="Ada kesalahan dalam pengiriman Anda. Harap periksa semua bidang."}})};return N(()=>{B()}),P(l,s=>{const t=document.querySelector(`.flex-shrink-0[data-category-id="${s}"]`);t&&t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(s,t)=>(u(),m("div",Q,[n("div",Y,[n("div",Z,[(u(!0),m(T,null,A(f.categories,e=>(u(),m("button",{key:e.id,onClick:a=>S(e.id),class:x(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":l.value===e.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":l.value!==e.id}]),"data-category-id":e.id},[L(_(e.name)+" ",1),h(e)?(u(),m("span",te," ✓ ")):w("",!0)],10,ee))),128)),n("button",{onClick:t[0]||(t[0]=e=>S("summary")),class:x(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":l.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":l.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),n("div",se,[M(G,{name:"category-slide",mode:"out-in"},{default:X(()=>[y.value&&l.value!=="summary"?(u(),q(W,{key:y.value.id,category:y.value,form:p(o),onSaveResult:p(C),onUpdateResult:F,onRemoveImage:V,onHandleImageUpload:z},null,8,["category","form","onSaveResult"])):l.value==="summary"?(u(),m("div",ae,[t[6]||(t[6]=n("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),n("div",re,[t[3]||(t[3]=n("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),H(n("textarea",{id:"overall_note","onUpdate:modelValue":t[1]||(t[1]=e=>p(o).overall_note=e),onInput:t[2]||(t[2]=(...e)=>p(k)&&p(k)(...e)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[$,p(o).overall_note]])]),n("div",oe,[t[4]||(t[4]=n("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Kategori:",-1)),n("ul",ne,[(u(!0),m(T,null,A(f.categories,e=>(u(),m("li",{key:e.id,class:x({"text-green-600":h(e),"text-red-600":!h(e)})},[L(_(e.name)+" ",1),h(e)?(u(),m("span",ie,"(Selesai ✓)")):(u(),m("span",le,"(Belum Selesai ✗)"))],2))),128))])]),n("div",ce,[n("button",{type:"button",onClick:K,disabled:p(o).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[p(o).processing?(u(),m("svg",de,t[5]||(t[5]=[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):w("",!0),n("span",null,_(p(o).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ue)])])):w("",!0)]),_:1})])]))}},ye=J(me,[["__scopeId","data-v-471f503d"]]);export{ye as default};
