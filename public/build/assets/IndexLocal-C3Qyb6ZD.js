import{x as Nt,r as w,g as Je,q as le,E as lt,G as he,c as n,o,d as e,b as c,k as _e,z as Ne,A as Pe,n as ne,t as q,u as X,e as os,F as Me,m as Ue,f as $e,y as ot,w as qe,L as Fe,M as as,a as ut,j as Ve,l as Ut,T as it,p as ns,N as Dt,D as Lt,J as ct,B as is,O as ls,I as jt,S as rs,W as gt}from"./vendor-CwaeDJfC.js";import{l as qt}from"./lodash-DfwitXkl.js";import{_ as ds}from"./PrimaryButton-DTE9tPxx.js";import{_ as us}from"./ActionMessage-PedWn-P3.js";import{_ as Ae}from"./app-B-MDnBFq.js";import{u as Tt}from"./useDraggableButton-B7ftwxmu.js";const cs={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},gs={key:0,class:"p-4 space-y-2"},ms={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ps={class:"flex items-center space-x-2"},vs={key:0,class:"text-xs text-red-500 font-normal ml-2"},fs={key:1,class:"text-xs text-red-500 font-normal ml-2"},hs={key:2,class:"text-xs text-green-500 font-normal ml-2"},bs={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ys={class:"relative"},xs={key:0,class:"absolute right-3 top-3"},ws={key:1,class:"text-xs text-red-500 font-normal ml-2"},ks={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},$s={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Is={key:0},Cs=["onMousedown"],Ss={class:"font-medium text-gray-900"},Vs={class:"text-sm text-gray-500"},_s={key:1,class:"p-4 text-sm text-gray-500 text-center"},Ms={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Us={key:0,class:"mb-4"},Ds=["innerHTML"],js={key:1},Ts={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Ns=["onClick"],Ls=["src","alt"],qs={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Bs={class:"text-white text-xs text-center"},Fs={key:2,class:"text-center py-4 text-gray-500 text-sm"},As={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Es=["src","alt"],Rs={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},zs={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Os={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Hs={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges"],setup(t,{emit:ee}){var U,R,se,O,oe,Q;const s=t,x=ee,u=Nt({plate_number:((U=s.inspection)==null?void 0:U.plate_number)||"",car_id:((R=s.inspection)==null?void 0:R.car_id)||null,car_name:((se=s.inspection)==null?void 0:se.car_name)||""}),m=w(((O=s.inspection)==null?void 0:O.plate_number)||""),p=w(((oe=s.inspection)==null?void 0:oe.car_id)||null),r=w(((Q=s.inspection)==null?void 0:Q.car_name)||""),g=w(""),k=w(""),V=w(""),$=w(!1),F=w(""),G=w(""),b=w(u.car_name),C=w(!1),a=w(!1),_=w([]),y=w(null),D=w([]),W=w(!1),T=w(0);Je(()=>{var I,v,Z,K,A;if(te((I=s.inspection)==null?void 0:I.plate_number),(v=s.inspection)!=null&&v.car_id&&((Z=s.CarDetail)==null?void 0:Z.length)>0){const pe=s.CarDetail.find(xe=>xe.id===s.inspection.car_id);pe&&me(pe)}else!((K=s.inspection)!=null&&K.car_id)&&((A=s.inspection)!=null&&A.car_name)&&(b.value=s.inspection.car_name,u.car_id=null);window.addEventListener("keydown",d),x("update:hasUnsavedChanges",Ie.value),x("update:validation",ge.value)}),lt(()=>{window.removeEventListener("keydown",d)});const te=I=>{if(!I){g.value="",k.value="",V.value="";return}const v=I.toUpperCase().trim(),Z=v.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(Z)g.value=Z[1]||"",k.value=Z[2]||"",V.value=Z[3]||"";else{let K="area",A="",pe="",xe="";for(const we of v)K==="area"&&/[A-Z]/.test(we)?A+=we:K==="area"&&/[0-9]/.test(we)?(K="number",pe+=we):K==="number"&&/[0-9]/.test(we)?pe+=we:K==="number"&&/[A-Z]/.test(we)?(K="suffix",xe+=we):K==="suffix"&&/[A-Z]/.test(we)&&(xe+=we);g.value=A,k.value=pe,V.value=xe}Y()},Y=()=>{const I=`${g.value}${k.value}${V.value}`;u.plate_number=I,S()},N=I=>{I==="area"?g.value=g.value.toUpperCase().replace(/[^A-Z]/g,""):I==="number"?k.value=k.value.replace(/[^0-9]/g,""):I==="suffix"&&(V.value=V.value.toUpperCase().replace(/[^A-Z]/g,"")),Y()},M=le(()=>{const I=u.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(I)}),z=le(()=>!b.value||b.value.trim()===""),P=le(()=>u.plate_number.length>0&&!M.value?"Format plat nomor tidak valid.":null),ge=le(()=>{const I=!u.plate_number||u.plate_number.trim()==="",v=!b.value||b.value.trim()==="";return I||v||!M.value||$.value}),Ie=le(()=>{const I=u.plate_number!==m.value,v=u.car_id!==p.value||b.value!==r.value;return I||v}),ke=le(()=>Ie.value&&!ge.value),E=I=>{var Z,K,A;if(!I)return"";const v=[];return(Z=I.brand)!=null&&Z.name&&v.push(I.brand.name),(K=I.model)!=null&&K.name&&v.push(I.model.name),(A=I.type)!=null&&A.name&&v.push(I.type.name),I.cc&&v.push((I.cc/1e3).toFixed(1)),I.transmission&&v.push(I.transmission),I.year&&v.push(I.year.toString()),I.fuel_type&&v.push(I.fuel_type),I.production_period&&v.push(`(${I.production_period})`),v.join(" ")},H=()=>{u.car_id&&(u.car_id=null,y.value=null,D.value=[]),ie()},ie=qt.debounce(()=>{if(!b.value.trim()){_.value=[],C.value=!1;return}a.value=!0;try{const I=b.value.toLowerCase().trim();_.value=s.CarDetail.filter(v=>E(v).toLowerCase().includes(I)),C.value=!0}finally{a.value=!1}},300),re=()=>{setTimeout(()=>{C.value=!1,u.car_name=b.value,S()},200)},me=async I=>{y.value=I,b.value=E(I),u.car_id=I.id,u.car_name=E(I),C.value=!1,await ue(I.id),S(),x("update:hasUnsavedChanges",Ie.value),x("update:validation",ge.value)},de=I=>!I||!I.file_path?"":`/storage/${I.file_path}`,ue=async I=>{try{const v=await fetch(`/api/cars/${I}/images`);if(v.ok){const Z=await v.json();D.value=Array.isArray(Z)?Z:[]}else D.value=[]}catch(v){console.error("Error loading car images:",v),D.value=[]}},be=I=>{T.value=I,W.value=!0,document.body.style.overflow="hidden"},L=()=>{W.value=!1,document.body.style.overflow=""},ye=()=>{T.value=(T.value+1)%D.value.length},fe=()=>{T.value=(T.value-1+D.value.length)%D.value.length},d=I=>{if(W.value)switch(I.key){case"Escape":L();break;case"ArrowRight":ye();break;case"ArrowLeft":fe();break}},S=()=>{const I={plate_number:u.plate_number,car_id:u.car_id,car_name:u.car_name};x("update-vehicle",I)},h=()=>{s.inspection&&u.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0,onSuccess:()=>{m.value=u.plate_number,p.value=u.car_id,r.value=u.car_name,x("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:I=>{console.error("Gagal menyimpan data:",I)}})};return he([()=>u.plate_number,()=>u.car_name],I=>{F.value="",$.value=!1,G.value="";const v=I[0];if(v&&v.length>=6){const Z=s.allInspections.filter(K=>{var A;return K.plate_number===v&&K.id!==((A=s.inspection)==null?void 0:A.id)});if(Z.length>0){const K=["draft","in_progress","pending","pending_review","revision"],A=Z.find(pe=>K.includes(pe.status));if(A)$.value=!0,F.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${A.status.replace(/_/g," ").toUpperCase()}.`;else{const pe=Z.filter(xe=>["approved","rejected","completed","cancelled"].includes(xe.status));if(pe.length>0){pe.sort((we,Ee)=>new Date(Ee.created_at)-new Date(we.created_at));const xe=pe[0];if(xe.car_id){const we=s.CarDetail.find(Ee=>Ee.id===xe.car_id);we&&me(we)}else xe.car_name&&(b.value=xe.car_name,u.car_name=xe.car_name,u.car_id=null);G.value=`Nomor plat ini sudah pernah diperiksa ${pe.length} kali sebelumnya.`}}}}x("update:hasUnsavedChanges",Ie.value),x("update:validation",ge.value)},{deep:!0}),(I,v)=>{var Z;return o(),n("div",cs,[v[21]||(v[21]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(o(),n("div",gs,[e("div",ms,[v[9]||(v[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),e("div",ps,[Ne(e("input",{"onUpdate:modelValue":v[0]||(v[0]=K=>g.value=K),type:"text",placeholder:"Contoh: B",class:ne(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||$.value}]),onInput:v[1]||(v[1]=K=>N("area")),maxlength:"2"},null,34),[[Pe,g.value]]),Ne(e("input",{"onUpdate:modelValue":v[2]||(v[2]=K=>k.value=K),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:ne(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||$.value}]),onInput:v[3]||(v[3]=K=>N("number")),maxlength:"4"},null,34),[[Pe,k.value]]),Ne(e("input",{"onUpdate:modelValue":v[4]||(v[4]=K=>V.value=K),type:"text",placeholder:"ABC",class:ne(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||$.value}]),onInput:v[5]||(v[5]=K=>N("suffix")),maxlength:"3"},null,34),[[Pe,V.value]])]),P.value?(o(),n("span",vs,q(P.value),1)):c("",!0),F.value?(o(),n("span",fs,q(F.value),1)):c("",!0),G.value?(o(),n("span",hs,q(G.value),1)):c("",!0)]),e("div",bs,[v[13]||(v[13]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",ys,[Ne(e("input",{"onUpdate:modelValue":v[6]||(v[6]=K=>b.value=K),type:"text",placeholder:"Cari atau ketik nama mobil...",class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":z.value}]),onInput:H,onFocus:v[7]||(v[7]=K=>C.value=!0),onBlur:re},null,34),[[Pe,b.value]]),a.value?(o(),n("div",xs,v[10]||(v[10]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),z.value?(o(),n("span",ws,"Nama mobil tidak boleh kosong.")):c("",!0),!X(u).car_id&&b.value?(o(),n("div",ks,v[11]||(v[11]=[os('<div class="flex items-start" data-v-1fd1424d><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-1fd1424d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-1fd1424d></path></svg><div data-v-1fd1424d><p class="text-yellow-800 font-medium mb-1" data-v-1fd1424d>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-1fd1424d> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-1fd1424d>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-1fd1424d> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-1fd1424d> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-1fd1424d>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-1fd1424d>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):c("",!0),C.value?(o(),n("div",$s,[_.value.length>0?(o(),n("div",Is,[(o(!0),n(Me,null,Ue(_.value,K=>(o(),n("div",{key:K.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:A=>me(K)},[e("div",Ss,q(E(K)),1),e("div",Vs,q(K.year)+" • "+q(K.cc)+"cc • "+q(K.transmission)+" • "+q(K.fuel_type),1)],40,Cs))),128))])):(o(),n("div",_s,v[12]||(v[12]=[$e(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),$e(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),X(u).car_id&&y.value?(o(),n("div",Ms,[y.value.description?(o(),n("div",Us,[v[14]||(v[14]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:y.value.description},null,8,Ds)])):c("",!0),D.value.length>0?(o(),n("div",js,[v[15]||(v[15]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",Ts,[(o(!0),n(Me,null,Ue(D.value,(K,A)=>(o(),n("div",{key:K.id||A,class:"relative group cursor-pointer",onClick:pe=>be(A)},[e("img",{src:de(K),alt:K.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ls),K.note?(o(),n("div",qs,[e("p",Bs,q(K.note),1)])):c("",!0)],8,Ns))),128))])])):(o(),n("div",Fs," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),W.value?(o(),n("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:L},[e("div",As,[e("button",{onClick:L,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},v[16]||(v[16]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),D.value.length>1?(o(),n("button",{key:0,onClick:ot(fe,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},v[17]||(v[17]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),D.value.length>1?(o(),n("button",{key:1,onClick:ot(ye,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},v[18]||(v[18]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),e("img",{src:de(D.value[T.value]),alt:"Car Image "+(T.value+1),class:"max-w-full max-h-full object-contain",onClick:v[8]||(v[8]=ot(()=>{},["stop"]))},null,8,Es),D.value.length>1?(o(),n("div",Rs,q(T.value+1)+" / "+q(D.value.length),1)):c("",!0),(Z=D.value[T.value])!=null&&Z.note?(o(),n("div",zs,q(D.value[T.value].note),1)):c("",!0)])])):c("",!0),_e(ds,{type:"button",onClick:h,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!ke.value},{default:qe(()=>[X(u).processing?(o(),n("svg",Os,v[19]||(v[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,q(X(u).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),_e(us,{on:X(u).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:qe(()=>v[20]||(v[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),$e(" Tersimpan. ")])),_:1,__:[20]},8,["on"])]),_:1},8,["disabled"])])):c("",!0)])}}},Ks=Ae(Hs,[["__scopeId","data-v-1fd1424d"]]),Ws={class:"mt-1"},Zs=["value","required","minlength","maxlength","allowSpace","placeholder"],Gs={key:0,class:"mt-2 text-sm text-red-600"},Bt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:ee}){const s=t,x=ee,u=le(()=>{if(!s.modelValue)return"";let p=s.modelValue;switch(s.allowSpace||(p=p.replace(/\s+/g,"")),s.textTransform){case"uppercase":return p.toUpperCase();case"lowercase":return p.toLowerCase();case"capitalize":return p.replace(/\b\w/g,r=>r.toUpperCase());default:return p}}),m=p=>{let r=p.target.value;switch(s.allowSpace||(r=r.replace(/\s+/g,"")),s.textTransform){case"uppercase":r=r.toUpperCase();break;case"lowercase":r=r.toLowerCase();break;case"capitalize":r=r.replace(/\b\w/g,g=>g.toUpperCase());break}x("update:modelValue",r),x("save",s.pointId)};return(p,r)=>(o(),n("div",Ws,[e("input",{value:u.value,onInput:m,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,Zs),t.error?(o(),n("p",Gs,q(t.error),1)):c("",!0)]))}},Ps={class:"mt-1"},Js=["value","required","min","max","step","placeholder"],Xs={key:0,class:"mt-2 text-sm text-red-600"},Ft={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:ee}){const s=t,x=ee,u=m=>{const p=m.target.value;x("update:modelValue",p),x("save",s.pointId)};return(m,p)=>(o(),n("div",Ps,[e("input",{value:t.modelValue,onInput:u,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Js),t.error?(o(),n("p",Xs,q(t.error),1)):c("",!0)]))}},Ys={class:"mt-1"},Qs=["value","required","min","max"],eo={key:0,class:"mt-2 text-sm text-red-600"},At={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:ee}){const s=t,x=ee,u=m=>{x("update:modelValue",m.target.value),x("save",s.pointId)};return(m,p)=>(o(),n("div",Ys,[e("input",{value:t.modelValue,onChange:u,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Qs),t.error?(o(),n("p",eo,q(t.error),1)):c("",!0)]))}},to={class:"mt-1"},so=["value","required","placeholder"],oo={key:0,class:"mt-2 text-sm text-red-600"},Et={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:ee}){const s=t,x=ee,u=w(""),m=le(()=>{var V,$,F,G;return{currency_symbol:((V=s.settings)==null?void 0:V.currency_symbol)||"Rp",thousands_separator:(($=s.settings)==null?void 0:$.thousands_separator)||",",min_value:((F=s.settings)==null?void 0:F.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((G=s.settings)==null?void 0:G.max_value)!==void 0?Number(s.settings.max_value):1e9}}),p=V=>{if(V==null||V==="")return"";const $=Number(V);if(isNaN($))return"";let F=$.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return m.value.thousands_separator!==","&&(F=F.replace(/,/g,m.value.thousands_separator)),F},r=V=>V?V.replace(/[^\d]/g,""):"",g=le(()=>u.value?`${m.value.currency_symbol} ${p(u.value)}`:""),k=V=>{let $=r(V.target.value),F=Number($);m.value.min_value!==void 0&&F<m.value.min_value&&($=m.value.min_value.toString()),m.value.max_value!==void 0&&F>m.value.max_value&&($=m.value.max_value.toString()),u.value=$,x("update:modelValue",$),x("save",s.pointId)};return he(()=>s.modelValue,V=>{V!=null&&(u.value=V.toString())},{immediate:!0}),(V,$)=>(o(),n("div",to,[e("input",{value:g.value,onInput:k,type:"text",required:t.required,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,so),t.error?(o(),n("p",oo,q(t.error),1)):c("",!0)]))}},ao={class:"mt-1 space-y-3"},no={key:0,class:"space-y-2"},io={class:"flex flex-wrap gap-2"},lo=["onClick"],ro=["value","required","minlength","maxlength","placeholder"],uo={class:"flex justify-between items-center mt-1"},co={class:"text-xs text-gray-500"},go={key:0,class:"text-xs text-red-600"},Rt={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:ee}){const s=t,x=ee,u=w([]),m=w(""),p=V=>u.value.some($=>$.value===V),r=V=>{p(V.value)?u.value=u.value.filter(b=>b.value!==V.value):u.value.push(V);const F=[...u.value.map(b=>b.value)];m.value.trim()&&F.push(m.value.trim());const G=F.join(", ");x("update:modelValue",G),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:G})},g=V=>{const $=V.target.value;x("update:modelValue",$),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:$}),k($)},k=V=>{var b,C,a,_;if(!V){u.value=[],m.value="";return}const $=V.split(",").map(y=>y.trim()).filter(y=>y),F=((C=(b=s.settings)==null?void 0:b.damage_options)==null?void 0:C.map(y=>y.value))||[];u.value=((_=(a=s.settings)==null?void 0:a.damage_options)==null?void 0:_.filter(y=>$.includes(y.value)))||[];const G=$.filter(y=>!F.includes(y));m.value=G.join(", ")};return he(()=>s.modelValue,V=>{V!=null&&k(V)},{immediate:!0}),(V,$)=>{var F,G,b;return o(),n("div",ao,[(F=t.settings)!=null&&F.enable_damage&&((G=t.settings)!=null&&G.damage_options)?(o(),n("div",no,[$[0]||($[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",io,[(o(!0),n(Me,null,Ue(t.settings.damage_options,(C,a)=>(o(),n("button",{key:a,type:"button",onClick:_=>r(C),class:ne(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":p(C.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!p(C.value)}])},q(C.label),11,lo))),128))])])):c("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:g,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,ro),e("div",uo,[e("span",co,q(((b=t.modelValue)==null?void 0:b.length)||0)+"/"+q(t.maxLength||400),1),t.error?(o(),n("p",go,q(t.error),1)):c("",!0)])])])}}},mo={class:"mt-1"},po=["value","required"],vo={key:0,class:"mt-2 text-sm text-red-600"},fo={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:ee}){const s=t,x=ee,u=m=>{x("update:modelValue",m.target.value),x("save",s.pointId)};return(m,p)=>(o(),n("div",mo,[e("select",{value:t.modelValue,onChange:u,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},p[0]||(p[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,po),t.error?(o(),n("p",vo,q(t.error),1)):c("",!0)]))}},ho=Ae(fo,[["__scopeId","data-v-1b6c0201"]]),bo={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},yo={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},xo={class:"text-xs text-gray-500 mt-2 text-center"},wo={class:"flex flex-row space-x-4 mb-6"},ko={class:"mt-4 text-right"},$o={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(ee,s)=>t.show?(o(),n("div",bo,[e("div",yo,[s[7]||(s[7]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),e("p",xo,[s[3]||(s[3]=$e("Ambil Foto Maksimal: ")),e("b",null,q(t.settings.max_files),1),s[4]||(s[4]=$e(" Dengan Rasio & Ukuran: ")),e("b",null,q(t.settings.camera_aspect_ratio),1)]),e("div",wo,[e("button",{onClick:s[0]||(s[0]=x=>ee.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:s[1]||(s[1]=x=>ee.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",ko,[e("button",{onClick:s[2]||(s[2]=x=>ee.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):c("",!0)}},Io={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Co={class:"webcam-content-box"},So={class:"webcam-header"},Vo={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},_o={class:"inspection-point-name"},Mo={key:0,class:"screen-flash-overlay"},Uo={key:2,class:"zoom-controls"},Do=["max"],jo={class:"webcam-footer"},To={class:"camera-controls"},No=["disabled"],Lo={class:"camera-icon-container"},qo={key:0,class:"camera-spinner"},Bo={key:1,class:"camera-body"},Fo={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:ee}){const s=t,x=ee,u=w(null),m=w(null);let p=null,r=null;const g=w("environment"),k=w(!1),V=w(!1),$=w(!1),F=w(!1),G=w(!1),b=w({}),C=w(!1),a=w(1),_=w(1),y=w(!1),D=le(()=>{var E;return((E=s.settings)==null?void 0:E.max_size)||2048}),W=le(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),T=le(()=>{if(!s.aspectRatio)return{};const E=s.aspectRatio,H=E>1?80:60,ie=E>1?80/E:60*E;return{width:`${H}%`,height:`${ie}%`}}),te=async()=>{p&&p.getTracks().forEach(E=>E.stop());try{const E={facingMode:g.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};p=await navigator.mediaDevices.getUserMedia({video:E,audio:!1}),r=p.getVideoTracks()[0],u.value.srcObject=p,u.value.onloadedmetadata=async()=>{await N(),await u.value.play()}}catch(E){console.error("Error accessing camera: ",E),alert("Failed to access camera. Please allow camera permission."),x("close")}},Y=()=>{p&&p.getTracks().forEach(E=>E.stop()),x("close")},N=async()=>{if(r)try{const E=await navigator.mediaDevices.enumerateDevices();k.value=E.filter(ie=>ie.kind==="videoinput").length>1;const H=r.getCapabilities();H.zoom?(y.value=!0,_.value=H.zoom.max,console.log(`Zoom supported. Max zoom: ${_.value}`)):(y.value=!1,console.warn("Zoom is not supported by this camera.")),V.value=H.torch||H.fillLightMode&&H.fillLightMode.includes("torch")}catch(E){console.error("Error checking camera capabilities:",E)}},M=async E=>{if(!r)return;const H=u.value.getBoundingClientRect(),ie=E.clientX-H.left,re=E.clientY-H.top;G.value=!0,b.value={left:`${ie}px`,top:`${re}px`,transform:"translate(-50%, -50%)"};try{if(r.getCapabilities().pointsOfInterest){const de=ie/H.width,ue=re/H.height;await r.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:de,y:ue}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(me){console.warn("Manual focus failed:",me)}setTimeout(()=>{G.value=!1,r.getCapabilities().focusMode.includes("continuous")&&r.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},z=async E=>{if(!r||!y.value)return;const H=Math.min(Math.max(E,1),_.value);a.value=H;try{await r.applyConstraints({advanced:[{zoom:H}]})}catch(ie){console.error("Failed to set zoom:",ie)}},P=async()=>{if(!(!r||!V.value))try{g.value==="user"?($.value=!$.value,F.value=$.value):(await r.applyConstraints({advanced:[{torch:!$.value}]}),$.value=!$.value)}catch(E){console.error("Flash toggle failed:",E)}},ge=async()=>{k.value&&(g.value=g.value==="environment"?"user":"environment",p&&p.getTracks().forEach(E=>E.stop()),await te())},Ie=async E=>new Promise(H=>{const ie=D.value*1024;if(E.size<=ie){H(E);return}const re=new Image,me=new FileReader;me.onload=de=>{re.onload=()=>{const ue=document.createElement("canvas"),be=ue.getContext("2d"),L=Math.sqrt(ie/E.size);ue.width=re.width*L,ue.height=re.height*L,be.drawImage(re,0,0,ue.width,ue.height);let ye=.9;const fe=()=>{ue.toBlob(d=>{d.size>ie&&ye>.1?(ye-=.1,fe()):H(d)},"image/jpeg",ye)};fe()},re.src=de.target.result},me.readAsDataURL(E)}),ke=async()=>{if(!(C.value||!u.value||!m.value)){C.value=!0;try{const E=u.value,H=m.value,ie=E.videoWidth,re=E.videoHeight;let me,de,ue,be;ie/re>s.aspectRatio?(de=re,me=re*s.aspectRatio,ue=(ie-me)/2,be=0):(me=ie,de=ie/s.aspectRatio,ue=0,be=(re-de)/2),H.width=me,H.height=de,H.getContext("2d").drawImage(E,ue,be,me,de,0,0,me,de);const ye=await new Promise(d=>{H.toBlob(d,"image/jpeg",1)}),fe=await Ie(ye);if(fe){const d=new File([fe],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});x("photoCaptured",d),F.value=!0,setTimeout(()=>{F.value=!1},100)}}catch(E){console.error("Error capturing photo:",E),alert("Failed to capture photo. Please try again.")}finally{C.value=!1}}};return he(()=>s.show,E=>{E?te():Y()}),lt(()=>{p&&p.getTracks().forEach(E=>E.stop())}),(E,H)=>{var ie;return t.show?(o(),n("div",Io,[e("div",Co,[e("div",So,[e("p",Vo,q(t.settings.camera_aspect_ratio),1),e("div",_o,q(((ie=t.point)==null?void 0:ie.name)||"Camera"),1),e("button",{onClick:Y,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},H[2]||(H[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:Fe(W.value),onClick:M,onTouchstart:M},[e("video",{ref_key:"webcamVideo",ref:u,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:m,class:"hidden"},null,512),F.value?(o(),n("div",Mo)):c("",!0),e("div",{class:"aspect-ratio-guide",style:Fe(T.value)},null,4),G.value?(o(),n("div",{key:1,class:"focus-indicator",style:Fe(b.value)},H[3]||(H[3]=[e("div",{class:"focus-ring"},null,-1)]),4)):c("",!0),H[4]||(H[4]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),y.value?(o(),n("div",Uo,[Ne(e("input",{type:"range",min:"1",max:_.value,step:"0.1","onUpdate:modelValue":H[0]||(H[0]=re=>a.value=re),onInput:H[1]||(H[1]=re=>z(parseFloat(re.target.value))),class:"zoom-slider"},null,40,Do),[[Pe,a.value]])])):c("",!0)],36),e("div",jo,[e("div",To,[t.settings.enable_flash&&V.value?(o(),n("button",{key:0,onClick:P,class:ne(["control-button",{active:$.value,disabled:!V.value}])},H[5]||(H[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):c("",!0),e("button",{onClick:ke,class:"capture-button",disabled:C.value},[e("div",Lo,[C.value?(o(),n("div",qo)):(o(),n("div",Bo,H[6]||(H[6]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,No),t.settings.enable_camera_switch&&k.value?(o(),n("button",{key:1,onClick:ge,class:"control-button"},H[7]||(H[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):c("",!0)])])])])):c("",!0)}}},Ao=Ae(Fo,[["__scopeId","data-v-d307c818"]]),Eo={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Ro={class:"w-full h-full flex flex-col"},zo={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Oo=["disabled"],Ho={class:"text-lg font-semibold"},Ko={class:"flex items-center gap-2"},Wo=["disabled"],Zo=["disabled"],Go={key:0,class:"bg-blue-900 bg-opacity-50 text-white p-3"},Po={class:"flex items-center justify-between mb-2"},Jo={class:"text-xs"},Xo={class:"w-full bg-blue-700 bg-opacity-50 rounded-full h-2"},Yo={class:"text-xs mt-1 text-blue-300"},Qo={class:"flex-1 flex items-center justify-center overflow-hidden relative"},ea=["src"],ta={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},sa={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},oa=["disabled"],aa=["disabled"],na=["disabled"],ia={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},la={class:"flex justify-between items-center w-full"},ra=["disabled"],da={key:1,class:"flex-1"},ua=["disabled"],ca={class:"flex gap-3 w-full"},ga={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},ma={class:"flex items-center gap-2"},pa={key:0,class:"text-center"},va={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images","retryImage"],setup(t,{emit:ee}){const s=t,x=ee,u=w(0),m=w([]),p=le(()=>m.value.length>0?m.value[u.value]:null);he(()=>s.images,_=>{m.value=_.map(y=>({...y,rotation:y.rotation||0})),_.length===0&&s.show&&F()},{deep:!0,immediate:!0}),he(()=>s.show,_=>{_&&s.images.length>0&&(u.value=s.initialIndex)}),he(()=>s.uploadProgress,_=>{_===100&&console.log("Upload completed")});const r=_=>_.preview||(_.image_path?`/${_.image_path}`:""),g=()=>{if(p.value&&!s.isUploading){const _=(p.value.rotation+90)%360;m.value[u.value].rotation=_,x("update:images",m.value)}},k=()=>{s.isUploading||(u.value=u.value<m.value.length-1?u.value+1:0)},V=()=>{s.isUploading||(u.value=u.value>0?u.value-1:m.value.length-1)},$=()=>{s.isUploading||x("saveImages",m.value)},F=()=>{s.isUploading||x("close")},G=()=>{if(p.value&&!s.isUploading){const _=p.value,y=m.value.findIndex(D=>D.isNew&&_.isNew&&D.preview===_.preview||!D.isNew&&!_.isNew&&D.id===_.id);y!==-1&&(x("removePreviewImage",_),m.value.splice(y,1),x("update:images",m.value)),u.value>=m.value.length&&(u.value=Math.max(0,m.value.length-1)),m.value.length===0&&x("close")}},b=()=>{s.isUploading||x("triggerAddMorePhotos")},C=()=>{p.value&&!s.isUploading&&x("retryImage",p.value)},a=_=>{_.key==="Escape"&&!s.isUploading&&F()};return Je(()=>{document.addEventListener("keydown",a)}),lt(()=>{document.removeEventListener("keydown",a)}),(_,y)=>{var D;return t.show?(o(),n("div",Eo,[e("div",Ro,[e("div",zo,[e("button",{onClick:F,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},y[0]||(y[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Oo),e("div",Ho,q(((D=t.point)==null?void 0:D.name)||"Preview")+" ("+q(u.value+1)+"/"+q(m.value.length)+") ",1),e("div",Ko,[p.value&&p.value.isNew?(o(),n("button",{key:0,onClick:G,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:t.isUploading},y[1]||(y[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,Wo)):c("",!0),p.value&&p.value.isNew?(o(),n("button",{key:1,onClick:g,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},y[2]||(y[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,Zo)):c("",!0)])]),t.isUploading?(o(),n("div",Go,[e("div",Po,[y[3]||(y[3]=e("span",{class:"text-sm font-medium"},"Mengupload gambar...",-1)),e("span",Jo,q(t.uploadProgress)+"%",1)]),e("div",Xo,[e("div",{class:"bg-blue-400 h-2 rounded-full transition-all duration-300",style:Fe({width:t.uploadProgress+"%"})},null,4)]),e("p",Yo,q(t.currentUpload)+"/"+q(t.totalUpload)+" gambar terupload",1)])):c("",!0),e("div",Qo,[e("div",{class:"relative w-full max-w-full",style:Fe({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"})},[p.value?(o(),n("img",{key:0,src:r(p.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Fe({transform:`rotate(${p.value.rotation}deg)`})},null,12,ea)):c("",!0),p.value&&p.value.isUploading?(o(),n("div",ta,y[4]||(y[4]=[e("div",{class:"text-center text-white"},[e("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e("p",{class:"text-sm"},"Mengupload...")],-1)]))):c("",!0),p.value&&p.value.isFailed?(o(),n("div",sa,[y[5]||(y[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),y[6]||(y[6]=e("p",{class:"text-lg font-medium mb-2"},"Upload Gagal",-1)),e("button",{onClick:C,class:"px-4 py-2 bg-white text-red-600 rounded-lg font-medium hover:bg-gray-100 transition-colors",disabled:t.isUploading}," Coba Lagi ",8,oa)])):c("",!0)],4),m.value.length>1&&!t.isUploading?(o(),n("button",{key:0,onClick:V,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},y[7]||(y[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,aa)):c("",!0),m.value.length>1&&!t.isUploading?(o(),n("button",{key:1,onClick:k,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},y[8]||(y[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,na)):c("",!0)]),e("div",ia,[e("div",la,[p.value&&!p.value.isNew?(o(),n("button",{key:0,onClick:G,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},y[9]||(y[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),$e(" Hapus Foto ")]),8,ra)):(o(),n("div",da)),t.allowMultiple&&m.value.length<t.maxFiles&&!t.isUploading?(o(),n("button",{key:2,onClick:b,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},y[10]||(y[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),$e(" Tambah Foto ")]),8,ua)):c("",!0)]),e("div",ca,[t.isUploading?(o(),n("button",ga,[e("div",ma,[y[11]||(y[11]=e("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),e("span",null,"Mengupload... "+q(t.uploadProgress)+"%",1)])])):(o(),n("button",{key:0,onClick:$,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),t.isUploading?(o(),n("div",pa,y[12]||(y[12]=[e("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):c("",!0)])])])):c("",!0)}}},fa=Ae(va,[["__scopeId","data-v-581782f4"]]),ha=["accept","multiple","disabled"],ba={class:"text-xs text-gray-500 mb-2"},ya=["disabled"],xa={class:"h-full flex flex-col items-center justify-center p-4 text-center"},wa={class:"text-xs text-gray-400 mt-1"},ka={key:0,class:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},$a={class:"flex items-center justify-between mb-2"},Ia={class:"text-xs text-blue-600"},Ca={class:"w-full bg-blue-200 rounded-full h-2"},Sa={class:"text-xs text-blue-600 mt-1"},Va={key:1,class:"flex items-center gap-4"},_a=["src"],Ma={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Ua=["disabled"],Da={key:2,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ja=["disabled"],Ta=["onClick"],Na=["src"],La={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},qa={key:0},Ba={key:1,class:"ml-1"},Fa={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Aa={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},Ea={key:2,class:"mt-1 text-xs text-red-600"},Ra={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(t,{emit:ee}){const s=t,x=ee,u=w(null),m=w(null),p=w(!1),r=w(!1),g=w(!1),k=w([]),V=w(0),$=w(!1),F=w(0),G=w(0),b=w(0),C=as("imageSourceSetting",w("all")),a=`inspection-${s.inspectionId}-point-${s.pointId}-backup`,_=le(()=>Number(s.settings.max_files)>1),y=le(()=>s.settings.allowed_types.map(d=>`.${d}`).join(", ")),D=le(()=>{const d=s.settings.camera_aspect_ratio.split(":");if(d.length===2){const S=parseFloat(d[0]),h=parseFloat(d[1]);if(!isNaN(S)&&!isNaN(h)&&h!==0)return S/h}return 3/4}),W=le(()=>{const d=[],S=new Set;for(const h of s.modelValue)h.id&&S.add(h.id),d.push({...h,rotation:h.rotation||0,isNew:!1,isUploaded:!0,preview:h.preview||(h.image_path?`/${h.image_path}`:null)});for(const h of k.value)h.id&&S.add(h.id),d.push({...h,isUploading:h.isUploading||!1});return d}),T=d=>d.preview||(d.image_path?`/${d.image_path}`:""),te=()=>{g.value&&(g.value=!1),C.value==="camera"?N():C.value==="gallery"?Y():p.value=!0},Y=()=>{p.value=!1,u.value.click()},N=()=>{p.value=!1,r.value=!0},M=()=>{p.value=!1,W.value.length>0&&(g.value=!0)},z=()=>{r.value=!1,W.value.length>0&&(g.value=!0)},P=()=>{g.value=!1,$.value||(k.value.forEach(d=>{d.preview&&d.preview.startsWith("blob:")&&URL.revokeObjectURL(d.preview)}),k.value=[])},ge=d=>new Promise(S=>{const h=new FileReader;h.onload=U=>{const R=new Image;R.onload=()=>{S({file:d,preview:URL.createObjectURL(d),rotation:0,width:R.naturalWidth,height:R.naturalHeight,isNew:!0})},R.onerror=()=>{console.error("Failed to load image for dimensions:",d.name),S({file:d,preview:URL.createObjectURL(d),rotation:0,width:0,height:0,isNew:!0})},R.src=U.target.result},h.readAsDataURL(d)}),Ie=d=>{const S=d.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(S)},ke=async d=>{const h=(s.settings.max_size||2048)*1024;return new Promise(U=>{const R=new Image,se=new FileReader;se.onload=O=>{R.onload=()=>{const oe=document.createElement("canvas"),Q=oe.getContext("2d"),I=Math.max(R.width,R.height);oe.width=I,oe.height=I,Q.fillStyle="white",Q.fillRect(0,0,I,I);const v=(I-R.width)/2,Z=(I-R.height)/2;Q.drawImage(R,v,Z,R.width,R.height);let K=.9;const A=()=>{oe.toBlob(pe=>{if(pe.size>h&&K>.1)K-=.1,A();else{const xe=new File([pe],d.name,{type:"image/jpeg",lastModified:Date.now()});U(xe)}},"image/jpeg",K)};A()},R.src=O.target.result},se.readAsDataURL(d)})},E=async d=>{const S=Array.from(d.target.files);if(!S.length){p.value=!1,W.value.length>0&&(g.value=!0);return}try{const h=S.filter(Q=>!Ie(Q));if(h.length>0){const Q=h.map(I=>I.name.split(".").pop()).join(", ");alert(`File type not allowed: ${Q}. Allowed types: ${s.settings.allowed_types.join(", ")}`),d.target.value="";return}const U=W.value.length,R=s.settings.max_files-U,se=await Promise.all(S.slice(0,R).map(async Q=>await ke(Q))),O=await Promise.all(se.map(ge)),oe=_.value?O:O.slice(0,1);_.value?k.value.push(...oe):(k.value.forEach(Q=>{Q.preview&&Q.preview.startsWith("blob:")&&URL.revokeObjectURL(Q.preview)}),k.value=oe),p.value=!1,oe.length>0?(V.value=Math.max(0,W.value.length-oe.length),g.value=!0):W.value.length>0&&(g.value=!0),d.target.value=""}catch(h){console.error("Error processing selected images:",h),alert("Failed to process selected images. Please try again."),p.value=!1,W.value.length>0&&(g.value=!0)}},H=async d=>{const S=W.value.length;if(!_.value||S<s.settings.max_files)try{const h=await ke(d),U=new Image;U.onload=()=>{const R={file:h,preview:URL.createObjectURL(h),rotation:0,width:U.naturalWidth,height:U.naturalHeight,isNew:!0};_.value?k.value.push(R):(k.value.forEach(se=>{se.preview&&se.preview.startsWith("blob:")&&URL.revokeObjectURL(se.preview)}),k.value=[R]),r.value=!1,p.value=!1,V.value=W.value.length-1,g.value=!0},U.src=URL.createObjectURL(h)}catch(h){console.error("Error processing captured image:",h),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),r.value=!1,p.value=!1,W.value.length>0&&(g.value=!0)},ie=(d=0)=>{V.value=d,g.value=!0},re=d=>new Promise(S=>{if(d.rotation===0||!m.value){if(!d.isNew&&!d.file){S({file:null,width:d.width,height:d.height,isOriginal:!0});return}S({file:d.file,width:d.width,height:d.height});return}const h=new Image;h.onload=async()=>{try{const U=m.value,R=U.getContext("2d"),se=h.width,O=h.height;let oe,Q;d.rotation===90||d.rotation===270?(oe=O,Q=se):(oe=se,Q=O),U.width=oe,U.height=Q,R.clearRect(0,0,U.width,U.height),R.translate(U.width/2,U.height/2),R.rotate(d.rotation*Math.PI/180),R.drawImage(h,-se/2,-O/2,se,O),R.setTransform(1,0,0,1,0,0);const I=await new Promise(K=>{U.toBlob(K,"image/jpeg",.9)}),v=new File([I],d.file?d.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),Z=await ke(v);S({file:Z,width:oe,height:Q})}catch(U){console.error("Error processing rotated image:",U),S({file:d.file,width:d.width,height:d.height})}},h.onerror=()=>{console.error("Failed to load image for rotation processing:",d.preview),S({file:d.file,width:d.width,height:d.height})},h.src=d.preview}),me=d=>{try{const S={images:d.map(h=>{var U;return{fileName:((U=h.file)==null?void 0:U.name)||`image-${Date.now()}.jpg`,rotation:h.rotation||0,width:h.width||0,height:h.height||0,timestamp:Date.now()}}),inspectionId:s.inspectionId,pointId:s.pointId};localStorage.setItem(a,JSON.stringify(S))}catch(S){console.error("Error saving backup:",S)}},de=()=>{localStorage.removeItem(a)},ue=async d=>{$.value=!0;const S=[],h=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),$.value=!1;return}try{me(d);for(const U of d){if(!U.isNew&&U.rotation===0&&U.id&&U.image_path){S.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:0,preview:U.preview,isUploaded:!0});continue}const{file:R,width:se,height:O,isOriginal:oe}=await re(U);if(oe&&!U.isNew){S.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:U.rotation||0,preview:U.preview,isUploaded:!0});continue}R&&h.push({file:R,width:se,height:O,rotation:U.rotation||0,originalImage:U})}P(),h.length>0?await be(h,S):(x("update:modelValue",S),x("save",s.pointId))}catch(U){console.error("Error during image processing:",U),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{$.value=!1}},be=async(d,S)=>{b.value=d.length,G.value=0,F.value=0;const h=[...S];let U=0;try{for(let R=0;R<d.length;R++){const se=d[R],O=new FormData;O.append("inspection_id",s.inspectionId),O.append("point_id",s.pointId),O.append("images[]",se.file);const oe=k.value.findIndex(Q=>{var I;return Q.preview===((I=se.originalImage)==null?void 0:I.preview)});oe!==-1&&(k.value[oe].isUploading=!0,k.value[oe].isFailed=!1);try{const I=(await ut.post(route("inspections.upload-image"),O,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:v=>{if(v.total){const Z=Math.round(v.loaded*100/v.total);F.value=Math.round((R+v.loaded/v.total)/d.length*100),G.value=R+1}}})).data.images;if(I&&I.length>0){const v=I[0];if(h.push({id:v.image_id,image_path:v.path,width:v.width||se.width||0,height:v.height||se.height||0,rotation:se.rotation||0,preview:v.public_url,isUploaded:!0}),oe!==-1){const Z=k.value.splice(oe,1)[0];Z.preview&&Z.preview.startsWith("blob:")&&URL.revokeObjectURL(Z.preview)}U++}}catch(Q){console.error(`Error uploading image ${R+1}:`,Q),oe!==-1&&(k.value[oe].isUploading=!1,k.value[oe].isFailed=!0)}}U>0&&(x("update:modelValue",h),x("save",s.pointId),x("uploaded",{pointId:s.pointId,images:h,newImagesCount:U})),U===d.length&&de(),console.log(`✅ Successfully uploaded ${U}/${d.length} images`)}catch(R){console.error("Error in upload process:",R),d.forEach(se=>{const O=k.value.findIndex(oe=>{var Q;return oe.preview===((Q=se.originalImage)==null?void 0:Q.preview)});O!==-1&&(k.value[O].isUploading=!1,k.value[O].isFailed=!0)})}finally{F.value=0,G.value=0,b.value=0,$.value=!1}},L=async d=>{if(!d||!d.file){console.error("No file to retry upload");return}$.value=!0;const S=[...s.modelValue];try{const h=new FormData;h.append("inspection_id",s.inspectionId),h.append("point_id",s.pointId),h.append("images[]",d.file);const U=k.value.findIndex(O=>O.preview===d.preview);U!==-1&&(k.value[U].isUploading=!0,k.value[U].isFailed=!1);const se=(await ut.post(route("inspections.upload-image"),h,{headers:{"Content-Type":"multipart/form-data"}})).data.images;if(se&&se.length>0){const O=se[0];if(S.push({id:O.image_id,image_path:O.path,width:O.width||d.width||0,height:O.height||d.height||0,rotation:d.rotation||0,preview:O.public_url,isUploaded:!0}),U!==-1){const Q=k.value.splice(U,1)[0];Q.preview&&Q.preview.startsWith("blob:")&&URL.revokeObjectURL(Q.preview)}x("update:modelValue",S),x("save",s.pointId),x("uploaded",{pointId:s.pointId,images:S,newImagesCount:1}),k.value.some(Q=>Q.isFailed)||de(),console.log("✅ Successfully retried upload for 1 image")}}catch(h){console.error("Error retrying upload:",h),previewIndex!==-1&&(k.value[previewIndex].isUploading=!1,k.value[previewIndex].isFailed=!0)}finally{$.value=!1}},ye=d=>{if(d){if(d.id&&!d.isNew)fe(d);else{const S=k.value.findIndex(h=>h.preview&&h.preview===d.preview&&h.isNew||h.id&&h.id===d.id);if(S!==-1){const h=k.value.splice(S,1)[0];h.preview&&h.preview.startsWith("blob:")&&URL.revokeObjectURL(h.preview)}x("update:modelValue",s.modelValue.filter(h=>!(h.id&&h.id===d.id)&&!(h.preview&&h.preview===d.preview)))}V.value>=W.value.length&&(V.value=Math.max(0,W.value.length-1)),W.value.length===0&&P()}},fe=async d=>{var h,U;if(d.id||d.image_path)try{await ut.delete(route("inspections.delete-image"),{data:{image_id:d.id,image_path:d.image_path}})}catch(R){console.error("Error deleting image from server:",R),(U=(h=R.response)==null?void 0:h.data)!=null&&U.message?alert(`Failed to delete image from server: ${R.response.data.message}`):alert(`Failed to delete image from server: ${R.message}`);return}d.preview&&d.preview.startsWith("blob:")&&URL.revokeObjectURL(d.preview);const S=s.modelValue.filter(R=>R.id!==d.id);x("update:modelValue",S),k.value=k.value.filter(R=>R.isNew&&d.isNew?R.preview!==d.preview:R.id!==d.id),x("removeImage",{image:d}),g.value&&W.value.length===0?P():g.value&&V.value>=W.value.length&&(V.value=Math.max(0,W.value.length-1))};return Je(()=>{try{localStorage.getItem(a)&&console.log("Found backup images, ready for recovery if needed")}catch(d){console.error("Error loading backup:",d)}}),(d,S)=>(o(),n("div",null,[e("input",{ref_key:"galleryInput",ref:u,type:"file",accept:y.value,class:"hidden",onChange:E,multiple:_.value,disabled:$.value},null,40,ha),e("canvas",{ref_key:"processingCanvas",ref:m,class:"hidden"},null,512),e("p",ba,"Foto Maksimal: "+q(t.settings.max_files)+" | Rasio: "+q(t.settings.camera_aspect_ratio),1),W.value.length===0?(o(),n("label",{key:0,onClick:te,class:ne(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:$.value},[e("div",xa,[S[2]||(S[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),S[3]||(S[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),e("p",wa,"Tipe: "+q(y.value),1)])],8,ya)):(o(),n("div",{key:1,class:ne(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[$.value?(o(),n("div",ka,[e("div",$a,[S[4]||(S[4]=e("span",{class:"text-sm font-medium text-blue-700"},"Mengupload gambar...",-1)),e("span",Ia,q(F.value)+"%",1)]),e("div",Ca,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Fe({width:F.value+"%"})},null,4)]),e("p",Sa,q(G.value)+"/"+q(b.value)+" gambar terupload",1)])):c("",!0),t.settings.max_files===1?(o(),n("div",Va,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:S[0]||(S[0]=h=>ie(0))},[e("img",{src:T(W.value[0]),class:"w-full h-full object-cover"},null,8,_a),W.value[0].isUploading?(o(),n("div",Ma,S[5]||(S[5]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0)]),e("button",{onClick:S[1]||(S[1]=ot(h=>fe(W.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:$.value},S[6]||(S[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),$e(" Hapus Foto ")]),8,Ua)])):(o(),n("div",Da,[_.value&&W.value.length<t.settings.max_files?(o(),n("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:te,disabled:$.value},S[7]||(S[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,ja)):c("",!0),(o(!0),n(Me,null,Ue(W.value,(h,U)=>(o(),n("div",{key:h.id||h.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:R=>h.isFailed?L(h):ie(U)},[e("img",{src:T(h),class:"w-full h-full object-cover"},null,8,Na),h.isNew||h.rotation!==0?(o(),n("div",La,[h.isNew?(o(),n("span",qa,"BARU")):c("",!0),h.rotation!==0?(o(),n("span",Ba,"ROTASI")):c("",!0)])):c("",!0),h.isUploading?(o(),n("div",Fa,S[8]||(S[8]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0),h.isFailed?(o(),n("div",Aa,S[9]||(S[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),e("span",{class:"text-xs font-medium"},"Retry",-1)]))):c("",!0)],8,Ta))),128))]))],2)),t.error?(o(),n("p",Ea,q(t.error),1)):c("",!0),_e($o,{show:p.value,settings:t.settings,onClose:M,onOpenWebcam:N,onTriggerGallery:Y},null,8,["show","settings"]),_e(Ao,{show:r.value,"aspect-ratio":D.value,settings:t.settings,point:t.point,onClose:z,onPhotoCaptured:H},null,8,["show","aspect-ratio","settings","point"]),_e(fa,{show:g.value,images:W.value,point:t.point,"initial-index":V.value,"allow-multiple":_.value,"max-files":t.settings.max_files,"is-uploading":$.value,"aspect-ratio":D.value,"upload-progress":F.value,"current-upload":G.value,"total-upload":b.value,onClose:P,onSaveImages:ue,onRemovePreviewImage:ye,onTriggerAddMorePhotos:te,onRetryImage:L},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},mt=Ae(Ra,[["__scopeId","data-v-a1838a9b"]]),za={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Oa={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Ha={class:"px-4 pb-2 border-b border-gray-200"},Ka={class:"text-lg font-semibold text-gray-900"},Wa={key:0,class:"text-sm text-gray-500 mt-1"},Za={class:"flex-1 overflow-y-auto p-4"},Ga={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Pa={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:ee}){const s=ee,x=()=>{s("close")},u=m=>{m.key==="Escape"&&x()};return Je(()=>{document.addEventListener("keydown",u)}),lt(()=>{document.removeEventListener("keydown",u)}),(m,p)=>(o(),Ve(it,{name:"bottom-sheet"},{default:qe(()=>[t.show?(o(),n("div",za,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:x}),e("div",Oa,[p[0]||(p[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Ha,[e("h3",Ka,q(t.title),1),t.subtitle?(o(),n("p",Wa,q(t.subtitle),1)):c("",!0)]),e("div",Za,[Ut(m.$slots,"default",{},void 0,!0)]),m.$slots.footer?(o(),n("div",Ga,[Ut(m.$slots,"footer",{},void 0,!0)])):c("",!0)])])):c("",!0)]),_:3}))}},zt=Ae(Pa,[["__scopeId","data-v-d08f0b98"]]),Ja={class:"space-y-4"},Xa={key:0,class:"mt-2"},Ya={key:1,class:"mt-2"},Qa={key:2,class:"mt-2"},en={key:3,class:"mt-2"},tn={key:4,class:"mt-2"},sn={class:"text-sm font-medium text-gray-700 mb-2"},on={key:0,class:"text-red-500"},an={key:0,class:"text-xs text-red-500"},nn=["name","value","checked"],ln={key:6,class:"space-y-2"},rn={key:0,class:"text-red-500"},dn={key:1,class:"text-xs text-red-500"},un={key:7,class:"mt-4"},cn={class:"text-sm font-medium text-gray-700 mb-2"},gn={key:0,class:"text-red-500"},mn={key:0,class:"text-xs text-red-500"},pn={class:"flex gap-2"},vn=["disabled"],pt={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(t,{emit:ee}){const s=t,x=ee,u=r=>x("hapus",r),m=le(()=>s.options.find(r=>r.value===s.selectedValue)),p=le(()=>{var g,k,V,$,F,G,b;if(s.point.input_type==="text"&&(!((g=s.notesValue)!=null&&g.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((k=s.notesValue)!=null&&k.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((V=s.notesValue)!=null&&V.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!(($=s.notesValue)!=null&&$.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date)||s.point.input_type==="imageTOradio"&&s.imagesValue.length===0||s.options.length&&!s.selectedValue)return!1;const r=m.value;return!(s.showTextarea&&((F=r==null?void 0:r.settings)!=null&&F.show_textarea)&&(!((G=s.notesValue)!=null&&G.trim())||r.settings.min_length&&s.notesValue.length<r.settings.min_length||r.settings.max_length&&s.notesValue.length>r.settings.max_length)||s.showImageUpload&&((b=r==null?void 0:r.settings)!=null&&b.show_image_upload)&&(s.imagesValue.length===0||r.settings.max_files&&s.imagesValue.length>r.settings.max_files))});return(r,g)=>(o(),Ve(zt,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:g[18]||(g[18]=k=>r.$emit("close"))},{footer:qe(()=>[t.selectedPoint?(o(),n("button",{key:0,onClick:g[15]||(g[15]=k=>u(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},g[20]||(g[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),$e(" Hapus Data ")]))):c("",!0),e("div",pn,[e("button",{type:"button",onClick:g[16]||(g[16]=k=>r.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:g[17]||(g[17]=k=>r.$emit("save")),disabled:!p.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,vn)])]),default:qe(()=>{var k,V,$,F,G,b,C,a,_,y,D,W,T,te,Y,N,M,z,P,ge,Ie,ke,E,H,ie,re,me,de,ue,be;return[e("div",Ja,[t.point.input_type==="text"?(o(),n("div",Xa,[_e(Bt,{"model-value":t.notesValue,required:(k=t.point.settings)==null?void 0:k.is_required,"min-length":(V=t.point.settings)==null?void 0:V.min_length,"max-length":($=t.point.settings)==null?void 0:$.max_length,allowSpace:(F=t.point.settings)==null?void 0:F.allow_space,textTransform:(G=t.point.settings)==null?void 0:G.text_transform,placeholder:((b=t.point.settings)==null?void 0:b.placeholder)||"Masukan text",error:r.error,"onUpdate:modelValue":g[0]||(g[0]=L=>r.$emit("update:notesValue",L)),onSave:g[1]||(g[1]=L=>r.$emit("saveText",L))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):c("",!0),t.point.input_type==="number"?(o(),n("div",Ya,[_e(Ft,{"model-value":t.notesValue,required:(C=t.point.settings)==null?void 0:C.is_required,min:(a=t.point.settings)==null?void 0:a.min,max:(_=t.point.settings)==null?void 0:_.max,step:((y=t.point.settings)==null?void 0:y.step)||1,placeholder:((D=t.point.settings)==null?void 0:D.placeholder)||"Masukan number",error:r.error,"onUpdate:modelValue":g[2]||(g[2]=L=>r.$emit("update:notesValue",L)),onSave:g[3]||(g[3]=L=>r.$emit("saveNumber",L))},null,8,["model-value","required","min","max","step","placeholder","error"])])):c("",!0),t.point.input_type==="account"?(o(),n("div",Qa,[_e(Et,{"model-value":t.notesValue,required:(W=t.point.settings)==null?void 0:W.is_required,placeholder:((T=t.point.settings)==null?void 0:T.placeholder)||"Masukkan nilai",error:r.error,"point-id":t.pointId,settings:t.point.settings,"onUpdate:modelValue":g[4]||(g[4]=L=>r.$emit("update:notesValue",L)),onSave:g[5]||(g[5]=L=>r.$emit("saveAccount",L))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):c("",!0),t.point.input_type==="date"?(o(),n("div",en,[_e(At,{"model-value":t.notesValue,required:(te=t.point.settings)==null?void 0:te.is_required,"min-date":(Y=t.point.settings)==null?void 0:Y.min_date,"max-date":(N=t.point.settings)==null?void 0:N.max_date,error:r.error,"onUpdate:modelValue":g[6]||(g[6]=L=>r.$emit("update:notesValue",L)),onSave:g[7]||(g[7]=L=>r.$emit("saveDate",L))},null,8,["model-value","required","min-date","max-date","error"])])):c("",!0),t.point.input_type==="imageTOradio"?(o(),n("div",tn,[e("h4",sn,[(M=t.point.settings)!=null&&M.required?(o(),n("span",on,"*")):c("",!0)]),_e(mt,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point.inspection_point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":g[8]||(g[8]=L=>r.$emit("update:imagesValue",L)),onSave:g[9]||(g[9]=L=>r.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(z=t.point.settings)!=null&&z.required&&t.imagesValue.length===0?(o(),n("p",an," Foto wajib diupload ")):c("",!0)])):c("",!0),t.options.length?(o(),n("div",{key:5,class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Me,null,Ue(t.options,(L,ye)=>(o(),n("label",{key:ye,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:L.value,checked:t.selectedValue===L.value,onChange:g[10]||(g[10]=fe=>r.$emit("update:selectedValue",fe.target.value)),class:"hidden peer"},null,40,nn),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==L.value}])},q(L.label),3)]))),128))],2)):c("",!0),t.showTextarea&&((ge=(P=m.value)==null?void 0:P.settings)!=null&&ge.show_textarea)?(o(),n("div",ln,[(Ie=m.value.settings)!=null&&Ie.required?(o(),n("span",rn,"*")):c("",!0),_e(Rt,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:m.value.settings,required:(ke=m.value.settings)==null?void 0:ke.required,"min-length":(E=m.value.settings)==null?void 0:E.min_length,"max-length":(H=m.value.settings)==null?void 0:H.max_length,placeholder:((ie=m.value.settings)==null?void 0:ie.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":g[11]||(g[11]=L=>r.$emit("update:notesValue",L)),onSave:g[12]||(g[12]=L=>r.$emit("saveTextarea",L))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(re=m.value.settings)!=null&&re.required&&!t.notesValue?(o(),n("p",dn," Keterangan wajib diisi ")):c("",!0)])):c("",!0),t.showImageUpload&&((de=(me=m.value)==null?void 0:me.settings)!=null&&de.show_image_upload)?(o(),n("div",un,[e("h4",cn,[g[19]||(g[19]=$e(" Upload Foto ")),(ue=m.value.settings)!=null&&ue.required?(o(),n("span",gn,"*")):c("",!0)]),_e(mt,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:m.value.settings,"onUpdate:modelValue":g[13]||(g[13]=L=>r.$emit("update:imagesValue",L)),onSave:g[14]||(g[14]=L=>r.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(be=m.value.settings)!=null&&be.required&&t.imagesValue.length===0?(o(),n("p",mn," Foto wajib diupload ")):c("",!0)])):c("",!0)])]}),_:1},8,["show","title","subtitle"]))}},fn={class:"mt-2 space-y-2"},hn=["name","value","checked","onChange","required"],bn={key:0,class:"p-2 rounded-lg bg-gray-50"},yn={key:0,class:"mt-2"},xn={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},wn=["src"],kn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},$n={key:1,class:"mt-2"},In={class:"text-sm text-gray-600"},Cn={key:2,class:"mt-2 text-sm text-red-600"},Sn={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:ee}){const s=t,x=ee,u=w(s.notes),m=w([...s.images]),p=w(!1),r=w(""),g=w([]),k=w(""),V=w([]),$=le(()=>s.options.find(T=>T.value===s.modelValue)),F=T=>T.settings&&(T.settings.show_textarea||T.settings.show_image_upload);he(()=>s.notes,T=>{u.value=T}),he(()=>s.images,T=>{m.value=[...T]}),he(()=>s.modelValue,T=>{T&&(k.value=T)});const G=T=>{x("update:modelValue",T.value),F(T)?C():x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:T.value,notes:"",images:[]})},b=T=>T.preview||(T.image_path?`/${T.image_path}`:T),C=()=>{k.value=s.modelValue,r.value=u.value,g.value=[...m.value],V.value=[...m.value],p.value=!0},a=()=>{r.value="",g.value=[],k.value="",p.value=!1},_=T=>{g.value=T,m.value=[...T],x("update:images",[...T]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:u.value,images:[...T]})},y=T=>{},D=()=>{k.value!==s.modelValue&&x("update:modelValue",k.value),u.value=r.value,x("update:notes",r.value),m.value=[...g.value],x("update:images",[...g.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:k.value,notes:r.value,images:g.value}),p.value=!1},W=T=>{k.value="",r.value="",g.value=[],u.value="",m.value=[],x("update:modelValue",""),x("update:notes",""),x("update:images",[]),x("hapus",T),p.value=!1};return(T,te)=>{var Y,N,M,z;return o(),n("div",fn,[e("div",{class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Me,null,Ue(t.options,(P,ge)=>(o(),n("label",{key:ge,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:P.value,checked:t.modelValue===P.value,onChange:Ie=>G(P),class:"hidden peer",required:t.required},null,40,hn),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===P.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==P.value}])},q(P.label),3)]))),128))],2),t.modelValue&&$.value&&F($.value)?(o(),n("div",bn,[e("div",{class:"flex justify-between items-start"},[te[4]||(te[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:C,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((Y=$.value.settings)!=null&&Y.show_image_upload)?(o(),n("div",yn,[e("div",xn,[(o(!0),n(Me,null,Ue(t.images,(P,ge)=>(o(),n("div",{key:ge,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:b(P),class:"w-full h-full object-cover rounded"},null,8,wn),ge===3&&t.images.length>4?(o(),n("span",kn," +"+q(t.images.length-4),1)):c("",!0)]))),128))])])):c("",!0),t.notes&&((N=$.value.settings)!=null&&N.show_textarea)?(o(),n("div",$n,[e("p",In,q(t.notes),1)])):c("",!0)])):c("",!0),p.value?(o(),Ve(pt,{key:(M=t.selectedPoint)==null?void 0:M.id,show:p.value,title:t.pointName||"Detail",subtitle:(z=$.value)==null?void 0:z.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":k.value,"notes-value":r.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":te[0]||(te[0]=P=>k.value=P),"onUpdate:notesValue":te[1]||(te[1]=P=>r.value=P),"onUpdate:imagesValue":te[2]||(te[2]=P=>_(P)),onClose:a,onSave:D,onSaveTextarea:T.handleTextareaSave,onSaveImage:y,onHapus:te[3]||(te[3]=P=>W(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):c("",!0),t.error?(o(),n("p",Cn,q(t.error),1)):c("",!0)])}}},Vn={class:"mt-2 space-y-2"},_n={key:0,class:"flex flex-wrap gap-3"},Mn={key:1,class:"p-2"},Un={key:0,class:"mt-2"},Dn={class:"flex gap-2 overflow-x-auto scrollbar-hide"},jn=["src"],Tn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Nn=["name","value","checked"],Ln={key:1,class:"mt-2"},qn={class:"text-sm text-gray-600"},Bn={key:3,class:"mt-2 text-sm text-red-600"},Fn={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:ee}){const s=t,x=ee,u=w(s.notes),m=w([...s.images]),p=w(!1),r=w(""),g=w([]),k=w(""),V=w([]),$=le(()=>s.options.find(y=>y.value===s.modelValue)),F=y=>y.preview||(y.image_path?`/${y.image_path}`:y);he(()=>s.notes,y=>{u.value=y});const G=()=>{k.value=s.modelValue||"",r.value=u.value,g.value=[...m.value],V.value=[...m.value],p.value=!0},b=()=>{r.value="",g.value=[],k.value="",p.value=!1},C=y=>{g.value=y,m.value=[...y],x("update:images",[...y]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:u.value,images:[...y]})},a=()=>{k.value!==s.modelValue&&x("update:modelValue",k.value),u.value=r.value,x("update:notes",r.value),m.value=[...g.value],x("update:images",[...g.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:k.value,notes:r.value,images:g.value}),p.value=!1},_=y=>{k.value="",r.value="",g.value=[],u.value="",m.value=[],x("update:modelValue",""),x("update:notes",""),x("update:images",[]),x("hapus",y),p.value=!1};return(y,D)=>{var W,T,te;return o(),n("div",Vn,[!t.modelValue&&m.value.length===0&&!u.value?(o(),n("div",_n,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:G},D[4]||(D[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(o(),n("div",Mn,[e("div",{class:"flex justify-between items-start"},[D[5]||(D[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:G,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),m.value.length>0?(o(),n("div",Un,[e("div",Dn,[(o(!0),n(Me,null,Ue(m.value,(Y,N)=>(o(),n("div",{key:N,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:F(Y),class:"w-full h-full object-cover rounded"},null,8,jn),N===3&&m.value.length>4?(o(),n("span",Tn," +"+q(m.value.length-4),1)):c("",!0)]))),128))])])):c("",!0),e("div",{class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Me,null,Ue(t.options,(Y,N)=>(o(),n("label",{key:N,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:Y.value,checked:t.modelValue===Y.value,disabled:!0,class:"hidden peer"},null,8,Nn),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===Y.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==Y.value}])},q(Y.label),3)]))),128))],2),u.value&&((W=$.value.settings)!=null&&W.show_textarea)?(o(),n("div",Ln,[e("p",qn,q(u.value),1)])):c("",!0)])),p.value?(o(),Ve(pt,{key:(T=t.selectedPoint)==null?void 0:T.id,show:p.value,title:t.pointName||"Detail",subtitle:(te=$.value)==null?void 0:te.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":k.value,"notes-value":r.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":D[0]||(D[0]=Y=>k.value=Y),"onUpdate:notesValue":D[1]||(D[1]=Y=>r.value=Y),"onUpdate:imagesValue":D[2]||(D[2]=Y=>C(Y)),onClose:b,onSave:a,onHapus:D[3]||(D[3]=Y=>_(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):c("",!0),t.error?(o(),n("p",Bn,q(t.error),1)):c("",!0)])}}},An={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},En={class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},Rn={class:"text-xl font-semibold text-indigo-700"},zn={class:"p-4 space-y-4"},On={class:"flex items-start justify-between"},Hn={class:"block text-sm font-medium text-gray-700"},Kn={key:0,class:"text-red-500"},Wn={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Zn={key:0,class:"text-center py-8 text-gray-500"},Gn={key:0,class:"text-xs text-gray-400"},Pn={__name:"CategoryCadangan",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(t,{emit:ee}){const s=t,x=ee,u=w(!1),m=ns(),p=le(()=>(s.category.points||[]).some(b=>b.is_default===!1)),r=le(()=>{var C;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(C=s.category.points)==null?void 0:C.length}),!s.category.isDamageMenu){const a=(s.category.points||[]).filter(_=>{var W;const y=(W=_.inspection_point)==null?void 0:W.id,D=g(y);return u.value||_.is_default||D?!0:(console.log(`Non-damage Point ${y}: is_default=${_.is_default}, hasData=${D}`),!1)});return console.log("Filtered non-damage points:",a),a}const b=(s.category.points||[]).filter(a=>{var D;const _=(D=a.inspection_point)==null?void 0:D.id,y=g(_);return u.value||a.is_default||!a.is_default&&y?!0:(console.log(`Damage Point ${_}: hasData=${y}`),y)});return console.log("Filtered damage points:",b),b}),g=b=>{if(!b)return console.log("hasPointData: pointId is null/undefined"),!1;const C=m.props.existingResults[b]!==void 0,a=m.props.existingImages[b]&&m.props.existingImages[b].length>0,_=s.form.results[b]&&(s.form.results[b].status||s.form.results[b].note),y=s.form.images[b]&&s.form.images[b].length>0,D=C||a||_||y;return console.log(`Point ${b} data check:`,{hasServerResult:C,hasServerImages:a,hasLocalResult:_,hasLocalImages:y,finalResult:D}),D},k=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],V=b=>{var _,y,D,W,T,te,Y,N,M;const C=s.form.results[(_=b.inspection_point)==null?void 0:_.id],a=s.form.images[(y=b.inspection_point)==null?void 0:y.id];if(!C)return!1;switch(b.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!C.note;case"select":case"radio":if(!C.status)return!1;const z=(W=(D=b.settings)==null?void 0:D.radios)==null?void 0:W.find(ge=>ge.value===C.status);return!(z!=null&&z.settings&&(z.settings.show_textarea&&!((T=C.note)!=null&&T.trim())||z.settings.show_image_upload&&(a==null?void 0:a.length)===0));case"imageTOradio":if((a==null?void 0:a.length)===0||!C.status)return!1;const P=(Y=(te=b.settings)==null?void 0:te.radios)==null?void 0:Y.find(ge=>ge.value===C.status);return!(P!=null&&P.settings&&P.settings.show_textarea&&!((N=C.note)!=null&&N.trim()));case"image":return(a==null?void 0:a.length)>0;default:return!!C.status||!!((M=C.note)!=null&&M.trim())}};he(()=>s.form.results,b=>{Object.keys(b).forEach(C=>{!b[C]||!b[C].status&&b[C].note})},{deep:!0}),he(()=>s.form.images,b=>{Object.keys(b).forEach(C=>{!b[C]||b[C].length})},{deep:!0});const $=(b,C,a)=>{x("updateResult",{pointId:b,type:a,value:C})},F=b=>{x("saveResult",b)},G=b=>{x("hapusPoint",b)};return(b,C)=>(o(),n("div",An,[e("div",En,[e("h3",Rn,q(t.category.name),1),p.value?(o(),n("button",{key:0,onClick:C[0]||(C[0]=a=>u.value=!u.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},q(u.value?"Sembunyikan Point Yang Tidak Perlu":"Tampilkan Point Tersembunyi"),1)):c("",!0)]),e("div",zn,[(o(!0),n(Me,null,Ue(r.value,a=>{var _,y,D,W,T,te,Y,N,M,z,P,ge,Ie,ke,E,H,ie,re,me,de,ue,be,L,ye,fe,d,S,h,U,R,se,O,oe,Q,I,v,Z,K,A,pe,xe,we,Ee,Oe,Xe,Ye,Qe,at,Ke,et,tt,We,Ce,Te,He,Ze;return o(),n("div",{key:a.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",On,[e("label",Hn,[$e(q((_=a.inspection_point)==null?void 0:_.name)+" ",1),(y=a.settings)!=null&&y.is_required?(o(),n("span",Kn,"*")):c("",!0)]),V(a)?(o(),n("span",Wn," ✓ ")):c("",!0)]),a.input_type==="text"?(o(),Ve(Bt,{key:0,modelValue:t.form.results[(D=a.inspection_point)==null?void 0:D.id].note,"onUpdate:modelValue":[B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=B},B=>{var f;return $((f=a.inspection_point)==null?void 0:f.id,B,"note")}],required:(W=a.settings)==null?void 0:W.is_required,"min-length":(T=a.settings)==null?void 0:T.min_length,"max-length":(te=a.settings)==null?void 0:te.max_length,allowSpace:(Y=a.settings)==null?void 0:Y.allow_space,textTransform:(N=a.settings)==null?void 0:N.text_transform,placeholder:((M=a.settings)==null?void 0:M.placeholder)||"Masukan text",error:t.form.errors[`results.${(z=a.inspection_point)==null?void 0:z.id}.note`],onSave:B=>{var f;return F((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):c("",!0),a.input_type==="number"?(o(),Ve(Ft,{key:1,modelValue:t.form.results[(P=a.inspection_point)==null?void 0:P.id].note,"onUpdate:modelValue":[B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=B},B=>{var f;return $((f=a.inspection_point)==null?void 0:f.id,B,"note")}],required:(ge=a.settings)==null?void 0:ge.is_required,min:(Ie=a.settings)==null?void 0:Ie.min,max:(ke=a.settings)==null?void 0:ke.max,step:((E=a.settings)==null?void 0:E.step)||1,placeholder:((H=a.settings)==null?void 0:H.placeholder)||"Masukan number",error:t.form.errors[`results.${(ie=a.inspection_point)==null?void 0:ie.id}.note`],onSave:B=>{var f;return F((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):c("",!0),a.input_type==="account"?(o(),Ve(Et,{key:2,modelValue:t.form.results[(re=a.inspection_point)==null?void 0:re.id].note,"onUpdate:modelValue":[B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=B},B=>{var f;return $((f=a.inspection_point)==null?void 0:f.id,B,"note")}],required:(me=a.settings)==null?void 0:me.is_required,placeholder:((de=a.settings)==null?void 0:de.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${(ue=a.inspection_point)==null?void 0:ue.id}.note`],"point-id":(be=a.inspection_point)==null?void 0:be.id,settings:a.settings,onSave:B=>{var f;return F((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):c("",!0),a.input_type==="date"?(o(),Ve(At,{key:3,modelValue:t.form.results[(L=a.inspection_point)==null?void 0:L.id].note,"onUpdate:modelValue":[B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=B},B=>{var f;return $((f=a.inspection_point)==null?void 0:f.id,B,"note")}],required:(ye=a.settings)==null?void 0:ye.is_required,"min-date":(fe=a.settings)==null?void 0:fe.min_date,"max-date":(d=a.settings)==null?void 0:d.max_date,error:t.form.errors[`results.${(S=a.inspection_point)==null?void 0:S.id}.note`],onSave:B=>{var f;return F((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):c("",!0),a.input_type==="textarea"?(o(),Ve(Rt,{key:4,modelValue:t.form.results[(h=a.inspection_point)==null?void 0:h.id].note,"onUpdate:modelValue":[B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=B},B=>{var f;return $((f=a.inspection_point)==null?void 0:f.id,B,"note")}],required:(U=a.settings)==null?void 0:U.is_required,"min-length":(R=a.settings)==null?void 0:R.min_length,"max-length":(se=a.settings)==null?void 0:se.max_length,placeholder:((O=a.settings)==null?void 0:O.placeholder)||"Masukkan teks di sini",settings:a.settings,error:t.form.errors[`results.${(oe=a.inspection_point)==null?void 0:oe.id}.note`],onSave:B=>{var f;return F((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):c("",!0),a.input_type==="radio"?(o(),Ve(Sn,{key:5,modelValue:t.form.results[(Q=a.inspection_point)==null?void 0:Q.id].status,"onUpdate:modelValue":[B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=B},B=>{var f;return $((f=a.inspection_point)==null?void 0:f.id,B,"status")}],notes:t.form.results[(I=a.inspection_point)==null?void 0:I.id].note,images:t.form.images[(v=a.inspection_point)==null?void 0:v.id],required:(Z=a.settings)==null?void 0:Z.is_required,"point-id":(K=a.inspection_point)==null?void 0:K.id,point:a.inspection_point,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(A=a.inspection_point)==null?void 0:A.name,"selected-point":a.inspection_point??null,options:((pe=a.settings)==null?void 0:pe.radios)||k,error:t.form.errors[`results.${(xe=a.inspection_point)==null?void 0:xe.id}.status`],"onUpdate:notes":B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=B},"onUpdate:images":B=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=B},onSave:B=>{var f;return F((f=a.inspection_point)==null?void 0:f.id)},onHapus:B=>{var f;return G((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="imageTOradio"?(o(),Ve(Fn,{key:6,modelValue:t.form.results[(we=a.inspection_point)==null?void 0:we.id].status,"onUpdate:modelValue":[B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=B},B=>{var f;return $((f=a.inspection_point)==null?void 0:f.id,B,"status")}],notes:t.form.results[(Ee=a.inspection_point)==null?void 0:Ee.id].note,images:t.form.images[(Oe=a.inspection_point)==null?void 0:Oe.id],required:(Xe=a.settings)==null?void 0:Xe.is_required,"point-id":(Ye=a.inspection_point)==null?void 0:Ye.id,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(Qe=a.inspection_point)==null?void 0:Qe.name,point:a,"selected-point":a.inspection_point??null,options:((at=a.settings)==null?void 0:at.radios)||k,error:t.form.errors[`results.${(Ke=a.inspection_point)==null?void 0:Ke.id}.status`],"onUpdate:notes":B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=B},"onUpdate:images":B=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=B},onSave:B=>{var f;return F((f=a.inspection_point)==null?void 0:f.id)},onHapus:B=>{var f;return G((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="image"?(o(),Ve(mt,{key:7,modelValue:t.form.images[(et=a.inspection_point)==null?void 0:et.id],"onUpdate:modelValue":B=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=B},error:t.form.errors[`images.${(tt=a.inspection_point)==null?void 0:tt.id}`],"inspection-id":t.inspectionId,"point-id":(We=a.inspection_point)==null?void 0:We.id,point:a.inspection_point,"point-name":(Ce=a.inspection_point)==null?void 0:Ce.name,settings:a.settings,"onUpdate:notes":B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=B},"onUpdate:status":B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=B}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):c("",!0),a.input_type==="select"?(o(),Ve(ho,{key:8,modelValue:t.form.results[(Te=a.inspection_point)==null?void 0:Te.id].status,"onUpdate:modelValue":[B=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=B},B=>{var f;return $((f=a.inspection_point)==null?void 0:f.id,B,"status")}],required:(He=a.settings)==null?void 0:He.is_required,error:t.form.errors[`results.${(Ze=a.inspection_point)==null?void 0:Ze.id}.status`],onSave:B=>{var f;return F((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):c("",!0)])}),128)),r.value.length===0?(o(),n("div",Zn,[C[1]||(C[1]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),C[2]||(C[2]=e("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),t.category.isDamageMenu?(o(),n("p",Gn,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):c("",!0)])):c("",!0)])]))}},Jn=Ae(Pn,[["__scopeId","data-v-819f08b2"]]),Xn={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Yn={class:"p-4 space-y-4-6"},Qn={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ei=["value"],ti={class:"p-4 space-y-4-6"},si={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},oi=["value"],ai={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},ni={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ii=["value"],li={class:"p-4 space-y-2"},ri={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},di={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},ui={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},ci={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},gi={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},mi={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(t,{emit:ee}){const s=t,x=ee,u=w(null),m=w(!1),p=Dt({bold:!1,italic:!1,underline:!1}),r=Dt({flooded:"",collision:"",collision_severity:"",notes:""}),g=N=>{if(!N)return{};if(typeof N=="string")try{return JSON.parse(N)||{}}catch(M){return console.error("Error parsing settings JSON:",M),{}}return typeof N=="object"&&N!==null?N:{}};le(()=>g(s.inspection.settings).conclusion||{});const k=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],V=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],$=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Je(()=>{G(),Lt(()=>{F(),b()})});const F=()=>{u.value&&r.notes&&(u.value.innerHTML=r.notes)},G=()=>{const M=g(s.inspection.settings).conclusion||{},z=s.form.conclusion||{};r.flooded=z.flooded||M.flooded||"",r.collision=z.collision||M.collision||"",r.collision_severity=z.collision_severity||M.collision_severity||"",r.notes=z.notes||s.inspection.notes||""},b=()=>{if(!u.value)return;const N=window.getSelection();N.rangeCount===0||N.isCollapsed||(p.bold=document.queryCommandState("bold"),p.italic=document.queryCommandState("italic"),p.underline=document.queryCommandState("underline"))},C=N=>{if(!u.value)return;u.value.focus();const M=p[N];switch(N){case"bold":document.execCommand("bold",!1,!M);break;case"italic":document.execCommand("italic",!1,!M);break;case"underline":document.execCommand("underline",!1,!M);break}setTimeout(()=>{b(),_()},10)},a=()=>{u.value&&(u.value.focus(),document.execCommand("removeFormat",!1,null),Object.keys(p).forEach(N=>{p[N]=!1}),_())},_=qt.debounce(()=>{u.value&&(r.notes=u.value.innerHTML,Y())},200),y=N=>{N.preventDefault(),document.execCommand("insertParagraph",!1,null)},D=N=>{N.preventDefault();const M=(N.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,M)},W=()=>{m.value=!0},T=()=>{m.value=!1,u.value&&(r.notes=u.value.innerHTML,Y())},te=()=>{Y()},Y=()=>{const N={flooded:r.flooded,collision:r.collision,collision_severity:r.collision==="yes"?r.collision_severity:null,notes:r.notes};x("updateConclusion",N)};return he(()=>s.form.conclusion,N=>{N&&(r.flooded=N.flooded!==void 0?N.flooded:r.flooded,r.collision=N.collision!==void 0?N.collision:r.collision,r.collision_severity=N.collision_severity!==void 0?N.collision_severity:r.collision_severity,r.notes=N.notes!==void 0?N.notes:r.notes,u.value&&N.notes!==void 0&&u.value.innerHTML!==N.notes&&(u.value.innerHTML=N.notes))},{deep:!0,immediate:!0}),he([()=>r.flooded,()=>r.collision,()=>r.collision_severity,()=>r.notes],()=>{Y()},{deep:!0}),(N,M)=>(o(),n("div",Xn,[M[16]||(M[16]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),e("div",Yn,[M[8]||(M[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e(" Apakah kendaraan pernah terkena banjir? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Qn,[(o(),n(Me,null,Ue(k,z=>e("label",{key:z.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[0]||(M[0]=P=>r.flooded=P),value:z.value,class:"hidden peer",onChange:te},null,40,ei),[[ct,r.flooded]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":r.flooded===z.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":r.flooded!==z.value}])},q(z.label),3)])),64))])]),e("div",ti,[M[10]||(M[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e(" Apakah kendaraan pernah mengalami tabrakan? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",si,[(o(),n(Me,null,Ue(V,z=>e("label",{key:z.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[1]||(M[1]=P=>r.collision=P),value:z.value,class:"hidden peer",onChange:te},null,40,oi),[[ct,r.collision]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":r.collision===z.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":r.collision!==z.value}])},q(z.label),3)])),64))]),_e(it,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:qe(()=>[r.collision==="yes"?(o(),n("div",ai,[M[9]||(M[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e("Tingkat kerusakan: "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ni,[(o(),n(Me,null,Ue($,z=>e("label",{key:z.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[2]||(M[2]=P=>r.collision_severity=P),value:z.value,class:"hidden peer",onChange:te},null,40,ii),[[ct,r.collision_severity]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":r.collision_severity===z.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":r.collision_severity!==z.value}])},q(z.label),3)])),64))])])):c("",!0)]),_:1})]),e("div",li,[M[15]||(M[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),e("div",ri,[e("button",{type:"button",onClick:M[3]||(M[3]=z=>C("bold")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},M[11]||(M[11]=[e("strong",null,"B",-1)]),2),e("button",{type:"button",onClick:M[4]||(M[4]=z=>C("italic")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},M[12]||(M[12]=[e("em",null,"I",-1)]),2),e("button",{type:"button",onClick:M[5]||(M[5]=z=>C("underline")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},M[13]||(M[13]=[e("u",null,"U",-1)]),2),e("button",{type:"button",onClick:M[6]||(M[6]=z=>a()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Formatting"}," 🗑️ Clear ")]),_e(it,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:qe(()=>[Object.values(p).some(z=>z)?(o(),n("div",di,[M[14]||(M[14]=$e(" Format aktif: ")),p.bold?(o(),n("span",ui,"Bold")):c("",!0),p.italic?(o(),n("span",ci,"Italic")):c("",!0),p.underline?(o(),n("span",gi,"Underline")):c("",!0)])):c("",!0)]),_:1}),e("div",{ref_key:"editorRef",ref:u,contenteditable:"true",class:ne(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!m.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":m.value}]),onInput:M[7]||(M[7]=(...z)=>X(_)&&X(_)(...z)),onBlur:T,onFocus:W,onKeydown:is(y,["enter"]),onPaste:D,onMouseup:b,onKeyup:b,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},pi=Ae(mi,[["__scopeId","data-v-e687622b"]]),vi={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},fi={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},hi={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},bi={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},yi={class:"flex items-center space-x-2 flex-shrink-0"},xi=["aria-checked"],wi={class:"flex items-center space-x-2 flex-shrink-0"},ki={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},$i=["onClick","data-category"],Ii={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ci={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Si={key:3,class:"fixed inset-0 z-30"},Vi={class:"mt-2 space-y-2"},_i={class:"flex items-center space-x-2"},Mi=["aria-checked"],Ui={class:"flex items-center space-x-2"},Di={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ji=["onClick"],Ti={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ni={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Li={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},qi={class:"relative overflow-hidden"},Bi={key:1},Fi=["disabled"],Ai={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ei={class:"space-y-4"},Ri={class:"relative"},zi={class:"max-h-64 overflow-y-auto"},Oi={key:0,class:"text-center py-4 text-gray-500"},Hi=["onClick"],Ki={class:"font-medium text-gray-900"},Wi={class:"text-sm text-gray-500"},Zi={class:"text-xs text-gray-400 mt-1"},Gi={key:0,class:"text-xs text-green-600 mt-1"},Pi={key:3,class:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 text-center"},Ji={__name:"IndexLocal",props:{inspection:Object,inspectionId:Object,category:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(t){var yt,xt,wt,kt,$t,It,Ct,St,Vt,_t;const ee=i=>{if(!i)return{};if(typeof i=="string")try{return JSON.parse(i)||{}}catch(l){return console.error("Error parsing settings JSON:",l),{}}return typeof i=="object"&&i!==null?i:{}},s=t,x=le(()=>`inspection_data_${s.inspection.id}`),u=le(()=>`swipe_toggle_${s.inspection.id}`),m=le(()=>`image_source_${s.inspection.id}`),p=()=>{try{const i=localStorage.getItem(x.value);return i?JSON.parse(i):{}}catch(i){return console.error("Error reading local storage:",i),{}}},r=i=>{try{localStorage.setItem(x.value,JSON.stringify(i))}catch(l){console.error("Error writing to local storage:",l)}},g=()=>{try{localStorage.removeItem(x.value),localStorage.removeItem(u.value),localStorage.removeItem(m.value)}catch(i){console.error("Error clearing local storage:",i)}},k=()=>{try{const i=localStorage.getItem(u.value);return i?JSON.parse(i):!0}catch(i){return console.error("Error reading swipe toggle state:",i),!0}},V=i=>{try{localStorage.setItem(u.value,JSON.stringify(i))}catch(l){console.error("Error writing swipe toggle state:",l)}},$=()=>{try{return localStorage.getItem(m.value)||"all"}catch(i){return console.error("Error reading image source setting:",i),"all"}},F=i=>{try{localStorage.setItem(m.value,i)}catch(l){console.error("Error writing image source setting:",l)}},G=w(((xt=(yt=s.category)==null?void 0:yt.settings)==null?void 0:xt.menu_model)||"horizontal"),b=w(((kt=(wt=s.category)==null?void 0:wt.settings)==null?void 0:kt.position)||"top"),C=w(!1),a=w(!1),{pos:_,dragging:y,startLongPress:D,cancelLongPress:W,onDrag:T,stopDrag:te,handleClick:Y}=Tt("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),N=i=>{Y(i)&&M()},M=()=>{C.value=!C.value},z=()=>{C.value=!1},P=i=>i?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:ge,dragging:Ie,startLongPress:ke,cancelLongPress:E,onDrag:H,stopDrag:ie,handleClick:re}=Tt("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),me=i=>{re(i)&&(de.value=!0)},de=w(!1),ue=w(!1),be=w(""),L=w(null),ye=w(""),fe=w(""),d=w(""),S=w(!1),h=w(null),U=(i,l)=>{S.value=!0,h.value=l,gt.visit(i,{onFinish:()=>{S.value=!1,h.value=null}})},R=le(()=>s.appMenus.some(i=>i.input_type==="damage")),se=le(()=>["vehicle",...s.appMenus.map(i=>i.id),"conclusion"]),O=w(se.value[0]),oe=w(0);he(O,i=>{oe.value=se.value.indexOf(i)});const Q=le(()=>{if(O.value==="vehicle"||O.value==="conclusion")return null;const i=s.appMenus.find(l=>l.id===O.value);return i?{...i,points:I(i.menu_point,i.input_type==="damage")}:null}),I=(i,l)=>l?(i||[]).filter(J=>{const ae=J.inspection_point_id;return Ye(ae)}):i||[],v=w({plate_number:s.inspection.plate_number,car_id:s.inspection.car_id,car_name:s.inspection.car_name}),Z=w({notes:s.inspection.overall_note||"",flooded:((It=($t=ee(s.inspection.settings))==null?void 0:$t.conclusion)==null?void 0:It.flooded)||null,collision:((St=(Ct=ee(s.inspection.settings))==null?void 0:Ct.conclusion)==null?void 0:St.collision)||null,collision_severity:((_t=(Vt=ee(s.inspection.settings))==null?void 0:Vt.conclusion)==null?void 0:_t.collision_severity)||null}),A=Nt((()=>{const i=[...s.appMenus.flatMap(Be=>Be.menu_point||[]),...s.damagePoints||[]],l={},J={};i.forEach(Be=>{const Le=Be.inspection_point_id,je=s.existingResults[Le];l[Le]={status:(je==null?void 0:je.status)||"",note:(je==null?void 0:je.note)||""},J[Le]=s.existingImages[Le]||[]});const ae=p(),ce={...l,...ae.results||{}},Se={...J,...ae.images||{}},De={...v.value,...ae.vehicleDetails||{}},ve=ae.overall_note!==void 0?ae.overall_note:s.inspection.overall_note||"";return{inspection_id:s.inspection.id,results:ce,images:Se,overall_note:ve,plate_number:De.plate_number,car_id:De.car_id,car_name:De.car_name}})());he(A,i=>{r({results:i.results,images:i.images,overall_note:i.overall_note,vehicleDetails:v.value,conclusion:Z.value})},{deep:!0}),he(v,i=>{A.plate_number=i.plate_number,A.car_id=i.car_id,A.car_name=i.car_name},{deep:!0}),he(Z,i=>{A.overall_note=i.notes},{deep:!0});const pe=w(!1),xe=i=>{pe.value=i},we=w(!1),Ee=i=>{we.value=i},Oe=le(()=>{var ce;const i=v.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(v.value.plate_number),l=!!((ce=v.value.car_name)!=null&&ce.trim()),J=!we.value,ae=!pe.value;return i&&l&&J&&ae}),Xe=le(()=>{if(!be.value.trim())return s.damagePoints||[];const i=be.value.toLowerCase().trim();return(s.damagePoints||[]).filter(l=>{var J,ae,ce,Se,De;return((ae=(J=l.inspection_point)==null?void 0:J.name)==null?void 0:ae.toLowerCase().includes(i))||((Se=(ce=l.inspection_point)==null?void 0:ce.description)==null?void 0:Se.toLowerCase().includes(i))||((De=Qe(l))==null?void 0:De.toLowerCase().includes(i))})}),Ye=i=>{const l=A.results[i]&&(A.results[i].status||A.results[i].note),J=A.images[i]&&A.images[i].length>0;return l||J},Qe=i=>{var l;return((l=i.inspection_point.component)==null?void 0:l.name)||"Komponen Tidak Diketahui"},at=i=>A.results[i]||null,Ke=()=>{var Se;const i=Z.value,l=!!i.flooded,J=!!i.collision,ae=i.collision==="yes"?!!i.collision_severity:!0,ce=!!((Se=i.notes)!=null&&Se.trim());return l&&J&&ae&&ce},et=le(()=>({flooded:Z.value.flooded||null,collision:Z.value.collision||null,collision_severity:Z.value.collision_severity||null,note:Z.value.notes||null,isComplete:Ke()})),tt=le(()=>{const i=Oe.value,l=s.appMenus.every(ae=>We(ae)),J=Ke();return i&&l&&J}),We=i=>i.id==="conclusion"?Ke():i.id==="vehicle"?Oe.value:(I(i.menu_point,!1)||[]).filter(J=>J.is_default).every(J=>{var De,ve,Be,Le,je,st;const ae=A.results[J.inspection_point_id],ce=A.images[J.inspection_point_id];if(!ae)return!1;const Se=ee(J.settings);switch(J.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((De=ae.note)!=null&&De.trim());case"select":case"radio":if(!ae.status)return!1;const Re=(ve=Se.radios)==null?void 0:ve.find(j=>j.value===ae.status);return!(Re!=null&&Re.settings&&(Re.settings.show_textarea&&!((Be=ae.note)!=null&&Be.trim())||Re.settings.show_image_upload&&(ce==null?void 0:ce.length)===0));case"imageTOradio":if((ce==null?void 0:ce.length)===0||!ae.status)return!1;const ze=(Le=Se.radios)==null?void 0:Le.find(j=>j.value===ae.status);return!(ze!=null&&ze.settings&&ze.settings.show_textarea&&ze.settings.required&&!((je=ae.note)!=null&&je.trim()));case"image":return(ce==null?void 0:ce.length)>0;default:return!!ae.status||!!((st=ae.note)!=null&&st.trim())}}),Ce=w(!0),Te=w("all"),He=w(null),Ze=w([]),B=w(0),f=w(!1);ls("imageSourceSetting",Te);const vt=()=>{Ce.value=!Ce.value,V(Ce.value)},ft=()=>{F(Te.value),console.log("Image source setting updated to:",Te.value)},nt=()=>{He.value&&Lt(()=>{const i=He.value.querySelector(`[data-category="${O.value}"]`);if(!i)return;const l=He.value,J=l.clientWidth,ae=i.offsetLeft,ce=i.clientWidth,Se=ae-J/2+ce/2;l.scrollTo({left:Se,behavior:"smooth"})})},Ot=()=>(B.value>0&&clearTimeout(B.value),B.value===0?(B.value=setTimeout(()=>{B.value=0,f.value=!1},2e3),f.value=!0,!1):(clearTimeout(B.value),B.value=0,f.value=!1,window.history.length>1?window.history.back():window.location.href=document.referrer||"/",!0)),Ht=()=>{window.addEventListener("popstate",i=>{Ot()||window.history.pushState(null,null,window.location.href)}),window.history.pushState(null,null,window.location.href)},Kt=i=>{L.value=i;const l=i.inspection_point_id,J=A.results[l]||{};ye.value=J.status||"",fe.value=J.note||"",de.value=!1,ue.value=!0},Wt=i=>{L.value&&(A.images[L.value.inspection_point_id]=i)},Zt=()=>{if(L.value){const i=L.value.inspection_point_id;A.results[i]={...A.results[i],status:ye.value,note:fe.value},d.value="Data berhasil disimpan di lokal!",setTimeout(()=>d.value="",1e3)}rt()},Gt=({pointId:i,type:l,value:J})=>{var ae;(ae=A.results[i])!=null&&ae.hasOwnProperty(l)&&(A.results[i][l]=J)},ht=async i=>{if(i&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await gt.post(route("inspections.delete-result"),{inspection_id:s.inspection.id,point_id:i},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{A.results[i]&&(A.results[i]={status:"",note:""}),A.images[i]&&(A.images[i]=[]),d.value="Data berhasil dihapus!",setTimeout(()=>d.value="",1e3)},onError:l=>{console.error("Error menghapus hasil:",l)}})}catch(l){console.error("Error menghapus hasil:",l)}rt()}},Pt=i=>{Object.assign(v.value,i),xe(!0)},Jt=i=>{console.log("Save car details locally:",i)},Xt=i=>{console.log("Received conclusion data from child:",i),Z.value={...Z.value,...i},A.overall_note=i.notes||"",console.log("Conclusion state updated:",Z.value)},Yt=()=>{if(!tt.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}if(!confirm("Apakah Anda yakin ingin mengirim semua data inspeksi? Data lokal akan dihapus setelah berhasil dikirim."))return;a.value=!0;const i={...A.data(),overall_note:Z.value.notes,conclusion:{notes:Z.value.notes,flooded:Z.value.flooded,collision:Z.value.collision,collision_severity:Z.value.collision_severity}};gt.post(route("inspections.final-submit-local",{id:s.inspection.id}),i,{preserveScroll:!0,onSuccess:()=>{g()},onError:l=>{console.error("Kesalahan pengiriman:",l),a.value=!1}})},Qt=({pointId:i,imageId:l})=>{A.images[i]&&(A.images[i]=A.images[i].filter(J=>J.id!==l))},es=()=>{de.value=!1,be.value=""},rt=()=>{ue.value=!1,L.value=null,ye.value="",fe.value=""},ts=()=>{},Ge=i=>{O.value=i,nt()},bt=i=>{let l=oe.value+i;l>=0&&l<se.value.length&&(O.value=se.value[l],nt())},ss=()=>{let i=0,l=0,J=null;const ae=ve=>{Ce.value&&(i=ve.changedTouches[0].screenX)},ce=ve=>{Ce.value&&(l=ve.changedTouches[0].screenX,Se())},Se=()=>{if(!Ce.value)return;const ve=250;l<i-ve?bt(1):l>i+ve&&bt(-1)},De=()=>{const ve=document.querySelector(".relative.overflow-hidden");return ve&&(ve.addEventListener("touchstart",ae,!1),ve.addEventListener("touchend",ce,!1)),()=>{ve&&(ve.removeEventListener("touchstart",ae),ve.removeEventListener("touchend",ce))}};return J=De(),he(Ce,ve=>{J&&J(),ve&&(J=De())}),()=>{J&&J()}};return he(O,(i,l)=>{nt()}),he(O,i=>{oe.value=se.value.indexOf(i)}),Je(()=>{const i=p();if(Ce.value=k(),Te.value=$(),i.vehicleDetails&&(Object.assign(v.value,i.vehicleDetails),A.plate_number=i.vehicleDetails.plate_number,A.car_id=i.vehicleDetails.car_id,A.car_name=i.vehicleDetails.car_name),i.conclusion)console.log("Loading conclusion from localStorage:",i.conclusion),Object.assign(Z.value,i.conclusion),A.overall_note=i.conclusion.notes||"";else{const J=ee(s.inspection.settings).conclusion||{};Z.value={notes:s.inspection.notes||"",flooded:J.flooded||"",collision:J.collision||"",collision_severity:J.collision_severity||""},A.overall_note=s.inspection.notes||""}i.results&&Object.assign(A.results,i.results),i.images&&Object.assign(A.images,i.images),ss(),Ht(),setTimeout(()=>{nt()},100)}),(i,l)=>{var J,ae,ce,Se,De,ve,Be,Le,je,st,Re,ze;return o(),n("div",vi,[X(Ie)||X(y)?(o(),n("div",fi)):c("",!0),G.value==="vertical"?(o(),n("button",{key:1,onMousedown:l[0]||(l[0]=(...j)=>X(D)&&X(D)(...j)),onMouseup:l[1]||(l[1]=(...j)=>X(te)&&X(te)(...j)),onMouseleave:l[2]||(l[2]=(...j)=>X(W)&&X(W)(...j)),onMousemove:l[3]||(l[3]=(...j)=>X(T)&&X(T)(...j)),onTouchstart:l[4]||(l[4]=(...j)=>X(D)&&X(D)(...j)),onTouchend:l[5]||(l[5]=(...j)=>X(te)&&X(te)(...j)),onTouchmove:l[6]||(l[6]=(...j)=>X(T)&&X(T)(...j)),onClick:N,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:Fe({left:X(_).x+"px",top:X(_).y+"px"}),"aria-label":"Toggle vertical menu"},[C.value?(o(),n("svg",bi,l[25]||(l[25]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(o(),n("svg",hi,l[24]||(l[24]=[e("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):c("",!0),G.value==="horizontal"?(o(),n("div",{key:2,class:ne(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":b.value==="top","fixed bottom-0 left-0 right-0":b.value==="bottom"}])},[e("div",{ref_key:"menuContainer",ref:He,class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2",onScroll:ts},[e("div",yi,[l[26]||(l[26]=e("span",{class:"text-sm text-gray-600"},"Swipe",-1)),e("button",{onClick:vt,type:"button",class:ne(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Ce.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Ce.value},[e("span",{"aria-hidden":"true",class:ne(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Ce.value?"translate-x-5":"translate-x-0"])},null,2)],10,xi)]),e("div",wi,[l[28]||(l[28]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ne(e("select",{"onUpdate:modelValue":l[7]||(l[7]=j=>Te.value=j),onChange:ft,class:"text-sm border border-gray-300 rounded-md px-5 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},l[27]||(l[27]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[jt,Te.value]])]),e("button",{ref_key:"menuItems",ref:Ze,onClick:l[8]||(l[8]=j=>Ge("vehicle")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":O.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":O.value!=="vehicle"}]),"data-category":"vehicle"},[l[29]||(l[29]=$e(" Detail Kendaraan ")),Oe.value?(o(),n("span",ki," ✓ ")):c("",!0)],2),(o(!0),n(Me,null,Ue(t.appMenus,j=>(o(),n("button",{key:j.id,ref_for:!0,ref_key:"menuItems",ref:Ze,onClick:dt=>Ge(j.id),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":O.value===j.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":O.value!==j.id}]),"data-category":j.id},[$e(q(j.name)+" ",1),We(j)?(o(),n("span",Ii," ✓ ")):c("",!0)],10,$i))),128)),e("button",{ref_key:"menuItems",ref:Ze,onClick:l[9]||(l[9]=j=>Ge("conclusion")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":O.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":O.value!=="conclusion"}]),"data-category":"conclusion"},[l[30]||(l[30]=$e(" Kesimpulan ")),et.value.isComplete?(o(),n("span",Ci," ✓ ")):c("",!0)],2)],544)],2)):c("",!0),G.value==="vertical"&&C.value?(o(),n("div",Si,[e("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:z}),e("div",{class:ne(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":b.value==="top-right","top-16 left-4":b.value==="top-left","bottom-16 right-4":b.value==="bottom-right","bottom-16 left-4":b.value==="bottom-left"}])},[e("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[l[31]||(l[31]=e("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),e("button",{onClick:z,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),e("div",Vi,[e("div",_i,[l[32]||(l[32]=e("span",{class:"text-sm text-gray-600"},"Swipe Gesture",-1)),e("button",{onClick:vt,type:"button",class:ne(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Ce.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Ce.value},[e("span",{"aria-hidden":"true",class:ne(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Ce.value?"translate-x-5":"translate-x-0"])},null,2)],10,Mi)]),e("div",Ui,[l[34]||(l[34]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ne(e("select",{"onUpdate:modelValue":l[10]||(l[10]=j=>Te.value=j),onChange:ft,class:"text-sm border border-gray-300 rounded-md px-6 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},l[33]||(l[33]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[jt,Te.value]])]),e("button",{onClick:l[11]||(l[11]=j=>{Ge("vehicle"),z()}),class:ne([P(O.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[l[35]||(l[35]=e("span",null,"Detail Kendaraan",-1)),Oe.value?(o(),n("span",Di,"✓")):c("",!0)],2),(o(!0),n(Me,null,Ue(t.appMenus,j=>(o(),n("button",{key:`vmenu-${j.id}`,onClick:()=>{Ge(j.id),z()},class:ne([P(O.value===j.id),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[e("span",null,q(j.name),1),We(j)?(o(),n("span",Ti,"✓")):c("",!0)],10,ji))),128)),e("button",{onClick:l[12]||(l[12]=j=>{Ge("conclusion"),z()}),class:ne([P(O.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[l[36]||(l[36]=e("span",null,"Kesimpulan",-1)),et.value.isComplete?(o(),n("span",Ni,"✓")):c("",!0)],2)])],2)])):c("",!0),e("div",{class:ne(["max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1",{"pb-4 pt-1":b.value==="top","pb-20 pt-4":b.value==="bottom","pb-4 pt-4":G.value==="vertical"}])},[_e(it,{name:"fade"},{default:qe(()=>[d.value?(o(),n("div",Li,q(d.value),1)):c("",!0)]),_:1}),e("div",qi,[O.value==="vehicle"?(o(),Ve(Ks,{key:0,inspection:t.inspection,CarDetail:t.CarDetail,allInspections:s.allInspections,onUpdateVehicle:Pt,onSaveCarDetails:Jt,"onUpdate:validation":Ee,"onUpdate:hasUnsavedChanges":xe},null,8,["inspection","CarDetail","allInspections"])):Q.value&&O.value!=="conclusion"?(o(),Ve(Jn,{key:Q.value.id,category:Q.value,"inspection-id":t.inspection.id,form:X(A),onUpdateResult:Gt,onHapusPoint:ht,onRemoveImage:Qt},null,8,["category","inspection-id","form"])):O.value==="conclusion"?(o(),Ve(pi,{key:2,form:{conclusion:Z.value},"inspection-id":t.inspection.id,inspection:t.inspection,settings:t.inspection.settings||{},onUpdateConclusion:Xt},null,8,["form","inspection-id","inspection","settings"])):c("",!0)]),O.value==="conclusion"?(o(),n("div",{key:0,class:ne(["flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md",{"mb-4":b.value==="top","mb-20":b.value==="bottom"}])},[_e(X(rs),{href:i.route("inspections.pending",t.inspectionId),as:"button",type:"button",disabled:S.value&&h.value==="pending",onClick:l[13]||(l[13]=ot(j=>U(i.route("inspections.pending",t.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:qe(()=>[S.value&&h.value==="pending"?(o(),n(Me,{key:0},[l[37]||(l[37]=e("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),l[38]||(l[38]=e("span",null,"Memproses...",-1))],64)):(o(),n("span",Bi,"Tunda"))]),_:1},8,["href","disabled"]),e("button",{type:"button",onClick:Yt,disabled:!tt.value||a.value,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[a.value?(o(),n("svg",Ai,l[39]||(l[39]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,q(a.value?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Fi)],2)):c("",!0),R.value?(o(),n("button",{key:1,onMousedown:l[14]||(l[14]=(...j)=>X(ke)&&X(ke)(...j)),onMouseup:l[15]||(l[15]=(...j)=>X(ie)&&X(ie)(...j)),onMouseleave:l[16]||(l[16]=(...j)=>X(E)&&X(E)(...j)),onMousemove:l[17]||(l[17]=(...j)=>X(H)&&X(H)(...j)),onTouchstart:l[18]||(l[18]=(...j)=>X(ke)&&X(ke)(...j)),onTouchend:l[19]||(l[19]=(...j)=>X(ie)&&X(ie)(...j)),onTouchmove:l[20]||(l[20]=(...j)=>X(H)&&X(H)(...j)),onClick:me,class:"fixed z-10 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:Fe({left:X(ge).x+"px",top:X(ge).y+"px"})},l[40]||(l[40]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):c("",!0),_e(zt,{show:de.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:es},{default:qe(()=>[e("div",Ei,[e("div",Ri,[Ne(e("input",{"onUpdate:modelValue":l[21]||(l[21]=j=>be.value=j),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Pe,be.value]]),l[41]||(l[41]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",zi,[Xe.value.length===0?(o(),n("div",Oi," Tidak ada point yang ditemukan ")):c("",!0),(o(!0),n(Me,null,Ue(Xe.value,j=>{var dt,Mt;return o(),n("button",{key:j.id,onClick:Xi=>Kt(j),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",Ki,q((dt=j.inspection_point)==null?void 0:dt.name),1),e("div",Wi,q((Mt=j.inspection_point)==null?void 0:Mt.description),1),e("div",Zi,q(Qe(j)),1),Ye(j.inspection_point_id)?(o(),n("div",Gi," ✓ Sudah ada data ")):c("",!0)],8,Hi)}),128))])])]),_:1},8,["show"]),ue.value?(o(),Ve(pt,{key:(J=L.value)==null?void 0:J.id,show:ue.value,title:((ce=(ae=L.value)==null?void 0:ae.inspection_point)==null?void 0:ce.name)||"Detail Point",subtitle:(De=(Se=L.value)==null?void 0:Se.inspection_point)==null?void 0:De.description,name:`point-${(ve=L.value)==null?void 0:ve.id}`,"inspection-id":t.inspection.id,"point-id":(Be=L.value)==null?void 0:Be.inspection_point_id,settings:((Le=L.value)==null?void 0:Le.settings)||{},options:((st=(je=L.value)==null?void 0:je.settings)==null?void 0:st.radios)||[],"selected-Point":L.value,"selected-value":ye.value,"images-value":X(A).images[(Re=L.value)==null?void 0:Re.inspection_point_id],"notes-value":fe.value,point:L.value,"existing-data":at((ze=L.value)==null?void 0:ze.inspection_point_id),"onUpdate:selectedValue":l[22]||(l[22]=j=>ye.value=j),"onUpdate:notesValue":l[23]||(l[23]=j=>fe.value=j),"onUpdate:imagesValue":Wt,onSave:Zt,onClose:rt,onHapus:ht},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):c("",!0),f.value?(o(),n("div",Pi,l[42]||(l[42]=[e("p",{class:"text-sm"},"Tekan sekali lagi untuk keluar dari inspeksi",-1),e("p",{class:"text-xs text-gray-300 mt-1"},"Data inspeksi telah disimpan secara lokal",-1)]))):c("",!0)],2)])}}},al=Ae(Ji,[["__scopeId","data-v-b28b2ffe"]]);export{al as default};
