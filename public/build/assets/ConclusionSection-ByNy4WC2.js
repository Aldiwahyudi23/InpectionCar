import{x as $e,d as _,B as he,q as X,e as i,o,a as t,f as w,l as Q,y as oe,u as K,F as z,h as W,t as N,k as O,n as ee,C as Ie,D as ue,g as ce,b as de,j as Ve,E as fe,G as Se,c as G,w as ge,r as be,T as Ce,H as me,W as _e}from"./app-2kpm-_1E.js";import{l as ye}from"./lodash-CJ-mHQyR.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Me={class:"bg-white rounded-xl shadow-md p-6"},Ue={key:0},Ne={class:"mb-6"},qe={class:"mb-6"},Re={class:"relative"},Be={key:0,class:"absolute right-3 top-3"},je={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Pe=["onMousedown"],Fe={class:"font-medium text-gray-900"},Te={class:"text-sm text-gray-500"},De={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Le={key:0,class:"mb-4"},Ae={class:"text-gray-600 text-sm"},Ee={key:1},He={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},Oe=["src","alt"],ze={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},We={class:"text-white text-xs text-center"},Ke={key:2,class:"text-center py-4 text-gray-500 text-sm"},Ge={key:1},Xe={class:"mb-6"},Ze={class:"mb-6"},Je={class:"relative"},Ye={key:0,class:"absolute right-3 top-3"},Qe={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},et=["onMousedown"],tt={class:"font-medium text-gray-900"},st={class:"text-sm text-gray-500"},at={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},ot={key:0,class:"mb-4"},lt={class:"text-gray-600 text-sm"},it={key:1},nt={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},rt=["src","alt"],dt={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},ut={class:"text-white text-xs text-center"},ct={key:2,class:"text-center py-4 text-gray-500 text-sm"},mt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(e,{emit:R}){var M,F;const a=e,b=R,r=$e({plate_number:((M=a.inspection)==null?void 0:M.plate_number)||"",car_id:((F=a.inspection)==null?void 0:F.car_id)||null,car_name:""}),m=_(""),h=_(!1),v=_(!1),d=_([]),x=_(null),k=_([]);he(()=>{var g,u;if((g=a.inspection)!=null&&g.car_id&&((u=a.CarDetail)==null?void 0:u.length)>0){const n=a.CarDetail.find(T=>T.id===a.inspection.car_id);n&&(x.value=n,m.value=s(n),r.car_id=n.id,j(n.id))}});const y=g=>k.file_path?`/${k.file_path}`:"",s=g=>{var n,T,H;if(!g)return"";const u=[];return(n=g.brand)!=null&&n.name&&u.push(g.brand.name),(T=g.model)!=null&&T.name&&u.push(g.model.name),(H=g.type)!=null&&H.name&&u.push(g.type.name),g.cc&&u.push(`${g.cc}cc`),g.transmission&&u.push(g.transmission),g.fuel_type&&u.push(g.fuel_type),g.year&&u.push(g.year.toString()),g.production_period&&u.push(`(${g.production_period})`),u.join(" ")},f=ye.debounce(async()=>{if(!m.value.trim()){d.value=[],h.value=!1;return}v.value=!0;try{const g=m.value.toLowerCase().trim();d.value=a.CarDetail.filter(u=>s(u).toLowerCase().includes(g)),h.value=!0}catch(g){console.error("Error searching cars:",g),d.value=[]}finally{v.value=!1}},300),C=()=>{setTimeout(()=>{h.value=!1},200)},$=g=>{x.value=g,m.value=s(g),r.car_id=g.id,h.value=!1,j(g.id),P()},j=async g=>{try{const u=await fetch(`/api/cars/${g}/images`);u.ok?k.value=await u.json():k.value=[]}catch(u){console.error("Error loading car images:",u),k.value=[]}},P=()=>{const g={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_id?null:m.value.trim()};b("update-vehicle",g)},q=()=>{if(!a.inspection){console.error("Tidak ada data inspeksi untuk diperbarui.");return}r.post(`/inspections/${a.inspection.id}/vehicle-details`,{preserveScroll:!0,onSuccess:()=>{}})};return X(()=>a.inspection,g=>{var u;if(g&&(r.plate_number=g.plate_number||"",r.car_id=g.car_id||null,g.car_id&&((u=a.CarDetail)==null?void 0:u.length)>0)){const n=a.CarDetail.find(T=>T.id===g.car_id);n&&(x.value=n,m.value=s(n),j(n.id))}},{deep:!0}),(g,u)=>(o(),i("div",Me,[u[20]||(u[20]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-6"},"Detail Kendaraan",-1)),e.inspection?(o(),i("div",Ue,[t("div",Ne,[u[10]||(u[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),Q(t("input",{"onUpdate:modelValue":u[0]||(u[0]=n=>K(r).plate_number=n),type:"text",placeholder:"Contoh: B 1234 ABC",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:P},null,544),[[oe,K(r).plate_number]])]),t("div",qe,[u[12]||(u[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),t("div",Re,[Q(t("input",{"onUpdate:modelValue":u[1]||(u[1]=n=>m.value=n),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:u[2]||(u[2]=(...n)=>K(f)&&K(f)(...n)),onFocus:u[3]||(u[3]=n=>h.value=!0),onBlur:C},null,544),[[oe,m.value]]),v.value?(o(),i("div",Be,u[11]||(u[11]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):w("",!0),h.value&&d.value.length>0?(o(),i("div",je,[(o(!0),i(z,null,W(d.value,n=>(o(),i("div",{key:n.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:T=>$(n)},[t("div",Fe,N(s(n)),1),t("div",Te,N(n.year)+" • "+N(n.cc)+"cc • "+N(n.transmission)+" • "+N(n.fuel_type),1)],40,Pe))),128))])):w("",!0)]),Q(t("input",{type:"hidden","onUpdate:modelValue":u[4]||(u[4]=n=>K(r).car_id=n)},null,512),[[oe,K(r).car_id]])]),x.value?(o(),i("div",De,[x.value.description?(o(),i("div",Le,[u[13]||(u[13]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("p",Ae,N(x.value.description),1)])):w("",!0),k.value.length>0?(o(),i("div",Ee,[u[14]||(u[14]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",He,[(o(!0),i(z,null,W(k.value,n=>(o(),i("div",{key:n.id,class:"relative group"},[t("img",{src:n.file_path,alt:n.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200"},null,8,Oe),n.note?(o(),i("div",ze,[t("p",We,N(n.note),1)])):w("",!0)]))),128))])])):(o(),i("div",Ke," Tidak ada gambar tersedia untuk mobil ini "))])):w("",!0),t("button",{type:"button",onClick:q,class:"w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-medium"}," Perbarui Detail Kendaraan ")])):(o(),i("div",Ge,[t("div",Xe,[u[15]||(u[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),Q(t("input",{"onUpdate:modelValue":u[5]||(u[5]=n=>K(r).plate_number=n),type:"text",placeholder:"Contoh: B 1234 ABC",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:P},null,544),[[oe,K(r).plate_number]])]),t("div",Ze,[u[17]||(u[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),t("div",Je,[Q(t("input",{"onUpdate:modelValue":u[6]||(u[6]=n=>m.value=n),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:u[7]||(u[7]=(...n)=>K(f)&&K(f)(...n)),onFocus:u[8]||(u[8]=n=>h.value=!0),onBlur:C},null,544),[[oe,m.value]]),v.value?(o(),i("div",Ye,u[16]||(u[16]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):w("",!0),h.value&&d.value.length>0?(o(),i("div",Qe,[(o(!0),i(z,null,W(d.value,n=>(o(),i("div",{key:n.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:T=>$(n)},[t("div",tt,N(s(n)),1),t("div",st,N(n.year)+" • "+N(n.cc)+"cc • "+N(n.transmission)+" • "+N(n.fuel_type),1)],40,et))),128))])):w("",!0)]),Q(t("input",{type:"hidden","onUpdate:modelValue":u[9]||(u[9]=n=>K(r).car_id=n)},null,512),[[oe,K(r).car_id]])]),x.value?(o(),i("div",at,[x.value.description?(o(),i("div",ot,[u[18]||(u[18]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("p",lt,N(x.value.description),1)])):w("",!0),k.value.length>0?(o(),i("div",it,[u[19]||(u[19]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",nt,[(o(!0),i(z,null,W(k.value,n=>(o(),i("div",{key:n.id,class:"relative group"},[t("img",{src:y(),alt:n.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200"},null,8,rt),n.note?(o(),i("div",dt,[t("p",ut,N(n.note),1)])):w("",!0)]))),128))])])):(o(),i("div",ct," Tidak ada gambar tersedia untuk mobil ini "))])):w("",!0)]))]))}},Za=le(mt,[["__scopeId","data-v-367b941f"]]),gt={class:"mt-1"},vt=["value","required","minlength","maxlength","pattern","placeholder"],ht={key:0,class:"mt-2 text-sm text-red-600"},pt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,r=m=>{b("update:modelValue",m.target.value),b("save",a.pointId)};return(m,h)=>(o(),i("div",gt,[t("input",{value:e.modelValue,onInput:r,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,pattern:e.pattern,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,vt),e.error?(o(),i("p",ht,N(e.error),1)):w("",!0)]))}},ft={class:"mt-1"},bt=["value","required","min","max","step","placeholder"],yt={key:0,class:"mt-2 text-sm text-red-600"},wt={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,r=m=>{const h=m.target.value;b("update:modelValue",h),b("save",a.pointId)};return(m,h)=>(o(),i("div",ft,[t("input",{value:e.modelValue,onInput:r,type:"number",required:e.required,min:e.min,max:e.max,step:e.step,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,bt),e.error?(o(),i("p",yt,N(e.error),1)):w("",!0)]))}},xt={class:"mt-1"},kt=["value","required","min","max"],$t={key:0,class:"mt-2 text-sm text-red-600"},It={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,r=m=>{b("update:modelValue",m.target.value),b("save",a.pointId)};return(m,h)=>(o(),i("div",xt,[t("input",{value:e.modelValue,onChange:r,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,kt),e.error?(o(),i("p",$t,N(e.error),1)):w("",!0)]))}},Vt={class:"mt-1"},St=["value","required","placeholder"],Ct={key:0,class:"mt-2 text-sm text-red-600"},_t={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,r=_(""),m=_(!1),h=O(()=>{var f,C,$,j;return{currency_symbol:((f=a.settings)==null?void 0:f.currency_symbol)||"Rp",thousands_separator:((C=a.settings)==null?void 0:C.thousands_separator)||",",min_value:(($=a.settings)==null?void 0:$.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((j=a.settings)==null?void 0:j.max_value)!==void 0?Number(a.settings.max_value):1e9}}),v=f=>{if(f==null||f==="")return"";const C=Number(f);if(isNaN(C))return"";let $=C.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return h.value.thousands_separator!==","&&($=$.replace(/,/g,h.value.thousands_separator)),$},d=f=>f?f.replace(/[^\d]/g,""):"",x=O(()=>{if(m.value)return r.value;const f=v(a.modelValue);return f?`${h.value.currency_symbol} ${f}`:""}),k=f=>{const C=f.target.value;r.value=C;const $=d(C);b("update:modelValue",$),b("save",a.pointId)},y=()=>{var f;m.value=!0,r.value=((f=a.modelValue)==null?void 0:f.toString())||""},s=()=>{m.value=!1;const f=d(r.value);if(f){const C=Number(f);let $=f;h.value.min_value!==void 0&&C<h.value.min_value&&($=h.value.min_value.toString()),h.value.max_value!==void 0&&C>h.value.max_value&&($=h.value.max_value.toString()),$!==f&&(b("update:modelValue",$),b("save",a.pointId))}};return X(()=>a.modelValue,f=>{!m.value&&f!==void 0&&f!==null&&(r.value=f.toString())},{immediate:!0}),(f,C)=>(o(),i("div",Vt,[t("input",{value:x.value,onInput:k,onBlur:s,onFocus:y,type:"text",required:e.required,placeholder:e.placeholder,class:ee(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,St),e.error?(o(),i("p",Ct,N(e.error),1)):w("",!0)]))}},Mt={class:"mt-1 space-y-3"},Ut={key:0,class:"space-y-2"},Nt={class:"flex flex-wrap gap-2"},qt=["onClick"],Rt=["value","required","minlength","maxlength","placeholder"],Bt={class:"flex justify-between items-center mt-1"},jt={class:"text-xs text-gray-500"},Pt={key:0,class:"text-xs text-red-600"},we={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,r=_([]),m=_(""),h=k=>r.value.some(y=>y.value===k),v=k=>{h(k.value)?r.value=r.value.filter(C=>C.value!==k.value):r.value.push(k);const s=[...r.value.map(C=>C.value)];m.value.trim()&&s.push(m.value.trim());const f=s.join(", ");b("update:modelValue",f),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:f})},d=k=>{const y=k.target.value;b("update:modelValue",y),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:y}),x(y)},x=k=>{var C,$,j,P;if(!k){r.value=[],m.value="";return}const y=k.split(",").map(q=>q.trim()).filter(q=>q),s=(($=(C=a.settings)==null?void 0:C.damage_options)==null?void 0:$.map(q=>q.value))||[];r.value=((P=(j=a.settings)==null?void 0:j.damage_options)==null?void 0:P.filter(q=>y.includes(q.value)))||[];const f=y.filter(q=>!s.includes(q));m.value=f.join(", ")};return X(()=>a.modelValue,k=>{k!=null&&x(k)},{immediate:!0}),(k,y)=>{var s,f,C;return o(),i("div",Mt,[(s=e.settings)!=null&&s.enable_damage&&((f=e.settings)!=null&&f.damage_options)?(o(),i("div",Ut,[y[0]||(y[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",Nt,[(o(!0),i(z,null,W(e.settings.damage_options,($,j)=>(o(),i("button",{key:j,type:"button",onClick:P=>v($),class:ee(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":h($.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!h($.value)}])},N($.label),11,qt))),128))])])):w("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:d,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Rt),t("div",Bt,[t("span",jt,N(((C=e.modelValue)==null?void 0:C.length)||0)+"/"+N(e.maxLength||400),1),e.error?(o(),i("p",Pt,N(e.error),1)):w("",!0)])])])}}},Ft={class:"mt-1"},Tt=["value","required"],Dt={key:0,class:"mt-2 text-sm text-red-600"},Lt={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,r=m=>{b("update:modelValue",m.target.value),b("save",a.pointId)};return(m,h)=>(o(),i("div",Ft,[t("select",{value:e.modelValue,onChange:r,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},h[0]||(h[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,Tt),e.error?(o(),i("p",Dt,N(e.error),1)):w("",!0)]))}},At=le(Lt,[["__scopeId","data-v-c34a74db"]]),Et={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Ht={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Ot={class:"flex flex-row space-x-4 mb-6"},zt={class:"mt-4 text-right"},Wt={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(R,a)=>e.show?(o(),i("div",Et,[t("div",Ht,[a[5]||(a[5]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),t("div",Ot,[t("button",{onClick:a[0]||(a[0]=b=>R.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[3]||(a[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:a[1]||(a[1]=b=>R.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[4]||(a[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",zt,[t("button",{onClick:a[2]||(a[2]=b=>R.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):w("",!0)}},Kt={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Gt={class:"webcam-content-box"},Xt={class:"webcam-header"},Zt={class:"inspection-point-name"},Jt={key:0,class:"screen-flash-overlay"},Yt={key:2,class:"focus-status"},Qt={class:"webcam-footer"},es={class:"camera-controls"},ts=["disabled"],ss={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,inspectionPoint:String,point:Object,pointname:String},emits:["close","photoCaptured"],setup(e,{emit:R}){const a=e,b=R,r=_(null),m=_(null);let h=null,v=null;const d=_("environment"),x=_(!1),k=_(!1),y=_(!1),s=_(!1),f=_(a.inspectionPoint||"Camera"),C=_(!1),$=_({}),j=_(""),P=_("continuous"),q=_("high"),M=O(()=>{switch(q.value){case"high":return{width:1920,height:1080};case"medium":return{width:1280,height:720};case"low":return{width:640,height:480};default:return{width:1920,height:1080}}}),F=O(()=>a.aspectRatio?{aspectRatio:`${a.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),g=O(()=>{if(!a.aspectRatio)return{};const I=a.aspectRatio,l=I>1?80:60,V=I>1?80/I:60*I;return{width:`${l}%`,height:`${V}%`}}),u=O(()=>{var I;return((I=a.settings)==null?void 0:I.max_size)||2048}),n=async()=>{h&&h.getTracks().forEach(I=>I.stop()),y.value=!1,C.value=!1,j.value="";try{const I={facingMode:d.value,width:{ideal:M.value.width},height:{ideal:M.value.height},aspectRatio:{ideal:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30}};q.value==="high"&&(I.width={ideal:1920,max:3840},I.height={ideal:1080,max:2160},I.frameRate={ideal:30,max:60}),P.value!=="manual"&&(I.advanced=[{focusMode:P.value}]),d.value==="environment"&&(I.advanced||(I.advanced=[]),I.advanced.push({focusMode:P.value})),h=await navigator.mediaDevices.getUserMedia({video:I,audio:!1}),v=h.getVideoTracks()[0],r.value.srcObject=h,r.value.onloadedmetadata=async()=>{await H(),(P.value==="continuous"||P.value==="single-shot")&&await te()}}catch(I){console.error("Error accessing camera: ",I),alert("Failed to access camera. Please allow camera permission."),b("close")}},T=()=>{h&&h.getTracks().forEach(I=>I.stop()),b("close")},H=async()=>{if(v)try{const I=await navigator.mediaDevices.enumerateDevices();x.value=I.filter(p=>p.kind==="videoinput").length>1;const l=v.getCapabilities();k.value=l.torch||l.fillLightMode&&l.fillLightMode.includes("torch");const V=l.focusDistance||{};console.log("Camera capabilities:",l)}catch(I){console.error("Error checking camera capabilities:",I)}},te=async()=>{if(v)try{const I=v.getCapabilities();I.focusMode&&I.focusMode.includes("continuous")&&(await v.applyConstraints({advanced:[{focusMode:"continuous"}]}),j.value="Auto Focus Enabled",setTimeout(()=>{j.value=""},2e3))}catch(I){console.warn("Auto focus not supported:",I)}},A=async()=>{if(!(!v||!a.settings.enable_flash)){if(d.value==="user"){y.value=!y.value,s.value=y.value;return}try{v.getCapabilities().torch&&(await v.applyConstraints({advanced:[{torch:!y.value}]}),y.value=!y.value)}catch(I){console.error("Flash toggle failed:",I)}}},Y=async()=>{x.value&&(d.value=d.value==="environment"?"user":"environment",f.value=`${a.inspectionPoint||"Camera"} (${d.value==="environment"?"Rear":"Front"})`,await n())},ae=async()=>{if(!v)return;const I=v.getCapabilities();if(I.focusMode&&I.focusMode.includes("continuous"))try{await v.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(l){console.warn("Focus not supported",l)}},ie=async I=>new Promise(l=>{const V=u.value*1024;if(I.size<=V){l(I);return}const p=new Image,B=new FileReader;B.onload=S=>{p.onload=()=>{const c=document.createElement("canvas"),U=c.getContext("2d"),L=Math.sqrt(V/I.size);c.width=p.width*L,c.height=p.height*L,U.drawImage(p,0,0,c.width,c.height);let D=.9;const E=()=>{c.toBlob(Z=>{Z.size>V&&D>.1?(D-=.1,E()):l(Z)},"image/png",D)};E()},p.src=S.target.result},B.readAsDataURL(I)}),ne=async()=>{const I=r.value,l=m.value;if(!(!I||!l||I.readyState!==4))try{const V=l.getContext("2d"),p=I.videoWidth,B=I.videoHeight;let S,c,U,L;p/B>a.aspectRatio?(c=B,S=B*a.aspectRatio,U=(p-S)/2,L=0):(S=p,c=p/a.aspectRatio,U=0,L=(B-c)/2),l.width=S,l.height=c,V.drawImage(I,U,L,S,c,0,0,S,c);const D=await new Promise(Z=>{l.toBlob(Z,"image/png",1)}),E=await ie(D);if(E){const Z=new File([E],`capture_${Date.now()}.png`,{type:"image/png",lastModified:Date.now()});b("photoCaptured",Z),s.value=!0,setTimeout(()=>{s.value=!1},100)}}catch(V){console.error("Error capturing photo:",V),alert("Failed to capture photo. Please try again.")}};return X(()=>a.show,I=>{I?n():T()}),X(()=>a.inspectionPoint,I=>{f.value=I||"Camera"}),X(()=>a.aspectRatio,()=>{a.show&&n()}),Ie(()=>{h&&h.getTracks().forEach(I=>I.stop())}),(I,l)=>{var V;return e.show?(o(),i("div",Kt,[t("div",Gt,[t("div",Xt,[t("div",Zt,N(((V=e.point)==null?void 0:V.name)||"Camera"),1),t("button",{onClick:T,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},l[0]||(l[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:ue(F.value),onClick:ae},[t("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:m,class:"hidden"},null,512),s.value?(o(),i("div",Jt)):w("",!0),t("div",{class:"aspect-ratio-guide",style:ue(g.value)},null,4),C.value?(o(),i("div",{key:1,class:"focus-indicator",style:ue($.value)},l[1]||(l[1]=[t("div",{class:"focus-ring"},null,-1)]),4)):w("",!0),l[2]||(l[2]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),j.value?(o(),i("div",Yt,N(j.value),1)):w("",!0)],4),t("div",Qt,[t("div",es,[e.settings.enable_flash?(o(),i("button",{key:0,onClick:A,disabled:!k.value,class:ee(["control-button",{active:y.value,disabled:!k.value}])},l[3]||(l[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),10,ts)):w("",!0),t("button",{onClick:ne,class:"capture-button"},l[4]||(l[4]=[t("div",{class:"camera-icon-container"},[t("div",{class:"camera-body"},[t("div",{class:"camera-lens"}),t("div",{class:"camera-flash"})])],-1)])),e.settings.enable_camera_switch&&x.value?(o(),i("button",{key:1,onClick:Y,class:"control-button"},l[5]||(l[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):w("",!0)])])])])):w("",!0)}}},as=le(ss,[["__scopeId","data-v-73221082"]]),os={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},ls={class:"w-full h-full flex flex-col"},is={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},ns={class:"text-lg font-semibold"},rs={class:"flex-1 flex items-center justify-center overflow-hidden relative"},ds=["src"],us={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},cs=["disabled"],ms={class:"flex gap-3 w-full"},gs=["disabled"],vs={key:1,class:"flex-1 px-4 py-3 bg-indigo-400 text-white rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},hs={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos"],setup(e,{emit:R}){const a=e,b=R,r=_(0),m=_([]),h=_(0),v=_(0),d=O(()=>m.value.length>0?m.value[r.value]:null);X(()=>a.images,M=>{m.value=M.map(F=>({...F})),a.show&&M.length>0?r.value=M.length-1:r.value=0,M.length===0&&a.show&&P()},{deep:!0,immediate:!0}),X(()=>a.show,M=>{M&&a.images.length>0&&(r.value=a.images.length-1)});const x=M=>M.preview||(M.image_path?`/${M.image_path}`:""),k=()=>{d.value&&(d.value.rotation=(d.value.rotation+90)%360)},y=()=>{r.value=r.value<m.value.length-1?r.value+1:0},s=()=>{r.value=r.value>0?r.value-1:m.value.length-1},f=M=>{h.value=M.touches[0].clientX},C=M=>{v.value=M.touches[0].clientX},$=()=>{h.value-v.value>50?y():v.value-h.value>50&&s(),h.value=0,v.value=0},j=()=>{a.isUploading||b("saveImages",m.value)},P=()=>{a.isUploading||b("close")},q=()=>{a.isUploading||b("triggerAddMorePhotos")};return(M,F)=>{var g;return e.show?(o(),i("div",os,[t("div",ls,[t("div",is,[t("button",{onClick:P,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},F[0]||(F[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",ns,N(((g=e.point)==null?void 0:g.name)||"Preview")+"/"+N(m.value.length)+") ",1),t("button",{onClick:k,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},F[1]||(F[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))]),t("div",rs,[t("div",{class:"relative w-full max-w-full",style:ue({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"}),onTouchstart:f,onTouchmove:C,onTouchend:$},[d.value?(o(),i("img",{key:0,src:x(d.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ue({transform:`rotate(${d.value.rotation}deg)`})},null,12,ds)):w("",!0)],36),m.value.length>1?(o(),i("button",{key:0,onClick:s,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},F[2]||(F[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):w("",!0),m.value.length>1?(o(),i("button",{key:1,onClick:y,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},F[3]||(F[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):w("",!0)]),t("div",us,[e.allowMultiple&&m.value.length<e.maxFiles?(o(),i("button",{key:0,onClick:q,class:"w-full px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium",disabled:e.isUploading}," Tambah Gambar ",8,cs)):w("",!0),t("div",ms,[t("button",{onClick:P,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:e.isUploading}," Batal ",8,gs),e.isUploading?(o(),i("button",vs,F[4]||(F[4]=[ce(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(o(),i("button",{key:0,onClick:j,class:"flex-1 px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"}," Simpan "))])])])])):w("",!0)}}},ps=le(hs,[["__scopeId","data-v-551cb9bd"]]),fs=["accept","multiple","disabled"],bs=["disabled"],ys={class:"h-full flex flex-col items-center justify-center p-4 text-center"},ws={class:"text-xs text-gray-400 mt-1"},xs={key:1,class:"block w-full border-2 border-dashed rounded-lg transition-colors duration-200 border-indigo-300 bg-indigo-50 h-auto p-2","aria-label":"Image gallery"},ks={class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},$s=["onClick"],Is=["src"],Vs={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ss={key:0},Cs={key:1,class:"ml-1"},_s=["onClick","disabled"],Ms=["disabled"],Us={key:2,class:"mt-1 text-xs text-red-600"},Ns={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:R}){const a=e,b=R,r=_(null),m=_(null),h=_(!1),v=_(!1),d=_(!1),x=_([]),k=_(0),y=_(!1),s=O(()=>Number(a.settings.max_files)>1),f=O(()=>a.settings.allowed_types.map(l=>`.${l}`).join(", ")),C=O(()=>{const l=a.settings.camera_aspect_ratio.split(":");if(l.length===2){const V=parseFloat(l[0]),p=parseFloat(l[1]);if(!isNaN(V)&&!isNaN(p)&&p!==0)return V/p}return 4/3}),$=O(()=>{const l=[],V=new Set;for(const p of x.value)p.id&&V.add(p.id),l.push(p);for(const p of a.modelValue)V.has(p.id)||l.push({...p,rotation:p.rotation||0,isNew:!1,preview:p.preview||(p.image_path?`/${p.image_path}`:null)});return l}),j=l=>l.preview||(l.image_path?`/${l.image_path}`:""),P=()=>{d.value&&(d.value=!1),h.value=!0},q=()=>{h.value=!1,r.value.click()},M=()=>{h.value=!1,v.value=!0},F=()=>{h.value=!1,$.value.length>0&&(d.value=!0)},g=()=>{v.value=!1,$.value.length>0&&(d.value=!0)},u=()=>{d.value=!1,x.value.forEach(l=>{l.preview&&l.preview.startsWith("blob:")&&URL.revokeObjectURL(l.preview)}),x.value=[]},n=l=>new Promise(V=>{const p=new FileReader;p.onload=B=>{const S=new Image;S.onload=()=>{V({file:l,preview:URL.createObjectURL(l),rotation:0,width:S.naturalWidth,height:S.naturalHeight,isNew:!0})},S.onerror=()=>{console.error("Failed to load image for dimensions:",l.name),V({file:l,preview:URL.createObjectURL(l),rotation:0,width:0,height:0,isNew:!0})},S.src=B.target.result},p.readAsDataURL(l)}),T=l=>{const V=l.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes(V)},H=async l=>{const p=(a.settings.max_size||2048)*1024;return new Promise(B=>{const S=new Image,c=new FileReader;c.onload=U=>{S.onload=()=>{const L=document.createElement("canvas"),D=L.getContext("2d"),E=Math.max(S.width,S.height);L.width=E,L.height=E,D.fillStyle="white",D.fillRect(0,0,E,E);const Z=(E-S.width)/2,J=(E-S.height)/2;D.drawImage(S,Z,J,S.width,S.height);let re=.9;const se=()=>{L.toBlob(pe=>{if(pe.size>p&&re>.1)re-=.1,se();else{const ke=new File([pe],l.name,{type:"image/jpeg",lastModified:Date.now()});B(ke)}},"image/jpeg",re)};se()},S.src=U.target.result},c.readAsDataURL(l)})},te=async l=>{const V=Array.from(l.target.files);if(!V.length){h.value=!1,$.value.length>0&&(d.value=!0);return}try{const p=V.filter(D=>!T(D));if(p.length>0){const D=p.map(E=>E.name.split(".").pop()).join(", ");alert(`File type not allowed: ${D}. Allowed types: ${a.settings.allowed_types.join(", ")}`),l.target.value="";return}const B=$.value.length,S=a.settings.max_files-B,c=await Promise.all(V.slice(0,S).map(async D=>await H(D))),U=await Promise.all(c.map(n)),L=s.value?U:U.slice(0,1);s.value?x.value.push(...L):(x.value.forEach(D=>{D.preview&&D.preview.startsWith("blob:")&&URL.revokeObjectURL(D.preview)}),x.value=L),h.value=!1,L.length>0?(k.value=Math.max(0,$.value.length-L.length),d.value=!0):$.value.length>0&&(d.value=!0),l.target.value=""}catch(p){console.error("Error processing selected images:",p),alert("Failed to process selected images. Please try again."),h.value=!1,$.value.length>0&&(d.value=!0)}},A=async l=>{const V=$.value.length;if(!s.value||V<a.settings.max_files)try{const p=await H(l),B=new Image;B.onload=()=>{const S={file:p,preview:URL.createObjectURL(p),rotation:0,width:B.naturalWidth,height:B.naturalHeight,isNew:!0};s.value?x.value.push(S):(x.value.forEach(c=>{c.preview&&c.preview.startsWith("blob:")&&URL.revokeObjectURL(c.preview)}),x.value=[S]),v.value=!1,h.value=!1,k.value=$.value.length-1,d.value=!0},B.src=URL.createObjectURL(p)}catch(p){console.error("Error processing captured image:",p),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),v.value=!1,h.value=!1,$.value.length>0&&(d.value=!0)},Y=(l=0)=>{k.value=l,d.value=!0},ae=l=>new Promise(V=>{if(l.rotation===0||!m.value){if(!l.isNew&&!l.file){V({file:null,width:l.width,height:l.height,isOriginal:!0});return}V({file:l.file,width:l.width,height:l.height});return}const p=new Image;p.onload=async()=>{try{const B=m.value,S=B.getContext("2d"),c=p.width,U=p.height;let L,D;l.rotation===90||l.rotation===270?(L=U,D=c):(L=c,D=U),B.width=L,B.height=D,S.clearRect(0,0,B.width,B.height),S.translate(B.width/2,B.height/2),S.rotate(l.rotation*Math.PI/180),S.drawImage(p,-c/2,-U/2,c,U),S.setTransform(1,0,0,1,0,0);const E=await new Promise(re=>{B.toBlob(re,"image/jpeg",.9)}),Z=new File([E],l.file?l.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),J=await H(Z);V({file:J,width:L,height:D})}catch(B){console.error("Error processing rotated image:",B),V({file:l.file,width:l.width,height:l.height})}},p.onerror=()=>{console.error("Failed to load image for rotation processing:",l.preview),V({file:l.file,width:l.width,height:l.height})},p.src=l.preview}),ie=async l=>{var p,B,S,c;y.value=!0;const V=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),y.value=!1;return}try{for(const U of l){if(!U.isNew&&U.rotation===0&&U.id&&U.image_path){V.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:0,preview:U.preview});continue}const{file:L,width:D,height:E,isOriginal:Z}=await ae(U);if(Z&&!U.isNew){V.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:0,preview:U.preview});continue}const J=new FormData;J.append("inspection_id",a.inspectionId),J.append("point_id",a.pointId),J.append("image",L),J.append("width",D),J.append("height",E),J.append("rotation",0),U.id&&!U.isNew&&J.append("image_id",U.id);const se=(await fe.post(route("inspections.upload-image"),J,{headers:{"Content-Type":"multipart/form-data"}})).data.image;V.push({id:se.id,image_path:se.image_path,width:se.width,height:se.height,rotation:se.rotation,preview:se.public_url}),U.preview&&U.preview.startsWith("blob:")&&URL.revokeObjectURL(U.preview)}b("update:modelValue",V),b("save",a.pointId),b("uploaded",{pointId:a.pointId,images:V}),u()}catch(U){if(console.error("Error during image processing/upload:",U),(B=(p=U.response)==null?void 0:p.data)!=null&&B.message)alert(`Failed to save images: ${U.response.data.message}`);else if((c=(S=U.response)==null?void 0:S.data)!=null&&c.errors){const L=Object.values(U.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${L}`)}else alert(`Failed to save images: ${U.message}`)}finally{y.value=!1}},ne=l=>{if(l){if(l.id&&!l.isNew)I(l);else{const V=x.value.findIndex(p=>p.preview&&p.preview===l.preview&&p.isNew||p.id&&p.id===l.id);if(V!==-1){const p=x.value.splice(V,1)[0];p.preview&&p.preview.startsWith("blob:")&&URL.revokeObjectURL(p.preview)}b("update:modelValue",a.modelValue.filter(p=>!(p.id&&p.id===l.id)&&!(p.preview&&p.preview===l.preview)))}k.value>=$.value.length&&(k.value=Math.max(0,$.value.length-1)),$.value.length===0&&u()}},I=async l=>{var p,B;if(l.id||l.image_path)try{await fe.delete(route("inspections.delete-image"),{data:{image_id:l.id,image_path:l.image_path}})}catch(S){console.error("Error deleting image from server:",S),(B=(p=S.response)==null?void 0:p.data)!=null&&B.message?alert(`Failed to delete image from server: ${S.response.data.message}`):alert(`Failed to delete image from server: ${S.message}`);return}l.preview&&l.preview.startsWith("blob:")&&URL.revokeObjectURL(l.preview);const V=a.modelValue.filter(S=>S.id!==l.id);b("update:modelValue",V),x.value=x.value.filter(S=>S.isNew&&l.isNew?S.preview!==l.preview:S.id!==l.id),b("removeImage",{image:l}),d.value&&$.value.length===0?u():d.value&&k.value>=$.value.length&&(k.value=Math.max(0,$.value.length-1))};return(l,V)=>(o(),i("div",null,[t("input",{ref_key:"galleryInput",ref:r,type:"file",accept:f.value,class:"hidden",onChange:te,multiple:s.value,disabled:y.value},null,40,fs),t("canvas",{ref_key:"processingCanvas",ref:m,class:"hidden"},null,512),$.value.length===0?(o(),i("label",{key:0,onClick:P,class:ee(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:y.value},[t("div",ys,[V[0]||(V[0]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),V[1]||(V[1]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),V[2]||(V[2]=t("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),t("p",ws,"Allowed types: "+N(f.value),1)])],8,bs)):(o(),i("div",xs,[t("div",ks,[(o(!0),i(z,null,W($.value,(p,B)=>(o(),i("div",{key:p.id||p.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:S=>Y(B)},[t("img",{src:j(p),class:"w-full h-full object-cover"},null,8,Is),p.isNew||p.rotation!==0?(o(),i("div",Vs,[p.isNew?(o(),i("span",Ss,"BARU")):w("",!0),p.rotation!==0?(o(),i("span",Cs,"ROTASI")):w("",!0)])):w("",!0),t("button",{onClick:Ve(S=>I(p),["stop"]),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm hover:bg-red-600 transition-colors z-10","aria-label":"Remove image",disabled:y.value}," × ",8,_s)],8,$s))),128)),s.value&&$.value.length<e.settings.max_files?(o(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:P,disabled:y.value},V[3]||(V[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Ms)):w("",!0)])])),e.error?(o(),i("p",Us,N(e.error),1)):w("",!0),de(Wt,{show:h.value,onClose:F,onOpenWebcam:M,onTriggerGallery:q},null,8,["show"]),de(as,{show:v.value,"aspect-ratio":C.value,settings:e.settings,point:e.point,onClose:g,onPhotoCaptured:A},null,8,["show","aspect-ratio","settings","point"]),de(ps,{show:d.value,images:$.value,point:e.point,"initial-index":k.value,"allow-multiple":s.value,"max-files":e.settings.max_files,"is-uploading":y.value,"aspect-ratio":C.value,onClose:u,onSaveImages:ie,onRemovePreviewImage:ne,onTriggerAddMorePhotos:P},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},ve=le(Ns,[["__scopeId","data-v-dd6408cb"]]),qs={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Rs={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Bs={class:"px-4 pb-2 border-b border-gray-200"},js={class:"text-lg font-semibold text-gray-900"},Ps={key:0,class:"text-sm text-gray-500 mt-1"},Fs={class:"flex-1 overflow-y-auto p-4"},Ts={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Ds={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:R}){const a=R,b=()=>{a("close")},r=m=>{m.key==="Escape"&&b()};return he(()=>{document.addEventListener("keydown",r)}),Se(()=>{document.removeEventListener("keydown",r)}),(m,h)=>(o(),G(Ce,{name:"bottom-sheet"},{default:ge(()=>[e.show?(o(),i("div",qs,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:b}),t("div",Rs,[h[0]||(h[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",Bs,[t("h3",js,N(e.title),1),e.subtitle?(o(),i("p",Ps,N(e.subtitle),1)):w("",!0)]),t("div",Fs,[be(m.$slots,"default",{},void 0,!0)]),m.$slots.footer?(o(),i("div",Ts,[be(m.$slots,"footer",{},void 0,!0)])):w("",!0)])])):w("",!0)]),_:3}))}},Ls=le(Ds,[["__scopeId","data-v-7893c2dc"]]),As={class:"space-y-4"},Es={key:0,class:"mt-2"},Hs={class:"text-sm font-medium text-gray-700 mb-2"},Os={key:0,class:"text-red-500"},zs={key:0,class:"text-xs text-red-500"},Ws={key:1,class:"grid grid-cols-2 gap-2"},Ks=["name","value","checked"],Gs={key:2,class:"space-y-2"},Xs={key:0,class:"text-red-500"},Zs={key:1,class:"text-xs text-red-500"},Js={key:3,class:"mt-4"},Ys={class:"text-sm font-medium text-gray-700 mb-2"},Qs={key:0,class:"text-red-500"},ea={key:0,class:"text-xs text-red-500"},ta={class:"flex gap-2"},sa=["disabled"],xe={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(e,{emit:R}){const a=e,b=R,r=v=>b("hapus",v),m=O(()=>a.options.find(v=>v.value===a.selectedValue)),h=O(()=>{var d,x,k;if(a.point.input_type==="imageTOradio"&&a.imagesValue.length===0||a.options.length&&!a.selectedValue)return!1;const v=m.value;return!(a.showTextarea&&((d=v==null?void 0:v.settings)!=null&&d.show_textarea)&&(!((x=a.notesValue)!=null&&x.trim())||v.settings.min_length&&a.notesValue.length<v.settings.min_length||v.settings.max_length&&a.notesValue.length>v.settings.max_length)||a.showImageUpload&&((k=v==null?void 0:v.settings)!=null&&k.show_image_upload)&&(a.imagesValue.length===0||v.settings.max_files&&a.imagesValue.length>v.settings.max_files))});return(v,d)=>(o(),G(Ls,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:d[10]||(d[10]=x=>v.$emit("close"))},{footer:ge(()=>[e.selectedPoint?(o(),i("button",{key:0,onClick:d[7]||(d[7]=x=>r(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},d[12]||(d[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ce(" Hapus Data ")]))):w("",!0),t("div",ta,[t("button",{type:"button",onClick:d[8]||(d[8]=x=>v.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:d[9]||(d[9]=x=>v.$emit("save")),disabled:!h.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,sa)])]),default:ge(()=>{var x,k,y,s,f,C,$,j,P,q,M,F,g,u;return[t("div",As,[e.point.input_type==="imageTOradio"?(o(),i("div",Es,[t("h4",Hs,[(x=e.point.settings)!=null&&x.required?(o(),i("span",Os,"*")):w("",!0)]),de(ve,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":d[0]||(d[0]=n=>v.$emit("update:imagesValue",n)),onSave:d[1]||(d[1]=n=>v.$emit("saveImage",n))},null,8,["model-value","point-id","point","inspection-id","settings"]),(k=e.point.settings)!=null&&k.required&&e.imagesValue.length===0?(o(),i("p",zs," Foto wajib diupload ")):w("",!0)])):w("",!0),e.options.length?(o(),i("div",Ws,[(o(!0),i(z,null,W(e.options,(n,T)=>(o(),i("label",{key:T,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:n.value,checked:e.selectedValue===n.value,onChange:d[2]||(d[2]=H=>v.$emit("update:selectedValue",H.target.value)),class:"hidden peer"},null,40,Ks),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===n.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==n.value}])},N(n.label),3)]))),128))])):w("",!0),e.showTextarea&&((s=(y=m.value)==null?void 0:y.settings)!=null&&s.show_textarea)?(o(),i("div",Gs,[(f=m.value.settings)!=null&&f.required?(o(),i("span",Xs,"*")):w("",!0),de(we,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:m.value.settings,required:(C=m.value.settings)==null?void 0:C.required,"min-length":($=m.value.settings)==null?void 0:$.min_length,"max-length":(j=m.value.settings)==null?void 0:j.max_length,placeholder:((P=m.value.settings)==null?void 0:P.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":d[3]||(d[3]=n=>v.$emit("update:notesValue",n)),onSave:d[4]||(d[4]=n=>v.$emit("saveTextarea",n))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(q=m.value.settings)!=null&&q.required&&!e.notesValue?(o(),i("p",Zs," Keterangan wajib diisi ")):w("",!0)])):w("",!0),e.showImageUpload&&((F=(M=m.value)==null?void 0:M.settings)!=null&&F.show_image_upload)?(o(),i("div",Js,[t("h4",Ys,[d[11]||(d[11]=ce(" Upload Foto ")),(g=m.value.settings)!=null&&g.required?(o(),i("span",Qs,"*")):w("",!0)]),de(ve,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:m.value.settings,"onUpdate:modelValue":d[5]||(d[5]=n=>v.$emit("update:imagesValue",n)),onSave:d[6]||(d[6]=n=>v.$emit("saveImage",n))},null,8,["model-value","point-id","point","inspection-id","settings"]),(u=m.value.settings)!=null&&u.required&&e.imagesValue.length===0?(o(),i("p",ea," Foto wajib diupload ")):w("",!0)])):w("",!0)])]}),_:1},8,["show","title","subtitle"]))}},aa={class:"mt-2 space-y-4"},oa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},la=["name","value","checked","onChange","required"],ia={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},na={key:0,class:"mt-3"},ra={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},da=["src"],ua={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ca={key:1,class:"mt-2"},ma={class:"text-sm text-gray-600"},ga={key:2,class:"mt-2 text-sm text-red-600"},va={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:R}){const a=e,b=R,r=_(a.notes),m=_([...a.images]),h=_(!1),v=_(""),d=_([]),x=_(""),k=_([]),y=O(()=>a.options.find(g=>g.value===a.modelValue)),s=g=>g.settings&&(g.settings.show_textarea||g.settings.show_image_upload);X(()=>a.notes,g=>{r.value=g}),X(()=>a.images,g=>{m.value=[...g]}),X(()=>a.modelValue,g=>{g&&(x.value=g)});const f=g=>{b("update:modelValue",g.value),s(g)?$():b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:g.value,notes:"",images:[]})},C=g=>g.preview||(g.image_path?`/${g.image_path}`:g),$=()=>{x.value=a.modelValue,v.value=r.value,d.value=[...m.value],k.value=[...m.value],h.value=!0},j=()=>{v.value="",d.value=[],x.value="",h.value=!1},P=g=>{d.value=g,m.value=[...g],b("update:images",[...g]),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:r.value,images:[...g]})},q=g=>{},M=()=>{x.value!==a.modelValue&&b("update:modelValue",x.value),r.value=v.value,b("update:notes",v.value),m.value=[...d.value],b("update:images",[...d.value]),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:x.value,notes:v.value,images:d.value}),h.value=!1},F=g=>{b("hapus",g),h.value=!1};return(g,u)=>{var n,T,H,te;return o(),i("div",aa,[t("div",oa,[(o(!0),i(z,null,W(e.options,(A,Y)=>(o(),i("label",{key:Y,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:A.value,checked:e.modelValue===A.value,onChange:ae=>f(A),class:"hidden peer",required:e.required},null,40,la),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===A.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==A.value}])},N(A.label),3)]))),128))]),e.modelValue&&y.value&&s(y.value)?(o(),i("div",ia,[t("div",{class:"flex justify-between items-start"},[u[4]||(u[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:$,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((n=y.value.settings)!=null&&n.show_image_upload)?(o(),i("div",na,[t("div",ra,[(o(!0),i(z,null,W(e.images,(A,Y)=>(o(),i("div",{key:Y,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:C(A),class:"w-full h-full object-cover rounded"},null,8,da),Y===3&&e.images.length>4?(o(),i("span",ua," +"+N(e.images.length-4),1)):w("",!0)]))),128))])])):w("",!0),e.notes&&((T=y.value.settings)!=null&&T.show_textarea)?(o(),i("div",ca,[t("p",ma,N(e.notes),1)])):w("",!0)])):w("",!0),h.value?(o(),G(xe,{key:(H=e.selectedPoint)==null?void 0:H.id,show:h.value,title:e.pointName||"Detail",subtitle:(te=y.value)==null?void 0:te.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":x.value,"notes-value":v.value,"images-value":d.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":u[0]||(u[0]=A=>x.value=A),"onUpdate:notesValue":u[1]||(u[1]=A=>v.value=A),"onUpdate:imagesValue":u[2]||(u[2]=A=>P(A)),onClose:j,onSave:M,onSaveTextarea:g.handleTextareaSave,onSaveImage:q,onHapus:u[3]||(u[3]=A=>F(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):w("",!0),e.error?(o(),i("p",ga,N(e.error),1)):w("",!0)])}}},ha={class:"mt-2 space-y-4"},pa={key:0,class:"flex flex-wrap gap-3"},fa={key:1,class:"p-4 border rounded-lg bg-gray-50"},ba={key:0,class:"mt-3"},ya={class:"flex gap-2 overflow-x-auto scrollbar-hide"},wa=["src"],xa={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ka={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},$a=["name","value","checked"],Ia={key:1,class:"mt-2"},Va={class:"text-sm text-gray-600"},Sa={key:3,class:"mt-2 text-sm text-red-600"},Ca={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:R}){const a=e,b=R,r=_(a.notes),m=_([...a.images]),h=_(!1),v=_(""),d=_([]),x=_(""),k=_([]),y=O(()=>a.options.find(q=>q.value===a.modelValue)),s=q=>q.preview||(q.image_path?`/${q.image_path}`:q),f=()=>{x.value=a.modelValue||"",v.value=r.value,d.value=[...m.value],k.value=[...m.value],h.value=!0},C=()=>{v.value="",d.value=[],x.value="",h.value=!1},$=q=>{d.value=q,m.value=[...q],b("update:images",[...q]),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:r.value,images:[...q]})},j=()=>{x.value!==a.modelValue&&b("update:modelValue",x.value),r.value=v.value,b("update:notes",v.value),m.value=[...d.value],b("update:images",[...d.value]),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:x.value,notes:v.value,images:d.value}),h.value=!1},P=q=>{b("hapus",q),h.value=!1};return(q,M)=>{var F,g,u;return o(),i("div",ha,[!e.modelValue&&m.value.length===0&&!r.value?(o(),i("div",pa,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:f},M[4]||(M[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(o(),i("div",fa,[t("div",{class:"flex justify-between items-start"},[M[5]||(M[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:f,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),m.value.length>0?(o(),i("div",ba,[t("div",ya,[(o(!0),i(z,null,W(m.value,(n,T)=>(o(),i("div",{key:T,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:s(n),class:"w-full h-full object-cover rounded"},null,8,wa),T===3&&m.value.length>4?(o(),i("span",xa," +"+N(m.value.length-4),1)):w("",!0)]))),128))])])):w("",!0),t("div",ka,[(o(!0),i(z,null,W(e.options,(n,T)=>(o(),i("label",{key:T,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:n.value,checked:e.modelValue===n.value,disabled:!0,class:"hidden peer"},null,8,$a),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===n.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==n.value}])},N(n.label),3)]))),128))]),r.value&&((F=y.value.settings)!=null&&F.show_textarea)?(o(),i("div",Ia,[t("p",Va,N(r.value),1)])):w("",!0)])),h.value?(o(),G(xe,{key:(g=e.selectedPoint)==null?void 0:g.id,show:h.value,title:e.pointName||"Detail",subtitle:(u=y.value)==null?void 0:u.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":x.value,"notes-value":v.value,"images-value":d.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":M[0]||(M[0]=n=>x.value=n),"onUpdate:notesValue":M[1]||(M[1]=n=>v.value=n),"onUpdate:imagesValue":M[2]||(M[2]=n=>$(n)),onClose:C,onSave:j,onHapus:M[3]||(M[3]=n=>P(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):w("",!0),e.error?(o(),i("p",Sa,N(e.error),1)):w("",!0)])}}},_a={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ma={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},Ua={class:"text-xl font-semibold text-indigo-700"},Na={class:"p-4 space-y-4"},qa={class:"flex items-start justify-between"},Ra={class:"block text-sm font-medium text-gray-700"},Ba={key:0,class:"text-red-500"},ja={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Pa={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:[String,Number],selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(e,{emit:R}){const a=e,b=R,r=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],m=k=>{var s;const y=a.form.results[k.id];if(!y)return!1;switch(k.input_type){case"text":case"number":case"date":case"account":return!!y.note;case"select":case"radio":return!!y.status;case"image":return((s=y.images)==null?void 0:s.length)>0;default:return!1}},h=(k,y)=>{b("updateResult",{pointId:k,value:y})},v=k=>{b("saveResult",k)},d=(k,y)=>{b("removeImage",{pointId:k,imageIndex:y})},x=k=>{b("hapusPoint",k)};return(k,y)=>(o(),i("div",_a,[t("div",Ma,[t("h2",Ua,N(e.category.name),1)]),t("div",Na,[(o(!0),i(z,null,W(e.category.points,s=>{var f,C,$,j,P,q,M,F,g,u,n,T,H,te,A,Y,ae,ie,ne,I,l,V,p,B,S;return o(),i("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",qa,[t("label",Ra,[ce(N(s.name)+" ",1),(f=s.settings)!=null&&f.is_required?(o(),i("span",Ba,"*")):w("",!0)]),m(s)?(o(),i("span",ja," ✓ ")):w("",!0)]),s.input_type==="text"?(o(),G(pt,{key:0,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[c=>e.form.results[s.id].note=c,c=>h(s.id,c)],required:(C=s.settings)==null?void 0:C.is_required,"min-length":($=s.settings)==null?void 0:$.min_length,"max-length":(j=s.settings)==null?void 0:j.max_length,pattern:(P=s.settings)==null?void 0:P.pattern,placeholder:((q=s.settings)==null?void 0:q.placeholder)||"Masukan text",error:e.form.errors[`results.${s.id}.note`],onSave:c=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):w("",!0),s.input_type==="number"?(o(),G(wt,{key:1,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[c=>e.form.results[s.id].note=c,c=>h(s.id,c)],required:(M=s.settings)==null?void 0:M.is_required,min:(F=s.settings)==null?void 0:F.min,max:(g=s.settings)==null?void 0:g.max,step:((u=s.settings)==null?void 0:u.step)||1,placeholder:((n=s.settings)==null?void 0:n.placeholder)||"Masukan number",error:e.form.errors[`results.${s.id}.note`],onSave:c=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):w("",!0),s.input_type==="account"?(o(),G(_t,{key:2,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[c=>e.form.results[s.id].note=c,c=>h(s.id,c)],required:(T=s.settings)==null?void 0:T.is_required,placeholder:((H=s.settings)==null?void 0:H.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:c=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):w("",!0),s.input_type==="date"?(o(),G(It,{key:3,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[c=>e.form.results[s.id].note=c,c=>h(s.id,c)],required:(te=s.settings)==null?void 0:te.is_required,"min-date":(A=s.settings)==null?void 0:A.min_date,"max-date":(Y=s.settings)==null?void 0:Y.max_date,error:e.form.errors[`results.${s.id}.note`],onSave:c=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):w("",!0),s.input_type==="textarea"?(o(),G(we,{key:4,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[c=>e.form.results[s.id].note=c,c=>h(s.id,c)],required:(ae=s.settings)==null?void 0:ae.is_required,"min-length":(ie=s.settings)==null?void 0:ie.min_length,"max-length":(ne=s.settings)==null?void 0:ne.max_length,placeholder:((I=s.settings)==null?void 0:I.placeholder)||"Masukkan teks di sini",settings:s.settings,error:e.form.errors[`results.${s.id}.note`],onSave:c=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):w("",!0),s.input_type==="radio"?(o(),G(va,{key:5,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[c=>e.form.results[s.id].status=c,c=>h(s.id,c)],notes:e.form.results[s.id].note,images:e.form.results[s.id].images,required:(l=s.settings)==null?void 0:l.is_required,"point-id":s.id,point:s,"inspection-id":e.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((V=s.settings)==null?void 0:V.radios)||r,error:e.form.errors[`results.${s.id}.status`],"onUpdate:notes":c=>e.form.results[s.id].note=c,"onUpdate:images":c=>e.form.results[s.id].images=c,onSave:c=>v(s.id),onHapus:c=>x(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):w("",!0),s.input_type==="imageTOradio"?(o(),G(Ca,{key:6,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[c=>e.form.results[s.id].status=c,c=>h(s.id,c)],notes:e.form.results[s.id].note,images:e.form.results[s.id].images,required:(p=s.settings)==null?void 0:p.is_required,"point-id":s.id,"inspection-id":e.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((B=s.settings)==null?void 0:B.radios)||r,error:e.form.errors[`results.${s.id}.status`],"onUpdate:notes":c=>e.form.results[s.id].note=c,"onUpdate:images":c=>e.form.results[s.id].images=c,onSave:c=>v(s.id),onHapus:c=>x(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):w("",!0),s.input_type==="image"?(o(),G(ve,{key:7,modelValue:e.form.results[s.id].images,"onUpdate:modelValue":[c=>e.form.results[s.id].images=c,c=>h(s.id,c)],error:e.form.errors[`results.${s.id}.images`],"inspection-id":e.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,onSave:c=>v(s.id),onRemoveImage:c=>d(s.id,c),"onUpdate:notes":c=>e.form.results[s.id].note=c,"onUpdate:status":c=>e.form.results[s.id].status=c},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onSave","onRemoveImage","onUpdate:notes","onUpdate:status"])):w("",!0),s.input_type==="select"?(o(),G(At,{key:8,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[c=>e.form.results[s.id].status=c,c=>h(s.id,c)],required:(S=s.settings)==null?void 0:S.is_required,error:e.form.errors[`results.${s.id}.status`],onSave:c=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):w("",!0)])}),128))])]))}},Ja=le(Pa,[["__scopeId","data-v-d6938e9d"]]),Fa={class:"bg-white rounded-xl shadow-md p-4"},Ta={class:"mb-6"},Da={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},La=["value"],Aa={class:"mb-6"},Ea={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ha=["value"],Oa={key:0,class:"mt-4"},za={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Wa=["value"],Ya={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const R=e,a=y=>{if(!y)return{};if(typeof y=="string")try{return JSON.parse(y)||{}}catch(s){return console.error("Error parsing settings JSON:",s),{}}return typeof y=="object"&&y!==null?y:{}},b=O(()=>a(R.inspection.settings).conclusion||{}),r=_({flooded:b.value.flooded||"",collision:b.value.collision||"",collision_severity:b.value.collision_severity||"",conclusion_note:R.inspection.notes||""}),m=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],h=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],v=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],d=()=>{const y={flooded:r.value.flooded,collision:r.value.collision,collision_severity:r.value.collision==="yes"?r.value.collision_severity:null,conclusion_note:r.value.conclusion_note};_e.post(route("inspections.updateConclusion",R.inspectionId),y,{preserveScroll:!0,preserveState:!0,onError:s=>{console.error("Error saving conclusion:",s)}})},x=ye.debounce(d,500);X([()=>r.value.flooded,()=>r.value.collision,()=>r.value.collision_severity],()=>{d()}),he(()=>{k()}),X(()=>R.inspection,()=>{k()},{deep:!0});const k=()=>{const s=a(R.inspection.settings).conclusion||{};r.value={flooded:s.flooded||"",collision:s.collision||"",collision_severity:s.collision_severity||"",conclusion_note:R.inspection.notes||""}};return(y,s)=>(o(),i("div",Fa,[s[9]||(s[9]=t("h4",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),t("div",Ta,[s[5]||(s[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),t("div",Da,[(o(),i(z,null,W(m,f=>t("label",{key:f.value,class:"cursor-pointer"},[Q(t("input",{type:"radio","onUpdate:modelValue":s[0]||(s[0]=C=>r.value.flooded=C),value:f.value,class:"hidden peer"},null,8,La),[[me,r.value.flooded]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.flooded===f.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.flooded!==f.value}])},N(f.label),3)])),64))])]),t("div",Aa,[s[7]||(s[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),t("div",Ea,[(o(),i(z,null,W(h,f=>t("label",{key:f.value,class:"cursor-pointer"},[Q(t("input",{type:"radio","onUpdate:modelValue":s[1]||(s[1]=C=>r.value.collision=C),value:f.value,class:"hidden peer"},null,8,Ha),[[me,r.value.collision]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision===f.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision!==f.value}])},N(f.label),3)])),64))]),r.value.collision==="yes"?(o(),i("div",Oa,[s[6]||(s[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),t("div",za,[(o(),i(z,null,W(v,f=>t("label",{key:f.value,class:"cursor-pointer"},[Q(t("input",{type:"radio","onUpdate:modelValue":s[2]||(s[2]=C=>r.value.collision_severity=C),value:f.value,class:"hidden peer"},null,8,Wa),[[me,r.value.collision_severity]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision_severity===f.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision_severity!==f.value}])},N(f.label),3)])),64))])])):w("",!0)]),t("div",null,[s[8]||(s[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),Q(t("textarea",{"onUpdate:modelValue":s[3]||(s[3]=f=>r.value.conclusion_note=f),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:s[4]||(s[4]=(...f)=>K(x)&&K(x)(...f))},null,544),[[oe,r.value.conclusion_note]])])]))}};export{Ls as B,Ja as C,Za as V,Ya as _,xe as a};
