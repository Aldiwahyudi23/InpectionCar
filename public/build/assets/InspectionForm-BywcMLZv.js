import{x as Ne,d as _,m as ke,z as je,A as oe,e as i,o as n,a as e,f as w,b as de,p as ce,v as we,u as Z,F as ae,h as ne,t as A,g as ue,k as be,w as me,l as Q,n as re,C as De,D as ye,E as Me,c as se,r as Ue,T as Ce,G as Ie,W as Ve,H as qe}from"./app-VqX86oZW.js";import{l as xe}from"./lodash-CwfXLvW-.js";import{_ as Ae}from"./PrimaryButton-Das6jCiN.js";import{_ as Be}from"./ActionMessage-CTmnr9tx.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Te}from"./InputNumber-XIIp7qpf.js";const Le={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Fe={key:0,class:"p-4 space-y-4"},Ee={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},He={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},ze={class:"relative"},Oe={key:0,class:"absolute right-3 top-3"},We={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ke={key:0},Xe=["onMousedown"],Ge={class:"font-medium text-gray-900"},Je={class:"text-sm text-gray-500"},Ze={key:1,class:"p-4 text-sm text-gray-500 text-center"},Qe={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ye={key:0,class:"mb-4"},et=["innerHTML"],tt={key:1},st={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ot=["onClick"],at=["src","alt"],nt={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},it={class:"text-white text-xs text-center"},lt={key:2,class:"text-center py-4 text-gray-500 text-sm"},rt={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},ut=["src","alt"],dt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},ct={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},mt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},gt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(t,{emit:M}){var H,W,Y,ie;const o=t,$=M,l=Ne({plate_number:((H=o.inspection)==null?void 0:H.plate_number)||"",car_id:((W=o.inspection)==null?void 0:W.car_id)||null,car_name:((ie=(Y=o.inspection)==null?void 0:Y.car)==null?void 0:ie.name)||""}),r=_(l.car_name),h=_(!1),v=_(!1),d=_([]),f=_(null),x=_([]),s=_(!1),y=_(0);ke(()=>{var S,C,k,a;if((S=o.inspection)!=null&&S.car_id&&((C=o.CarDetail)==null?void 0:C.length)>0){const b=o.CarDetail.find(m=>m.id===o.inspection.car_id);b&&F(b)}else!((k=o.inspection)!=null&&k.car_id)&&((a=o.inspection)!=null&&a.car_name)&&(r.value=o.inspection.car_name);window.addEventListener("keydown",j)}),je(()=>{window.removeEventListener("keydown",j)}),oe(r,S=>{l.car_id&&p(f.value)!==S&&(l.car_id=null,f.value=null,x.value=[]),l.car_name=S});const p=S=>{var k,a,b;if(!S)return"";const C=[];return(k=S.brand)!=null&&k.name&&C.push(S.brand.name),(a=S.model)!=null&&a.name&&C.push(S.model.name),(b=S.type)!=null&&b.name&&C.push(S.type.name),S.cc&&C.push(`${S.cc}cc`),S.transmission&&C.push(S.transmission),S.fuel_type&&C.push(S.fuel_type),S.year&&C.push(S.year.toString()),S.production_period&&C.push(`(${S.production_period})`),C.join(" ")},U=xe.debounce(()=>{if(!r.value.trim()){d.value=[],h.value=!1;return}v.value=!0;try{const S=r.value.toLowerCase().trim();d.value=o.CarDetail.filter(C=>p(C).toLowerCase().includes(S)),h.value=!0}finally{v.value=!1}},300),V=()=>{setTimeout(()=>{h.value=!1},200)},F=async S=>{f.value=S,r.value=p(S),l.car_id=S.id,l.car_name=p(S),h.value=!1,await R(S.id),X()},L=S=>!S||!S.file_path?"":`/storage/${S.file_path}`,R=async S=>{try{const C=await fetch(`/api/cars/${S}/images`);if(C.ok){const k=await C.json();x.value=Array.isArray(k)?k:[]}else x.value=[]}catch(C){console.error("Error loading car images:",C),x.value=[]}},E=S=>{y.value=S,s.value=!0,document.body.style.overflow="hidden"},B=()=>{s.value=!1,document.body.style.overflow=""},I=()=>{y.value=(y.value+1)%x.value.length},N=()=>{y.value=(y.value-1+x.value.length)%x.value.length},j=S=>{if(s.value)switch(S.key){case"Escape":B();break;case"ArrowRight":I();break;case"ArrowLeft":N();break}},X=()=>{const S={plate_number:l.plate_number,car_id:l.car_id,car_name:l.car_name};$("update-vehicle",S)},te=()=>{o.inspection&&l.post(route("inspections.updateVehicleDetails",{inspection:o.inspection.id}),{preserveScroll:!0})};return oe(()=>o.inspection,S=>{var C;if(S)if(l.plate_number=S.plate_number||"",l.car_id=S.car_id||null,S.car_id&&((C=o.CarDetail)==null?void 0:C.length)>0){const k=o.CarDetail.find(a=>a.id===S.car_id);k&&F(k)}else S.car_name&&(r.value=S.car_name,l.car_name=S.car_name)},{deep:!0}),(S,C)=>{var k;return n(),i("div",Le,[C[17]||(C[17]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(n(),i("div",Fe,[e("div",Ee,[C[6]||(C[6]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nomor Plat Kendaraan ",-1)),ce(e("input",{"onUpdate:modelValue":C[0]||(C[0]=a=>Z(l).plate_number=a),type:"text",placeholder:"Contoh: B 1234 ABC",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:X},null,544),[[we,Z(l).plate_number]])]),e("div",He,[C[9]||(C[9]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",ze,[ce(e("input",{"onUpdate:modelValue":C[1]||(C[1]=a=>r.value=a),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:C[2]||(C[2]=(...a)=>Z(U)&&Z(U)(...a)),onFocus:C[3]||(C[3]=a=>h.value=!0),onBlur:V},null,544),[[we,r.value]]),v.value?(n(),i("div",Oe,C[7]||(C[7]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):w("",!0),h.value?(n(),i("div",We,[d.value.length>0?(n(),i("div",Ke,[(n(!0),i(ae,null,ne(d.value,a=>(n(),i("div",{key:a.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:b=>F(a)},[e("div",Ge,A(p(a)),1),e("div",Je,A(a.year)+" • "+A(a.cc)+"cc • "+A(a.transmission)+" • "+A(a.fuel_type),1)],40,Xe))),128))])):(n(),i("div",Ze,C[8]||(C[8]=[ue(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),ue(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):w("",!0)]),ce(e("input",{type:"hidden","onUpdate:modelValue":C[4]||(C[4]=a=>Z(l).car_id=a)},null,512),[[we,Z(l).car_id]])]),Z(l).car_id&&f.value?(n(),i("div",Qe,[f.value.description?(n(),i("div",Ye,[C[10]||(C[10]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:f.value.description},null,8,et)])):w("",!0),x.value.length>0?(n(),i("div",tt,[C[11]||(C[11]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",st,[(n(!0),i(ae,null,ne(x.value,(a,b)=>(n(),i("div",{key:a.id||b,class:"relative group cursor-pointer",onClick:m=>E(b)},[e("img",{src:L(a),alt:a.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,at),a.note?(n(),i("div",nt,[e("p",it,A(a.note),1)])):w("",!0)],8,ot))),128))])])):(n(),i("div",lt," Tidak ada gambar tersedia untuk mobil ini "))])):w("",!0),s.value?(n(),i("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:B},[e("div",rt,[e("button",{onClick:B,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},C[12]||(C[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),x.value.length>1?(n(),i("button",{key:0,onClick:be(N,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},C[13]||(C[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):w("",!0),x.value.length>1?(n(),i("button",{key:1,onClick:be(I,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},C[14]||(C[14]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):w("",!0),e("img",{src:L(x.value[y.value]),alt:"Car Image "+(y.value+1),class:"max-w-full max-h-full object-contain",onClick:C[5]||(C[5]=be(()=>{},["stop"]))},null,8,ut),x.value.length>1?(n(),i("div",dt,A(y.value+1)+" / "+A(x.value.length),1)):w("",!0),(k=x.value[y.value])!=null&&k.note?(n(),i("div",ct,A(x.value[y.value].note),1)):w("",!0)])])):w("",!0),de(Ae,{type:"button",onClick:te,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},{default:me(()=>[Z(l).processing?(n(),i("svg",mt,C[15]||(C[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):w("",!0),e("span",null,A(Z(l).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),de(Be,{on:Z(l).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:me(()=>C[16]||(C[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ue(" Tersimpan. ")])),_:1,__:[16]},8,["on"])]),_:1})])):w("",!0)])}}},vt=ge(gt,[["__scopeId","data-v-04b281af"]]),pt={class:"mt-1"},ht=["value","required","minlength","maxlength","pattern","placeholder"],ft={key:0,class:"mt-2 text-sm text-red-600"},wt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:M}){const o=t,$=M,l=r=>{$("update:modelValue",r.target.value),$("save",o.pointId)};return(r,h)=>(n(),i("div",pt,[e("input",{value:t.modelValue,onInput:l,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,pattern:t.pattern,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ht),t.error?(n(),i("p",ft,A(t.error),1)):w("",!0)]))}},yt={class:"mt-1"},bt=["value","required","min","max"],xt={key:0,class:"mt-2 text-sm text-red-600"},kt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:M}){const o=t,$=M,l=r=>{$("update:modelValue",r.target.value),$("save",o.pointId)};return(r,h)=>(n(),i("div",yt,[e("input",{value:t.modelValue,onChange:l,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,bt),t.error?(n(),i("p",xt,A(t.error),1)):w("",!0)]))}},$t={class:"mt-1"},It=["value","required","placeholder"],Ct={key:0,class:"mt-2 text-sm text-red-600"},Vt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:M}){const o=t,$=M,l=_(""),r=_(!1),h=Q(()=>{var p,U,V,F;return{currency_symbol:((p=o.settings)==null?void 0:p.currency_symbol)||"Rp",thousands_separator:((U=o.settings)==null?void 0:U.thousands_separator)||",",min_value:((V=o.settings)==null?void 0:V.min_value)!==void 0?Number(o.settings.min_value):0,max_value:((F=o.settings)==null?void 0:F.max_value)!==void 0?Number(o.settings.max_value):1e9}}),v=p=>{if(p==null||p==="")return"";const U=Number(p);if(isNaN(U))return"";let V=U.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return h.value.thousands_separator!==","&&(V=V.replace(/,/g,h.value.thousands_separator)),V},d=p=>p?p.replace(/[^\d]/g,""):"",f=Q(()=>{if(r.value)return l.value;const p=v(o.modelValue);return p?`${h.value.currency_symbol} ${p}`:""}),x=p=>{const U=p.target.value;l.value=U;const V=d(U);$("update:modelValue",V),$("save",o.pointId)},s=()=>{var p;r.value=!0,l.value=((p=o.modelValue)==null?void 0:p.toString())||""},y=()=>{r.value=!1;const p=d(l.value);if(p){const U=Number(p);let V=p;h.value.min_value!==void 0&&U<h.value.min_value&&(V=h.value.min_value.toString()),h.value.max_value!==void 0&&U>h.value.max_value&&(V=h.value.max_value.toString()),V!==p&&($("update:modelValue",V),$("save",o.pointId))}};return oe(()=>o.modelValue,p=>{!r.value&&p!==void 0&&p!==null&&(l.value=p.toString())},{immediate:!0}),(p,U)=>(n(),i("div",$t,[e("input",{value:f.value,onInput:x,onBlur:y,onFocus:s,type:"text",required:t.required,placeholder:t.placeholder,class:re(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,It),t.error?(n(),i("p",Ct,A(t.error),1)):w("",!0)]))}},St={class:"mt-1 space-y-3"},_t={key:0,class:"space-y-2"},Mt={class:"flex flex-wrap gap-2"},Ut=["onClick"],Nt=["value","required","minlength","maxlength","placeholder"],jt={class:"flex justify-between items-center mt-1"},Rt={class:"text-xs text-gray-500"},Pt={key:0,class:"text-xs text-red-600"},Re={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:M}){const o=t,$=M,l=_([]),r=_(""),h=x=>l.value.some(s=>s.value===x),v=x=>{h(x.value)?l.value=l.value.filter(U=>U.value!==x.value):l.value.push(x);const y=[...l.value.map(U=>U.value)];r.value.trim()&&y.push(r.value.trim());const p=y.join(", ");$("update:modelValue",p),$("save",{pointId:o.pointId,inspectionId:o.inspectionId,notes:p})},d=x=>{const s=x.target.value;$("update:modelValue",s),$("save",{pointId:o.pointId,inspectionId:o.inspectionId,notes:s}),f(s)},f=x=>{var U,V,F,L;if(!x){l.value=[],r.value="";return}const s=x.split(",").map(R=>R.trim()).filter(R=>R),y=((V=(U=o.settings)==null?void 0:U.damage_options)==null?void 0:V.map(R=>R.value))||[];l.value=((L=(F=o.settings)==null?void 0:F.damage_options)==null?void 0:L.filter(R=>s.includes(R.value)))||[];const p=s.filter(R=>!y.includes(R));r.value=p.join(", ")};return oe(()=>o.modelValue,x=>{x!=null&&f(x)},{immediate:!0}),(x,s)=>{var y,p,U;return n(),i("div",St,[(y=t.settings)!=null&&y.enable_damage&&((p=t.settings)!=null&&p.damage_options)?(n(),i("div",_t,[s[0]||(s[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",Mt,[(n(!0),i(ae,null,ne(t.settings.damage_options,(V,F)=>(n(),i("button",{key:F,type:"button",onClick:L=>v(V),class:re(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":h(V.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!h(V.value)}])},A(V.label),11,Ut))),128))])])):w("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:d,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Nt),e("div",jt,[e("span",Rt,A(((U=t.modelValue)==null?void 0:U.length)||0)+"/"+A(t.maxLength||400),1),t.error?(n(),i("p",Pt,A(t.error),1)):w("",!0)])])])}}},Dt={class:"mt-1"},qt=["value","required"],At={key:0,class:"mt-2 text-sm text-red-600"},Bt={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:M}){const o=t,$=M,l=r=>{$("update:modelValue",r.target.value),$("save",o.pointId)};return(r,h)=>(n(),i("div",Dt,[e("select",{value:t.modelValue,onChange:l,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},h[0]||(h[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,qt),t.error?(n(),i("p",At,A(t.error),1)):w("",!0)]))}},Tt=ge(Bt,[["__scopeId","data-v-c34a74db"]]),Lt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Ft={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Et={class:"flex flex-row space-x-4 mb-6"},Ht={class:"mt-4 text-right"},zt={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(M,o)=>t.show?(n(),i("div",Lt,[e("div",Ft,[o[5]||(o[5]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),e("div",Et,[e("button",{onClick:o[0]||(o[0]=$=>M.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},o[3]||(o[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:o[1]||(o[1]=$=>M.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},o[4]||(o[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",Ht,[e("button",{onClick:o[2]||(o[2]=$=>M.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):w("",!0)}},Ot={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Wt={class:"webcam-content-box"},Kt={class:"webcam-header"},Xt={class:"inspection-point-name"},Gt={key:0,class:"screen-flash-overlay"},Jt={key:2,class:"focus-status"},Zt={class:"webcam-footer"},Qt={class:"camera-controls"},Yt=["disabled"],es={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,inspectionPoint:String,point:Object,pointname:String},emits:["close","photoCaptured"],setup(t,{emit:M}){const o=t,$=M,l=_(null),r=_(null);let h=null,v=null;const d=_("environment"),f=_(!1),x=_(!1),s=_(!1),y=_(!1),p=_(o.inspectionPoint||"Camera"),U=_(!1),V=_({}),F=_(""),L=_("continuous"),R=_("high"),E=Q(()=>{switch(R.value){case"high":return{width:1920,height:1080};case"medium":return{width:1280,height:720};case"low":return{width:640,height:480};default:return{width:1920,height:1080}}}),B=Q(()=>o.aspectRatio?{aspectRatio:`${o.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),I=Q(()=>{if(!o.aspectRatio)return{};const k=o.aspectRatio,a=k>1?80:60,b=k>1?80/k:60*k;return{width:`${a}%`,height:`${b}%`}}),N=Q(()=>{var k;return((k=o.settings)==null?void 0:k.max_size)||2048}),j=async()=>{h&&h.getTracks().forEach(k=>k.stop()),s.value=!1,U.value=!1,F.value="";try{const k={facingMode:d.value,width:{ideal:E.value.width},height:{ideal:E.value.height},aspectRatio:{ideal:o.aspectRatio||1.3333333333333333},frameRate:{ideal:30}};R.value==="high"&&(k.width={ideal:1920,max:3840},k.height={ideal:1080,max:2160},k.frameRate={ideal:30,max:60}),L.value!=="manual"&&(k.advanced=[{focusMode:L.value}]),d.value==="environment"&&(k.advanced||(k.advanced=[]),k.advanced.push({focusMode:L.value})),h=await navigator.mediaDevices.getUserMedia({video:k,audio:!1}),v=h.getVideoTracks()[0],l.value.srcObject=h,l.value.onloadedmetadata=async()=>{await te(),(L.value==="continuous"||L.value==="single-shot")&&await H()}}catch(k){console.error("Error accessing camera: ",k),alert("Failed to access camera. Please allow camera permission."),$("close")}},X=()=>{h&&h.getTracks().forEach(k=>k.stop()),$("close")},te=async()=>{if(v)try{const k=await navigator.mediaDevices.enumerateDevices();f.value=k.filter(m=>m.kind==="videoinput").length>1;const a=v.getCapabilities();x.value=a.torch||a.fillLightMode&&a.fillLightMode.includes("torch");const b=a.focusDistance||{};console.log("Camera capabilities:",a)}catch(k){console.error("Error checking camera capabilities:",k)}},H=async()=>{if(v)try{const k=v.getCapabilities();k.focusMode&&k.focusMode.includes("continuous")&&(await v.applyConstraints({advanced:[{focusMode:"continuous"}]}),F.value="Auto Focus Enabled",setTimeout(()=>{F.value=""},2e3))}catch(k){console.warn("Auto focus not supported:",k)}},W=async()=>{if(!(!v||!o.settings.enable_flash)){if(d.value==="user"){s.value=!s.value,y.value=s.value;return}try{v.getCapabilities().torch&&(await v.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value)}catch(k){console.error("Flash toggle failed:",k)}}},Y=async()=>{f.value&&(d.value=d.value==="environment"?"user":"environment",p.value=`${o.inspectionPoint||"Camera"} (${d.value==="environment"?"Rear":"Front"})`,await j())},ie=async()=>{if(!v)return;const k=v.getCapabilities();if(k.focusMode&&k.focusMode.includes("continuous"))try{await v.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(a){console.warn("Focus not supported",a)}},S=async k=>new Promise(a=>{const b=N.value*1024;if(k.size<=b){a(k);return}const m=new Image,q=new FileReader;q.onload=u=>{m.onload=()=>{const z=document.createElement("canvas"),D=z.getContext("2d"),K=Math.sqrt(b/k.size);z.width=m.width*K,z.height=m.height*K,D.drawImage(m,0,0,z.width,z.height);let g=.9;const c=()=>{z.toBlob(P=>{P.size>b&&g>.1?(g-=.1,c()):a(P)},"image/png",g)};c()},m.src=u.target.result},q.readAsDataURL(k)}),C=async()=>{const k=l.value,a=r.value;if(!(!k||!a||k.readyState!==4))try{const b=a.getContext("2d"),m=k.videoWidth,q=k.videoHeight;let u,z,D,K;m/q>o.aspectRatio?(z=q,u=q*o.aspectRatio,D=(m-u)/2,K=0):(u=m,z=m/o.aspectRatio,D=0,K=(q-z)/2),a.width=u,a.height=z,b.drawImage(k,D,K,u,z,0,0,u,z);const g=await new Promise(P=>{a.toBlob(P,"image/png",1)}),c=await S(g);if(c){const P=new File([c],`capture_${Date.now()}.png`,{type:"image/png",lastModified:Date.now()});$("photoCaptured",P),y.value=!0,setTimeout(()=>{y.value=!1},100)}}catch(b){console.error("Error capturing photo:",b),alert("Failed to capture photo. Please try again.")}};return oe(()=>o.show,k=>{k?j():X()}),oe(()=>o.inspectionPoint,k=>{p.value=k||"Camera"}),oe(()=>o.aspectRatio,()=>{o.show&&j()}),De(()=>{h&&h.getTracks().forEach(k=>k.stop())}),(k,a)=>{var b;return t.show?(n(),i("div",Ot,[e("div",Wt,[e("div",Kt,[e("div",Xt,A(((b=t.point)==null?void 0:b.name)||"Camera"),1),e("button",{onClick:X,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},a[0]||(a[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:ye(B.value),onClick:ie},[e("video",{ref_key:"webcamVideo",ref:l,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:r,class:"hidden"},null,512),y.value?(n(),i("div",Gt)):w("",!0),e("div",{class:"aspect-ratio-guide",style:ye(I.value)},null,4),U.value?(n(),i("div",{key:1,class:"focus-indicator",style:ye(V.value)},a[1]||(a[1]=[e("div",{class:"focus-ring"},null,-1)]),4)):w("",!0),a[2]||(a[2]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),F.value?(n(),i("div",Jt,A(F.value),1)):w("",!0)],4),e("div",Zt,[e("div",Qt,[t.settings.enable_flash?(n(),i("button",{key:0,onClick:W,disabled:!x.value,class:re(["control-button",{active:s.value,disabled:!x.value}])},a[3]||(a[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),10,Yt)):w("",!0),e("button",{onClick:C,class:"capture-button"},a[4]||(a[4]=[e("div",{class:"camera-icon-container"},[e("div",{class:"camera-body"},[e("div",{class:"camera-lens"}),e("div",{class:"camera-flash"})])],-1)])),t.settings.enable_camera_switch&&f.value?(n(),i("button",{key:1,onClick:Y,class:"control-button"},a[5]||(a[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):w("",!0)])])])])):w("",!0)}}},ts=ge(es,[["__scopeId","data-v-73221082"]]),ss={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},os={class:"w-full h-full flex flex-col"},as={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},ns={class:"text-lg font-semibold"},is={class:"flex items-center gap-2"},ls={class:"flex-1 flex items-center justify-center overflow-hidden relative"},rs=["src"],us={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},ds={class:"flex justify-between items-center w-full"},cs=["disabled"],ms={key:1,class:"flex-1"},gs=["disabled"],vs={class:"flex gap-3 w-full"},ps=["disabled"],hs={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},fs={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos"],setup(t,{emit:M}){const o=t,$=M,l=_(0),r=_([]),h=_(0),v=_(0),d=Q(()=>r.value.length>0?r.value[l.value]:null);oe(()=>o.images,B=>{r.value=B.map(I=>({...I})),o.show&&B.length>0?l.value=B.length-1:l.value=0,B.length===0&&o.show&&L()},{deep:!0,immediate:!0}),oe(()=>o.show,B=>{B&&o.images.length>0&&(l.value=o.images.length-1)});const f=B=>B.preview||(B.image_path?`/${B.image_path}`:""),x=()=>{d.value&&(d.value.rotation=(d.value.rotation+90)%360)},s=()=>{l.value=l.value<r.value.length-1?l.value+1:0},y=()=>{l.value=l.value>0?l.value-1:r.value.length-1},p=B=>{h.value=B.touches[0].clientX},U=B=>{v.value=B.touches[0].clientX},V=()=>{h.value-v.value>50?s():v.value-h.value>50&&y(),h.value=0,v.value=0},F=()=>{o.isUploading||$("saveImages",r.value)},L=()=>{o.isUploading||$("close")},R=()=>{if(d.value&&!o.isUploading){const B=d.value;$("removePreviewImage",B);const I=r.value.findIndex(N=>N.isNew&&B.isNew&&N.preview===B.preview||!N.isNew&&!B.isNew&&N.id===B.id);I!==-1&&r.value.splice(I,1),l.value>=r.value.length&&(l.value=Math.max(0,r.value.length-1)),r.value.length===0&&$("close")}},E=()=>{o.isUploading||$("triggerAddMorePhotos")};return(B,I)=>{var N;return t.show?(n(),i("div",ss,[e("div",os,[e("div",as,[e("button",{onClick:L,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},I[0]||(I[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",ns,A(((N=t.point)==null?void 0:N.name)||"Preview")+" ("+A(l.value+1)+"/"+A(r.value.length)+") ",1),e("div",is,[d.value&&d.value.isNew?(n(),i("button",{key:0,onClick:R,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},I[1]||(I[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):w("",!0),e("button",{onClick:x,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},I[2]||(I[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))])]),e("div",ls,[e("div",{class:"relative w-full max-w-full",style:ye({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"}),onTouchstart:p,onTouchmove:U,onTouchend:V},[d.value?(n(),i("img",{key:0,src:f(d.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ye({transform:`rotate(${d.value.rotation}deg)`})},null,12,rs)):w("",!0)],36),r.value.length>1?(n(),i("button",{key:0,onClick:y,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},I[3]||(I[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):w("",!0),r.value.length>1?(n(),i("button",{key:1,onClick:s,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},I[4]||(I[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):w("",!0)]),e("div",us,[e("div",ds,[d.value&&!d.value.isNew?(n(),i("button",{key:0,onClick:R,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},I[5]||(I[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,cs)):(n(),i("div",ms)),t.allowMultiple&&r.value.length<t.maxFiles?(n(),i("button",{key:2,onClick:E,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},I[6]||(I[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ue(" Tambah Foto ")]),8,gs)):w("",!0)]),e("div",vs,[e("button",{onClick:L,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:t.isUploading}," Batal ",8,ps),t.isUploading?(n(),i("button",hs,I[7]||(I[7]=[ue(" Menyimpan"),e("span",{class:"loading-dots ml-1"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1)]))):(n(),i("button",{key:0,onClick:F,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):w("",!0)}}},ws=ge(fs,[["__scopeId","data-v-65578d6b"]]),ys=["accept","multiple","disabled"],bs=["disabled"],xs={class:"h-full flex flex-col items-center justify-center p-4 text-center"},ks={class:"text-xs text-gray-400 mt-1"},$s={key:0,class:"flex items-center gap-4"},Is=["src"],Cs=["disabled"],Vs={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Ss=["disabled"],_s=["onClick"],Ms=["src"],Us={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ns={key:0},js={key:1,class:"ml-1"},Rs={key:2,class:"mt-1 text-xs text-red-600"},Ps={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(t,{emit:M}){const o=t,$=M,l=_(null),r=_(null),h=_(!1),v=_(!1),d=_(!1),f=_([]),x=_(0),s=_(!1),y=Q(()=>Number(o.settings.max_files)>1),p=Q(()=>o.settings.allowed_types.map(a=>`.${a}`).join(", ")),U=Q(()=>{const a=o.settings.camera_aspect_ratio.split(":");if(a.length===2){const b=parseFloat(a[0]),m=parseFloat(a[1]);if(!isNaN(b)&&!isNaN(m)&&m!==0)return b/m}return 4/3});oe(()=>o.modelValue,a=>{if(!a||a.length===0)f.value=[];else{const b=a.filter(q=>!q.isNew),m=f.value.filter(q=>q.isNew);f.value=[...m,...b]}},{immediate:!0,deep:!0});const V=Q(()=>{const a=[],b=new Set;for(const m of f.value)m.id&&b.add(m.id),a.push(m);for(const m of o.modelValue)m.inspection_id&&String(m.inspection_id)==String(o.inspectionId)||b.has(m.id)||a.push({...m,rotation:m.rotation||0,isNew:!1,preview:m.preview||(m.image_path?`/${m.image_path}`:null)});return a}),F=a=>a.preview||(a.image_path?`/${a.image_path}`:""),L=()=>{d.value&&(d.value=!1),h.value=!0},R=()=>{h.value=!1,l.value.click()},E=()=>{h.value=!1,v.value=!0},B=()=>{h.value=!1,V.value.length>0&&(d.value=!0)},I=()=>{v.value=!1,V.value.length>0&&(d.value=!0)},N=()=>{d.value=!1,f.value.forEach(a=>{a.preview&&a.preview.startsWith("blob:")&&URL.revokeObjectURL(a.preview)}),f.value=[]},j=a=>new Promise(b=>{const m=new FileReader;m.onload=q=>{const u=new Image;u.onload=()=>{b({file:a,preview:URL.createObjectURL(a),rotation:0,width:u.naturalWidth,height:u.naturalHeight,isNew:!0})},u.onerror=()=>{console.error("Failed to load image for dimensions:",a.name),b({file:a,preview:URL.createObjectURL(a),rotation:0,width:0,height:0,isNew:!0})},u.src=q.target.result},m.readAsDataURL(a)}),X=a=>{const b=a.name.split(".").pop().toLowerCase();return o.settings.allowed_types.includes(b)},te=async a=>{const m=(o.settings.max_size||2048)*1024;return new Promise(q=>{const u=new Image,z=new FileReader;z.onload=D=>{u.onload=()=>{const K=document.createElement("canvas"),g=K.getContext("2d"),c=Math.max(u.width,u.height);K.width=c,K.height=c,g.fillStyle="white",g.fillRect(0,0,c,c);const P=(c-u.width)/2,T=(c-u.height)/2;g.drawImage(u,P,T,u.width,u.height);let G=.9;const J=()=>{K.toBlob(ee=>{if(ee.size>m&&G>.1)G-=.1,J();else{const le=new File([ee],a.name,{type:"image/jpeg",lastModified:Date.now()});q(le)}},"image/jpeg",G)};J()},u.src=D.target.result},z.readAsDataURL(a)})},H=async a=>{const b=Array.from(a.target.files);if(!b.length){h.value=!1,V.value.length>0&&(d.value=!0);return}try{const m=b.filter(g=>!X(g));if(m.length>0){const g=m.map(c=>c.name.split(".").pop()).join(", ");alert(`File type not allowed: ${g}. Allowed types: ${o.settings.allowed_types.join(", ")}`),a.target.value="";return}const q=V.value.length,u=o.settings.max_files-q,z=await Promise.all(b.slice(0,u).map(async g=>await te(g))),D=await Promise.all(z.map(j)),K=y.value?D:D.slice(0,1);y.value?f.value.push(...K):(f.value.forEach(g=>{g.preview&&g.preview.startsWith("blob:")&&URL.revokeObjectURL(g.preview)}),f.value=K),h.value=!1,K.length>0?(x.value=Math.max(0,V.value.length-K.length),d.value=!0):V.value.length>0&&(d.value=!0),a.target.value=""}catch(m){console.error("Error processing selected images:",m),alert("Failed to process selected images. Please try again."),h.value=!1,V.value.length>0&&(d.value=!0)}},W=async a=>{const b=V.value.length;if(!y.value||b<o.settings.max_files)try{const m=await te(a),q=new Image;q.onload=()=>{const u={file:m,preview:URL.createObjectURL(m),rotation:0,width:q.naturalWidth,height:q.naturalHeight,isNew:!0};y.value?f.value.push(u):(f.value.forEach(z=>{z.preview&&z.preview.startsWith("blob:")&&URL.revokeObjectURL(z.preview)}),f.value=[u]),v.value=!1,h.value=!1,x.value=V.value.length-1,d.value=!0},q.src=URL.createObjectURL(m)}catch(m){console.error("Error processing captured image:",m),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${o.settings.max_files} files allowed.`),v.value=!1,h.value=!1,V.value.length>0&&(d.value=!0)},Y=(a=0)=>{x.value=a,d.value=!0},ie=a=>new Promise(b=>{if(a.rotation===0||!r.value){if(!a.isNew&&!a.file){b({file:null,width:a.width,height:a.height,isOriginal:!0});return}b({file:a.file,width:a.width,height:a.height});return}const m=new Image;m.onload=async()=>{try{const q=r.value,u=q.getContext("2d"),z=m.width,D=m.height;let K,g;a.rotation===90||a.rotation===270?(K=D,g=z):(K=z,g=D),q.width=K,q.height=g,u.clearRect(0,0,q.width,q.height),u.translate(q.width/2,q.height/2),u.rotate(a.rotation*Math.PI/180),u.drawImage(m,-z/2,-D/2,z,D),u.setTransform(1,0,0,1,0,0);const c=await new Promise(G=>{q.toBlob(G,"image/jpeg",.9)}),P=new File([c],a.file?a.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),T=await te(P);b({file:T,width:K,height:g})}catch(q){console.error("Error processing rotated image:",q),b({file:a.file,width:a.width,height:a.height})}},m.onerror=()=>{console.error("Failed to load image for rotation processing:",a.preview),b({file:a.file,width:a.width,height:a.height})},m.src=a.preview}),S=async a=>{var m,q,u,z;s.value=!0;const b=[];if(!o.pointId){alert("Error: Point ID is missing. Cannot upload image."),s.value=!1;return}try{for(const D of a){if(!D.isNew&&D.rotation===0&&D.id&&D.image_path){b.push({id:D.id,image_path:D.image_path,width:D.width,height:D.height,rotation:0,preview:D.preview});continue}const{file:K,width:g,height:c,isOriginal:P}=await ie(D);if(P&&!D.isNew){b.push({id:D.id,image_path:D.image_path,width:D.width,height:D.height,rotation:0,preview:D.preview});continue}const T=new FormData;T.append("inspection_id",o.inspectionId),T.append("point_id",o.pointId),T.append("image",K),T.append("width",g),T.append("height",c),T.append("rotation",0),D.id&&!D.isNew&&T.append("image_id",D.id);const J=(await Me.post(route("inspections.upload-image"),T,{headers:{"Content-Type":"multipart/form-data"}})).data.image;b.push({id:J.id,image_path:J.image_path,width:J.width,height:J.height,rotation:J.rotation,preview:J.public_url}),D.preview&&D.preview.startsWith("blob:")&&URL.revokeObjectURL(D.preview)}$("update:modelValue",b),$("save",o.pointId),$("uploaded",{pointId:o.pointId,images:b}),N()}catch(D){if(console.error("Error during image processing/upload:",D),(q=(m=D.response)==null?void 0:m.data)!=null&&q.message)alert(`Failed to save images: ${D.response.data.message}`);else if((z=(u=D.response)==null?void 0:u.data)!=null&&z.errors){const K=Object.values(D.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${K}`)}else alert(`Failed to save images: ${D.message}`)}finally{s.value=!1}},C=a=>{if(a){if(a.id&&!a.isNew)k(a);else{const b=f.value.findIndex(m=>m.preview&&m.preview===a.preview&&m.isNew||m.id&&m.id===a.id);if(b!==-1){const m=f.value.splice(b,1)[0];m.preview&&m.preview.startsWith("blob:")&&URL.revokeObjectURL(m.preview)}$("update:modelValue",o.modelValue.filter(m=>!(m.id&&m.id===a.id)&&!(m.preview&&m.preview===a.preview)))}x.value>=V.value.length&&(x.value=Math.max(0,V.value.length-1)),V.value.length===0&&N()}},k=async a=>{var m,q;if(a.id||a.image_path)try{await Me.delete(route("inspections.delete-image"),{data:{image_id:a.id,image_path:a.image_path}})}catch(u){console.error("Error deleting image from server:",u),(q=(m=u.response)==null?void 0:m.data)!=null&&q.message?alert(`Failed to delete image from server: ${u.response.data.message}`):alert(`Failed to delete image from server: ${u.message}`);return}a.preview&&a.preview.startsWith("blob:")&&URL.revokeObjectURL(a.preview);const b=o.modelValue.filter(u=>u.id!==a.id);$("update:modelValue",b),f.value=f.value.filter(u=>u.isNew&&a.isNew?u.preview!==a.preview:u.id!==a.id),$("removeImage",{image:a}),d.value&&V.value.length===0?N():d.value&&x.value>=V.value.length&&(x.value=Math.max(0,V.value.length-1))};return(a,b)=>(n(),i("div",null,[e("input",{ref_key:"galleryInput",ref:l,type:"file",accept:p.value,class:"hidden",onChange:H,multiple:y.value,disabled:s.value},null,40,ys),e("canvas",{ref_key:"processingCanvas",ref:r,class:"hidden"},null,512),V.value.length===0?(n(),i("label",{key:0,onClick:L,class:re(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:s.value},[e("div",xs,[b[2]||(b[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),b[3]||(b[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),b[4]||(b[4]=e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),e("p",ks,"Allowed types: "+A(p.value),1)])],8,bs)):(n(),i("div",{key:1,class:re(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[t.settings.max_files===1?(n(),i("div",$s,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:b[0]||(b[0]=m=>Y(0))},[e("img",{src:F(V.value[0]),class:"w-full h-full object-cover"},null,8,Is)]),e("button",{onClick:b[1]||(b[1]=be(m=>k(V.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:s.value},b[5]||(b[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,Cs)])):(n(),i("div",Vs,[y.value&&V.value.length<t.settings.max_files?(n(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:L,disabled:s.value},b[6]||(b[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Ss)):w("",!0),(n(!0),i(ae,null,ne(V.value,(m,q)=>(n(),i("div",{key:m.id||m.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:u=>Y(q)},[e("img",{src:F(m),class:"w-full h-full object-cover"},null,8,Ms),m.isNew||m.rotation!==0?(n(),i("div",Us,[m.isNew?(n(),i("span",Ns,"BARU")):w("",!0),m.rotation!==0?(n(),i("span",js,"ROTASI")):w("",!0)])):w("",!0)],8,_s))),128))]))],2)),t.error?(n(),i("p",Rs,A(t.error),1)):w("",!0),de(zt,{show:h.value,onClose:B,onOpenWebcam:E,onTriggerGallery:R},null,8,["show"]),de(ts,{show:v.value,"aspect-ratio":U.value,settings:t.settings,point:t.point,onClose:I,onPhotoCaptured:W},null,8,["show","aspect-ratio","settings","point"]),de(ws,{show:d.value,images:V.value,point:t.point,"initial-index":x.value,"allow-multiple":y.value,"max-files":t.settings.max_files,"is-uploading":s.value,"aspect-ratio":U.value,onClose:N,onSaveImages:S,onRemovePreviewImage:C,onTriggerAddMorePhotos:L},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},Se=ge(Ps,[["__scopeId","data-v-f8e05d93"]]),Ds={key:0,class:"fixed inset-0 z-50 overflow-hidden"},qs={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},As={class:"px-4 pb-2 border-b border-gray-200"},Bs={class:"text-lg font-semibold text-gray-900"},Ts={key:0,class:"text-sm text-gray-500 mt-1"},Ls={class:"flex-1 overflow-y-auto p-4"},Fs={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Es={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:M}){const o=M,$=()=>{o("close")},l=r=>{r.key==="Escape"&&$()};return ke(()=>{document.addEventListener("keydown",l)}),je(()=>{document.removeEventListener("keydown",l)}),(r,h)=>(n(),se(Ce,{name:"bottom-sheet"},{default:me(()=>[t.show?(n(),i("div",Ds,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:$}),e("div",qs,[h[0]||(h[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",As,[e("h3",Bs,A(t.title),1),t.subtitle?(n(),i("p",Ts,A(t.subtitle),1)):w("",!0)]),e("div",Ls,[Ue(r.$slots,"default",{},void 0,!0)]),r.$slots.footer?(n(),i("div",Fs,[Ue(r.$slots,"footer",{},void 0,!0)])):w("",!0)])])):w("",!0)]),_:3}))}},Pe=ge(Es,[["__scopeId","data-v-7893c2dc"]]),Hs={class:"space-y-4"},zs={key:0,class:"mt-2"},Os={class:"text-sm font-medium text-gray-700 mb-2"},Ws={key:0,class:"text-red-500"},Ks={key:0,class:"text-xs text-red-500"},Xs={key:1,class:"grid grid-cols-2 gap-2"},Gs=["name","value","checked"],Js={key:2,class:"space-y-2"},Zs={key:0,class:"text-red-500"},Qs={key:1,class:"text-xs text-red-500"},Ys={key:3,class:"mt-4"},eo={class:"text-sm font-medium text-gray-700 mb-2"},to={key:0,class:"text-red-500"},so={key:0,class:"text-xs text-red-500"},oo={class:"flex gap-2"},ao=["disabled"],_e={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(t,{emit:M}){const o=t,$=M,l=v=>$("hapus",v),r=Q(()=>o.options.find(v=>v.value===o.selectedValue)),h=Q(()=>{var d,f,x;if(o.point.input_type==="imageTOradio"&&o.imagesValue.length===0||o.options.length&&!o.selectedValue)return!1;const v=r.value;return!(o.showTextarea&&((d=v==null?void 0:v.settings)!=null&&d.show_textarea)&&(!((f=o.notesValue)!=null&&f.trim())||v.settings.min_length&&o.notesValue.length<v.settings.min_length||v.settings.max_length&&o.notesValue.length>v.settings.max_length)||o.showImageUpload&&((x=v==null?void 0:v.settings)!=null&&x.show_image_upload)&&(o.imagesValue.length===0||v.settings.max_files&&o.imagesValue.length>v.settings.max_files))});return(v,d)=>(n(),se(Pe,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:d[10]||(d[10]=f=>v.$emit("close"))},{footer:me(()=>[t.selectedPoint?(n(),i("button",{key:0,onClick:d[7]||(d[7]=f=>l(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},d[12]||(d[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ue(" Hapus Data ")]))):w("",!0),e("div",oo,[e("button",{type:"button",onClick:d[8]||(d[8]=f=>v.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:d[9]||(d[9]=f=>v.$emit("save")),disabled:!h.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,ao)])]),default:me(()=>{var f,x,s,y,p,U,V,F,L,R,E,B,I,N;return[e("div",Hs,[t.point.input_type==="imageTOradio"?(n(),i("div",zs,[e("h4",Os,[(f=t.point.settings)!=null&&f.required?(n(),i("span",Ws,"*")):w("",!0)]),de(Se,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":d[0]||(d[0]=j=>v.$emit("update:imagesValue",j)),onSave:d[1]||(d[1]=j=>v.$emit("saveImage",j))},null,8,["model-value","point-id","point","inspection-id","settings"]),(x=t.point.settings)!=null&&x.required&&t.imagesValue.length===0?(n(),i("p",Ks," Foto wajib diupload ")):w("",!0)])):w("",!0),t.options.length?(n(),i("div",Xs,[(n(!0),i(ae,null,ne(t.options,(j,X)=>(n(),i("label",{key:X,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:j.value,checked:t.selectedValue===j.value,onChange:d[2]||(d[2]=te=>v.$emit("update:selectedValue",te.target.value)),class:"hidden peer"},null,40,Gs),e("div",{class:re(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===j.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==j.value}])},A(j.label),3)]))),128))])):w("",!0),t.showTextarea&&((y=(s=r.value)==null?void 0:s.settings)!=null&&y.show_textarea)?(n(),i("div",Js,[(p=r.value.settings)!=null&&p.required?(n(),i("span",Zs,"*")):w("",!0),de(Re,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:r.value.settings,required:(U=r.value.settings)==null?void 0:U.required,"min-length":(V=r.value.settings)==null?void 0:V.min_length,"max-length":(F=r.value.settings)==null?void 0:F.max_length,placeholder:((L=r.value.settings)==null?void 0:L.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":d[3]||(d[3]=j=>v.$emit("update:notesValue",j)),onSave:d[4]||(d[4]=j=>v.$emit("saveTextarea",j))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(R=r.value.settings)!=null&&R.required&&!t.notesValue?(n(),i("p",Qs," Keterangan wajib diisi ")):w("",!0)])):w("",!0),t.showImageUpload&&((B=(E=r.value)==null?void 0:E.settings)!=null&&B.show_image_upload)?(n(),i("div",Ys,[e("h4",eo,[d[11]||(d[11]=ue(" Upload Foto ")),(I=r.value.settings)!=null&&I.required?(n(),i("span",to,"*")):w("",!0)]),de(Se,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:r.value.settings,"onUpdate:modelValue":d[5]||(d[5]=j=>v.$emit("update:imagesValue",j)),onSave:d[6]||(d[6]=j=>v.$emit("saveImage",j))},null,8,["model-value","point-id","point","inspection-id","settings"]),(N=r.value.settings)!=null&&N.required&&t.imagesValue.length===0?(n(),i("p",so," Foto wajib diupload ")):w("",!0)])):w("",!0)])]}),_:1},8,["show","title","subtitle"]))}},no={class:"mt-2 space-y-4"},io={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},lo=["name","value","checked","onChange","required"],ro={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},uo={key:0,class:"mt-3"},co={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},mo=["src"],go={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},vo={key:1,class:"mt-2"},po={class:"text-sm text-gray-600"},ho={key:2,class:"mt-2 text-sm text-red-600"},fo={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:M}){const o=t,$=M,l=_(o.notes),r=_([...o.images]),h=_(!1),v=_(""),d=_([]),f=_(""),x=_([]),s=Q(()=>o.options.find(I=>I.value===o.modelValue)),y=I=>I.settings&&(I.settings.show_textarea||I.settings.show_image_upload);oe(()=>o.notes,I=>{l.value=I}),oe(()=>o.images,I=>{r.value=[...I]}),oe(()=>o.modelValue,I=>{I&&(f.value=I)});const p=I=>{$("update:modelValue",I.value),y(I)?V():$("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:I.value,notes:"",images:[]})},U=I=>I.preview||(I.image_path?`/${I.image_path}`:I),V=()=>{f.value=o.modelValue,v.value=l.value,d.value=[...r.value],x.value=[...r.value],h.value=!0},F=()=>{v.value="",d.value=[],f.value="",h.value=!1},L=I=>{d.value=I,r.value=[...I],$("update:images",[...I]),$("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:o.modelValue,notes:l.value,images:[...I]})},R=I=>{},E=()=>{f.value!==o.modelValue&&$("update:modelValue",f.value),l.value=v.value,$("update:notes",v.value),r.value=[...d.value],$("update:images",[...d.value]),$("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:f.value,notes:v.value,images:d.value}),h.value=!1},B=I=>{$("hapus",I),h.value=!1};return(I,N)=>{var j,X,te,H;return n(),i("div",no,[e("div",io,[(n(!0),i(ae,null,ne(t.options,(W,Y)=>(n(),i("label",{key:Y,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:W.value,checked:t.modelValue===W.value,onChange:ie=>p(W),class:"hidden peer",required:t.required},null,40,lo),e("div",{class:re(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===W.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==W.value}])},A(W.label),3)]))),128))]),t.modelValue&&s.value&&y(s.value)?(n(),i("div",ro,[e("div",{class:"flex justify-between items-start"},[N[4]||(N[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:V,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((j=s.value.settings)!=null&&j.show_image_upload)?(n(),i("div",uo,[e("div",co,[(n(!0),i(ae,null,ne(t.images,(W,Y)=>(n(),i("div",{key:Y,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:U(W),class:"w-full h-full object-cover rounded"},null,8,mo),Y===3&&t.images.length>4?(n(),i("span",go," +"+A(t.images.length-4),1)):w("",!0)]))),128))])])):w("",!0),t.notes&&((X=s.value.settings)!=null&&X.show_textarea)?(n(),i("div",vo,[e("p",po,A(t.notes),1)])):w("",!0)])):w("",!0),h.value?(n(),se(_e,{key:(te=t.selectedPoint)==null?void 0:te.id,show:h.value,title:t.pointName||"Detail",subtitle:(H=s.value)==null?void 0:H.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":f.value,"notes-value":v.value,"images-value":d.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":N[0]||(N[0]=W=>f.value=W),"onUpdate:notesValue":N[1]||(N[1]=W=>v.value=W),"onUpdate:imagesValue":N[2]||(N[2]=W=>L(W)),onClose:F,onSave:E,onSaveTextarea:I.handleTextareaSave,onSaveImage:R,onHapus:N[3]||(N[3]=W=>B(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):w("",!0),t.error?(n(),i("p",ho,A(t.error),1)):w("",!0)])}}},wo={class:"mt-2 space-y-4"},yo={key:0,class:"flex flex-wrap gap-3"},bo={key:1,class:"p-4 border rounded-lg bg-gray-50"},xo={key:0,class:"mt-3"},ko={class:"flex gap-2 overflow-x-auto scrollbar-hide"},$o=["src"],Io={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Co={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},Vo=["name","value","checked"],So={key:1,class:"mt-2"},_o={class:"text-sm text-gray-600"},Mo={key:3,class:"mt-2 text-sm text-red-600"},Uo={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:M}){const o=t,$=M,l=_(o.notes),r=_([...o.images]),h=_(!1),v=_(""),d=_([]),f=_(""),x=_([]),s=Q(()=>o.options.find(R=>R.value===o.modelValue)),y=R=>R.preview||(R.image_path?`/${R.image_path}`:R),p=()=>{f.value=o.modelValue||"",v.value=l.value,d.value=[...r.value],x.value=[...r.value],h.value=!0},U=()=>{v.value="",d.value=[],f.value="",h.value=!1},V=R=>{d.value=R,r.value=[...R],$("update:images",[...R]),$("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:o.modelValue,notes:l.value,images:[...R]})},F=()=>{f.value!==o.modelValue&&$("update:modelValue",f.value),l.value=v.value,$("update:notes",v.value),r.value=[...d.value],$("update:images",[...d.value]),$("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:f.value,notes:v.value,images:d.value}),h.value=!1},L=R=>{$("hapus",R),h.value=!1};return(R,E)=>{var B,I,N;return n(),i("div",wo,[!t.modelValue&&r.value.length===0&&!l.value?(n(),i("div",yo,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:p},E[4]||(E[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),i("div",bo,[e("div",{class:"flex justify-between items-start"},[E[5]||(E[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:p,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),r.value.length>0?(n(),i("div",xo,[e("div",ko,[(n(!0),i(ae,null,ne(r.value,(j,X)=>(n(),i("div",{key:X,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:y(j),class:"w-full h-full object-cover rounded"},null,8,$o),X===3&&r.value.length>4?(n(),i("span",Io," +"+A(r.value.length-4),1)):w("",!0)]))),128))])])):w("",!0),e("div",Co,[(n(!0),i(ae,null,ne(t.options,(j,X)=>(n(),i("label",{key:X,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:j.value,checked:t.modelValue===j.value,disabled:!0,class:"hidden peer"},null,8,Vo),e("div",{class:re(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===j.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==j.value}])},A(j.label),3)]))),128))]),l.value&&((B=s.value.settings)!=null&&B.show_textarea)?(n(),i("div",So,[e("p",_o,A(l.value),1)])):w("",!0)])),h.value?(n(),se(_e,{key:(I=t.selectedPoint)==null?void 0:I.id,show:h.value,title:t.pointName||"Detail",subtitle:(N=s.value)==null?void 0:N.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":f.value,"notes-value":v.value,"images-value":d.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":E[0]||(E[0]=j=>f.value=j),"onUpdate:notesValue":E[1]||(E[1]=j=>v.value=j),"onUpdate:imagesValue":E[2]||(E[2]=j=>V(j)),onClose:U,onSave:F,onHapus:E[3]||(E[3]=j=>L(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):w("",!0),t.error?(n(),i("p",Mo,A(t.error),1)):w("",!0)])}}},No={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},jo={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},Ro={class:"text-xl font-semibold text-indigo-700"},Po={class:"p-4 space-y-4"},Do={class:"flex items-start justify-between"},qo={class:"block text-sm font-medium text-gray-700"},Ao={key:0,class:"text-red-500"},Bo={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},To={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:M}){const o=t,$=M,l=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],r=f=>{var y,p,U,V,F;const x=o.form.results[f.id],s=o.form.images[f.id];if(!x)return!1;switch(f.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!x.note;case"select":case"radio":if(!x.status)return!1;const L=(y=f.settings.radios)==null?void 0:y.find(E=>E.value===x.status);return!(L!=null&&L.settings&&(L.settings.show_textarea&&!((p=x.note)!=null&&p.trim())||L.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!x.status)return!1;const R=(U=f.settings.radios)==null?void 0:U.find(E=>E.value===x.status);return!(R!=null&&R.settings&&R.settings.show_textarea&&!((V=x.note)!=null&&V.trim()));case"image":return s.length>0;default:return!!x.status||!!((F=x.note)!=null&&F.trim())}},h=(f,x)=>{$("updateResult",{pointId:f,value:x})},v=f=>{$("saveResult",f)},d=f=>{$("hapusPoint",f)};return(f,x)=>(n(),i("div",No,[e("div",jo,[e("h2",Ro,A(t.category.name),1)]),e("div",Po,[(n(!0),i(ae,null,ne(t.category.points,s=>{var y,p,U,V,F,L,R,E,B,I,N,j,X,te,H,W,Y,ie,S,C,k,a,b,m,q;return n(),i("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",Do,[e("label",qo,[ue(A(s.name)+" ",1),(y=s.settings)!=null&&y.is_required?(n(),i("span",Ao,"*")):w("",!0)]),r(s)?(n(),i("span",Bo," ✓ ")):w("",!0)]),s.input_type==="text"?(n(),se(wt,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>h(s.id,u)],required:(p=s.settings)==null?void 0:p.is_required,"min-length":(U=s.settings)==null?void 0:U.min_length,"max-length":(V=s.settings)==null?void 0:V.max_length,pattern:(F=s.settings)==null?void 0:F.pattern,placeholder:((L=s.settings)==null?void 0:L.placeholder)||"Masukan text",error:t.form.errors[`results.${s.id}.note`],onSave:u=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):w("",!0),s.input_type==="number"?(n(),se(Te,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>h(s.id,u)],required:(R=s.settings)==null?void 0:R.is_required,min:(E=s.settings)==null?void 0:E.min,max:(B=s.settings)==null?void 0:B.max,step:((I=s.settings)==null?void 0:I.step)||1,placeholder:((N=s.settings)==null?void 0:N.placeholder)||"Masukan number",error:t.form.errors[`results.${s.id}.note`],onSave:u=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):w("",!0),s.input_type==="account"?(n(),se(Vt,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>h(s.id,u)],required:(j=s.settings)==null?void 0:j.is_required,placeholder:((X=s.settings)==null?void 0:X.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:u=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):w("",!0),s.input_type==="date"?(n(),se(kt,{key:3,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>h(s.id,u)],required:(te=s.settings)==null?void 0:te.is_required,"min-date":(H=s.settings)==null?void 0:H.min_date,"max-date":(W=s.settings)==null?void 0:W.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:u=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):w("",!0),s.input_type==="textarea"?(n(),se(Re,{key:4,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>h(s.id,u)],required:(Y=s.settings)==null?void 0:Y.is_required,"min-length":(ie=s.settings)==null?void 0:ie.min_length,"max-length":(S=s.settings)==null?void 0:S.max_length,placeholder:((C=s.settings)==null?void 0:C.placeholder)||"Masukkan teks di sini",settings:s.settings,error:t.form.errors[`results.${s.id}.note`],onSave:u=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):w("",!0),s.input_type==="radio"?(n(),se(fo,{key:5,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[u=>t.form.results[s.id].status=u,u=>h(s.id,u)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(k=s.settings)==null?void 0:k.is_required,"point-id":s.id,point:s,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((a=s.settings)==null?void 0:a.radios)||l,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":u=>t.form.results[s.id].note=u,"onUpdate:images":u=>t.form.images[s.id]=u,onSave:u=>v(s.id),onHapus:u=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):w("",!0),s.input_type==="imageTOradio"?(n(),se(Uo,{key:6,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[u=>t.form.results[s.id].status=u,u=>h(s.id,u)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(b=s.settings)==null?void 0:b.is_required,"point-id":s.id,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((m=s.settings)==null?void 0:m.radios)||l,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":u=>t.form.results[s.id].note=u,"onUpdate:images":u=>t.form.images[s.id]=u,onSave:u=>v(s.id),onHapus:u=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):w("",!0),s.input_type==="image"?(n(),se(Se,{key:7,modelValue:t.form.images[s.id],"onUpdate:modelValue":u=>t.form.images[s.id]=u,error:t.form.errors[`images.${s.id}`],"inspection-id":t.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,"onUpdate:notes":u=>t.form.results[s.id].note=u,"onUpdate:status":u=>t.form.results[s.id].status=u},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):w("",!0),s.input_type==="select"?(n(),se(Tt,{key:8,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[u=>t.form.results[s.id].status=u,u=>h(s.id,u)],required:(q=s.settings)==null?void 0:q.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:u=>v(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):w("",!0)])}),128))])]))}},Lo=ge(To,[["__scopeId","data-v-af74b428"]]),Fo={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Eo={class:"p-4 space-y-4-6"},Ho={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},zo=["value"],Oo={class:"p-4 space-y-4-6"},Wo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ko=["value"],Xo={key:0,class:"p-4 space-y-4-6"},Go={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Jo=["value"],Zo={class:"p-4 space-y-4-6"},Qo={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(t){const M=t,o=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(y){return console.error("Error parsing settings JSON:",y),{}}return typeof s=="object"&&s!==null?s:{}},$=Q(()=>o(M.inspection.settings).conclusion||{}),l=_({flooded:$.value.flooded||"",collision:$.value.collision||"",collision_severity:$.value.collision_severity||"",conclusion_note:M.inspection.notes||""}),r=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],h=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],v=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],d=()=>{const s={flooded:l.value.flooded,collision:l.value.collision,collision_severity:l.value.collision==="yes"?l.value.collision_severity:null,conclusion_note:l.value.conclusion_note};Ve.post(route("inspections.updateConclusion",M.inspectionId),s,{preserveScroll:!0,preserveState:!0,onError:y=>{console.error("Error saving conclusion:",y)}})},f=xe.debounce(d,500);oe([()=>l.value.flooded,()=>l.value.collision,()=>l.value.collision_severity],()=>{d()}),ke(()=>{x()}),oe(()=>M.inspection,()=>{x()},{deep:!0});const x=()=>{const y=o(M.inspection.settings).conclusion||{};l.value={flooded:y.flooded||"",collision:y.collision||"",collision_severity:y.collision_severity||"",conclusion_note:M.inspection.notes||""}};return(s,y)=>(n(),i("div",Fo,[y[9]||(y[9]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),e("div",Eo,[y[5]||(y[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),e("div",Ho,[(n(),i(ae,null,ne(r,p=>e("label",{key:p.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":y[0]||(y[0]=U=>l.value.flooded=U),value:p.value,class:"hidden peer"},null,8,zo),[[Ie,l.value.flooded]]),e("div",{class:re(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.flooded===p.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.flooded!==p.value}])},A(p.label),3)])),64))])]),e("div",Oo,[y[7]||(y[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),e("div",Wo,[(n(),i(ae,null,ne(h,p=>e("label",{key:p.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":y[1]||(y[1]=U=>l.value.collision=U),value:p.value,class:"hidden peer"},null,8,Ko),[[Ie,l.value.collision]]),e("div",{class:re(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision===p.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision!==p.value}])},A(p.label),3)])),64))]),l.value.collision==="yes"?(n(),i("div",Xo,[y[6]||(y[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),e("div",Go,[(n(),i(ae,null,ne(v,p=>e("label",{key:p.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":y[2]||(y[2]=U=>l.value.collision_severity=U),value:p.value,class:"hidden peer"},null,8,Jo),[[Ie,l.value.collision_severity]]),e("div",{class:re(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision_severity===p.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision_severity!==p.value}])},A(p.label),3)])),64))])])):w("",!0)]),e("div",Zo,[y[8]||(y[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),ce(e("textarea",{"onUpdate:modelValue":y[3]||(y[3]=p=>l.value.conclusion_note=p),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:y[4]||(y[4]=(...p)=>Z(f)&&Z(f)(...p))},null,544),[[we,l.value.conclusion_note]])])]))}},Yo={class:"container mx-auto px-4 py-2"},ea={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},ta={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},sa=["onClick"],oa={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},aa={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},na={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},ia={class:"relative overflow-hidden"},la={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},ra=["disabled"],ua={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},da={class:"space-y-4"},ca={class:"relative"},ma={class:"max-h-64 overflow-y-auto"},ga={key:0,class:"text-center py-4 text-gray-500"},va=["onClick"],pa={class:"font-medium text-gray-900"},ha={class:"text-sm text-gray-500"},fa={class:"text-xs text-gray-400 mt-1"},wa={key:0,class:"text-xs text-green-600 mt-1"},ya={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup(t){var K;const M=t,o=_(!1),$=_(!1),l=_(""),r=_(null),h=_(""),v=_(""),d=_([]),f=_(""),x=(g,c)=>g.filter(P=>c?p(P.id):!0),s=Q(()=>M.damagePoints||[]),y=Q(()=>{if(!l.value.trim())return s.value;const g=l.value.toLowerCase().trim();return s.value.filter(c=>{var P,T,G;return((P=c.name)==null?void 0:P.toLowerCase().includes(g))||((T=c.description)==null?void 0:T.toLowerCase().includes(g))||((G=U(c))==null?void 0:G.toLowerCase().includes(g))})}),p=g=>{var P;const c=H.results[g];return c&&(c.status||c.note||((P=c.images)==null?void 0:P.length)>0)},U=g=>{const c=M.components.find(P=>P.id===g.component_id);return c?c.name:"Komponen Tidak Diketahui"},V=g=>g&&Array.isArray(M.existingResults)?M.existingResults.find(c=>c.point_id===g):null,F=g=>{r.value=g;const c=H.results[g.id]||{};h.value=c.status||"",v.value=c.note||"",d.value=Array.isArray(c.images)?[...c.images]:[],o.value=!1,$.value=!0},L=()=>{r.value&&(H.results[r.value.id]={...H.results[r.value.id],status:h.value,note:v.value,images:Array.isArray(d.value)?[...d.value]:[]},b(r.value.id),f.value="Data berhasil disimpan!",setTimeout(()=>{f.value=""},1e3)),E()},R=()=>{o.value=!1,l.value=""},E=()=>{$.value=!1,r.value=null,h.value="",v.value="",d.value=[]},I=qe().props.inspection,N=_(((K=M.appMenu[0])==null?void 0:K.id)||"conclusion"),j=_(0),X=Q(()=>N.value!=="conclusion"?M.appMenu.find(g=>g.id===N.value):null);function te(){const g={},c={};return M.appMenu.forEach(P=>{(P.points||[]).forEach(T=>{var ee;const G=Array.isArray(M.existingResults)?M.existingResults.find(le=>le.point_id===T.id):null;g[T.id]={status:(G==null?void 0:G.status)||"",note:(G==null?void 0:G.note)||""};const J=((ee=M.existingImages)==null?void 0:ee[T.id])||[];c[T.id]=J.map(le=>({id:le.id,image_path:le.image_path,preview:`/${le.image_path}`,rotation:le.rotation||0,isNew:!1}))})}),{inspection_id:M.inspection.id,results:g,images:c,overall_note:M.inspection.overall_note||""}}const H=Ne(te()),W=g=>g.input_type==="damage"?!0:g.id==="conclusion"?ie():g.points.every(c=>{var J,ee,le,pe,he,fe;const P=H.results[c.id],T=H.images[c.id];if(!P)return!1;const G=Y(c.settings);switch(c.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((J=P.note)!=null&&J.trim());case"select":case"radio":if(!P.status)return!1;const O=(ee=G.radios)==null?void 0:ee.find($e=>$e.value===P.status);return!(O!=null&&O.settings&&(O.settings.show_textarea&&!((le=P.note)!=null&&le.trim())||O.settings.show_image_upload&&(T==null?void 0:T.length)===0));case"imageTOradio":if((T==null?void 0:T.length)===0||!P.status)return!1;const ve=(pe=G.radios)==null?void 0:pe.find($e=>$e.value===P.status);return!(ve!=null&&ve.settings&&ve.settings.show_textarea&&ve.settings.required&&!((he=P.note)!=null&&he.trim()));case"image":return(T==null?void 0:T.length)>0;default:return!!P.status||!!((fe=P.note)!=null&&fe.trim())}}),Y=g=>{if(!g)return{};if(typeof g=="string")try{return JSON.parse(g)||{}}catch(c){return console.error("Error parsing settings JSON:",c),{}}return typeof g=="object"&&g!==null?g:{}},ie=()=>{var ee;const c=Y(M.inspection.settings).conclusion||{},P=!!c.flooded,T=!!c.collision,G=c.collision==="yes"?!!c.collision_severity:!0,J=!!((ee=M.inspection.notes)!=null&&ee.trim());return P&&T&&G&&J},S=Q(()=>{const c=Y(M.inspection.settings).conclusion||{};return{flooded:c.flooded||null,collision:c.collision||null,collision_severity:c.collision_severity||null,note:M.inspection.notes||null,isComplete:ie()}}),C=g=>{N.value=g},k=g=>{var T;let c=j.value+g;const P=M.appMenu.length;c>=0&&c<=P&&(j.value=c,N.value=((T=M.appMenu[c])==null?void 0:T.id)||"conclusion")},a=()=>{let g=0,c=0;const P=ee=>{g=ee.changedTouches[0].screenX},T=ee=>{c=ee.changedTouches[0].screenX,G()},G=()=>{c<g-150?k(1):c>g+150&&k(-1)},J=document.querySelector(".relative.overflow-hidden");return J&&(J.addEventListener("touchstart",P,!1),J.addEventListener("touchend",T,!1)),()=>{J&&(J.removeEventListener("touchstart",P),J.removeEventListener("touchend",T))}},b=xe.debounce(async g=>{try{await Ve.post(route("inspections.save-result"),{inspection_id:M.inspection.id,point_id:g,status:H.results[g].status,note:H.results[g].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(c){console.error("Error menyimpan hasil:",c)}},500),m=({pointId:g,type:c,value:P})=>{H.results[g].hasOwnProperty(c)&&(H.results[g][c]=P),b(g)},q=async g=>{if(g&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await Ve.post(route("inspections.delete-result"),{inspection_id:M.inspection.id,point_id:g},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{H.results[g]&&delete H.results[g],f.value="Data berhasil dihapus!",setTimeout(()=>{f.value=""},2e3)}})}catch(c){console.error("Error menghapus hasil:",c)}E()}},u=g=>{Object.assign(H.conclusion,g),saveConclusion()},z=()=>{if(!D.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}H.post(route("inspections.final-submit",{id:M.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:g=>{console.error("Kesalahan pengiriman:",g)}})};oe(N,g=>{const c=document.querySelector(`.flex-shrink-0[data-category-id="${g}"]`);c&&c.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const D=Q(()=>{const g=M.appMenu.every(P=>W(P)),c=ie();return g&&c});return oe(l,xe.debounce(()=>{},300)),ke(()=>{a()}),(g,c)=>{var P,T,G,J,ee,le,pe,he,fe;return n(),i("div",Yo,[e("div",ea,[e("div",ta,[e("button",{onClick:c[0]||(c[0]=O=>C("vehicle")),class:re(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":N.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":N.value!=="vehicle"}])}," Detail Kendaraan ",2),(n(!0),i(ae,null,ne(t.appMenu,O=>(n(),i("button",{key:O.id,onClick:ve=>C(O.id),class:re(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":N.value===O.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":N.value!==O.id}])},[ue(A(O.name)+" ",1),W(O)?(n(),i("span",oa," ✓ ")):w("",!0)],10,sa))),128)),e("button",{onClick:c[1]||(c[1]=O=>C("conclusion")),class:re(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":N.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":N.value!=="conclusion"}])},[c[7]||(c[7]=ue(" Kesimpulan ")),S.value.isComplete?(n(),i("span",aa," ✓ ")):w("",!0)],2)])]),de(Ce,{name:"fade"},{default:me(()=>[f.value?(n(),i("div",na,A(f.value),1)):w("",!0)]),_:1}),e("div",ia,[de(Ce,{name:"category-slide",mode:"out-in"},{default:me(()=>[N.value==="vehicle"?(n(),se(vt,{key:0,inspection:Z(I),CarDetail:t.CarDetail,onUpdateVehicle:g.updateVehicleDetails,onSaveCarDetails:g.saveNewCarDetails},null,8,["inspection","CarDetail","onUpdateVehicle","onSaveCarDetails"])):X.value&&N.value!=="conclusion"?(n(),se(Lo,{key:X.value.id,category:{...X.value,points:x(X.value.points||[],X.value.input_type==="damage")},"inspection-id":Z(I).id,form:Z(H),onSaveResult:Z(b),onUpdateResult:m,onHapusPoint:q,onRemoveImage:g.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):N.value==="conclusion"?(n(),se(Qo,{key:2,form:Z(H),"inspection-id":Z(I).id,inspection:Z(I),settings:Z(I).settings||{},onUpdateConclusion:u},null,8,["form","inspection-id","inspection","settings"])):w("",!0)]),_:1})]),N.value==="conclusion"?(n(),i("div",la,[e("button",{type:"button",onClick:z,disabled:!D.value||Z(H).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[Z(H).processing?(n(),i("svg",ua,c[8]||(c[8]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):w("",!0),e("span",null,A(Z(H).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ra)])):w("",!0),!o.value&&!$.value?(n(),i("button",{key:1,onClick:c[2]||(c[2]=O=>o.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},c[9]||(c[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):w("",!0),de(Pe,{show:o.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:R},{default:me(()=>[e("div",da,[e("div",ca,[ce(e("input",{"onUpdate:modelValue":c[3]||(c[3]=O=>l.value=O),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[we,l.value]]),c[10]||(c[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",ma,[y.value.length===0?(n(),i("div",ga," Tidak ada point yang ditemukan ")):w("",!0),(n(!0),i(ae,null,ne(y.value,O=>(n(),i("button",{key:O.id,onClick:ve=>F(O),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",pa,A(O.name),1),e("div",ha,A(O.description),1),e("div",fa,A(U(O)),1),p(O.id)?(n(),i("div",wa," ✓ Sudah ada data ")):w("",!0)],8,va))),128))])])]),_:1},8,["show"]),$.value?(n(),se(_e,{key:(P=r.value)==null?void 0:P.id,show:$.value,title:((T=r.value)==null?void 0:T.name)||"Detail Point",subtitle:(G=r.value)==null?void 0:G.description,name:`point-${(J=r.value)==null?void 0:J.id}`,"inspection-id":Z(I).id,"point-id":(ee=r.value)==null?void 0:ee.id,settings:((le=r.value)==null?void 0:le.settings)||{},options:((he=(pe=r.value)==null?void 0:pe.settings)==null?void 0:he.radios)||[],"selected-Point":r.value,"selected-value":h.value,"images-value":Z(H).images[r.value.id],"notes-value":v.value,point:r.value,"existing-data":V((fe=r.value)==null?void 0:fe.id),"onUpdate:selectedValue":c[4]||(c[4]=O=>h.value=O),"onUpdate:notesValue":c[5]||(c[5]=O=>v.value=O),"onUpdate:imagesValue":c[6]||(c[6]=O=>Z(H).images[r.value.id]=O),onSave:L,onClose:E,onHapus:q},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):w("",!0)])}}},Va=ge(ya,[["__scopeId","data-v-f5189791"]]);export{Va as default};
