import{d as h,l as B,B as be,x as ke,W as ne,z as oe,m as _e,e as g,o as u,a,b as H,f as y,c as j,n as K,F as ie,h as ae,g as re,w as O,t as C,T as le,u as f,p as Ce,v as Se}from"./app-DDbkdHwV.js";import{l as ue}from"./lodash-nYPKdAxv.js";import{V as De,C as Me,_ as Ae,B as Ve,a as Pe}from"./ConclusionSection-CKngUHdg.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-DVC9FkFX.js";import"./ActionMessage-CWKXTutn.js";import"./InputNumber-BraCoIwT.js";const Re={class:"container mx-auto px-4 py-2"},Te={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Be={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Ne=["onClick"],je={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},$e={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ze={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Le={class:"relative overflow-hidden"},Fe={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},Ue=["disabled"],Ie={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},qe={class:"space-y-4"},He={class:"relative"},Ke={class:"max-h-64 overflow-y-auto"},Oe={key:0,class:"text-center py-4 text-gray-500"},Xe=["onClick"],Je={class:"font-medium text-gray-900"},We={class:"text-sm text-gray-500"},Qe={class:"text-xs text-gray-400 mt-1"},Ge={key:0,class:"text-xs text-green-600 mt-1"},Ye={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup($){var se;const o=$,S=h(!1),D=h(!1),w=h(""),c=h(null),M=h(""),A=h(""),b=h([]),k=h(""),ce=(t,e)=>t.filter(s=>e?W(s.id):!0),X=B(()=>o.damagePoints||[]),J=B(()=>{if(!w.value.trim())return X.value;const t=w.value.toLowerCase().trim();return X.value.filter(e=>{var s,i,r;return((s=e.name)==null?void 0:s.toLowerCase().includes(t))||((i=e.description)==null?void 0:i.toLowerCase().includes(t))||((r=Q(e))==null?void 0:r.toLowerCase().includes(t))})}),W=t=>{var s;const e=l.results[t];return e&&(e.status||e.note||((s=e.images)==null?void 0:s.length)>0)},Q=t=>{const e=o.components.find(s=>s.id===t.component_id);return e?e.name:"Komponen Tidak Diketahui"},de=t=>t&&Array.isArray(o.existingResults)?o.existingResults.find(e=>e.point_id===t):null,pe=t=>{c.value=t;const e=l.results[t.id]||{};M.value=e.status||"",A.value=e.note||"",b.value=Array.isArray(e.images)?[...e.images]:[],S.value=!1,D.value=!0},ve=()=>{c.value&&(l.results[c.value.id]={...l.results[c.value.id],status:M.value,note:A.value,images:Array.isArray(b.value)?[...b.value]:[]},I(c.value.id),k.value="Data berhasil disimpan!",setTimeout(()=>{k.value=""},1e3)),z()},ge=()=>{S.value=!1,w.value=""},z=()=>{D.value=!1,c.value=null,M.value="",A.value="",b.value=[]},_=be().props.inspection,p=h(((se=o.appMenu[0])==null?void 0:se.id)||"conclusion"),G=h(0),V=B(()=>p.value!=="conclusion"?o.appMenu.find(t=>t.id===p.value):null);function me(){const t={},e={};return o.appMenu.forEach(s=>{(s.points||[]).forEach(i=>{var v;const r=Array.isArray(o.existingResults)?o.existingResults.find(m=>m.point_id===i.id):null;t[i.id]={status:(r==null?void 0:r.status)||"",note:(r==null?void 0:r.note)||""};const d=((v=o.existingImages)==null?void 0:v[i.id])||[];e[i.id]=d.map(m=>({id:m.id,image_path:m.image_path,preview:`/${m.image_path}`,rotation:m.rotation||0,isNew:!1}))})}),{inspection_id:o.inspection.id,results:t,images:e,overall_note:o.inspection.overall_note||""}}const l=ke(me()),Y=t=>t.input_type==="damage"?!0:t.id==="conclusion"?F():t.points.every(e=>{var r,d,v,m,P,E,R,n,N;const s=l.results[e.id];if(!s)return!1;const i=L(e.settings);switch(e.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((r=s.note)!=null&&r.trim());case"select":case"radio":if(!s.status)return!1;const x=(d=i.radios)==null?void 0:d.find(q=>q.value===s.status);return!(x!=null&&x.settings&&(x.settings.show_textarea&&x.settings.required&&!((v=s.note)!=null&&v.trim())||x.settings.show_image_upload&&x.settings.required&&((m=s.images)==null?void 0:m.length)===0));case"imageTOradio":if(((P=s.images)==null?void 0:P.length)===0||!s.status)return!1;const T=(E=i.radios)==null?void 0:E.find(q=>q.value===s.status);return!(T!=null&&T.settings&&T.settings.show_textarea&&T.settings.required&&!((R=s.note)!=null&&R.trim()));case"image":return((n=s.images)==null?void 0:n.length)>0;default:return!!s.status||!!((N=s.note)!=null&&N.trim())}}),L=t=>{if(!t)return{};if(typeof t=="string")try{return JSON.parse(t)||{}}catch(e){return console.error("Error parsing settings JSON:",e),{}}return typeof t=="object"&&t!==null?t:{}},F=()=>{var v;const e=L(o.inspection.settings).conclusion||{},s=!!e.flooded,i=!!e.collision,r=e.collision==="yes"?!!e.collision_severity:!0,d=!!((v=o.inspection.notes)!=null&&v.trim());return s&&i&&r&&d},fe=B(()=>{const e=L(o.inspection.settings).conclusion||{};return{flooded:e.flooded||null,collision:e.collision||null,collision_severity:e.collision_severity||null,note:o.inspection.notes||null,isComplete:F()}}),U=t=>{p.value=t},Z=t=>{var i;let e=G.value+t;const s=o.appMenu.length;e>=0&&e<=s&&(G.value=e,p.value=((i=o.appMenu[e])==null?void 0:i.id)||"conclusion")},he=()=>{let t=0,e=0;const s=v=>{t=v.changedTouches[0].screenX},i=v=>{e=v.changedTouches[0].screenX,r()},r=()=>{e<t-150?Z(1):e>t+150&&Z(-1)},d=document.querySelector(".relative.overflow-hidden");return d&&(d.addEventListener("touchstart",s,!1),d.addEventListener("touchend",i,!1)),()=>{d&&(d.removeEventListener("touchstart",s),d.removeEventListener("touchend",i))}},I=ue.debounce(async t=>{try{await ne.post(route("inspections.save-result"),{inspection_id:o.inspection.id,point_id:t,status:l.results[t].status,note:l.results[t].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(e){console.error("Error menyimpan hasil:",e)}},500),ye=({pointId:t,type:e,value:s})=>{l.results[t].hasOwnProperty(e)&&(l.results[t][e]=s),I(t)},ee=async t=>{if(t&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await ne.post(route("inspections.delete-result"),{inspection_id:o.inspection.id,point_id:t},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{l.results[t]&&delete l.results[t],k.value="Data berhasil dihapus!",setTimeout(()=>{k.value=""},2e3)}})}catch(e){console.error("Error menghapus hasil:",e)}z()}},xe=t=>{Object.assign(l.conclusion,t),saveConclusion()},we=()=>{if(!te.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}l.post(route("inspections.final-submit",{id:o.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:t=>{console.error("Kesalahan pengiriman:",t)}})};oe(p,t=>{const e=document.querySelector(`.flex-shrink-0[data-category-id="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const te=B(()=>{const t=o.appMenu.every(s=>Y(s)),e=F();return t&&e});return oe(w,ue.debounce(()=>{},300)),_e(()=>{he()}),(t,e)=>{var s,i,r,d,v,m,P,E,R;return u(),g("div",Re,[a("div",Te,[a("div",Be,[a("button",{onClick:e[0]||(e[0]=n=>U("vehicle")),class:K(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="vehicle"}])}," Detail Kendaraan ",2),(u(!0),g(ie,null,ae($.appMenu,n=>(u(),g("button",{key:n.id,onClick:N=>U(n.id),class:K(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value===n.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!==n.id}])},[re(C(n.name)+" ",1),Y(n)?(u(),g("span",je," ✓ ")):y("",!0)],10,Ne))),128)),a("button",{onClick:e[1]||(e[1]=n=>U("conclusion")),class:K(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="conclusion"}])},[e[7]||(e[7]=re(" Kesimpulan ")),fe.value.isComplete?(u(),g("span",$e," ✓ ")):y("",!0)],2)])]),H(le,{name:"fade"},{default:O(()=>[k.value?(u(),g("div",ze,C(k.value),1)):y("",!0)]),_:1}),a("div",Le,[H(le,{name:"category-slide",mode:"out-in"},{default:O(()=>[p.value==="vehicle"?(u(),j(De,{key:0,inspection:f(_),CarDetail:$.CarDetail,onUpdateVehicle:t.updateVehicleDetails,onSaveCarDetails:t.saveNewCarDetails},null,8,["inspection","CarDetail","onUpdateVehicle","onSaveCarDetails"])):V.value&&p.value!=="conclusion"?(u(),j(Me,{key:V.value.id,category:{...V.value,points:ce(V.value.points||[],V.value.input_type==="damage")},"inspection-id":f(_).id,form:f(l),onSaveResult:f(I),onUpdateResult:ye,onHapusPoint:ee,onRemoveImage:t.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):p.value==="conclusion"?(u(),j(Ae,{key:2,form:f(l),"inspection-id":f(_).id,inspection:f(_),settings:f(_).settings||{},onUpdateConclusion:xe},null,8,["form","inspection-id","inspection","settings"])):y("",!0)]),_:1})]),p.value==="conclusion"?(u(),g("div",Fe,[a("button",{type:"button",onClick:we,disabled:!te.value||f(l).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[f(l).processing?(u(),g("svg",Ie,e[8]||(e[8]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),a("span",null,C(f(l).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Ue)])):y("",!0),!S.value&&!D.value?(u(),g("button",{key:1,onClick:e[2]||(e[2]=n=>S.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},e[9]||(e[9]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):y("",!0),H(Ve,{show:S.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:ge},{default:O(()=>[a("div",qe,[a("div",He,[Ce(a("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>w.value=n),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Se,w.value]]),e[10]||(e[10]=a("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[a("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),a("div",Ke,[J.value.length===0?(u(),g("div",Oe," Tidak ada point yang ditemukan ")):y("",!0),(u(!0),g(ie,null,ae(J.value,n=>(u(),g("button",{key:n.id,onClick:N=>pe(n),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[a("div",Je,C(n.name),1),a("div",We,C(n.description),1),a("div",Qe,C(Q(n)),1),W(n.id)?(u(),g("div",Ge," ✓ Sudah ada data ")):y("",!0)],8,Xe))),128))])])]),_:1},8,["show"]),D.value?(u(),j(Pe,{key:(s=c.value)==null?void 0:s.id,show:D.value,title:((i=c.value)==null?void 0:i.name)||"Detail Point",subtitle:(r=c.value)==null?void 0:r.description,name:`point-${(d=c.value)==null?void 0:d.id}`,"inspection-id":f(_).id,"point-id":(v=c.value)==null?void 0:v.id,settings:((m=c.value)==null?void 0:m.settings)||{},options:((E=(P=c.value)==null?void 0:P.settings)==null?void 0:E.radios)||[],"selected-Point":c.value,"selected-value":M.value,"images-value":b.value,"notes-value":A.value,point:c.value,"existing-data":de((R=c.value)==null?void 0:R.id),"onUpdate:selectedValue":e[4]||(e[4]=n=>M.value=n),"onUpdate:notesValue":e[5]||(e[5]=n=>A.value=n),"onUpdate:imagesValue":e[6]||(e[6]=n=>b.value=n),onSave:ve,onClose:z,onHapus:ee},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):y("",!0)])}}},rt=Ee(Ye,[["__scopeId","data-v-2505da9a"]]);export{rt as default};
