import{g as f,q as b,E as ke,x as Ce,W as L,s as Se,f as v,o as c,d as u,n as q,j as W,i as m,F as ie,k as ae,e as X,b as B,w as I,t as k,T as le,u as w,v as De,y as Me}from"./vendor-BTHpbkmK.js";import{l as re}from"./lodash-DIQq7uM1.js";import{V as Ee,C as Pe,_ as Ve,B as Re,a as Te}from"./ConclusionSection-lYeG3T1p.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-CGeACnVc.js";import"./ActionMessage-BtaXIXoO.js";import"./InputNumber-pQ_KuJkf.js";const Le={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Ne={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},ze={class:"flex overflow-x-auto scrollbar-hide py-3 px-4"},Be={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ae=["onClick"],Fe={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ue={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},$e={class:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1"},Oe={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},He={class:"relative overflow-hidden"},Ke={key:0,class:"flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md"},qe=["disabled"],We={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Xe={class:"space-y-4"},Ie={class:"relative"},Je={class:"max-h-64 overflow-y-auto"},Qe={key:0,class:"text-center py-4 text-gray-500"},Ge=["onClick"],Ye={class:"font-medium text-gray-900"},Ze={class:"text-sm text-gray-500"},et={class:"text-xs text-gray-400 mt-1"},tt={key:0,class:"text-xs text-green-600 mt-1"},st={__name:"InspectionForm",props:{inspection:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array},setup(h){const i=h,C=f(!1),S=f(!1),D=f(""),d=f(null),M=f(""),E=f(""),_=f(""),N=b(()=>["vehicle",...i.appMenus.map(e=>e.id),"conclusion"]),p=f(N.value[0]),J=f(0);ke(p,e=>{J.value=N.value.indexOf(e)});const A=b(()=>{if(p.value==="vehicle"||p.value==="conclusion")return null;const e=i.appMenus.find(t=>t.id===p.value);return e?{...e,points:F(e.menu_point,e.input_type==="damage")}:null}),F=(e,t)=>t?(e||[]).filter(s=>{const n=s.inspection_point_id;return Y(n)}):e||[],Q=b(()=>{i.CarDetail;const e=i.inspection;return!!e.plate_number&&!!e.car_name}),G=b(()=>{if(!D.value.trim())return i.damagePoints||[];const e=D.value.toLowerCase().trim();return(i.damagePoints||[]).filter(t=>{var s,n,a,r,g;return((n=(s=t.inspection_point)==null?void 0:s.name)==null?void 0:n.toLowerCase().includes(e))||((r=(a=t.inspection_point)==null?void 0:a.description)==null?void 0:r.toLowerCase().includes(e))||((g=Z(t))==null?void 0:g.toLowerCase().includes(e))})}),Y=e=>{const t=i.existingResults&&i.existingResults[e]!==void 0,s=i.existingImages&&i.existingImages[e]&&i.existingImages[e].length>0,n=o.results[e]&&(o.results[e].status||o.results[e].note),a=o.images[e]&&o.images[e].length>0;return t||s||n||a},Z=e=>{var t,s;return((s=(t=e.inspection_point)==null?void 0:t.component)==null?void 0:s.name)||"Komponen Tidak Diketahui"},ue=e=>i.existingResults[e]||null,ce=e=>{d.value=e;const t=e.inspection_point_id,s=o.results[t]||{};M.value=s.status||"",E.value=s.note||"",C.value=!1,S.value=!0},de=e=>{d.value&&(o.images[d.value.inspection_point_id]=e)},pe=()=>{if(d.value){const e=d.value.inspection_point_id;o.results[e]={...o.results[e],status:M.value,note:E.value},z(e),_.value="Data berhasil disimpan!",setTimeout(()=>_.value="",1e3)}U()},ge=()=>{C.value=!1,D.value=""},U=()=>{S.value=!1,d.value=null,M.value="",E.value=""},o=Ce((()=>{const e={},t={};return[...i.appMenus.flatMap(n=>n.menu_point||[]),...i.damagePoints||[]].forEach(n=>{const a=n.inspection_point_id,r=i.existingResults[a];e[a]={status:(r==null?void 0:r.status)||"",note:(r==null?void 0:r.note)||""},t[a]=i.existingImages[a]||[]}),{inspection_id:i.inspection.id,results:e,images:t,overall_note:i.inspection.overall_note||""}})()),ee=e=>e.input_type==="damage"?F(e.menu_point,!0).length>0:e.id==="conclusion"?O():F(e.menu_point,!1).every(s=>{var g,P,V,R,T,j;const n=o.results[s.inspection_point_id],a=o.images[s.inspection_point_id];if(!n)return!1;const r=$(s.settings);switch(s.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((g=n.note)!=null&&g.trim());case"select":case"radio":if(!n.status)return!1;const x=(P=r.radios)==null?void 0:P.find(l=>l.value===n.status);return!(x!=null&&x.settings&&(x.settings.show_textarea&&!((V=n.note)!=null&&V.trim())||x.settings.show_image_upload&&(a==null?void 0:a.length)===0));case"imageTOradio":if((a==null?void 0:a.length)===0||!n.status)return!1;const y=(R=r.radios)==null?void 0:R.find(l=>l.value===n.status);return!(y!=null&&y.settings&&y.settings.show_textarea&&y.settings.required&&!((T=n.note)!=null&&T.trim()));case"image":return(a==null?void 0:a.length)>0;default:return!!n.status||!!((j=n.note)!=null&&j.trim())}}),$=e=>{if(!e)return{};if(typeof e=="string")try{return JSON.parse(e)||{}}catch(t){return console.error("Error parsing settings JSON:",t),{}}return typeof e=="object"&&e!==null?e:{}},O=()=>{var g;const t=$(i.inspection.settings).conclusion||{},s=!!t.flooded,n=!!t.collision,a=t.collision==="yes"?!!t.collision_severity:!0,r=!!((g=i.inspection.notes)!=null&&g.trim());return s&&n&&a&&r},ve=b(()=>{const t=$(i.inspection.settings).conclusion||{};return{flooded:t.flooded||null,collision:t.collision||null,collision_severity:t.collision_severity||null,note:i.inspection.notes||null,isComplete:O()}}),te=b(()=>{const e=Q.value,t=i.appMenus.every(n=>ee(n)),s=O();return e&&t&&s}),H=e=>{p.value=e},se=e=>{let t=J.value+e;t>=0&&t<N.value.length&&(p.value=N.value[t])},z=re.debounce(async e=>{var t,s;try{await L.post(route("inspections.save-result"),{inspection_id:i.inspection.id,point_id:e,status:(t=o.results[e])==null?void 0:t.status,note:(s=o.results[e])==null?void 0:s.note,images:o.images[e]},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{L.reload({only:["existingResults","existingImages"]})}})}catch(n){console.error("Error menyimpan hasil:",n)}},500),me=({pointId:e,type:t,value:s})=>{var n;(n=o.results[e])!=null&&n.hasOwnProperty(t)&&(o.results[e][t]=s),z(e)},ne=async e=>{if(e&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await L.post(route("inspections.delete-result"),{inspection_id:i.inspection.id,point_id:e},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{o.results[e]&&delete o.results[e],o.images[e]&&delete o.images[e],_.value="Data berhasil dihapus!",setTimeout(()=>{_.value=""},2e3),L.reload({only:["existingResults","existingImages"]})},onError:t=>{console.error("Error menghapus hasil:",t)}})}catch(t){console.error("Error menghapus hasil:",t)}U()}},he=e=>{console.log("Update vehicle:",e)},fe=e=>{console.log("Save car details:",e)},xe=e=>{Object.assign(o.conclusion,e),ye()},ye=re.debounce(async()=>{try{await L.post(route("inspections.save-conclusion"),{inspection_id:i.inspection.id,...o.conclusion},{preserveScroll:!0,preserveState:!0})}catch(e){console.error("Error menyimpan kesimpulan:",e)}},500),we=()=>{if(!te.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}o.post(route("inspections.final-submit",{id:i.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:e=>{console.error("Kesalahan pengiriman:",e)}})},_e=({pointId:e,imageId:t})=>{o.images[e]&&(o.images[e]=o.images[e].filter(s=>s.id!==t),z(e))},be=()=>{let e=0,t=0;const s=g=>{e=g.changedTouches[0].screenX},n=g=>{t=g.changedTouches[0].screenX,a()},a=()=>{t<e-150?se(1):t>e+150&&se(-1)},r=document.querySelector(".relative.overflow-hidden");return r&&(r.addEventListener("touchstart",s,!1),r.addEventListener("touchend",n,!1)),()=>{r&&(r.removeEventListener("touchstart",s),r.removeEventListener("touchend",n))}};return Se(()=>{be()}),(e,t)=>{var s,n,a,r,g,P,V,R,T,j,x,y;return c(),v("div",Le,[u("div",Ne,[u("div",ze,[u("button",{onClick:t[0]||(t[0]=l=>H("vehicle")),class:q(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="vehicle"}])},[t[6]||(t[6]=W(" Detail Kendaraan ")),Q.value?(c(),v("span",Be," ✓ ")):m("",!0)],2),(c(!0),v(ie,null,ae(h.appMenus,l=>(c(),v("button",{key:l.id,onClick:K=>H(l.id),class:q(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value===l.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!==l.id}])},[W(k(l.name)+" ",1),ee(l)?(c(),v("span",Fe," ✓ ")):m("",!0)],10,Ae))),128)),u("button",{onClick:t[1]||(t[1]=l=>H("conclusion")),class:q(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="conclusion"}])},[t[7]||(t[7]=W(" Kesimpulan ")),ve.value.isComplete?(c(),v("span",Ue," ✓ ")):m("",!0)],2)])]),u("div",$e,[X(le,{name:"fade"},{default:I(()=>[_.value?(c(),v("div",Oe,k(_.value),1)):m("",!0)]),_:1}),u("div",He,[X(le,{name:"category-slide",mode:"out-in"},{default:I(()=>[p.value==="vehicle"?(c(),B(Ee,{key:0,inspection:h.inspection,CarDetail:h.CarDetail,onUpdateVehicle:he,onSaveCarDetails:fe},null,8,["inspection","CarDetail"])):A.value&&p.value!=="conclusion"?(c(),B(Pe,{key:A.value.id,category:A.value,"inspection-id":h.inspection.id,form:w(o),onSaveResult:w(z),onUpdateResult:me,onHapusPoint:ne,onRemoveImage:_e},null,8,["category","inspection-id","form","onSaveResult"])):p.value==="conclusion"?(c(),B(Ve,{key:2,form:w(o),"inspection-id":h.inspection.id,inspection:h.inspection,settings:h.inspection.settings||{},onUpdateConclusion:xe},null,8,["form","inspection-id","inspection","settings"])):m("",!0)]),_:1})]),p.value==="conclusion"?(c(),v("div",Ke,[u("button",{type:"button",onClick:we,disabled:!te.value||w(o).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[w(o).processing?(c(),v("svg",We,t[8]||(t[8]=[u("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),u("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):m("",!0),u("span",null,k(w(o).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,qe)])):m("",!0),!C.value&&!S.value?(c(),v("button",{key:1,onClick:t[2]||(t[2]=l=>C.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},t[9]||(t[9]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):m("",!0),X(Re,{show:C.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:ge},{default:I(()=>[u("div",Xe,[u("div",Ie,[De(u("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>D.value=l),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Me,D.value]]),t[10]||(t[10]=u("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[u("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),u("div",Je,[G.value.length===0?(c(),v("div",Qe," Tidak ada point yang ditemukan ")):m("",!0),(c(!0),v(ie,null,ae(G.value,l=>{var K,oe;return c(),v("button",{key:l.id,onClick:ot=>ce(l),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[u("div",Ye,k((K=l.inspection_point)==null?void 0:K.name),1),u("div",Ze,k((oe=l.inspection_point)==null?void 0:oe.description),1),u("div",et,k(Z(l)),1),Y(l.inspection_point_id)?(c(),v("div",tt," ✓ Sudah ada data ")):m("",!0)],8,Ge)}),128))])])]),_:1},8,["show"]),S.value?(c(),B(Te,{key:(s=d.value)==null?void 0:s.id,show:S.value,title:((a=(n=d.value)==null?void 0:n.inspection_point)==null?void 0:a.name)||"Detail Point",subtitle:(g=(r=d.value)==null?void 0:r.inspection_point)==null?void 0:g.description,name:`point-${(P=d.value)==null?void 0:P.id}`,"inspection-id":h.inspection.id,"point-id":(V=d.value)==null?void 0:V.inspection_point_id,settings:((R=d.value)==null?void 0:R.settings)||{},options:((j=(T=d.value)==null?void 0:T.settings)==null?void 0:j.radios)||[],"selected-Point":d.value,"selected-value":M.value,"images-value":w(o).images[(x=d.value)==null?void 0:x.inspection_point_id],"notes-value":E.value,point:d.value,"existing-data":ue((y=d.value)==null?void 0:y.inspection_point_id),"onUpdate:selectedValue":t[4]||(t[4]=l=>M.value=l),"onUpdate:notesValue":t[5]||(t[5]=l=>E.value=l),"onUpdate:imagesValue":de,onSave:pe,onClose:U,onHapus:ne},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):m("",!0)])])}}},pt=je(st,[["__scopeId","data-v-a003d737"]]);export{pt as default};
