import{e as u,o as a,a as s,f as x,t as S,F as E,h as L,j as X,n as M,c as $,g as P,d as j,k as G,x as H,W as B,q as W,C as J,b as K,w as Q,u as C,T as Y,B as T}from"./app-wO0gYQXX.js";import{l as Z}from"./lodash-CkK6jCzm.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"mt-1"},te=["value","required","minlength","maxlength","pattern","placeholder"],re={key:0,class:"mt-2 text-sm text-red-600"},se={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:m}){const h=e,c=m,p=v=>{c("update:modelValue",v.target.value),c("save",h.pointId)};return(v,n)=>(a(),u("div",ee,[s("input",{value:e.modelValue,onInput:p,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,pattern:e.pattern,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,te),e.error?(a(),u("p",re,S(e.error),1)):x("",!0)]))}},oe={class:"mt-1"},ae=["value","required","min","max","step","placeholder"],ne={key:0,class:"mt-2 text-sm text-red-600"},le={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:m}){const h=e,c=m,p=v=>{const n=v.target.valueAsNumber||v.target.value;c("update:modelValue",n),c("save",h.pointId)};return(v,n)=>(a(),u("div",oe,[s("input",{value:e.modelValue,onInput:p,type:"number",required:e.required,min:e.min,max:e.max,step:e.step,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ae),e.error?(a(),u("p",ne,S(e.error),1)):x("",!0)]))}},ie={class:"mt-1"},de=["value","required","min","max"],ue={key:0,class:"mt-2 text-sm text-red-600"},ce={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:m}){const h=e,c=m,p=v=>{c("update:modelValue",v.target.value),c("save",h.pointId)};return(v,n)=>(a(),u("div",ie,[s("input",{value:e.modelValue,onChange:p,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,de),e.error?(a(),u("p",ue,S(e.error),1)):x("",!0)]))}},me={class:"mt-1"},ge=["value","required"],he={key:0,class:"mt-2 text-sm text-red-600"},ve={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:m}){const h=e,c=m,p=v=>{c("update:modelValue",v.target.value),c("save",h.pointId)};return(v,n)=>(a(),u("div",me,[s("select",{value:e.modelValue,onChange:p,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},n[0]||(n[0]=[s("option",{value:"",disabled:""},"Select status",-1),s("option",{value:"good"},"Good",-1),s("option",{value:"bad"},"Bad",-1),s("option",{value:"na"},"N/A",-1)]),40,ge),e.error?(a(),u("p",he,S(e.error),1)):x("",!0)]))}},fe=A(ve,[["__scopeId","data-v-c34a74db"]]),xe={class:"mt-2"},pe={class:"flex flex-col gap-2 sm:flex-row sm:items-center"},be=["name","value","checked","onChange","required"],ye={class:"text-sm text-gray-700"},we={key:0,class:"mt-2 text-sm text-red-600"},Ve={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number],options:{type:Array,default:()=>[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}]}},emits:["update:modelValue","save"],setup(e,{emit:m}){const h=e,c=m,p=v=>{c("update:modelValue",v),c("save",h.pointId)};return(v,n)=>(a(),u("div",xe,[s("div",pe,[(a(!0),u(E,null,L(e.options,g=>(a(),u("label",{key:g.value,class:"inline-flex items-center space-x-2"},[s("input",{type:"radio",name:"radio-"+e.pointId,value:g.value,checked:e.modelValue===g.value,onChange:V=>p(g.value),required:e.required,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,be),s("span",ye,S(g.label),1)]))),128))]),e.error?(a(),u("p",we,S(e.error),1)):x("",!0)]))}},ke=["id"],Se=["for"],$e={key:0,class:"h-full flex flex-col items-center justify-center p-4 text-center"},Ie={key:1,class:"p-2"},qe={class:"grid grid-cols-3 gap-2"},Ce=["src"],_e=["onClick"],Re={key:0,class:"mt-1 text-xs text-red-600"},Ue={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,pointId:[String,Number]},emits:["update:modelValue","save","removeImage"],setup(e,{emit:m}){const h=e,c=m,p=n=>{const g=Array.from(n.target.files);if(!g.length)return;const V=g.map(f=>({file:f,preview:URL.createObjectURL(f)}));c("update:modelValue",[...h.modelValue,...V]),c("save",h.pointId),n.target.value=""},v=n=>{const g=[...h.modelValue],V=g.splice(n,1)[0];V.preview&&URL.revokeObjectURL(V.preview),c("update:modelValue",g),c("removeImage",{index:n,pointId:h.pointId})};return(n,g)=>(a(),u("div",null,[s("input",{type:"file",onChange:p,accept:"image/*",class:"hidden",id:"image-upload-"+e.pointId,multiple:""},null,40,ke),s("label",{for:"image-upload-"+e.pointId,class:M(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200",{"border-gray-300 hover:border-indigo-400 bg-gray-50":e.modelValue.length===0,"border-indigo-300 bg-indigo-50":e.modelValue.length>0,"h-28":e.modelValue.length===0,"h-auto":e.modelValue.length>0}])},[e.modelValue.length===0?(a(),u("div",$e,g[0]||(g[0]=[s("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),s("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1),s("p",{class:"text-xs text-gray-500"},"Click to browse or drag and drop",-1)]))):(a(),u("div",Ie,[s("div",qe,[(a(!0),u(E,null,L(e.modelValue,(V,f)=>(a(),u("div",{key:f,class:"relative aspect-square"},[s("img",{src:V.preview||"/storage/"+V.image_path,class:"w-full h-full object-cover rounded-md border border-gray-200"},null,8,Ce),s("button",{onClick:X(k=>v(f),["stop"]),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm"}," × ",8,_e)]))),128))]),g[1]||(g[1]=s("div",{class:"mt-2 text-center"},[s("span",{class:"inline-block px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"}," + Add More Images ")],-1))]))],10,Se),e.error?(a(),u("p",Re,S(e.error),1)):x("",!0)]))}},Ne={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ee={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},Le={class:"text-xl font-semibold text-indigo-700"},je={class:"p-6 space-y-8"},Be={class:"flex items-start justify-between"},Ae={class:"block text-sm font-medium text-gray-700"},Fe={key:0,class:"text-red-500"},ze={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},De={__name:"CategorySection",props:{category:Object,form:Object},emits:["saveResult","updateResult","removeImage"],setup(e,{emit:m}){const h=e,c=m,p=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],v=f=>{var t;const k=h.form.results[f.id];if(!k)return!1;switch(f.input_type){case"text":case"number":case"date":return!!k.note;case"select":case"radio":return!!k.status;case"image":return((t=k.images)==null?void 0:t.length)>0;default:return!1}},n=(f,k)=>{c("updateResult",{pointId:f,value:k})},g=f=>{c("saveResult",f)},V=(f,k)=>{c("removeImage",{pointId:f,imageIndex:k})};return(f,k)=>(a(),u("div",Ne,[s("div",Ee,[s("h2",Le,S(e.category.name),1)]),s("div",je,[(a(!0),u(E,null,L(e.category.points,t=>{var _,R,U,N,I,o,r,l,d,y,b,w,q,F,z,D,O;return a(),u("div",{key:t.id,class:"space-y-4 pb-6 border-b border-gray-100 last:border-0 last:pb-0"},[s("div",Be,[s("label",Ae,[P(S(t.name)+" ",1),(_=t.settings)!=null&&_.is_required?(a(),u("span",Fe,"*")):x("",!0)]),v(t)?(a(),u("span",ze," ✓ ")):x("",!0)]),t.input_type==="text"?(a(),$(se,{key:0,modelValue:e.form.results[t.id].note,"onUpdate:modelValue":[i=>e.form.results[t.id].note=i,i=>n(t.id,i)],required:(R=t.settings)==null?void 0:R.is_required,"min-length":(U=t.settings)==null?void 0:U.min_length,"max-length":(N=t.settings)==null?void 0:N.max_length,pattern:(I=t.settings)==null?void 0:I.pattern,placeholder:((o=t.settings)==null?void 0:o.placeholder)||"Enter text",error:e.form.errors[`results.${t.id}.note`],onSave:i=>g(t.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):x("",!0),t.input_type==="number"?(a(),$(le,{key:1,modelValue:e.form.results[t.id].note,"onUpdate:modelValue":[i=>e.form.results[t.id].note=i,i=>n(t.id,i)],required:(r=t.settings)==null?void 0:r.is_required,min:(l=t.settings)==null?void 0:l.min,max:(d=t.settings)==null?void 0:d.max,step:((y=t.settings)==null?void 0:y.step)||1,placeholder:((b=t.settings)==null?void 0:b.placeholder)||"Enter number",error:e.form.errors[`results.${t.id}.note`],onSave:i=>g(t.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):x("",!0),t.input_type==="date"?(a(),$(ce,{key:2,modelValue:e.form.results[t.id].note,"onUpdate:modelValue":[i=>e.form.results[t.id].note=i,i=>n(t.id,i)],required:(w=t.settings)==null?void 0:w.is_required,"min-date":(q=t.settings)==null?void 0:q.min_date,"max-date":(F=t.settings)==null?void 0:F.max_date,error:e.form.errors[`results.${t.id}.note`],onSave:i=>g(t.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):x("",!0),t.input_type==="select"?(a(),$(fe,{key:3,modelValue:e.form.results[t.id].status,"onUpdate:modelValue":[i=>e.form.results[t.id].status=i,i=>n(t.id,i)],required:(z=t.settings)==null?void 0:z.is_required,error:e.form.errors[`results.${t.id}.status`],onSave:i=>g(t.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):x("",!0),t.input_type==="radio"?(a(),$(Ve,{key:4,modelValue:e.form.results[t.id].status,"onUpdate:modelValue":[i=>e.form.results[t.id].status=i,i=>n(t.id,i)],required:(D=t.settings)==null?void 0:D.is_required,options:((O=t.settings)==null?void 0:O.radios)||p,error:e.form.errors[`results.${t.id}.status`],onSave:i=>g(t.id)},null,8,["modelValue","onUpdate:modelValue","required","options","error","onSave"])):x("",!0),t.input_type==="image"?(a(),$(Ue,{key:5,modelValue:e.form.results[t.id].images,"onUpdate:modelValue":[i=>e.form.results[t.id].images=i,i=>n(t.id,i)],error:e.form.errors[`results.${t.id}.images`],onSave:i=>g(t.id),onRemoveImage:i=>V(t.id,i)},null,8,["modelValue","onUpdate:modelValue","error","onSave","onRemoveImage"])):x("",!0)])}),128))])]))}},Oe=A(De,[["__scopeId","data-v-0537cb06"]]),Te={class:"container mx-auto px-4 py-8"},Me={class:"bg-white rounded-xl shadow-md overflow-hidden p-6 mb-8"},Pe={class:"text-xl font-semibold text-indigo-600"},Xe={class:"sticky top-0 z-10 bg-white shadow-sm mb-6"},Ge={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},He=["onClick"],We={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Je={class:"relative overflow-hidden"},Ke={class:"flex justify-end gap-4 mt-8"},Qe=["disabled"],Ye={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ze={__name:"InspectionForm",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(e){var I;const m=e,h=j(((I=m.categories[0])==null?void 0:I.id)||null),c=j(0);j(null);const p=G(()=>m.categories.find(o=>o.id===h.value)),n=H((()=>{const o={};return m.categories.forEach(r=>{(r.points||[]).forEach(l=>{var y,b;const d=Array.isArray(m.existingResults)?m.existingResults.find(w=>w.point_id===l.id):null;o[l.id]={status:(d==null?void 0:d.status)||"",note:(d==null?void 0:d.note)||"",images:((b=(y=m.existingImages)==null?void 0:y[l.id])==null?void 0:b.map(w=>({image_path:w.image_path,preview:null})))||[]}})}),{inspection_id:m.inspection.id,results:o}})()),g=o=>o.points.every(r=>{var d;const l=n.results[r.id];if(!l)return!1;switch(r.input_type){case"text":case"number":case"date":return!!l.note;case"select":case"radio":return!!l.status;case"image":return((d=l.images)==null?void 0:d.length)>0;default:return!!l.status||!!l.note}}),V=o=>{const r=m.categories.findIndex(l=>l.id===o);r>=0&&(c.value=r,h.value=o)},f=o=>{const r=c.value+o;r>=0&&r<m.categories.length&&(c.value=r,h.value=m.categories[r].id)},k=()=>{let o=0,r=0;const l=w=>{o=w.changedTouches[0].screenX},d=w=>{r=w.changedTouches[0].screenX,y()},y=()=>{r<o-50?f(1):r>o+50&&f(-1)},b=document.querySelector(".relative.overflow-hidden");return b&&(b.addEventListener("touchstart",l,!1),b.addEventListener("touchend",d,!1)),()=>{b&&(b.removeEventListener("touchstart",l),b.removeEventListener("touchend",d))}},t=Z.debounce(async o=>{try{await B.post(route("inspections.save-result"),{inspection_id:m.inspection.id,point_id:o,status:n.results[o].status,note:n.results[o].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(r){console.error("Error saving result:",r)}},500),_=({pointId:o,type:r,value:l})=>{r==="note"?n.results[o].note=l:r==="status"&&(n.results[o].status=l),t(o)},R=async(o,r)=>{const l=o.target.files[0];if(!l)return;const d=URL.createObjectURL(l);try{const y=new FormData;y.append("inspection_id",m.inspection.id),y.append("point_id",r),y.append("image",l),await B.post(route("inspections.upload-image"),y,{preserveScroll:!0,onSuccess:b=>{var q;const w=((q=b.props.flash)==null?void 0:q.imagePath)||b.props.imagePath;w?n.results[r].images.push({image_path:w,preview:d}):console.error("Image path not returned from upload, cannot update UI.")},onError:b=>{console.error("Error uploading image:",b),alert("Failed to upload image. Please try again.")}})}catch(y){console.error("Error uploading image:",y),alert("An unexpected error occurred during image upload.")}finally{o.target.value=""}},U=async(o,r)=>{const l=n.results[o].images[r];if(l)try{await B.delete(route("inspections.delete-image"),{data:{image_path:l.image_path,point_id:o,inspection_id:m.inspection.id},preserveScroll:!0,onSuccess:()=>{n.results[o].images.splice(r,1),l.preview&&URL.revokeObjectURL(l.preview)},onError:d=>{console.error("Error deleting image:",d),alert("Failed to delete image. Please try again.")}})}catch(d){console.error("Error deleting image:",d),alert("An unexpected error occurred during image deletion.")}},N=()=>{n.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{T().props.flash.success="Inspection submitted successfully!"},onError:o=>{console.error("Submission errors:",o),T().props.flash.error="There were errors in your submission. Please check all fields."}})};return W(()=>{k()}),J(h,o=>{const r=document.querySelector(`.flex-shrink-0[data-category-id="${o}"]`);r&&r.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(o,r)=>{var l;return a(),u("div",Te,[s("div",Me,[r[2]||(r[2]=s("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Vehicle Inspection",-1)),s("h2",Pe,S(((l=e.inspection.car)==null?void 0:l.brand_id)||"Unknown Vehicle"),1)]),s("div",Xe,[s("div",Ge,[(a(!0),u(E,null,L(e.categories,d=>(a(),u("button",{key:d.id,onClick:y=>V(d.id),class:M(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":h.value===d.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":h.value!==d.id}])},[P(S(d.name)+" ",1),g(d)?(a(),u("span",We," ✓ ")):x("",!0)],10,He))),128))])]),s("div",Je,[K(Y,{name:"category-slide",mode:"out-in"},{default:Q(()=>[p.value?(a(),$(Oe,{key:p.value.id,category:p.value,form:C(n),onSaveResult:C(t),onUpdateResult:_,onRemoveImage:U,onHandleImageUpload:R},null,8,["category","form","onSaveResult"])):x("",!0)]),_:1}),c.value>0?(a(),u("button",{key:0,onClick:r[0]||(r[0]=d=>f(-1)),class:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white rounded-full shadow-md p-2 text-indigo-600 hover:bg-indigo-50"},r[3]||(r[3]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):x("",!0),c.value<e.categories.length-1?(a(),u("button",{key:1,onClick:r[1]||(r[1]=d=>f(1)),class:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white rounded-full shadow-md p-2 text-indigo-600 hover:bg-indigo-50"},r[4]||(r[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):x("",!0)]),s("div",Ke,[s("button",{type:"button",onClick:N,disabled:C(n).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[C(n).processing?(a(),u("svg",Ye,r[5]||(r[5]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):x("",!0),s("span",null,S(C(n).processing?"Submitting...":"Final Submit Inspection"),1)],8,Qe)])])}}},st=A(Ze,[["__scopeId","data-v-9536b50c"]]);export{st as default};
