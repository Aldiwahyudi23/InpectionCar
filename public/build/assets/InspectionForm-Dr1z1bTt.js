import{e as g,o as u,a,f as $,t as L,F as G,h as X,p as ie,d as V,C as Z,D as de,n as O,k as ee,E as ne,b as Q,j as te,G as se,c as H,g as ae,x as ue,W as J,q as ce,w as me,u as T,l as ge,s as he,T as ve,B as oe}from"./app-CD-ePhpI.js";import{l as re}from"./lodash-CuQ7LPZI.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"mt-1"},fe=["value","required","minlength","maxlength","pattern","placeholder"],we={key:0,class:"mt-2 text-sm text-red-600"},be={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:f}){const r=e,v=f,w=y=>{v("update:modelValue",y.target.value),v("save",r.pointId)};return(y,c)=>(u(),g("div",pe,[a("input",{value:e.modelValue,onInput:w,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,pattern:e.pattern,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,fe),e.error?(u(),g("p",we,L(e.error),1)):$("",!0)]))}},xe={class:"mt-1"},ye=["value","required","min","max","step","placeholder"],ke={key:0,class:"mt-2 text-sm text-red-600"},Ie={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:f}){const r=e,v=f,w=y=>{const c=y.target.value;v("update:modelValue",c),v("save",r.pointId)};return(y,c)=>(u(),g("div",xe,[a("input",{value:e.modelValue,onInput:w,type:"number",required:e.required,min:e.min,max:e.max,step:e.step,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ye),e.error?(u(),g("p",ke,L(e.error),1)):$("",!0)]))}},$e={class:"mt-1"},_e=["value","required","min","max"],Ce={key:0,class:"mt-2 text-sm text-red-600"},Se={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:f}){const r=e,v=f,w=y=>{v("update:modelValue",y.target.value),v("save",r.pointId)};return(y,c)=>(u(),g("div",$e,[a("input",{value:e.modelValue,onChange:w,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,_e),e.error?(u(),g("p",Ce,L(e.error),1)):$("",!0)]))}},Ve={class:"mt-1"},Me=["value","required"],Re={key:0,class:"mt-2 text-sm text-red-600"},Le={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:f}){const r=e,v=f,w=y=>{v("update:modelValue",y.target.value),v("save",r.pointId)};return(y,c)=>(u(),g("div",Ve,[a("select",{value:e.modelValue,onChange:w,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},c[0]||(c[0]=[a("option",{value:"",disabled:""},"Select status",-1),a("option",{value:"good"},"Good",-1),a("option",{value:"bad"},"Bad",-1),a("option",{value:"na"},"N/A",-1)]),40,Me),e.error?(u(),g("p",Re,L(e.error),1)):$("",!0)]))}},Ue=K(Le,[["__scopeId","data-v-c34a74db"]]),je={class:"mt-2"},Ne={class:"flex flex-col gap-2 sm:flex-row sm:items-center"},qe=["name","value","checked","onChange","required"],Pe={class:"text-sm text-gray-700"},Ee={key:0,class:"mt-2 text-sm text-red-600"},Be={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number],options:{type:Array,default:()=>[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}]}},emits:["update:modelValue","save"],setup(e,{emit:f}){const r=e,v=f,w=y=>{v("update:modelValue",y),v("save",r.pointId)};return(y,c)=>(u(),g("div",je,[a("div",Ne,[(u(!0),g(G,null,X(e.options,h=>(u(),g("label",{key:h.value,class:"inline-flex items-center space-x-2"},[a("input",{type:"radio",name:"radio-"+e.pointId,value:h.value,checked:e.modelValue===h.value,onChange:_=>w(h.value),required:e.required,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,qe),a("span",Pe,L(h.label),1)]))),128))]),e.error?(u(),g("p",Ee,L(e.error),1)):$("",!0)]))}},Fe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 p-4"},Te={class:"bg-white w-full max-w-sm rounded-xl shadow-xl overflow-hidden"},Ae={class:"p-4"},We={class:"flex justify-center gap-6"},De={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","openWebcam","triggerGallery"],setup(e){return(f,r)=>e.show?(u(),g("div",Fe,[a("div",Te,[a("div",Ae,[r[5]||(r[5]=a("h3",{class:"text-lg font-medium text-center text-gray-800 mb-4"},"Select Image Source",-1)),a("div",We,[a("button",{onClick:r[0]||(r[0]=v=>f.$emit("openWebcam")),class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-blue-50 hover:bg-blue-100 transition-colors"},r[3]||(r[3]=[ie('<div class="bg-blue-100 p-3 rounded-full mb-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div><span class="text-sm font-medium text-gray-700">Camera</span>',2)])),a("button",{onClick:r[1]||(r[1]=v=>f.$emit("triggerGallery")),class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-purple-50 hover:bg-purple-100 transition-colors"},r[4]||(r[4]=[a("div",{class:"bg-purple-100 p-3 rounded-full mb-2"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1),a("span",{class:"text-sm font-medium text-gray-700"},"Gallery",-1)]))])]),a("button",{onClick:r[2]||(r[2]=v=>f.$emit("close")),class:"w-full py-3 text-center text-gray-500 font-medium border-t border-gray-100 hover:bg-gray-50 transition-colors"},"Cancel")])])):$("",!0)}},He={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},ze={class:"webcam-content-box"},Oe={class:"webcam-header"},Ge={class:"flex gap-4"},Xe=["disabled"],Ke={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ye={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Je={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Qe=["disabled"],Ze={key:0,class:"screen-flash-overlay"},et={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object},emits:["close","photoCaptured"],setup(e,{emit:f}){const r=e,v=f,w=V(null),y=V(null);let c=null,h=null;const _=V("environment"),p=V(!1),k=V(!1),s=V(!1),M=V(!1),j=async()=>{c&&c.getTracks().forEach(o=>o.stop()),s.value=!1;try{const o={facingMode:_.value,width:{ideal:1280},height:{ideal:960},aspectRatio:{exact:r.aspectRatio}};_.value==="environment"&&(o.advanced=[{focusMode:"continuous"}]),c=await navigator.mediaDevices.getUserMedia({video:o}),h=c.getVideoTracks()[0],w.value.srcObject=c,w.value.onloadedmetadata=async()=>{w.value.style.width="100%",w.value.style.height="auto",w.value.style.objectFit="cover",await E()}}catch(o){console.error("Error accessing camera: ",o),alert("Failed to access camera. Please ensure camera permissions are granted and try again."),v("close")}},N=()=>{c&&c.getTracks().forEach(o=>o.stop()),v("close")},E=async()=>{if(!h)return;const m=(await navigator.mediaDevices.enumerateDevices()).filter(I=>I.kind==="videoinput");p.value=m.length>1;const C=h.getCapabilities();k.value=C.torch||C.fillLightMode&&C.fillLightMode.includes("torch")},q=async()=>{if(!(!h||!r.settings.enable_flash)){if(_.value==="user"){s.value=!s.value;return}try{if(h.getCapabilities().torch)await h.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value;else{console.warn("Torch API not directly supported, checking fillLightMode.");const o=h.getCapabilities();o.fillLightMode&&o.fillLightMode.includes("torch")?(await h.applyConstraints({fillLightMode:s.value?"none":"torch"}),s.value=!s.value):(alert("Flash/Torch is not supported on this camera."),k.value=!1)}}catch(o){console.error("Error toggling flash: ",o),alert("Could not toggle flash. Feature might not be supported."),k.value=!1}}},R=async()=>{!p.value||!r.settings.enable_camera_switch||(_.value=_.value==="environment"?"user":"environment",await j())},i=async()=>{if(!h)return;const o=h.getCapabilities();if(o.focusMode&&o.focusMode.includes("continuous"))try{await h.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(m){console.warn("Failed to apply continuous focus constraint:",m)}else console.log("Autofocus not explicitly controllable or not supported.")},d=async()=>{if(!w.value||!y.value)return;_.value==="user"&&s.value&&(M.value=!0,await new Promise(t=>setTimeout(t,100)),M.value=!1);const o=w.value,m=y.value,C=m.getContext("2d"),I=o.videoWidth,S=o.videoHeight;let U=I,B=S,A=0,W=0;I/S>r.aspectRatio?(U=S*r.aspectRatio,A=(I-U)/2):I/S<r.aspectRatio&&(B=I/r.aspectRatio,W=(S-B)/2),m.width=U,m.height=B,C.drawImage(o,A,W,U,B,0,0,m.width,m.height),m.toBlob(t=>{if(t){const x=new File([t],`captured_image_${Date.now()}.png`,{type:"image/png"});v("photoCaptured",x)}else console.error("Failed to convert canvas to blob.")},"image/png")};return Z(()=>r.show,o=>{o?j():N()}),de(()=>{c&&c.getTracks().forEach(o=>o.stop())}),(o,m)=>e.show?(u(),g("div",He,[a("div",ze,[a("div",Oe,[a("button",{onClick:N,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},m[0]||(m[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),a("div",Ge,[e.settings.enable_flash?(u(),g("button",{key:0,onClick:q,disabled:!k.value,class:O(["p-2 rounded-full text-white",{"bg-gray-700":s.value,"hover:bg-gray-700":k.value,"opacity-50 cursor-not-allowed":!k.value}])},[k.value?s.value?(u(),g("svg",Ye,m[2]||(m[2]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):(u(),g("svg",Je,m[3]||(m[3]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6"},null,-1)]))):(u(),g("svg",Ke,m[1]||(m[1]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.102 1.101m-.757 4.898l-4 4L9.828 9.828m4.899-.757l4-4L14.172 14.172"},null,-1)])))],10,Xe)):$("",!0),e.settings.enable_camera_switch?(u(),g("button",{key:1,onClick:R,disabled:!p.value,class:O(["p-2 rounded-full text-white hover:bg-gray-700",{"opacity-50 cursor-not-allowed":!p.value}])},m[4]||(m[4]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8h16M4 16h16M6 4h.01M6 20h.01M10 4h.01M10 20h.01M14 4h.01M14 20h.01M18 4h.01M18 20h.01"})],-1)]),10,Qe)):$("",!0)])]),a("div",{class:"webcam-video-container",onClick:i},[a("video",{ref_key:"webcamVideo",ref:w,autoplay:"",playsinline:"",class:"webcam-video"},null,512),a("canvas",{ref_key:"webcamCanvas",ref:y,class:"hidden"},null,512),M.value?(u(),g("div",Ze)):$("",!0)]),a("div",{class:"webcam-footer"},[a("button",{onClick:d,class:"capture-button"})])])])):$("",!0)}},tt=K(et,[["__scopeId","data-v-486b3fb6"]]),at={key:0,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center"},st={class:"w-full h-full flex flex-col"},ot={class:"flex justify-between items-center p-4 bg-black bg-opacity-50 text-white"},rt={class:"text-lg font-medium"},nt={class:"flex-1 flex items-center justify-center overflow-hidden relative"},lt=["src"],it={class:"flex justify-between p-4 bg-black bg-opacity-50"},dt={__name:"ImagePreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number},emits:["close","saveImages","removePreviewImage"],setup(e,{emit:f}){const r=e,v=f,w=V(r.initialIndex),y=V(0),c=V(0),h=ee(()=>r.images.length>0?r.images[w.value]:null);Z(()=>r.initialIndex,R=>{w.value=R},{immediate:!0});const _=()=>{h.value&&(h.value.rotation=(h.value.rotation+90)%360)},p=()=>{w.value<r.images.length-1&&w.value++},k=()=>{w.value>0&&w.value--},s=R=>{y.value=R.touches[0].clientX},M=R=>{c.value=R.touches[0].clientX},j=()=>{y.value-c.value>50?p():c.value-y.value>50&&k()},N=()=>{r.images.length!==0&&(v("removePreviewImage",w.value),w.value>=r.images.length&&(w.value=Math.max(0,r.images.length-1)),r.images.length===0&&q())},E=()=>{v("saveImages",r.images)},q=()=>{v("close")};return Z(()=>r.show,R=>{R?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open")},{immediate:!0}),(R,i)=>e.show?(u(),g("div",at,[a("div",st,[a("div",ot,[a("button",{onClick:q,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},i[0]||(i[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),a("div",rt,"Preview ("+L(w.value+1)+"/"+L(e.images.length)+")",1),a("button",{onClick:_,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},i[1]||(i[1]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))]),a("div",nt,[a("div",{class:"w-full h-full flex items-center justify-center",onTouchstart:s,onTouchmove:M,onTouchend:j},[h.value?(u(),g("img",{key:0,src:h.value.preview||`/storage/${h.value.image_path}`,class:"max-w-full max-h-full object-contain",style:ne({transform:`rotate(${h.value.rotation}deg)`})},null,12,lt)):$("",!0)],32),e.images.length>1?(u(),g("button",{key:0,onClick:k,class:"absolute left-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},i[2]||(i[2]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):$("",!0),e.images.length>1?(u(),g("button",{key:1,onClick:p,class:"absolute right-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},i[3]||(i[3]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):$("",!0)]),a("div",it,[a("button",{onClick:N,class:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"}," Delete "),a("button",{onClick:E,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Save "+L(e.images.length)+" Image(s) ",1)])])])):$("",!0)}},ut=K(dt,[["__scopeId","data-v-20d483c7"]]),ct=["multiple"],mt={key:0,class:"h-full flex flex-col items-center justify-center p-4 text-center"},gt={key:1,class:"p-2"},ht={class:"grid grid-cols-3 gap-2"},vt=["onClick"],pt=["src"],ft=["onClick"],wt={key:0,class:"mt-2 text-center"},bt={key:0,class:"mt-1 text-xs text-red-600"},xt={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png"],camera_aspect_ratio:"4:3",enable_flash:!0,enable_camera_switch:!0})}},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:f}){const r=e,v=f,w=V(null),y=V(null),c=V(!1),h=V(!1),_=V(!1),p=V([]),k=V(0),s=V(!1),M=ee(()=>Number(r.settings.max_files)>1),j=ee(()=>{const t=r.settings.camera_aspect_ratio.split(":");if(t.length===2){const x=parseFloat(t[0]),n=parseFloat(t[1]);if(!isNaN(x)&&!isNaN(n)&&n!==0)return x/n}return 4/3}),N=t=>t.preview||(t.image_path?`/${t.image_path}`:""),E=t=>!t.width||!t.height||t.width===0||t.height===0?{paddingBottom:"100%",position:"relative"}:{paddingBottom:`${t.height/t.width*100}%`,position:"relative"},q=()=>{r.modelValue.length===0?R():S(0)},R=()=>{c.value=!0},i=()=>{c.value=!1,w.value.click()},d=t=>new Promise(x=>{const n=new FileReader;n.onload=l=>{const b=new Image;b.onload=()=>{x({file:t,preview:URL.createObjectURL(t),rotation:0,width:b.naturalWidth,height:b.naturalHeight,isNew:!0})},b.onerror=()=>{console.error("Failed to load image for dimensions:",t.name),x({file:t,preview:URL.createObjectURL(t),rotation:0,width:0,height:0,isNew:!0})},b.src=l.target.result},n.readAsDataURL(t)}),o=t=>{const x=Array.from(t.target.files);x.length&&(M.value||(p.value.forEach(n=>n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview)),p.value=[]),Promise.all(x.map(d)).then(n=>{const l=r.modelValue.length+p.value.length,b=r.settings.max_files-l,P=M.value?n.slice(0,b):n.slice(0,1);p.value.push(...P),k.value=p.value.length-1,_.value=!0,t.target.value=""}).catch(n=>{console.error("Error processing selected images:",n),alert("Failed to process selected images. Please try again.")}))},m=()=>{c.value=!1,h.value=!0},C=()=>{h.value=!1},I=t=>{const x=r.modelValue.length+p.value.length;if(!M.value||x<r.settings.max_files){const n=new Image;n.onload=()=>{const l={file:t,preview:URL.createObjectURL(t),rotation:0,width:n.naturalWidth,height:n.naturalHeight,isNew:!0};M.value?p.value.push(l):(p.value.forEach(b=>b.preview&&b.preview.startsWith("blob:")&&URL.revokeObjectURL(b.preview)),p.value=[l]),k.value=p.value.length-1,h.value=!1,_.value=!0},n.onerror=()=>{console.error("Failed to load captured image for dimensions.");const l={file:t,preview:URL.createObjectURL(t),rotation:0,width:0,height:0,isNew:!0};M.value?p.value.push(l):(p.value.forEach(b=>b.preview&&b.preview.startsWith("blob:")&&URL.revokeObjectURL(b.preview)),p.value=[l]),k.value=p.value.length-1,h.value=!1,_.value=!0},n.src=URL.createObjectURL(t)}else alert(`Maximum ${r.settings.max_files} files allowed.`),h.value=!1},S=async(t=0)=>{const x=await Promise.all(r.modelValue.map(async l=>{if(l.width&&l.height&&l.image_path)return{...l,rotation:l.rotation||0,isNew:!1};{const b=new Image;return new Promise(P=>{b.onload=()=>P({...l,rotation:l.rotation||0,preview:l.image_path?`/${l.image_path}`:null,width:b.naturalWidth,height:b.naturalHeight,isNew:!1}),b.onerror=()=>P({...l,rotation:l.rotation||0,preview:l.image_path?`/${l.image_path}`:null,width:0,height:0,isNew:!1}),b.src=l.image_path?`/${l.image_path}`:""})}})),n=p.value.filter(l=>l.isNew||l.rotation!==0);p.value=[...x,...n],k.value=t,_.value=!0},U=()=>{_.value=!1,p.value.forEach(t=>{t.preview&&t.preview.startsWith("blob:")&&URL.revokeObjectURL(t.preview)}),p.value=[]},B=t=>new Promise(x=>{if(t.rotation===0||!y.value){x({file:t.file,width:t.width,height:t.height});return}const n=new Image;n.onload=()=>{const l=y.value,b=l.getContext("2d"),P=n.width,F=n.height;let D,z;t.rotation===90||t.rotation===270?(D=F,z=P):(D=P,z=F),l.width=D,l.height=z,b.clearRect(0,0,l.width,l.height),b.translate(l.width/2,l.height/2),b.rotate(t.rotation*Math.PI/180),b.drawImage(n,-P/2,-F/2,P,F),b.setTransform(1,0,0,1,0,0),l.toBlob(Y=>{const le=new File([Y],t.file.name,{type:t.file.type});x({file:le,width:D,height:z})},t.file.type)},n.onerror=()=>{console.error("Failed to load image for rotation processing:",t.preview),x({file:t.file,width:t.width,height:t.height})},n.src=t.preview}),A=async t=>{s.value=!0;const x=[];if(!r.pointId){alert("Error: Point ID is missing. Cannot upload image. (Check parent component)"),s.value=!1;return}console.log("Uploading for Inspection ID:",r.inspectionId,"Point ID:",r.pointId);try{for(const n of t)if(n.isNew||n.rotation!==0){const{file:l,width:b,height:P}=await B(n),F=new FormData;F.append("inspection_id",r.inspectionId),F.append("point_id",r.pointId),F.append("image",l);const D=await se.post(route("inspections.upload-image"),F,{headers:{"Content-Type":"multipart/form-data"}}),z=D.data.image,Y=D.data.path;x.push({id:z.id,image_path:Y,width:b,height:P,rotation:0,preview:`/${Y}`}),n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview)}else x.push(n);v("update:modelValue",x.slice(0,r.settings.max_files)),v("save",r.pointId),v("uploaded",{pointId:r.pointId,images:x}),U(),alert("All images processed and saved successfully!")}catch(n){if(console.error("Error during image processing/upload:",n),n.response&&n.response.data&&n.response.data.message)alert(`Failed to save images: ${n.response.data.message}`);else if(n.response&&n.response.data&&n.response.data.errors){const l=Object.values(n.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${l}`)}else alert(`Failed to save images: ${n.message}`)}finally{s.value=!1}},W=async t=>{const x=[...r.modelValue],n=x.splice(t,1)[0];if(n.id||n.image_path)try{await se.delete(route("inspections.delete-image"),{data:{image_path:n.image_path}}),alert("Image deleted from server successfully!")}catch(l){if(console.error("Error deleting image from server:",l),l.response&&l.response.data&&l.response.data.message)alert(`Failed to delete image from server: ${l.response.data.message}`);else if(l.response&&l.response.data&&l.response.data.errors){const b=Object.values(l.response.data.errors).flat().join(`
`);alert(`Failed to delete image:
${b}`)}else alert(`Failed to delete image from server: ${l.message}`)}n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview),v("update:modelValue",x),v("removeImage",{index:t,pointId:r.pointId,image:n})};return(t,x)=>(u(),g("div",null,[a("input",{ref_key:"galleryInput",ref:w,type:"file",accept:"image/*",class:"hidden",onChange:o,multiple:M.value},null,40,ct),a("canvas",{ref_key:"processingCanvas",ref:y,class:"hidden"},null,512),a("label",{onClick:q,class:O(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200",{"border-gray-300 hover:border-indigo-400 bg-gray-50":e.modelValue.length===0,"border-indigo-300 bg-indigo-50":e.modelValue.length>0,"h-28":e.modelValue.length===0,"h-auto":e.modelValue.length>0}])},[e.modelValue.length===0?(u(),g("div",mt,x[1]||(x[1]=[a("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),a("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1),a("p",{class:"text-xs text-gray-500"},"Click to open options",-1)]))):(u(),g("div",gt,[a("div",ht,[(u(!0),g(G,null,X(e.modelValue,(n,l)=>(u(),g("div",{key:n.id||l,class:"relative w-full overflow-hidden rounded-md border border-gray-200",style:ne(E(n)),onClick:te(b=>S(l),["stop"])},[a("img",{src:N(n),class:"absolute top-0 left-0 w-full h-full object-contain"},null,8,pt),a("button",{onClick:te(b=>W(l),["stop"]),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm hover:bg-red-600 transition-colors"}," × ",8,ft)],12,vt))),128))]),M.value&&e.modelValue.length<e.settings.max_files?(u(),g("div",wt,[a("span",{onClick:te(R,["stop"]),class:"inline-block px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 hover:bg-indigo-200 transition-colors"}," + Add More Images ")])):$("",!0)]))],2),e.error?(u(),g("p",bt,L(e.error),1)):$("",!0),Q(De,{show:c.value,onClose:x[0]||(x[0]=n=>c.value=!1),onOpenWebcam:m,onTriggerGallery:i},null,8,["show"]),Q(tt,{show:h.value,"aspect-ratio":j.value,settings:e.settings,onClose:C,onPhotoCaptured:I},null,8,["show","aspect-ratio","settings"]),Q(ut,{show:_.value,images:p.value,"initial-index":k.value,"allow-multiple":M.value,"max-files":e.settings.max_files,"is-uploading":s.value,onClose:U,onSaveImages:A,onRemovePreviewImage:t.handleRemovePreviewImage},null,8,["show","images","initial-index","allow-multiple","max-files","is-uploading","onRemovePreviewImage"])]))}},yt={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},kt={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},It={class:"text-xl font-semibold text-indigo-700"},$t={class:"p-4 space-y-4"},_t={class:"flex items-start justify-between"},Ct={class:"block text-sm font-medium text-gray-700"},St={key:0,class:"text-red-500"},Vt={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Mt={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:[String,Number]},emits:["saveResult","updateResult","removeImage"],setup(e,{emit:f}){const r=e,v=f,w=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],y=p=>{var s;const k=r.form.results[p.id];if(!k)return!1;switch(p.input_type){case"text":case"number":case"date":return!!k.note;case"select":case"radio":return!!k.status;case"image":return((s=k.images)==null?void 0:s.length)>0;default:return!1}},c=(p,k)=>{v("updateResult",{pointId:p,value:k})},h=p=>{v("saveResult",p)},_=(p,k)=>{v("removeImage",{pointId:p,imageIndex:k})};return(p,k)=>(u(),g("div",yt,[a("div",kt,[a("h2",It,L(e.category.name),1)]),a("div",$t,[(u(!0),g(G,null,X(e.category.points,s=>{var M,j,N,E,q,R,i,d,o,m,C,I,S,U,B,A,W;return u(),g("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[a("div",_t,[a("label",Ct,[ae(L(s.name)+" ",1),(M=s.settings)!=null&&M.is_required?(u(),g("span",St,"*")):$("",!0)]),y(s)?(u(),g("span",Vt," ✓ ")):$("",!0)]),s.input_type==="text"?(u(),H(be,{key:0,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[t=>e.form.results[s.id].note=t,t=>c(s.id,t)],required:(j=s.settings)==null?void 0:j.is_required,"min-length":(N=s.settings)==null?void 0:N.min_length,"max-length":(E=s.settings)==null?void 0:E.max_length,pattern:(q=s.settings)==null?void 0:q.pattern,placeholder:((R=s.settings)==null?void 0:R.placeholder)||"Enter text",error:e.form.errors[`results.${s.id}.note`],onSave:t=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):$("",!0),s.input_type==="number"?(u(),H(Ie,{key:1,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[t=>e.form.results[s.id].note=t,t=>c(s.id,t)],required:(i=s.settings)==null?void 0:i.is_required,min:(d=s.settings)==null?void 0:d.min,max:(o=s.settings)==null?void 0:o.max,step:((m=s.settings)==null?void 0:m.step)||1,placeholder:((C=s.settings)==null?void 0:C.placeholder)||"Enter number",error:e.form.errors[`results.${s.id}.note`],onSave:t=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):$("",!0),s.input_type==="date"?(u(),H(Se,{key:2,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[t=>e.form.results[s.id].note=t,t=>c(s.id,t)],required:(I=s.settings)==null?void 0:I.is_required,"min-date":(S=s.settings)==null?void 0:S.min_date,"max-date":(U=s.settings)==null?void 0:U.max_date,error:e.form.errors[`results.${s.id}.note`],onSave:t=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):$("",!0),s.input_type==="select"?(u(),H(Ue,{key:3,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[t=>e.form.results[s.id].status=t,t=>c(s.id,t)],required:(B=s.settings)==null?void 0:B.is_required,error:e.form.errors[`results.${s.id}.status`],onSave:t=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):$("",!0),s.input_type==="radio"?(u(),H(Be,{key:4,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[t=>e.form.results[s.id].status=t,t=>c(s.id,t)],required:(A=s.settings)==null?void 0:A.is_required,options:((W=s.settings)==null?void 0:W.radios)||w,error:e.form.errors[`results.${s.id}.status`],onSave:t=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","options","error","onSave"])):$("",!0),s.input_type==="image"?(u(),H(xt,{key:5,modelValue:e.form.results[s.id].images,"onUpdate:modelValue":[t=>e.form.results[s.id].images=t,t=>c(s.id,t)],error:e.form.errors[`results.${s.id}.images`],"inspection-id":e.inspectionId,"point-id":s.id,onSave:t=>h(s.id),onRemoveImage:t=>_(s.id,t)},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","onSave","onRemoveImage"])):$("",!0)])}),128))])]))}},Rt=K(Mt,[["__scopeId","data-v-b0fe3fb7"]]),Lt={class:"container mx-auto px-4 py-2"},Ut={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},jt={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Nt=["onClick","data-category-id"],qt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Pt={class:"relative overflow-hidden"},Et={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},Bt={class:"mb-4"},Ft={class:"mt-6"},Tt={class:"list-disc pl-5"},At={key:0},Wt={key:1},Dt={class:"flex justify-end gap-4 mt-8"},Ht=["disabled"],zt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ot={__name:"InspectionForm",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(e){var R;const f=e,r=V(((R=f.categories[0])==null?void 0:R.id)||"summary"),v=V(0);V(null);const w=ee(()=>r.value!=="summary"?f.categories.find(i=>i.id===r.value):null),c=ue((()=>{const i={};return f.categories.forEach(d=>{(d.points||[]).forEach(o=>{var C,I;const m=Array.isArray(f.existingResults)?f.existingResults.find(S=>S.point_id===o.id):null;i[o.id]={status:(m==null?void 0:m.status)||"",note:(m==null?void 0:m.note)||"",images:((I=(C=f.existingImages)==null?void 0:C[o.id])==null?void 0:I.map(S=>({image_path:S.image_path,preview:null})))||[]}})}),{inspection_id:f.inspection.id,results:i,overall_note:f.inspection.overall_note||""}})()),h=re.debounce(()=>{J.post(route("inspections.save-overall-note"),{inspection_id:f.inspection.id,overall_note:c.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:i=>{console.error("Error menyimpan catatan keseluruhan:",i)}})},800),_=i=>i.points.every(d=>{var m;const o=c.results[d.id];if(!o)return!1;switch(d.input_type){case"text":case"number":case"date":return!!o.note;case"select":case"radio":return!!o.status;case"image":return((m=o.images)==null?void 0:m.length)>0;default:return!!o.status||!!o.note}}),p=i=>{if(i==="summary")v.value=f.categories.length;else{const d=f.categories.findIndex(o=>o.id===i);d>=0&&(v.value=d)}r.value=i},k=i=>{let d=v.value+i;const o=f.categories.length;d>=0&&d<=o&&(v.value=d,d===o?r.value="summary":r.value=f.categories[d].id)},s=()=>{let i=0,d=0;const o=S=>{i=S.changedTouches[0].screenX},m=S=>{d=S.changedTouches[0].screenX,C()},C=()=>{d<i-50?k(1):d>i+50&&k(-1)},I=document.querySelector(".relative.overflow-hidden");return I&&(I.addEventListener("touchstart",o,!1),I.addEventListener("touchend",m,!1)),()=>{I&&(I.removeEventListener("touchstart",o),I.removeEventListener("touchend",m))}},M=re.debounce(async i=>{try{await J.post(route("inspections.save-result"),{inspection_id:f.inspection.id,point_id:i,status:c.results[i].status,note:c.results[i].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(d){console.error("Error menyimpan hasil:",d)}},500),j=({pointId:i,type:d,value:o})=>{c.results[i].hasOwnProperty(d)&&(c.results[i][d]=o),M(i)},N=async(i,d)=>{const o=i.target.files[0];if(!o)return;const m=URL.createObjectURL(o);try{const C=new FormData;C.append("inspection_id",f.inspection.id),C.append("point_id",d),C.append("image",o),await J.post(route("inspections.upload-image"),C,{preserveScroll:!0,onSuccess:I=>{var U;const S=((U=I.props.flash)==null?void 0:U.imagePath)||I.props.imagePath;S?c.results[d].images.push({image_path:S,preview:m}):console.error("Path gambar tidak dikembalikan dari unggahan, tidak dapat memperbarui UI.")},onError:I=>{console.error("Error mengunggah gambar:",I),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(C){console.error("Error mengunggah gambar:",C),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{i.target.value=""}},E=async(i,d)=>{const o=c.results[i].images[d];if(o)try{await J.delete(route("inspections.delete-image"),{data:{image_path:o.image_path,point_id:i,inspection_id:f.inspection.id},preserveScroll:!0,onSuccess:()=>{c.results[i].images.splice(d,1),o.preview&&URL.revokeObjectURL(o.preview)},onError:m=>{console.error("Error menghapus gambar:",m),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(m){console.error("Error menghapus gambar:",m),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},q=()=>{c.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{oe().props.flash.success="Inspeksi berhasil dikirim!"},onError:i=>{console.error("Kesalahan pengiriman:",i),oe().props.flash.error="Ada kesalahan dalam pengiriman Anda. Harap periksa semua bidang."}})};return ce(()=>{s()}),Z(r,i=>{const d=document.querySelector(`.flex-shrink-0[data-category-id="${i}"]`);d&&d.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(i,d)=>(u(),g("div",Lt,[a("div",Ut,[a("div",jt,[(u(!0),g(G,null,X(e.categories,o=>(u(),g("button",{key:o.id,onClick:m=>p(o.id),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":r.value===o.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":r.value!==o.id}]),"data-category-id":o.id},[ae(L(o.name)+" ",1),_(o)?(u(),g("span",qt," ✓ ")):$("",!0)],10,Nt))),128)),a("button",{onClick:d[0]||(d[0]=o=>p("summary")),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":r.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":r.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),a("div",Pt,[Q(ve,{name:"category-slide",mode:"out-in"},{default:me(()=>[w.value&&r.value!=="summary"?(u(),H(Rt,{key:w.value.id,category:w.value,form:T(c),onSaveResult:T(M),onUpdateResult:j,onRemoveImage:E,onHandleImageUpload:N},null,8,["category","form","onSaveResult"])):r.value==="summary"?(u(),g("div",Et,[d[6]||(d[6]=a("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),a("div",Bt,[d[3]||(d[3]=a("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),ge(a("textarea",{id:"overall_note","onUpdate:modelValue":d[1]||(d[1]=o=>T(c).overall_note=o),onInput:d[2]||(d[2]=(...o)=>T(h)&&T(h)(...o)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[he,T(c).overall_note]])]),a("div",Ft,[d[4]||(d[4]=a("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Kategori:",-1)),a("ul",Tt,[(u(!0),g(G,null,X(e.categories,o=>(u(),g("li",{key:o.id,class:O({"text-green-600":_(o),"text-red-600":!_(o)})},[ae(L(o.name)+" ",1),_(o)?(u(),g("span",At,"(Selesai ✓)")):(u(),g("span",Wt,"(Belum Selesai ✗)"))],2))),128))])]),a("div",Dt,[a("button",{type:"button",onClick:q,disabled:T(c).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[T(c).processing?(u(),g("svg",zt,d[5]||(d[5]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):$("",!0),a("span",null,L(T(c).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Ht)])])):$("",!0)]),_:1})])]))}},Yt=K(Ot,[["__scopeId","data-v-22fd310e"]]);export{Yt as default};
