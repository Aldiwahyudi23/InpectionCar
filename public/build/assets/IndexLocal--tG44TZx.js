import{x as Lt,r as y,g as Qe,q as le,E as ut,G as ye,c as o,o as n,d as e,b as c,k as xe,z as Ae,A as Xe,n as ae,t as T,u as X,e as as,F as Ce,m as _e,f as Se,y as it,w as De,L as Re,M as ns,a as pt,j as Te,l as Ut,T as Ye,p as os,N as Dt,D as vt,J as mt,B as is,O as ls,I as Et,S as rs,W as dt}from"./vendor-CwaeDJfC.js";import{l as jt}from"./lodash-DfwitXkl.js";import{_ as ds}from"./PrimaryButton-DTE9tPxx.js";import{_ as us}from"./ActionMessage-PedWn-P3.js";import{_ as Oe}from"./app-BT3C7vU4.js";import{u as At}from"./useDraggableButton-B7ftwxmu.js";const cs={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},gs={key:0,class:"p-4 space-y-2"},ps={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ms={class:"flex items-center space-x-2"},vs={key:0,class:"text-xs text-red-500 font-normal ml-2"},fs={key:1,class:"text-xs text-red-500 font-normal ml-2"},hs={key:2,class:"text-xs text-green-500 font-normal ml-2"},bs={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ys={class:"relative"},xs={key:0,class:"absolute right-3 top-3"},ws={key:1,class:"text-xs text-red-500 font-normal ml-2"},ks={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},Is={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},$s={key:0},Cs=["onMousedown"],Ss={class:"font-medium text-gray-900"},_s={class:"text-sm text-gray-500"},Vs={key:1,class:"p-4 text-sm text-gray-500 text-center"},Ms={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ns={key:0,class:"mb-4"},Ts=["innerHTML"],Us={key:1},Ds={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Es=["onClick"],As=["src","alt"],Ls={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},js={class:"text-white text-xs text-center"},Rs={key:2,class:"text-center py-4 text-gray-500 text-sm"},Os={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Bs=["src","alt"],qs={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Fs={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},zs={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Hs={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges"],setup(t,{emit:Y}){var N,B,se,F,ne,Q;const s=t,x=Y,d=Lt({plate_number:((N=s.inspection)==null?void 0:N.plate_number)||"",car_id:((B=s.inspection)==null?void 0:B.car_id)||null,car_name:((se=s.inspection)==null?void 0:se.car_name)||""}),h=y(((F=s.inspection)==null?void 0:F.plate_number)||""),b=y(((ne=s.inspection)==null?void 0:ne.car_id)||null),g=y(((Q=s.inspection)==null?void 0:Q.car_name)||""),l=y(""),k=y(""),V=y(""),$=y(!1),H=y(""),z=y(""),E=y(d.car_name),G=y(!1),C=y(!1),p=y([]),a=y(null),M=y([]),O=y(!1),S=y(0);Qe(()=>{var I,m,W,P,R;if(ee((I=s.inspection)==null?void 0:I.plate_number),(m=s.inspection)!=null&&m.car_id&&((W=s.CarDetail)==null?void 0:W.length)>0){const fe=s.CarDetail.find(Ie=>Ie.id===s.inspection.car_id);fe&&ve(fe)}else!((P=s.inspection)!=null&&P.car_id)&&((R=s.inspection)!=null&&R.car_name)&&(E.value=s.inspection.car_name,d.car_id=null);window.addEventListener("keydown",u),x("update:hasUnsavedChanges",w.value),x("update:validation",A.value)}),ut(()=>{window.removeEventListener("keydown",u)});const ee=I=>{if(!I){l.value="",k.value="",V.value="";return}const m=I.toUpperCase().trim(),W=m.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(W)l.value=W[1]||"",k.value=W[2]||"",V.value=W[3]||"";else{let P="area",R="",fe="",Ie="";for(const $e of m)P==="area"&&/[A-Z]/.test($e)?R+=$e:P==="area"&&/[0-9]/.test($e)?(P="number",fe+=$e):P==="number"&&/[0-9]/.test($e)?fe+=$e:P==="number"&&/[A-Z]/.test($e)?(P="suffix",Ie+=$e):P==="suffix"&&/[A-Z]/.test($e)&&(Ie+=$e);l.value=R,k.value=fe,V.value=Ie}te()},te=()=>{const I=`${l.value}${k.value}${V.value}`;d.plate_number=I,_()},re=I=>{I==="area"?l.value=l.value.toUpperCase().replace(/[^A-Z]/g,""):I==="number"?k.value=k.value.replace(/[^0-9]/g,""):I==="suffix"&&(V.value=V.value.toUpperCase().replace(/[^A-Z]/g,"")),te()},me=le(()=>{const I=d.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(I)}),ue=le(()=>!E.value||E.value.trim()===""),J=le(()=>d.plate_number.length>0&&!me.value?"Format plat nomor tidak valid.":null),A=le(()=>{const I=!d.plate_number||d.plate_number.trim()==="",m=!E.value||E.value.trim()==="";return I||m||!me.value||$.value}),w=le(()=>{const I=d.plate_number!==h.value,m=d.car_id!==b.value||E.value!==g.value;return I||m}),j=le(()=>w.value&&!A.value),U=I=>{var W,P,R;if(!I)return"";const m=[];return(W=I.brand)!=null&&W.name&&m.push(I.brand.name),(P=I.model)!=null&&P.name&&m.push(I.model.name),(R=I.type)!=null&&R.name&&m.push(I.type.name),I.cc&&m.push((I.cc/1e3).toFixed(1)),I.transmission&&m.push(I.transmission),I.year&&m.push(I.year.toString()),I.fuel_type&&m.push(I.fuel_type),I.production_period&&m.push(`(${I.production_period})`),m.join(" ")},K=()=>{d.car_id&&(d.car_id=null,a.value=null,M.value=[]),ie()},ie=jt.debounce(()=>{if(!E.value.trim()){p.value=[],G.value=!1;return}C.value=!0;try{const I=E.value.toLowerCase().trim();p.value=s.CarDetail.filter(m=>U(m).toLowerCase().includes(I)),G.value=!0}finally{C.value=!1}},300),de=()=>{setTimeout(()=>{G.value=!1,d.car_name=E.value,_()},200)},ve=async I=>{a.value=I,E.value=U(I),d.car_id=I.id,d.car_name=U(I),G.value=!1,await ge(I.id),_(),x("update:hasUnsavedChanges",w.value),x("update:validation",A.value)},ce=I=>!I||!I.file_path?"":`/storage/${I.file_path}`,ge=async I=>{try{const m=await fetch(`/api/cars/${I}/images`);if(m.ok){const W=await m.json();M.value=Array.isArray(W)?W:[]}else M.value=[]}catch(m){console.error("Error loading car images:",m),M.value=[]}},we=I=>{S.value=I,O.value=!0,document.body.style.overflow="hidden"},L=()=>{O.value=!1,document.body.style.overflow=""},ke=()=>{S.value=(S.value+1)%M.value.length},be=()=>{S.value=(S.value-1+M.value.length)%M.value.length},u=I=>{if(O.value)switch(I.key){case"Escape":L();break;case"ArrowRight":ke();break;case"ArrowLeft":be();break}},_=()=>{const I={plate_number:d.plate_number,car_id:d.car_id,car_name:d.car_name};x("update-vehicle",I)},v=()=>{s.inspection&&d.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0,onSuccess:()=>{h.value=d.plate_number,b.value=d.car_id,g.value=d.car_name,x("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:I=>{console.error("Gagal menyimpan data:",I)}})};return ye([()=>d.plate_number,()=>d.car_name],I=>{H.value="",$.value=!1,z.value="";const m=I[0];if(m&&m.length>=6){const W=s.allInspections.filter(P=>{var R;return P.plate_number===m&&P.id!==((R=s.inspection)==null?void 0:R.id)});if(W.length>0){const P=["draft","in_progress","pending","pending_review","revision"],R=W.find(fe=>P.includes(fe.status));if(R)$.value=!0,H.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${R.status.replace(/_/g," ").toUpperCase()}.`;else{const fe=W.filter(Ie=>["approved","rejected","completed","cancelled"].includes(Ie.status));if(fe.length>0){fe.sort(($e,Be)=>new Date(Be.created_at)-new Date($e.created_at));const Ie=fe[0];if(Ie.car_id){const $e=s.CarDetail.find(Be=>Be.id===Ie.car_id);$e&&ve($e)}else Ie.car_name&&(E.value=Ie.car_name,d.car_name=Ie.car_name,d.car_id=null);z.value=`Nomor plat ini sudah pernah diperiksa ${fe.length} kali sebelumnya.`}}}}x("update:hasUnsavedChanges",w.value),x("update:validation",A.value)},{deep:!0}),(I,m)=>{var W;return n(),o("div",cs,[m[21]||(m[21]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),t.inspection?(n(),o("div",gs,[e("div",ps,[m[9]||(m[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),e("div",ms,[Ae(e("input",{"onUpdate:modelValue":m[0]||(m[0]=P=>l.value=P),type:"text",placeholder:"Contoh: B",class:ae(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!me.value||$.value}]),onInput:m[1]||(m[1]=P=>re("area")),maxlength:"2"},null,34),[[Xe,l.value]]),Ae(e("input",{"onUpdate:modelValue":m[2]||(m[2]=P=>k.value=P),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:ae(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!me.value||$.value}]),onInput:m[3]||(m[3]=P=>re("number")),maxlength:"4"},null,34),[[Xe,k.value]]),Ae(e("input",{"onUpdate:modelValue":m[4]||(m[4]=P=>V.value=P),type:"text",placeholder:"ABC",class:ae(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!me.value||$.value}]),onInput:m[5]||(m[5]=P=>re("suffix")),maxlength:"3"},null,34),[[Xe,V.value]])]),J.value?(n(),o("span",vs,T(J.value),1)):c("",!0),H.value?(n(),o("span",fs,T(H.value),1)):c("",!0),z.value?(n(),o("span",hs,T(z.value),1)):c("",!0)]),e("div",bs,[m[13]||(m[13]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",ys,[Ae(e("input",{"onUpdate:modelValue":m[6]||(m[6]=P=>E.value=P),type:"text",placeholder:"Cari atau ketik nama mobil...",class:ae(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":ue.value}]),onInput:K,onFocus:m[7]||(m[7]=P=>G.value=!0),onBlur:de},null,34),[[Xe,E.value]]),C.value?(n(),o("div",xs,m[10]||(m[10]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),ue.value?(n(),o("span",ws,"Nama mobil tidak boleh kosong.")):c("",!0),!X(d).car_id&&E.value?(n(),o("div",ks,m[11]||(m[11]=[as('<div class="flex items-start" data-v-0872c2f2><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-0872c2f2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-0872c2f2></path></svg><div data-v-0872c2f2><p class="text-yellow-800 font-medium mb-1" data-v-0872c2f2>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-0872c2f2> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-0872c2f2>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-0872c2f2> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-0872c2f2> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-0872c2f2>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-0872c2f2>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):c("",!0),G.value?(n(),o("div",Is,[p.value.length>0?(n(),o("div",$s,[(n(!0),o(Ce,null,_e(p.value,P=>(n(),o("div",{key:P.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:R=>ve(P)},[e("div",Ss,T(U(P)),1),e("div",_s,T(P.year)+" • "+T(P.cc)+"cc • "+T(P.transmission)+" • "+T(P.fuel_type),1)],40,Cs))),128))])):(n(),o("div",Vs,m[12]||(m[12]=[Se(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),Se(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),X(d).car_id&&a.value?(n(),o("div",Ms,[a.value.description?(n(),o("div",Ns,[m[14]||(m[14]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:a.value.description},null,8,Ts)])):c("",!0),M.value.length>0?(n(),o("div",Us,[m[15]||(m[15]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",Ds,[(n(!0),o(Ce,null,_e(M.value,(P,R)=>(n(),o("div",{key:P.id||R,class:"relative group cursor-pointer",onClick:fe=>we(R)},[e("img",{src:ce(P),alt:P.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,As),P.note?(n(),o("div",Ls,[e("p",js,T(P.note),1)])):c("",!0)],8,Es))),128))])])):(n(),o("div",Rs," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),O.value?(n(),o("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:L},[e("div",Os,[e("button",{onClick:L,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},m[16]||(m[16]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),M.value.length>1?(n(),o("button",{key:0,onClick:it(be,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},m[17]||(m[17]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),M.value.length>1?(n(),o("button",{key:1,onClick:it(ke,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},m[18]||(m[18]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),e("img",{src:ce(M.value[S.value]),alt:"Car Image "+(S.value+1),class:"max-w-full max-h-full object-contain",onClick:m[8]||(m[8]=it(()=>{},["stop"]))},null,8,Bs),M.value.length>1?(n(),o("div",qs,T(S.value+1)+" / "+T(M.value.length),1)):c("",!0),(W=M.value[S.value])!=null&&W.note?(n(),o("div",Fs,T(M.value[S.value].note),1)):c("",!0)])])):c("",!0),xe(ds,{type:"button",onClick:v,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!j.value},{default:De(()=>[X(d).processing?(n(),o("svg",zs,m[19]||(m[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,T(X(d).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),xe(us,{on:X(d).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:De(()=>m[20]||(m[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),Se(" Tersimpan. ")])),_:1,__:[20]},8,["on"])]),_:1},8,["disabled"])])):c("",!0)])}}},Ks=Oe(Hs,[["__scopeId","data-v-0872c2f2"]]),Ps={class:"mt-1"},Ws=["value","required","minlength","maxlength","allowSpace","placeholder"],Gs={key:0,class:"mt-2 text-sm text-red-600"},Rt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,d=le(()=>{if(!s.modelValue)return"";let b=s.modelValue;switch(s.allowSpace||(b=b.replace(/\s+/g,"")),s.textTransform){case"uppercase":return b.toUpperCase();case"lowercase":return b.toLowerCase();case"capitalize":return b.replace(/\b\w/g,g=>g.toUpperCase());default:return b}}),h=b=>{let g=b.target.value;switch(s.allowSpace||(g=g.replace(/\s+/g,"")),s.textTransform){case"uppercase":g=g.toUpperCase();break;case"lowercase":g=g.toLowerCase();break;case"capitalize":g=g.replace(/\b\w/g,l=>l.toUpperCase());break}x("update:modelValue",g),x("save",s.pointId)};return(b,g)=>(n(),o("div",Ps,[e("input",{value:d.value,onInput:h,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:ae(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,Ws),t.error?(n(),o("p",Gs,T(t.error),1)):c("",!0)]))}},Zs={class:"mt-1"},Js=["value","required","min","max","step","placeholder"],Xs={key:0,class:"mt-2 text-sm text-red-600"},Ot={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,d=h=>{const b=h.target.value;x("update:modelValue",b),x("save",s.pointId)};return(h,b)=>(n(),o("div",Zs,[e("input",{value:t.modelValue,onInput:d,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Js),t.error?(n(),o("p",Xs,T(t.error),1)):c("",!0)]))}},Ys={class:"mt-1"},Qs=["value","required","min","max"],ea={key:0,class:"mt-2 text-sm text-red-600"},Bt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,d=h=>{x("update:modelValue",h.target.value),x("save",s.pointId)};return(h,b)=>(n(),o("div",Ys,[e("input",{value:t.modelValue,onChange:d,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Qs),t.error?(n(),o("p",ea,T(t.error),1)):c("",!0)]))}},ta={class:"mt-1"},sa=["value","required","placeholder"],aa={key:0,class:"mt-2 text-sm text-red-600"},qt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,d=y(""),h=le(()=>{var V,$,H,z;return{currency_symbol:((V=s.settings)==null?void 0:V.currency_symbol)||"Rp",thousands_separator:(($=s.settings)==null?void 0:$.thousands_separator)||",",min_value:((H=s.settings)==null?void 0:H.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((z=s.settings)==null?void 0:z.max_value)!==void 0?Number(s.settings.max_value):1e9}}),b=V=>{if(V==null||V==="")return"";const $=Number(V);if(isNaN($))return"";let H=$.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return h.value.thousands_separator!==","&&(H=H.replace(/,/g,h.value.thousands_separator)),H},g=V=>V?V.replace(/[^\d]/g,""):"",l=le(()=>d.value?`${h.value.currency_symbol} ${b(d.value)}`:""),k=V=>{let $=g(V.target.value),H=Number($);h.value.min_value!==void 0&&H<h.value.min_value&&($=h.value.min_value.toString()),h.value.max_value!==void 0&&H>h.value.max_value&&($=h.value.max_value.toString()),d.value=$,x("update:modelValue",$),x("save",s.pointId)};return ye(()=>s.modelValue,V=>{V!=null&&(d.value=V.toString())},{immediate:!0}),(V,$)=>(n(),o("div",ta,[e("input",{value:l.value,onInput:k,type:"text",required:t.required,placeholder:t.placeholder,class:ae(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,sa),t.error?(n(),o("p",aa,T(t.error),1)):c("",!0)]))}},na={class:"mt-1 space-y-3"},oa={key:0,class:"space-y-2"},ia={class:"flex flex-wrap gap-2"},la=["onClick"],ra=["value","required","minlength","maxlength","placeholder"],da={class:"flex justify-between items-center mt-1"},ua={class:"text-xs text-gray-500"},ca={key:0,class:"text-xs text-red-600"},Ft={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,d=y([]),h=y(""),b=V=>d.value.some($=>$.value===V),g=V=>{b(V.value)?d.value=d.value.filter(E=>E.value!==V.value):d.value.push(V);const H=[...d.value.map(E=>E.value)];h.value.trim()&&H.push(h.value.trim());const z=H.join(", ");x("update:modelValue",z),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:z})},l=V=>{const $=V.target.value;x("update:modelValue",$),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:$}),k($)},k=V=>{var E,G,C,p;if(!V){d.value=[],h.value="";return}const $=V.split(",").map(a=>a.trim()).filter(a=>a),H=((G=(E=s.settings)==null?void 0:E.damage_options)==null?void 0:G.map(a=>a.value))||[];d.value=((p=(C=s.settings)==null?void 0:C.damage_options)==null?void 0:p.filter(a=>$.includes(a.value)))||[];const z=$.filter(a=>!H.includes(a));h.value=z.join(", ")};return ye(()=>s.modelValue,V=>{V!=null&&k(V)},{immediate:!0}),(V,$)=>{var H,z,E;return n(),o("div",na,[(H=t.settings)!=null&&H.enable_damage&&((z=t.settings)!=null&&z.damage_options)?(n(),o("div",oa,[$[0]||($[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",ia,[(n(!0),o(Ce,null,_e(t.settings.damage_options,(G,C)=>(n(),o("button",{key:C,type:"button",onClick:p=>g(G),class:ae(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":b(G.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!b(G.value)}])},T(G.label),11,la))),128))])])):c("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:l,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,ra),e("div",da,[e("span",ua,T(((E=t.modelValue)==null?void 0:E.length)||0)+"/"+T(t.maxLength||400),1),t.error?(n(),o("p",ca,T(t.error),1)):c("",!0)])])])}}},ga={class:"mt-1"},pa=["value","required"],ma={key:0,class:"mt-2 text-sm text-red-600"},va={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,d=h=>{x("update:modelValue",h.target.value),x("save",s.pointId)};return(h,b)=>(n(),o("div",ga,[e("select",{value:t.modelValue,onChange:d,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},b[0]||(b[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,pa),t.error?(n(),o("p",ma,T(t.error),1)):c("",!0)]))}},fa=Oe(va,[["__scopeId","data-v-1b6c0201"]]),ha={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},ba={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},ya={class:"text-xs text-gray-500 mt-2 text-center"},xa={class:"flex flex-row space-x-4 mb-6"},wa={class:"mt-4 text-right"},ka={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(Y,s)=>t.show?(n(),o("div",ha,[e("div",ba,[s[7]||(s[7]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),e("p",ya,[s[3]||(s[3]=Se("Ambil Foto Maksimal: ")),e("b",null,T(t.settings.max_files),1),s[4]||(s[4]=Se(" Dengan Rasio & Ukuran: ")),e("b",null,T(t.settings.camera_aspect_ratio),1)]),e("div",xa,[e("button",{onClick:s[0]||(s[0]=x=>Y.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:s[1]||(s[1]=x=>Y.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",wa,[e("button",{onClick:s[2]||(s[2]=x=>Y.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):c("",!0)}},Ia={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},$a={class:"webcam-content-box"},Ca={class:"webcam-header"},Sa={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},_a={class:"inspection-point-name"},Va={key:0,class:"screen-flash-overlay"},Ma={key:2,class:"zoom-controls"},Na=["max"],Ta={class:"webcam-footer"},Ua={class:"camera-controls"},Da=["disabled"],Ea={class:"camera-icon-container"},Aa={key:0,class:"camera-spinner"},La={key:1,class:"camera-body"},ja={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:Y}){const s=t,x=Y,d=y(null),h=y(null);let b=null,g=null;const l=y("environment"),k=y(!1),V=y(!1),$=y(!1),H=y(!1),z=y(!1),E=y({}),G=y(!1),C=y(1),p=y(1),a=y(!1),M=le(()=>{var U;return((U=s.settings)==null?void 0:U.max_size)||2048}),O=le(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),S=le(()=>{if(!s.aspectRatio)return{};const U=s.aspectRatio,K=U>1?80:60,ie=U>1?80/U:60*U;return{width:`${K}%`,height:`${ie}%`}}),ee=async()=>{b&&b.getTracks().forEach(U=>U.stop());try{const U={facingMode:l.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};b=await navigator.mediaDevices.getUserMedia({video:U,audio:!1}),g=b.getVideoTracks()[0],d.value.srcObject=b,d.value.onloadedmetadata=async()=>{await re(),await d.value.play()}}catch(U){console.error("Error accessing camera: ",U),alert("Failed to access camera. Please allow camera permission."),x("close")}},te=()=>{b&&b.getTracks().forEach(U=>U.stop()),x("close")},re=async()=>{if(g)try{const U=await navigator.mediaDevices.enumerateDevices();k.value=U.filter(ie=>ie.kind==="videoinput").length>1;const K=g.getCapabilities();K.zoom?(a.value=!0,p.value=K.zoom.max,console.log(`Zoom supported. Max zoom: ${p.value}`)):(a.value=!1,console.warn("Zoom is not supported by this camera.")),V.value=K.torch||K.fillLightMode&&K.fillLightMode.includes("torch")}catch(U){console.error("Error checking camera capabilities:",U)}},me=async U=>{if(!g)return;const K=d.value.getBoundingClientRect(),ie=U.clientX-K.left,de=U.clientY-K.top;z.value=!0,E.value={left:`${ie}px`,top:`${de}px`,transform:"translate(-50%, -50%)"};try{if(g.getCapabilities().pointsOfInterest){const ce=ie/K.width,ge=de/K.height;await g.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:ce,y:ge}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(ve){console.warn("Manual focus failed:",ve)}setTimeout(()=>{z.value=!1,g.getCapabilities().focusMode.includes("continuous")&&g.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},ue=async U=>{if(!g||!a.value)return;const K=Math.min(Math.max(U,1),p.value);C.value=K;try{await g.applyConstraints({advanced:[{zoom:K}]})}catch(ie){console.error("Failed to set zoom:",ie)}},J=async()=>{if(!(!g||!V.value))try{l.value==="user"?($.value=!$.value,H.value=$.value):(await g.applyConstraints({advanced:[{torch:!$.value}]}),$.value=!$.value)}catch(U){console.error("Flash toggle failed:",U)}},A=async()=>{k.value&&(l.value=l.value==="environment"?"user":"environment",b&&b.getTracks().forEach(U=>U.stop()),await ee())},w=async U=>new Promise(K=>{const ie=M.value*1024;if(U.size<=ie){K(U);return}const de=new Image,ve=new FileReader;ve.onload=ce=>{de.onload=()=>{const ge=document.createElement("canvas"),we=ge.getContext("2d"),L=Math.sqrt(ie/U.size);ge.width=de.width*L,ge.height=de.height*L,we.drawImage(de,0,0,ge.width,ge.height);let ke=.9;const be=()=>{ge.toBlob(u=>{u.size>ie&&ke>.1?(ke-=.1,be()):K(u)},"image/jpeg",ke)};be()},de.src=ce.target.result},ve.readAsDataURL(U)}),j=async()=>{if(!(G.value||!d.value||!h.value)){G.value=!0;try{const U=d.value,K=h.value,ie=U.videoWidth,de=U.videoHeight;let ve,ce,ge,we;ie/de>s.aspectRatio?(ce=de,ve=de*s.aspectRatio,ge=(ie-ve)/2,we=0):(ve=ie,ce=ie/s.aspectRatio,ge=0,we=(de-ce)/2),K.width=ve,K.height=ce,K.getContext("2d").drawImage(U,ge,we,ve,ce,0,0,ve,ce);const ke=await new Promise(u=>{K.toBlob(u,"image/jpeg",1)}),be=await w(ke);if(be){const u=new File([be],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});x("photoCaptured",u),H.value=!0,setTimeout(()=>{H.value=!1},100)}}catch(U){console.error("Error capturing photo:",U),alert("Failed to capture photo. Please try again.")}finally{G.value=!1}}};return ye(()=>s.show,U=>{U?ee():te()}),ut(()=>{b&&b.getTracks().forEach(U=>U.stop())}),(U,K)=>{var ie;return t.show?(n(),o("div",Ia,[e("div",$a,[e("div",Ca,[e("p",Sa,T(t.settings.camera_aspect_ratio),1),e("div",_a,T(((ie=t.point)==null?void 0:ie.name)||"Camera"),1),e("button",{onClick:te,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},K[2]||(K[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:Re(O.value),onClick:me,onTouchstart:me},[e("video",{ref_key:"webcamVideo",ref:d,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:h,class:"hidden"},null,512),H.value?(n(),o("div",Va)):c("",!0),e("div",{class:"aspect-ratio-guide",style:Re(S.value)},null,4),z.value?(n(),o("div",{key:1,class:"focus-indicator",style:Re(E.value)},K[3]||(K[3]=[e("div",{class:"focus-ring"},null,-1)]),4)):c("",!0),K[4]||(K[4]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),a.value?(n(),o("div",Ma,[Ae(e("input",{type:"range",min:"1",max:p.value,step:"0.1","onUpdate:modelValue":K[0]||(K[0]=de=>C.value=de),onInput:K[1]||(K[1]=de=>ue(parseFloat(de.target.value))),class:"zoom-slider"},null,40,Na),[[Xe,C.value]])])):c("",!0)],36),e("div",Ta,[e("div",Ua,[t.settings.enable_flash&&V.value?(n(),o("button",{key:0,onClick:J,class:ae(["control-button",{active:$.value,disabled:!V.value}])},K[5]||(K[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):c("",!0),e("button",{onClick:j,class:"capture-button",disabled:G.value},[e("div",Ea,[G.value?(n(),o("div",Aa)):(n(),o("div",La,K[6]||(K[6]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,Da),t.settings.enable_camera_switch&&k.value?(n(),o("button",{key:1,onClick:A,class:"control-button"},K[7]||(K[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):c("",!0)])])])])):c("",!0)}}},Ra=Oe(ja,[["__scopeId","data-v-d307c818"]]),Oa={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Ba={class:"w-full h-full flex flex-col"},qa={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Fa=["disabled"],za={class:"text-lg font-semibold"},Ha={class:"flex items-center gap-2"},Ka=["disabled"],Pa=["disabled"],Wa={key:0,class:"bg-blue-900 bg-opacity-50 text-white p-3"},Ga={class:"flex items-center justify-between mb-2"},Za={class:"text-xs"},Ja={class:"w-full bg-blue-700 bg-opacity-50 rounded-full h-2"},Xa={class:"text-xs mt-1 text-blue-300"},Ya={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Qa=["src"],en={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},tn={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},sn=["disabled"],an=["disabled"],nn=["disabled"],on={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},ln={class:"flex justify-between items-center w-full"},rn=["disabled"],dn={key:1,class:"flex-1"},un=["disabled"],cn={class:"flex gap-3 w-full"},gn={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},pn={class:"flex items-center gap-2"},mn={key:0,class:"text-center"},vn={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images","retryImage"],setup(t,{emit:Y}){const s=t,x=Y,d=y(0),h=y([]),b=le(()=>h.value.length>0?h.value[d.value]:null);ye(()=>s.images,p=>{h.value=p.map(a=>({...a,rotation:a.rotation||0})),p.length===0&&s.show&&H()},{deep:!0,immediate:!0}),ye(()=>s.show,p=>{p&&s.images.length>0&&(d.value=s.initialIndex)}),ye(()=>s.uploadProgress,p=>{p===100&&console.log("Upload completed")});const g=p=>p.preview||(p.image_path?`/${p.image_path}`:""),l=()=>{if(b.value&&!s.isUploading){const p=(b.value.rotation+90)%360;h.value[d.value].rotation=p,x("update:images",h.value)}},k=()=>{s.isUploading||(d.value=d.value<h.value.length-1?d.value+1:0)},V=()=>{s.isUploading||(d.value=d.value>0?d.value-1:h.value.length-1)},$=()=>{s.isUploading||x("saveImages",h.value)},H=()=>{s.isUploading||x("close")},z=()=>{if(b.value&&!s.isUploading){const p=b.value,a=h.value.findIndex(M=>M.isNew&&p.isNew&&M.preview===p.preview||!M.isNew&&!p.isNew&&M.id===p.id);a!==-1&&(x("removePreviewImage",p),h.value.splice(a,1),x("update:images",h.value)),d.value>=h.value.length&&(d.value=Math.max(0,h.value.length-1)),h.value.length===0&&x("close")}},E=()=>{s.isUploading||x("triggerAddMorePhotos")},G=()=>{b.value&&!s.isUploading&&x("retryImage",b.value)},C=p=>{p.key==="Escape"&&!s.isUploading&&H()};return Qe(()=>{document.addEventListener("keydown",C)}),ut(()=>{document.removeEventListener("keydown",C)}),(p,a)=>{var M;return t.show?(n(),o("div",Oa,[e("div",Ba,[e("div",qa,[e("button",{onClick:H,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},a[0]||(a[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Fa),e("div",za,T(((M=t.point)==null?void 0:M.name)||"Preview")+" ("+T(d.value+1)+"/"+T(h.value.length)+") ",1),e("div",Ha,[b.value&&b.value.isNew?(n(),o("button",{key:0,onClick:z,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:t.isUploading},a[1]||(a[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,Ka)):c("",!0),b.value&&b.value.isNew?(n(),o("button",{key:1,onClick:l,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},a[2]||(a[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,Pa)):c("",!0)])]),t.isUploading?(n(),o("div",Wa,[e("div",Ga,[a[3]||(a[3]=e("span",{class:"text-sm font-medium"},"Mengupload gambar...",-1)),e("span",Za,T(t.uploadProgress)+"%",1)]),e("div",Ja,[e("div",{class:"bg-blue-400 h-2 rounded-full transition-all duration-300",style:Re({width:t.uploadProgress+"%"})},null,4)]),e("p",Xa,T(t.currentUpload)+"/"+T(t.totalUpload)+" gambar terupload",1)])):c("",!0),e("div",Ya,[e("div",{class:"relative w-full max-w-full",style:Re({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"})},[b.value?(n(),o("img",{key:0,src:g(b.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Re({transform:`rotate(${b.value.rotation}deg)`})},null,12,Qa)):c("",!0),b.value&&b.value.isUploading?(n(),o("div",en,a[4]||(a[4]=[e("div",{class:"text-center text-white"},[e("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e("p",{class:"text-sm"},"Mengupload...")],-1)]))):c("",!0),b.value&&b.value.isFailed?(n(),o("div",tn,[a[5]||(a[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),a[6]||(a[6]=e("p",{class:"text-lg font-medium mb-2"},"Upload Gagal",-1)),e("button",{onClick:G,class:"px-4 py-2 bg-white text-red-600 rounded-lg font-medium hover:bg-gray-100 transition-colors",disabled:t.isUploading}," Coba Lagi ",8,sn)])):c("",!0)],4),h.value.length>1&&!t.isUploading?(n(),o("button",{key:0,onClick:V,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},a[7]||(a[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,an)):c("",!0),h.value.length>1&&!t.isUploading?(n(),o("button",{key:1,onClick:k,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},a[8]||(a[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,nn)):c("",!0)]),e("div",on,[e("div",ln,[b.value&&!b.value.isNew?(n(),o("button",{key:0,onClick:z,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},a[9]||(a[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Se(" Hapus Foto ")]),8,rn)):(n(),o("div",dn)),t.allowMultiple&&h.value.length<t.maxFiles&&!t.isUploading?(n(),o("button",{key:2,onClick:E,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},a[10]||(a[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Se(" Tambah Foto ")]),8,un)):c("",!0)]),e("div",cn,[t.isUploading?(n(),o("button",gn,[e("div",pn,[a[11]||(a[11]=e("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),e("span",null,"Mengupload... "+T(t.uploadProgress)+"%",1)])])):(n(),o("button",{key:0,onClick:$,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),t.isUploading?(n(),o("div",mn,a[12]||(a[12]=[e("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):c("",!0)])])])):c("",!0)}}},fn=Oe(vn,[["__scopeId","data-v-581782f4"]]),hn=["accept","multiple","disabled"],bn={class:"text-xs text-gray-500 mb-2"},yn=["disabled"],xn={class:"h-full flex flex-col items-center justify-center p-4 text-center"},wn={class:"text-xs text-gray-400 mt-1"},kn={key:0,class:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},In={class:"flex items-center justify-between mb-2"},$n={class:"text-xs text-blue-600"},Cn={class:"w-full bg-blue-200 rounded-full h-2"},Sn={class:"text-xs text-blue-600 mt-1"},_n={key:1,class:"flex items-center gap-4"},Vn=["src"],Mn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Nn=["disabled"],Tn={key:2,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Un=["disabled"],Dn=["onClick"],En=["src"],An={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ln={key:0},jn={key:1,class:"ml-1"},Rn={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},On={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},Bn={key:2,class:"mt-1 text-xs text-red-600"},qn={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(t,{emit:Y}){const s=t,x=Y,d=y(null),h=y(null),b=y(!1),g=y(!1),l=y(!1),k=y([]),V=y(0),$=y(!1),H=y(0),z=y(0),E=y(0),G=ns("imageSourceSetting",y("all")),C=`inspection-${s.inspectionId}-point-${s.pointId}-backup`,p=le(()=>Number(s.settings.max_files)>1),a=le(()=>s.settings.allowed_types.map(u=>`.${u}`).join(", ")),M=le(()=>{const u=s.settings.camera_aspect_ratio.split(":");if(u.length===2){const _=parseFloat(u[0]),v=parseFloat(u[1]);if(!isNaN(_)&&!isNaN(v)&&v!==0)return _/v}return 3/4}),O=le(()=>{const u=[],_=new Set;for(const v of s.modelValue)v.id&&_.add(v.id),u.push({...v,rotation:v.rotation||0,isNew:!1,isUploaded:!0,preview:v.preview||(v.image_path?`/${v.image_path}`:null)});for(const v of k.value)v.id&&_.add(v.id),u.push({...v,isUploading:v.isUploading||!1});return u}),S=u=>u.preview||(u.image_path?`/${u.image_path}`:""),ee=()=>{l.value&&(l.value=!1),G.value==="camera"?re():G.value==="gallery"?te():b.value=!0},te=()=>{b.value=!1,d.value.click()},re=()=>{b.value=!1,g.value=!0},me=()=>{b.value=!1,O.value.length>0&&(l.value=!0)},ue=()=>{g.value=!1,O.value.length>0&&(l.value=!0)},J=()=>{l.value=!1,$.value||(k.value.forEach(u=>{u.preview&&u.preview.startsWith("blob:")&&URL.revokeObjectURL(u.preview)}),k.value=[])},A=u=>new Promise(_=>{const v=new FileReader;v.onload=N=>{const B=new Image;B.onload=()=>{_({file:u,preview:URL.createObjectURL(u),rotation:0,width:B.naturalWidth,height:B.naturalHeight,isNew:!0})},B.onerror=()=>{console.error("Failed to load image for dimensions:",u.name),_({file:u,preview:URL.createObjectURL(u),rotation:0,width:0,height:0,isNew:!0})},B.src=N.target.result},v.readAsDataURL(u)}),w=u=>{const _=u.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(_)},j=async u=>{const v=(s.settings.max_size||2048)*1024;return new Promise(N=>{const B=new Image,se=new FileReader;se.onload=F=>{B.onload=()=>{const ne=document.createElement("canvas"),Q=ne.getContext("2d"),I=Math.max(B.width,B.height);ne.width=I,ne.height=I,Q.fillStyle="white",Q.fillRect(0,0,I,I);const m=(I-B.width)/2,W=(I-B.height)/2;Q.drawImage(B,m,W,B.width,B.height);let P=.9;const R=()=>{ne.toBlob(fe=>{if(fe.size>v&&P>.1)P-=.1,R();else{const Ie=new File([fe],u.name,{type:"image/jpeg",lastModified:Date.now()});N(Ie)}},"image/jpeg",P)};R()},B.src=F.target.result},se.readAsDataURL(u)})},U=async u=>{const _=Array.from(u.target.files);if(!_.length){b.value=!1,O.value.length>0&&(l.value=!0);return}try{const v=_.filter(Q=>!w(Q));if(v.length>0){const Q=v.map(I=>I.name.split(".").pop()).join(", ");alert(`File type not allowed: ${Q}. Allowed types: ${s.settings.allowed_types.join(", ")}`),u.target.value="";return}const N=O.value.length,B=s.settings.max_files-N,se=await Promise.all(_.slice(0,B).map(async Q=>await j(Q))),F=await Promise.all(se.map(A)),ne=p.value?F:F.slice(0,1);p.value?k.value.push(...ne):(k.value.forEach(Q=>{Q.preview&&Q.preview.startsWith("blob:")&&URL.revokeObjectURL(Q.preview)}),k.value=ne),b.value=!1,ne.length>0?(V.value=Math.max(0,O.value.length-ne.length),l.value=!0):O.value.length>0&&(l.value=!0),u.target.value=""}catch(v){console.error("Error processing selected images:",v),alert("Failed to process selected images. Please try again."),b.value=!1,O.value.length>0&&(l.value=!0)}},K=async u=>{const _=O.value.length;if(!p.value||_<s.settings.max_files)try{const v=await j(u),N=new Image;N.onload=()=>{const B={file:v,preview:URL.createObjectURL(v),rotation:0,width:N.naturalWidth,height:N.naturalHeight,isNew:!0};p.value?k.value.push(B):(k.value.forEach(se=>{se.preview&&se.preview.startsWith("blob:")&&URL.revokeObjectURL(se.preview)}),k.value=[B]),g.value=!1,b.value=!1,V.value=O.value.length-1,l.value=!0},N.src=URL.createObjectURL(v)}catch(v){console.error("Error processing captured image:",v),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),g.value=!1,b.value=!1,O.value.length>0&&(l.value=!0)},ie=(u=0)=>{V.value=u,l.value=!0},de=u=>new Promise(_=>{if(u.rotation===0||!h.value){if(!u.isNew&&!u.file){_({file:null,width:u.width,height:u.height,isOriginal:!0});return}_({file:u.file,width:u.width,height:u.height});return}const v=new Image;v.onload=async()=>{try{const N=h.value,B=N.getContext("2d"),se=v.width,F=v.height;let ne,Q;u.rotation===90||u.rotation===270?(ne=F,Q=se):(ne=se,Q=F),N.width=ne,N.height=Q,B.clearRect(0,0,N.width,N.height),B.translate(N.width/2,N.height/2),B.rotate(u.rotation*Math.PI/180),B.drawImage(v,-se/2,-F/2,se,F),B.setTransform(1,0,0,1,0,0);const I=await new Promise(P=>{N.toBlob(P,"image/jpeg",.9)}),m=new File([I],u.file?u.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),W=await j(m);_({file:W,width:ne,height:Q})}catch(N){console.error("Error processing rotated image:",N),_({file:u.file,width:u.width,height:u.height})}},v.onerror=()=>{console.error("Failed to load image for rotation processing:",u.preview),_({file:u.file,width:u.width,height:u.height})},v.src=u.preview}),ve=u=>{try{const _={images:u.map(v=>{var N;return{fileName:((N=v.file)==null?void 0:N.name)||`image-${Date.now()}.jpg`,rotation:v.rotation||0,width:v.width||0,height:v.height||0,timestamp:Date.now()}}),inspectionId:s.inspectionId,pointId:s.pointId};localStorage.setItem(C,JSON.stringify(_))}catch(_){console.error("Error saving backup:",_)}},ce=()=>{localStorage.removeItem(C)},ge=async u=>{$.value=!0;const _=[],v=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),$.value=!1;return}try{ve(u);for(const N of u){if(!N.isNew&&N.rotation===0&&N.id&&N.image_path){_.push({id:N.id,image_path:N.image_path,width:N.width,height:N.height,rotation:0,preview:N.preview,isUploaded:!0});continue}const{file:B,width:se,height:F,isOriginal:ne}=await de(N);if(ne&&!N.isNew){_.push({id:N.id,image_path:N.image_path,width:N.width,height:N.height,rotation:N.rotation||0,preview:N.preview,isUploaded:!0});continue}B&&v.push({file:B,width:se,height:F,rotation:N.rotation||0,originalImage:N})}J(),v.length>0?await we(v,_):(x("update:modelValue",_),x("save",s.pointId))}catch(N){console.error("Error during image processing:",N),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{$.value=!1}},we=async(u,_)=>{E.value=u.length,z.value=0,H.value=0;const v=[..._];let N=0;try{for(let B=0;B<u.length;B++){const se=u[B],F=new FormData;F.append("inspection_id",s.inspectionId),F.append("point_id",s.pointId),F.append("images[]",se.file);const ne=k.value.findIndex(Q=>{var I;return Q.preview===((I=se.originalImage)==null?void 0:I.preview)});ne!==-1&&(k.value[ne].isUploading=!0,k.value[ne].isFailed=!1);try{const I=(await pt.post(route("inspections.upload-image"),F,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:m=>{if(m.total){const W=Math.round(m.loaded*100/m.total);H.value=Math.round((B+m.loaded/m.total)/u.length*100),z.value=B+1}}})).data.images;if(I&&I.length>0){const m=I[0];if(v.push({id:m.image_id,image_path:m.path,width:m.width||se.width||0,height:m.height||se.height||0,rotation:se.rotation||0,preview:m.public_url,isUploaded:!0}),ne!==-1){const W=k.value.splice(ne,1)[0];W.preview&&W.preview.startsWith("blob:")&&URL.revokeObjectURL(W.preview)}N++}}catch(Q){console.error(`Error uploading image ${B+1}:`,Q),ne!==-1&&(k.value[ne].isUploading=!1,k.value[ne].isFailed=!0)}}N>0&&(x("update:modelValue",v),x("save",s.pointId),x("uploaded",{pointId:s.pointId,images:v,newImagesCount:N})),N===u.length&&ce(),console.log(`✅ Successfully uploaded ${N}/${u.length} images`)}catch(B){console.error("Error in upload process:",B),u.forEach(se=>{const F=k.value.findIndex(ne=>{var Q;return ne.preview===((Q=se.originalImage)==null?void 0:Q.preview)});F!==-1&&(k.value[F].isUploading=!1,k.value[F].isFailed=!0)})}finally{H.value=0,z.value=0,E.value=0,$.value=!1}},L=async u=>{if(!u||!u.file){console.error("No file to retry upload");return}$.value=!0;const _=[...s.modelValue];try{const v=new FormData;v.append("inspection_id",s.inspectionId),v.append("point_id",s.pointId),v.append("images[]",u.file);const N=k.value.findIndex(F=>F.preview===u.preview);N!==-1&&(k.value[N].isUploading=!0,k.value[N].isFailed=!1);const se=(await pt.post(route("inspections.upload-image"),v,{headers:{"Content-Type":"multipart/form-data"}})).data.images;if(se&&se.length>0){const F=se[0];if(_.push({id:F.image_id,image_path:F.path,width:F.width||u.width||0,height:F.height||u.height||0,rotation:u.rotation||0,preview:F.public_url,isUploaded:!0}),N!==-1){const Q=k.value.splice(N,1)[0];Q.preview&&Q.preview.startsWith("blob:")&&URL.revokeObjectURL(Q.preview)}x("update:modelValue",_),x("save",s.pointId),x("uploaded",{pointId:s.pointId,images:_,newImagesCount:1}),k.value.some(Q=>Q.isFailed)||ce(),console.log("✅ Successfully retried upload for 1 image")}}catch(v){console.error("Error retrying upload:",v),previewIndex!==-1&&(k.value[previewIndex].isUploading=!1,k.value[previewIndex].isFailed=!0)}finally{$.value=!1}},ke=u=>{if(u){if(u.id&&!u.isNew)be(u);else{const _=k.value.findIndex(v=>v.preview&&v.preview===u.preview&&v.isNew||v.id&&v.id===u.id);if(_!==-1){const v=k.value.splice(_,1)[0];v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}x("update:modelValue",s.modelValue.filter(v=>!(v.id&&v.id===u.id)&&!(v.preview&&v.preview===u.preview)))}V.value>=O.value.length&&(V.value=Math.max(0,O.value.length-1)),O.value.length===0&&J()}},be=async u=>{var v,N;if(u.id||u.image_path)try{await pt.delete(route("inspections.delete-image"),{data:{image_id:u.id,image_path:u.image_path}})}catch(B){console.error("Error deleting image from server:",B),(N=(v=B.response)==null?void 0:v.data)!=null&&N.message?alert(`Failed to delete image from server: ${B.response.data.message}`):alert(`Failed to delete image from server: ${B.message}`);return}u.preview&&u.preview.startsWith("blob:")&&URL.revokeObjectURL(u.preview);const _=s.modelValue.filter(B=>B.id!==u.id);x("update:modelValue",_),k.value=k.value.filter(B=>B.isNew&&u.isNew?B.preview!==u.preview:B.id!==u.id),x("removeImage",{image:u}),l.value&&O.value.length===0?J():l.value&&V.value>=O.value.length&&(V.value=Math.max(0,O.value.length-1))};return Qe(()=>{try{localStorage.getItem(C)&&console.log("Found backup images, ready for recovery if needed")}catch(u){console.error("Error loading backup:",u)}}),(u,_)=>(n(),o("div",null,[e("input",{ref_key:"galleryInput",ref:d,type:"file",accept:a.value,class:"hidden",onChange:U,multiple:p.value,disabled:$.value},null,40,hn),e("canvas",{ref_key:"processingCanvas",ref:h,class:"hidden"},null,512),e("p",bn,"Foto Maksimal: "+T(t.settings.max_files)+" | Rasio: "+T(t.settings.camera_aspect_ratio),1),O.value.length===0?(n(),o("label",{key:0,onClick:ee,class:ae(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:$.value},[e("div",xn,[_[2]||(_[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),_[3]||(_[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),e("p",wn,"Tipe: "+T(a.value),1)])],8,yn)):(n(),o("div",{key:1,class:ae(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[$.value?(n(),o("div",kn,[e("div",In,[_[4]||(_[4]=e("span",{class:"text-sm font-medium text-blue-700"},"Mengupload gambar...",-1)),e("span",$n,T(H.value)+"%",1)]),e("div",Cn,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Re({width:H.value+"%"})},null,4)]),e("p",Sn,T(z.value)+"/"+T(E.value)+" gambar terupload",1)])):c("",!0),t.settings.max_files===1?(n(),o("div",_n,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:_[0]||(_[0]=v=>ie(0))},[e("img",{src:S(O.value[0]),class:"w-full h-full object-cover"},null,8,Vn),O.value[0].isUploading?(n(),o("div",Mn,_[5]||(_[5]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0)]),e("button",{onClick:_[1]||(_[1]=it(v=>be(O.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:$.value},_[6]||(_[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Se(" Hapus Foto ")]),8,Nn)])):(n(),o("div",Tn,[p.value&&O.value.length<t.settings.max_files?(n(),o("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:ee,disabled:$.value},_[7]||(_[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Un)):c("",!0),(n(!0),o(Ce,null,_e(O.value,(v,N)=>(n(),o("div",{key:v.id||v.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:B=>v.isFailed?L(v):ie(N)},[e("img",{src:S(v),class:"w-full h-full object-cover"},null,8,En),v.isNew||v.rotation!==0?(n(),o("div",An,[v.isNew?(n(),o("span",Ln,"BARU")):c("",!0),v.rotation!==0?(n(),o("span",jn,"ROTASI")):c("",!0)])):c("",!0),v.isUploading?(n(),o("div",Rn,_[8]||(_[8]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0),v.isFailed?(n(),o("div",On,_[9]||(_[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),e("span",{class:"text-xs font-medium"},"Retry",-1)]))):c("",!0)],8,Dn))),128))]))],2)),t.error?(n(),o("p",Bn,T(t.error),1)):c("",!0),xe(ka,{show:b.value,settings:t.settings,onClose:me,onOpenWebcam:re,onTriggerGallery:te},null,8,["show","settings"]),xe(Ra,{show:g.value,"aspect-ratio":M.value,settings:t.settings,point:t.point,onClose:ue,onPhotoCaptured:K},null,8,["show","aspect-ratio","settings","point"]),xe(fn,{show:l.value,images:O.value,point:t.point,"initial-index":V.value,"allow-multiple":p.value,"max-files":t.settings.max_files,"is-uploading":$.value,"aspect-ratio":M.value,"upload-progress":H.value,"current-upload":z.value,"total-upload":E.value,onClose:J,onSaveImages:ge,onRemovePreviewImage:ke,onTriggerAddMorePhotos:ee,onRetryImage:L},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},ft=Oe(qn,[["__scopeId","data-v-a1838a9b"]]),Fn={key:0,class:"fixed inset-0 z-50 overflow-hidden"},zn={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Hn={class:"px-4 pb-2 border-b border-gray-200"},Kn={class:"text-lg font-semibold text-gray-900"},Pn={key:0,class:"text-sm text-gray-500 mt-1"},Wn={class:"flex-1 overflow-y-auto p-4"},Gn={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Zn={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},setup(t){return(Y,s)=>(n(),Te(Ye,{name:"bottom-sheet"},{default:De(()=>[t.show?(n(),o("div",Fn,[s[1]||(s[1]=e("div",{class:"absolute inset-0 bg-black bg-opacity-50"},null,-1)),e("div",zn,[s[0]||(s[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Hn,[e("h3",Kn,T(t.title),1),t.subtitle?(n(),o("p",Pn,T(t.subtitle),1)):c("",!0)]),e("div",Wn,[Ut(Y.$slots,"default",{},void 0,!0)]),Y.$slots.footer?(n(),o("div",Gn,[Ut(Y.$slots,"footer",{},void 0,!0)])):c("",!0)])])):c("",!0)]),_:3}))}},zt=Oe(Zn,[["__scopeId","data-v-fd942535"]]),Jn={class:"space-y-4"},Xn={key:0,class:"mt-2"},Yn={key:1,class:"mt-2"},Qn={key:2,class:"mt-2"},eo={key:3,class:"mt-2"},to={key:4,class:"mt-2"},so={class:"text-sm font-medium text-gray-700 mb-2"},ao={key:0,class:"text-red-500"},no={key:0,class:"text-xs text-red-500"},oo=["name","value","checked"],io={key:6,class:"space-y-2"},lo={key:0,class:"text-red-500"},ro={key:1,class:"text-xs text-red-500"},uo={key:7,class:"mt-4"},co={class:"text-sm font-medium text-gray-700 mb-2"},go={key:0,class:"text-red-500"},po={key:0,class:"text-xs text-red-500"},mo={class:"flex gap-2"},vo=["disabled"],ht={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(t,{emit:Y}){const s=t,x=Y,d=g=>x("hapus",g),h=le(()=>s.options.find(g=>g.value===s.selectedValue)),b=le(()=>{var l,k,V,$,H,z,E;if(s.point.input_type==="text"&&(!((l=s.notesValue)!=null&&l.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((k=s.notesValue)!=null&&k.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((V=s.notesValue)!=null&&V.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!(($=s.notesValue)!=null&&$.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date))return!1;if(s.point.input_type==="imageTOradio"){if(s.imagesValue.length===0)return!1;const G=s.imagesValue.some(p=>p.status==="error"),C=s.imagesValue.some(p=>p.status==="uploading");if(G||C)return!1}if(s.options.length&&!s.selectedValue)return!1;const g=h.value;if(s.showTextarea&&((H=g==null?void 0:g.settings)!=null&&H.show_textarea)&&(!((z=s.notesValue)!=null&&z.trim())||g.settings.min_length&&s.notesValue.length<g.settings.min_length||g.settings.max_length&&s.notesValue.length>g.settings.max_length))return!1;if(s.showImageUpload&&((E=g==null?void 0:g.settings)!=null&&E.show_image_upload)){if(s.imagesValue.length===0||g.settings.max_files&&s.imagesValue.length>g.settings.max_files)return!1;const G=s.imagesValue.some(p=>p.status==="error"),C=s.imagesValue.some(p=>p.status==="uploading");if(G||C)return!1}return!0});return(g,l)=>(n(),Te(zt,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:l[18]||(l[18]=k=>g.$emit("close"))},{footer:De(()=>[t.selectedPoint?(n(),o("button",{key:0,onClick:l[15]||(l[15]=k=>d(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},l[20]||(l[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),Se(" Hapus Data ")]))):c("",!0),e("div",mo,[e("button",{type:"button",onClick:l[16]||(l[16]=k=>g.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:l[17]||(l[17]=k=>g.$emit("save")),disabled:!b.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,vo)])]),default:De(()=>{var k,V,$,H,z,E,G,C,p,a,M,O,S,ee,te,re,me,ue,J,A,w,j,U,K,ie,de,ve,ce,ge,we;return[e("div",Jn,[t.point.input_type==="text"?(n(),o("div",Xn,[xe(Rt,{"model-value":t.notesValue,required:(k=t.point.settings)==null?void 0:k.is_required,"min-length":(V=t.point.settings)==null?void 0:V.min_length,"max-length":($=t.point.settings)==null?void 0:$.max_length,allowSpace:(H=t.point.settings)==null?void 0:H.allow_space,textTransform:(z=t.point.settings)==null?void 0:z.text_transform,placeholder:((E=t.point.settings)==null?void 0:E.placeholder)||"Masukan text",error:g.error,"onUpdate:modelValue":l[0]||(l[0]=L=>g.$emit("update:notesValue",L)),onSave:l[1]||(l[1]=L=>g.$emit("saveText",L))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):c("",!0),t.point.input_type==="number"?(n(),o("div",Yn,[xe(Ot,{"model-value":t.notesValue,required:(G=t.point.settings)==null?void 0:G.is_required,min:(C=t.point.settings)==null?void 0:C.min,max:(p=t.point.settings)==null?void 0:p.max,step:((a=t.point.settings)==null?void 0:a.step)||1,placeholder:((M=t.point.settings)==null?void 0:M.placeholder)||"Masukan number",error:g.error,"onUpdate:modelValue":l[2]||(l[2]=L=>g.$emit("update:notesValue",L)),onSave:l[3]||(l[3]=L=>g.$emit("saveNumber",L))},null,8,["model-value","required","min","max","step","placeholder","error"])])):c("",!0),t.point.input_type==="account"?(n(),o("div",Qn,[xe(qt,{"model-value":t.notesValue,required:(O=t.point.settings)==null?void 0:O.is_required,placeholder:((S=t.point.settings)==null?void 0:S.placeholder)||"Masukkan nilai",error:g.error,"point-id":t.pointId,settings:t.point.settings,"onUpdate:modelValue":l[4]||(l[4]=L=>g.$emit("update:notesValue",L)),onSave:l[5]||(l[5]=L=>g.$emit("saveAccount",L))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):c("",!0),t.point.input_type==="date"?(n(),o("div",eo,[xe(Bt,{"model-value":t.notesValue,required:(ee=t.point.settings)==null?void 0:ee.is_required,"min-date":(te=t.point.settings)==null?void 0:te.min_date,"max-date":(re=t.point.settings)==null?void 0:re.max_date,error:g.error,"onUpdate:modelValue":l[6]||(l[6]=L=>g.$emit("update:notesValue",L)),onSave:l[7]||(l[7]=L=>g.$emit("saveDate",L))},null,8,["model-value","required","min-date","max-date","error"])])):c("",!0),t.point.input_type==="imageTOradio"?(n(),o("div",to,[e("h4",so,[(me=t.point.settings)!=null&&me.required?(n(),o("span",ao,"*")):c("",!0)]),xe(ft,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point.inspection_point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":l[8]||(l[8]=L=>g.$emit("update:imagesValue",L)),onSave:l[9]||(l[9]=L=>g.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(ue=t.point.settings)!=null&&ue.required&&t.imagesValue.length===0?(n(),o("p",no," Foto wajib diupload ")):c("",!0)])):c("",!0),t.options.length?(n(),o("div",{key:5,class:ae(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(n(!0),o(Ce,null,_e(t.options,(L,ke)=>(n(),o("label",{key:ke,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:L.value,checked:t.selectedValue===L.value,onChange:l[10]||(l[10]=be=>g.$emit("update:selectedValue",be.target.value)),class:"hidden peer"},null,40,oo),e("div",{class:ae(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==L.value}])},T(L.label),3)]))),128))],2)):c("",!0),t.showTextarea&&((A=(J=h.value)==null?void 0:J.settings)!=null&&A.show_textarea)?(n(),o("div",io,[(w=h.value.settings)!=null&&w.required?(n(),o("span",lo,"*")):c("",!0),xe(Ft,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:h.value.settings,required:(j=h.value.settings)==null?void 0:j.required,"min-length":(U=h.value.settings)==null?void 0:U.min_length,"max-length":(K=h.value.settings)==null?void 0:K.max_length,placeholder:((ie=h.value.settings)==null?void 0:ie.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":l[11]||(l[11]=L=>g.$emit("update:notesValue",L)),onSave:l[12]||(l[12]=L=>g.$emit("saveTextarea",L))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(de=h.value.settings)!=null&&de.required&&!t.notesValue?(n(),o("p",ro," Keterangan wajib diisi ")):c("",!0)])):c("",!0),t.showImageUpload&&((ce=(ve=h.value)==null?void 0:ve.settings)!=null&&ce.show_image_upload)?(n(),o("div",uo,[e("h4",co,[l[19]||(l[19]=Se(" Upload Foto ")),(ge=h.value.settings)!=null&&ge.required?(n(),o("span",go,"*")):c("",!0)]),xe(ft,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:h.value.settings,"onUpdate:modelValue":l[13]||(l[13]=L=>g.$emit("update:imagesValue",L)),onSave:l[14]||(l[14]=L=>g.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(we=h.value.settings)!=null&&we.required&&t.imagesValue.length===0?(n(),o("p",po," Foto wajib diupload ")):c("",!0)])):c("",!0)])]}),_:1},8,["show","title","subtitle"]))}},fo={class:"mt-2 space-y-2"},ho=["name","value","checked","onChange","required"],bo={key:0,class:"p-2 rounded-lg bg-gray-50"},yo={key:0,class:"mt-2"},xo={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},wo=["src"],ko={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Io={key:1,class:"mt-2"},$o={class:"text-sm text-gray-600"},Co={key:2,class:"mt-2 text-sm text-red-600"},So={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:Y}){const s=t,x=Y,d=y(s.notes),h=y([...s.images]),b=y(!1),g=y(""),l=y([]),k=y(""),V=y([]),$=le(()=>s.options.find(S=>S.value===s.modelValue)),H=S=>S.settings&&(S.settings.show_textarea||S.settings.show_image_upload);ye(()=>s.notes,S=>{d.value=S}),ye(()=>s.images,S=>{h.value=[...S]}),ye(()=>s.modelValue,S=>{S&&(k.value=S)});const z=S=>{x("update:modelValue",S.value),H(S)?G():x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:S.value,notes:"",images:[]})},E=S=>S.preview||(S.image_path?`/${S.image_path}`:S),G=()=>{k.value=s.modelValue,g.value=d.value,l.value=[...h.value],V.value=[...h.value],b.value=!0},C=()=>{g.value="",l.value=[],k.value="",b.value=!1},p=S=>{l.value=S,h.value=[...S],x("update:images",[...S]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:d.value,images:[...S]})},a=S=>{},M=()=>{k.value!==s.modelValue&&x("update:modelValue",k.value),d.value=g.value,x("update:notes",g.value),h.value=[...l.value],x("update:images",[...l.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:k.value,notes:g.value,images:l.value}),b.value=!1},O=S=>{k.value="",g.value="",l.value=[],d.value="",h.value=[],x("update:modelValue",""),x("update:notes",""),x("update:images",[]),x("hapus",S),b.value=!1};return(S,ee)=>{var te,re,me,ue;return n(),o("div",fo,[e("div",{class:ae(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(n(!0),o(Ce,null,_e(t.options,(J,A)=>(n(),o("label",{key:A,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:J.value,checked:t.modelValue===J.value,onChange:w=>z(J),class:"hidden peer",required:t.required},null,40,ho),e("div",{class:ae(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===J.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==J.value}])},T(J.label),3)]))),128))],2),t.modelValue&&$.value&&H($.value)?(n(),o("div",bo,[e("div",{class:"flex justify-between items-start"},[ee[4]||(ee[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:G,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((te=$.value.settings)!=null&&te.show_image_upload)?(n(),o("div",yo,[e("div",xo,[(n(!0),o(Ce,null,_e(t.images,(J,A)=>(n(),o("div",{key:A,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:E(J),class:"w-full h-full object-cover rounded"},null,8,wo),A===3&&t.images.length>4?(n(),o("span",ko," +"+T(t.images.length-4),1)):c("",!0)]))),128))])])):c("",!0),t.notes&&((re=$.value.settings)!=null&&re.show_textarea)?(n(),o("div",Io,[e("p",$o,T(t.notes),1)])):c("",!0)])):c("",!0),b.value?(n(),Te(ht,{key:(me=t.selectedPoint)==null?void 0:me.id,show:b.value,title:t.pointName||"Detail",subtitle:(ue=$.value)==null?void 0:ue.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":k.value,"notes-value":g.value,"images-value":l.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":ee[0]||(ee[0]=J=>k.value=J),"onUpdate:notesValue":ee[1]||(ee[1]=J=>g.value=J),"onUpdate:imagesValue":ee[2]||(ee[2]=J=>p(J)),onClose:C,onSave:M,onSaveTextarea:S.handleTextareaSave,onSaveImage:a,onHapus:ee[3]||(ee[3]=J=>O(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):c("",!0),t.error?(n(),o("p",Co,T(t.error),1)):c("",!0)])}}},_o={class:"mt-2 space-y-2"},Vo={key:0,class:"flex flex-wrap gap-3"},Mo={key:1,class:"p-2"},No={key:0,class:"mt-2"},To={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Uo=["src"],Do={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Eo=["name","value","checked"],Ao={key:1,class:"mt-2"},Lo={class:"text-sm text-gray-600"},jo={key:3,class:"mt-2 text-sm text-red-600"},Ro={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:Y}){const s=t,x=Y,d=y(s.notes),h=y([...s.images]),b=y(!1),g=y(""),l=y([]),k=y(""),V=y([]),$=le(()=>s.options.find(a=>a.value===s.modelValue)),H=a=>a.preview||(a.image_path?`/${a.image_path}`:a);ye(()=>s.notes,a=>{d.value=a});const z=()=>{k.value=s.modelValue||"",g.value=d.value,l.value=[...h.value],V.value=[...h.value],b.value=!0},E=()=>{g.value="",l.value=[],k.value="",b.value=!1},G=a=>{l.value=a,h.value=[...a],x("update:images",[...a]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:d.value,images:[...a]})},C=()=>{k.value!==s.modelValue&&x("update:modelValue",k.value),d.value=g.value,x("update:notes",g.value),h.value=[...l.value],x("update:images",[...l.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:k.value,notes:g.value,images:l.value}),b.value=!1},p=a=>{k.value="",g.value="",l.value=[],d.value="",h.value=[],x("update:modelValue",""),x("update:notes",""),x("update:images",[]),x("hapus",a),b.value=!1};return(a,M)=>{var O,S,ee;return n(),o("div",_o,[!t.modelValue&&h.value.length===0&&!d.value?(n(),o("div",Vo,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:z},M[4]||(M[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),o("div",Mo,[e("div",{class:"flex justify-between items-start"},[M[5]||(M[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:z,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),h.value.length>0?(n(),o("div",No,[e("div",To,[(n(!0),o(Ce,null,_e(h.value,(te,re)=>(n(),o("div",{key:re,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:H(te),class:"w-full h-full object-cover rounded"},null,8,Uo),re===3&&h.value.length>4?(n(),o("span",Do," +"+T(h.value.length-4),1)):c("",!0)]))),128))])])):c("",!0),e("div",{class:ae(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(n(!0),o(Ce,null,_e(t.options,(te,re)=>(n(),o("label",{key:re,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:te.value,checked:t.modelValue===te.value,disabled:!0,class:"hidden peer"},null,8,Eo),e("div",{class:ae(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===te.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==te.value}])},T(te.label),3)]))),128))],2),d.value&&((O=$.value.settings)!=null&&O.show_textarea)?(n(),o("div",Ao,[e("p",Lo,T(d.value),1)])):c("",!0)])),b.value?(n(),Te(ht,{key:(S=t.selectedPoint)==null?void 0:S.id,show:b.value,title:t.pointName||"Detail",subtitle:(ee=$.value)==null?void 0:ee.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":k.value,"notes-value":g.value,"images-value":l.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":M[0]||(M[0]=te=>k.value=te),"onUpdate:notesValue":M[1]||(M[1]=te=>g.value=te),"onUpdate:imagesValue":M[2]||(M[2]=te=>G(te)),onClose:E,onSave:C,onHapus:M[3]||(M[3]=te=>p(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):c("",!0),t.error?(n(),o("p",jo,T(t.error),1)):c("",!0)])}}},Oo={class:"text-base font-semibold text-indigo-700"},Bo={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},qo={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Fo={class:"text-base font-semibold text-indigo-700"},zo={class:"p-4 space-y-4"},Ho={class:"flex items-start justify-between"},Ko={class:"block text-sm font-medium text-gray-700"},Po={key:0,class:"text-red-500"},Wo={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Go={key:0,class:"text-center py-8 text-gray-500"},Zo={key:0,class:"text-xs text-gray-400"},Jo={__name:"CategorySection",props:{category:Object,form:Object,head:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(t,{emit:Y}){const s=t,x=Y,d=y(!1),h=os(),b=y(!0),g=y(null);Qe(()=>{const C=new IntersectionObserver(([p])=>{b.value=p.isIntersecting},{threshold:.1});g.value&&C.observe(g.value),ut(()=>{g.value&&C.unobserve(g.value)})});const l=le(()=>(s.category.points||[]).some(C=>C.is_default===!1)),k=le(()=>{var p;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(p=s.category.points)==null?void 0:p.length}),!s.category.isDamageMenu){const a=(s.category.points||[]).filter(M=>{var ee;const O=(ee=M.inspection_point)==null?void 0:ee.id,S=V(O);return d.value||M.is_default||S?!0:(console.log(`Non-damage Point ${O}: is_default=${M.is_default}, hasData=${S}`),!1)});return console.log("Filtered non-damage points:",a),a}const C=(s.category.points||[]).filter(a=>{var S;const M=(S=a.inspection_point)==null?void 0:S.id,O=V(M);return d.value||a.is_default||!a.is_default&&O?!0:(console.log(`Damage Point ${M}: hasData=${O}`),O)});return console.log("Filtered damage points:",C),C}),V=C=>{if(!C)return console.log("hasPointData: pointId is null/undefined"),!1;const p=h.props.existingResults[C]!==void 0,a=h.props.existingImages[C]&&h.props.existingImages[C].length>0,M=s.form.results[C]&&(s.form.results[C].status||s.form.results[C].note),O=s.form.images[C]&&s.form.images[C].length>0,S=p||a||M||O;return console.log(`Point ${C} data check:`,{hasServerResult:p,hasServerImages:a,hasLocalResult:M,hasLocalImages:O,finalResult:S}),S},$=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],H=C=>{var M,O,S,ee,te,re,me,ue,J;const p=s.form.results[(M=C.inspection_point)==null?void 0:M.id],a=s.form.images[(O=C.inspection_point)==null?void 0:O.id];if(!p)return!1;switch(C.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!p.note;case"select":case"radio":if(!p.status)return!1;const A=(ee=(S=C.settings)==null?void 0:S.radios)==null?void 0:ee.find(j=>j.value===p.status);return!(A!=null&&A.settings&&(A.settings.show_textarea&&!((te=p.note)!=null&&te.trim())||A.settings.show_image_upload&&(a==null?void 0:a.length)===0));case"imageTOradio":if((a==null?void 0:a.length)===0||!p.status)return!1;const w=(me=(re=C.settings)==null?void 0:re.radios)==null?void 0:me.find(j=>j.value===p.status);return!(w!=null&&w.settings&&w.settings.show_textarea&&!((ue=p.note)!=null&&ue.trim()));case"image":return(a==null?void 0:a.length)>0;default:return!!p.status||!!((J=p.note)!=null&&J.trim())}};ye(()=>s.form.results,C=>{Object.keys(C).forEach(p=>{!C[p]||!C[p].status&&C[p].note})},{deep:!0}),ye(()=>s.form.images,C=>{Object.keys(C).forEach(p=>{!C[p]||C[p].length})},{deep:!0});const z=(C,p,a)=>{x("updateResult",{pointId:C,type:a,value:p})},E=C=>{x("saveResult",C)},G=C=>{x("hapusPoint",C)};return(C,p)=>(n(),o(Ce,null,[s.head==="vertical"?(n(),o("div",{key:0,class:ae(["px-6 py-2 border-b flex items-center justify-between bg-indigo-200","fixed top-0 left-0 right-0 z-20"])},[e("h4",Oo,T(t.category.name),1),l.value?(n(),o("button",{key:0,onClick:p[0]||(p[0]=a=>d.value=!d.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},T(d.value?"Sembunyikan":"Tampilkan Point Lain"),1)):c("",!0)])):c("",!0),e("div",{class:ae(["bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100",s.head==="vertical"?"pt-6":""])},[!b.value&&l.value?(n(),o("button",{key:0,onClick:p[1]||(p[1]=a=>d.value=!d.value),class:"fixed top-3 right-2 z-50 bg-indigo-600 text-white p-2 rounded-full shadow-lg"},[d.value?(n(),o("svg",Bo,p[3]||(p[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)]))):(n(),o("svg",qo,p[4]||(p[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.006-3.362M9.88 9.88a3 3 0 104.24 4.24M6.1 6.1l11.8 11.8"},null,-1)])))])):c("",!0),s.head==="horizontal"?(n(),o("div",{key:1,ref_key:"categoryHeader",ref:g,class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",Fo,T(t.category.name),1),l.value?(n(),o("button",{key:0,onClick:p[2]||(p[2]=a=>d.value=!d.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},T(d.value?"Sembunyikan":"Tampilkan Point Lain"),1)):c("",!0)],512)):c("",!0),e("div",zo,[(n(!0),o(Ce,null,_e(k.value,a=>{var M,O,S,ee,te,re,me,ue,J,A,w,j,U,K,ie,de,ve,ce,ge,we,L,ke,be,u,_,v,N,B,se,F,ne,Q,I,m,W,P,R,fe,Ie,$e,Be,ze,et,tt,st,lt,We,at,nt,Ge,Ve,Ee,He,Ze,Ke,Pe;return n(),o("div",{key:a.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",Ho,[e("label",Ko,[Se(T((M=a.inspection_point)==null?void 0:M.name)+" ",1),(O=a.settings)!=null&&O.is_required?(n(),o("span",Po,"*")):c("",!0)]),H(a)?(n(),o("span",Wo," ✓ ")):c("",!0)]),a.input_type==="text"?(n(),Te(Rt,{key:0,modelValue:t.form.results[(S=a.inspection_point)==null?void 0:S.id].note,"onUpdate:modelValue":[q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=q},q=>{var f;return z((f=a.inspection_point)==null?void 0:f.id,q,"note")}],required:(ee=a.settings)==null?void 0:ee.is_required,"min-length":(te=a.settings)==null?void 0:te.min_length,"max-length":(re=a.settings)==null?void 0:re.max_length,allowSpace:(me=a.settings)==null?void 0:me.allow_space,textTransform:(ue=a.settings)==null?void 0:ue.text_transform,placeholder:((J=a.settings)==null?void 0:J.placeholder)||"Masukan text",error:t.form.errors[`results.${(A=a.inspection_point)==null?void 0:A.id}.note`],onSave:q=>{var f;return E((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):c("",!0),a.input_type==="number"?(n(),Te(Ot,{key:1,modelValue:t.form.results[(w=a.inspection_point)==null?void 0:w.id].note,"onUpdate:modelValue":[q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=q},q=>{var f;return z((f=a.inspection_point)==null?void 0:f.id,q,"note")}],required:(j=a.settings)==null?void 0:j.is_required,min:(U=a.settings)==null?void 0:U.min,max:(K=a.settings)==null?void 0:K.max,step:((ie=a.settings)==null?void 0:ie.step)||1,placeholder:((de=a.settings)==null?void 0:de.placeholder)||"Masukan number",error:t.form.errors[`results.${(ve=a.inspection_point)==null?void 0:ve.id}.note`],onSave:q=>{var f;return E((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):c("",!0),a.input_type==="account"?(n(),Te(qt,{key:2,modelValue:t.form.results[(ce=a.inspection_point)==null?void 0:ce.id].note,"onUpdate:modelValue":[q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=q},q=>{var f;return z((f=a.inspection_point)==null?void 0:f.id,q,"note")}],required:(ge=a.settings)==null?void 0:ge.is_required,placeholder:((we=a.settings)==null?void 0:we.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${(L=a.inspection_point)==null?void 0:L.id}.note`],"point-id":(ke=a.inspection_point)==null?void 0:ke.id,settings:a.settings,onSave:q=>{var f;return E((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):c("",!0),a.input_type==="date"?(n(),Te(Bt,{key:3,modelValue:t.form.results[(be=a.inspection_point)==null?void 0:be.id].note,"onUpdate:modelValue":[q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=q},q=>{var f;return z((f=a.inspection_point)==null?void 0:f.id,q,"note")}],required:(u=a.settings)==null?void 0:u.is_required,"min-date":(_=a.settings)==null?void 0:_.min_date,"max-date":(v=a.settings)==null?void 0:v.max_date,error:t.form.errors[`results.${(N=a.inspection_point)==null?void 0:N.id}.note`],onSave:q=>{var f;return E((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):c("",!0),a.input_type==="textarea"?(n(),Te(Ft,{key:4,modelValue:t.form.results[(B=a.inspection_point)==null?void 0:B.id].note,"onUpdate:modelValue":[q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=q},q=>{var f;return z((f=a.inspection_point)==null?void 0:f.id,q,"note")}],required:(se=a.settings)==null?void 0:se.is_required,"min-length":(F=a.settings)==null?void 0:F.min_length,"max-length":(ne=a.settings)==null?void 0:ne.max_length,placeholder:((Q=a.settings)==null?void 0:Q.placeholder)||"Masukkan teks di sini",settings:a.settings,error:t.form.errors[`results.${(I=a.inspection_point)==null?void 0:I.id}.note`],onSave:q=>{var f;return E((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):c("",!0),a.input_type==="radio"?(n(),Te(So,{key:5,modelValue:t.form.results[(m=a.inspection_point)==null?void 0:m.id].status,"onUpdate:modelValue":[q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=q},q=>{var f;return z((f=a.inspection_point)==null?void 0:f.id,q,"status")}],notes:t.form.results[(W=a.inspection_point)==null?void 0:W.id].note,images:t.form.images[(P=a.inspection_point)==null?void 0:P.id],required:(R=a.settings)==null?void 0:R.is_required,"point-id":(fe=a.inspection_point)==null?void 0:fe.id,point:a.inspection_point,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(Ie=a.inspection_point)==null?void 0:Ie.name,"selected-point":a.inspection_point??null,options:(($e=a.settings)==null?void 0:$e.radios)||$,error:t.form.errors[`results.${(Be=a.inspection_point)==null?void 0:Be.id}.status`],"onUpdate:notes":q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=q},"onUpdate:images":q=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=q},onSave:q=>{var f;return E((f=a.inspection_point)==null?void 0:f.id)},onHapus:q=>{var f;return G((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="imageTOradio"?(n(),Te(Ro,{key:6,modelValue:t.form.results[(ze=a.inspection_point)==null?void 0:ze.id].status,"onUpdate:modelValue":[q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=q},q=>{var f;return z((f=a.inspection_point)==null?void 0:f.id,q,"status")}],notes:t.form.results[(et=a.inspection_point)==null?void 0:et.id].note,images:t.form.images[(tt=a.inspection_point)==null?void 0:tt.id],required:(st=a.settings)==null?void 0:st.is_required,"point-id":(lt=a.inspection_point)==null?void 0:lt.id,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(We=a.inspection_point)==null?void 0:We.name,point:a,"selected-point":a.inspection_point??null,options:((at=a.settings)==null?void 0:at.radios)||$,error:t.form.errors[`results.${(nt=a.inspection_point)==null?void 0:nt.id}.status`],"onUpdate:notes":q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=q},"onUpdate:images":q=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=q},onSave:q=>{var f;return E((f=a.inspection_point)==null?void 0:f.id)},onHapus:q=>{var f;return G((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="image"?(n(),Te(ft,{key:7,modelValue:t.form.images[(Ge=a.inspection_point)==null?void 0:Ge.id],"onUpdate:modelValue":q=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=q},error:t.form.errors[`images.${(Ve=a.inspection_point)==null?void 0:Ve.id}`],"inspection-id":t.inspectionId,"point-id":(Ee=a.inspection_point)==null?void 0:Ee.id,point:a.inspection_point,"point-name":(He=a.inspection_point)==null?void 0:He.name,settings:a.settings,"onUpdate:notes":q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=q},"onUpdate:status":q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=q}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):c("",!0),a.input_type==="select"?(n(),Te(fa,{key:8,modelValue:t.form.results[(Ze=a.inspection_point)==null?void 0:Ze.id].status,"onUpdate:modelValue":[q=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=q},q=>{var f;return z((f=a.inspection_point)==null?void 0:f.id,q,"status")}],required:(Ke=a.settings)==null?void 0:Ke.is_required,error:t.form.errors[`results.${(Pe=a.inspection_point)==null?void 0:Pe.id}.status`],onSave:q=>{var f;return E((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):c("",!0)])}),128)),k.value.length===0?(n(),o("div",Go,[p[5]||(p[5]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),p[6]||(p[6]=e("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),t.category.isDamageMenu?(n(),o("p",Zo,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):c("",!0)])):c("",!0)])],2)],64))}},Xo=Oe(Jo,[["__scopeId","data-v-c9741287"]]),Yo={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Qo={class:"p-4 space-y-4-6"},ei={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ti=["value"],si={class:"p-4 space-y-4-6"},ai={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ni=["value"],oi={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},ii={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},li=["value"],ri={class:"p-4 space-y-2"},di={class:"flex items-center justify-between mb-2"},ui={key:0,class:"mb-4 p-4 bg-white border border-gray-200 rounded-lg shadow-lg"},ci={class:"flex items-center justify-between mb-3"},gi={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto"},pi=["onClick"],mi={class:"text-sm font-medium text-gray-800 mb-1"},vi={class:"text-xs text-gray-600 line-clamp-2"},fi={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},hi={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},bi={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},yi={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},xi={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},wi={class:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg"},ki={class:"flex flex-wrap gap-2"},Ii={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(t,{emit:Y}){const s=t,x=Y,d=y(null),h=y(!1),b=y(!1),g=Dt({bold:!1,italic:!1,underline:!1}),l=Dt({flooded:"",collision:"",collision_severity:"",notes:""}),k=y([{id:1,name:"Kendaraan Normal",description:"Template untuk kendaraan dalam kondisi normal tanpa masalah signifikan",content:`<p>Berdasarkan hasil inspeksi yang telah dilakukan pada kendaraan <strong>{PLATE_NUMBER}</strong> (<strong>{CAR_NAME}</strong>), berikut adalah kesimpulan:</p>
<ul>
<li>Kondisi kendaraan secara umum: <strong>BAIK</strong></li>
<li>Tidak ditemukan indikasi kerusakan signifikan</li>
<li>Semua sistem berfungsi dengan normal</li>
<li>Rekomendasi: Perawatan rutin sesuai jadwal</li>
</ul>`},{id:2,name:"Kendaraan Bekas Tabrakan Ringan",description:"Template untuk kendaraan dengan riwayat tabrakan ringan",content:`<p>Berdasarkan hasil inspeksi menyeluruh pada kendaraan <strong>{PLATE_NUMBER}</strong> (<strong>{CAR_NAME}</strong>), diperoleh kesimpulan:</p>
<ul>
<li>Kendaraan memiliki riwayat tabrakan dengan tingkat kerusakan: <strong>RINGAN</strong></li>
<li>Area yang terdampak: {DAMAGED_AREA}</li>
<li>Perbaikan yang dilakukan: {REPAIR_DETAILS}</li>
<li>Rekomendasi: Perbaikan tambahan pada area yang terdampak</li>
</ul>`},{id:3,name:"Kendaraan Bekas Banjir",description:"Template untuk kendaraan dengan riwayat terkena banjir",content:`<p>Setelah melakukan inspeksi komprehensif pada kendaraan <strong>{PLATE_NUMBER}</strong> (<strong>{CAR_NAME}</strong>), berikut temuan utama:</p>
<ul>
<li>Kendaraan memiliki riwayat terkena banjir</li>
<li>Tingkat paparan air: {WATER_LEVEL}</li>
<li>Komponen yang terdampak: {AFFECTED_COMPONENTS}</li>
<li>Rekomendasi: Pengecekan sistem elektrik dan interior secara berkala</li>
</ul>`},{id:4,name:"Kendaraan dengan Multiple Issues",description:"Template untuk kendaraan dengan beberapa masalah",content:`<p>Hasil inspeksi kendaraan <strong>{PLATE_NUMBER}</strong> (<strong>{CAR_NAME}</strong>) menunjukkan beberapa temuan:</p>
<ul>
<li>Kondisi umum kendaraan: {OVERALL_CONDITION}</li>
<li>Masalah utama yang ditemukan: {MAIN_ISSUES}</li>
<li>Komponen yang perlu perhatian: {ATTENTION_NEEDED}</li>
<li>Estimasi biaya perbaikan: {REPAIR_COST_ESTIMATE}</li>
<li>Rekomendasi: {RECOMMENDATION}</li>
</ul>`},{id:5,name:"Template Singkat",description:"Template ringkas untuk kesimpulan cepat",content:`<p><strong>KESIMPULAN INSPEKSI</strong></p>
<p>Kendaraan: <strong>{PLATE_NUMBER}</strong> - <strong>{CAR_NAME}</strong></p>
<p>Status: {OVERALL_STATUS}</p>
<p>Catatan: {ADDITIONAL_NOTES}</p>`},{id:6,name:"Template Teknis Detail",description:"Template detail untuk laporan teknis lengkap",content:`<p><strong>LAPORAN HASIL INSPEKSI TEKNIS</strong></p>
<p>Kendaraan: <strong>{PLATE_NUMBER}</strong></p>
<p>Model: <strong>{CAR_NAME}</strong></p>
<p>Tanggal Inspeksi: {INSPECTION_DATE}</p>

<p><strong>HASIL INSPEKSI:</strong></p>
<ul>
<li>Kondisi Mesin: {ENGINE_CONDITION}</li>
<li>Kondisi Transmisi: {TRANSMISSION_CONDITION}</li>
<li>Kondisi Suspensi: {SUSPENSION_CONDITION}</li>
<li>Kondisi Rem: {BRAKE_CONDITION}</li>
<li>Kondisi Body: {BODY_CONDITION}</li>
<li>Kondisi Interior: {INTERIOR_CONDITION}</li>
</ul>

<p><strong>KESIMPULAN:</strong> {FINAL_CONCLUSION}</p>`}]),V=y(["{PLATE_NUMBER}","{CAR_NAME}","{INSPECTION_DATE}","{DAMAGED_AREA}","{REPAIR_DETAILS}","{WATER_LEVEL}","{AFFECTED_COMPONENTS}","{OVERALL_CONDITION}","{MAIN_ISSUES}","{ATTENTION_NEEDED}","{REPAIR_COST_ESTIMATE}","{RECOMMENDATION}","{OVERALL_STATUS}","{ADDITIONAL_NOTES}","{ENGINE_CONDITION}","{TRANSMISSION_CONDITION}","{SUSPENSION_CONDITION}","{BRAKE_CONDITION}","{BODY_CONDITION}","{INTERIOR_CONDITION}","{FINAL_CONCLUSION}"]),$=A=>{if(!A)return{};if(typeof A=="string")try{return JSON.parse(A)||{}}catch(w){return console.error("Error parsing settings JSON:",w),{}}return typeof A=="object"&&A!==null?A:{}};le(()=>$(s.inspection.settings).conclusion||{});const H=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],z=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],E=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Qe(()=>{C(),vt(()=>{G(),M()})});const G=()=>{d.value&&l.notes&&(d.value.innerHTML=l.notes)},C=()=>{const w=$(s.inspection.settings).conclusion||{},j=s.form.conclusion||{};l.flooded=j.flooded||w.flooded||"",l.collision=j.collision||w.collision||"",l.collision_severity=j.collision_severity||w.collision_severity||"",l.notes=j.notes||s.inspection.notes||""},p=A=>{if(!d.value)return;let w=A.content;w=w.replace(/{PLATE_NUMBER}/g,s.inspection.plate_number||"[NOMOR_PLAT]").replace(/{CAR_NAME}/g,s.inspection.car_name||"[NAMA_MOBIL]").replace(/{INSPECTION_DATE}/g,new Date().toLocaleDateString("id-ID")).replace(/{FLOOD_STATUS}/g,l.flooded==="yes"?"Pernah terkena banjir":"Tidak pernah terkena banjir").replace(/{COLLISION_STATUS}/g,l.collision==="yes"?"Pernah mengalami tabrakan":"Tidak pernah mengalami tabrakan"),d.value.innerHTML=w,l.notes=w,b.value=!1,vt(()=>{d.value.focus(),J()})},a=()=>{d.value&&(d.value.innerHTML="",l.notes="",J())},M=()=>{if(!d.value)return;const A=window.getSelection();A.rangeCount===0||A.isCollapsed||(g.bold=document.queryCommandState("bold"),g.italic=document.queryCommandState("italic"),g.underline=document.queryCommandState("underline"))},O=A=>{if(!d.value)return;d.value.focus();const w=g[A];switch(A){case"bold":document.execCommand("bold",!1,!w);break;case"italic":document.execCommand("italic",!1,!w);break;case"underline":document.execCommand("underline",!1,!w);break}setTimeout(()=>{M(),S()},10)},S=jt.debounce(()=>{d.value&&(l.notes=d.value.innerHTML,J())},200),ee=A=>{A.preventDefault(),document.execCommand("insertParagraph",!1,null)},te=A=>{A.preventDefault();const w=(A.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,w)},re=()=>{h.value=!0},me=()=>{h.value=!1,d.value&&(l.notes=d.value.innerHTML,J())},ue=()=>{J()},J=()=>{const A={flooded:l.flooded,collision:l.collision,collision_severity:l.collision==="yes"?l.collision_severity:null,notes:l.notes};x("updateConclusion",A)};return ye(()=>s.form.conclusion,A=>{A&&(l.flooded=A.flooded!==void 0?A.flooded:l.flooded,l.collision=A.collision!==void 0?A.collision:l.collision,l.collision_severity=A.collision_severity!==void 0?A.collision_severity:l.collision_severity,l.notes=A.notes!==void 0?A.notes:l.notes,d.value&&A.notes!==void 0&&d.value.innerHTML!==A.notes&&(d.value.innerHTML=A.notes))},{deep:!0,immediate:!0}),ye([()=>l.flooded,()=>l.collision,()=>l.collision_severity,()=>l.notes],()=>{J()},{deep:!0}),(A,w)=>(n(),o("div",Yo,[w[23]||(w[23]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),e("div",Qo,[w[10]||(w[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Se(" Apakah kendaraan pernah terkena banjir? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ei,[(n(),o(Ce,null,_e(H,j=>e("label",{key:j.value,class:"cursor-pointer"},[Ae(e("input",{type:"radio","onUpdate:modelValue":w[0]||(w[0]=U=>l.flooded=U),value:j.value,class:"hidden peer",onChange:ue},null,40,ti),[[mt,l.flooded]]),e("div",{class:ae(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":l.flooded===j.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":l.flooded!==j.value}])},T(j.label),3)])),64))])]),e("div",si,[w[12]||(w[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Se(" Apakah kendaraan pernah mengalami tabrakan? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ai,[(n(),o(Ce,null,_e(z,j=>e("label",{key:j.value,class:"cursor-pointer"},[Ae(e("input",{type:"radio","onUpdate:modelValue":w[1]||(w[1]=U=>l.collision=U),value:j.value,class:"hidden peer",onChange:ue},null,40,ni),[[mt,l.collision]]),e("div",{class:ae(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":l.collision===j.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":l.collision!==j.value}])},T(j.label),3)])),64))]),xe(Ye,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:De(()=>[l.collision==="yes"?(n(),o("div",oi,[w[11]||(w[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Se("Tingkat kerusakan: "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ii,[(n(),o(Ce,null,_e(E,j=>e("label",{key:j.value,class:"cursor-pointer"},[Ae(e("input",{type:"radio","onUpdate:modelValue":w[2]||(w[2]=U=>l.collision_severity=U),value:j.value,class:"hidden peer",onChange:ue},null,40,li),[[mt,l.collision_severity]]),e("div",{class:ae(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":l.collision_severity===j.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":l.collision_severity!==j.value}])},T(j.label),3)])),64))])])):c("",!0)]),_:1})]),e("div",ri,[e("div",di,[w[14]||(w[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Catatan Kesimpulan",-1)),e("button",{type:"button",onClick:w[3]||(w[3]=j=>b.value=!b.value),class:"flex items-center gap-2 px-3 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-all duration-200"},w[13]||(w[13]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),Se(" Template ")]))]),xe(Ye,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:De(()=>[b.value?(n(),o("div",ui,[e("div",ci,[w[16]||(w[16]=e("h5",{class:"text-sm font-semibold text-gray-700"},"Pilih Template Kesimpulan",-1)),e("button",{onClick:w[4]||(w[4]=j=>b.value=!1),class:"text-gray-400 hover:text-gray-600"},w[15]||(w[15]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",gi,[(n(!0),o(Ce,null,_e(k.value,j=>(n(),o("button",{key:j.id,onClick:U=>p(j),class:"p-3 text-left border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-all duration-150"},[e("div",mi,T(j.name),1),e("div",vi,T(j.description),1)],8,pi))),128))])])):c("",!0)]),_:1}),e("div",fi,[e("button",{type:"button",onClick:w[5]||(w[5]=j=>O("bold")),class:ae(["p-2 rounded transition-all duration-150 ease-in-out font-medium",g.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},w[17]||(w[17]=[e("strong",null,"B",-1)]),2),e("button",{type:"button",onClick:w[6]||(w[6]=j=>O("italic")),class:ae(["p-2 rounded transition-all duration-150 ease-in-out font-medium",g.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},w[18]||(w[18]=[e("em",null,"I",-1)]),2),e("button",{type:"button",onClick:w[7]||(w[7]=j=>O("underline")),class:ae(["p-2 rounded transition-all duration-150 ease-in-out font-medium",g.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},w[19]||(w[19]=[e("u",null,"U",-1)]),2),e("button",{type:"button",onClick:w[8]||(w[8]=j=>a()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Template"}," 🗑️ Clear ")]),xe(Ye,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:De(()=>[Object.values(g).some(j=>j)?(n(),o("div",hi,[w[20]||(w[20]=Se(" Format aktif: ")),g.bold?(n(),o("span",bi,"Bold")):c("",!0),g.italic?(n(),o("span",yi,"Italic")):c("",!0),g.underline?(n(),o("span",xi,"Underline")):c("",!0)])):c("",!0)]),_:1}),e("div",{ref_key:"editorRef",ref:d,contenteditable:"true",class:ae(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!h.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":h.value}]),onInput:w[9]||(w[9]=(...j)=>X(S)&&X(S)(...j)),onBlur:me,onFocus:re,onKeydown:is(ee,["enter"]),onPaste:te,onMouseup:M,onKeyup:M,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34),e("div",wi,[w[21]||(w[21]=e("div",{class:"text-xs font-medium text-yellow-800 mb-2"},"Variabel yang tersedia:",-1)),e("div",ki,[(n(!0),o(Ce,null,_e(V.value,j=>(n(),o("span",{key:j,class:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs rounded border border-yellow-300"},T(j),1))),128))]),w[22]||(w[22]=e("div",{class:"text-xs text-yellow-600 mt-2"}," *Variabel akan otomatis terisi berdasarkan data inspeksi ",-1))])])]))}},$i=Oe(Ii,[["__scopeId","data-v-7bb61351"]]),Ci={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Si={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},_i={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Vi={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Mi={class:"flex items-center space-x-2 flex-shrink-0"},Ni=["aria-checked"],Ti={class:"flex items-center space-x-2 flex-shrink-0"},Ui={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Di=["onClick","data-category"],Ei={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ai={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Li={key:3,class:"fixed inset-0 z-30"},ji={class:"mt-2 space-y-2"},Ri={class:"flex items-center space-x-2"},Oi=["aria-checked"],Bi={class:"flex items-center space-x-2"},qi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Fi=["onClick"],zi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Hi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ki={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Pi={class:"relative overflow-hidden"},Wi={key:"vehicle"},Gi={key:"conclusion"},Zi={key:1},Ji=["disabled"],Xi={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Yi={class:"space-y-4"},Qi={class:"relative"},el={class:"max-h-64 overflow-y-auto"},tl={key:0,class:"text-center py-4 text-gray-500"},sl=["onClick"],al={class:"font-medium text-gray-900"},nl={class:"text-sm text-gray-500"},ol={class:"text-xs text-gray-400 mt-1"},il={key:0,class:"text-xs text-green-600 mt-1"},ll={key:3,class:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 text-center"},rl={__name:"IndexLocal",props:{inspection:Object,inspectionId:Object,category:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(t){var wt,kt,It,$t,Ct,St,_t,Vt,Mt,Nt;const Y=i=>{if(!i)return{};if(typeof i=="string")try{return JSON.parse(i)||{}}catch(r){return console.error("Error parsing settings JSON:",r),{}}return typeof i=="object"&&i!==null?i:{}},s=t,x=le(()=>`inspection_data_${s.inspection.id}`),d=le(()=>`swipe_toggle_${s.inspection.id}`),h=le(()=>`image_source_${s.inspection.id}`),b=()=>{try{const i=localStorage.getItem(x.value);return i?JSON.parse(i):{}}catch(i){return console.error("Error reading local storage:",i),{}}},g=i=>{try{localStorage.setItem(x.value,JSON.stringify(i))}catch(r){console.error("Error writing to local storage:",r)}},l=()=>{try{localStorage.removeItem(x.value),localStorage.removeItem(d.value),localStorage.removeItem(h.value)}catch(i){console.error("Error clearing local storage:",i)}},k=()=>{try{const i=localStorage.getItem(d.value);return i?JSON.parse(i):!0}catch(i){return console.error("Error reading swipe toggle state:",i),!0}},V=i=>{try{localStorage.setItem(d.value,JSON.stringify(i))}catch(r){console.error("Error writing swipe toggle state:",r)}},$=()=>{try{return localStorage.getItem(h.value)||"all"}catch(i){return console.error("Error reading image source setting:",i),"all"}},H=i=>{try{localStorage.setItem(h.value,i)}catch(r){console.error("Error writing image source setting:",r)}},z=y(((kt=(wt=s.category)==null?void 0:wt.settings)==null?void 0:kt.menu_model)||"horizontal"),E=y((($t=(It=s.category)==null?void 0:It.settings)==null?void 0:$t.position)||"top"),G=y(!1),C=y(!1),{pos:p,dragging:a,startLongPress:M,cancelLongPress:O,onDrag:S,stopDrag:ee,handleClick:te}=At("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),re=i=>{te(i)&&me()},me=()=>{G.value=!G.value},ue=()=>{G.value=!1},J=i=>i?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:A,dragging:w,startLongPress:j,cancelLongPress:U,onDrag:K,stopDrag:ie,handleClick:de}=At("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),ve=i=>{de(i)&&(ce.value=!0)},ce=y(!1),ge=y(!1),we=y(""),L=y(null),ke=y(""),be=y(""),u=y(""),_=y(!1),v=y(null),N=(i,r)=>{_.value=!0,v.value=r,dt.visit(i,{onFinish:()=>{_.value=!1,v.value=null}})},B=le(()=>s.appMenus.some(i=>i.input_type==="damage")),se=le(()=>["vehicle",...s.appMenus.map(i=>i.id),"conclusion"]),F=y(se.value[0]),ne=y(0);ye(F,i=>{ne.value=se.value.indexOf(i)});const Q=le(()=>{if(F.value==="vehicle"||F.value==="conclusion")return null;const i=s.appMenus.find(r=>r.id===F.value);return i?{...i,points:I(i.menu_point,i.input_type==="damage")}:null}),I=(i,r)=>r?(i||[]).filter(Z=>{const oe=Z.inspection_point_id;return tt(oe)}):i||[],m=y({plate_number:s.inspection.plate_number,car_id:s.inspection.car_id,car_name:s.inspection.car_name}),W=y({notes:s.inspection.overall_note||"",flooded:((St=(Ct=Y(s.inspection.settings))==null?void 0:Ct.conclusion)==null?void 0:St.flooded)||null,collision:((Vt=(_t=Y(s.inspection.settings))==null?void 0:_t.conclusion)==null?void 0:Vt.collision)||null,collision_severity:((Nt=(Mt=Y(s.inspection.settings))==null?void 0:Mt.conclusion)==null?void 0:Nt.collision_severity)||null}),R=Lt((()=>{const i=[...s.appMenus.flatMap(je=>je.menu_point||[]),...s.damagePoints||[]],r={},Z={};i.forEach(je=>{const Le=je.inspection_point_id,Ue=s.existingResults[Le];r[Le]={status:(Ue==null?void 0:Ue.status)||"",note:(Ue==null?void 0:Ue.note)||""},Z[Le]=s.existingImages[Le]||[]});const oe=b(),pe={...r,...oe.results||{}},Me={...Z,...oe.images||{}},Ne={...m.value,...oe.vehicleDetails||{}},he=oe.overall_note!==void 0?oe.overall_note:s.inspection.overall_note||"";return{inspection_id:s.inspection.id,results:pe,images:Me,overall_note:he,plate_number:Ne.plate_number,car_id:Ne.car_id,car_name:Ne.car_name}})());ye(R,i=>{g({results:i.results,images:i.images,overall_note:i.overall_note,vehicleDetails:m.value,conclusion:W.value})},{deep:!0}),ye(m,i=>{R.plate_number=i.plate_number,R.car_id=i.car_id,R.car_name=i.car_name},{deep:!0}),ye(W,i=>{R.overall_note=i.notes},{deep:!0});const fe=y(!1),Ie=i=>{fe.value=i},$e=y(!1),Be=i=>{$e.value=i},ze=le(()=>{var pe;const i=m.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(m.value.plate_number),r=!!((pe=m.value.car_name)!=null&&pe.trim()),Z=!$e.value,oe=!fe.value;return i&&r&&Z&&oe}),et=le(()=>{if(!we.value.trim())return s.damagePoints||[];const i=we.value.toLowerCase().trim();return(s.damagePoints||[]).filter(r=>{var Z,oe,pe,Me,Ne;return((oe=(Z=r.inspection_point)==null?void 0:Z.name)==null?void 0:oe.toLowerCase().includes(i))||((Me=(pe=r.inspection_point)==null?void 0:pe.description)==null?void 0:Me.toLowerCase().includes(i))||((Ne=st(r))==null?void 0:Ne.toLowerCase().includes(i))})}),tt=i=>{const r=R.results[i]&&(R.results[i].status||R.results[i].note),Z=R.images[i]&&R.images[i].length>0;return r||Z},st=i=>{var r;return((r=i.inspection_point.component)==null?void 0:r.name)||"Komponen Tidak Diketahui"},lt=i=>R.results[i]||null,We=()=>{var Me;const i=W.value,r=!!i.flooded,Z=!!i.collision,oe=i.collision==="yes"?!!i.collision_severity:!0,pe=!!((Me=i.notes)!=null&&Me.trim());return r&&Z&&oe&&pe},at=le(()=>({flooded:W.value.flooded||null,collision:W.value.collision||null,collision_severity:W.value.collision_severity||null,note:W.value.notes||null,isComplete:We()})),nt=le(()=>{const i=ze.value,r=s.appMenus.every(oe=>Ge(oe)),Z=We();return i&&r&&Z}),Ge=i=>i.input_type==="damage"?I(i.menu_point,!0).length>0:i.id==="conclusion"?We():i.id==="vehicle"?ze.value:(I(i.menu_point,!1)||[]).filter(Z=>Z.is_default).every(Z=>{var Ne,he,je,Le,Ue,ot;const oe=R.results[Z.inspection_point_id],pe=R.images[Z.inspection_point_id];if(!oe)return!1;const Me=Y(Z.settings);switch(Z.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((Ne=oe.note)!=null&&Ne.trim());case"select":case"radio":if(!oe.status)return!1;const qe=(he=Me.radios)==null?void 0:he.find(D=>D.value===oe.status);return!(qe!=null&&qe.settings&&(qe.settings.show_textarea&&!((je=oe.note)!=null&&je.trim())||qe.settings.show_image_upload&&(pe==null?void 0:pe.length)===0));case"imageTOradio":if((pe==null?void 0:pe.length)===0||!oe.status)return!1;const Fe=(Le=Me.radios)==null?void 0:Le.find(D=>D.value===oe.status);return!(Fe!=null&&Fe.settings&&Fe.settings.show_textarea&&Fe.settings.required&&!((Ue=oe.note)!=null&&Ue.trim()));case"image":return(pe==null?void 0:pe.length)>0;default:return!!oe.status||!!((ot=oe.note)!=null&&ot.trim())}}),Ve=y(!0),Ee=y("all"),He=y(null),Ze=y([]),Ke=y(0),Pe=y(!1);ls("imageSourceSetting",Ee);const q=()=>{Ve.value=!Ve.value,V(Ve.value)},f=()=>{H(Ee.value),console.log("Image source setting updated to:",Ee.value)},rt=()=>{He.value&&vt(()=>{const i=He.value.querySelector(`[data-category="${F.value}"]`);if(!i)return;const r=He.value,Z=r.clientWidth,oe=i.offsetLeft,pe=i.clientWidth,Me=oe-Z/2+pe/2;r.scrollTo({left:Me,behavior:"smooth"})})},Ht=()=>Ke.value===0?(Ke.value=1,Pe.value=!0,setTimeout(()=>{Ke.value=0,Pe.value=!1},2e3),window.history.pushState(null,null,window.location.href),!1):(Ke.value=0,Pe.value=!1,dt.visit(route("job.index")),!0),Kt=()=>{window.history.state===null&&window.history.replaceState({isBackButtonControlled:!0},""),window.history.pushState({isBackButtonControlled:!0},""),window.addEventListener("popstate",i=>{i.state&&i.state.isBackButtonControlled&&(i.preventDefault(),Ht())})},Pt=i=>{L.value=i;const r=i.inspection_point_id,Z=R.results[r]||{};ke.value=Z.status||"",be.value=Z.note||"",ce.value=!1,ge.value=!0},Wt=i=>{L.value&&(R.images[L.value.inspection_point_id]=i)},Gt=()=>{if(L.value){const i=L.value.inspection_point_id;R.results[i]={...R.results[i],status:ke.value,note:be.value},u.value="Data berhasil disimpan di lokal!",setTimeout(()=>u.value="",1e3)}ct()},Zt=({pointId:i,type:r,value:Z})=>{var oe;(oe=R.results[i])!=null&&oe.hasOwnProperty(r)&&(R.results[i][r]=Z)},bt=async i=>{if(i&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await dt.post(route("inspections.delete-result"),{inspection_id:s.inspection.id,point_id:i},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{R.results[i]&&(R.results[i]={status:"",note:""}),R.images[i]&&(R.images[i]=[]),u.value="Data berhasil dihapus!",setTimeout(()=>u.value="",1e3)},onError:r=>{console.error("Error menghapus hasil:",r)}})}catch(r){console.error("Error menghapus hasil:",r)}ct()}},Jt=i=>{Object.assign(m.value,i),Ie(!0)},Xt=i=>{console.log("Save car details locally:",i)},Yt=i=>{console.log("Received conclusion data from child:",i),W.value={...W.value,...i},R.overall_note=i.notes||"",console.log("Conclusion state updated:",W.value)},Qt=()=>{if(!nt.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}if(!confirm("Apakah Anda yakin ingin mengirim semua data inspeksi? Data lokal akan dihapus setelah berhasil dikirim."))return;C.value=!0;const i={...R.data(),overall_note:W.value.notes,conclusion:{notes:W.value.notes,flooded:W.value.flooded,collision:W.value.collision,collision_severity:W.value.collision_severity}};dt.post(route("inspections.final-submit-local",{id:s.inspection.id}),i,{preserveScroll:!0,onSuccess:()=>{l()},onError:r=>{console.error("Kesalahan pengiriman:",r),C.value=!1}})},es=({pointId:i,imageId:r})=>{R.images[i]&&(R.images[i]=R.images[i].filter(Z=>Z.id!==r))},yt=()=>{ce.value=!1,we.value=""},ct=()=>{ge.value=!1,L.value=null,ke.value="",be.value=""},ts=()=>{},Je=i=>{F.value=i,rt()},xt=i=>{let r=ne.value+i;r>=0&&r<se.value.length&&(F.value=se.value[r],rt())},ss=()=>{let i=0,r=0,Z=null;const oe=he=>{Ve.value&&(i=he.changedTouches[0].screenX)},pe=he=>{Ve.value&&(r=he.changedTouches[0].screenX,Me())},Me=()=>{if(!Ve.value)return;const he=250;r<i-he?xt(1):r>i+he&&xt(-1)},Ne=()=>{const he=document.querySelector(".relative.overflow-hidden");return he&&(he.addEventListener("touchstart",oe,{passive:!0}),he.addEventListener("touchend",pe,{passive:!0})),()=>{he&&(he.removeEventListener("touchstart",oe),he.removeEventListener("touchend",pe))}};return Z=Ne(),ye(Ve,he=>{Z&&Z(),he&&(Z=Ne())}),()=>{Z&&Z()}};return ye(F,(i,r)=>{rt()}),ye(F,i=>{ne.value=se.value.indexOf(i)}),Qe(()=>{const i=b();if(Ve.value=k(),Ee.value=$(),i.vehicleDetails&&(Object.assign(m.value,i.vehicleDetails),R.plate_number=i.vehicleDetails.plate_number,R.car_id=i.vehicleDetails.car_id,R.car_name=i.vehicleDetails.car_name),i.conclusion)console.log("Loading conclusion from localStorage:",i.conclusion),Object.assign(W.value,i.conclusion),R.overall_note=i.conclusion.notes||"";else{const Z=Y(s.inspection.settings).conclusion||{};W.value={notes:s.inspection.notes||"",flooded:Z.flooded||"",collision:Z.collision||"",collision_severity:Z.collision_severity||""},R.overall_note=s.inspection.notes||""}i.results&&Object.assign(R.results,i.results),i.images&&Object.assign(R.images,i.images),ss(),Kt(),setTimeout(()=>{rt()},100)}),(i,r)=>{var Z,oe,pe,Me,Ne,he,je,Le,Ue,ot,qe,Fe;return n(),o("div",Ci,[X(w)||X(a)?(n(),o("div",Si)):c("",!0),z.value==="vertical"?(n(),o("button",{key:1,onMousedown:r[0]||(r[0]=(...D)=>X(M)&&X(M)(...D)),onMouseup:r[1]||(r[1]=(...D)=>X(ee)&&X(ee)(...D)),onMouseleave:r[2]||(r[2]=(...D)=>X(O)&&X(O)(...D)),onMousemove:r[3]||(r[3]=(...D)=>X(S)&&X(S)(...D)),onTouchstart:r[4]||(r[4]=(...D)=>X(M)&&X(M)(...D)),onTouchend:r[5]||(r[5]=(...D)=>X(ee)&&X(ee)(...D)),onTouchmove:r[6]||(r[6]=(...D)=>X(S)&&X(S)(...D)),onClick:re,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:Re({left:X(p).x+"px",top:X(p).y+"px"}),"aria-label":"Toggle vertical menu"},[G.value?(n(),o("svg",Vi,r[25]||(r[25]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(n(),o("svg",_i,r[24]||(r[24]=[e("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):c("",!0),z.value==="horizontal"?(n(),o("div",{key:2,class:ae(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":E.value==="top","fixed bottom-0 left-0 right-0":E.value==="bottom"}])},[e("div",{ref_key:"menuContainer",ref:He,class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2 menu-container",onScroll:ts},[e("div",Mi,[r[26]||(r[26]=e("span",{class:"text-sm text-gray-600"},"Swipe",-1)),e("button",{onClick:q,type:"button",class:ae(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Ve.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Ve.value},[e("span",{"aria-hidden":"true",class:ae(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Ve.value?"translate-x-5":"translate-x-0"])},null,2)],10,Ni)]),e("div",Ti,[r[28]||(r[28]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ae(e("select",{"onUpdate:modelValue":r[7]||(r[7]=D=>Ee.value=D),onChange:f,class:"text-sm border border-gray-300 rounded-md px-5 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},r[27]||(r[27]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[Et,Ee.value]])]),e("button",{ref_key:"menuItems",ref:Ze,onClick:r[8]||(r[8]=D=>Je("vehicle")),class:ae(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":F.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":F.value!=="vehicle"}]),"data-category":"vehicle"},[r[29]||(r[29]=Se(" Detail Kendaraan ")),ze.value?(n(),o("span",Ui," ✓ ")):c("",!0)],2),(n(!0),o(Ce,null,_e(t.appMenus,D=>(n(),o("button",{key:D.id,ref_for:!0,ref_key:"menuItems",ref:Ze,onClick:gt=>Je(D.id),class:ae(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":F.value===D.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":F.value!==D.id}]),"data-category":D.id},[Se(T(D.name)+" ",1),Ge(D)?(n(),o("span",Ei," ✓ ")):c("",!0)],10,Di))),128)),e("button",{ref_key:"menuItems",ref:Ze,onClick:r[9]||(r[9]=D=>Je("conclusion")),class:ae(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":F.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":F.value!=="conclusion"}]),"data-category":"conclusion"},[r[30]||(r[30]=Se(" Kesimpulan ")),at.value.isComplete?(n(),o("span",Ai," ✓ ")):c("",!0)],2)],544)],2)):c("",!0),z.value==="vertical"&&G.value?(n(),o("div",Li,[e("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:ue}),e("div",{class:ae(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":E.value==="top-right","top-16 left-4":E.value==="top-left","bottom-16 right-4":E.value==="bottom-right","bottom-16 left-4":E.value==="bottom-left"}])},[e("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[r[31]||(r[31]=e("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),e("button",{onClick:ue,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),e("div",ji,[e("div",Ri,[r[32]||(r[32]=e("span",{class:"text-sm text-gray-600"},"Swipe Gesture",-1)),e("button",{onClick:q,type:"button",class:ae(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Ve.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Ve.value},[e("span",{"aria-hidden":"true",class:ae(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Ve.value?"translate-x-5":"translate-x-0"])},null,2)],10,Oi)]),e("div",Bi,[r[34]||(r[34]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ae(e("select",{"onUpdate:modelValue":r[10]||(r[10]=D=>Ee.value=D),onChange:f,class:"text-sm border border-gray-300 rounded-md px-6 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},r[33]||(r[33]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[Et,Ee.value]])]),e("button",{onClick:r[11]||(r[11]=D=>{Je("vehicle"),ue()}),class:ae([J(F.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[r[35]||(r[35]=e("span",null,"Detail Kendaraan",-1)),ze.value?(n(),o("span",qi,"✓")):c("",!0)],2),(n(!0),o(Ce,null,_e(t.appMenus,D=>(n(),o("button",{key:`vmenu-${D.id}`,onClick:()=>{Je(D.id),ue()},class:ae([J(F.value===D.id),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[e("span",null,T(D.name),1),Ge(D)?(n(),o("span",zi,"✓")):c("",!0)],10,Fi))),128)),e("button",{onClick:r[12]||(r[12]=D=>{Je("conclusion"),ue()}),class:ae([J(F.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[r[36]||(r[36]=e("span",null,"Kesimpulan",-1)),at.value.isComplete?(n(),o("span",Hi,"✓")):c("",!0)],2)])],2)])):c("",!0),e("div",{class:ae(["max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1",{"pb-4 pt-1":E.value==="top","pb-20 pt-4":E.value==="bottom","pb-4 pt-4":z.value==="vertical"}])},[xe(Ye,{name:"fade"},{default:De(()=>[u.value?(n(),o("div",Ki,T(u.value),1)):c("",!0)]),_:1}),e("div",Pi,[xe(Ye,{name:"category-slide",mode:"out-in"},{default:De(()=>[F.value==="vehicle"?(n(),o("div",Wi,[xe(Ks,{inspection:t.inspection,CarDetail:t.CarDetail,allInspections:s.allInspections,onUpdateVehicle:Jt,onSaveCarDetails:Xt,"onUpdate:validation":Be,"onUpdate:hasUnsavedChanges":Ie},null,8,["inspection","CarDetail","allInspections"])])):Q.value&&F.value!=="conclusion"?(n(),o("div",{key:Q.value.id},[xe(Xo,{category:Q.value,"inspection-id":t.inspection.id,form:X(R),head:z.value,onUpdateResult:Zt,onHapusPoint:bt,onRemoveImage:es},null,8,["category","inspection-id","form","head"])])):F.value==="conclusion"?(n(),o("div",Gi,[xe($i,{form:{conclusion:W.value},"inspection-id":t.inspection.id,inspection:t.inspection,settings:t.inspection.settings||{},onUpdateConclusion:Yt},null,8,["form","inspection-id","inspection","settings"])])):c("",!0)]),_:1})]),F.value==="conclusion"?(n(),o("div",{key:0,class:ae(["flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md",{"mb-4":E.value==="top","mb-20":E.value==="bottom"}])},[xe(X(rs),{href:i.route("inspections.pending",t.inspectionId),as:"button",type:"button",disabled:_.value&&v.value==="pending",onClick:r[13]||(r[13]=it(D=>N(i.route("inspections.pending",t.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:De(()=>[_.value&&v.value==="pending"?(n(),o(Ce,{key:0},[r[37]||(r[37]=e("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),r[38]||(r[38]=e("span",null,"Memproses...",-1))],64)):(n(),o("span",Zi,"Tunda"))]),_:1},8,["href","disabled"]),e("button",{type:"button",onClick:Qt,disabled:!nt.value||C.value,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[C.value?(n(),o("svg",Xi,r[39]||(r[39]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,T(C.value?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Ji)],2)):c("",!0),B.value?(n(),o("button",{key:1,onMousedown:r[14]||(r[14]=(...D)=>X(j)&&X(j)(...D)),onMouseup:r[15]||(r[15]=(...D)=>X(ie)&&X(ie)(...D)),onMouseleave:r[16]||(r[16]=(...D)=>X(U)&&X(U)(...D)),onMousemove:r[17]||(r[17]=(...D)=>X(K)&&X(K)(...D)),onTouchstart:r[18]||(r[18]=(...D)=>X(j)&&X(j)(...D)),onTouchend:r[19]||(r[19]=(...D)=>X(ie)&&X(ie)(...D)),onTouchmove:r[20]||(r[20]=(...D)=>X(K)&&X(K)(...D)),onClick:ve,class:"fixed z-5 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:Re({left:X(A).x+"px",top:X(A).y+"px"})},r[40]||(r[40]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):c("",!0),xe(zt,{show:ce.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:yt},{default:De(()=>[e("button",{onClick:yt,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-10"},r[41]||(r[41]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",Yi,[e("div",Qi,[Ae(e("input",{"onUpdate:modelValue":r[21]||(r[21]=D=>we.value=D),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Xe,we.value]]),r[42]||(r[42]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",el,[et.value.length===0?(n(),o("div",tl," Tidak ada point yang ditemukan ")):c("",!0),(n(!0),o(Ce,null,_e(et.value,D=>{var gt,Tt;return n(),o("button",{key:D.id,onClick:dl=>Pt(D),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",al,T((gt=D.inspection_point)==null?void 0:gt.name),1),e("div",nl,T((Tt=D.inspection_point)==null?void 0:Tt.description),1),e("div",ol,T(st(D)),1),tt(D.inspection_point_id)?(n(),o("div",il," ✓ Sudah ada data ")):c("",!0)],8,sl)}),128))])])]),_:1},8,["show"]),ge.value?(n(),Te(ht,{key:(Z=L.value)==null?void 0:Z.id,show:ge.value,title:((pe=(oe=L.value)==null?void 0:oe.inspection_point)==null?void 0:pe.name)||"Detail Point",subtitle:(Ne=(Me=L.value)==null?void 0:Me.inspection_point)==null?void 0:Ne.description,name:`point-${(he=L.value)==null?void 0:he.id}`,"inspection-id":t.inspection.id,"point-id":(je=L.value)==null?void 0:je.inspection_point_id,settings:((Le=L.value)==null?void 0:Le.settings)||{},options:((ot=(Ue=L.value)==null?void 0:Ue.settings)==null?void 0:ot.radios)||[],"selected-Point":L.value,"selected-value":ke.value,"images-value":X(R).images[(qe=L.value)==null?void 0:qe.inspection_point_id],"notes-value":be.value,point:L.value,"existing-data":lt((Fe=L.value)==null?void 0:Fe.inspection_point_id),"onUpdate:selectedValue":r[22]||(r[22]=D=>ke.value=D),"onUpdate:notesValue":r[23]||(r[23]=D=>be.value=D),"onUpdate:imagesValue":Wt,onSave:Gt,onClose:ct,onHapus:bt},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):c("",!0),Pe.value?(n(),o("div",ll,r[43]||(r[43]=[e("p",{class:"text-sm"},"Tekan sekali lagi untuk keluar dari inspeksi",-1),e("p",{class:"text-xs text-gray-300 mt-1"},"Data inspeksi telah disimpan secara lokal",-1)]))):c("",!0)],2)])}}},fl=Oe(rl,[["__scopeId","data-v-c60e3ffe"]]);export{fl as default};
