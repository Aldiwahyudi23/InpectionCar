import{x as Dt,r as w,g as Ge,q as oe,E as it,G as ye,c as n,o,d as e,b as c,k as Ve,z as Ne,A as Ze,n as te,t as B,u as J,e as Gt,F as _e,m as Me,f as $e,y as at,w as qe,L as Ae,M as Pt,a as St,j as Se,l as Vt,T as nt,p as Jt,N as _t,D as Xt,J as dt,B as Yt,O as Qt,I as Mt,S as es,W as ut}from"./vendor-CwaeDJfC.js";import{l as jt}from"./lodash-DfwitXkl.js";import{_ as ts}from"./PrimaryButton-DTE9tPxx.js";import{_ as ss}from"./ActionMessage-PedWn-P3.js";import{_ as Ee}from"./app-BgcBRrR0.js";import{u as Ut}from"./useDraggableButton-B7ftwxmu.js";const as={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},os={key:0,class:"p-4 space-y-2"},ns={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},is={class:"flex items-center space-x-2"},ls={key:0,class:"text-xs text-red-500 font-normal ml-2"},rs={key:1,class:"text-xs text-red-500 font-normal ml-2"},ds={key:2,class:"text-xs text-green-500 font-normal ml-2"},us={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},cs={class:"relative"},gs={key:0,class:"absolute right-3 top-3"},ms={key:1,class:"text-xs text-red-500 font-normal ml-2"},ps={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},vs={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},fs={key:0},hs=["onMousedown"],bs={class:"font-medium text-gray-900"},xs={class:"text-sm text-gray-500"},ys={key:1,class:"p-4 text-sm text-gray-500 text-center"},ws={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},ks={key:0,class:"mb-4"},$s=["innerHTML"],Cs={key:1},Is={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Ss=["onClick"],Vs=["src","alt"],_s={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Ms={class:"text-white text-xs text-center"},Us={key:2,class:"text-center py-4 text-gray-500 text-sm"},Ds={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},js=["src","alt"],Ts={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Ns={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Ls={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},qs={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges"],setup(t,{emit:Q}){var W,ge,ne,P,ie,pe;const s=t,x=Q,d=Dt({plate_number:((W=s.inspection)==null?void 0:W.plate_number)||"",car_id:((ge=s.inspection)==null?void 0:ge.car_id)||null,car_name:((ne=s.inspection)==null?void 0:ne.car_name)||""}),m=w(((P=s.inspection)==null?void 0:P.plate_number)||""),p=w(((ie=s.inspection)==null?void 0:ie.car_id)||null),l=w(((pe=s.inspection)==null?void 0:pe.car_name)||""),g=w(""),S=w(""),V=w(""),k=w(!1),A=w(""),Z=w(""),h=w(d.car_name),I=w(!1),a=w(!1),$=w([]),_=w(null),E=w([]),K=w(!1),U=w(0);Ge(()=>{var y,v,D,H,N;if(ee((y=s.inspection)==null?void 0:y.plate_number),(v=s.inspection)!=null&&v.car_id&&((D=s.CarDetail)==null?void 0:D.length)>0){const he=s.CarDetail.find(we=>we.id===s.inspection.car_id);he&&ue(he)}else!((H=s.inspection)!=null&&H.car_id)&&((N=s.inspection)!=null&&N.car_name)&&(h.value=s.inspection.car_name,d.car_id=null);window.addEventListener("keydown",C),x("update:hasUnsavedChanges",Ce.value),x("update:validation",de.value)}),it(()=>{window.removeEventListener("keydown",C)});const ee=y=>{if(!y){g.value="",S.value="",V.value="";return}const v=y.toUpperCase().trim(),D=v.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(D)g.value=D[1]||"",S.value=D[2]||"",V.value=D[3]||"";else{let H="area",N="",he="",we="";for(const xe of v)H==="area"&&/[A-Z]/.test(xe)?N+=xe:H==="area"&&/[0-9]/.test(xe)?(H="number",he+=xe):H==="number"&&/[0-9]/.test(xe)?he+=xe:H==="number"&&/[A-Z]/.test(xe)?(H="suffix",we+=xe):H==="suffix"&&/[A-Z]/.test(xe)&&(we+=xe);g.value=N,S.value=he,V.value=we}Y()},Y=()=>{const y=`${g.value}${S.value}${V.value}`;d.plate_number=y,b()},T=y=>{y==="area"?g.value=g.value.toUpperCase().replace(/[^A-Z]/g,""):y==="number"?S.value=S.value.replace(/[^0-9]/g,""):y==="suffix"&&(V.value=V.value.toUpperCase().replace(/[^A-Z]/g,"")),Y()},M=oe(()=>{const y=d.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(y)}),F=oe(()=>!h.value||h.value.trim()===""),G=oe(()=>d.plate_number.length>0&&!M.value?"Format plat nomor tidak valid.":null),de=oe(()=>{const y=!d.plate_number||d.plate_number.trim()==="",v=!h.value||h.value.trim()==="";return y||v||!M.value||k.value}),Ce=oe(()=>{const y=d.plate_number!==m.value,v=d.car_id!==p.value||h.value!==l.value;return y||v}),ke=oe(()=>Ce.value&&!de.value),R=y=>{var D,H,N;if(!y)return"";const v=[];return(D=y.brand)!=null&&D.name&&v.push(y.brand.name),(H=y.model)!=null&&H.name&&v.push(y.model.name),(N=y.type)!=null&&N.name&&v.push(y.type.name),y.cc&&v.push((y.cc/1e3).toFixed(1)),y.transmission&&v.push(y.transmission),y.year&&v.push(y.year.toString()),y.fuel_type&&v.push(y.fuel_type),y.production_period&&v.push(`(${y.production_period})`),v.join(" ")},O=()=>{d.car_id&&(d.car_id=null,_.value=null,E.value=[]),se()},se=jt.debounce(()=>{if(!h.value.trim()){$.value=[],I.value=!1;return}a.value=!0;try{const y=h.value.toLowerCase().trim();$.value=s.CarDetail.filter(v=>R(v).toLowerCase().includes(y)),I.value=!0}finally{a.value=!1}},300),le=()=>{setTimeout(()=>{I.value=!1,d.car_name=h.value,b()},200)},ue=async y=>{_.value=y,h.value=R(y),d.car_id=y.id,d.car_name=R(y),I.value=!1,await re(y.id),b(),x("update:hasUnsavedChanges",Ce.value),x("update:validation",de.value)},ce=y=>!y||!y.file_path?"":`/storage/${y.file_path}`,re=async y=>{try{const v=await fetch(`/api/cars/${y}/images`);if(v.ok){const D=await v.json();E.value=Array.isArray(D)?D:[]}else E.value=[]}catch(v){console.error("Error loading car images:",v),E.value=[]}},be=y=>{U.value=y,K.value=!0,document.body.style.overflow="hidden"},L=()=>{K.value=!1,document.body.style.overflow=""},fe=()=>{U.value=(U.value+1)%E.value.length},u=()=>{U.value=(U.value-1+E.value.length)%E.value.length},C=y=>{if(K.value)switch(y.key){case"Escape":L();break;case"ArrowRight":fe();break;case"ArrowLeft":u();break}},b=()=>{const y={plate_number:d.plate_number,car_id:d.car_id,car_name:d.car_name};x("update-vehicle",y)},q=()=>{s.inspection&&d.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0,onSuccess:()=>{m.value=d.plate_number,p.value=d.car_id,l.value=d.car_name,x("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:y=>{console.error("Gagal menyimpan data:",y)}})};return ye([()=>d.plate_number,()=>d.car_name],y=>{A.value="",k.value=!1,Z.value="";const v=y[0];if(v&&v.length>=6){const D=s.allInspections.filter(H=>{var N;return H.plate_number===v&&H.id!==((N=s.inspection)==null?void 0:N.id)});if(D.length>0){const H=["draft","in_progress","pending","pending_review","revision"],N=D.find(he=>H.includes(he.status));if(N)k.value=!0,A.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${N.status.replace(/_/g," ").toUpperCase()}.`;else{const he=D.filter(we=>["approved","rejected","completed","cancelled"].includes(we.status));if(he.length>0){he.sort((xe,Re)=>new Date(Re.created_at)-new Date(xe.created_at));const we=he[0];if(we.car_id){const xe=s.CarDetail.find(Re=>Re.id===we.car_id);xe&&ue(xe)}else we.car_name&&(h.value=we.car_name,d.car_name=we.car_name,d.car_id=null);Z.value=`Nomor plat ini sudah pernah diperiksa ${he.length} kali sebelumnya.`}}}}x("update:hasUnsavedChanges",Ce.value),x("update:validation",de.value)},{deep:!0}),(y,v)=>{var D;return o(),n("div",as,[v[21]||(v[21]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(o(),n("div",os,[e("div",ns,[v[9]||(v[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),e("div",is,[Ne(e("input",{"onUpdate:modelValue":v[0]||(v[0]=H=>g.value=H),type:"text",placeholder:"Contoh: B",class:te(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||k.value}]),onInput:v[1]||(v[1]=H=>T("area")),maxlength:"2"},null,34),[[Ze,g.value]]),Ne(e("input",{"onUpdate:modelValue":v[2]||(v[2]=H=>S.value=H),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:te(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||k.value}]),onInput:v[3]||(v[3]=H=>T("number")),maxlength:"4"},null,34),[[Ze,S.value]]),Ne(e("input",{"onUpdate:modelValue":v[4]||(v[4]=H=>V.value=H),type:"text",placeholder:"ABC",class:te(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||k.value}]),onInput:v[5]||(v[5]=H=>T("suffix")),maxlength:"3"},null,34),[[Ze,V.value]])]),G.value?(o(),n("span",ls,B(G.value),1)):c("",!0),A.value?(o(),n("span",rs,B(A.value),1)):c("",!0),Z.value?(o(),n("span",ds,B(Z.value),1)):c("",!0)]),e("div",us,[v[13]||(v[13]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",cs,[Ne(e("input",{"onUpdate:modelValue":v[6]||(v[6]=H=>h.value=H),type:"text",placeholder:"Cari atau ketik nama mobil...",class:te(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":F.value}]),onInput:O,onFocus:v[7]||(v[7]=H=>I.value=!0),onBlur:le},null,34),[[Ze,h.value]]),a.value?(o(),n("div",gs,v[10]||(v[10]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),F.value?(o(),n("span",ms,"Nama mobil tidak boleh kosong.")):c("",!0),!J(d).car_id&&h.value?(o(),n("div",ps,v[11]||(v[11]=[Gt('<div class="flex items-start" data-v-1fd1424d><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-1fd1424d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-1fd1424d></path></svg><div data-v-1fd1424d><p class="text-yellow-800 font-medium mb-1" data-v-1fd1424d>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-1fd1424d> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-1fd1424d>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-1fd1424d> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-1fd1424d> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-1fd1424d>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-1fd1424d>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):c("",!0),I.value?(o(),n("div",vs,[$.value.length>0?(o(),n("div",fs,[(o(!0),n(_e,null,Me($.value,H=>(o(),n("div",{key:H.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:N=>ue(H)},[e("div",bs,B(R(H)),1),e("div",xs,B(H.year)+" • "+B(H.cc)+"cc • "+B(H.transmission)+" • "+B(H.fuel_type),1)],40,hs))),128))])):(o(),n("div",ys,v[12]||(v[12]=[$e(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),$e(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),J(d).car_id&&_.value?(o(),n("div",ws,[_.value.description?(o(),n("div",ks,[v[14]||(v[14]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:_.value.description},null,8,$s)])):c("",!0),E.value.length>0?(o(),n("div",Cs,[v[15]||(v[15]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",Is,[(o(!0),n(_e,null,Me(E.value,(H,N)=>(o(),n("div",{key:H.id||N,class:"relative group cursor-pointer",onClick:he=>be(N)},[e("img",{src:ce(H),alt:H.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Vs),H.note?(o(),n("div",_s,[e("p",Ms,B(H.note),1)])):c("",!0)],8,Ss))),128))])])):(o(),n("div",Us," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),K.value?(o(),n("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:L},[e("div",Ds,[e("button",{onClick:L,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},v[16]||(v[16]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),E.value.length>1?(o(),n("button",{key:0,onClick:at(u,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},v[17]||(v[17]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),E.value.length>1?(o(),n("button",{key:1,onClick:at(fe,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},v[18]||(v[18]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),e("img",{src:ce(E.value[U.value]),alt:"Car Image "+(U.value+1),class:"max-w-full max-h-full object-contain",onClick:v[8]||(v[8]=at(()=>{},["stop"]))},null,8,js),E.value.length>1?(o(),n("div",Ts,B(U.value+1)+" / "+B(E.value.length),1)):c("",!0),(D=E.value[U.value])!=null&&D.note?(o(),n("div",Ns,B(E.value[U.value].note),1)):c("",!0)])])):c("",!0),Ve(ts,{type:"button",onClick:q,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!ke.value},{default:qe(()=>[J(d).processing?(o(),n("svg",Ls,v[19]||(v[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,B(J(d).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),Ve(ss,{on:J(d).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:qe(()=>v[20]||(v[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),$e(" Tersimpan. ")])),_:1,__:[20]},8,["on"])]),_:1},8,["disabled"])])):c("",!0)])}}},Bs=Ee(qs,[["__scopeId","data-v-1fd1424d"]]),As={class:"mt-1"},Es=["value","required","minlength","maxlength","allowSpace","placeholder"],Rs={key:0,class:"mt-2 text-sm text-red-600"},Tt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,x=Q,d=oe(()=>{if(!s.modelValue)return"";let p=s.modelValue;switch(s.allowSpace||(p=p.replace(/\s+/g,"")),s.textTransform){case"uppercase":return p.toUpperCase();case"lowercase":return p.toLowerCase();case"capitalize":return p.replace(/\b\w/g,l=>l.toUpperCase());default:return p}}),m=p=>{let l=p.target.value;switch(s.allowSpace||(l=l.replace(/\s+/g,"")),s.textTransform){case"uppercase":l=l.toUpperCase();break;case"lowercase":l=l.toLowerCase();break;case"capitalize":l=l.replace(/\b\w/g,g=>g.toUpperCase());break}x("update:modelValue",l),x("save",s.pointId)};return(p,l)=>(o(),n("div",As,[e("input",{value:d.value,onInput:m,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:te(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,Es),t.error?(o(),n("p",Rs,B(t.error),1)):c("",!0)]))}},Fs={class:"mt-1"},zs=["value","required","min","max","step","placeholder"],Os={key:0,class:"mt-2 text-sm text-red-600"},Nt={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,x=Q,d=m=>{const p=m.target.value;x("update:modelValue",p),x("save",s.pointId)};return(m,p)=>(o(),n("div",Fs,[e("input",{value:t.modelValue,onInput:d,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,zs),t.error?(o(),n("p",Os,B(t.error),1)):c("",!0)]))}},Hs={class:"mt-1"},Ks=["value","required","min","max"],Ws={key:0,class:"mt-2 text-sm text-red-600"},Lt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,x=Q,d=m=>{x("update:modelValue",m.target.value),x("save",s.pointId)};return(m,p)=>(o(),n("div",Hs,[e("input",{value:t.modelValue,onChange:d,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ks),t.error?(o(),n("p",Ws,B(t.error),1)):c("",!0)]))}},Zs={class:"mt-1"},Gs=["value","required","placeholder"],Ps={key:0,class:"mt-2 text-sm text-red-600"},qt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,x=Q,d=w(""),m=oe(()=>{var V,k,A,Z;return{currency_symbol:((V=s.settings)==null?void 0:V.currency_symbol)||"Rp",thousands_separator:((k=s.settings)==null?void 0:k.thousands_separator)||",",min_value:((A=s.settings)==null?void 0:A.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((Z=s.settings)==null?void 0:Z.max_value)!==void 0?Number(s.settings.max_value):1e9}}),p=V=>{if(V==null||V==="")return"";const k=Number(V);if(isNaN(k))return"";let A=k.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return m.value.thousands_separator!==","&&(A=A.replace(/,/g,m.value.thousands_separator)),A},l=V=>V?V.replace(/[^\d]/g,""):"",g=oe(()=>d.value?`${m.value.currency_symbol} ${p(d.value)}`:""),S=V=>{let k=l(V.target.value),A=Number(k);m.value.min_value!==void 0&&A<m.value.min_value&&(k=m.value.min_value.toString()),m.value.max_value!==void 0&&A>m.value.max_value&&(k=m.value.max_value.toString()),d.value=k,x("update:modelValue",k),x("save",s.pointId)};return ye(()=>s.modelValue,V=>{V!=null&&(d.value=V.toString())},{immediate:!0}),(V,k)=>(o(),n("div",Zs,[e("input",{value:g.value,onInput:S,type:"text",required:t.required,placeholder:t.placeholder,class:te(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,Gs),t.error?(o(),n("p",Ps,B(t.error),1)):c("",!0)]))}},Js={class:"mt-1 space-y-3"},Xs={key:0,class:"space-y-2"},Ys={class:"flex flex-wrap gap-2"},Qs=["onClick"],ea=["value","required","minlength","maxlength","placeholder"],ta={class:"flex justify-between items-center mt-1"},sa={class:"text-xs text-gray-500"},aa={key:0,class:"text-xs text-red-600"},Bt={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,x=Q,d=w([]),m=w(""),p=V=>d.value.some(k=>k.value===V),l=V=>{p(V.value)?d.value=d.value.filter(h=>h.value!==V.value):d.value.push(V);const A=[...d.value.map(h=>h.value)];m.value.trim()&&A.push(m.value.trim());const Z=A.join(", ");x("update:modelValue",Z),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:Z})},g=V=>{const k=V.target.value;x("update:modelValue",k),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:k}),S(k)},S=V=>{var h,I,a,$;if(!V){d.value=[],m.value="";return}const k=V.split(",").map(_=>_.trim()).filter(_=>_),A=((I=(h=s.settings)==null?void 0:h.damage_options)==null?void 0:I.map(_=>_.value))||[];d.value=(($=(a=s.settings)==null?void 0:a.damage_options)==null?void 0:$.filter(_=>k.includes(_.value)))||[];const Z=k.filter(_=>!A.includes(_));m.value=Z.join(", ")};return ye(()=>s.modelValue,V=>{V!=null&&S(V)},{immediate:!0}),(V,k)=>{var A,Z,h;return o(),n("div",Js,[(A=t.settings)!=null&&A.enable_damage&&((Z=t.settings)!=null&&Z.damage_options)?(o(),n("div",Xs,[k[0]||(k[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",Ys,[(o(!0),n(_e,null,Me(t.settings.damage_options,(I,a)=>(o(),n("button",{key:a,type:"button",onClick:$=>l(I),class:te(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":p(I.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!p(I.value)}])},B(I.label),11,Qs))),128))])])):c("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:g,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,ea),e("div",ta,[e("span",sa,B(((h=t.modelValue)==null?void 0:h.length)||0)+"/"+B(t.maxLength||400),1),t.error?(o(),n("p",aa,B(t.error),1)):c("",!0)])])])}}},oa={class:"mt-1"},na=["value","required"],ia={key:0,class:"mt-2 text-sm text-red-600"},la={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,x=Q,d=m=>{x("update:modelValue",m.target.value),x("save",s.pointId)};return(m,p)=>(o(),n("div",oa,[e("select",{value:t.modelValue,onChange:d,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},p[0]||(p[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,na),t.error?(o(),n("p",ia,B(t.error),1)):c("",!0)]))}},ra=Ee(la,[["__scopeId","data-v-1b6c0201"]]),da={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},ua={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},ca={class:"text-xs text-gray-500 mt-2 text-center"},ga={class:"flex flex-row space-x-4 mb-6"},ma={class:"mt-4 text-right"},pa={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(Q,s)=>t.show?(o(),n("div",da,[e("div",ua,[s[7]||(s[7]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),e("p",ca,[s[3]||(s[3]=$e("Ambil Foto Maksimal: ")),e("b",null,B(t.settings.max_files),1),s[4]||(s[4]=$e(" Dengan Rasio & Ukuran: ")),e("b",null,B(t.settings.camera_aspect_ratio),1)]),e("div",ga,[e("button",{onClick:s[0]||(s[0]=x=>Q.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:s[1]||(s[1]=x=>Q.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",ma,[e("button",{onClick:s[2]||(s[2]=x=>Q.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):c("",!0)}},va={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},fa={class:"webcam-content-box"},ha={class:"webcam-header"},ba={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},xa={class:"inspection-point-name"},ya={key:0,class:"screen-flash-overlay"},wa={key:2,class:"zoom-controls"},ka=["max"],$a={class:"webcam-footer"},Ca={class:"camera-controls"},Ia=["disabled"],Sa={class:"camera-icon-container"},Va={key:0,class:"camera-spinner"},_a={key:1,class:"camera-body"},Ma={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:Q}){const s=t,x=Q,d=w(null),m=w(null);let p=null,l=null;const g=w("environment"),S=w(!1),V=w(!1),k=w(!1),A=w(!1),Z=w(!1),h=w({}),I=w(!1),a=w(1),$=w(1),_=w(!1),E=oe(()=>{var R;return((R=s.settings)==null?void 0:R.max_size)||2048}),K=oe(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),U=oe(()=>{if(!s.aspectRatio)return{};const R=s.aspectRatio,O=R>1?80:60,se=R>1?80/R:60*R;return{width:`${O}%`,height:`${se}%`}}),ee=async()=>{p&&p.getTracks().forEach(R=>R.stop());try{const R={facingMode:g.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};p=await navigator.mediaDevices.getUserMedia({video:R,audio:!1}),l=p.getVideoTracks()[0],d.value.srcObject=p,d.value.onloadedmetadata=async()=>{await T(),await d.value.play()}}catch(R){console.error("Error accessing camera: ",R),alert("Failed to access camera. Please allow camera permission."),x("close")}},Y=()=>{p&&p.getTracks().forEach(R=>R.stop()),x("close")},T=async()=>{if(l)try{const R=await navigator.mediaDevices.enumerateDevices();S.value=R.filter(se=>se.kind==="videoinput").length>1;const O=l.getCapabilities();O.zoom?(_.value=!0,$.value=O.zoom.max,console.log(`Zoom supported. Max zoom: ${$.value}`)):(_.value=!1,console.warn("Zoom is not supported by this camera.")),V.value=O.torch||O.fillLightMode&&O.fillLightMode.includes("torch")}catch(R){console.error("Error checking camera capabilities:",R)}},M=async R=>{if(!l)return;const O=d.value.getBoundingClientRect(),se=R.clientX-O.left,le=R.clientY-O.top;Z.value=!0,h.value={left:`${se}px`,top:`${le}px`,transform:"translate(-50%, -50%)"};try{if(l.getCapabilities().pointsOfInterest){const ce=se/O.width,re=le/O.height;await l.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:ce,y:re}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(ue){console.warn("Manual focus failed:",ue)}setTimeout(()=>{Z.value=!1,l.getCapabilities().focusMode.includes("continuous")&&l.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},F=async R=>{if(!l||!_.value)return;const O=Math.min(Math.max(R,1),$.value);a.value=O;try{await l.applyConstraints({advanced:[{zoom:O}]})}catch(se){console.error("Failed to set zoom:",se)}},G=async()=>{if(!(!l||!V.value))try{g.value==="user"?(k.value=!k.value,A.value=k.value):(await l.applyConstraints({advanced:[{torch:!k.value}]}),k.value=!k.value)}catch(R){console.error("Flash toggle failed:",R)}},de=async()=>{S.value&&(g.value=g.value==="environment"?"user":"environment",p&&p.getTracks().forEach(R=>R.stop()),await ee())},Ce=async R=>new Promise(O=>{const se=E.value*1024;if(R.size<=se){O(R);return}const le=new Image,ue=new FileReader;ue.onload=ce=>{le.onload=()=>{const re=document.createElement("canvas"),be=re.getContext("2d"),L=Math.sqrt(se/R.size);re.width=le.width*L,re.height=le.height*L,be.drawImage(le,0,0,re.width,re.height);let fe=.9;const u=()=>{re.toBlob(C=>{C.size>se&&fe>.1?(fe-=.1,u()):O(C)},"image/jpeg",fe)};u()},le.src=ce.target.result},ue.readAsDataURL(R)}),ke=async()=>{if(!(I.value||!d.value||!m.value)){I.value=!0;try{const R=d.value,O=m.value,se=R.videoWidth,le=R.videoHeight;let ue,ce,re,be;se/le>s.aspectRatio?(ce=le,ue=le*s.aspectRatio,re=(se-ue)/2,be=0):(ue=se,ce=se/s.aspectRatio,re=0,be=(le-ce)/2),O.width=ue,O.height=ce,O.getContext("2d").drawImage(R,re,be,ue,ce,0,0,ue,ce);const fe=await new Promise(C=>{O.toBlob(C,"image/jpeg",1)}),u=await Ce(fe);if(u){const C=new File([u],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});x("photoCaptured",C),A.value=!0,setTimeout(()=>{A.value=!1},100)}}catch(R){console.error("Error capturing photo:",R),alert("Failed to capture photo. Please try again.")}finally{I.value=!1}}};return ye(()=>s.show,R=>{R?ee():Y()}),it(()=>{p&&p.getTracks().forEach(R=>R.stop())}),(R,O)=>{var se;return t.show?(o(),n("div",va,[e("div",fa,[e("div",ha,[e("p",ba,B(t.settings.camera_aspect_ratio),1),e("div",xa,B(((se=t.point)==null?void 0:se.name)||"Camera"),1),e("button",{onClick:Y,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},O[2]||(O[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:Ae(K.value),onClick:M,onTouchstart:M},[e("video",{ref_key:"webcamVideo",ref:d,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:m,class:"hidden"},null,512),A.value?(o(),n("div",ya)):c("",!0),e("div",{class:"aspect-ratio-guide",style:Ae(U.value)},null,4),Z.value?(o(),n("div",{key:1,class:"focus-indicator",style:Ae(h.value)},O[3]||(O[3]=[e("div",{class:"focus-ring"},null,-1)]),4)):c("",!0),O[4]||(O[4]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),_.value?(o(),n("div",wa,[Ne(e("input",{type:"range",min:"1",max:$.value,step:"0.1","onUpdate:modelValue":O[0]||(O[0]=le=>a.value=le),onInput:O[1]||(O[1]=le=>F(parseFloat(le.target.value))),class:"zoom-slider"},null,40,ka),[[Ze,a.value]])])):c("",!0)],36),e("div",$a,[e("div",Ca,[t.settings.enable_flash&&V.value?(o(),n("button",{key:0,onClick:G,class:te(["control-button",{active:k.value,disabled:!V.value}])},O[5]||(O[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):c("",!0),e("button",{onClick:ke,class:"capture-button",disabled:I.value},[e("div",Sa,[I.value?(o(),n("div",Va)):(o(),n("div",_a,O[6]||(O[6]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,Ia),t.settings.enable_camera_switch&&S.value?(o(),n("button",{key:1,onClick:de,class:"control-button"},O[7]||(O[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):c("",!0)])])])])):c("",!0)}}},Ua=Ee(Ma,[["__scopeId","data-v-d307c818"]]),Da={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},ja={class:"w-full h-full flex flex-col"},Ta={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Na=["disabled"],La={class:"text-lg font-semibold"},qa={class:"flex items-center gap-2"},Ba=["disabled"],Aa=["disabled"],Ea={key:0,class:"bg-blue-900 bg-opacity-50 text-white p-3"},Ra={class:"flex items-center justify-between mb-2"},Fa={class:"text-xs"},za={class:"w-full bg-blue-700 bg-opacity-50 rounded-full h-2"},Oa={class:"text-xs mt-1 text-blue-300"},Ha={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Ka=["src"],Wa={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Za=["disabled"],Ga=["disabled"],Pa={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Ja={class:"flex justify-between items-center w-full"},Xa=["disabled"],Ya={key:1,class:"flex-1"},Qa=["disabled"],eo={class:"flex gap-3 w-full"},to={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},so={class:"flex items-center gap-2"},ao={key:0,class:"text-center"},oo={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(t,{emit:Q}){const s=t,x=Q,d=w(0),m=w([]),p=oe(()=>m.value.length>0?m.value[d.value]:null);ye(()=>s.images,a=>{m.value=a.map($=>({...$,rotation:$.rotation||0})),a.length===0&&s.show&&A()},{deep:!0,immediate:!0}),ye(()=>s.show,a=>{a&&s.images.length>0&&(d.value=s.initialIndex)}),ye(()=>s.uploadProgress,a=>{a===100&&console.log("Upload completed")});const l=a=>a.preview||(a.image_path?`/${a.image_path}`:""),g=()=>{if(p.value&&!s.isUploading){const a=(p.value.rotation+90)%360;m.value[d.value].rotation=a,x("update:images",m.value)}},S=()=>{s.isUploading||(d.value=d.value<m.value.length-1?d.value+1:0)},V=()=>{s.isUploading||(d.value=d.value>0?d.value-1:m.value.length-1)},k=()=>{s.isUploading||x("saveImages",m.value)},A=()=>{s.isUploading||x("close")},Z=()=>{if(p.value&&!s.isUploading){const a=p.value,$=m.value.findIndex(_=>_.isNew&&a.isNew&&_.preview===a.preview||!_.isNew&&!a.isNew&&_.id===a.id);$!==-1&&(x("removePreviewImage",a),m.value.splice($,1),x("update:images",m.value)),d.value>=m.value.length&&(d.value=Math.max(0,m.value.length-1)),m.value.length===0&&x("close")}},h=()=>{s.isUploading||x("triggerAddMorePhotos")},I=a=>{a.key==="Escape"&&!s.isUploading&&A()};return Ge(()=>{document.addEventListener("keydown",I)}),it(()=>{document.removeEventListener("keydown",I)}),(a,$)=>{var _;return t.show?(o(),n("div",Da,[e("div",ja,[e("div",Ta,[e("button",{onClick:A,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},$[0]||($[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Na),e("div",La,B(((_=t.point)==null?void 0:_.name)||"Preview")+" ("+B(d.value+1)+"/"+B(m.value.length)+") ",1),e("div",qa,[p.value&&p.value.isNew?(o(),n("button",{key:0,onClick:Z,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:t.isUploading},$[1]||($[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,Ba)):c("",!0),p.value&&p.value.isNew?(o(),n("button",{key:1,onClick:g,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},$[2]||($[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,Aa)):c("",!0)])]),t.isUploading?(o(),n("div",Ea,[e("div",Ra,[$[3]||($[3]=e("span",{class:"text-sm font-medium"},"Mengupload gambar...",-1)),e("span",Fa,B(t.uploadProgress)+"%",1)]),e("div",za,[e("div",{class:"bg-blue-400 h-2 rounded-full transition-all duration-300",style:Ae({width:t.uploadProgress+"%"})},null,4)]),e("p",Oa,B(t.currentUpload)+"/"+B(t.totalUpload)+" gambar terupload",1)])):c("",!0),e("div",Ha,[e("div",{class:"relative w-full max-w-full",style:Ae({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"})},[p.value?(o(),n("img",{key:0,src:l(p.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Ae({transform:`rotate(${p.value.rotation}deg)`})},null,12,Ka)):c("",!0),p.value&&p.value.isUploading?(o(),n("div",Wa,$[4]||($[4]=[e("div",{class:"text-center text-white"},[e("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e("p",{class:"text-sm"},"Mengupload...")],-1)]))):c("",!0)],4),m.value.length>1&&!t.isUploading?(o(),n("button",{key:0,onClick:V,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},$[5]||($[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,Za)):c("",!0),m.value.length>1&&!t.isUploading?(o(),n("button",{key:1,onClick:S,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},$[6]||($[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,Ga)):c("",!0)]),e("div",Pa,[e("div",Ja,[p.value&&!p.value.isNew?(o(),n("button",{key:0,onClick:Z,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},$[7]||($[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),$e(" Hapus Foto ")]),8,Xa)):(o(),n("div",Ya)),t.allowMultiple&&m.value.length<t.maxFiles&&!t.isUploading?(o(),n("button",{key:2,onClick:h,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},$[8]||($[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),$e(" Tambah Foto ")]),8,Qa)):c("",!0)]),e("div",eo,[t.isUploading?(o(),n("button",to,[e("div",so,[$[9]||($[9]=e("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),e("span",null,"Mengupload... "+B(t.uploadProgress)+"%",1)])])):(o(),n("button",{key:0,onClick:k,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),t.isUploading?(o(),n("div",ao,$[10]||($[10]=[e("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):c("",!0)])])])):c("",!0)}}},no=Ee(oo,[["__scopeId","data-v-2a7c58b1"]]),io=["accept","multiple","disabled"],lo={class:"text-xs text-gray-500 mb-2"},ro=["disabled"],uo={class:"h-full flex flex-col items-center justify-center p-4 text-center"},co={class:"text-xs text-gray-400 mt-1"},go={key:0,class:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},mo={class:"flex items-center justify-between mb-2"},po={class:"text-xs text-blue-600"},vo={class:"w-full bg-blue-200 rounded-full h-2"},fo={class:"text-xs text-blue-600 mt-1"},ho={key:1,class:"flex items-center gap-4"},bo=["src"],xo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},yo=["disabled"],wo={key:2,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ko=["disabled"],$o=["onClick"],Co=["src"],Io={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},So={key:0},Vo={key:1,class:"ml-1"},_o={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Mo={key:2,class:"mt-1 text-xs text-red-600"},Uo={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(t,{emit:Q}){const s=t,x=Q,d=w(null),m=w(null),p=w(!1),l=w(!1),g=w(!1),S=w([]),V=w(0),k=w(!1),A=w(0),Z=w(0),h=w(0),I=Pt("imageSourceSetting",w("all")),a=`inspection-${s.inspectionId}-point-${s.pointId}-backup`,$=oe(()=>Number(s.settings.max_files)>1),_=oe(()=>s.settings.allowed_types.map(u=>`.${u}`).join(", ")),E=oe(()=>{const u=s.settings.camera_aspect_ratio.split(":");if(u.length===2){const C=parseFloat(u[0]),b=parseFloat(u[1]);if(!isNaN(C)&&!isNaN(b)&&b!==0)return C/b}return 3/4}),K=oe(()=>{const u=[],C=new Set;for(const b of s.modelValue)b.id&&C.add(b.id),u.push({...b,rotation:b.rotation||0,isNew:!1,isUploaded:!0,preview:b.preview||(b.image_path?`/${b.image_path}`:null)});for(const b of S.value)b.id&&C.add(b.id),u.push({...b,isUploading:b.isUploading||!1});return u}),U=u=>u.preview||(u.image_path?`/${u.image_path}`:""),ee=()=>{g.value&&(g.value=!1),I.value==="camera"?T():I.value==="gallery"?Y():p.value=!0},Y=()=>{p.value=!1,d.value.click()},T=()=>{p.value=!1,l.value=!0},M=()=>{p.value=!1,K.value.length>0&&(g.value=!0)},F=()=>{l.value=!1,K.value.length>0&&(g.value=!0)},G=()=>{g.value=!1,k.value||(S.value.forEach(u=>{u.preview&&u.preview.startsWith("blob:")&&URL.revokeObjectURL(u.preview)}),S.value=[])},de=u=>new Promise(C=>{const b=new FileReader;b.onload=q=>{const W=new Image;W.onload=()=>{C({file:u,preview:URL.createObjectURL(u),rotation:0,width:W.naturalWidth,height:W.naturalHeight,isNew:!0})},W.onerror=()=>{console.error("Failed to load image for dimensions:",u.name),C({file:u,preview:URL.createObjectURL(u),rotation:0,width:0,height:0,isNew:!0})},W.src=q.target.result},b.readAsDataURL(u)}),Ce=u=>{const C=u.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(C)},ke=async u=>{const b=(s.settings.max_size||2048)*1024;return new Promise(q=>{const W=new Image,ge=new FileReader;ge.onload=ne=>{W.onload=()=>{const P=document.createElement("canvas"),ie=P.getContext("2d"),pe=Math.max(W.width,W.height);P.width=pe,P.height=pe,ie.fillStyle="white",ie.fillRect(0,0,pe,pe);const y=(pe-W.width)/2,v=(pe-W.height)/2;ie.drawImage(W,y,v,W.width,W.height);let D=.9;const H=()=>{P.toBlob(N=>{if(N.size>b&&D>.1)D-=.1,H();else{const he=new File([N],u.name,{type:"image/jpeg",lastModified:Date.now()});q(he)}},"image/jpeg",D)};H()},W.src=ne.target.result},ge.readAsDataURL(u)})},R=async u=>{const C=Array.from(u.target.files);if(!C.length){p.value=!1,K.value.length>0&&(g.value=!0);return}try{const b=C.filter(ie=>!Ce(ie));if(b.length>0){const ie=b.map(pe=>pe.name.split(".").pop()).join(", ");alert(`File type not allowed: ${ie}. Allowed types: ${s.settings.allowed_types.join(", ")}`),u.target.value="";return}const q=K.value.length,W=s.settings.max_files-q,ge=await Promise.all(C.slice(0,W).map(async ie=>await ke(ie))),ne=await Promise.all(ge.map(de)),P=$.value?ne:ne.slice(0,1);$.value?S.value.push(...P):(S.value.forEach(ie=>{ie.preview&&ie.preview.startsWith("blob:")&&URL.revokeObjectURL(ie.preview)}),S.value=P),p.value=!1,P.length>0?(V.value=Math.max(0,K.value.length-P.length),g.value=!0):K.value.length>0&&(g.value=!0),u.target.value=""}catch(b){console.error("Error processing selected images:",b),alert("Failed to process selected images. Please try again."),p.value=!1,K.value.length>0&&(g.value=!0)}},O=async u=>{const C=K.value.length;if(!$.value||C<s.settings.max_files)try{const b=await ke(u),q=new Image;q.onload=()=>{const W={file:b,preview:URL.createObjectURL(b),rotation:0,width:q.naturalWidth,height:q.naturalHeight,isNew:!0};$.value?S.value.push(W):(S.value.forEach(ge=>{ge.preview&&ge.preview.startsWith("blob:")&&URL.revokeObjectURL(ge.preview)}),S.value=[W]),l.value=!1,p.value=!1,V.value=K.value.length-1,g.value=!0},q.src=URL.createObjectURL(b)}catch(b){console.error("Error processing captured image:",b),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),l.value=!1,p.value=!1,K.value.length>0&&(g.value=!0)},se=(u=0)=>{V.value=u,g.value=!0},le=u=>new Promise(C=>{if(u.rotation===0||!m.value){if(!u.isNew&&!u.file){C({file:null,width:u.width,height:u.height,isOriginal:!0});return}C({file:u.file,width:u.width,height:u.height});return}const b=new Image;b.onload=async()=>{try{const q=m.value,W=q.getContext("2d"),ge=b.width,ne=b.height;let P,ie;u.rotation===90||u.rotation===270?(P=ne,ie=ge):(P=ge,ie=ne),q.width=P,q.height=ie,W.clearRect(0,0,q.width,q.height),W.translate(q.width/2,q.height/2),W.rotate(u.rotation*Math.PI/180),W.drawImage(b,-ge/2,-ne/2,ge,ne),W.setTransform(1,0,0,1,0,0);const pe=await new Promise(D=>{q.toBlob(D,"image/jpeg",.9)}),y=new File([pe],u.file?u.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),v=await ke(y);C({file:v,width:P,height:ie})}catch(q){console.error("Error processing rotated image:",q),C({file:u.file,width:u.width,height:u.height})}},b.onerror=()=>{console.error("Failed to load image for rotation processing:",u.preview),C({file:u.file,width:u.width,height:u.height})},b.src=u.preview}),ue=u=>{try{const C={images:u.map(b=>{var q;return{fileName:((q=b.file)==null?void 0:q.name)||`image-${Date.now()}.jpg`,rotation:b.rotation||0,width:b.width||0,height:b.height||0,timestamp:Date.now()}}),inspectionId:s.inspectionId,pointId:s.pointId};localStorage.setItem(a,JSON.stringify(C))}catch(C){console.error("Error saving backup:",C)}},ce=()=>{localStorage.removeItem(a)},re=async u=>{k.value=!0;const C=[],b=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),k.value=!1;return}try{ue(u);for(const q of u){if(!q.isNew&&q.rotation===0&&q.id&&q.image_path){C.push({id:q.id,image_path:q.image_path,width:q.width,height:q.height,rotation:0,preview:q.preview,isUploaded:!0});continue}const{file:W,width:ge,height:ne,isOriginal:P}=await le(q);if(P&&!q.isNew){C.push({id:q.id,image_path:q.image_path,width:q.width,height:q.height,rotation:q.rotation||0,preview:q.preview,isUploaded:!0});continue}W&&b.push({file:W,width:ge,height:ne,rotation:q.rotation||0,originalImage:q})}G(),b.length>0?await be(b,C):(x("update:modelValue",C),x("save",s.pointId))}catch(q){console.error("Error during image processing:",q),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{k.value=!1}},be=async(u,C)=>{var b,q,W,ge;h.value=u.length,Z.value=0,A.value=0;try{const ne=new FormData;ne.append("inspection_id",s.inspectionId),ne.append("point_id",s.pointId),u.forEach((y,v)=>{ne.append("images[]",y.file);const D=S.value.findIndex(H=>{var N;return H.preview===((N=y.originalImage)==null?void 0:N.preview)});D!==-1&&(S.value[D].isUploading=!0)});const ie=(await St.post(route("inspections.upload-image"),ne,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:y=>{y.total&&(A.value=Math.round(y.loaded*100/y.total),Z.value=Math.floor(y.loaded/y.total*u.length))}})).data.images,pe=[...C];for(let y=0;y<ie.length;y++){const v=ie[y],D=(b=u[y])==null?void 0:b.originalImage;pe.push({id:v.image_id,image_path:v.path,width:v.width||(D==null?void 0:D.width)||0,height:v.height||(D==null?void 0:D.height)||0,rotation:((q=u[y])==null?void 0:q.rotation)||0,preview:v.public_url,isUploaded:!0}),D!=null&&D.preview&&D.preview.startsWith("blob:")&&URL.revokeObjectURL(D.preview)}S.value=S.value.filter(y=>!u.some(v=>{var D;return((D=v.originalImage)==null?void 0:D.preview)===y.preview})),x("update:modelValue",pe),x("save",s.pointId),x("uploaded",{pointId:s.pointId,images:pe,newImagesCount:ie.length}),ce(),console.log(`✅ Successfully uploaded ${ie.length} images`)}catch(ne){throw console.error("Error uploading images:",ne),S.value.forEach(P=>{P.isUploading=!1}),(ge=(W=ne.response)==null?void 0:W.data)!=null&&ge.message?alert(`Upload gagal: ${ne.response.data.message}. Data tersimpan secara lokal.`):alert(`Upload gagal: ${ne.message}. Data tersimpan secara lokal.`),ne}finally{A.value=0,Z.value=0,h.value=0}},L=u=>{if(u){if(u.id&&!u.isNew)fe(u);else{const C=S.value.findIndex(b=>b.preview&&b.preview===u.preview&&b.isNew||b.id&&b.id===u.id);if(C!==-1){const b=S.value.splice(C,1)[0];b.preview&&b.preview.startsWith("blob:")&&URL.revokeObjectURL(b.preview)}x("update:modelValue",s.modelValue.filter(b=>!(b.id&&b.id===u.id)&&!(b.preview&&b.preview===u.preview)))}V.value>=K.value.length&&(V.value=Math.max(0,K.value.length-1)),K.value.length===0&&G()}},fe=async u=>{var b,q;if(u.id||u.image_path)try{await St.delete(route("inspections.delete-image"),{data:{image_id:u.id,image_path:u.image_path}})}catch(W){console.error("Error deleting image from server:",W),(q=(b=W.response)==null?void 0:b.data)!=null&&q.message?alert(`Failed to delete image from server: ${W.response.data.message}`):alert(`Failed to delete image from server: ${W.message}`);return}u.preview&&u.preview.startsWith("blob:")&&URL.revokeObjectURL(u.preview);const C=s.modelValue.filter(W=>W.id!==u.id);x("update:modelValue",C),S.value=S.value.filter(W=>W.isNew&&u.isNew?W.preview!==u.preview:W.id!==u.id),x("removeImage",{image:u}),g.value&&K.value.length===0?G():g.value&&V.value>=K.value.length&&(V.value=Math.max(0,K.value.length-1))};return Ge(()=>{try{localStorage.getItem(a)&&console.log("Found backup images, ready for recovery if needed")}catch(u){console.error("Error loading backup:",u)}}),(u,C)=>(o(),n("div",null,[e("input",{ref_key:"galleryInput",ref:d,type:"file",accept:_.value,class:"hidden",onChange:R,multiple:$.value,disabled:k.value},null,40,io),e("canvas",{ref_key:"processingCanvas",ref:m,class:"hidden"},null,512),e("p",lo,"Foto Maksimal: "+B(t.settings.max_files)+" | Rasio: "+B(t.settings.camera_aspect_ratio),1),K.value.length===0?(o(),n("label",{key:0,onClick:ee,class:te(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:k.value},[e("div",uo,[C[2]||(C[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),C[3]||(C[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),e("p",co,"Tipe: "+B(_.value),1)])],8,ro)):(o(),n("div",{key:1,class:te(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[k.value?(o(),n("div",go,[e("div",mo,[C[4]||(C[4]=e("span",{class:"text-sm font-medium text-blue-700"},"Mengupload gambar...",-1)),e("span",po,B(A.value)+"%",1)]),e("div",vo,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Ae({width:A.value+"%"})},null,4)]),e("p",fo,B(Z.value)+"/"+B(h.value)+" gambar terupload",1)])):c("",!0),t.settings.max_files===1?(o(),n("div",ho,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:C[0]||(C[0]=b=>se(0))},[e("img",{src:U(K.value[0]),class:"w-full h-full object-cover"},null,8,bo),K.value[0].isUploading?(o(),n("div",xo,C[5]||(C[5]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0)]),e("button",{onClick:C[1]||(C[1]=at(b=>fe(K.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:k.value},C[6]||(C[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),$e(" Hapus Foto ")]),8,yo)])):(o(),n("div",wo,[$.value&&K.value.length<t.settings.max_files?(o(),n("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:ee,disabled:k.value},C[7]||(C[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,ko)):c("",!0),(o(!0),n(_e,null,Me(K.value,(b,q)=>(o(),n("div",{key:b.id||b.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:W=>se(q)},[e("img",{src:U(b),class:"w-full h-full object-cover"},null,8,Co),b.isNew||b.rotation!==0?(o(),n("div",Io,[b.isNew?(o(),n("span",So,"BARU")):c("",!0),b.rotation!==0?(o(),n("span",Vo,"ROTASI")):c("",!0)])):c("",!0),b.isUploading?(o(),n("div",_o,C[8]||(C[8]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0)],8,$o))),128))]))],2)),t.error?(o(),n("p",Mo,B(t.error),1)):c("",!0),Ve(pa,{show:p.value,settings:t.settings,onClose:M,onOpenWebcam:T,onTriggerGallery:Y},null,8,["show","settings"]),Ve(Ua,{show:l.value,"aspect-ratio":E.value,settings:t.settings,point:t.point,onClose:F,onPhotoCaptured:O},null,8,["show","aspect-ratio","settings","point"]),Ve(no,{show:g.value,images:K.value,point:t.point,"initial-index":V.value,"allow-multiple":$.value,"max-files":t.settings.max_files,"is-uploading":k.value,"aspect-ratio":E.value,"upload-progress":A.value,"current-upload":Z.value,"total-upload":h.value,onClose:G,onSaveImages:re,onRemovePreviewImage:L,onTriggerAddMorePhotos:ee},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},ct=Ee(Uo,[["__scopeId","data-v-5786fae2"]]),Do={key:0,class:"fixed inset-0 z-50 overflow-hidden"},jo={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},To={class:"px-4 pb-2 border-b border-gray-200"},No={class:"text-lg font-semibold text-gray-900"},Lo={key:0,class:"text-sm text-gray-500 mt-1"},qo={class:"flex-1 overflow-y-auto p-4"},Bo={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Ao={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:Q}){const s=Q,x=()=>{s("close")},d=m=>{m.key==="Escape"&&x()};return Ge(()=>{document.addEventListener("keydown",d)}),it(()=>{document.removeEventListener("keydown",d)}),(m,p)=>(o(),Se(nt,{name:"bottom-sheet"},{default:qe(()=>[t.show?(o(),n("div",Do,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:x}),e("div",jo,[p[0]||(p[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",To,[e("h3",No,B(t.title),1),t.subtitle?(o(),n("p",Lo,B(t.subtitle),1)):c("",!0)]),e("div",qo,[Vt(m.$slots,"default",{},void 0,!0)]),m.$slots.footer?(o(),n("div",Bo,[Vt(m.$slots,"footer",{},void 0,!0)])):c("",!0)])])):c("",!0)]),_:3}))}},At=Ee(Ao,[["__scopeId","data-v-d08f0b98"]]),Eo={class:"space-y-4"},Ro={key:0,class:"mt-2"},Fo={key:1,class:"mt-2"},zo={key:2,class:"mt-2"},Oo={key:3,class:"mt-2"},Ho={key:4,class:"mt-2"},Ko={class:"text-sm font-medium text-gray-700 mb-2"},Wo={key:0,class:"text-red-500"},Zo={key:0,class:"text-xs text-red-500"},Go=["name","value","checked"],Po={key:6,class:"space-y-2"},Jo={key:0,class:"text-red-500"},Xo={key:1,class:"text-xs text-red-500"},Yo={key:7,class:"mt-4"},Qo={class:"text-sm font-medium text-gray-700 mb-2"},en={key:0,class:"text-red-500"},tn={key:0,class:"text-xs text-red-500"},sn={class:"flex gap-2"},an=["disabled"],gt={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(t,{emit:Q}){const s=t,x=Q,d=l=>x("hapus",l),m=oe(()=>s.options.find(l=>l.value===s.selectedValue)),p=oe(()=>{var g,S,V,k,A,Z,h;if(s.point.input_type==="text"&&(!((g=s.notesValue)!=null&&g.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((S=s.notesValue)!=null&&S.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((V=s.notesValue)!=null&&V.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!((k=s.notesValue)!=null&&k.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date)||s.point.input_type==="imageTOradio"&&s.imagesValue.length===0||s.options.length&&!s.selectedValue)return!1;const l=m.value;return!(s.showTextarea&&((A=l==null?void 0:l.settings)!=null&&A.show_textarea)&&(!((Z=s.notesValue)!=null&&Z.trim())||l.settings.min_length&&s.notesValue.length<l.settings.min_length||l.settings.max_length&&s.notesValue.length>l.settings.max_length)||s.showImageUpload&&((h=l==null?void 0:l.settings)!=null&&h.show_image_upload)&&(s.imagesValue.length===0||l.settings.max_files&&s.imagesValue.length>l.settings.max_files))});return(l,g)=>(o(),Se(At,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:g[18]||(g[18]=S=>l.$emit("close"))},{footer:qe(()=>[t.selectedPoint?(o(),n("button",{key:0,onClick:g[15]||(g[15]=S=>d(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},g[20]||(g[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),$e(" Hapus Data ")]))):c("",!0),e("div",sn,[e("button",{type:"button",onClick:g[16]||(g[16]=S=>l.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:g[17]||(g[17]=S=>l.$emit("save")),disabled:!p.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,an)])]),default:qe(()=>{var S,V,k,A,Z,h,I,a,$,_,E,K,U,ee,Y,T,M,F,G,de,Ce,ke,R,O,se,le,ue,ce,re,be;return[e("div",Eo,[t.point.input_type==="text"?(o(),n("div",Ro,[Ve(Tt,{"model-value":t.notesValue,required:(S=t.point.settings)==null?void 0:S.is_required,"min-length":(V=t.point.settings)==null?void 0:V.min_length,"max-length":(k=t.point.settings)==null?void 0:k.max_length,allowSpace:(A=t.point.settings)==null?void 0:A.allow_space,textTransform:(Z=t.point.settings)==null?void 0:Z.text_transform,placeholder:((h=t.point.settings)==null?void 0:h.placeholder)||"Masukan text",error:l.error,"onUpdate:modelValue":g[0]||(g[0]=L=>l.$emit("update:notesValue",L)),onSave:g[1]||(g[1]=L=>l.$emit("saveText",L))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):c("",!0),t.point.input_type==="number"?(o(),n("div",Fo,[Ve(Nt,{"model-value":t.notesValue,required:(I=t.point.settings)==null?void 0:I.is_required,min:(a=t.point.settings)==null?void 0:a.min,max:($=t.point.settings)==null?void 0:$.max,step:((_=t.point.settings)==null?void 0:_.step)||1,placeholder:((E=t.point.settings)==null?void 0:E.placeholder)||"Masukan number",error:l.error,"onUpdate:modelValue":g[2]||(g[2]=L=>l.$emit("update:notesValue",L)),onSave:g[3]||(g[3]=L=>l.$emit("saveNumber",L))},null,8,["model-value","required","min","max","step","placeholder","error"])])):c("",!0),t.point.input_type==="account"?(o(),n("div",zo,[Ve(qt,{"model-value":t.notesValue,required:(K=t.point.settings)==null?void 0:K.is_required,placeholder:((U=t.point.settings)==null?void 0:U.placeholder)||"Masukkan nilai",error:l.error,"point-id":t.pointId,settings:t.point.settings,"onUpdate:modelValue":g[4]||(g[4]=L=>l.$emit("update:notesValue",L)),onSave:g[5]||(g[5]=L=>l.$emit("saveAccount",L))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):c("",!0),t.point.input_type==="date"?(o(),n("div",Oo,[Ve(Lt,{"model-value":t.notesValue,required:(ee=t.point.settings)==null?void 0:ee.is_required,"min-date":(Y=t.point.settings)==null?void 0:Y.min_date,"max-date":(T=t.point.settings)==null?void 0:T.max_date,error:l.error,"onUpdate:modelValue":g[6]||(g[6]=L=>l.$emit("update:notesValue",L)),onSave:g[7]||(g[7]=L=>l.$emit("saveDate",L))},null,8,["model-value","required","min-date","max-date","error"])])):c("",!0),t.point.input_type==="imageTOradio"?(o(),n("div",Ho,[e("h4",Ko,[(M=t.point.settings)!=null&&M.required?(o(),n("span",Wo,"*")):c("",!0)]),Ve(ct,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point.inspection_point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":g[8]||(g[8]=L=>l.$emit("update:imagesValue",L)),onSave:g[9]||(g[9]=L=>l.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(F=t.point.settings)!=null&&F.required&&t.imagesValue.length===0?(o(),n("p",Zo," Foto wajib diupload ")):c("",!0)])):c("",!0),t.options.length?(o(),n("div",{key:5,class:te(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(_e,null,Me(t.options,(L,fe)=>(o(),n("label",{key:fe,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:L.value,checked:t.selectedValue===L.value,onChange:g[10]||(g[10]=u=>l.$emit("update:selectedValue",u.target.value)),class:"hidden peer"},null,40,Go),e("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==L.value}])},B(L.label),3)]))),128))],2)):c("",!0),t.showTextarea&&((de=(G=m.value)==null?void 0:G.settings)!=null&&de.show_textarea)?(o(),n("div",Po,[(Ce=m.value.settings)!=null&&Ce.required?(o(),n("span",Jo,"*")):c("",!0),Ve(Bt,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:m.value.settings,required:(ke=m.value.settings)==null?void 0:ke.required,"min-length":(R=m.value.settings)==null?void 0:R.min_length,"max-length":(O=m.value.settings)==null?void 0:O.max_length,placeholder:((se=m.value.settings)==null?void 0:se.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":g[11]||(g[11]=L=>l.$emit("update:notesValue",L)),onSave:g[12]||(g[12]=L=>l.$emit("saveTextarea",L))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(le=m.value.settings)!=null&&le.required&&!t.notesValue?(o(),n("p",Xo," Keterangan wajib diisi ")):c("",!0)])):c("",!0),t.showImageUpload&&((ce=(ue=m.value)==null?void 0:ue.settings)!=null&&ce.show_image_upload)?(o(),n("div",Yo,[e("h4",Qo,[g[19]||(g[19]=$e(" Upload Foto ")),(re=m.value.settings)!=null&&re.required?(o(),n("span",en,"*")):c("",!0)]),Ve(ct,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:m.value.settings,"onUpdate:modelValue":g[13]||(g[13]=L=>l.$emit("update:imagesValue",L)),onSave:g[14]||(g[14]=L=>l.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(be=m.value.settings)!=null&&be.required&&t.imagesValue.length===0?(o(),n("p",tn," Foto wajib diupload ")):c("",!0)])):c("",!0)])]}),_:1},8,["show","title","subtitle"]))}},on={class:"mt-2 space-y-2"},nn=["name","value","checked","onChange","required"],ln={key:0,class:"p-2 rounded-lg bg-gray-50"},rn={key:0,class:"mt-2"},dn={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},un=["src"],cn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},gn={key:1,class:"mt-2"},mn={class:"text-sm text-gray-600"},pn={key:2,class:"mt-2 text-sm text-red-600"},vn={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:Q}){const s=t,x=Q,d=w(s.notes),m=w([...s.images]),p=w(!1),l=w(""),g=w([]),S=w(""),V=w([]),k=oe(()=>s.options.find(U=>U.value===s.modelValue)),A=U=>U.settings&&(U.settings.show_textarea||U.settings.show_image_upload);ye(()=>s.notes,U=>{d.value=U}),ye(()=>s.images,U=>{m.value=[...U]}),ye(()=>s.modelValue,U=>{U&&(S.value=U)});const Z=U=>{x("update:modelValue",U.value),A(U)?I():x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:U.value,notes:"",images:[]})},h=U=>U.preview||(U.image_path?`/${U.image_path}`:U),I=()=>{S.value=s.modelValue,l.value=d.value,g.value=[...m.value],V.value=[...m.value],p.value=!0},a=()=>{l.value="",g.value=[],S.value="",p.value=!1},$=U=>{g.value=U,m.value=[...U],x("update:images",[...U]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:d.value,images:[...U]})},_=U=>{},E=()=>{S.value!==s.modelValue&&x("update:modelValue",S.value),d.value=l.value,x("update:notes",l.value),m.value=[...g.value],x("update:images",[...g.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:S.value,notes:l.value,images:g.value}),p.value=!1},K=U=>{S.value="",l.value="",g.value=[],d.value="",m.value=[],x("update:modelValue",""),x("update:notes",""),x("update:images",[]),x("hapus",U),p.value=!1};return(U,ee)=>{var Y,T,M,F;return o(),n("div",on,[e("div",{class:te(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(_e,null,Me(t.options,(G,de)=>(o(),n("label",{key:de,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:G.value,checked:t.modelValue===G.value,onChange:Ce=>Z(G),class:"hidden peer",required:t.required},null,40,nn),e("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===G.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==G.value}])},B(G.label),3)]))),128))],2),t.modelValue&&k.value&&A(k.value)?(o(),n("div",ln,[e("div",{class:"flex justify-between items-start"},[ee[4]||(ee[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:I,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((Y=k.value.settings)!=null&&Y.show_image_upload)?(o(),n("div",rn,[e("div",dn,[(o(!0),n(_e,null,Me(t.images,(G,de)=>(o(),n("div",{key:de,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:h(G),class:"w-full h-full object-cover rounded"},null,8,un),de===3&&t.images.length>4?(o(),n("span",cn," +"+B(t.images.length-4),1)):c("",!0)]))),128))])])):c("",!0),t.notes&&((T=k.value.settings)!=null&&T.show_textarea)?(o(),n("div",gn,[e("p",mn,B(t.notes),1)])):c("",!0)])):c("",!0),p.value?(o(),Se(gt,{key:(M=t.selectedPoint)==null?void 0:M.id,show:p.value,title:t.pointName||"Detail",subtitle:(F=k.value)==null?void 0:F.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":S.value,"notes-value":l.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":ee[0]||(ee[0]=G=>S.value=G),"onUpdate:notesValue":ee[1]||(ee[1]=G=>l.value=G),"onUpdate:imagesValue":ee[2]||(ee[2]=G=>$(G)),onClose:a,onSave:E,onSaveTextarea:U.handleTextareaSave,onSaveImage:_,onHapus:ee[3]||(ee[3]=G=>K(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):c("",!0),t.error?(o(),n("p",pn,B(t.error),1)):c("",!0)])}}},fn={class:"mt-2 space-y-2"},hn={key:0,class:"flex flex-wrap gap-3"},bn={key:1,class:"p-2"},xn={key:0,class:"mt-2"},yn={class:"flex gap-2 overflow-x-auto scrollbar-hide"},wn=["src"],kn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},$n=["name","value","checked"],Cn={key:1,class:"mt-2"},In={class:"text-sm text-gray-600"},Sn={key:3,class:"mt-2 text-sm text-red-600"},Vn={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:Q}){const s=t,x=Q,d=w(s.notes),m=w([...s.images]),p=w(!1),l=w(""),g=w([]),S=w(""),V=w([]),k=oe(()=>s.options.find(_=>_.value===s.modelValue)),A=_=>_.preview||(_.image_path?`/${_.image_path}`:_);ye(()=>s.notes,_=>{d.value=_});const Z=()=>{S.value=s.modelValue||"",l.value=d.value,g.value=[...m.value],V.value=[...m.value],p.value=!0},h=()=>{l.value="",g.value=[],S.value="",p.value=!1},I=_=>{g.value=_,m.value=[..._],x("update:images",[..._]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:d.value,images:[..._]})},a=()=>{S.value!==s.modelValue&&x("update:modelValue",S.value),d.value=l.value,x("update:notes",l.value),m.value=[...g.value],x("update:images",[...g.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:S.value,notes:l.value,images:g.value}),p.value=!1},$=_=>{S.value="",l.value="",g.value=[],d.value="",m.value=[],x("update:modelValue",""),x("update:notes",""),x("update:images",[]),x("hapus",_),p.value=!1};return(_,E)=>{var K,U,ee;return o(),n("div",fn,[!t.modelValue&&m.value.length===0&&!d.value?(o(),n("div",hn,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:Z},E[4]||(E[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(o(),n("div",bn,[e("div",{class:"flex justify-between items-start"},[E[5]||(E[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:Z,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),m.value.length>0?(o(),n("div",xn,[e("div",yn,[(o(!0),n(_e,null,Me(m.value,(Y,T)=>(o(),n("div",{key:T,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:A(Y),class:"w-full h-full object-cover rounded"},null,8,wn),T===3&&m.value.length>4?(o(),n("span",kn," +"+B(m.value.length-4),1)):c("",!0)]))),128))])])):c("",!0),e("div",{class:te(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(_e,null,Me(t.options,(Y,T)=>(o(),n("label",{key:T,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:Y.value,checked:t.modelValue===Y.value,disabled:!0,class:"hidden peer"},null,8,$n),e("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===Y.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==Y.value}])},B(Y.label),3)]))),128))],2),d.value&&((K=k.value.settings)!=null&&K.show_textarea)?(o(),n("div",Cn,[e("p",In,B(d.value),1)])):c("",!0)])),p.value?(o(),Se(gt,{key:(U=t.selectedPoint)==null?void 0:U.id,show:p.value,title:t.pointName||"Detail",subtitle:(ee=k.value)==null?void 0:ee.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":S.value,"notes-value":l.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":E[0]||(E[0]=Y=>S.value=Y),"onUpdate:notesValue":E[1]||(E[1]=Y=>l.value=Y),"onUpdate:imagesValue":E[2]||(E[2]=Y=>I(Y)),onClose:h,onSave:a,onHapus:E[3]||(E[3]=Y=>$(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):c("",!0),t.error?(o(),n("p",Sn,B(t.error),1)):c("",!0)])}}},_n={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Mn={class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},Un={class:"text-xl font-semibold text-indigo-700"},Dn={class:"p-4 space-y-4"},jn={class:"flex items-start justify-between"},Tn={class:"block text-sm font-medium text-gray-700"},Nn={key:0,class:"text-red-500"},Ln={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},qn={key:0,class:"text-center py-8 text-gray-500"},Bn={key:0,class:"text-xs text-gray-400"},An={__name:"CategoryCadangan",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(t,{emit:Q}){const s=t,x=Q,d=w(!1),m=Jt(),p=oe(()=>(s.category.points||[]).some(h=>h.is_default===!1)),l=oe(()=>{var I;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(I=s.category.points)==null?void 0:I.length}),!s.category.isDamageMenu){const a=(s.category.points||[]).filter($=>{var K;const _=(K=$.inspection_point)==null?void 0:K.id,E=g(_);return d.value||$.is_default||E?!0:(console.log(`Non-damage Point ${_}: is_default=${$.is_default}, hasData=${E}`),!1)});return console.log("Filtered non-damage points:",a),a}const h=(s.category.points||[]).filter(a=>{var E;const $=(E=a.inspection_point)==null?void 0:E.id,_=g($);return d.value||a.is_default||!a.is_default&&_?!0:(console.log(`Damage Point ${$}: hasData=${_}`),_)});return console.log("Filtered damage points:",h),h}),g=h=>{if(!h)return console.log("hasPointData: pointId is null/undefined"),!1;const I=m.props.existingResults[h]!==void 0,a=m.props.existingImages[h]&&m.props.existingImages[h].length>0,$=s.form.results[h]&&(s.form.results[h].status||s.form.results[h].note),_=s.form.images[h]&&s.form.images[h].length>0,E=I||a||$||_;return console.log(`Point ${h} data check:`,{hasServerResult:I,hasServerImages:a,hasLocalResult:$,hasLocalImages:_,finalResult:E}),E},S=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],V=h=>{var $,_,E,K,U,ee,Y,T,M;const I=s.form.results[($=h.inspection_point)==null?void 0:$.id],a=s.form.images[(_=h.inspection_point)==null?void 0:_.id];if(!I)return!1;switch(h.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!I.note;case"select":case"radio":if(!I.status)return!1;const F=(K=(E=h.settings)==null?void 0:E.radios)==null?void 0:K.find(de=>de.value===I.status);return!(F!=null&&F.settings&&(F.settings.show_textarea&&!((U=I.note)!=null&&U.trim())||F.settings.show_image_upload&&(a==null?void 0:a.length)===0));case"imageTOradio":if((a==null?void 0:a.length)===0||!I.status)return!1;const G=(Y=(ee=h.settings)==null?void 0:ee.radios)==null?void 0:Y.find(de=>de.value===I.status);return!(G!=null&&G.settings&&G.settings.show_textarea&&!((T=I.note)!=null&&T.trim()));case"image":return(a==null?void 0:a.length)>0;default:return!!I.status||!!((M=I.note)!=null&&M.trim())}};ye(()=>s.form.results,h=>{Object.keys(h).forEach(I=>{!h[I]||!h[I].status&&h[I].note})},{deep:!0}),ye(()=>s.form.images,h=>{Object.keys(h).forEach(I=>{!h[I]||h[I].length})},{deep:!0});const k=(h,I,a)=>{x("updateResult",{pointId:h,type:a,value:I})},A=h=>{x("saveResult",h)},Z=h=>{x("hapusPoint",h)};return(h,I)=>(o(),n("div",_n,[e("div",Mn,[e("h3",Un,B(t.category.name),1),p.value?(o(),n("button",{key:0,onClick:I[0]||(I[0]=a=>d.value=!d.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},B(d.value?"Sembunyikan Point Yang Tidak Perlu":"Tampilkan Point Tersembunyi"),1)):c("",!0)]),e("div",Dn,[(o(!0),n(_e,null,Me(l.value,a=>{var $,_,E,K,U,ee,Y,T,M,F,G,de,Ce,ke,R,O,se,le,ue,ce,re,be,L,fe,u,C,b,q,W,ge,ne,P,ie,pe,y,v,D,H,N,he,we,xe,Re,Oe,Pe,Je,Xe,ot,He,Ye,Qe,Ke,Ie,Te,et,tt;return o(),n("div",{key:a.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",jn,[e("label",Tn,[$e(B(($=a.inspection_point)==null?void 0:$.name)+" ",1),(_=a.settings)!=null&&_.is_required?(o(),n("span",Nn,"*")):c("",!0)]),V(a)?(o(),n("span",Ln," ✓ ")):c("",!0)]),a.input_type==="text"?(o(),Se(Tt,{key:0,modelValue:t.form.results[(E=a.inspection_point)==null?void 0:E.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(K=a.settings)==null?void 0:K.is_required,"min-length":(U=a.settings)==null?void 0:U.min_length,"max-length":(ee=a.settings)==null?void 0:ee.max_length,allowSpace:(Y=a.settings)==null?void 0:Y.allow_space,textTransform:(T=a.settings)==null?void 0:T.text_transform,placeholder:((M=a.settings)==null?void 0:M.placeholder)||"Masukan text",error:t.form.errors[`results.${(F=a.inspection_point)==null?void 0:F.id}.note`],onSave:z=>{var f;return A((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):c("",!0),a.input_type==="number"?(o(),Se(Nt,{key:1,modelValue:t.form.results[(G=a.inspection_point)==null?void 0:G.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(de=a.settings)==null?void 0:de.is_required,min:(Ce=a.settings)==null?void 0:Ce.min,max:(ke=a.settings)==null?void 0:ke.max,step:((R=a.settings)==null?void 0:R.step)||1,placeholder:((O=a.settings)==null?void 0:O.placeholder)||"Masukan number",error:t.form.errors[`results.${(se=a.inspection_point)==null?void 0:se.id}.note`],onSave:z=>{var f;return A((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):c("",!0),a.input_type==="account"?(o(),Se(qt,{key:2,modelValue:t.form.results[(le=a.inspection_point)==null?void 0:le.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(ue=a.settings)==null?void 0:ue.is_required,placeholder:((ce=a.settings)==null?void 0:ce.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${(re=a.inspection_point)==null?void 0:re.id}.note`],"point-id":(be=a.inspection_point)==null?void 0:be.id,settings:a.settings,onSave:z=>{var f;return A((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):c("",!0),a.input_type==="date"?(o(),Se(Lt,{key:3,modelValue:t.form.results[(L=a.inspection_point)==null?void 0:L.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(fe=a.settings)==null?void 0:fe.is_required,"min-date":(u=a.settings)==null?void 0:u.min_date,"max-date":(C=a.settings)==null?void 0:C.max_date,error:t.form.errors[`results.${(b=a.inspection_point)==null?void 0:b.id}.note`],onSave:z=>{var f;return A((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):c("",!0),a.input_type==="textarea"?(o(),Se(Bt,{key:4,modelValue:t.form.results[(q=a.inspection_point)==null?void 0:q.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(W=a.settings)==null?void 0:W.is_required,"min-length":(ge=a.settings)==null?void 0:ge.min_length,"max-length":(ne=a.settings)==null?void 0:ne.max_length,placeholder:((P=a.settings)==null?void 0:P.placeholder)||"Masukkan teks di sini",settings:a.settings,error:t.form.errors[`results.${(ie=a.inspection_point)==null?void 0:ie.id}.note`],onSave:z=>{var f;return A((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):c("",!0),a.input_type==="radio"?(o(),Se(vn,{key:5,modelValue:t.form.results[(pe=a.inspection_point)==null?void 0:pe.id].status,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"status")}],notes:t.form.results[(y=a.inspection_point)==null?void 0:y.id].note,images:t.form.images[(v=a.inspection_point)==null?void 0:v.id],required:(D=a.settings)==null?void 0:D.is_required,"point-id":(H=a.inspection_point)==null?void 0:H.id,point:a.inspection_point,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(N=a.inspection_point)==null?void 0:N.name,"selected-point":a.inspection_point??null,options:((he=a.settings)==null?void 0:he.radios)||S,error:t.form.errors[`results.${(we=a.inspection_point)==null?void 0:we.id}.status`],"onUpdate:notes":z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},"onUpdate:images":z=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=z},onSave:z=>{var f;return A((f=a.inspection_point)==null?void 0:f.id)},onHapus:z=>{var f;return Z((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="imageTOradio"?(o(),Se(Vn,{key:6,modelValue:t.form.results[(xe=a.inspection_point)==null?void 0:xe.id].status,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"status")}],notes:t.form.results[(Re=a.inspection_point)==null?void 0:Re.id].note,images:t.form.images[(Oe=a.inspection_point)==null?void 0:Oe.id],required:(Pe=a.settings)==null?void 0:Pe.is_required,"point-id":(Je=a.inspection_point)==null?void 0:Je.id,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(Xe=a.inspection_point)==null?void 0:Xe.name,point:a,"selected-point":a.inspection_point??null,options:((ot=a.settings)==null?void 0:ot.radios)||S,error:t.form.errors[`results.${(He=a.inspection_point)==null?void 0:He.id}.status`],"onUpdate:notes":z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},"onUpdate:images":z=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=z},onSave:z=>{var f;return A((f=a.inspection_point)==null?void 0:f.id)},onHapus:z=>{var f;return Z((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="image"?(o(),Se(ct,{key:7,modelValue:t.form.images[(Ye=a.inspection_point)==null?void 0:Ye.id],"onUpdate:modelValue":z=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=z},error:t.form.errors[`images.${(Qe=a.inspection_point)==null?void 0:Qe.id}`],"inspection-id":t.inspectionId,"point-id":(Ke=a.inspection_point)==null?void 0:Ke.id,point:a.inspection_point,"point-name":(Ie=a.inspection_point)==null?void 0:Ie.name,settings:a.settings,"onUpdate:notes":z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},"onUpdate:status":z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=z}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):c("",!0),a.input_type==="select"?(o(),Se(ra,{key:8,modelValue:t.form.results[(Te=a.inspection_point)==null?void 0:Te.id].status,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"status")}],required:(et=a.settings)==null?void 0:et.is_required,error:t.form.errors[`results.${(tt=a.inspection_point)==null?void 0:tt.id}.status`],onSave:z=>{var f;return A((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):c("",!0)])}),128)),l.value.length===0?(o(),n("div",qn,[I[1]||(I[1]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),I[2]||(I[2]=e("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),t.category.isDamageMenu?(o(),n("p",Bn,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):c("",!0)])):c("",!0)])]))}},En=Ee(An,[["__scopeId","data-v-819f08b2"]]),Rn={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Fn={class:"p-4 space-y-4-6"},zn={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},On=["value"],Hn={class:"p-4 space-y-4-6"},Kn={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Wn=["value"],Zn={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},Gn={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Pn=["value"],Jn={class:"p-4 space-y-2"},Xn={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},Yn={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},Qn={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},ei={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},ti={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},si={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(t,{emit:Q}){const s=t,x=Q,d=w(null),m=w(!1),p=_t({bold:!1,italic:!1,underline:!1}),l=_t({flooded:"",collision:"",collision_severity:"",notes:""}),g=T=>{if(!T)return{};if(typeof T=="string")try{return JSON.parse(T)||{}}catch(M){return console.error("Error parsing settings JSON:",M),{}}return typeof T=="object"&&T!==null?T:{}};oe(()=>g(s.inspection.settings).conclusion||{});const S=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],V=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],k=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Ge(()=>{Z(),Xt(()=>{A(),h()})});const A=()=>{d.value&&l.notes&&(d.value.innerHTML=l.notes)},Z=()=>{const M=g(s.inspection.settings).conclusion||{},F=s.form.conclusion||{};l.flooded=F.flooded||M.flooded||"",l.collision=F.collision||M.collision||"",l.collision_severity=F.collision_severity||M.collision_severity||"",l.notes=F.notes||s.inspection.notes||""},h=()=>{if(!d.value)return;const T=window.getSelection();T.rangeCount===0||T.isCollapsed||(p.bold=document.queryCommandState("bold"),p.italic=document.queryCommandState("italic"),p.underline=document.queryCommandState("underline"))},I=T=>{if(!d.value)return;d.value.focus();const M=p[T];switch(T){case"bold":document.execCommand("bold",!1,!M);break;case"italic":document.execCommand("italic",!1,!M);break;case"underline":document.execCommand("underline",!1,!M);break}setTimeout(()=>{h(),$()},10)},a=()=>{d.value&&(d.value.focus(),document.execCommand("removeFormat",!1,null),Object.keys(p).forEach(T=>{p[T]=!1}),$())},$=jt.debounce(()=>{d.value&&(l.notes=d.value.innerHTML,Y())},200),_=T=>{T.preventDefault(),document.execCommand("insertParagraph",!1,null)},E=T=>{T.preventDefault();const M=(T.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,M)},K=()=>{m.value=!0},U=()=>{m.value=!1,d.value&&(l.notes=d.value.innerHTML,Y())},ee=()=>{Y()},Y=()=>{const T={flooded:l.flooded,collision:l.collision,collision_severity:l.collision==="yes"?l.collision_severity:null,notes:l.notes};x("updateConclusion",T)};return ye(()=>s.form.conclusion,T=>{T&&(l.flooded=T.flooded!==void 0?T.flooded:l.flooded,l.collision=T.collision!==void 0?T.collision:l.collision,l.collision_severity=T.collision_severity!==void 0?T.collision_severity:l.collision_severity,l.notes=T.notes!==void 0?T.notes:l.notes,d.value&&T.notes!==void 0&&d.value.innerHTML!==T.notes&&(d.value.innerHTML=T.notes))},{deep:!0,immediate:!0}),ye([()=>l.flooded,()=>l.collision,()=>l.collision_severity,()=>l.notes],()=>{Y()},{deep:!0}),(T,M)=>(o(),n("div",Rn,[M[16]||(M[16]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),e("div",Fn,[M[8]||(M[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e(" Apakah kendaraan pernah terkena banjir? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",zn,[(o(),n(_e,null,Me(S,F=>e("label",{key:F.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[0]||(M[0]=G=>l.flooded=G),value:F.value,class:"hidden peer",onChange:ee},null,40,On),[[dt,l.flooded]]),e("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":l.flooded===F.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":l.flooded!==F.value}])},B(F.label),3)])),64))])]),e("div",Hn,[M[10]||(M[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e(" Apakah kendaraan pernah mengalami tabrakan? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Kn,[(o(),n(_e,null,Me(V,F=>e("label",{key:F.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[1]||(M[1]=G=>l.collision=G),value:F.value,class:"hidden peer",onChange:ee},null,40,Wn),[[dt,l.collision]]),e("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":l.collision===F.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":l.collision!==F.value}])},B(F.label),3)])),64))]),Ve(nt,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:qe(()=>[l.collision==="yes"?(o(),n("div",Zn,[M[9]||(M[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e("Tingkat kerusakan: "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Gn,[(o(),n(_e,null,Me(k,F=>e("label",{key:F.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[2]||(M[2]=G=>l.collision_severity=G),value:F.value,class:"hidden peer",onChange:ee},null,40,Pn),[[dt,l.collision_severity]]),e("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":l.collision_severity===F.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":l.collision_severity!==F.value}])},B(F.label),3)])),64))])])):c("",!0)]),_:1})]),e("div",Jn,[M[15]||(M[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),e("div",Xn,[e("button",{type:"button",onClick:M[3]||(M[3]=F=>I("bold")),class:te(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},M[11]||(M[11]=[e("strong",null,"B",-1)]),2),e("button",{type:"button",onClick:M[4]||(M[4]=F=>I("italic")),class:te(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},M[12]||(M[12]=[e("em",null,"I",-1)]),2),e("button",{type:"button",onClick:M[5]||(M[5]=F=>I("underline")),class:te(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},M[13]||(M[13]=[e("u",null,"U",-1)]),2),e("button",{type:"button",onClick:M[6]||(M[6]=F=>a()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Formatting"}," 🗑️ Clear ")]),Ve(nt,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:qe(()=>[Object.values(p).some(F=>F)?(o(),n("div",Yn,[M[14]||(M[14]=$e(" Format aktif: ")),p.bold?(o(),n("span",Qn,"Bold")):c("",!0),p.italic?(o(),n("span",ei,"Italic")):c("",!0),p.underline?(o(),n("span",ti,"Underline")):c("",!0)])):c("",!0)]),_:1}),e("div",{ref_key:"editorRef",ref:d,contenteditable:"true",class:te(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!m.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":m.value}]),onInput:M[7]||(M[7]=(...F)=>J($)&&J($)(...F)),onBlur:U,onFocus:K,onKeydown:Yt(_,["enter"]),onPaste:E,onMouseup:h,onKeyup:h,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},ai=Ee(si,[["__scopeId","data-v-e687622b"]]),oi={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},ni={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},ii={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},li={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},ri={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},di={class:"flex items-center space-x-2"},ui=["aria-checked"],ci={class:"flex items-center space-x-2 border-l pl-4"},gi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},mi=["onClick"],pi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},vi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},fi={key:3,class:"fixed inset-0 z-30"},hi={class:"mt-2 space-y-2"},bi={class:"flex items-center space-x-2"},xi=["aria-checked"],yi={class:"flex items-center space-x-2 border-l pl-4"},wi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ki=["onClick"],$i={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ci={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ii={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Si={class:"relative overflow-hidden"},Vi={key:1},_i=["disabled"],Mi={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ui={class:"space-y-4"},Di={class:"relative"},ji={class:"max-h-64 overflow-y-auto"},Ti={key:0,class:"text-center py-4 text-gray-500"},Ni=["onClick"],Li={class:"font-medium text-gray-900"},qi={class:"text-sm text-gray-500"},Bi={class:"text-xs text-gray-400 mt-1"},Ai={key:0,class:"text-xs text-green-600 mt-1"},Ei={__name:"IndexLocal",props:{inspection:Object,inspectionId:Object,category:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(t){var vt,ft,ht,bt,xt,yt,wt,kt,$t,Ct;const Q=i=>{if(!i)return{};if(typeof i=="string")try{return JSON.parse(i)||{}}catch(r){return console.error("Error parsing settings JSON:",r),{}}return typeof i=="object"&&i!==null?i:{}},s=t,x=oe(()=>`inspection_data_${s.inspection.id}`),d=oe(()=>`swipe_toggle_${s.inspection.id}`),m=oe(()=>`image_source_${s.inspection.id}`),p=()=>{try{const i=localStorage.getItem(x.value);return i?JSON.parse(i):{}}catch(i){return console.error("Error reading local storage:",i),{}}},l=i=>{try{localStorage.setItem(x.value,JSON.stringify(i))}catch(r){console.error("Error writing to local storage:",r)}},g=()=>{try{localStorage.removeItem(x.value),localStorage.removeItem(d.value),localStorage.removeItem(m.value)}catch(i){console.error("Error clearing local storage:",i)}},S=()=>{try{const i=localStorage.getItem(d.value);return i?JSON.parse(i):!0}catch(i){return console.error("Error reading swipe toggle state:",i),!0}},V=i=>{try{localStorage.setItem(d.value,JSON.stringify(i))}catch(r){console.error("Error writing swipe toggle state:",r)}},k=()=>{try{return localStorage.getItem(m.value)||"all"}catch(i){return console.error("Error reading image source setting:",i),"all"}},A=i=>{try{localStorage.setItem(m.value,i)}catch(r){console.error("Error writing image source setting:",r)}},Z=w(((ft=(vt=s.category)==null?void 0:vt.settings)==null?void 0:ft.menu_model)||"horizontal"),h=w(((bt=(ht=s.category)==null?void 0:ht.settings)==null?void 0:bt.position)||"top"),I=w(!1),a=w(!1),{pos:$,dragging:_,startLongPress:E,cancelLongPress:K,onDrag:U,stopDrag:ee,handleClick:Y}=Ut("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),T=i=>{Y(i)&&M()},M=()=>{I.value=!I.value},F=()=>{I.value=!1},G=i=>i?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:de,dragging:Ce,startLongPress:ke,cancelLongPress:R,onDrag:O,stopDrag:se,handleClick:le}=Ut("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),ue=i=>{le(i)&&(ce.value=!0)},ce=w(!1),re=w(!1),be=w(""),L=w(null),fe=w(""),u=w(""),C=w(""),b=w(!1),q=w(null),W=(i,r)=>{b.value=!0,q.value=r,ut.visit(i,{onFinish:()=>{b.value=!1,q.value=null}})},ge=oe(()=>s.appMenus.some(i=>i.input_type==="damage")),ne=oe(()=>["vehicle",...s.appMenus.map(i=>i.id),"conclusion"]),P=w(ne.value[0]),ie=w(0);ye(P,i=>{ie.value=ne.value.indexOf(i)});const pe=oe(()=>{if(P.value==="vehicle"||P.value==="conclusion")return null;const i=s.appMenus.find(r=>r.id===P.value);return i?{...i,points:y(i.menu_point,i.input_type==="damage")}:null}),y=(i,r)=>r?(i||[]).filter(X=>{const ae=X.inspection_point_id;return Je(ae)}):i||[],v=w({plate_number:s.inspection.plate_number,car_id:s.inspection.car_id,car_name:s.inspection.car_name}),D=w({notes:s.inspection.overall_note||"",flooded:((yt=(xt=Q(s.inspection.settings))==null?void 0:xt.conclusion)==null?void 0:yt.flooded)||null,collision:((kt=(wt=Q(s.inspection.settings))==null?void 0:wt.conclusion)==null?void 0:kt.collision)||null,collision_severity:((Ct=($t=Q(s.inspection.settings))==null?void 0:$t.conclusion)==null?void 0:Ct.collision_severity)||null}),N=Dt((()=>{const i=[...s.appMenus.flatMap(Be=>Be.menu_point||[]),...s.damagePoints||[]],r={},X={};i.forEach(Be=>{const Le=Be.inspection_point_id,je=s.existingResults[Le];r[Le]={status:(je==null?void 0:je.status)||"",note:(je==null?void 0:je.note)||""},X[Le]=s.existingImages[Le]||[]});const ae=p(),me={...r,...ae.results||{}},Ue={...X,...ae.images||{}},De={...v.value,...ae.vehicleDetails||{}},ve=ae.overall_note!==void 0?ae.overall_note:s.inspection.overall_note||"";return{inspection_id:s.inspection.id,results:me,images:Ue,overall_note:ve,plate_number:De.plate_number,car_id:De.car_id,car_name:De.car_name}})());ye(N,i=>{l({results:i.results,images:i.images,overall_note:i.overall_note,vehicleDetails:v.value,conclusion:D.value})},{deep:!0}),ye(v,i=>{N.plate_number=i.plate_number,N.car_id=i.car_id,N.car_name=i.car_name},{deep:!0}),ye(D,i=>{N.overall_note=i.notes},{deep:!0});const he=w(!1),we=i=>{he.value=i},xe=w(!1),Re=i=>{xe.value=i},Oe=oe(()=>{var me;const i=v.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(v.value.plate_number),r=!!((me=v.value.car_name)!=null&&me.trim()),X=!xe.value,ae=!he.value;return i&&r&&X&&ae}),Pe=oe(()=>{if(!be.value.trim())return s.damagePoints||[];const i=be.value.toLowerCase().trim();return(s.damagePoints||[]).filter(r=>{var X,ae,me,Ue,De;return((ae=(X=r.inspection_point)==null?void 0:X.name)==null?void 0:ae.toLowerCase().includes(i))||((Ue=(me=r.inspection_point)==null?void 0:me.description)==null?void 0:Ue.toLowerCase().includes(i))||((De=Xe(r))==null?void 0:De.toLowerCase().includes(i))})}),Je=i=>{const r=N.results[i]&&(N.results[i].status||N.results[i].note),X=N.images[i]&&N.images[i].length>0;return r||X},Xe=i=>{var r;return((r=i.inspection_point.component)==null?void 0:r.name)||"Komponen Tidak Diketahui"},ot=i=>N.results[i]||null,He=()=>{var Ue;const i=D.value,r=!!i.flooded,X=!!i.collision,ae=i.collision==="yes"?!!i.collision_severity:!0,me=!!((Ue=i.notes)!=null&&Ue.trim());return r&&X&&ae&&me},Ye=oe(()=>({flooded:D.value.flooded||null,collision:D.value.collision||null,collision_severity:D.value.collision_severity||null,note:D.value.notes||null,isComplete:He()})),Qe=oe(()=>{const i=Oe.value,r=s.appMenus.every(ae=>Ke(ae)),X=He();return i&&r&&X}),Ke=i=>i.id==="conclusion"?He():i.id==="vehicle"?Oe.value:(y(i.menu_point,!1)||[]).filter(X=>X.is_default).every(X=>{var De,ve,Be,Le,je,st;const ae=N.results[X.inspection_point_id],me=N.images[X.inspection_point_id];if(!ae)return!1;const Ue=Q(X.settings);switch(X.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((De=ae.note)!=null&&De.trim());case"select":case"radio":if(!ae.status)return!1;const Fe=(ve=Ue.radios)==null?void 0:ve.find(j=>j.value===ae.status);return!(Fe!=null&&Fe.settings&&(Fe.settings.show_textarea&&!((Be=ae.note)!=null&&Be.trim())||Fe.settings.show_image_upload&&(me==null?void 0:me.length)===0));case"imageTOradio":if((me==null?void 0:me.length)===0||!ae.status)return!1;const ze=(Le=Ue.radios)==null?void 0:Le.find(j=>j.value===ae.status);return!(ze!=null&&ze.settings&&ze.settings.show_textarea&&ze.settings.required&&!((je=ae.note)!=null&&je.trim()));case"image":return(me==null?void 0:me.length)>0;default:return!!ae.status||!!((st=ae.note)!=null&&st.trim())}}),Ie=w(!0),Te=w("all");Qt("imageSourceSetting",Te);const et=()=>{Ie.value=!Ie.value,V(Ie.value)},tt=()=>{A(Te.value),console.log("Image source setting updated to:",Te.value)},z=i=>{L.value=i;const r=i.inspection_point_id,X=N.results[r]||{};fe.value=X.status||"",u.value=X.note||"",ce.value=!1,re.value=!0},f=i=>{L.value&&(N.images[L.value.inspection_point_id]=i)},Et=()=>{if(L.value){const i=L.value.inspection_point_id;N.results[i]={...N.results[i],status:fe.value,note:u.value},C.value="Data berhasil disimpan di lokal!",setTimeout(()=>C.value="",1e3)}lt()},Rt=({pointId:i,type:r,value:X})=>{var ae;(ae=N.results[i])!=null&&ae.hasOwnProperty(r)&&(N.results[i][r]=X)},mt=async i=>{if(i&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await ut.post(route("inspections.delete-result"),{inspection_id:s.inspection.id,point_id:i},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{N.results[i]&&(N.results[i]={status:"",note:""}),N.images[i]&&(N.images[i]=[]),C.value="Data berhasil dihapus!",setTimeout(()=>C.value="",1e3)},onError:r=>{console.error("Error menghapus hasil:",r)}})}catch(r){console.error("Error menghapus hasil:",r)}lt()}},Ft=i=>{Object.assign(v.value,i),we(!0)},zt=i=>{console.log("Save car details locally:",i)},Ot=i=>{console.log("Received conclusion data from child:",i),D.value={...D.value,...i},N.overall_note=i.notes||"",console.log("Conclusion state updated:",D.value)},Ht=()=>{if(!Qe.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}if(!confirm("Apakah Anda yakin ingin mengirim semua data inspeksi? Data lokal akan dihapus setelah berhasil dikirim."))return;a.value=!0;const i={...N.data(),overall_note:D.value.notes,conclusion:{notes:D.value.notes,flooded:D.value.flooded,collision:D.value.collision,collision_severity:D.value.collision_severity}};ut.post(route("inspections.final-submit-local",{id:s.inspection.id}),i,{preserveScroll:!0,onSuccess:()=>{g()},onError:r=>{console.error("Kesalahan pengiriman:",r),a.value=!1}})},Kt=({pointId:i,imageId:r})=>{N.images[i]&&(N.images[i]=N.images[i].filter(X=>X.id!==r))},Wt=()=>{ce.value=!1,be.value=""},lt=()=>{re.value=!1,L.value=null,fe.value="",u.value=""},We=i=>{P.value=i},pt=i=>{let r=ie.value+i;r>=0&&r<ne.value.length&&(P.value=ne.value[r])},Zt=()=>{let i=0,r=0,X=null;const ae=ve=>{Ie.value&&(i=ve.changedTouches[0].screenX)},me=ve=>{Ie.value&&(r=ve.changedTouches[0].screenX,Ue())},Ue=()=>{if(!Ie.value)return;const ve=250;r<i-ve?pt(1):r>i+ve&&pt(-1)},De=()=>{const ve=document.querySelector(".relative.overflow-hidden");return ve&&(ve.addEventListener("touchstart",ae,!1),ve.addEventListener("touchend",me,!1)),()=>{ve&&(ve.removeEventListener("touchstart",ae),ve.removeEventListener("touchend",me))}};return X=De(),ye(Ie,ve=>{X&&X(),ve&&(X=De())}),()=>{X&&X()}};return Ge(()=>{const i=p();if(Ie.value=S(),Te.value=k(),i.vehicleDetails&&(Object.assign(v.value,i.vehicleDetails),N.plate_number=i.vehicleDetails.plate_number,N.car_id=i.vehicleDetails.car_id,N.car_name=i.vehicleDetails.car_name),i.conclusion)console.log("Loading conclusion from localStorage:",i.conclusion),Object.assign(D.value,i.conclusion),N.overall_note=i.conclusion.notes||"";else{const X=Q(s.inspection.settings).conclusion||{};D.value={notes:s.inspection.notes||"",flooded:X.flooded||"",collision:X.collision||"",collision_severity:X.collision_severity||""},N.overall_note=s.inspection.notes||""}i.results&&Object.assign(N.results,i.results),i.images&&Object.assign(N.images,i.images),Zt()}),(i,r)=>{var X,ae,me,Ue,De,ve,Be,Le,je,st,Fe,ze;return o(),n("div",oi,[J(Ce)||J(_)?(o(),n("div",ni)):c("",!0),Z.value==="vertical"?(o(),n("button",{key:1,onMousedown:r[0]||(r[0]=(...j)=>J(E)&&J(E)(...j)),onMouseup:r[1]||(r[1]=(...j)=>J(ee)&&J(ee)(...j)),onMouseleave:r[2]||(r[2]=(...j)=>J(K)&&J(K)(...j)),onMousemove:r[3]||(r[3]=(...j)=>J(U)&&J(U)(...j)),onTouchstart:r[4]||(r[4]=(...j)=>J(E)&&J(E)(...j)),onTouchend:r[5]||(r[5]=(...j)=>J(ee)&&J(ee)(...j)),onTouchmove:r[6]||(r[6]=(...j)=>J(U)&&J(U)(...j)),onClick:T,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:Ae({left:J($).x+"px",top:J($).y+"px"}),"aria-label":"Toggle vertical menu"},[I.value?(o(),n("svg",li,r[25]||(r[25]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(o(),n("svg",ii,r[24]||(r[24]=[e("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):c("",!0),Z.value==="horizontal"?(o(),n("div",{key:2,class:te(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":h.value==="top","fixed bottom-0 left-0 right-0":h.value==="bottom"}])},[e("div",ri,[e("div",di,[r[26]||(r[26]=e("span",{class:"text-sm text-gray-600"},"Swipe",-1)),e("button",{onClick:et,type:"button",class:te(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Ie.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Ie.value},[e("span",{"aria-hidden":"true",class:te(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Ie.value?"translate-x-5":"translate-x-0"])},null,2)],10,ui)]),e("div",ci,[r[28]||(r[28]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ne(e("select",{"onUpdate:modelValue":r[7]||(r[7]=j=>Te.value=j),onChange:tt,class:"text-sm border border-gray-300 rounded-md px-5 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},r[27]||(r[27]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[Mt,Te.value]])]),e("button",{onClick:r[8]||(r[8]=j=>We("vehicle")),class:te(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":P.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":P.value!=="vehicle"}])},[r[29]||(r[29]=$e(" Detail Kendaraan ")),Oe.value?(o(),n("span",gi," ✓ ")):c("",!0)],2),(o(!0),n(_e,null,Me(t.appMenus,j=>(o(),n("button",{key:j.id,onClick:rt=>We(j.id),class:te(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":P.value===j.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":P.value!==j.id}])},[$e(B(j.name)+" ",1),Ke(j)?(o(),n("span",pi," ✓ ")):c("",!0)],10,mi))),128)),e("button",{onClick:r[9]||(r[9]=j=>We("conclusion")),class:te(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":P.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":P.value!=="conclusion"}])},[r[30]||(r[30]=$e(" Kesimpulan ")),Ye.value.isComplete?(o(),n("span",vi," ✓ ")):c("",!0)],2)])],2)):c("",!0),Z.value==="vertical"&&I.value?(o(),n("div",fi,[e("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:F}),e("div",{class:te(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":h.value==="top-right","top-16 left-4":h.value==="top-left","bottom-16 right-4":h.value==="bottom-right","bottom-16 left-4":h.value==="bottom-left"}])},[e("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[r[31]||(r[31]=e("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),e("button",{onClick:F,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),e("div",hi,[e("div",bi,[r[32]||(r[32]=e("span",{class:"text-sm text-gray-600"},"Swipe Gesture",-1)),e("button",{onClick:et,type:"button",class:te(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Ie.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Ie.value},[e("span",{"aria-hidden":"true",class:te(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Ie.value?"translate-x-5":"translate-x-0"])},null,2)],10,xi)]),e("div",yi,[r[34]||(r[34]=e("span",{class:"text-sm text-gray-600"},"Sumber Gambar",-1)),Ne(e("select",{"onUpdate:modelValue":r[10]||(r[10]=j=>Te.value=j),onChange:tt,class:"text-sm border border-gray-300 rounded-md px-6 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},r[33]||(r[33]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[Mt,Te.value]])]),e("button",{onClick:r[11]||(r[11]=j=>{We("vehicle"),F()}),class:te([G(P.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[r[35]||(r[35]=e("span",null,"Detail Kendaraan",-1)),Oe.value?(o(),n("span",wi,"✓")):c("",!0)],2),(o(!0),n(_e,null,Me(t.appMenus,j=>(o(),n("button",{key:`vmenu-${j.id}`,onClick:()=>{We(j.id),F()},class:te([G(P.value===j.id),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[e("span",null,B(j.name),1),Ke(j)?(o(),n("span",$i,"✓")):c("",!0)],10,ki))),128)),e("button",{onClick:r[12]||(r[12]=j=>{We("conclusion"),F()}),class:te([G(P.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[r[36]||(r[36]=e("span",null,"Kesimpulan",-1)),Ye.value.isComplete?(o(),n("span",Ci,"✓")):c("",!0)],2)])],2)])):c("",!0),e("div",{class:te(["max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1",{"pb-4 pt-1":h.value==="top","pb-20 pt-4":h.value==="bottom","pb-4 pt-4":Z.value==="vertical"}])},[Ve(nt,{name:"fade"},{default:qe(()=>[C.value?(o(),n("div",Ii,B(C.value),1)):c("",!0)]),_:1}),e("div",Si,[P.value==="vehicle"?(o(),Se(Bs,{key:0,inspection:t.inspection,CarDetail:t.CarDetail,allInspections:s.allInspections,onUpdateVehicle:Ft,onSaveCarDetails:zt,"onUpdate:validation":Re,"onUpdate:hasUnsavedChanges":we},null,8,["inspection","CarDetail","allInspections"])):pe.value&&P.value!=="conclusion"?(o(),Se(En,{key:pe.value.id,category:pe.value,"inspection-id":t.inspection.id,form:J(N),onUpdateResult:Rt,onHapusPoint:mt,onRemoveImage:Kt},null,8,["category","inspection-id","form"])):P.value==="conclusion"?(o(),Se(ai,{key:2,form:{conclusion:D.value},"inspection-id":t.inspection.id,inspection:t.inspection,settings:t.inspection.settings||{},onUpdateConclusion:Ot},null,8,["form","inspection-id","inspection","settings"])):c("",!0)]),P.value==="conclusion"?(o(),n("div",{key:0,class:te(["flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md",{"mb-4":h.value==="top","mb-20":h.value==="bottom"}])},[Ve(J(es),{href:i.route("inspections.pending",t.inspectionId),as:"button",type:"button",disabled:b.value&&q.value==="pending",onClick:r[13]||(r[13]=at(j=>W(i.route("inspections.pending",t.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:qe(()=>[b.value&&q.value==="pending"?(o(),n(_e,{key:0},[r[37]||(r[37]=e("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),r[38]||(r[38]=e("span",null,"Memproses...",-1))],64)):(o(),n("span",Vi,"Tunda"))]),_:1},8,["href","disabled"]),e("button",{type:"button",onClick:Ht,disabled:!Qe.value||a.value,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[a.value?(o(),n("svg",Mi,r[39]||(r[39]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,B(a.value?"Mengirim...":"Final Kirim Inspeksi"),1)],8,_i)],2)):c("",!0),ge.value?(o(),n("button",{key:1,onMousedown:r[14]||(r[14]=(...j)=>J(ke)&&J(ke)(...j)),onMouseup:r[15]||(r[15]=(...j)=>J(se)&&J(se)(...j)),onMouseleave:r[16]||(r[16]=(...j)=>J(R)&&J(R)(...j)),onMousemove:r[17]||(r[17]=(...j)=>J(O)&&J(O)(...j)),onTouchstart:r[18]||(r[18]=(...j)=>J(ke)&&J(ke)(...j)),onTouchend:r[19]||(r[19]=(...j)=>J(se)&&J(se)(...j)),onTouchmove:r[20]||(r[20]=(...j)=>J(O)&&J(O)(...j)),onClick:ue,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:Ae({left:J(de).x+"px",top:J(de).y+"px"})},r[40]||(r[40]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):c("",!0),Ve(At,{show:ce.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:Wt},{default:qe(()=>[e("div",Ui,[e("div",Di,[Ne(e("input",{"onUpdate:modelValue":r[21]||(r[21]=j=>be.value=j),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Ze,be.value]]),r[41]||(r[41]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",ji,[Pe.value.length===0?(o(),n("div",Ti," Tidak ada point yang ditemukan ")):c("",!0),(o(!0),n(_e,null,Me(Pe.value,j=>{var rt,It;return o(),n("button",{key:j.id,onClick:Ri=>z(j),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",Li,B((rt=j.inspection_point)==null?void 0:rt.name),1),e("div",qi,B((It=j.inspection_point)==null?void 0:It.description),1),e("div",Bi,B(Xe(j)),1),Je(j.inspection_point_id)?(o(),n("div",Ai," ✓ Sudah ada data ")):c("",!0)],8,Ni)}),128))])])]),_:1},8,["show"]),re.value?(o(),Se(gt,{key:(X=L.value)==null?void 0:X.id,show:re.value,title:((me=(ae=L.value)==null?void 0:ae.inspection_point)==null?void 0:me.name)||"Detail Point",subtitle:(De=(Ue=L.value)==null?void 0:Ue.inspection_point)==null?void 0:De.description,name:`point-${(ve=L.value)==null?void 0:ve.id}`,"inspection-id":t.inspection.id,"point-id":(Be=L.value)==null?void 0:Be.inspection_point_id,settings:((Le=L.value)==null?void 0:Le.settings)||{},options:((st=(je=L.value)==null?void 0:je.settings)==null?void 0:st.radios)||[],"selected-Point":L.value,"selected-value":fe.value,"images-value":J(N).images[(Fe=L.value)==null?void 0:Fe.inspection_point_id],"notes-value":u.value,point:L.value,"existing-data":ot((ze=L.value)==null?void 0:ze.inspection_point_id),"onUpdate:selectedValue":r[22]||(r[22]=j=>fe.value=j),"onUpdate:notesValue":r[23]||(r[23]=j=>u.value=j),"onUpdate:imagesValue":f,onSave:Et,onClose:lt,onHapus:mt},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):c("",!0)],2)])}}},Zi=Ee(Ei,[["__scopeId","data-v-77f1ebae"]]);export{Zi as default};
