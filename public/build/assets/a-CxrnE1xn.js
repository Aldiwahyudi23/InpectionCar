import{g as x,m as j,x as _e,W as L,G as te,y as be,f as m,o as d,d as u,e as K,i as v,b as B,n as q,F as se,k as ne,j as oe,w as W,t as k,T as ie,u as w,z as ke,A as Ce}from"./vendor-CeYqQ7tF.js";import{l as X}from"./lodash-C5Ilt7en.js";import{V as Se,C as De,a as Me,B as Pe,_ as Ve}from"./ConclusionSection-hsoD0pem.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-BTguZwZJ.js";import"./ActionMessage-BOiCSxZ_.js";import"./InputNumber-BPVjtaZE.js";const Re={class:"container mx-auto px-4 py-2"},Te={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},je={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Le=["onClick"],ze={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Be={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ne={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Ae={class:"relative overflow-hidden"},Ue={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},$e=["disabled"],Fe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Oe={class:"space-y-4"},He={class:"relative"},Ke={class:"max-h-64 overflow-y-auto"},qe={key:0,class:"text-center py-4 text-gray-500"},We=["onClick"],Xe={class:"font-medium text-gray-900"},Je={class:"text-sm text-gray-500"},Ge={class:"text-xs text-gray-400 mt-1"},Qe={key:0,class:"text-xs text-green-600 mt-1"},Ye={__name:"a",props:{inspection:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array},setup(f){const r=f,C=x(!1),S=x(!1),_=x(""),c=x(null),D=x(""),M=x(""),b=x(""),p=x("vehicle"),ae=j(()=>r.appMenus||[]),N=(e,t)=>t?(e||[]).filter(n=>{const o=n.inspection_point_id;return G(o)}):e||[],J=j(()=>{if(!_.value.trim())return r.damagePoints||[];const e=_.value.toLowerCase().trim();return(r.damagePoints||[]).filter(t=>{var n,o,i,l,g;return((o=(n=t.inspection_point)==null?void 0:n.name)==null?void 0:o.toLowerCase().includes(e))||((l=(i=t.inspection_point)==null?void 0:i.description)==null?void 0:l.toLowerCase().includes(e))||((g=Q(t))==null?void 0:g.toLowerCase().includes(e))})}),G=e=>{const t=r.existingResults[e]!==void 0,n=r.existingImages[e]&&r.existingImages[e].length>0,o=s.results[e]&&(s.results[e].status||s.results[e].note),i=s.images[e]&&s.images[e].length>0;return t||n||o||i},Q=e=>{var t,n;return((n=(t=e.inspection_point)==null?void 0:t.component)==null?void 0:n.name)||"Komponen Tidak Diketahui"},le=e=>r.existingResults[e]||null,re=e=>{c.value=e;const t=e.inspection_point_id,n=s.results[t]||{};D.value=n.status||"",M.value=n.note||"",C.value=!1,S.value=!0},ue=e=>{c.value&&(s.images[c.value.inspection_point_id]=e)},ce=()=>{if(c.value){const e=c.value.inspection_point_id;s.results[e]={...s.results[e],status:D.value,note:M.value},z(e),b.value="Data berhasil disimpan!",setTimeout(()=>b.value="",1e3)}A()},de=()=>{C.value=!1,_.value=""},A=()=>{S.value=!1,c.value=null,D.value="",M.value=""},U=j(()=>{if(p.value==="vehicle"||p.value==="conclusion")return null;const e=r.appMenus.find(t=>t.id===p.value);return e?{...e,isDamageMenu:e.input_type==="damage",points:N(e.menu_point,e.input_type==="damage")}:null}),s=_e((()=>{const e={},t={};return[...r.appMenus.flatMap(o=>o.menu_point||[]),...r.damagePoints||[]].forEach(o=>{const i=o.inspection_point_id,l=r.existingResults[i];e[i]={status:(l==null?void 0:l.status)||"",note:(l==null?void 0:l.note)||""},t[i]=r.existingImages[i]||[]}),{inspection_id:r.inspection.id,results:e,images:t,overall_note:r.inspection.overall_note||""}})()),Y=e=>e.input_type==="damage"?N(e.menu_point,!0).length>0:e.id==="conclusion"?F():N(e.menu_point,!1).every(n=>{var g,P,V,E,R,T;const o=s.results[n.inspection_point_id],i=s.images[n.inspection_point_id];if(!o)return!1;const l=$(n.settings);switch(n.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((g=o.note)!=null&&g.trim());case"select":case"radio":if(!o.status)return!1;const h=(P=l.radios)==null?void 0:P.find(a=>a.value===o.status);return!(h!=null&&h.settings&&(h.settings.show_textarea&&!((V=o.note)!=null&&V.trim())||h.settings.show_image_upload&&(i==null?void 0:i.length)===0));case"imageTOradio":if((i==null?void 0:i.length)===0||!o.status)return!1;const y=(E=l.radios)==null?void 0:E.find(a=>a.value===o.status);return!(y!=null&&y.settings&&y.settings.show_textarea&&y.settings.required&&!((R=o.note)!=null&&R.trim()));case"image":return(i==null?void 0:i.length)>0;default:return!!o.status||!!((T=o.note)!=null&&T.trim())}}),$=e=>{if(!e)return{};if(typeof e=="string")try{return JSON.parse(e)||{}}catch(t){return console.error("Error parsing settings JSON:",t),{}}return typeof e=="object"&&e!==null?e:{}},F=()=>{var g;const t=$(r.inspection.settings).conclusion||{},n=!!t.flooded,o=!!t.collision,i=t.collision==="yes"?!!t.collision_severity:!0,l=!!((g=r.inspection.notes)!=null&&g.trim());return n&&o&&i&&l},pe=j(()=>{const t=$(r.inspection.settings).conclusion||{};return{flooded:t.flooded||null,collision:t.collision||null,collision_severity:t.collision_severity||null,note:r.inspection.notes||null,isComplete:F()}}),Z=j(()=>{const e=r.appMenus.every(n=>Y(n)),t=F();return e&&t}),O=e=>{p.value=e},z=X.debounce(async e=>{try{await L.post(route("inspections.save-result"),{inspection_id:r.inspection.id,point_id:e,status:s.results[e].status,note:s.results[e].note,images:s.images[e]},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{L.reload({only:["existingResults","existingImages"]})}})}catch(t){console.error("Error menyimpan hasil:",t)}},500),ge=({pointId:e,type:t,value:n})=>{var o;(o=s.results[e])!=null&&o.hasOwnProperty(t)&&(s.results[e][t]=n),z(e)},I=async e=>{if(e&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await L.post(route("inspections.delete-result"),{inspection_id:r.inspection.id,point_id:e},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{s.results[e]&&(s.results[e].status="",s.results[e].note=""),s.images[e]&&(s.images[e]=[]),b.value="Data berhasil dihapus!",setTimeout(()=>{b.value=""},2e3),L.reload({only:["existingResults","existingImages"]})},onError:t=>{console.error("Error menghapus hasil:",t)}})}catch(t){console.error("Error menghapus hasil:",t)}A()}},me=e=>{Object.assign(s.conclusion,e),ve()},ve=X.debounce(async()=>{try{await L.post(route("inspections.save-conclusion"),{inspection_id:r.inspection.id,...s.conclusion},{preserveScroll:!0,preserveState:!0})}catch(e){console.error("Error menyimpan kesimpulan:",e)}},500),fe=()=>{if(!Z.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}s.post(route("inspections.final-submit",{id:r.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:e=>{console.error("Kesalahan pengiriman:",e)}})},he=e=>{console.log("Update vehicle:",e)},ye=e=>{console.log("Save car details:",e)},xe=({pointId:e,imageId:t})=>{s.images[e]&&(s.images[e]=s.images[e].filter(n=>n.id!==t),z(e))},we=()=>{let e=0,t=0;const n=g=>{e=g.changedTouches[0].screenX},o=g=>{t=g.changedTouches[0].screenX,i()},i=()=>{t<e-150?navigate(1):t>e+150&&navigate(-1)},l=document.querySelector(".relative.overflow-hidden");return l&&(l.addEventListener("touchstart",n,!1),l.addEventListener("touchend",o,!1)),()=>{l&&(l.removeEventListener("touchstart",n),l.removeEventListener("touchend",o))}};return te(p,e=>{const t=document.querySelector(`.flex-shrink-0[data-category-id="${e}"]`);t&&t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),te(_,X.debounce(()=>{},300)),be(()=>{we()}),(e,t)=>{var n,o,i,l,g,P,V,E,R,T,h,y;return d(),m("div",Re,[u("div",Te,[u("div",je,[u("button",{onClick:t[0]||(t[0]=a=>O("vehicle")),class:q(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="vehicle"}])}," Detail Kendaraan ",2),(d(!0),m(se,null,ne(ae.value,a=>(d(),m("button",{key:a.id,onClick:H=>O(a.id),class:q(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value===a.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!==a.id}])},[oe(k(a.name)+" ",1),Y(a)?(d(),m("span",ze," ✓ ")):v("",!0)],10,Le))),128)),u("button",{onClick:t[1]||(t[1]=a=>O("conclusion")),class:q(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="conclusion"}])},[t[6]||(t[6]=oe(" Kesimpulan ")),pe.value.isComplete?(d(),m("span",Be," ✓ ")):v("",!0)],2)])]),K(ie,{name:"fade"},{default:W(()=>[b.value?(d(),m("div",Ne,k(b.value),1)):v("",!0)]),_:1}),u("div",Ae,[K(ie,{name:"category-slide",mode:"out-in"},{default:W(()=>[p.value==="vehicle"?(d(),B(Se,{key:0,inspection:f.inspection,CarDetail:f.CarDetail,onUpdateVehicle:he,onSaveCarDetails:ye},null,8,["inspection","CarDetail"])):U.value&&p.value!=="conclusion"?(d(),B(De,{key:U.value.id,category:U.value,"inspection-id":f.inspection.id,form:w(s),onSaveResult:w(z),onUpdateResult:ge,onHapusPoint:I,onRemoveImage:xe},null,8,["category","inspection-id","form","onSaveResult"])):p.value==="conclusion"?(d(),B(Me,{key:2,form:w(s),"inspection-id":f.inspection.id,inspection:f.inspection,settings:f.inspection.settings||{},onUpdateConclusion:me},null,8,["form","inspection-id","inspection","settings"])):v("",!0)]),_:1})]),p.value==="conclusion"?(d(),m("div",Ue,[u("button",{type:"button",onClick:fe,disabled:!Z.value||w(s).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[w(s).processing?(d(),m("svg",Fe,t[7]||(t[7]=[u("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),u("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):v("",!0),u("span",null,k(w(s).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,$e)])):v("",!0),!C.value&&!S.value?(d(),m("button",{key:1,onClick:t[2]||(t[2]=a=>C.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},t[8]||(t[8]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):v("",!0),K(Pe,{show:C.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:de},{default:W(()=>[u("div",Oe,[u("div",He,[ke(u("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>_.value=a),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Ce,_.value]]),t[9]||(t[9]=u("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[u("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),u("div",Ke,[J.value.length===0?(d(),m("div",qe," Tidak ada point yang ditemukan ")):v("",!0),(d(!0),m(se,null,ne(J.value,a=>{var H,ee;return d(),m("button",{key:a.id,onClick:Ie=>re(a),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[u("div",Xe,k((H=a.inspection_point)==null?void 0:H.name),1),u("div",Je,k((ee=a.inspection_point)==null?void 0:ee.description),1),u("div",Ge,k(Q(a)),1),G(a.inspection_point_id)?(d(),m("div",Qe," ✓ Sudah ada data ")):v("",!0)],8,We)}),128))])])]),_:1},8,["show"]),S.value?(d(),B(Ve,{key:(n=c.value)==null?void 0:n.id,show:S.value,title:((i=(o=c.value)==null?void 0:o.inspection_point)==null?void 0:i.name)||"Detail Point",subtitle:(g=(l=c.value)==null?void 0:l.inspection_point)==null?void 0:g.description,name:`point-${(P=c.value)==null?void 0:P.id}`,"inspection-id":f.inspection.id,"point-id":(V=c.value)==null?void 0:V.inspection_point_id,settings:((E=c.value)==null?void 0:E.settings)||{},options:((T=(R=c.value)==null?void 0:R.settings)==null?void 0:T.radios)||[],"selected-Point":c.value,"selected-value":D.value,"images-value":w(s).images[(h=c.value)==null?void 0:h.inspection_point_id],"notes-value":M.value,point:c.value,"existing-data":le((y=c.value)==null?void 0:y.inspection_point_id),"onUpdate:selectedValue":t[4]||(t[4]=a=>D.value=a),"onUpdate:notesValue":t[5]||(t[5]=a=>M.value=a),"onUpdate:imagesValue":ue,onSave:ce,onClose:A,onHapus:I},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):v("",!0)])}}},lt=Ee(Ye,[["__scopeId","data-v-703da958"]]);export{lt as default};
