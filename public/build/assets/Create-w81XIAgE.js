import{x as ie,C as de,g as p,q as E,s as ue,D as ce,E as O,G as pe,b as me,o as l,w as ge,e as fe,d as t,u as a,l as be,f as n,i as c,t as m,v as b,y as k,F as V,k as S,j as Q,H as W,A as ve,n as ye,p as P}from"./vendor-BTHpbkmK.js";import{l as xe}from"./lodash-DIQq7uM1.js";import{A as he}from"./AppLayout-CKa2HT2x.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},we={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},Ce={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},Ie={class:"mb-6"},Ae={class:"flex items-center space-x-2"},Me={key:0,class:"mt-2 text-sm text-red-600"},Be={key:1,class:"mt-2 text-sm text-green-600"},$e={class:"mb-6"},je={class:"relative"},Ue={key:0,class:"absolute right-3 top-3"},Ve={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Se={key:0},Te=["onMousedown"],Le={class:"font-medium text-gray-900"},Ne={key:1,class:"p-4 text-sm text-gray-500 text-center"},De={class:"mb-6"},ze={class:"block text-sm font-medium text-gray-700 mb-2",for:"category"},Ee=["value"],Pe={class:"mb-6 flex items-center justify-between"},qe={class:"relative inline-flex items-center cursor-pointer"},Fe={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={key:0,class:"mb-6"},Ke=["value"],Ge={class:"mt-6 flex justify-end"},Je=["disabled"],Re={key:2,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ze={key:0,class:"mb-4"},Oe=["innerHTML"],Qe={key:1},We={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Xe=["onClick"],Ye=["src","alt"],et={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},tt={class:"text-white text-xs text-center"},st={key:2,class:"text-center py-4 text-gray-500 text-sm"},ot={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},rt=["src","alt"],lt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},nt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},at={__name:"Create",props:{CarDetail:Array,Category:Array,team:Array,inspection:Array},setup(q){const T=q,r=ie({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null,inspector_id:null}),M=de(),h=M.props.global.user,F=M.props.global.region,v=M.props.global.has_roles;M.props.global.permissions;const w=p(""),C=p(""),I=p(""),f=p(""),_=p(!1),L=p(!1),B=p([]),y=p(null),d=p([]),$=p(""),N=p(!1),j=p(""),U=p(!1),g=p(0),X=()=>{const s=`${w.value}${C.value}${I.value}`.toUpperCase();r.plate_number=s},D=s=>{s==="area"?w.value=w.value.toUpperCase().replace(/[^A-Z]/g,""):s==="number"?C.value=C.value.replace(/[^0-9]/g,""):s==="suffix"&&(I.value=I.value.toUpperCase().replace(/[^A-Z]/g,"")),X()},Y=E(()=>!(!r.plate_number.trim()||!r.category_id||!r.car_id&&!f.value.trim()||r.is_scheduled&&(!r.scheduled_at_date||!r.scheduled_at_time)||(v.includes("Admin")||v.includes("coordinator"))&&!r.inspector_id)),ee=E(()=>r.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),te=E(()=>{const s=T.team.filter(o=>o.status==="active"),e=v.includes("Admin"),i=v.includes("coordinator");if(e)return s;if(i){const o=F.id;return s.filter(u=>u.region_id===o)}return[]}),A=s=>{var i,o,u;if(!s)return"";const e=[];return(i=s.brand)!=null&&i.name&&e.push(s.brand.name),(o=s.model)!=null&&o.name&&e.push(s.model.name),(u=s.type)!=null&&u.name&&e.push(s.type.name),s.cc&&e.push(`${s.cc}cc`),s.transmission&&e.push(s.transmission),s.fuel_type&&e.push(s.fuel_type),s.year&&e.push(s.year.toString()),s.production_period&&e.push(`(${s.production_period})`),e.join(" ")},H=xe.debounce(()=>{if(!f.value.trim()){B.value=[],_.value=!1;return}L.value=!0;const s=f.value.toLowerCase().trim();B.value=T.CarDetail.filter(e=>A(e).toLowerCase().includes(s)),_.value=!0,L.value=!1},300),se=()=>{setTimeout(()=>{_.value=!1},200)},K=async s=>{y.value=s,f.value=A(s),r.car_id=s.id,r.car_name=A(s),_.value=!1,await oe(s.id)},oe=async s=>{try{const e=await fetch(`/api/cars/${s}/images`);if(e.ok){const i=await e.json();d.value=Array.isArray(i)?i:[]}else d.value=[]}catch(e){console.error("Error loading car images:",e),d.value=[]}},G=s=>!s||!s.file_path?"":`/storage/${s.file_path}`,re=s=>{g.value=s,U.value=!0,document.body.style.overflow="hidden"},z=()=>{U.value=!1,document.body.style.overflow=""},J=()=>{g.value=(g.value+1)%d.value.length},R=()=>{g.value=(g.value-1+d.value.length)%d.value.length},Z=s=>{if(U.value)switch(s.key){case"Escape":z();break;case"ArrowRight":J();break;case"ArrowLeft":R();break}};ue(()=>{window.addEventListener("keydown",Z)}),ce(()=>{window.removeEventListener("keydown",Z)}),O(f,s=>{(!y.value||A(y.value)!==s)&&(r.car_id=null,r.car_name=s,y.value=null,d.value=[])}),pe(()=>{const s=v.includes("Admin")||v.includes("coordinator");r.inspector_id=(h==null?void 0:h.id)||null}),O(()=>r.plate_number,s=>{if($.value="",N.value=!1,j.value="",r.car_id=null,r.car_name="",f.value="",s.length>=6){const e=T.inspection.filter(i=>i.plate_number===s);if(e.length>0){const i=["draft","in_progress","pending","pending_review","revision"],o=e.find(u=>i.includes(u.status));if(o)N.value=!0,$.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${o.status.replace(/_/g," ").toUpperCase()}. Silakan selesaikan inspeksi tersebut terlebih dahulu.`;else{const u=e.filter(x=>["approved","rejected","completed","cancelled"].includes(x.status));if(u.length>0){u.sort((ne,ae)=>new Date(ae.created_at)-new Date(ne.created_at));const x=u[0];r.car_id=x.car_id,r.car_name=x.car_name,f.value=x.car_name,K(x.car),j.value=`Nomor plat ini sudah pernah diperiksa ${u.length} kali sebelumnya.`}}}}});const le=()=>{const s={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name,category_id:r.category_id,is_scheduled:r.is_scheduled,inspector_id:r.inspector_id};r.is_scheduled&&(s.scheduled_at=`${r.scheduled_at_date} ${r.scheduled_at_time}`),r.post(route("inspections.store"),{preserveScroll:!0,onSuccess:e=>{if(s.is_scheduled)console.log("Inspeksi berhasil dijadwalkan.");else{const i=e.props.flash.newInspectionId;i?window.location.href=route("inspections.start",i):console.error("Tidak ada ID inspeksi baru yang dikembalikan.")}},onError:()=>{}})};return(s,e)=>(l(),me(he,{title:"Buat Inspeksi Baru"},{default:ge(()=>{var i;return[fe(a(be),{title:"Inspek Baru"}),t("div",ke,[t("div",we,[e[31]||(e[31]=t("div",{class:"mb-4"},[t("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),t("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),a(r).errors.form_error?(l(),n("div",Ce,m(a(r).errors.form_error),1)):c("",!0),t("div",Ie,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),t("div",Ae,[b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),type:"text",placeholder:"D",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[1]||(e[1]=o=>D("area")),maxlength:"2"},null,544),[[k,w.value]]),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>C.value=o),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[3]||(e[3]=o=>D("number")),maxlength:"4"},null,544),[[k,C.value]]),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>I.value=o),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[5]||(e[5]=o=>D("suffix")),maxlength:"3"},null,544),[[k,I.value]])]),$.value?(l(),n("div",Me,m($.value),1)):c("",!0),j.value?(l(),n("div",Be,m(j.value),1)):c("",!0)]),t("div",$e,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),t("div",je,[b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:e[7]||(e[7]=(...o)=>a(H)&&a(H)(...o)),onFocus:e[8]||(e[8]=o=>_.value=!0),onBlur:se},null,544),[[k,f.value]]),L.value?(l(),n("div",Ue,e[16]||(e[16]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),_.value?(l(),n("div",Ve,[B.value.length>0?(l(),n("div",Se,[(l(!0),n(V,null,S(B.value,o=>(l(),n("div",{key:o.id,class:"px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:u=>K(o)},[t("div",Le,m(A(o)),1)],40,Te))),128))])):(l(),n("div",Ne,e[17]||(e[17]=[Q(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),Q(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),t("div",De,[t("label",ze," Kategori Inspeksi "+m(a(F).id),1),b(t("select",{id:"category","onUpdate:modelValue":e[9]||(e[9]=o=>a(r).category_id=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[19]||(e[19]=t("option",{value:"",disabled:""},"Pilih Kategori",-1)),(l(!0),n(V,null,S(q.Category,o=>(l(),n("option",{key:o.id,value:o.id},m(o.name),9,Ee))),128))],512),[[W,a(r).category_id]])]),t("div",Pe,[e[21]||(e[21]=t("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),t("label",qe,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=o=>a(r).is_scheduled=o),id:"schedule-toggle",class:"sr-only peer"},null,512),[[ve,a(r).is_scheduled]]),e[20]||(e[20]=t("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),a(r).is_scheduled?(l(),n("div",Fe,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),b(t("input",{type:"date",id:"schedule-date","onUpdate:modelValue":e[11]||(e[11]=o=>a(r).scheduled_at_date=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[k,a(r).scheduled_at_date]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),b(t("input",{type:"time",id:"schedule-time","onUpdate:modelValue":e[12]||(e[12]=o=>a(r).scheduled_at_time=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[k,a(r).scheduled_at_time]])]),a(v).includes("Admin")||a(v).includes("coordinator")?(l(),n("div",He,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"inspector"}," Pilih Inspektor ",-1)),b(t("select",{id:"inspector","onUpdate:modelValue":e[13]||(e[13]=o=>a(r).inspector_id=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[24]||(e[24]=t("option",{value:"",disabled:""},"Pilih Inspektor",-1)),(l(!0),n(V,null,S(te.value,o=>(l(),n("option",{key:o.id,value:o.id},m(o.user.name),9,Ke))),128))],512),[[W,a(r).inspector_id]])])):c("",!0)])):c("",!0),t("div",Ge,[t("button",{onClick:le,disabled:!Y.value||a(r).processing||N.value,class:ye({"px-6 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600  border border-transparent text-white hover:bg-blue-700":!a(r).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600  border-transparent text-white hover:bg-green-700":a(r).is_scheduled})},m(ee.value),11,Je)]),a(r).car_id&&y.value?(l(),n("div",Re,[y.value.description?(l(),n("div",Ze,[e[26]||(e[26]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:y.value.description},null,8,Oe)])):c("",!0),d.value.length>0?(l(),n("div",Qe,[e[27]||(e[27]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",We,[(l(!0),n(V,null,S(d.value,(o,u)=>(l(),n("div",{key:o.id||u,class:"relative group cursor-pointer",onClick:x=>re(u)},[t("img",{src:G(o),alt:o.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ye),o.note?(l(),n("div",et,[t("p",tt,m(o.note),1)])):c("",!0)],8,Xe))),128))])])):(l(),n("div",st," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),U.value?(l(),n("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:z},[t("div",ot,[t("button",{onClick:z,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},e[28]||(e[28]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),d.value.length>1?(l(),n("button",{key:0,onClick:P(R,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[29]||(e[29]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),d.value.length>1?(l(),n("button",{key:1,onClick:P(J,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[30]||(e[30]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),t("img",{src:G(d.value[g.value]),alt:"Car Image "+(g.value+1),class:"max-w-full max-h-full object-contain",onClick:e[14]||(e[14]=P(()=>{},["stop"]))},null,8,rt),d.value.length>1?(l(),n("div",lt,m(g.value+1)+" / "+m(d.value.length),1)):c("",!0),(i=d.value[g.value])!=null&&i.note?(l(),n("div",nt,m(d.value[g.value].note),1)):c("",!0)])])):c("",!0)])])]}),_:1}))}},pt=_e(at,[["__scopeId","data-v-f3f95be6"]]);export{pt as default};
