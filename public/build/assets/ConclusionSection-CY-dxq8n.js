import{x as Ge,g as C,s as xe,C as ye,q as G,D as se,f as n,o as a,d as t,i as y,e as de,v as ie,y as ue,u as ae,F as P,k as ee,t as L,j as ne,p as fe,w as ve,n as te,I as me,a as Oe,b as Q,r as We,T as Ye,J as Je,L as we,W as Qe}from"./vendor-DPJBm0Ks.js";import{l as Ze}from"./lodash-ClzCekgx.js";import{_ as Pe}from"./PrimaryButton-C-PIn17F.js";import{_ as et}from"./ActionMessage-CMa7z5bQ.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as tt}from"./InputNumber-BiMi3Fbb.js";const st={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ot={key:0,class:"p-4 space-y-2"},at={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},it={class:"flex items-center space-x-2"},nt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},lt={class:"relative"},rt={key:0,class:"absolute right-3 top-3"},dt={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ut={key:0},ct=["onMousedown"],gt={class:"font-medium text-gray-900"},pt={class:"text-sm text-gray-500"},mt={key:1,class:"p-4 text-sm text-gray-500 text-center"},vt={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},ht={key:0,class:"mb-4"},ft=["innerHTML"],wt={key:1},bt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},xt=["onClick"],yt=["src","alt"],kt={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},$t={class:"text-white text-xs text-center"},It={key:2,class:"text-center py-4 text-gray-500 text-sm"},Vt={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},_t=["src","alt"],St={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Ct={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Mt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ut={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(e,{emit:A}){var l,k,f,N;const o=e,I=A,r=Ge({plate_number:((l=o.inspection)==null?void 0:l.plate_number)||"",car_id:((k=o.inspection)==null?void 0:k.car_id)||null,car_name:((N=(f=o.inspection)==null?void 0:f.car)==null?void 0:N.name)||""}),u=C(""),w=C(""),c=C(""),v=C(r.car_name),V=C(!1),x=C(!1),b=C([]),d=C(null),h=C([]),s=C(!1),_=C(0);xe(()=>{var i,g,D,p,R;if(z((i=o.inspection)==null?void 0:i.plate_number),(g=o.inspection)!=null&&g.car_id&&((D=o.CarDetail)==null?void 0:D.length)>0){const H=o.CarDetail.find(O=>O.id===o.inspection.car_id);H&&q(H)}else!((p=o.inspection)!=null&&p.car_id)&&((R=o.inspection)!=null&&R.car_name)&&(v.value=o.inspection.car_name);window.addEventListener("keydown",oe)}),ye(()=>{window.removeEventListener("keydown",oe)});const z=i=>{if(!i){u.value="",w.value="",c.value="";return}const g=i.toUpperCase().trim(),D=g.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(D)u.value=D[1]||"",w.value=D[2]||"",c.value=D[3]||"";else{let p="area",R="",H="",O="";for(const X of g)p==="area"&&/[A-Z]/.test(X)?R+=X:p==="area"&&/[0-9]/.test(X)?(p="number",H+=X):p==="number"&&/[0-9]/.test(X)?H+=X:p==="number"&&/[A-Z]/.test(X)?(p="suffix",O+=X):p==="suffix"&&/[A-Z]/.test(X)&&(O+=X);u.value=R,w.value=H,c.value=O}F()},F=()=>{const i=`${u.value}${w.value}${c.value}`;r.plate_number=i,le()},M=i=>{i==="area"?u.value=u.value.toUpperCase().replace(/[^A-Z]/g,""):i==="number"?w.value=w.value.replace(/[^0-9]/g,""):i==="suffix"&&(c.value=c.value.toUpperCase().replace(/[^A-Z]/g,"")),F()},E=i=>{var D,p,R;if(!i)return"";const g=[];return(D=i.brand)!=null&&D.name&&g.push(i.brand.name),(p=i.model)!=null&&p.name&&g.push(i.model.name),(R=i.type)!=null&&R.name&&g.push(i.type.name),i.cc&&g.push(`${i.cc}cc`),i.transmission&&g.push(i.transmission),i.fuel_type&&g.push(i.fuel_type),i.year&&g.push(i.year.toString()),i.production_period&&g.push(`(${i.production_period})`),g.join(" ")},B=Ze.debounce(()=>{if(!v.value.trim()){b.value=[],V.value=!1;return}x.value=!0;try{const i=v.value.toLowerCase().trim();b.value=o.CarDetail.filter(g=>E(g).toLowerCase().includes(i)),V.value=!0}finally{x.value=!1}},300),$=()=>{setTimeout(()=>{V.value=!1},200)},q=async i=>{d.value=i,v.value=E(i),r.car_id=i.id,r.car_name=E(i),V.value=!1,await Z(i.id),le()},j=i=>!i||!i.file_path?"":`/storage/${i.file_path}`,Z=async i=>{try{const g=await fetch(`/api/cars/${i}/images`);if(g.ok){const D=await g.json();h.value=Array.isArray(D)?D:[]}else h.value=[]}catch(g){console.error("Error loading car images:",g),h.value=[]}},K=i=>{_.value=i,s.value=!0,document.body.style.overflow="hidden"},Y=()=>{s.value=!1,document.body.style.overflow=""},W=()=>{_.value=(_.value+1)%h.value.length},J=()=>{_.value=(_.value-1+h.value.length)%h.value.length},oe=i=>{if(s.value)switch(i.key){case"Escape":Y();break;case"ArrowRight":W();break;case"ArrowLeft":J();break}},le=()=>{const i={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name};I("update-vehicle",i)},U=()=>{o.inspection&&r.post(route("inspections.updateVehicleDetails",{inspection:o.inspection.id}),{preserveScroll:!0})},T=G(()=>!!r.plate_number&&!!r.car_name);return se(()=>o.inspection,i=>{var g;if(i)if(z(i.plate_number),r.car_id=i.car_id||null,i.car_id&&((g=o.CarDetail)==null?void 0:g.length)>0){const D=o.CarDetail.find(p=>p.id===i.car_id);D&&q(D)}else i.car_name&&(v.value=i.car_name,r.car_name=i.car_name)},{deep:!0}),(i,g)=>{var D;return a(),n("div",st,[g[22]||(g[22]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),e.inspection?(a(),n("div",ot,[t("div",at,[g[11]||(g[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",it,[ie(t("input",{"onUpdate:modelValue":g[0]||(g[0]=p=>u.value=p),type:"text",placeholder:"Contoh: B",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[1]||(g[1]=p=>M("area")),maxlength:"2"},null,544),[[ue,u.value]]),ie(t("input",{"onUpdate:modelValue":g[2]||(g[2]=p=>w.value=p),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[3]||(g[3]=p=>M("number")),maxlength:"4"},null,544),[[ue,w.value]]),ie(t("input",{"onUpdate:modelValue":g[4]||(g[4]=p=>c.value=p),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[5]||(g[5]=p=>M("suffix")),maxlength:"3"},null,544),[[ue,c.value]])])]),t("div",nt,[g[14]||(g[14]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",lt,[ie(t("input",{"onUpdate:modelValue":g[6]||(g[6]=p=>v.value=p),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:g[7]||(g[7]=(...p)=>ae(B)&&ae(B)(...p)),onFocus:g[8]||(g[8]=p=>V.value=!0),onBlur:$},null,544),[[ue,v.value]]),x.value?(a(),n("div",rt,g[12]||(g[12]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):y("",!0),V.value?(a(),n("div",dt,[b.value.length>0?(a(),n("div",ut,[(a(!0),n(P,null,ee(b.value,p=>(a(),n("div",{key:p.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:R=>q(p)},[t("div",gt,L(E(p)),1),t("div",pt,L(p.year)+" • "+L(p.cc)+"cc • "+L(p.transmission)+" • "+L(p.fuel_type),1)],40,ct))),128))])):(a(),n("div",mt,g[13]||(g[13]=[ne(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),ne(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):y("",!0)]),ie(t("input",{type:"hidden","onUpdate:modelValue":g[9]||(g[9]=p=>ae(r).car_id=p)},null,512),[[ue,ae(r).car_id]])]),ae(r).car_id&&d.value?(a(),n("div",vt,[d.value.description?(a(),n("div",ht,[g[15]||(g[15]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:d.value.description},null,8,ft)])):y("",!0),h.value.length>0?(a(),n("div",wt,[g[16]||(g[16]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",bt,[(a(!0),n(P,null,ee(h.value,(p,R)=>(a(),n("div",{key:p.id||R,class:"relative group cursor-pointer",onClick:H=>K(R)},[t("img",{src:j(p),alt:p.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,yt),p.note?(a(),n("div",kt,[t("p",$t,L(p.note),1)])):y("",!0)],8,xt))),128))])])):(a(),n("div",It," Tidak ada gambar tersedia untuk mobil ini "))])):y("",!0),s.value?(a(),n("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:Y},[t("div",Vt,[t("button",{onClick:Y,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},g[17]||(g[17]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),h.value.length>1?(a(),n("button",{key:0,onClick:fe(J,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},g[18]||(g[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),h.value.length>1?(a(),n("button",{key:1,onClick:fe(W,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},g[19]||(g[19]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0),t("img",{src:j(h.value[_.value]),alt:"Car Image "+(_.value+1),class:"max-w-full max-h-full object-contain",onClick:g[10]||(g[10]=fe(()=>{},["stop"]))},null,8,_t),h.value.length>1?(a(),n("div",St,L(_.value+1)+" / "+L(h.value.length),1)):y("",!0),(D=h.value[_.value])!=null&&D.note?(a(),n("div",Ct,L(h.value[_.value].note),1)):y("",!0)])])):y("",!0),de(Pe,{type:"button",onClick:U,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!T.value},{default:ve(()=>[ae(r).processing?(a(),n("svg",Mt,g[20]||(g[20]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),t("span",null,L(ae(r).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),de(et,{on:ae(r).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:ve(()=>g[21]||(g[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ne(" Tersimpan. ")])),_:1,__:[21]},8,["on"])]),_:1},8,["disabled"])])):y("",!0)])}}},_a=ce(Ut,[["__scopeId","data-v-a54fbcbd"]]),jt={class:"mt-1"},Tt=["value","required","minlength","maxlength","allowSpace","placeholder"],Nt={key:0,class:"mt-2 text-sm text-red-600"},Rt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(e,{emit:A}){const o=e,I=A,r=G(()=>{if(!o.modelValue)return"";let w=o.modelValue;switch(o.allowSpace||(w=w.replace(/\s+/g,"")),o.textTransform){case"uppercase":return w.toUpperCase();case"lowercase":return w.toLowerCase();case"capitalize":return w.replace(/\b\w/g,c=>c.toUpperCase());default:return w}}),u=w=>{let c=w.target.value;switch(o.allowSpace||(c=c.replace(/\s+/g,"")),o.textTransform){case"uppercase":c=c.toUpperCase();break;case"lowercase":c=c.toLowerCase();break;case"capitalize":c=c.replace(/\b\w/g,v=>v.toUpperCase());break}I("update:modelValue",c),I("save",o.pointId)};return(w,c)=>(a(),n("div",jt,[t("input",{value:r.value,onInput:u,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,allowSpace:e.allowSpace,placeholder:e.placeholder,class:te(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:e.textTransform==="uppercase",lowercase:e.textTransform==="lowercase",capitalize:e.textTransform==="capitalize"}])},null,42,Tt),e.error?(a(),n("p",Nt,L(e.error),1)):y("",!0)]))}},Bt={class:"mt-1"},qt=["value","required","min","max"],Lt={key:0,class:"mt-2 text-sm text-red-600"},Dt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:A}){const o=e,I=A,r=u=>{I("update:modelValue",u.target.value),I("save",o.pointId)};return(u,w)=>(a(),n("div",Bt,[t("input",{value:e.modelValue,onChange:r,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,qt),e.error?(a(),n("p",Lt,L(e.error),1)):y("",!0)]))}},At={class:"mt-1"},Ft=["value","required","placeholder"],zt={key:0,class:"mt-2 text-sm text-red-600"},Et={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:A}){const o=e,I=A,r=C(""),u=G(()=>{var x,b,d,h;return{currency_symbol:((x=o.settings)==null?void 0:x.currency_symbol)||"Rp",thousands_separator:((b=o.settings)==null?void 0:b.thousands_separator)||",",min_value:((d=o.settings)==null?void 0:d.min_value)!==void 0?Number(o.settings.min_value):0,max_value:((h=o.settings)==null?void 0:h.max_value)!==void 0?Number(o.settings.max_value):1e9}}),w=x=>{if(x==null||x==="")return"";const b=Number(x);if(isNaN(b))return"";let d=b.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return u.value.thousands_separator!==","&&(d=d.replace(/,/g,u.value.thousands_separator)),d},c=x=>x?x.replace(/[^\d]/g,""):"",v=G(()=>r.value?`${u.value.currency_symbol} ${w(r.value)}`:""),V=x=>{let b=c(x.target.value),d=Number(b);u.value.min_value!==void 0&&d<u.value.min_value&&(b=u.value.min_value.toString()),u.value.max_value!==void 0&&d>u.value.max_value&&(b=u.value.max_value.toString()),r.value=b,I("update:modelValue",b),I("save",o.pointId)};return se(()=>o.modelValue,x=>{x!=null&&(r.value=x.toString())},{immediate:!0}),(x,b)=>(a(),n("div",At,[t("input",{value:v.value,onInput:V,type:"text",required:e.required,placeholder:e.placeholder,class:te(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,Ft),e.error?(a(),n("p",zt,L(e.error),1)):y("",!0)]))}},Ht={class:"mt-1 space-y-3"},Ot={key:0,class:"space-y-2"},Wt={class:"flex flex-wrap gap-2"},Zt=["onClick"],Kt=["value","required","minlength","maxlength","placeholder"],Xt={class:"flex justify-between items-center mt-1"},Gt={class:"text-xs text-gray-500"},Yt={key:0,class:"text-xs text-red-600"},Ke={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:A}){const o=e,I=A,r=C([]),u=C(""),w=x=>r.value.some(b=>b.value===x),c=x=>{w(x.value)?r.value=r.value.filter(s=>s.value!==x.value):r.value.push(x);const d=[...r.value.map(s=>s.value)];u.value.trim()&&d.push(u.value.trim());const h=d.join(", ");I("update:modelValue",h),I("save",{pointId:o.pointId,inspectionId:o.inspectionId,notes:h})},v=x=>{const b=x.target.value;I("update:modelValue",b),I("save",{pointId:o.pointId,inspectionId:o.inspectionId,notes:b}),V(b)},V=x=>{var s,_,z,F;if(!x){r.value=[],u.value="";return}const b=x.split(",").map(M=>M.trim()).filter(M=>M),d=((_=(s=o.settings)==null?void 0:s.damage_options)==null?void 0:_.map(M=>M.value))||[];r.value=((F=(z=o.settings)==null?void 0:z.damage_options)==null?void 0:F.filter(M=>b.includes(M.value)))||[];const h=b.filter(M=>!d.includes(M));u.value=h.join(", ")};return se(()=>o.modelValue,x=>{x!=null&&V(x)},{immediate:!0}),(x,b)=>{var d,h,s;return a(),n("div",Ht,[(d=e.settings)!=null&&d.enable_damage&&((h=e.settings)!=null&&h.damage_options)?(a(),n("div",Ot,[b[0]||(b[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",Wt,[(a(!0),n(P,null,ee(e.settings.damage_options,(_,z)=>(a(),n("button",{key:z,type:"button",onClick:F=>c(_),class:te(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":w(_.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!w(_.value)}])},L(_.label),11,Zt))),128))])])):y("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:v,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Kt),t("div",Xt,[t("span",Gt,L(((s=e.modelValue)==null?void 0:s.length)||0)+"/"+L(e.maxLength||400),1),e.error?(a(),n("p",Yt,L(e.error),1)):y("",!0)])])])}}},Jt={class:"mt-1"},Qt=["value","required"],Pt={key:0,class:"mt-2 text-sm text-red-600"},es={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:A}){const o=e,I=A,r=u=>{I("update:modelValue",u.target.value),I("save",o.pointId)};return(u,w)=>(a(),n("div",Jt,[t("select",{value:e.modelValue,onChange:r,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},w[0]||(w[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,Qt),e.error?(a(),n("p",Pt,L(e.error),1)):y("",!0)]))}},ts=ce(es,[["__scopeId","data-v-c34a74db"]]),ss={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},os={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},as={class:"flex flex-row space-x-4 mb-6"},is={class:"mt-4 text-right"},ns={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(A,o)=>e.show?(a(),n("div",ss,[t("div",os,[o[5]||(o[5]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),t("div",as,[t("button",{onClick:o[0]||(o[0]=I=>A.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},o[3]||(o[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:o[1]||(o[1]=I=>A.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},o[4]||(o[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",is,[t("button",{onClick:o[2]||(o[2]=I=>A.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):y("",!0)}},ls={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},rs={class:"webcam-content-box"},ds={class:"webcam-header"},us={class:"inspection-point-name"},cs={key:0,class:"screen-flash-overlay"},gs={key:2,class:"zoom-controls"},ps=["max"],ms={class:"webcam-footer"},vs={class:"camera-controls"},hs=["disabled"],fs={class:"camera-icon-container"},ws={key:0,class:"camera-spinner"},bs={key:1,class:"camera-body"},xs={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(e,{emit:A}){const o=e,I=A,r=C(null),u=C(null);let w=null,c=null;const v=C("environment"),V=C(!1),x=C(!1),b=C(!1),d=C(!1),h=C(!1),s=C({}),_=C(!1),z=C(1),F=C(1),M=C(!1),E=G(()=>{var U;return((U=o.settings)==null?void 0:U.max_size)||2048}),B=G(()=>o.aspectRatio?{aspectRatio:`${o.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),$=G(()=>{if(!o.aspectRatio)return{};const U=o.aspectRatio,T=U>1?80:60,l=U>1?80/U:60*U;return{width:`${T}%`,height:`${l}%`}}),q=async()=>{w&&w.getTracks().forEach(U=>U.stop());try{const U={facingMode:v.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:o.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};w=await navigator.mediaDevices.getUserMedia({video:U,audio:!1}),c=w.getVideoTracks()[0],r.value.srcObject=w,r.value.onloadedmetadata=async()=>{await Z(),await r.value.play()}}catch(U){console.error("Error accessing camera: ",U),alert("Failed to access camera. Please allow camera permission."),I("close")}},j=()=>{w&&w.getTracks().forEach(U=>U.stop()),I("close")},Z=async()=>{if(c)try{const U=await navigator.mediaDevices.enumerateDevices();V.value=U.filter(l=>l.kind==="videoinput").length>1;const T=c.getCapabilities();T.zoom?(M.value=!0,F.value=T.zoom.max,console.log(`Zoom supported. Max zoom: ${F.value}`)):(M.value=!1,console.warn("Zoom is not supported by this camera.")),x.value=T.torch||T.fillLightMode&&T.fillLightMode.includes("torch")}catch(U){console.error("Error checking camera capabilities:",U)}},K=async U=>{if(!c)return;const T=r.value.getBoundingClientRect(),l=U.clientX-T.left,k=U.clientY-T.top;h.value=!0,s.value={left:`${l}px`,top:`${k}px`,transform:"translate(-50%, -50%)"};try{if(c.getCapabilities().pointsOfInterest){const N=l/T.width,i=k/T.height;await c.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:N,y:i}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(f){console.warn("Manual focus failed:",f)}setTimeout(()=>{h.value=!1,c.getCapabilities().focusMode.includes("continuous")&&c.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},Y=async U=>{if(!c||!M.value)return;const T=Math.min(Math.max(U,1),F.value);z.value=T;try{await c.applyConstraints({advanced:[{zoom:T}]})}catch(l){console.error("Failed to set zoom:",l)}},W=async()=>{if(!(!c||!x.value))try{v.value==="user"?(b.value=!b.value,d.value=b.value):(await c.applyConstraints({advanced:[{torch:!b.value}]}),b.value=!b.value)}catch(U){console.error("Flash toggle failed:",U)}},J=async()=>{V.value&&(v.value=v.value==="environment"?"user":"environment",w&&w.getTracks().forEach(U=>U.stop()),await q())},oe=async U=>new Promise(T=>{const l=E.value*1024;if(U.size<=l){T(U);return}const k=new Image,f=new FileReader;f.onload=N=>{k.onload=()=>{const i=document.createElement("canvas"),g=i.getContext("2d"),D=Math.sqrt(l/U.size);i.width=k.width*D,i.height=k.height*D,g.drawImage(k,0,0,i.width,i.height);let p=.9;const R=()=>{i.toBlob(H=>{H.size>l&&p>.1?(p-=.1,R()):T(H)},"image/jpeg",p)};R()},k.src=N.target.result},f.readAsDataURL(U)}),le=async()=>{if(!(_.value||!r.value||!u.value)){_.value=!0;try{const U=r.value,T=u.value,l=U.videoWidth,k=U.videoHeight;let f,N,i,g;l/k>o.aspectRatio?(N=k,f=k*o.aspectRatio,i=(l-f)/2,g=0):(f=l,N=l/o.aspectRatio,i=0,g=(k-N)/2),T.width=f,T.height=N,T.getContext("2d").drawImage(U,i,g,f,N,0,0,f,N);const p=await new Promise(H=>{T.toBlob(H,"image/jpeg",1)}),R=await oe(p);if(R){const H=new File([R],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});I("photoCaptured",H),d.value=!0,setTimeout(()=>{d.value=!1},100)}}catch(U){console.error("Error capturing photo:",U),alert("Failed to capture photo. Please try again.")}finally{_.value=!1}}};return se(()=>o.show,U=>{U?q():j()}),ye(()=>{w&&w.getTracks().forEach(U=>U.stop())}),(U,T)=>{var l;return e.show?(a(),n("div",ls,[t("div",rs,[t("div",ds,[t("div",us,L(((l=e.point)==null?void 0:l.name)||"Camera"),1),t("button",{onClick:j,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},T[2]||(T[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:me(B.value),onClick:K,onTouchstart:K},[t("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:u,class:"hidden"},null,512),d.value?(a(),n("div",cs)):y("",!0),t("div",{class:"aspect-ratio-guide",style:me($.value)},null,4),h.value?(a(),n("div",{key:1,class:"focus-indicator",style:me(s.value)},T[3]||(T[3]=[t("div",{class:"focus-ring"},null,-1)]),4)):y("",!0),T[4]||(T[4]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),M.value?(a(),n("div",gs,[ie(t("input",{type:"range",min:"1",max:F.value,step:"0.1","onUpdate:modelValue":T[0]||(T[0]=k=>z.value=k),onInput:T[1]||(T[1]=k=>Y(parseFloat(k.target.value))),class:"zoom-slider"},null,40,ps),[[ue,z.value]])])):y("",!0)],36),t("div",ms,[t("div",vs,[e.settings.enable_flash&&x.value?(a(),n("button",{key:0,onClick:W,class:te(["control-button",{active:b.value,disabled:!x.value}])},T[5]||(T[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):y("",!0),t("button",{onClick:le,class:"capture-button",disabled:_.value},[t("div",fs,[_.value?(a(),n("div",ws)):(a(),n("div",bs,T[6]||(T[6]=[t("div",{class:"camera-lens"},null,-1),t("div",{class:"camera-flash"},null,-1)])))])],8,hs),e.settings.enable_camera_switch&&V.value?(a(),n("button",{key:1,onClick:J,class:"control-button"},T[7]||(T[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):y("",!0)])])])])):y("",!0)}}},ys=ce(xs,[["__scopeId","data-v-a032b4ac"]]),ks={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},$s={class:"w-full h-full flex flex-col"},Is={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Vs={class:"text-lg font-semibold"},_s={class:"flex items-center gap-2"},Ss={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Cs=["src"],Ms={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Us={class:"flex justify-between items-center w-full"},js=["disabled"],Ts={key:1,class:"flex-1"},Ns=["disabled"],Rs={class:"flex gap-3 w-full"},Bs=["disabled"],qs={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},Ls={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(e,{emit:A}){const o=e,I=A,r=C(0),u=C([]),w=C(0),c=C(0),v=G(()=>u.value.length>0?u.value[r.value]:null);se(()=>o.images,B=>{u.value=B.map($=>({...$,rotation:$.rotation||0})),B.length===0&&o.show&&F()},{deep:!0,immediate:!0}),se(()=>o.show,B=>{B&&o.images.length>0&&(r.value=o.initialIndex)});const V=B=>B.preview||(B.image_path?`/${B.image_path}`:""),x=()=>{if(v.value){const B=(v.value.rotation+90)%360;u.value[r.value].rotation=B,I("update:images",u.value)}},b=()=>{r.value=r.value<u.value.length-1?r.value+1:0},d=()=>{r.value=r.value>0?r.value-1:u.value.length-1},h=B=>{w.value=B.touches[0].clientX},s=B=>{c.value=B.touches[0].clientX},_=()=>{w.value-c.value>50?b():c.value-w.value>50&&d(),w.value=0,c.value=0},z=()=>{o.isUploading||I("saveImages",u.value)},F=()=>{o.isUploading||I("close")},M=()=>{if(v.value&&!o.isUploading){const B=v.value,$=u.value.findIndex(q=>q.isNew&&B.isNew&&q.preview===B.preview||!q.isNew&&!B.isNew&&q.id===B.id);$!==-1&&(I("removePreviewImage",B),u.value.splice($,1),I("update:images",u.value)),r.value>=u.value.length&&(r.value=Math.max(0,u.value.length-1)),u.value.length===0&&I("close")}},E=()=>{o.isUploading||I("triggerAddMorePhotos")};return(B,$)=>{var q;return e.show?(a(),n("div",ks,[t("div",$s,[t("div",Is,[t("button",{onClick:F,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},$[0]||($[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",Vs,L(((q=e.point)==null?void 0:q.name)||"Preview")+" ("+L(r.value+1)+"/"+L(u.value.length)+") ",1),t("div",_s,[v.value&&v.value.isNew?(a(),n("button",{key:0,onClick:M,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},$[1]||($[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):y("",!0),t("button",{onClick:x,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},$[2]||($[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))])]),t("div",Ss,[t("div",{class:"relative w-full max-w-full",style:me({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"}),onTouchstart:h,onTouchmove:s,onTouchend:_},[v.value?(a(),n("img",{key:0,src:V(v.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:me({transform:`rotate(${v.value.rotation}deg)`})},null,12,Cs)):y("",!0)],36),u.value.length>1?(a(),n("button",{key:0,onClick:d,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},$[3]||($[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),u.value.length>1?(a(),n("button",{key:1,onClick:b,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},$[4]||($[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0)]),t("div",Ms,[t("div",Us,[v.value&&!v.value.isNew?(a(),n("button",{key:0,onClick:M,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:e.isUploading},$[5]||($[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ne(" Hapus Foto ")]),8,js)):(a(),n("div",Ts)),e.allowMultiple&&u.value.length<e.maxFiles?(a(),n("button",{key:2,onClick:E,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:e.isUploading},$[6]||($[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ne(" Tambah Foto ")]),8,Ns)):y("",!0)]),t("div",Rs,[t("button",{onClick:F,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:e.isUploading}," Batal ",8,Bs),e.isUploading?(a(),n("button",qs,$[7]||($[7]=[ne(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(a(),n("button",{key:0,onClick:z,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):y("",!0)}}},Ds=ce(Ls,[["__scopeId","data-v-4ea64c3d"]]),As=["accept","multiple","disabled"],Fs=["disabled"],zs={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Es={class:"text-xs text-gray-400 mt-1"},Hs={key:0,class:"flex items-center gap-4"},Os=["src"],Ws=["disabled"],Zs={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Ks=["disabled"],Xs=["onClick"],Gs=["src"],Ys={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Js={key:0},Qs={key:1,class:"ml-1"},Ps={key:2,class:"mt-1 text-xs text-red-600"},eo={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:A}){const o=e,I=A,r=C(null),u=C(null),w=C(!1),c=C(!1),v=C(!1),V=C([]),x=C(0),b=C(!1),d=G(()=>Number(o.settings.max_files)>1),h=G(()=>o.settings.allowed_types.map(l=>`.${l}`).join(", ")),s=G(()=>{const l=o.settings.camera_aspect_ratio.split(":");if(l.length===2){const k=parseFloat(l[0]),f=parseFloat(l[1]);if(!isNaN(k)&&!isNaN(f)&&f!==0)return k/f}return 3/4}),_=G(()=>{const l=[],k=new Set;for(const f of V.value)f.id&&k.add(f.id),l.push(f);for(const f of o.modelValue)k.has(f.id)||l.push({...f,rotation:f.rotation||0,isNew:!1,preview:f.preview||(f.image_path?`/${f.image_path}`:null)});return l}),z=l=>l.preview||(l.image_path?`/${l.image_path}`:""),F=()=>{v.value&&(v.value=!1),w.value=!0},M=()=>{w.value=!1,r.value.click()},E=()=>{w.value=!1,c.value=!0},B=()=>{w.value=!1,_.value.length>0&&(v.value=!0)},$=()=>{c.value=!1,_.value.length>0&&(v.value=!0)},q=()=>{v.value=!1,V.value.forEach(l=>{l.preview&&l.preview.startsWith("blob:")&&URL.revokeObjectURL(l.preview)}),V.value=[]},j=l=>new Promise(k=>{const f=new FileReader;f.onload=N=>{const i=new Image;i.onload=()=>{k({file:l,preview:URL.createObjectURL(l),rotation:0,width:i.naturalWidth,height:i.naturalHeight,isNew:!0})},i.onerror=()=>{console.error("Failed to load image for dimensions:",l.name),k({file:l,preview:URL.createObjectURL(l),rotation:0,width:0,height:0,isNew:!0})},i.src=N.target.result},f.readAsDataURL(l)}),Z=l=>{const k=l.name.split(".").pop().toLowerCase();return o.settings.allowed_types.includes(k)},K=async l=>{const f=(o.settings.max_size||2048)*1024;return new Promise(N=>{const i=new Image,g=new FileReader;g.onload=D=>{i.onload=()=>{const p=document.createElement("canvas"),R=p.getContext("2d"),H=Math.max(i.width,i.height);p.width=H,p.height=H,R.fillStyle="white",R.fillRect(0,0,H,H);const O=(H-i.width)/2,X=(H-i.height)/2;R.drawImage(i,O,X,i.width,i.height);let re=.9;const ge=()=>{p.toBlob(pe=>{if(pe.size>f&&re>.1)re-=.1,ge();else{const he=new File([pe],l.name,{type:"image/jpeg",lastModified:Date.now()});N(he)}},"image/jpeg",re)};ge()},i.src=D.target.result},g.readAsDataURL(l)})},Y=async l=>{const k=Array.from(l.target.files);if(!k.length){w.value=!1,_.value.length>0&&(v.value=!0);return}try{const f=k.filter(R=>!Z(R));if(f.length>0){const R=f.map(H=>H.name.split(".").pop()).join(", ");alert(`File type not allowed: ${R}. Allowed types: ${o.settings.allowed_types.join(", ")}`),l.target.value="";return}const N=_.value.length,i=o.settings.max_files-N,g=await Promise.all(k.slice(0,i).map(async R=>await K(R))),D=await Promise.all(g.map(j)),p=d.value?D:D.slice(0,1);d.value?V.value.push(...p):(V.value.forEach(R=>{R.preview&&R.preview.startsWith("blob:")&&URL.revokeObjectURL(R.preview)}),V.value=p),w.value=!1,p.length>0?(x.value=Math.max(0,_.value.length-p.length),v.value=!0):_.value.length>0&&(v.value=!0),l.target.value=""}catch(f){console.error("Error processing selected images:",f),alert("Failed to process selected images. Please try again."),w.value=!1,_.value.length>0&&(v.value=!0)}},W=async l=>{const k=_.value.length;if(!d.value||k<o.settings.max_files)try{const f=await K(l),N=new Image;N.onload=()=>{const i={file:f,preview:URL.createObjectURL(f),rotation:0,width:N.naturalWidth,height:N.naturalHeight,isNew:!0};d.value?V.value.push(i):(V.value.forEach(g=>{g.preview&&g.preview.startsWith("blob:")&&URL.revokeObjectURL(g.preview)}),V.value=[i]),c.value=!1,w.value=!1,x.value=_.value.length-1,v.value=!0},N.src=URL.createObjectURL(f)}catch(f){console.error("Error processing captured image:",f),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${o.settings.max_files} files allowed.`),c.value=!1,w.value=!1,_.value.length>0&&(v.value=!0)},J=(l=0)=>{x.value=l,v.value=!0},oe=l=>new Promise(k=>{if(l.rotation===0||!u.value){if(!l.isNew&&!l.file){k({file:null,width:l.width,height:l.height,isOriginal:!0});return}k({file:l.file,width:l.width,height:l.height});return}const f=new Image;f.onload=async()=>{try{const N=u.value,i=N.getContext("2d"),g=f.width,D=f.height;let p,R;l.rotation===90||l.rotation===270?(p=D,R=g):(p=g,R=D),N.width=p,N.height=R,i.clearRect(0,0,N.width,N.height),i.translate(N.width/2,N.height/2),i.rotate(l.rotation*Math.PI/180),i.drawImage(f,-g/2,-D/2,g,D),i.setTransform(1,0,0,1,0,0);const H=await new Promise(re=>{N.toBlob(re,"image/jpeg",.9)}),O=new File([H],l.file?l.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),X=await K(O);k({file:X,width:p,height:R})}catch(N){console.error("Error processing rotated image:",N),k({file:l.file,width:l.width,height:l.height})}},f.onerror=()=>{console.error("Failed to load image for rotation processing:",l.preview),k({file:l.file,width:l.width,height:l.height})},f.src=l.preview}),le=async l=>{var N,i,g,D;b.value=!0;const k=[],f=[];if(!o.pointId){alert("Error: Point ID is missing. Cannot upload image."),b.value=!1;return}try{for(const p of l){if(!p.isNew&&p.rotation===0&&p.id&&p.image_path){k.push({id:p.id,image_path:p.image_path,width:p.width,height:p.height,rotation:0,preview:p.preview});continue}const{file:R,width:H,height:O,isOriginal:X}=await oe(p);if(X&&!p.isNew){k.push({id:p.id,image_path:p.image_path,width:p.width,height:p.height,rotation:0,preview:p.preview});continue}R&&f.push({file:R,width:H,height:O,rotation:0})}if(f.length>0){const p=new FormData;p.append("inspection_id",o.inspectionId),p.append("point_id",o.pointId),f.forEach(O=>{p.append("images[]",O.file)});const H=(await Oe.post(route("inspections.upload-image"),p,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const O of H)k.push({id:O.image_id,image_path:O.path,width:O.width||0,height:O.height||0,rotation:O.rotation||0,preview:O.public_url});f.forEach(O=>{O.file&&O.file.preview&&O.file.preview.startsWith("blob:")&&URL.revokeObjectURL(O.file.preview)})}I("update:modelValue",k),I("save",o.pointId),I("uploaded",{pointId:o.pointId,images:k}),q()}catch(p){if(console.error("Error during image processing/upload:",p),(i=(N=p.response)==null?void 0:N.data)!=null&&i.message)alert(`Failed to save images: ${p.response.data.message}`);else if((D=(g=p.response)==null?void 0:g.data)!=null&&D.errors){const R=Object.values(p.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${R}`)}else alert(`Failed to save images: ${p.message}`)}finally{b.value=!1}},U=l=>{if(l){if(l.id&&!l.isNew)T(l);else{const k=V.value.findIndex(f=>f.preview&&f.preview===l.preview&&f.isNew||f.id&&f.id===l.id);if(k!==-1){const f=V.value.splice(k,1)[0];f.preview&&f.preview.startsWith("blob:")&&URL.revokeObjectURL(f.preview)}I("update:modelValue",o.modelValue.filter(f=>!(f.id&&f.id===l.id)&&!(f.preview&&f.preview===l.preview)))}x.value>=_.value.length&&(x.value=Math.max(0,_.value.length-1)),_.value.length===0&&q()}},T=async l=>{var f,N;if(l.id||l.image_path)try{await Oe.delete(route("inspections.delete-image"),{data:{image_id:l.id,image_path:l.image_path}})}catch(i){console.error("Error deleting image from server:",i),(N=(f=i.response)==null?void 0:f.data)!=null&&N.message?alert(`Failed to delete image from server: ${i.response.data.message}`):alert(`Failed to delete image from server: ${i.message}`);return}l.preview&&l.preview.startsWith("blob:")&&URL.revokeObjectURL(l.preview);const k=o.modelValue.filter(i=>i.id!==l.id);I("update:modelValue",k),V.value=V.value.filter(i=>i.isNew&&l.isNew?i.preview!==l.preview:i.id!==l.id),I("removeImage",{image:l}),v.value&&_.value.length===0?q():v.value&&x.value>=_.value.length&&(x.value=Math.max(0,_.value.length-1))};return(l,k)=>(a(),n("div",null,[t("input",{ref_key:"galleryInput",ref:r,type:"file",accept:h.value,class:"hidden",onChange:Y,multiple:d.value,disabled:b.value},null,40,As),t("canvas",{ref_key:"processingCanvas",ref:u,class:"hidden"},null,512),_.value.length===0?(a(),n("label",{key:0,onClick:F,class:te(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:b.value},[t("div",zs,[k[2]||(k[2]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),k[3]||(k[3]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),k[4]||(k[4]=t("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),t("p",Es,"Allowed types: "+L(h.value),1)])],8,Fs)):(a(),n("div",{key:1,class:te(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":e.settings.max_files==1,"bg-transparent":e.settings.max_files>1}]),"aria-label":"Image gallery"},[e.settings.max_files===1?(a(),n("div",Hs,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:k[0]||(k[0]=f=>J(0))},[t("img",{src:z(_.value[0]),class:"w-full h-full object-cover"},null,8,Os)]),t("button",{onClick:k[1]||(k[1]=fe(f=>T(_.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:b.value},k[5]||(k[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ne(" Hapus Foto ")]),8,Ws)])):(a(),n("div",Zs,[d.value&&_.value.length<e.settings.max_files?(a(),n("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:F,disabled:b.value},k[6]||(k[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Ks)):y("",!0),(a(!0),n(P,null,ee(_.value,(f,N)=>(a(),n("div",{key:f.id||f.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:i=>J(N)},[t("img",{src:z(f),class:"w-full h-full object-cover"},null,8,Gs),f.isNew||f.rotation!==0?(a(),n("div",Ys,[f.isNew?(a(),n("span",Js,"BARU")):y("",!0),f.rotation!==0?(a(),n("span",Qs,"ROTASI")):y("",!0)])):y("",!0)],8,Xs))),128))]))],2)),e.error?(a(),n("p",Ps,L(e.error),1)):y("",!0),de(ns,{show:w.value,onClose:B,onOpenWebcam:E,onTriggerGallery:M},null,8,["show"]),de(ys,{show:c.value,"aspect-ratio":s.value,settings:e.settings,point:e.point,onClose:$,onPhotoCaptured:W},null,8,["show","aspect-ratio","settings","point"]),de(Ds,{show:v.value,images:_.value,point:e.point,"initial-index":x.value,"allow-multiple":d.value,"max-files":e.settings.max_files,"is-uploading":b.value,"aspect-ratio":s.value,onClose:q,onSaveImages:le,onRemovePreviewImage:U,onTriggerAddMorePhotos:F},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},be=ce(eo,[["__scopeId","data-v-396cd9aa"]]),to={key:0,class:"fixed inset-0 z-50 overflow-hidden"},so={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},oo={class:"px-4 pb-2 border-b border-gray-200"},ao={class:"text-lg font-semibold text-gray-900"},io={key:0,class:"text-sm text-gray-500 mt-1"},no={class:"flex-1 overflow-y-auto p-4"},lo={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},ro={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:A}){const o=A,I=()=>{o("close")},r=u=>{u.key==="Escape"&&I()};return xe(()=>{document.addEventListener("keydown",r)}),ye(()=>{document.removeEventListener("keydown",r)}),(u,w)=>(a(),Q(Ye,{name:"bottom-sheet"},{default:ve(()=>[e.show?(a(),n("div",to,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:I}),t("div",so,[w[0]||(w[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",oo,[t("h3",ao,L(e.title),1),e.subtitle?(a(),n("p",io,L(e.subtitle),1)):y("",!0)]),t("div",no,[We(u.$slots,"default",{},void 0,!0)]),u.$slots.footer?(a(),n("div",lo,[We(u.$slots,"footer",{},void 0,!0)])):y("",!0)])])):y("",!0)]),_:3}))}},uo=ce(ro,[["__scopeId","data-v-7893c2dc"]]),co={class:"space-y-4"},go={key:0,class:"mt-2"},po={class:"text-sm font-medium text-gray-700 mb-2"},mo={key:0,class:"text-red-500"},vo={key:0,class:"text-xs text-red-500"},ho={key:1,class:"grid grid-cols-2 gap-2"},fo=["name","value","checked"],wo={key:2,class:"space-y-2"},bo={key:0,class:"text-red-500"},xo={key:1,class:"text-xs text-red-500"},yo={key:3,class:"mt-4"},ko={class:"text-sm font-medium text-gray-700 mb-2"},$o={key:0,class:"text-red-500"},Io={key:0,class:"text-xs text-red-500"},Vo={class:"flex gap-2"},_o=["disabled"],Xe={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(e,{emit:A}){const o=e,I=A,r=c=>I("hapus",c),u=G(()=>o.options.find(c=>c.value===o.selectedValue)),w=G(()=>{var v,V,x;if(o.point.input_type==="imageTOradio"&&o.imagesValue.length===0||o.options.length&&!o.selectedValue)return!1;const c=u.value;return!(o.showTextarea&&((v=c==null?void 0:c.settings)!=null&&v.show_textarea)&&(!((V=o.notesValue)!=null&&V.trim())||c.settings.min_length&&o.notesValue.length<c.settings.min_length||c.settings.max_length&&o.notesValue.length>c.settings.max_length)||o.showImageUpload&&((x=c==null?void 0:c.settings)!=null&&x.show_image_upload)&&(o.imagesValue.length===0||c.settings.max_files&&o.imagesValue.length>c.settings.max_files))});return(c,v)=>(a(),Q(uo,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:v[10]||(v[10]=V=>c.$emit("close"))},{footer:ve(()=>[e.selectedPoint?(a(),n("button",{key:0,onClick:v[7]||(v[7]=V=>r(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},v[12]||(v[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ne(" Hapus Data ")]))):y("",!0),t("div",Vo,[t("button",{type:"button",onClick:v[8]||(v[8]=V=>c.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:v[9]||(v[9]=V=>c.$emit("save")),disabled:!w.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,_o)])]),default:ve(()=>{var V,x,b,d,h,s,_,z,F,M,E,B,$,q;return[t("div",co,[e.point.input_type==="imageTOradio"?(a(),n("div",go,[t("h4",po,[(V=e.point.settings)!=null&&V.required?(a(),n("span",mo,"*")):y("",!0)]),de(be,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point.inspection_point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":v[0]||(v[0]=j=>c.$emit("update:imagesValue",j)),onSave:v[1]||(v[1]=j=>c.$emit("saveImage",j))},null,8,["model-value","point-id","point","inspection-id","settings"]),(x=e.point.settings)!=null&&x.required&&e.imagesValue.length===0?(a(),n("p",vo," Foto wajib diupload ")):y("",!0)])):y("",!0),e.options.length?(a(),n("div",ho,[(a(!0),n(P,null,ee(e.options,(j,Z)=>(a(),n("label",{key:Z,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:j.value,checked:e.selectedValue===j.value,onChange:v[2]||(v[2]=K=>c.$emit("update:selectedValue",K.target.value)),class:"hidden peer"},null,40,fo),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===j.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==j.value}])},L(j.label),3)]))),128))])):y("",!0),e.showTextarea&&((d=(b=u.value)==null?void 0:b.settings)!=null&&d.show_textarea)?(a(),n("div",wo,[(h=u.value.settings)!=null&&h.required?(a(),n("span",bo,"*")):y("",!0),de(Ke,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:u.value.settings,required:(s=u.value.settings)==null?void 0:s.required,"min-length":(_=u.value.settings)==null?void 0:_.min_length,"max-length":(z=u.value.settings)==null?void 0:z.max_length,placeholder:((F=u.value.settings)==null?void 0:F.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":v[3]||(v[3]=j=>c.$emit("update:notesValue",j)),onSave:v[4]||(v[4]=j=>c.$emit("saveTextarea",j))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(M=u.value.settings)!=null&&M.required&&!e.notesValue?(a(),n("p",xo," Keterangan wajib diisi ")):y("",!0)])):y("",!0),e.showImageUpload&&((B=(E=u.value)==null?void 0:E.settings)!=null&&B.show_image_upload)?(a(),n("div",yo,[t("h4",ko,[v[11]||(v[11]=ne(" Upload Foto ")),($=u.value.settings)!=null&&$.required?(a(),n("span",$o,"*")):y("",!0)]),de(be,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:u.value.settings,"onUpdate:modelValue":v[5]||(v[5]=j=>c.$emit("update:imagesValue",j)),onSave:v[6]||(v[6]=j=>c.$emit("saveImage",j))},null,8,["model-value","point-id","point","inspection-id","settings"]),(q=u.value.settings)!=null&&q.required&&e.imagesValue.length===0?(a(),n("p",Io," Foto wajib diupload ")):y("",!0)])):y("",!0)])]}),_:1},8,["show","title","subtitle"]))}},So={class:"mt-2 space-y-4"},Co={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Mo=["name","value","checked","onChange","required"],Uo={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},jo={key:0,class:"mt-3"},To={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},No=["src"],Ro={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Bo={key:1,class:"mt-2"},qo={class:"text-sm text-gray-600"},Lo={key:2,class:"mt-2 text-sm text-red-600"},Do={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:A}){const o=e,I=A,r=C(o.notes),u=C([...o.images]),w=C(!1),c=C(""),v=C([]),V=C(""),x=C([]),b=G(()=>o.options.find($=>$.value===o.modelValue)),d=$=>$.settings&&($.settings.show_textarea||$.settings.show_image_upload);se(()=>o.notes,$=>{r.value=$}),se(()=>o.images,$=>{u.value=[...$]}),se(()=>o.modelValue,$=>{$&&(V.value=$)});const h=$=>{I("update:modelValue",$.value),d($)?_():I("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:$.value,notes:"",images:[]})},s=$=>$.preview||($.image_path?`/${$.image_path}`:$),_=()=>{V.value=o.modelValue,c.value=r.value,v.value=[...u.value],x.value=[...u.value],w.value=!0},z=()=>{c.value="",v.value=[],V.value="",w.value=!1},F=$=>{v.value=$,u.value=[...$],I("update:images",[...$]),I("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:o.modelValue,notes:r.value,images:[...$]})},M=$=>{},E=()=>{V.value!==o.modelValue&&I("update:modelValue",V.value),r.value=c.value,I("update:notes",c.value),u.value=[...v.value],I("update:images",[...v.value]),I("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:V.value,notes:c.value,images:v.value}),w.value=!1},B=$=>{I("hapus",$),w.value=!1};return($,q)=>{var j,Z,K,Y;return a(),n("div",So,[t("div",Co,[(a(!0),n(P,null,ee(e.options,(W,J)=>(a(),n("label",{key:J,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:W.value,checked:e.modelValue===W.value,onChange:oe=>h(W),class:"hidden peer",required:e.required},null,40,Mo),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===W.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==W.value}])},L(W.label),3)]))),128))]),e.modelValue&&b.value&&d(b.value)?(a(),n("div",Uo,[t("div",{class:"flex justify-between items-start"},[q[4]||(q[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:_,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((j=b.value.settings)!=null&&j.show_image_upload)?(a(),n("div",jo,[t("div",To,[(a(!0),n(P,null,ee(e.images,(W,J)=>(a(),n("div",{key:J,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:s(W),class:"w-full h-full object-cover rounded"},null,8,No),J===3&&e.images.length>4?(a(),n("span",Ro," +"+L(e.images.length-4),1)):y("",!0)]))),128))])])):y("",!0),e.notes&&((Z=b.value.settings)!=null&&Z.show_textarea)?(a(),n("div",Bo,[t("p",qo,L(e.notes),1)])):y("",!0)])):y("",!0),w.value?(a(),Q(Xe,{key:(K=e.selectedPoint)==null?void 0:K.id,show:w.value,title:e.pointName||"Detail",subtitle:(Y=b.value)==null?void 0:Y.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":V.value,"notes-value":c.value,"images-value":v.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":q[0]||(q[0]=W=>V.value=W),"onUpdate:notesValue":q[1]||(q[1]=W=>c.value=W),"onUpdate:imagesValue":q[2]||(q[2]=W=>F(W)),onClose:z,onSave:E,onSaveTextarea:$.handleTextareaSave,onSaveImage:M,onHapus:q[3]||(q[3]=W=>B(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):y("",!0),e.error?(a(),n("p",Lo,L(e.error),1)):y("",!0)])}}},Ao={class:"mt-2 space-y-4"},Fo={key:0,class:"flex flex-wrap gap-3"},zo={key:1,class:"p-4 border rounded-lg bg-gray-50"},Eo={key:0,class:"mt-3"},Ho={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Oo=["src"],Wo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Zo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},Ko=["name","value","checked"],Xo={key:1,class:"mt-2"},Go={class:"text-sm text-gray-600"},Yo={key:3,class:"mt-2 text-sm text-red-600"},Jo={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:A}){const o=e,I=A,r=C(o.notes),u=C([...o.images]),w=C(!1),c=C(""),v=C([]),V=C(""),x=C([]),b=G(()=>o.options.find(M=>M.value===o.modelValue)),d=M=>M.preview||(M.image_path?`/${M.image_path}`:M),h=()=>{V.value=o.modelValue||"",c.value=r.value,v.value=[...u.value],x.value=[...u.value],w.value=!0},s=()=>{c.value="",v.value=[],V.value="",w.value=!1},_=M=>{v.value=M,u.value=[...M],I("update:images",[...M]),I("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:o.modelValue,notes:r.value,images:[...M]})},z=()=>{V.value!==o.modelValue&&I("update:modelValue",V.value),r.value=c.value,I("update:notes",c.value),u.value=[...v.value],I("update:images",[...v.value]),I("save",{pointId:o.pointId,inspectionId:o.inspectionId,value:V.value,notes:c.value,images:v.value}),w.value=!1},F=M=>{I("hapus",M),w.value=!1};return(M,E)=>{var B,$,q;return a(),n("div",Ao,[!e.modelValue&&u.value.length===0&&!r.value?(a(),n("div",Fo,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:h},E[4]||(E[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(a(),n("div",zo,[t("div",{class:"flex justify-between items-start"},[E[5]||(E[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:h,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),u.value.length>0?(a(),n("div",Eo,[t("div",Ho,[(a(!0),n(P,null,ee(u.value,(j,Z)=>(a(),n("div",{key:Z,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:d(j),class:"w-full h-full object-cover rounded"},null,8,Oo),Z===3&&u.value.length>4?(a(),n("span",Wo," +"+L(u.value.length-4),1)):y("",!0)]))),128))])])):y("",!0),t("div",Zo,[(a(!0),n(P,null,ee(e.options,(j,Z)=>(a(),n("label",{key:Z,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:j.value,checked:e.modelValue===j.value,disabled:!0,class:"hidden peer"},null,8,Ko),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===j.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==j.value}])},L(j.label),3)]))),128))]),r.value&&((B=b.value.settings)!=null&&B.show_textarea)?(a(),n("div",Xo,[t("p",Go,L(r.value),1)])):y("",!0)])),w.value?(a(),Q(Xe,{key:($=e.selectedPoint)==null?void 0:$.id,show:w.value,title:e.pointName||"Detail",subtitle:(q=b.value)==null?void 0:q.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":V.value,"notes-value":c.value,"images-value":v.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":E[0]||(E[0]=j=>V.value=j),"onUpdate:notesValue":E[1]||(E[1]=j=>c.value=j),"onUpdate:imagesValue":E[2]||(E[2]=j=>_(j)),onClose:s,onSave:z,onHapus:E[3]||(E[3]=j=>F(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):y("",!0),e.error?(a(),n("p",Yo,L(e.error),1)):y("",!0)])}}},Qo={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Po={class:"bg-indigo-200 px-6 py-2 border-b"},ea={class:"text-xl font-semibold text-indigo-700"},ta={class:"p-4 space-y-4"},sa={class:"flex items-start justify-between"},oa={class:"block text-sm font-medium text-gray-700"},aa={key:0,class:"text-red-500"},ia={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},na={key:0,class:"text-center py-8 text-gray-500"},la={key:0,class:"text-xs text-gray-400"},ra={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(e,{emit:A}){const o=e,I=A,r=Je(),u=G(()=>{var h;if(console.log("CategorySection - Filtering points:",{categoryName:o.category.name,isDamageMenu:o.category.isDamageMenu,allPoints:o.category.points,allPointsCount:(h=o.category.points)==null?void 0:h.length}),!o.category.isDamageMenu)return console.log("Menu biasa - tampilkan semua points"),o.category.points||[];const d=(o.category.points||[]).filter(s=>{var F,M;const _=(F=s.inspection_point)==null?void 0:F.id,z=w(_);return console.log(`Point ${_} (${(M=s.inspection_point)==null?void 0:M.name}): hasData = ${z}`),z});return console.log("Filtered damage points:",d),d}),w=d=>{if(!d)return console.log("hasPointData: pointId is null/undefined"),!1;const h=r.props.existingResults[d]!==void 0,s=r.props.existingImages[d]&&r.props.existingImages[d].length>0,_=o.form.results[d]&&(o.form.results[d].status||o.form.results[d].note),z=o.form.images[d]&&o.form.images[d].length>0,F=h||s||_||z;return console.log(`Point ${d} data check:`,{hasServerResult:h,hasServerImages:s,hasLocalResult:_,hasLocalImages:z,finalResult:F}),F},c=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],v=d=>{var _,z,F,M,E,B,$,q,j;const h=o.form.results[(_=d.inspection_point)==null?void 0:_.id],s=o.form.images[(z=d.inspection_point)==null?void 0:z.id];if(!h)return!1;switch(d.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!h.note;case"select":case"radio":if(!h.status)return!1;const Z=(M=(F=d.settings)==null?void 0:F.radios)==null?void 0:M.find(Y=>Y.value===h.status);return!(Z!=null&&Z.settings&&(Z.settings.show_textarea&&!((E=h.note)!=null&&E.trim())||Z.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!h.status)return!1;const K=($=(B=d.settings)==null?void 0:B.radios)==null?void 0:$.find(Y=>Y.value===h.status);return!(K!=null&&K.settings&&K.settings.show_textarea&&!((q=h.note)!=null&&q.trim()));case"image":return(s==null?void 0:s.length)>0;default:return!!h.status||!!((j=h.note)!=null&&j.trim())}},V=(d,h,s)=>{I("updateResult",{pointId:d,type:s,value:h})},x=d=>{I("saveResult",d)},b=d=>{I("hapusPoint",d)};return(d,h)=>(a(),n("div",Qo,[t("div",Po,[t("h3",ea,L(e.category.name),1)]),t("div",ta,[(a(!0),n(P,null,ee(u.value,s=>{var _,z,F,M,E,B,$,q,j,Z,K,Y,W,J,oe,le,U,T,l,k,f,N,i,g,D,p,R,H,O,X,re,ge,pe,he,ke,$e,Ie,Ve,_e,Se,Ce,Me,Ue,je,Te,Ne,Re,Be,qe,Le,De,Ae,Fe,ze,Ee,He;return a(),n("div",{key:s.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",sa,[t("label",oa,[ne(L((_=s.inspection_point)==null?void 0:_.name)+" ",1),(z=s.settings)!=null&&z.is_required?(a(),n("span",aa,"*")):y("",!0)]),v(s)?(a(),n("span",ia," ✓ ")):y("",!0)]),s.input_type==="text"?(a(),Q(Rt,{key:0,modelValue:e.form.results[(F=s.inspection_point)==null?void 0:F.id].note,"onUpdate:modelValue":[S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].note=S},S=>{var m;return V((m=s.inspection_point)==null?void 0:m.id,S,"note")}],required:(M=s.settings)==null?void 0:M.is_required,"min-length":(E=s.settings)==null?void 0:E.min_length,"max-length":(B=s.settings)==null?void 0:B.max_length,allowSpace:($=s.settings)==null?void 0:$.allow_space,textTransform:(q=s.settings)==null?void 0:q.text_transform,placeholder:((j=s.settings)==null?void 0:j.placeholder)||"Masukan text",error:e.form.errors[`results.${(Z=s.inspection_point)==null?void 0:Z.id}.note`],onSave:S=>{var m;return x((m=s.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):y("",!0),s.input_type==="number"?(a(),Q(tt,{key:1,modelValue:e.form.results[(K=s.inspection_point)==null?void 0:K.id].note,"onUpdate:modelValue":[S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].note=S},S=>{var m;return V((m=s.inspection_point)==null?void 0:m.id,S,"note")}],required:(Y=s.settings)==null?void 0:Y.is_required,min:(W=s.settings)==null?void 0:W.min,max:(J=s.settings)==null?void 0:J.max,step:((oe=s.settings)==null?void 0:oe.step)||1,placeholder:((le=s.settings)==null?void 0:le.placeholder)||"Masukan number",error:e.form.errors[`results.${(U=s.inspection_point)==null?void 0:U.id}.note`],onSave:S=>{var m;return x((m=s.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):y("",!0),s.input_type==="account"?(a(),Q(Et,{key:2,modelValue:e.form.results[(T=s.inspection_point)==null?void 0:T.id].note,"onUpdate:modelValue":[S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].note=S},S=>{var m;return V((m=s.inspection_point)==null?void 0:m.id,S,"note")}],required:(l=s.settings)==null?void 0:l.is_required,placeholder:((k=s.settings)==null?void 0:k.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${(f=s.inspection_point)==null?void 0:f.id}.note`],"point-id":(N=s.inspection_point)==null?void 0:N.id,settings:s.settings,onSave:S=>{var m;return x((m=s.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):y("",!0),s.input_type==="date"?(a(),Q(Dt,{key:3,modelValue:e.form.results[(i=s.inspection_point)==null?void 0:i.id].note,"onUpdate:modelValue":[S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].note=S},S=>{var m;return V((m=s.inspection_point)==null?void 0:m.id,S,"note")}],required:(g=s.settings)==null?void 0:g.is_required,"min-date":(D=s.settings)==null?void 0:D.min_date,"max-date":(p=s.settings)==null?void 0:p.max_date,error:e.form.errors[`results.${(R=s.inspection_point)==null?void 0:R.id}.note`],onSave:S=>{var m;return x((m=s.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):y("",!0),s.input_type==="textarea"?(a(),Q(Ke,{key:4,modelValue:e.form.results[(H=s.inspection_point)==null?void 0:H.id].note,"onUpdate:modelValue":[S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].note=S},S=>{var m;return V((m=s.inspection_point)==null?void 0:m.id,S,"note")}],required:(O=s.settings)==null?void 0:O.is_required,"min-length":(X=s.settings)==null?void 0:X.min_length,"max-length":(re=s.settings)==null?void 0:re.max_length,placeholder:((ge=s.settings)==null?void 0:ge.placeholder)||"Masukkan teks di sini",settings:s.settings,error:e.form.errors[`results.${(pe=s.inspection_point)==null?void 0:pe.id}.note`],onSave:S=>{var m;return x((m=s.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):y("",!0),s.input_type==="radio"?(a(),Q(Do,{key:5,modelValue:e.form.results[(he=s.inspection_point)==null?void 0:he.id].status,"onUpdate:modelValue":[S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].status=S},S=>{var m;return V((m=s.inspection_point)==null?void 0:m.id,S,"status")}],notes:e.form.results[(ke=s.inspection_point)==null?void 0:ke.id].note,images:e.form.images[($e=s.inspection_point)==null?void 0:$e.id],required:(Ie=s.settings)==null?void 0:Ie.is_required,"point-id":(Ve=s.inspection_point)==null?void 0:Ve.id,point:s.inspection_point,"inspection-id":e.inspectionId,settings:s.settings,"point-name":(_e=s.inspection_point)==null?void 0:_e.name,"selected-point":s.input_type==="damage"?s.inspection_point:null,options:((Se=s.settings)==null?void 0:Se.radios)||c,error:e.form.errors[`results.${(Ce=s.inspection_point)==null?void 0:Ce.id}.status`],"onUpdate:notes":S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].note=S},"onUpdate:images":S=>{var m;return e.form.images[(m=s.inspection_point)==null?void 0:m.id]=S},onSave:S=>{var m;return x((m=s.inspection_point)==null?void 0:m.id)},onHapus:S=>{var m;return b((m=s.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="imageTOradio"?(a(),Q(Jo,{key:6,modelValue:e.form.results[(Me=s.inspection_point)==null?void 0:Me.id].status,"onUpdate:modelValue":[S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].status=S},S=>{var m;return V((m=s.inspection_point)==null?void 0:m.id,S,"status")}],notes:e.form.results[(Ue=s.inspection_point)==null?void 0:Ue.id].note,images:e.form.images[(je=s.inspection_point)==null?void 0:je.id],required:(Te=s.settings)==null?void 0:Te.is_required,"point-id":(Ne=s.inspection_point)==null?void 0:Ne.id,"inspection-id":e.inspectionId,settings:s.settings,"point-name":(Re=s.inspection_point)==null?void 0:Re.name,point:s,"selected-point":s.input_type==="damage"?s.inspection_point:null,options:((Be=s.settings)==null?void 0:Be.radios)||c,error:e.form.errors[`results.${(qe=s.inspection_point)==null?void 0:qe.id}.status`],"onUpdate:notes":S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].note=S},"onUpdate:images":S=>{var m;return e.form.images[(m=s.inspection_point)==null?void 0:m.id]=S},onSave:S=>{var m;return x((m=s.inspection_point)==null?void 0:m.id)},onHapus:S=>{var m;return b((m=s.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="image"?(a(),Q(be,{key:7,modelValue:e.form.images[(Le=s.inspection_point)==null?void 0:Le.id],"onUpdate:modelValue":S=>{var m;return e.form.images[(m=s.inspection_point)==null?void 0:m.id]=S},error:e.form.errors[`images.${(De=s.inspection_point)==null?void 0:De.id}`],"inspection-id":e.inspectionId,"point-id":(Ae=s.inspection_point)==null?void 0:Ae.id,point:s.inspection_point,"point-name":(Fe=s.inspection_point)==null?void 0:Fe.name,settings:s.settings,"onUpdate:notes":S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].note=S},"onUpdate:status":S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].status=S}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):y("",!0),s.input_type==="select"?(a(),Q(ts,{key:8,modelValue:e.form.results[(ze=s.inspection_point)==null?void 0:ze.id].status,"onUpdate:modelValue":[S=>{var m;return e.form.results[(m=s.inspection_point)==null?void 0:m.id].status=S},S=>{var m;return V((m=s.inspection_point)==null?void 0:m.id,S,"status")}],required:(Ee=s.settings)==null?void 0:Ee.is_required,error:e.form.errors[`results.${(He=s.inspection_point)==null?void 0:He.id}.status`],onSave:S=>{var m;return x((m=s.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):y("",!0)])}),128)),u.value.length===0?(a(),n("div",na,[h[0]||(h[0]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),h[1]||(h[1]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),e.category.isDamageMenu?(a(),n("p",la,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):y("",!0)])):y("",!0)])]))}},Sa=ce(ra,[["__scopeId","data-v-cdbefdf5"]]),da={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ua={class:"p-4 space-y-4-6"},ca={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ga=["value"],pa={class:"p-4 space-y-4-6"},ma={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},va=["value"],ha={key:0,class:"p-4 space-y-4"},fa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},wa=["value"],ba={class:"p-4 space-y-4-6"},Ca={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const A=e,o=b=>{if(!b)return{};if(typeof b=="string")try{return JSON.parse(b)||{}}catch(d){return console.error("Error parsing settings JSON:",d),{}}return typeof b=="object"&&b!==null?b:{}},I=G(()=>o(A.inspection.settings).conclusion||{}),r=C({flooded:I.value.flooded||"",collision:I.value.collision||"",collision_severity:I.value.collision_severity||"",conclusion_note:A.inspection.notes||""}),u=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],w=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],c=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],v=()=>{const b={flooded:r.value.flooded,collision:r.value.collision,collision_severity:r.value.collision==="yes"?r.value.collision_severity:null,conclusion_note:r.value.conclusion_note};Qe.post(route("inspections.updateConclusion",A.inspectionId),b,{preserveScroll:!0,preserveState:!0,onError:d=>{console.error("Error saving conclusion:",d)}})},V=Ze.debounce(v,500);se([()=>r.value.flooded,()=>r.value.collision,()=>r.value.collision_severity],()=>{v()}),xe(()=>{x()}),se(()=>A.inspection,()=>{x()},{deep:!0});const x=()=>{const d=o(A.inspection.settings).conclusion||{};r.value={flooded:d.flooded||"",collision:d.collision||"",collision_severity:d.collision_severity||"",conclusion_note:A.inspection.notes||""}};return(b,d)=>(a(),n("div",da,[d[9]||(d[9]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),t("div",ua,[d[5]||(d[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),t("div",ca,[(a(),n(P,null,ee(u,h=>t("label",{key:h.value,class:"cursor-pointer"},[ie(t("input",{type:"radio","onUpdate:modelValue":d[0]||(d[0]=s=>r.value.flooded=s),value:h.value,class:"hidden peer"},null,8,ga),[[we,r.value.flooded]]),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.flooded===h.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.flooded!==h.value}])},L(h.label),3)])),64))])]),t("div",pa,[d[7]||(d[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),t("div",ma,[(a(),n(P,null,ee(w,h=>t("label",{key:h.value,class:"cursor-pointer"},[ie(t("input",{type:"radio","onUpdate:modelValue":d[1]||(d[1]=s=>r.value.collision=s),value:h.value,class:"hidden peer"},null,8,va),[[we,r.value.collision]]),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision===h.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision!==h.value}])},L(h.label),3)])),64))]),r.value.collision==="yes"?(a(),n("div",ha,[d[6]||(d[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),t("div",fa,[(a(),n(P,null,ee(c,h=>t("label",{key:h.value,class:"cursor-pointer"},[ie(t("input",{type:"radio","onUpdate:modelValue":d[2]||(d[2]=s=>r.value.collision_severity=s),value:h.value,class:"hidden peer"},null,8,wa),[[we,r.value.collision_severity]]),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision_severity===h.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision_severity!==h.value}])},L(h.label),3)])),64))])])):y("",!0)]),t("div",ba,[d[8]||(d[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),ie(t("textarea",{"onUpdate:modelValue":d[3]||(d[3]=h=>r.value.conclusion_note=h),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:d[4]||(d[4]=(...h)=>ae(V)&&ae(V)(...h))},null,544),[[ue,r.value.conclusion_note]])])]))}};export{uo as B,Sa as C,_a as V,Ca as _,Xe as a};
