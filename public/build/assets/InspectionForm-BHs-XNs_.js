import{e as u,o as l,a as e,f as x,t as $,F as P,h as z,d as C,k as G,q as le,j as de,n as K,p as ce,C as me,c as A,g as J,x as ge,W as X,D as ve,b as he,w as fe,u as B,l as pe,s as be,T as xe,B as oe}from"./app-DT55nrTD.js";import{l as re}from"./lodash-DpCzJDd3.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const we={class:"mt-1"},ye=["value","required","minlength","maxlength","pattern","placeholder"],ke={key:0,class:"mt-2 text-sm text-red-600"},Se={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,h=v,y=f=>{h("update:modelValue",f.target.value),h("save",d.pointId)};return(f,c)=>(l(),u("div",we,[e("input",{value:t.modelValue,onInput:y,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,pattern:t.pattern,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ye),t.error?(l(),u("p",ke,$(t.error),1)):x("",!0)]))}},Ve={class:"mt-1"},_e=["value","required","min","max","step","placeholder"],$e={key:0,class:"mt-2 text-sm text-red-600"},Ie={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,h=v,y=f=>{const c=f.target.value;h("update:modelValue",c),h("save",d.pointId)};return(f,c)=>(l(),u("div",Ve,[e("input",{value:t.modelValue,onInput:y,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,_e),t.error?(l(),u("p",$e,$(t.error),1)):x("",!0)]))}},Ce={class:"mt-1"},je=["value","required","min","max"],qe={key:0,class:"mt-2 text-sm text-red-600"},Re={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,h=v,y=f=>{h("update:modelValue",f.target.value),h("save",d.pointId)};return(f,c)=>(l(),u("div",Ce,[e("input",{value:t.modelValue,onChange:y,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,je),t.error?(l(),u("p",qe,$(t.error),1)):x("",!0)]))}},Ue={class:"mt-1"},Le=["value","required"],Ee={key:0,class:"mt-2 text-sm text-red-600"},Ne={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,h=v,y=f=>{h("update:modelValue",f.target.value),h("save",d.pointId)};return(f,c)=>(l(),u("div",Ue,[e("select",{value:t.modelValue,onChange:y,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},c[0]||(c[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Le),t.error?(l(),u("p",Ee,$(t.error),1)):x("",!0)]))}},Be=Y(Ne,[["__scopeId","data-v-c34a74db"]]),Me={class:"mt-2"},Te={class:"flex flex-col gap-2 sm:flex-row sm:items-center"},Ae=["name","value","checked","onChange","required"],Oe={class:"text-sm text-gray-700"},Fe={key:0,class:"mt-2 text-sm text-red-600"},Pe={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number],options:{type:Array,default:()=>[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}]}},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,h=v,y=f=>{h("update:modelValue",f),h("save",d.pointId)};return(f,c)=>(l(),u("div",Me,[e("div",Te,[(l(!0),u(P,null,z(t.options,i=>(l(),u("label",{key:i.value,class:"inline-flex items-center space-x-2"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:i.value,checked:t.modelValue===i.value,onChange:I=>y(i.value),required:t.required,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,Ae),e("span",Oe,$(i.label),1)]))),128))]),t.error?(l(),u("p",Fe,$(t.error),1)):x("",!0)]))}},ze=["multiple"],De={key:0,class:"h-full flex flex-col items-center justify-center p-4 text-center"},He={key:1,class:"p-2"},We={class:"grid grid-cols-3 gap-2"},Xe=["src"],Ge=["onClick"],Ke={key:0,class:"mt-2 text-center"},Ye={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 p-4"},Je={class:"bg-white w-full max-w-sm rounded-xl shadow-xl overflow-hidden"},Qe={key:1,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Ze={class:"webcam-content-box"},et={class:"webcam-video-container"},tt={key:2,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center"},st={class:"w-full h-full flex flex-col"},at={class:"flex justify-between items-center p-4 bg-black bg-opacity-50 text-white"},ot={class:"text-lg font-medium"},rt={class:"flex-1 flex items-center justify-center overflow-hidden relative"},lt=["src"],nt={class:"flex justify-between p-4 bg-black bg-opacity-50"},it={key:3,class:"mt-1 text-xs text-red-600"},ut={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,pointId:[String,Number],settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png"],camera_aspect_ratio:"4:3"})}},emits:["update:modelValue","save","removeImage"],setup(t,{emit:v}){const d=t,h=v,y=C(null),f=C(null),c=C(null),i=C([]),I=C(!1),k=C(!1),b=C(0),s=C(0),L=C(0),M=C(0);let j=null;const U=G(()=>Number(d.settings.max_files)>1),O=G(()=>i.value[b.value]),q=G(()=>{const g=d.settings.camera_aspect_ratio.split(":");if(g.length===2){const r=parseFloat(g[0]),_=parseFloat(g[1]);if(!isNaN(r)&&!isNaN(_)&&_!==0)return r/_}return 4/3}),n=()=>{I.value=!0},o=()=>{I.value=!1,y.value.click()},a=async()=>{I.value=!1,k.value=!0;try{const g={facingMode:"environment",width:{ideal:1280},height:{ideal:960},aspectRatio:{exact:q.value}};j=await navigator.mediaDevices.getUserMedia({video:g}),f.value.srcObject=j,f.value.onloadedmetadata=()=>{f.value.style.width="100%",f.value.style.height="auto",f.value.style.objectFit="cover"}}catch(g){console.error("Error accessing camera: ",g),alert("Failed to access camera. Please ensure camera permissions are granted and try again."),k.value=!1}},p=()=>{j&&j.getTracks().forEach(g=>g.stop()),k.value=!1},S=()=>{if(!f.value||!c.value)return;const g=f.value,r=c.value,_=r.getContext("2d"),R=g.videoWidth,E=g.videoHeight;let F=R,N=E,Z=0,ee=0;R/E>q.value?(F=E*q.value,Z=(R-F)/2):R/E<q.value&&(N=R/q.value,ee=(E-N)/2),r.width=F,r.height=N,_.drawImage(g,Z,ee,F,N,0,0,r.width,r.height),r.toBlob(te=>{if(te){const se=new File([te],`captured_image_${Date.now()}.png`,{type:"image/png"}),ae={file:se,preview:URL.createObjectURL(se)};U.value&&d.modelValue.length<d.settings.max_files?i.value.push(ae):(i.value.length>0&&URL.revokeObjectURL(i.value[0].preview),i.value=[ae]),b.value=i.value.length-1,s.value=0,(!U.value||i.value.length>=d.settings.max_files)&&p()}else console.error("Failed to convert canvas to blob.")},"image/png")},w=g=>{const r=Array.from(g.target.files);if(!r.length)return;const _=d.modelValue.length,R=d.settings.max_files-_,E=r.slice(0,R);(!U.value||R===0&&E.length>0)&&(i.value.forEach(N=>URL.revokeObjectURL(N.preview)),i.value=[]);const F=E.map(N=>({file:N,preview:URL.createObjectURL(N)}));i.value.push(...F),b.value=0,s.value=0,g.target.value=""},V=()=>{const g=[...d.modelValue,...i.value];h("update:modelValue",g.slice(0,d.settings.max_files)),h("save",d.pointId),i.value=[]},T=()=>{i.value.forEach(g=>URL.revokeObjectURL(g.preview)),i.value=[]},D=g=>{const r=[...d.modelValue],_=r.splice(g,1)[0];_.preview&&URL.revokeObjectURL(_.preview),h("update:modelValue",r),h("removeImage",{index:g,pointId:d.pointId})},H=g=>{const r=i.value.splice(g,1)[0];r.preview&&URL.revokeObjectURL(r.preview),i.value.length===0?T():b.value>=i.value.length&&(b.value=i.value.length-1)},W=()=>{s.value=(s.value+90)%360},m=()=>{b.value<i.value.length-1&&(b.value++,s.value=0)},Q=()=>{b.value>0&&(b.value--,s.value=0)},ne=g=>{L.value=g.touches[0].clientX},ie=g=>{M.value=g.touches[0].clientX},ue=()=>{L.value-M.value>50?m():M.value-L.value>50&&Q()};return le(()=>{j&&j.getTracks().forEach(g=>g.stop())}),(g,r)=>(l(),u("div",null,[e("input",{ref_key:"galleryInput",ref:y,type:"file",accept:"image/*",class:"hidden",onChange:w,multiple:U.value},null,40,ze),e("label",{onClick:n,class:K(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200",{"border-gray-300 hover:border-indigo-400 bg-gray-50":t.modelValue.length===0,"border-indigo-300 bg-indigo-50":t.modelValue.length>0,"h-28":t.modelValue.length===0,"h-auto":t.modelValue.length>0}])},[t.modelValue.length===0?(l(),u("div",De,r[2]||(r[2]=[e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1),e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)]))):(l(),u("div",He,[e("div",We,[(l(!0),u(P,null,z(t.modelValue,(_,R)=>(l(),u("div",{key:R,class:"relative aspect-square"},[e("img",{src:_.preview||"/storage/"+_.image_path,class:"w-full h-full object-cover rounded-md border border-gray-200"},null,8,Xe),e("button",{onClick:de(E=>D(R),["stop"]),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm hover:bg-red-600 transition-colors"}," × ",8,Ge)]))),128))]),U.value?(l(),u("div",Ke,r[3]||(r[3]=[e("span",{class:"inline-block px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 hover:bg-indigo-200 transition-colors"}," + Add More Images ",-1)]))):x("",!0)]))],2),I.value?(l(),u("div",Ye,[e("div",Je,[e("div",{class:"p-4"},[r[6]||(r[6]=e("h3",{class:"text-lg font-medium text-center text-gray-800 mb-4"},"Select Image Source",-1)),e("div",{class:"flex justify-center gap-6"},[e("button",{onClick:a,class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-blue-50 hover:bg-blue-100 transition-colors"},r[4]||(r[4]=[ce('<div class="bg-blue-100 p-3 rounded-full mb-2" data-v-9cd77fd2><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-9cd77fd2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" data-v-9cd77fd2></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" data-v-9cd77fd2></path></svg></div><span class="text-sm font-medium text-gray-700" data-v-9cd77fd2>Camera (Web)</span>',2)])),e("button",{onClick:o,class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-purple-50 hover:bg-purple-100 transition-colors"},r[5]||(r[5]=[e("div",{class:"bg-purple-100 p-3 rounded-full mb-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1),e("span",{class:"text-sm font-medium text-gray-700"},"Gallery (HP)",-1)]))])]),e("button",{onClick:r[0]||(r[0]=_=>I.value=!1),class:"w-full py-3 text-center text-gray-500 font-medium border-t border-gray-100 hover:bg-gray-50 transition-colors"},"Cancel")])])):x("",!0),k.value?(l(),u("div",Qe,[e("div",Ze,[e("div",{class:"webcam-header"},[e("button",{onClick:p,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},r[7]||(r[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),r[8]||(r[8]=e("h3",{class:"text-lg font-medium text-white"},"Take Photo",-1)),r[9]||(r[9]=e("div",null,null,-1))]),e("div",et,[e("video",{ref_key:"webcamVideo",ref:f,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:c,class:"hidden"},null,512)]),e("div",{class:"webcam-footer"},[e("button",{onClick:S,class:"capture-button"})])])])):x("",!0),i.value.length?(l(),u("div",tt,[e("div",st,[e("div",at,[e("button",{onClick:T,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},r[10]||(r[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",ot,"Preview ("+$(b.value+1)+"/"+$(i.value.length)+")",1),e("button",{onClick:W,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},r[11]||(r[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))]),e("div",rt,[e("div",{class:"w-full h-full flex items-center justify-center",onTouchstart:ne,onTouchmove:ie,onTouchend:ue},[e("img",{src:O.value.preview,class:"max-w-full max-h-full object-contain",style:me({transform:`rotate(${s.value}deg)`})},null,12,lt)],32),i.value.length>1?(l(),u("button",{key:0,onClick:Q,class:"absolute left-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},r[12]||(r[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):x("",!0),i.value.length>1?(l(),u("button",{key:1,onClick:m,class:"absolute right-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},r[13]||(r[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):x("",!0)]),e("div",nt,[e("button",{onClick:r[1]||(r[1]=_=>H(b.value)),class:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"}," Delete "),e("button",{onClick:V,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Save "+$(i.value.length)+" Image(s) ",1)])])])):x("",!0),t.error?(l(),u("p",it,$(t.error),1)):x("",!0)]))}},dt=Y(ut,[["__scopeId","data-v-9cd77fd2"]]),ct={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},mt={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},gt={class:"text-xl font-semibold text-indigo-700"},vt={class:"p-6 space-y-8"},ht={class:"flex items-start justify-between"},ft={class:"block text-sm font-medium text-gray-700"},pt={key:0,class:"text-red-500"},bt={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},xt={__name:"CategorySection",props:{category:Object,form:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:v}){const d=t,h=v,y=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],f=k=>{var s;const b=d.form.results[k.id];if(!b)return!1;switch(k.input_type){case"text":case"number":case"date":return!!b.note;case"select":case"radio":return!!b.status;case"image":return((s=b.images)==null?void 0:s.length)>0;default:return!1}},c=(k,b)=>{h("updateResult",{pointId:k,value:b})},i=k=>{h("saveResult",k)},I=(k,b)=>{h("removeImage",{pointId:k,imageIndex:b})};return(k,b)=>(l(),u("div",ct,[e("div",mt,[e("h2",gt,$(t.category.name),1)]),e("div",vt,[(l(!0),u(P,null,z(t.category.points,s=>{var L,M,j,U,O,q,n,o,a,p,S,w,V,T,D,H,W;return l(),u("div",{key:s.id,class:"space-y-4 pb-6 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",ht,[e("label",ft,[J($(s.name)+" ",1),(L=s.settings)!=null&&L.is_required?(l(),u("span",pt,"*")):x("",!0)]),f(s)?(l(),u("span",bt," ✓ ")):x("",!0)]),s.input_type==="text"?(l(),A(Se,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[m=>t.form.results[s.id].note=m,m=>c(s.id,m)],required:(M=s.settings)==null?void 0:M.is_required,"min-length":(j=s.settings)==null?void 0:j.min_length,"max-length":(U=s.settings)==null?void 0:U.max_length,pattern:(O=s.settings)==null?void 0:O.pattern,placeholder:((q=s.settings)==null?void 0:q.placeholder)||"Enter text",error:t.form.errors[`results.${s.id}.note`],onSave:m=>i(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):x("",!0),s.input_type==="number"?(l(),A(Ie,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[m=>t.form.results[s.id].note=m,m=>c(s.id,m)],required:(n=s.settings)==null?void 0:n.is_required,min:(o=s.settings)==null?void 0:o.min,max:(a=s.settings)==null?void 0:a.max,step:((p=s.settings)==null?void 0:p.step)||1,placeholder:((S=s.settings)==null?void 0:S.placeholder)||"Enter number",error:t.form.errors[`results.${s.id}.note`],onSave:m=>i(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):x("",!0),s.input_type==="date"?(l(),A(Re,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[m=>t.form.results[s.id].note=m,m=>c(s.id,m)],required:(w=s.settings)==null?void 0:w.is_required,"min-date":(V=s.settings)==null?void 0:V.min_date,"max-date":(T=s.settings)==null?void 0:T.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:m=>i(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):x("",!0),s.input_type==="select"?(l(),A(Be,{key:3,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[m=>t.form.results[s.id].status=m,m=>c(s.id,m)],required:(D=s.settings)==null?void 0:D.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:m=>i(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):x("",!0),s.input_type==="radio"?(l(),A(Pe,{key:4,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[m=>t.form.results[s.id].status=m,m=>c(s.id,m)],required:(H=s.settings)==null?void 0:H.is_required,options:((W=s.settings)==null?void 0:W.radios)||y,error:t.form.errors[`results.${s.id}.status`],onSave:m=>i(s.id)},null,8,["modelValue","onUpdate:modelValue","required","options","error","onSave"])):x("",!0),s.input_type==="image"?(l(),A(dt,{key:5,modelValue:t.form.results[s.id].images,"onUpdate:modelValue":[m=>t.form.results[s.id].images=m,m=>c(s.id,m)],error:t.form.errors[`results.${s.id}.images`],onSave:m=>i(s.id),onRemoveImage:m=>I(s.id,m)},null,8,["modelValue","onUpdate:modelValue","error","onSave","onRemoveImage"])):x("",!0)])}),128))])]))}},wt=Y(xt,[["__scopeId","data-v-0537cb06"]]),yt={class:"container mx-auto px-4 py-2"},kt={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},St={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Vt=["onClick","data-category-id"],_t={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},$t={class:"relative overflow-hidden"},It={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},Ct={class:"mb-4"},jt={class:"mt-6"},qt={class:"list-disc pl-5"},Rt={key:0},Ut={key:1},Lt={class:"flex justify-end gap-4 mt-8"},Et=["disabled"],Nt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Bt={__name:"InspectionForm",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(t){var q;const v=t,d=C(((q=v.categories[0])==null?void 0:q.id)||"summary"),h=C(0);C(null);const y=G(()=>d.value!=="summary"?v.categories.find(n=>n.id===d.value):null),c=ge((()=>{const n={};return v.categories.forEach(o=>{(o.points||[]).forEach(a=>{var S,w;const p=Array.isArray(v.existingResults)?v.existingResults.find(V=>V.point_id===a.id):null;n[a.id]={status:(p==null?void 0:p.status)||"",note:(p==null?void 0:p.note)||"",images:((w=(S=v.existingImages)==null?void 0:S[a.id])==null?void 0:w.map(V=>({image_path:V.image_path,preview:null})))||[]}})}),{inspection_id:v.inspection.id,results:n,overall_note:v.inspection.overall_note||""}})()),i=re.debounce(()=>{X.post(route("inspections.save-overall-note"),{inspection_id:v.inspection.id,overall_note:c.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:n=>{console.error("Error menyimpan catatan keseluruhan:",n)}})},800),I=n=>n.points.every(o=>{var p;const a=c.results[o.id];if(!a)return!1;switch(o.input_type){case"text":case"number":case"date":return!!a.note;case"select":case"radio":return!!a.status;case"image":return((p=a.images)==null?void 0:p.length)>0;default:return!!a.status||!!a.note}}),k=n=>{if(n==="summary")h.value=v.categories.length;else{const o=v.categories.findIndex(a=>a.id===n);o>=0&&(h.value=o)}d.value=n},b=n=>{let o=h.value+n;const a=v.categories.length;o>=0&&o<=a&&(h.value=o,o===a?d.value="summary":d.value=v.categories[o].id)},s=()=>{let n=0,o=0;const a=V=>{n=V.changedTouches[0].screenX},p=V=>{o=V.changedTouches[0].screenX,S()},S=()=>{o<n-50?b(1):o>n+50&&b(-1)},w=document.querySelector(".relative.overflow-hidden");return w&&(w.addEventListener("touchstart",a,!1),w.addEventListener("touchend",p,!1)),()=>{w&&(w.removeEventListener("touchstart",a),w.removeEventListener("touchend",p))}},L=re.debounce(async n=>{try{await X.post(route("inspections.save-result"),{inspection_id:v.inspection.id,point_id:n,status:c.results[n].status,note:c.results[n].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(o){console.error("Error menyimpan hasil:",o)}},500),M=({pointId:n,type:o,value:a})=>{c.results[n].hasOwnProperty(o)&&(c.results[n][o]=a),L(n)},j=async(n,o)=>{const a=n.target.files[0];if(!a)return;const p=URL.createObjectURL(a);try{const S=new FormData;S.append("inspection_id",v.inspection.id),S.append("point_id",o),S.append("image",a),await X.post(route("inspections.upload-image"),S,{preserveScroll:!0,onSuccess:w=>{var T;const V=((T=w.props.flash)==null?void 0:T.imagePath)||w.props.imagePath;V?c.results[o].images.push({image_path:V,preview:p}):console.error("Path gambar tidak dikembalikan dari unggahan, tidak dapat memperbarui UI.")},onError:w=>{console.error("Error mengunggah gambar:",w),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(S){console.error("Error mengunggah gambar:",S),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{n.target.value=""}},U=async(n,o)=>{const a=c.results[n].images[o];if(a)try{await X.delete(route("inspections.delete-image"),{data:{image_path:a.image_path,point_id:n,inspection_id:v.inspection.id},preserveScroll:!0,onSuccess:()=>{c.results[n].images.splice(o,1),a.preview&&URL.revokeObjectURL(a.preview)},onError:p=>{console.error("Error menghapus gambar:",p),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(p){console.error("Error menghapus gambar:",p),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},O=()=>{c.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{oe().props.flash.success="Inspeksi berhasil dikirim!"},onError:n=>{console.error("Kesalahan pengiriman:",n),oe().props.flash.error="Ada kesalahan dalam pengiriman Anda. Harap periksa semua bidang."}})};return le(()=>{s()}),ve(d,n=>{const o=document.querySelector(`.flex-shrink-0[data-category-id="${n}"]`);o&&o.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(n,o)=>(l(),u("div",yt,[e("div",kt,[e("div",St,[(l(!0),u(P,null,z(t.categories,a=>(l(),u("button",{key:a.id,onClick:p=>k(a.id),class:K(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":d.value===a.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":d.value!==a.id}]),"data-category-id":a.id},[J($(a.name)+" ",1),I(a)?(l(),u("span",_t," ✓ ")):x("",!0)],10,Vt))),128)),e("button",{onClick:o[0]||(o[0]=a=>k("summary")),class:K(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":d.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":d.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),e("div",$t,[he(xe,{name:"category-slide",mode:"out-in"},{default:fe(()=>[y.value&&d.value!=="summary"?(l(),A(wt,{key:y.value.id,category:y.value,form:B(c),onSaveResult:B(L),onUpdateResult:M,onRemoveImage:U,onHandleImageUpload:j},null,8,["category","form","onSaveResult"])):d.value==="summary"?(l(),u("div",It,[o[6]||(o[6]=e("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),e("div",Ct,[o[3]||(o[3]=e("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),pe(e("textarea",{id:"overall_note","onUpdate:modelValue":o[1]||(o[1]=a=>B(c).overall_note=a),onInput:o[2]||(o[2]=(...a)=>B(i)&&B(i)(...a)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[be,B(c).overall_note]])]),e("div",jt,[o[4]||(o[4]=e("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Kategori:",-1)),e("ul",qt,[(l(!0),u(P,null,z(t.categories,a=>(l(),u("li",{key:a.id,class:K({"text-green-600":I(a),"text-red-600":!I(a)})},[J($(a.name)+" ",1),I(a)?(l(),u("span",Rt,"(Selesai ✓)")):(l(),u("span",Ut,"(Belum Selesai ✗)"))],2))),128))])]),e("div",Lt,[e("button",{type:"button",onClick:O,disabled:B(c).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[B(c).processing?(l(),u("svg",Nt,o[5]||(o[5]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):x("",!0),e("span",null,$(B(c).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Et)])])):x("",!0)]),_:1})])]))}},Ot=Y(Bt,[["__scopeId","data-v-22fd310e"]]);export{Ot as default};
