import{x as Xe,r as V,g as Ae,q as te,E as Ee,G as we,c as l,o as a,d as t,b as h,k as pe,z as _e,A as Ne,n as oe,t as B,u as ue,e as nt,F as me,m as ve,f as de,y as Re,w as Ve,J as Te,a as Ge,j as ge,l as Je,T as Fe,p as at,D as ot,W as Ue,L as Be,B as it,S as lt}from"./vendor-Dy3A47bM.js";import{l as qe}from"./lodash-ibmwMWsP.js";import{_ as rt}from"./PrimaryButton-uMWidzxX.js";import{_ as ut}from"./ActionMessage-DrY0H1I7.js";import{_ as Se}from"./app-Cg6sxzOB.js";import{_ as Ye}from"./InputNumber-DMgjFbiS.js";const dt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ct={key:0,class:"p-4 space-y-2"},gt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},pt={class:"flex items-center space-x-2"},mt={key:0,class:"text-xs text-red-500 font-normal ml-2"},vt={key:1,class:"text-xs text-red-500 font-normal ml-2"},ft={key:2,class:"text-xs text-green-500 font-normal ml-2"},ht={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},bt={class:"relative"},xt={key:0,class:"absolute right-3 top-3"},wt={key:1,class:"text-xs text-red-500 font-normal ml-2"},yt={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},kt={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},$t={key:0},Ct=["onMousedown"],It={class:"font-medium text-gray-900"},_t={class:"text-sm text-gray-500"},Vt={key:1,class:"p-4 text-sm text-gray-500 text-center"},St={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Mt={key:0,class:"mb-4"},Ut=["innerHTML"],jt={key:1},Nt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Dt=["onClick"],Rt=["src","alt"],Tt={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},qt={class:"text-white text-xs text-center"},At={key:2,class:"text-center py-4 text-gray-500 text-sm"},Lt={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Bt=["src","alt"],Ft={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},zt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Et={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ht={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges"],setup(e,{emit:M}){var he,$e,Ce,Ie,g,k;const s=e,w=M,p=Xe({plate_number:((he=s.inspection)==null?void 0:he.plate_number)||"",car_id:(($e=s.inspection)==null?void 0:$e.car_id)||null,car_name:((Ce=s.inspection)==null?void 0:Ce.car_name)||""}),u=V(((Ie=s.inspection)==null?void 0:Ie.plate_number)||""),b=V(((g=s.inspection)==null?void 0:g.car_id)||null),c=V(((k=s.inspection)==null?void 0:k.car_name)||""),i=V(""),I=V(""),y=V(""),S=V(!1),$=V(""),C=V(""),n=V(p.car_name),x=V(!1),j=V(!1),H=V([]),U=V(null),K=V([]),O=V(!1),d=V(0);Ae(()=>{var f,r,E,N,J;if(A((f=s.inspection)==null?void 0:f.plate_number),(r=s.inspection)!=null&&r.car_id&&((E=s.CarDetail)==null?void 0:E.length)>0){const ae=s.CarDetail.find(le=>le.id===s.inspection.car_id);ae&&v(ae)}else!((N=s.inspection)!=null&&N.car_id)&&((J=s.inspection)!=null&&J.car_name)&&(n.value=s.inspection.car_name,p.car_id=null);window.addEventListener("keydown",Q),w("update:hasUnsavedChanges",ce.value),w("update:validation",ie.value)}),Ee(()=>{window.removeEventListener("keydown",Q)});const A=f=>{if(!f){i.value="",I.value="",y.value="";return}const r=f.toUpperCase().trim(),E=r.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(E)i.value=E[1]||"",I.value=E[2]||"",y.value=E[3]||"";else{let N="area",J="",ae="",le="";for(const ne of r)N==="area"&&/[A-Z]/.test(ne)?J+=ne:N==="area"&&/[0-9]/.test(ne)?(N="number",ae+=ne):N==="number"&&/[0-9]/.test(ne)?ae+=ne:N==="number"&&/[A-Z]/.test(ne)?(N="suffix",le+=ne):N==="suffix"&&/[A-Z]/.test(ne)&&(le+=ne);i.value=J,I.value=ae,y.value=le}W()},W=()=>{const f=`${i.value}${I.value}${y.value}`;p.plate_number=f,se()},X=f=>{f==="area"?i.value=i.value.toUpperCase().replace(/[^A-Z]/g,""):f==="number"?I.value=I.value.replace(/[^0-9]/g,""):f==="suffix"&&(y.value=y.value.toUpperCase().replace(/[^A-Z]/g,"")),W()},ee=te(()=>{const f=p.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(f)}),re=te(()=>!n.value||n.value.trim()===""),Y=te(()=>p.plate_number.length>0&&!ee.value?"Format plat nomor tidak valid.":null),ie=te(()=>{const f=!p.plate_number||p.plate_number.trim()==="",r=!n.value||n.value.trim()==="";return f||r||!ee.value||S.value}),ce=te(()=>{const f=p.plate_number!==u.value,r=p.car_id!==b.value||n.value!==c.value;return f||r}),fe=te(()=>ce.value&&!ie.value),T=f=>{var E,N,J;if(!f)return"";const r=[];return(E=f.brand)!=null&&E.name&&r.push(f.brand.name),(N=f.model)!=null&&N.name&&r.push(f.model.name),(J=f.type)!=null&&J.name&&r.push(f.type.name),f.cc&&r.push((f.cc/1e3).toFixed(1)),f.transmission&&r.push(f.transmission),f.year&&r.push(f.year.toString()),f.fuel_type&&r.push(f.fuel_type),f.production_period&&r.push(`(${f.production_period})`),r.join(" ")},z=()=>{p.car_id&&(p.car_id=null,U.value=null,K.value=[]),o()},o=qe.debounce(()=>{if(!n.value.trim()){H.value=[],x.value=!1;return}j.value=!0;try{const f=n.value.toLowerCase().trim();H.value=s.CarDetail.filter(r=>T(r).toLowerCase().includes(f)),x.value=!0}finally{j.value=!1}},300),_=()=>{setTimeout(()=>{x.value=!1,p.car_name=n.value,se()},200)},v=async f=>{U.value=f,n.value=T(f),p.car_id=f.id,p.car_name=T(f),x.value=!1,await D(f.id),se(),w("update:hasUnsavedChanges",ce.value),w("update:validation",ie.value)},F=f=>!f||!f.file_path?"":`/storage/${f.file_path}`,D=async f=>{try{const r=await fetch(`/api/cars/${f}/images`);if(r.ok){const E=await r.json();K.value=Array.isArray(E)?E:[]}else K.value=[]}catch(r){console.error("Error loading car images:",r),K.value=[]}},G=f=>{d.value=f,O.value=!0,document.body.style.overflow="hidden"},q=()=>{O.value=!1,document.body.style.overflow=""},R=()=>{d.value=(d.value+1)%K.value.length},Z=()=>{d.value=(d.value-1+K.value.length)%K.value.length},Q=f=>{if(O.value)switch(f.key){case"Escape":q();break;case"ArrowRight":R();break;case"ArrowLeft":Z();break}},se=()=>{const f={plate_number:p.plate_number,car_id:p.car_id,car_name:p.car_name};w("update-vehicle",f)},be=()=>{s.inspection&&p.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0,onSuccess:()=>{u.value=p.plate_number,b.value=p.car_id,c.value=p.car_name,w("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:f=>{console.error("Gagal menyimpan data:",f)}})};return we([()=>p.plate_number,()=>p.car_name],f=>{$.value="",S.value=!1,C.value="";const r=f[0];if(r&&r.length>=6){const E=s.allInspections.filter(N=>{var J;return N.plate_number===r&&N.id!==((J=s.inspection)==null?void 0:J.id)});if(E.length>0){const N=["draft","in_progress","pending","pending_review","revision"],J=E.find(ae=>N.includes(ae.status));if(J)S.value=!0,$.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${J.status.replace(/_/g," ").toUpperCase()}.`;else{const ae=E.filter(le=>["approved","rejected","completed","cancelled"].includes(le.status));if(ae.length>0){ae.sort((ne,xe)=>new Date(xe.created_at)-new Date(ne.created_at));const le=ae[0];if(le.car_id){const ne=s.CarDetail.find(xe=>xe.id===le.car_id);ne&&v(ne)}else le.car_name&&(n.value=le.car_name,p.car_name=le.car_name,p.car_id=null);C.value=`Nomor plat ini sudah pernah diperiksa ${ae.length} kali sebelumnya.`}}}}w("update:hasUnsavedChanges",ce.value),w("update:validation",ie.value)},{deep:!0}),(f,r)=>{var E;return a(),l("div",dt,[r[21]||(r[21]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),e.inspection?(a(),l("div",ct,[t("div",gt,[r[9]||(r[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",pt,[_e(t("input",{"onUpdate:modelValue":r[0]||(r[0]=N=>i.value=N),type:"text",placeholder:"Contoh: B",class:oe(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!ee.value||S.value}]),onInput:r[1]||(r[1]=N=>X("area")),maxlength:"2"},null,34),[[Ne,i.value]]),_e(t("input",{"onUpdate:modelValue":r[2]||(r[2]=N=>I.value=N),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:oe(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!ee.value||S.value}]),onInput:r[3]||(r[3]=N=>X("number")),maxlength:"4"},null,34),[[Ne,I.value]]),_e(t("input",{"onUpdate:modelValue":r[4]||(r[4]=N=>y.value=N),type:"text",placeholder:"ABC",class:oe(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!ee.value||S.value}]),onInput:r[5]||(r[5]=N=>X("suffix")),maxlength:"3"},null,34),[[Ne,y.value]])]),Y.value?(a(),l("span",mt,B(Y.value),1)):h("",!0),$.value?(a(),l("span",vt,B($.value),1)):h("",!0),C.value?(a(),l("span",ft,B(C.value),1)):h("",!0)]),t("div",ht,[r[13]||(r[13]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",bt,[_e(t("input",{"onUpdate:modelValue":r[6]||(r[6]=N=>n.value=N),type:"text",placeholder:"Cari atau ketik nama mobil...",class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":re.value}]),onInput:z,onFocus:r[7]||(r[7]=N=>x.value=!0),onBlur:_},null,34),[[Ne,n.value]]),j.value?(a(),l("div",xt,r[10]||(r[10]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):h("",!0),re.value?(a(),l("span",wt,"Nama mobil tidak boleh kosong.")):h("",!0),!ue(p).car_id&&n.value?(a(),l("div",yt,r[11]||(r[11]=[nt('<div class="flex items-start" data-v-a6c054b9><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-a6c054b9><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-a6c054b9></path></svg><div data-v-a6c054b9><p class="text-yellow-800 font-medium mb-1" data-v-a6c054b9>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-a6c054b9> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-a6c054b9>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-a6c054b9> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-a6c054b9> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-a6c054b9>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-a6c054b9>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):h("",!0),x.value?(a(),l("div",kt,[H.value.length>0?(a(),l("div",$t,[(a(!0),l(me,null,ve(H.value,N=>(a(),l("div",{key:N.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:J=>v(N)},[t("div",It,B(T(N)),1),t("div",_t,B(N.year)+" • "+B(N.cc)+"cc • "+B(N.transmission)+" • "+B(N.fuel_type),1)],40,Ct))),128))])):(a(),l("div",Vt,r[12]||(r[12]=[de(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),de(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):h("",!0)])]),ue(p).car_id&&U.value?(a(),l("div",St,[U.value.description?(a(),l("div",Mt,[r[14]||(r[14]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:U.value.description},null,8,Ut)])):h("",!0),K.value.length>0?(a(),l("div",jt,[r[15]||(r[15]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",Nt,[(a(!0),l(me,null,ve(K.value,(N,J)=>(a(),l("div",{key:N.id||J,class:"relative group cursor-pointer",onClick:ae=>G(J)},[t("img",{src:F(N),alt:N.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Rt),N.note?(a(),l("div",Tt,[t("p",qt,B(N.note),1)])):h("",!0)],8,Dt))),128))])])):(a(),l("div",At," Tidak ada gambar tersedia untuk mobil ini "))])):h("",!0),O.value?(a(),l("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:q},[t("div",Lt,[t("button",{onClick:q,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},r[16]||(r[16]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),K.value.length>1?(a(),l("button",{key:0,onClick:Re(Z,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},r[17]||(r[17]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):h("",!0),K.value.length>1?(a(),l("button",{key:1,onClick:Re(R,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},r[18]||(r[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):h("",!0),t("img",{src:F(K.value[d.value]),alt:"Car Image "+(d.value+1),class:"max-w-full max-h-full object-contain",onClick:r[8]||(r[8]=Re(()=>{},["stop"]))},null,8,Bt),K.value.length>1?(a(),l("div",Ft,B(d.value+1)+" / "+B(K.value.length),1)):h("",!0),(E=K.value[d.value])!=null&&E.note?(a(),l("div",zt,B(K.value[d.value].note),1)):h("",!0)])])):h("",!0),pe(rt,{type:"button",onClick:be,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!fe.value},{default:Ve(()=>[ue(p).processing?(a(),l("svg",Et,r[19]||(r[19]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):h("",!0),t("span",null,B(ue(p).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),pe(ut,{on:ue(p).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:Ve(()=>r[20]||(r[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),de(" Tersimpan. ")])),_:1,__:[20]},8,["on"])]),_:1},8,["disabled"])])):h("",!0)])}}},Ot=Se(Ht,[["__scopeId","data-v-a6c054b9"]]),Wt={class:"mt-1"},Kt=["value","required","minlength","maxlength","allowSpace","placeholder"],Zt={key:0,class:"mt-2 text-sm text-red-600"},Qe={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(e,{emit:M}){const s=e,w=M,p=te(()=>{if(!s.modelValue)return"";let b=s.modelValue;switch(s.allowSpace||(b=b.replace(/\s+/g,"")),s.textTransform){case"uppercase":return b.toUpperCase();case"lowercase":return b.toLowerCase();case"capitalize":return b.replace(/\b\w/g,c=>c.toUpperCase());default:return b}}),u=b=>{let c=b.target.value;switch(s.allowSpace||(c=c.replace(/\s+/g,"")),s.textTransform){case"uppercase":c=c.toUpperCase();break;case"lowercase":c=c.toLowerCase();break;case"capitalize":c=c.replace(/\b\w/g,i=>i.toUpperCase());break}w("update:modelValue",c),w("save",s.pointId)};return(b,c)=>(a(),l("div",Wt,[t("input",{value:p.value,onInput:u,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,allowSpace:e.allowSpace,placeholder:e.placeholder,class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:e.textTransform==="uppercase",lowercase:e.textTransform==="lowercase",capitalize:e.textTransform==="capitalize"}])},null,42,Kt),e.error?(a(),l("p",Zt,B(e.error),1)):h("",!0)]))}},Gt={class:"mt-1"},Jt=["value","required","min","max"],Xt={key:0,class:"mt-2 text-sm text-red-600"},Pe={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:M}){const s=e,w=M,p=u=>{w("update:modelValue",u.target.value),w("save",s.pointId)};return(u,b)=>(a(),l("div",Gt,[t("input",{value:e.modelValue,onChange:p,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Jt),e.error?(a(),l("p",Xt,B(e.error),1)):h("",!0)]))}},Yt={class:"mt-1"},Qt=["value","required","placeholder"],Pt={key:0,class:"mt-2 text-sm text-red-600"},et={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:M}){const s=e,w=M,p=V(""),u=te(()=>{var y,S,$,C;return{currency_symbol:((y=s.settings)==null?void 0:y.currency_symbol)||"Rp",thousands_separator:((S=s.settings)==null?void 0:S.thousands_separator)||",",min_value:(($=s.settings)==null?void 0:$.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((C=s.settings)==null?void 0:C.max_value)!==void 0?Number(s.settings.max_value):1e9}}),b=y=>{if(y==null||y==="")return"";const S=Number(y);if(isNaN(S))return"";let $=S.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return u.value.thousands_separator!==","&&($=$.replace(/,/g,u.value.thousands_separator)),$},c=y=>y?y.replace(/[^\d]/g,""):"",i=te(()=>p.value?`${u.value.currency_symbol} ${b(p.value)}`:""),I=y=>{let S=c(y.target.value),$=Number(S);u.value.min_value!==void 0&&$<u.value.min_value&&(S=u.value.min_value.toString()),u.value.max_value!==void 0&&$>u.value.max_value&&(S=u.value.max_value.toString()),p.value=S,w("update:modelValue",S),w("save",s.pointId)};return we(()=>s.modelValue,y=>{y!=null&&(p.value=y.toString())},{immediate:!0}),(y,S)=>(a(),l("div",Yt,[t("input",{value:i.value,onInput:I,type:"text",required:e.required,placeholder:e.placeholder,class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,Qt),e.error?(a(),l("p",Pt,B(e.error),1)):h("",!0)]))}},es={class:"mt-1 space-y-3"},ts={key:0,class:"space-y-2"},ss={class:"flex flex-wrap gap-2"},ns=["onClick"],as=["value","required","minlength","maxlength","placeholder"],os={class:"flex justify-between items-center mt-1"},is={class:"text-xs text-gray-500"},ls={key:0,class:"text-xs text-red-600"},tt={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:M}){const s=e,w=M,p=V([]),u=V(""),b=y=>p.value.some(S=>S.value===y),c=y=>{b(y.value)?p.value=p.value.filter(n=>n.value!==y.value):p.value.push(y);const $=[...p.value.map(n=>n.value)];u.value.trim()&&$.push(u.value.trim());const C=$.join(", ");w("update:modelValue",C),w("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:C})},i=y=>{const S=y.target.value;w("update:modelValue",S),w("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:S}),I(S)},I=y=>{var n,x,j,H;if(!y){p.value=[],u.value="";return}const S=y.split(",").map(U=>U.trim()).filter(U=>U),$=((x=(n=s.settings)==null?void 0:n.damage_options)==null?void 0:x.map(U=>U.value))||[];p.value=((H=(j=s.settings)==null?void 0:j.damage_options)==null?void 0:H.filter(U=>S.includes(U.value)))||[];const C=S.filter(U=>!$.includes(U));u.value=C.join(", ")};return we(()=>s.modelValue,y=>{y!=null&&I(y)},{immediate:!0}),(y,S)=>{var $,C,n;return a(),l("div",es,[($=e.settings)!=null&&$.enable_damage&&((C=e.settings)!=null&&C.damage_options)?(a(),l("div",ts,[S[0]||(S[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",ss,[(a(!0),l(me,null,ve(e.settings.damage_options,(x,j)=>(a(),l("button",{key:j,type:"button",onClick:H=>c(x),class:oe(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":b(x.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!b(x.value)}])},B(x.label),11,ns))),128))])])):h("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:i,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,as),t("div",os,[t("span",is,B(((n=e.modelValue)==null?void 0:n.length)||0)+"/"+B(e.maxLength||400),1),e.error?(a(),l("p",ls,B(e.error),1)):h("",!0)])])])}}},rs={class:"mt-1"},us=["value","required"],ds={key:0,class:"mt-2 text-sm text-red-600"},cs={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:M}){const s=e,w=M,p=u=>{w("update:modelValue",u.target.value),w("save",s.pointId)};return(u,b)=>(a(),l("div",rs,[t("select",{value:e.modelValue,onChange:p,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},b[0]||(b[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,us),e.error?(a(),l("p",ds,B(e.error),1)):h("",!0)]))}},gs=Se(cs,[["__scopeId","data-v-c34a74db"]]),ps={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},ms={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},vs={class:"text-xs text-gray-500 mt-2 text-center"},fs={class:"flex flex-row space-x-4 mb-6"},hs={class:"mt-4 text-right"},bs={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(M,s)=>e.show?(a(),l("div",ps,[t("div",ms,[s[7]||(s[7]=t("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),t("p",vs,[s[3]||(s[3]=de("Ambil Foto Maksimal: ")),t("b",null,B(e.settings.max_files),1),s[4]||(s[4]=de(" Dengan Rasio & Ukuran: ")),t("b",null,B(e.settings.camera_aspect_ratio),1)]),t("div",fs,[t("button",{onClick:s[0]||(s[0]=w=>M.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[5]||(s[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:s[1]||(s[1]=w=>M.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[6]||(s[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",hs,[t("button",{onClick:s[2]||(s[2]=w=>M.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):h("",!0)}},xs={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},ws={class:"webcam-content-box"},ys={class:"webcam-header"},ks={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},$s={class:"inspection-point-name"},Cs={key:0,class:"screen-flash-overlay"},Is={key:2,class:"zoom-controls"},_s=["max"],Vs={class:"webcam-footer"},Ss={class:"camera-controls"},Ms=["disabled"],Us={class:"camera-icon-container"},js={key:0,class:"camera-spinner"},Ns={key:1,class:"camera-body"},Ds={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(e,{emit:M}){const s=e,w=M,p=V(null),u=V(null);let b=null,c=null;const i=V("environment"),I=V(!1),y=V(!1),S=V(!1),$=V(!1),C=V(!1),n=V({}),x=V(!1),j=V(1),H=V(1),U=V(!1),K=te(()=>{var T;return((T=s.settings)==null?void 0:T.max_size)||2048}),O=te(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),d=te(()=>{if(!s.aspectRatio)return{};const T=s.aspectRatio,z=T>1?80:60,o=T>1?80/T:60*T;return{width:`${z}%`,height:`${o}%`}}),A=async()=>{b&&b.getTracks().forEach(T=>T.stop());try{const T={facingMode:i.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};b=await navigator.mediaDevices.getUserMedia({video:T,audio:!1}),c=b.getVideoTracks()[0],p.value.srcObject=b,p.value.onloadedmetadata=async()=>{await X(),await p.value.play()}}catch(T){console.error("Error accessing camera: ",T),alert("Failed to access camera. Please allow camera permission."),w("close")}},W=()=>{b&&b.getTracks().forEach(T=>T.stop()),w("close")},X=async()=>{if(c)try{const T=await navigator.mediaDevices.enumerateDevices();I.value=T.filter(o=>o.kind==="videoinput").length>1;const z=c.getCapabilities();z.zoom?(U.value=!0,H.value=z.zoom.max,console.log(`Zoom supported. Max zoom: ${H.value}`)):(U.value=!1,console.warn("Zoom is not supported by this camera.")),y.value=z.torch||z.fillLightMode&&z.fillLightMode.includes("torch")}catch(T){console.error("Error checking camera capabilities:",T)}},ee=async T=>{if(!c)return;const z=p.value.getBoundingClientRect(),o=T.clientX-z.left,_=T.clientY-z.top;C.value=!0,n.value={left:`${o}px`,top:`${_}px`,transform:"translate(-50%, -50%)"};try{if(c.getCapabilities().pointsOfInterest){const F=o/z.width,D=_/z.height;await c.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:F,y:D}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(v){console.warn("Manual focus failed:",v)}setTimeout(()=>{C.value=!1,c.getCapabilities().focusMode.includes("continuous")&&c.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},re=async T=>{if(!c||!U.value)return;const z=Math.min(Math.max(T,1),H.value);j.value=z;try{await c.applyConstraints({advanced:[{zoom:z}]})}catch(o){console.error("Failed to set zoom:",o)}},Y=async()=>{if(!(!c||!y.value))try{i.value==="user"?(S.value=!S.value,$.value=S.value):(await c.applyConstraints({advanced:[{torch:!S.value}]}),S.value=!S.value)}catch(T){console.error("Flash toggle failed:",T)}},ie=async()=>{I.value&&(i.value=i.value==="environment"?"user":"environment",b&&b.getTracks().forEach(T=>T.stop()),await A())},ce=async T=>new Promise(z=>{const o=K.value*1024;if(T.size<=o){z(T);return}const _=new Image,v=new FileReader;v.onload=F=>{_.onload=()=>{const D=document.createElement("canvas"),G=D.getContext("2d"),q=Math.sqrt(o/T.size);D.width=_.width*q,D.height=_.height*q,G.drawImage(_,0,0,D.width,D.height);let R=.9;const Z=()=>{D.toBlob(Q=>{Q.size>o&&R>.1?(R-=.1,Z()):z(Q)},"image/jpeg",R)};Z()},_.src=F.target.result},v.readAsDataURL(T)}),fe=async()=>{if(!(x.value||!p.value||!u.value)){x.value=!0;try{const T=p.value,z=u.value,o=T.videoWidth,_=T.videoHeight;let v,F,D,G;o/_>s.aspectRatio?(F=_,v=_*s.aspectRatio,D=(o-v)/2,G=0):(v=o,F=o/s.aspectRatio,D=0,G=(_-F)/2),z.width=v,z.height=F,z.getContext("2d").drawImage(T,D,G,v,F,0,0,v,F);const R=await new Promise(Q=>{z.toBlob(Q,"image/jpeg",1)}),Z=await ce(R);if(Z){const Q=new File([Z],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});w("photoCaptured",Q),$.value=!0,setTimeout(()=>{$.value=!1},100)}}catch(T){console.error("Error capturing photo:",T),alert("Failed to capture photo. Please try again.")}finally{x.value=!1}}};return we(()=>s.show,T=>{T?A():W()}),Ee(()=>{b&&b.getTracks().forEach(T=>T.stop())}),(T,z)=>{var o;return e.show?(a(),l("div",xs,[t("div",ws,[t("div",ys,[t("p",ks,B(e.settings.camera_aspect_ratio),1),t("div",$s,B(((o=e.point)==null?void 0:o.name)||"Camera"),1),t("button",{onClick:W,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},z[2]||(z[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:Te(O.value),onClick:ee,onTouchstart:ee},[t("video",{ref_key:"webcamVideo",ref:p,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:u,class:"hidden"},null,512),$.value?(a(),l("div",Cs)):h("",!0),t("div",{class:"aspect-ratio-guide",style:Te(d.value)},null,4),C.value?(a(),l("div",{key:1,class:"focus-indicator",style:Te(n.value)},z[3]||(z[3]=[t("div",{class:"focus-ring"},null,-1)]),4)):h("",!0),z[4]||(z[4]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),U.value?(a(),l("div",Is,[_e(t("input",{type:"range",min:"1",max:H.value,step:"0.1","onUpdate:modelValue":z[0]||(z[0]=_=>j.value=_),onInput:z[1]||(z[1]=_=>re(parseFloat(_.target.value))),class:"zoom-slider"},null,40,_s),[[Ne,j.value]])])):h("",!0)],36),t("div",Vs,[t("div",Ss,[e.settings.enable_flash&&y.value?(a(),l("button",{key:0,onClick:Y,class:oe(["control-button",{active:S.value,disabled:!y.value}])},z[5]||(z[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):h("",!0),t("button",{onClick:fe,class:"capture-button",disabled:x.value},[t("div",Us,[x.value?(a(),l("div",js)):(a(),l("div",Ns,z[6]||(z[6]=[t("div",{class:"camera-lens"},null,-1),t("div",{class:"camera-flash"},null,-1)])))])],8,Ms),e.settings.enable_camera_switch&&I.value?(a(),l("button",{key:1,onClick:ie,class:"control-button"},z[7]||(z[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):h("",!0)])])])])):h("",!0)}}},Rs=Se(Ds,[["__scopeId","data-v-b94530cf"]]),Ts={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},qs={class:"w-full h-full flex flex-col"},As={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Ls={class:"text-lg font-semibold"},Bs={class:"flex items-center gap-2"},Fs={class:"flex-1 flex items-center justify-center overflow-hidden relative"},zs=["src"],Es={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Hs={class:"flex justify-between items-center w-full"},Os=["disabled"],Ws={key:1,class:"flex-1"},Ks=["disabled"],Zs={class:"flex gap-3 w-full"},Gs={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},Js={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(e,{emit:M}){const s=e,w=M,p=V(0),u=V([]),b=te(()=>u.value.length>0?u.value[p.value]:null);we(()=>s.images,x=>{u.value=x.map(j=>({...j,rotation:j.rotation||0})),x.length===0&&s.show&&$()},{deep:!0,immediate:!0}),we(()=>s.show,x=>{x&&s.images.length>0&&(p.value=s.initialIndex)});const c=x=>x.preview||(x.image_path?`/${x.image_path}`:""),i=()=>{if(b.value){const x=(b.value.rotation+90)%360;u.value[p.value].rotation=x,w("update:images",u.value)}},I=()=>{p.value=p.value<u.value.length-1?p.value+1:0},y=()=>{p.value=p.value>0?p.value-1:u.value.length-1},S=()=>{s.isUploading||w("saveImages",u.value)},$=()=>{s.isUploading||w("close")},C=()=>{if(b.value&&!s.isUploading){const x=b.value,j=u.value.findIndex(H=>H.isNew&&x.isNew&&H.preview===x.preview||!H.isNew&&!x.isNew&&H.id===x.id);j!==-1&&(w("removePreviewImage",x),u.value.splice(j,1),w("update:images",u.value)),p.value>=u.value.length&&(p.value=Math.max(0,u.value.length-1)),u.value.length===0&&w("close")}},n=()=>{s.isUploading||w("triggerAddMorePhotos")};return(x,j)=>{var H;return e.show?(a(),l("div",Ts,[t("div",qs,[t("div",As,[t("button",{onClick:$,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},j[0]||(j[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",Ls,B(((H=e.point)==null?void 0:H.name)||"Preview")+" ("+B(p.value+1)+"/"+B(u.value.length)+") ",1),t("div",Bs,[b.value&&b.value.isNew?(a(),l("button",{key:0,onClick:C,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},j[1]||(j[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):h("",!0),b.value&&b.value.isNew?(a(),l("button",{key:1,onClick:i,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},j[2]||(j[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))):h("",!0)])]),t("div",Fs,[t("div",{class:"relative w-full max-w-full",style:Te({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"})},[b.value?(a(),l("img",{key:0,src:c(b.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Te({transform:`rotate(${b.value.rotation}deg)`})},null,12,zs)):h("",!0)],4),u.value.length>1?(a(),l("button",{key:0,onClick:y,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},j[3]||(j[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):h("",!0),u.value.length>1?(a(),l("button",{key:1,onClick:I,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},j[4]||(j[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):h("",!0)]),t("div",Es,[t("div",Hs,[b.value&&!b.value.isNew?(a(),l("button",{key:0,onClick:C,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:e.isUploading},j[5]||(j[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),de(" Hapus Foto ")]),8,Os)):(a(),l("div",Ws)),e.allowMultiple&&u.value.length<e.maxFiles?(a(),l("button",{key:2,onClick:n,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:e.isUploading},j[6]||(j[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),de(" Tambah Foto ")]),8,Ks)):h("",!0)]),t("div",Zs,[e.isUploading?(a(),l("button",Gs,j[7]||(j[7]=[de(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(a(),l("button",{key:0,onClick:S,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):h("",!0)}}},Xs=Se(Js,[["__scopeId","data-v-41f87672"]]),Ys=["accept","multiple","disabled"],Qs={class:"text-xs text-gray-500 mb-2"},Ps=["disabled"],en={class:"h-full flex flex-col items-center justify-center p-4 text-center"},tn={class:"text-xs text-gray-400 mt-1"},sn={key:0,class:"flex items-center gap-4"},nn=["src"],an=["disabled"],on={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ln=["disabled"],rn=["onClick"],un=["src"],dn={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},cn={key:0},gn={key:1,class:"ml-1"},pn={key:2,class:"mt-1 text-xs text-red-600"},mn={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:M}){const s=e,w=M,p=V(null),u=V(null),b=V(!1),c=V(!1),i=V(!1),I=V([]),y=V(0),S=V(!1),$=te(()=>Number(s.settings.max_files)>1),C=te(()=>s.settings.allowed_types.map(o=>`.${o}`).join(", ")),n=te(()=>{const o=s.settings.camera_aspect_ratio.split(":");if(o.length===2){const _=parseFloat(o[0]),v=parseFloat(o[1]);if(!isNaN(_)&&!isNaN(v)&&v!==0)return _/v}return 3/4}),x=te(()=>{const o=[],_=new Set;for(const v of I.value)v.id&&_.add(v.id),o.push(v);for(const v of s.modelValue)_.has(v.id)||o.push({...v,rotation:v.rotation||0,isNew:!1,preview:v.preview||(v.image_path?`/${v.image_path}`:null)});return o}),j=o=>o.preview||(o.image_path?`/${o.image_path}`:""),H=()=>{i.value&&(i.value=!1),b.value=!0},U=()=>{b.value=!1,p.value.click()},K=()=>{b.value=!1,c.value=!0},O=()=>{b.value=!1,x.value.length>0&&(i.value=!0)},d=()=>{c.value=!1,x.value.length>0&&(i.value=!0)},A=()=>{i.value=!1,I.value.forEach(o=>{o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview)}),I.value=[]},W=o=>new Promise(_=>{const v=new FileReader;v.onload=F=>{const D=new Image;D.onload=()=>{_({file:o,preview:URL.createObjectURL(o),rotation:0,width:D.naturalWidth,height:D.naturalHeight,isNew:!0})},D.onerror=()=>{console.error("Failed to load image for dimensions:",o.name),_({file:o,preview:URL.createObjectURL(o),rotation:0,width:0,height:0,isNew:!0})},D.src=F.target.result},v.readAsDataURL(o)}),X=o=>{const _=o.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(_)},ee=async o=>{const v=(s.settings.max_size||2048)*1024;return new Promise(F=>{const D=new Image,G=new FileReader;G.onload=q=>{D.onload=()=>{const R=document.createElement("canvas"),Z=R.getContext("2d"),Q=Math.max(D.width,D.height);R.width=Q,R.height=Q,Z.fillStyle="white",Z.fillRect(0,0,Q,Q);const se=(Q-D.width)/2,be=(Q-D.height)/2;Z.drawImage(D,se,be,D.width,D.height);let he=.9;const $e=()=>{R.toBlob(Ce=>{if(Ce.size>v&&he>.1)he-=.1,$e();else{const Ie=new File([Ce],o.name,{type:"image/jpeg",lastModified:Date.now()});F(Ie)}},"image/jpeg",he)};$e()},D.src=q.target.result},G.readAsDataURL(o)})},re=async o=>{const _=Array.from(o.target.files);if(!_.length){b.value=!1,x.value.length>0&&(i.value=!0);return}try{const v=_.filter(Z=>!X(Z));if(v.length>0){const Z=v.map(Q=>Q.name.split(".").pop()).join(", ");alert(`File type not allowed: ${Z}. Allowed types: ${s.settings.allowed_types.join(", ")}`),o.target.value="";return}const F=x.value.length,D=s.settings.max_files-F,G=await Promise.all(_.slice(0,D).map(async Z=>await ee(Z))),q=await Promise.all(G.map(W)),R=$.value?q:q.slice(0,1);$.value?I.value.push(...R):(I.value.forEach(Z=>{Z.preview&&Z.preview.startsWith("blob:")&&URL.revokeObjectURL(Z.preview)}),I.value=R),b.value=!1,R.length>0?(y.value=Math.max(0,x.value.length-R.length),i.value=!0):x.value.length>0&&(i.value=!0),o.target.value=""}catch(v){console.error("Error processing selected images:",v),alert("Failed to process selected images. Please try again."),b.value=!1,x.value.length>0&&(i.value=!0)}},Y=async o=>{const _=x.value.length;if(!$.value||_<s.settings.max_files)try{const v=await ee(o),F=new Image;F.onload=()=>{const D={file:v,preview:URL.createObjectURL(v),rotation:0,width:F.naturalWidth,height:F.naturalHeight,isNew:!0};$.value?I.value.push(D):(I.value.forEach(G=>{G.preview&&G.preview.startsWith("blob:")&&URL.revokeObjectURL(G.preview)}),I.value=[D]),c.value=!1,b.value=!1,y.value=x.value.length-1,i.value=!0},F.src=URL.createObjectURL(v)}catch(v){console.error("Error processing captured image:",v),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),c.value=!1,b.value=!1,x.value.length>0&&(i.value=!0)},ie=(o=0)=>{y.value=o,i.value=!0},ce=o=>new Promise(_=>{if(o.rotation===0||!u.value){if(!o.isNew&&!o.file){_({file:null,width:o.width,height:o.height,isOriginal:!0});return}_({file:o.file,width:o.width,height:o.height});return}const v=new Image;v.onload=async()=>{try{const F=u.value,D=F.getContext("2d"),G=v.width,q=v.height;let R,Z;o.rotation===90||o.rotation===270?(R=q,Z=G):(R=G,Z=q),F.width=R,F.height=Z,D.clearRect(0,0,F.width,F.height),D.translate(F.width/2,F.height/2),D.rotate(o.rotation*Math.PI/180),D.drawImage(v,-G/2,-q/2,G,q),D.setTransform(1,0,0,1,0,0);const Q=await new Promise(he=>{F.toBlob(he,"image/jpeg",.9)}),se=new File([Q],o.file?o.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),be=await ee(se);_({file:be,width:R,height:Z})}catch(F){console.error("Error processing rotated image:",F),_({file:o.file,width:o.width,height:o.height})}},v.onerror=()=>{console.error("Failed to load image for rotation processing:",o.preview),_({file:o.file,width:o.width,height:o.height})},v.src=o.preview}),fe=async o=>{var F,D,G,q;S.value=!0;const _=[],v=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),S.value=!1;return}try{for(const R of o){if(!R.isNew&&R.rotation===0&&R.id&&R.image_path){_.push({id:R.id,image_path:R.image_path,width:R.width,height:R.height,rotation:0,preview:R.preview});continue}const{file:Z,width:Q,height:se,isOriginal:be}=await ce(R);if(be&&!R.isNew){_.push({id:R.id,image_path:R.image_path,width:R.width,height:R.height,rotation:0,preview:R.preview});continue}Z&&v.push({file:Z,width:Q,height:se,rotation:0})}if(v.length>0){const R=new FormData;R.append("inspection_id",s.inspectionId),R.append("point_id",s.pointId),v.forEach(se=>{R.append("images[]",se.file)});const Q=(await Ge.post(route("inspections.upload-image"),R,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const se of Q)_.push({id:se.image_id,image_path:se.path,width:se.width||0,height:se.height||0,rotation:se.rotation||0,preview:se.public_url});v.forEach(se=>{se.file&&se.file.preview&&se.file.preview.startsWith("blob:")&&URL.revokeObjectURL(se.file.preview)})}w("update:modelValue",_),w("save",s.pointId),w("uploaded",{pointId:s.pointId,images:_}),A()}catch(R){if(console.error("Error during image processing/upload:",R),(D=(F=R.response)==null?void 0:F.data)!=null&&D.message)alert(`Failed to save images: ${R.response.data.message}`);else if((q=(G=R.response)==null?void 0:G.data)!=null&&q.errors){const Z=Object.values(R.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${Z}`)}else alert(`Failed to save images: ${R.message}`)}finally{S.value=!1}},T=o=>{if(o){if(o.id&&!o.isNew)z(o);else{const _=I.value.findIndex(v=>v.preview&&v.preview===o.preview&&v.isNew||v.id&&v.id===o.id);if(_!==-1){const v=I.value.splice(_,1)[0];v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}w("update:modelValue",s.modelValue.filter(v=>!(v.id&&v.id===o.id)&&!(v.preview&&v.preview===o.preview)))}y.value>=x.value.length&&(y.value=Math.max(0,x.value.length-1)),x.value.length===0&&A()}},z=async o=>{var v,F;if(o.id||o.image_path)try{await Ge.delete(route("inspections.delete-image"),{data:{image_id:o.id,image_path:o.image_path}})}catch(D){console.error("Error deleting image from server:",D),(F=(v=D.response)==null?void 0:v.data)!=null&&F.message?alert(`Failed to delete image from server: ${D.response.data.message}`):alert(`Failed to delete image from server: ${D.message}`);return}o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview);const _=s.modelValue.filter(D=>D.id!==o.id);w("update:modelValue",_),I.value=I.value.filter(D=>D.isNew&&o.isNew?D.preview!==o.preview:D.id!==o.id),w("removeImage",{image:o}),i.value&&x.value.length===0?A():i.value&&y.value>=x.value.length&&(y.value=Math.max(0,x.value.length-1))};return(o,_)=>(a(),l("div",null,[t("input",{ref_key:"galleryInput",ref:p,type:"file",accept:C.value,class:"hidden",onChange:re,multiple:$.value,disabled:S.value},null,40,Ys),t("canvas",{ref_key:"processingCanvas",ref:u,class:"hidden"},null,512),t("p",Qs,"Foto Maksimal: "+B(e.settings.max_files)+" | Rasio: "+B(e.settings.camera_aspect_ratio),1),x.value.length===0?(a(),l("label",{key:0,onClick:H,class:oe(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:S.value},[t("div",en,[_[2]||(_[2]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),_[3]||(_[3]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),t("p",tn,"Tipe: "+B(C.value),1)])],8,Ps)):(a(),l("div",{key:1,class:oe(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":e.settings.max_files==1,"bg-transparent":e.settings.max_files>1}]),"aria-label":"Image gallery"},[e.settings.max_files===1?(a(),l("div",sn,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:_[0]||(_[0]=v=>ie(0))},[t("img",{src:j(x.value[0]),class:"w-full h-full object-cover"},null,8,nn)]),t("button",{onClick:_[1]||(_[1]=Re(v=>z(x.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:S.value},_[4]||(_[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),de(" Hapus Foto ")]),8,an)])):(a(),l("div",on,[$.value&&x.value.length<e.settings.max_files?(a(),l("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:H,disabled:S.value},_[5]||(_[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,ln)):h("",!0),(a(!0),l(me,null,ve(x.value,(v,F)=>(a(),l("div",{key:v.id||v.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:D=>ie(F)},[t("img",{src:j(v),class:"w-full h-full object-cover"},null,8,un),v.isNew||v.rotation!==0?(a(),l("div",dn,[v.isNew?(a(),l("span",cn,"BARU")):h("",!0),v.rotation!==0?(a(),l("span",gn,"ROTASI")):h("",!0)])):h("",!0)],8,rn))),128))]))],2)),e.error?(a(),l("p",pn,B(e.error),1)):h("",!0),pe(bs,{show:b.value,settings:e.settings,onClose:O,onOpenWebcam:K,onTriggerGallery:U},null,8,["show","settings"]),pe(Rs,{show:c.value,"aspect-ratio":n.value,settings:e.settings,point:e.point,onClose:d,onPhotoCaptured:Y},null,8,["show","aspect-ratio","settings","point"]),pe(Xs,{show:i.value,images:x.value,point:e.point,"initial-index":y.value,"allow-multiple":$.value,"max-files":e.settings.max_files,"is-uploading":S.value,"aspect-ratio":n.value,onClose:A,onSaveImages:fe,onRemovePreviewImage:T,onTriggerAddMorePhotos:H},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},ze=Se(mn,[["__scopeId","data-v-771b7e31"]]),vn={key:0,class:"fixed inset-0 z-50 overflow-hidden"},fn={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},hn={class:"px-4 pb-2 border-b border-gray-200"},bn={class:"text-lg font-semibold text-gray-900"},xn={key:0,class:"text-sm text-gray-500 mt-1"},wn={class:"flex-1 overflow-y-auto p-4"},yn={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},kn={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:M}){const s=M,w=()=>{s("close")},p=u=>{u.key==="Escape"&&w()};return Ae(()=>{document.addEventListener("keydown",p)}),Ee(()=>{document.removeEventListener("keydown",p)}),(u,b)=>(a(),ge(Fe,{name:"bottom-sheet"},{default:Ve(()=>[e.show?(a(),l("div",vn,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:w}),t("div",fn,[b[0]||(b[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",hn,[t("h3",bn,B(e.title),1),e.subtitle?(a(),l("p",xn,B(e.subtitle),1)):h("",!0)]),t("div",wn,[Je(u.$slots,"default",{},void 0,!0)]),u.$slots.footer?(a(),l("div",yn,[Je(u.$slots,"footer",{},void 0,!0)])):h("",!0)])])):h("",!0)]),_:3}))}},st=Se(kn,[["__scopeId","data-v-7893c2dc"]]),$n={class:"space-y-4"},Cn={key:0,class:"mt-2"},In={key:1,class:"mt-2"},_n={key:2,class:"mt-2"},Vn={key:3,class:"mt-2"},Sn={key:4,class:"mt-2"},Mn={class:"text-sm font-medium text-gray-700 mb-2"},Un={key:0,class:"text-red-500"},jn={key:0,class:"text-xs text-red-500"},Nn=["name","value","checked"],Dn={key:6,class:"space-y-2"},Rn={key:0,class:"text-red-500"},Tn={key:1,class:"text-xs text-red-500"},qn={key:7,class:"mt-4"},An={class:"text-sm font-medium text-gray-700 mb-2"},Ln={key:0,class:"text-red-500"},Bn={key:0,class:"text-xs text-red-500"},Fn={class:"flex gap-2"},zn=["disabled"],He={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(e,{emit:M}){const s=e,w=M,p=c=>w("hapus",c),u=te(()=>s.options.find(c=>c.value===s.selectedValue)),b=te(()=>{var i,I,y,S,$,C,n;if(s.point.input_type==="text"&&(!((i=s.notesValue)!=null&&i.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((I=s.notesValue)!=null&&I.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((y=s.notesValue)!=null&&y.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!((S=s.notesValue)!=null&&S.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date)||s.point.input_type==="imageTOradio"&&s.imagesValue.length===0||s.options.length&&!s.selectedValue)return!1;const c=u.value;return!(s.showTextarea&&(($=c==null?void 0:c.settings)!=null&&$.show_textarea)&&(!((C=s.notesValue)!=null&&C.trim())||c.settings.min_length&&s.notesValue.length<c.settings.min_length||c.settings.max_length&&s.notesValue.length>c.settings.max_length)||s.showImageUpload&&((n=c==null?void 0:c.settings)!=null&&n.show_image_upload)&&(s.imagesValue.length===0||c.settings.max_files&&s.imagesValue.length>c.settings.max_files))});return(c,i)=>(a(),ge(st,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:i[18]||(i[18]=I=>c.$emit("close"))},{footer:Ve(()=>[e.selectedPoint?(a(),l("button",{key:0,onClick:i[15]||(i[15]=I=>p(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},i[20]||(i[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),de(" Hapus Data ")]))):h("",!0),t("div",Fn,[t("button",{type:"button",onClick:i[16]||(i[16]=I=>c.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:i[17]||(i[17]=I=>c.$emit("save")),disabled:!b.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,zn)])]),default:Ve(()=>{var I,y,S,$,C,n,x,j,H,U,K,O,d,A,W,X,ee,re,Y,ie,ce,fe,T,z,o,_,v,F,D,G;return[t("div",$n,[e.point.input_type==="text"?(a(),l("div",Cn,[pe(Qe,{"model-value":e.notesValue,required:(I=e.point.settings)==null?void 0:I.is_required,"min-length":(y=e.point.settings)==null?void 0:y.min_length,"max-length":(S=e.point.settings)==null?void 0:S.max_length,allowSpace:($=e.point.settings)==null?void 0:$.allow_space,textTransform:(C=e.point.settings)==null?void 0:C.text_transform,placeholder:((n=e.point.settings)==null?void 0:n.placeholder)||"Masukan text",error:c.error,"onUpdate:modelValue":i[0]||(i[0]=q=>c.$emit("update:notesValue",q)),onSave:i[1]||(i[1]=q=>c.$emit("saveText",q))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):h("",!0),e.point.input_type==="number"?(a(),l("div",In,[pe(Ye,{"model-value":e.notesValue,required:(x=e.point.settings)==null?void 0:x.is_required,min:(j=e.point.settings)==null?void 0:j.min,max:(H=e.point.settings)==null?void 0:H.max,step:((U=e.point.settings)==null?void 0:U.step)||1,placeholder:((K=e.point.settings)==null?void 0:K.placeholder)||"Masukan number",error:c.error,"onUpdate:modelValue":i[2]||(i[2]=q=>c.$emit("update:notesValue",q)),onSave:i[3]||(i[3]=q=>c.$emit("saveNumber",q))},null,8,["model-value","required","min","max","step","placeholder","error"])])):h("",!0),e.point.input_type==="account"?(a(),l("div",_n,[pe(et,{"model-value":e.notesValue,required:(O=e.point.settings)==null?void 0:O.is_required,placeholder:((d=e.point.settings)==null?void 0:d.placeholder)||"Masukkan nilai",error:c.error,"point-id":e.pointId,settings:e.point.settings,"onUpdate:modelValue":i[4]||(i[4]=q=>c.$emit("update:notesValue",q)),onSave:i[5]||(i[5]=q=>c.$emit("saveAccount",q))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):h("",!0),e.point.input_type==="date"?(a(),l("div",Vn,[pe(Pe,{"model-value":e.notesValue,required:(A=e.point.settings)==null?void 0:A.is_required,"min-date":(W=e.point.settings)==null?void 0:W.min_date,"max-date":(X=e.point.settings)==null?void 0:X.max_date,error:c.error,"onUpdate:modelValue":i[6]||(i[6]=q=>c.$emit("update:notesValue",q)),onSave:i[7]||(i[7]=q=>c.$emit("saveDate",q))},null,8,["model-value","required","min-date","max-date","error"])])):h("",!0),e.point.input_type==="imageTOradio"?(a(),l("div",Sn,[t("h4",Mn,[(ee=e.point.settings)!=null&&ee.required?(a(),l("span",Un,"*")):h("",!0)]),pe(ze,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point.inspection_point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":i[8]||(i[8]=q=>c.$emit("update:imagesValue",q)),onSave:i[9]||(i[9]=q=>c.$emit("saveImage",q))},null,8,["model-value","point-id","point","inspection-id","settings"]),(re=e.point.settings)!=null&&re.required&&e.imagesValue.length===0?(a(),l("p",jn," Foto wajib diupload ")):h("",!0)])):h("",!0),e.options.length?(a(),l("div",{key:5,class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),l(me,null,ve(e.options,(q,R)=>(a(),l("label",{key:R,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:q.value,checked:e.selectedValue===q.value,onChange:i[10]||(i[10]=Z=>c.$emit("update:selectedValue",Z.target.value)),class:"hidden peer"},null,40,Nn),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===q.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==q.value}])},B(q.label),3)]))),128))],2)):h("",!0),e.showTextarea&&((ie=(Y=u.value)==null?void 0:Y.settings)!=null&&ie.show_textarea)?(a(),l("div",Dn,[(ce=u.value.settings)!=null&&ce.required?(a(),l("span",Rn,"*")):h("",!0),pe(tt,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:u.value.settings,required:(fe=u.value.settings)==null?void 0:fe.required,"min-length":(T=u.value.settings)==null?void 0:T.min_length,"max-length":(z=u.value.settings)==null?void 0:z.max_length,placeholder:((o=u.value.settings)==null?void 0:o.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":i[11]||(i[11]=q=>c.$emit("update:notesValue",q)),onSave:i[12]||(i[12]=q=>c.$emit("saveTextarea",q))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(_=u.value.settings)!=null&&_.required&&!e.notesValue?(a(),l("p",Tn," Keterangan wajib diisi ")):h("",!0)])):h("",!0),e.showImageUpload&&((F=(v=u.value)==null?void 0:v.settings)!=null&&F.show_image_upload)?(a(),l("div",qn,[t("h4",An,[i[19]||(i[19]=de(" Upload Foto ")),(D=u.value.settings)!=null&&D.required?(a(),l("span",Ln,"*")):h("",!0)]),pe(ze,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:u.value.settings,"onUpdate:modelValue":i[13]||(i[13]=q=>c.$emit("update:imagesValue",q)),onSave:i[14]||(i[14]=q=>c.$emit("saveImage",q))},null,8,["model-value","point-id","point","inspection-id","settings"]),(G=u.value.settings)!=null&&G.required&&e.imagesValue.length===0?(a(),l("p",Bn," Foto wajib diupload ")):h("",!0)])):h("",!0)])]}),_:1},8,["show","title","subtitle"]))}},En={class:"mt-2 space-y-2"},Hn=["name","value","checked","onChange","required"],On={key:0,class:"p-2 rounded-lg bg-gray-50"},Wn={key:0,class:"mt-2"},Kn={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Zn=["src"],Gn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Jn={key:1,class:"mt-2"},Xn={class:"text-sm text-gray-600"},Yn={key:2,class:"mt-2 text-sm text-red-600"},Qn={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:M}){const s=e,w=M,p=V(s.notes),u=V([...s.images]),b=V(!1),c=V(""),i=V([]),I=V(""),y=V([]),S=te(()=>s.options.find(d=>d.value===s.modelValue)),$=d=>d.settings&&(d.settings.show_textarea||d.settings.show_image_upload);we(()=>s.notes,d=>{p.value=d}),we(()=>s.images,d=>{u.value=[...d]}),we(()=>s.modelValue,d=>{d&&(I.value=d)});const C=d=>{w("update:modelValue",d.value),$(d)?x():w("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:d.value,notes:"",images:[]})},n=d=>d.preview||(d.image_path?`/${d.image_path}`:d),x=()=>{I.value=s.modelValue,c.value=p.value,i.value=[...u.value],y.value=[...u.value],b.value=!0},j=()=>{c.value="",i.value=[],I.value="",b.value=!1},H=d=>{i.value=d,u.value=[...d],w("update:images",[...d]),w("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:p.value,images:[...d]})},U=d=>{},K=()=>{I.value!==s.modelValue&&w("update:modelValue",I.value),p.value=c.value,w("update:notes",c.value),u.value=[...i.value],w("update:images",[...i.value]),w("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:I.value,notes:c.value,images:i.value}),b.value=!1},O=d=>{w("hapus",d),b.value=!1};return(d,A)=>{var W,X,ee,re;return a(),l("div",En,[t("div",{class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),l(me,null,ve(e.options,(Y,ie)=>(a(),l("label",{key:ie,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:Y.value,checked:e.modelValue===Y.value,onChange:ce=>C(Y),class:"hidden peer",required:e.required},null,40,Hn),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===Y.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==Y.value}])},B(Y.label),3)]))),128))],2),e.modelValue&&S.value&&$(S.value)?(a(),l("div",On,[t("div",{class:"flex justify-between items-start"},[A[4]||(A[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:x,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((W=S.value.settings)!=null&&W.show_image_upload)?(a(),l("div",Wn,[t("div",Kn,[(a(!0),l(me,null,ve(e.images,(Y,ie)=>(a(),l("div",{key:ie,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:n(Y),class:"w-full h-full object-cover rounded"},null,8,Zn),ie===3&&e.images.length>4?(a(),l("span",Gn," +"+B(e.images.length-4),1)):h("",!0)]))),128))])])):h("",!0),e.notes&&((X=S.value.settings)!=null&&X.show_textarea)?(a(),l("div",Jn,[t("p",Xn,B(e.notes),1)])):h("",!0)])):h("",!0),b.value?(a(),ge(He,{key:(ee=e.selectedPoint)==null?void 0:ee.id,show:b.value,title:e.pointName||"Detail",subtitle:(re=S.value)==null?void 0:re.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":I.value,"notes-value":c.value,"images-value":i.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":A[0]||(A[0]=Y=>I.value=Y),"onUpdate:notesValue":A[1]||(A[1]=Y=>c.value=Y),"onUpdate:imagesValue":A[2]||(A[2]=Y=>H(Y)),onClose:j,onSave:K,onSaveTextarea:d.handleTextareaSave,onSaveImage:U,onHapus:A[3]||(A[3]=Y=>O(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):h("",!0),e.error?(a(),l("p",Yn,B(e.error),1)):h("",!0)])}}},Pn={class:"mt-2 space-y-2"},ea={key:0,class:"flex flex-wrap gap-3"},ta={key:1,class:"p-2"},sa={key:0,class:"mt-2"},na={class:"flex gap-2 overflow-x-auto scrollbar-hide"},aa=["src"],oa={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ia=["name","value","checked"],la={key:1,class:"mt-2"},ra={class:"text-sm text-gray-600"},ua={key:3,class:"mt-2 text-sm text-red-600"},da={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:M}){const s=e,w=M,p=V(s.notes),u=V([...s.images]),b=V(!1),c=V(""),i=V([]),I=V(""),y=V([]),S=te(()=>s.options.find(U=>U.value===s.modelValue)),$=U=>U.preview||(U.image_path?`/${U.image_path}`:U);we(()=>s.notes,U=>{p.value=U});const C=()=>{I.value=s.modelValue||"",c.value=p.value,i.value=[...u.value],y.value=[...u.value],b.value=!0},n=()=>{c.value="",i.value=[],I.value="",b.value=!1},x=U=>{i.value=U,u.value=[...U],w("update:images",[...U]),w("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:p.value,images:[...U]})},j=()=>{I.value!==s.modelValue&&w("update:modelValue",I.value),p.value=c.value,w("update:notes",c.value),u.value=[...i.value],w("update:images",[...i.value]),w("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:I.value,notes:c.value,images:i.value}),b.value=!1},H=U=>{w("hapus",U),b.value=!1};return(U,K)=>{var O,d,A;return a(),l("div",Pn,[!e.modelValue&&u.value.length===0&&!p.value?(a(),l("div",ea,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:C},K[4]||(K[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(a(),l("div",ta,[t("div",{class:"flex justify-between items-start"},[K[5]||(K[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:C,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),u.value.length>0?(a(),l("div",sa,[t("div",na,[(a(!0),l(me,null,ve(u.value,(W,X)=>(a(),l("div",{key:X,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:$(W),class:"w-full h-full object-cover rounded"},null,8,aa),X===3&&u.value.length>4?(a(),l("span",oa," +"+B(u.value.length-4),1)):h("",!0)]))),128))])])):h("",!0),t("div",{class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),l(me,null,ve(e.options,(W,X)=>(a(),l("label",{key:X,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:W.value,checked:e.modelValue===W.value,disabled:!0,class:"hidden peer"},null,8,ia),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===W.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==W.value}])},B(W.label),3)]))),128))],2),p.value&&((O=S.value.settings)!=null&&O.show_textarea)?(a(),l("div",la,[t("p",ra,B(p.value),1)])):h("",!0)])),b.value?(a(),ge(He,{key:(d=e.selectedPoint)==null?void 0:d.id,show:b.value,title:e.pointName||"Detail",subtitle:(A=S.value)==null?void 0:A.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":I.value,"notes-value":c.value,"images-value":i.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":K[0]||(K[0]=W=>I.value=W),"onUpdate:notesValue":K[1]||(K[1]=W=>c.value=W),"onUpdate:imagesValue":K[2]||(K[2]=W=>x(W)),onClose:n,onSave:j,onHapus:K[3]||(K[3]=W=>H(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):h("",!0),e.error?(a(),l("p",ua,B(e.error),1)):h("",!0)])}}},ca={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ga={class:"bg-indigo-200 px-6 py-2 border-b"},pa={class:"text-xl font-semibold text-indigo-700"},ma={class:"p-4 space-y-4"},va={class:"flex items-start justify-between"},fa={class:"block text-sm font-medium text-gray-700"},ha={key:0,class:"text-red-500"},ba={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},xa={key:0,class:"text-center py-8 text-gray-500"},wa={key:0,class:"text-xs text-gray-400"},ya={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(e,{emit:M}){const s=e,w=M,p=at(),u=te(()=>{var C;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(C=s.category.points)==null?void 0:C.length}),!s.category.isDamageMenu)return console.log("Menu biasa - tampilkan semua points"),s.category.points||[];const $=(s.category.points||[]).filter(n=>{var H,U;const x=(H=n.inspection_point)==null?void 0:H.id,j=b(x);return console.log(`Point ${x} (${(U=n.inspection_point)==null?void 0:U.name}): hasData = ${j}`),j});return console.log("Filtered damage points:",$),$}),b=$=>{if(!$)return console.log("hasPointData: pointId is null/undefined"),!1;const C=p.props.existingResults[$]!==void 0,n=p.props.existingImages[$]&&p.props.existingImages[$].length>0,x=s.form.results[$]&&(s.form.results[$].status||s.form.results[$].note),j=s.form.images[$]&&s.form.images[$].length>0,H=C||n||x||j;return console.log(`Point ${$} data check:`,{hasServerResult:C,hasServerImages:n,hasLocalResult:x,hasLocalImages:j,finalResult:H}),H},c=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],i=$=>{var x,j,H,U,K,O,d,A,W;const C=s.form.results[(x=$.inspection_point)==null?void 0:x.id],n=s.form.images[(j=$.inspection_point)==null?void 0:j.id];if(!C)return!1;switch($.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!C.note;case"select":case"radio":if(!C.status)return!1;const X=(U=(H=$.settings)==null?void 0:H.radios)==null?void 0:U.find(re=>re.value===C.status);return!(X!=null&&X.settings&&(X.settings.show_textarea&&!((K=C.note)!=null&&K.trim())||X.settings.show_image_upload&&(n==null?void 0:n.length)===0));case"imageTOradio":if((n==null?void 0:n.length)===0||!C.status)return!1;const ee=(d=(O=$.settings)==null?void 0:O.radios)==null?void 0:d.find(re=>re.value===C.status);return!(ee!=null&&ee.settings&&ee.settings.show_textarea&&!((A=C.note)!=null&&A.trim()));case"image":return(n==null?void 0:n.length)>0;default:return!!C.status||!!((W=C.note)!=null&&W.trim())}},I=($,C,n)=>{w("updateResult",{pointId:$,type:n,value:C})},y=$=>{w("saveResult",$)},S=$=>{w("hapusPoint",$)};return($,C)=>(a(),l("div",ca,[t("div",ga,[t("h3",pa,B(e.category.name),1)]),t("div",ma,[(a(!0),l(me,null,ve(u.value,n=>{var x,j,H,U,K,O,d,A,W,X,ee,re,Y,ie,ce,fe,T,z,o,_,v,F,D,G,q,R,Z,Q,se,be,he,$e,Ce,Ie,g,k,f,r,E,N,J,ae,le,ne,xe,Me,ye,ke,P,je,De,Le,Oe,We,Ke,Ze;return a(),l("div",{key:n.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",va,[t("label",fa,[de(B((x=n.inspection_point)==null?void 0:x.name)+" ",1),(j=n.settings)!=null&&j.is_required?(a(),l("span",ha,"*")):h("",!0)]),i(n)?(a(),l("span",ba," ✓ ")):h("",!0)]),n.input_type==="text"?(a(),ge(Qe,{key:0,modelValue:e.form.results[(H=n.inspection_point)==null?void 0:H.id].note,"onUpdate:modelValue":[L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].note=L},L=>{var m;return I((m=n.inspection_point)==null?void 0:m.id,L,"note")}],required:(U=n.settings)==null?void 0:U.is_required,"min-length":(K=n.settings)==null?void 0:K.min_length,"max-length":(O=n.settings)==null?void 0:O.max_length,allowSpace:(d=n.settings)==null?void 0:d.allow_space,textTransform:(A=n.settings)==null?void 0:A.text_transform,placeholder:((W=n.settings)==null?void 0:W.placeholder)||"Masukan text",error:e.form.errors[`results.${(X=n.inspection_point)==null?void 0:X.id}.note`],onSave:L=>{var m;return y((m=n.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):h("",!0),n.input_type==="number"?(a(),ge(Ye,{key:1,modelValue:e.form.results[(ee=n.inspection_point)==null?void 0:ee.id].note,"onUpdate:modelValue":[L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].note=L},L=>{var m;return I((m=n.inspection_point)==null?void 0:m.id,L,"note")}],required:(re=n.settings)==null?void 0:re.is_required,min:(Y=n.settings)==null?void 0:Y.min,max:(ie=n.settings)==null?void 0:ie.max,step:((ce=n.settings)==null?void 0:ce.step)||1,placeholder:((fe=n.settings)==null?void 0:fe.placeholder)||"Masukan number",error:e.form.errors[`results.${(T=n.inspection_point)==null?void 0:T.id}.note`],onSave:L=>{var m;return y((m=n.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):h("",!0),n.input_type==="account"?(a(),ge(et,{key:2,modelValue:e.form.results[(z=n.inspection_point)==null?void 0:z.id].note,"onUpdate:modelValue":[L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].note=L},L=>{var m;return I((m=n.inspection_point)==null?void 0:m.id,L,"note")}],required:(o=n.settings)==null?void 0:o.is_required,placeholder:((_=n.settings)==null?void 0:_.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${(v=n.inspection_point)==null?void 0:v.id}.note`],"point-id":(F=n.inspection_point)==null?void 0:F.id,settings:n.settings,onSave:L=>{var m;return y((m=n.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):h("",!0),n.input_type==="date"?(a(),ge(Pe,{key:3,modelValue:e.form.results[(D=n.inspection_point)==null?void 0:D.id].note,"onUpdate:modelValue":[L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].note=L},L=>{var m;return I((m=n.inspection_point)==null?void 0:m.id,L,"note")}],required:(G=n.settings)==null?void 0:G.is_required,"min-date":(q=n.settings)==null?void 0:q.min_date,"max-date":(R=n.settings)==null?void 0:R.max_date,error:e.form.errors[`results.${(Z=n.inspection_point)==null?void 0:Z.id}.note`],onSave:L=>{var m;return y((m=n.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):h("",!0),n.input_type==="textarea"?(a(),ge(tt,{key:4,modelValue:e.form.results[(Q=n.inspection_point)==null?void 0:Q.id].note,"onUpdate:modelValue":[L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].note=L},L=>{var m;return I((m=n.inspection_point)==null?void 0:m.id,L,"note")}],required:(se=n.settings)==null?void 0:se.is_required,"min-length":(be=n.settings)==null?void 0:be.min_length,"max-length":(he=n.settings)==null?void 0:he.max_length,placeholder:(($e=n.settings)==null?void 0:$e.placeholder)||"Masukkan teks di sini",settings:n.settings,error:e.form.errors[`results.${(Ce=n.inspection_point)==null?void 0:Ce.id}.note`],onSave:L=>{var m;return y((m=n.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):h("",!0),n.input_type==="radio"?(a(),ge(Qn,{key:5,modelValue:e.form.results[(Ie=n.inspection_point)==null?void 0:Ie.id].status,"onUpdate:modelValue":[L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].status=L},L=>{var m;return I((m=n.inspection_point)==null?void 0:m.id,L,"status")}],notes:e.form.results[(g=n.inspection_point)==null?void 0:g.id].note,images:e.form.images[(k=n.inspection_point)==null?void 0:k.id],required:(f=n.settings)==null?void 0:f.is_required,"point-id":(r=n.inspection_point)==null?void 0:r.id,point:n.inspection_point,"inspection-id":e.inspectionId,settings:n.settings,"point-name":(E=n.inspection_point)==null?void 0:E.name,"selected-point":n.input_type==="damage"?n.inspection_point:null,options:((N=n.settings)==null?void 0:N.radios)||c,error:e.form.errors[`results.${(J=n.inspection_point)==null?void 0:J.id}.status`],"onUpdate:notes":L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].note=L},"onUpdate:images":L=>{var m;return e.form.images[(m=n.inspection_point)==null?void 0:m.id]=L},onSave:L=>{var m;return y((m=n.inspection_point)==null?void 0:m.id)},onHapus:L=>{var m;return S((m=n.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):h("",!0),n.input_type==="imageTOradio"?(a(),ge(da,{key:6,modelValue:e.form.results[(ae=n.inspection_point)==null?void 0:ae.id].status,"onUpdate:modelValue":[L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].status=L},L=>{var m;return I((m=n.inspection_point)==null?void 0:m.id,L,"status")}],notes:e.form.results[(le=n.inspection_point)==null?void 0:le.id].note,images:e.form.images[(ne=n.inspection_point)==null?void 0:ne.id],required:(xe=n.settings)==null?void 0:xe.is_required,"point-id":(Me=n.inspection_point)==null?void 0:Me.id,"inspection-id":e.inspectionId,settings:n.settings,"point-name":(ye=n.inspection_point)==null?void 0:ye.name,point:n,"selected-point":n.input_type==="damage"?n.inspection_point:null,options:((ke=n.settings)==null?void 0:ke.radios)||c,error:e.form.errors[`results.${(P=n.inspection_point)==null?void 0:P.id}.status`],"onUpdate:notes":L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].note=L},"onUpdate:images":L=>{var m;return e.form.images[(m=n.inspection_point)==null?void 0:m.id]=L},onSave:L=>{var m;return y((m=n.inspection_point)==null?void 0:m.id)},onHapus:L=>{var m;return S((m=n.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):h("",!0),n.input_type==="image"?(a(),ge(ze,{key:7,modelValue:e.form.images[(je=n.inspection_point)==null?void 0:je.id],"onUpdate:modelValue":L=>{var m;return e.form.images[(m=n.inspection_point)==null?void 0:m.id]=L},error:e.form.errors[`images.${(De=n.inspection_point)==null?void 0:De.id}`],"inspection-id":e.inspectionId,"point-id":(Le=n.inspection_point)==null?void 0:Le.id,point:n.inspection_point,"point-name":(Oe=n.inspection_point)==null?void 0:Oe.name,settings:n.settings,"onUpdate:notes":L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].note=L},"onUpdate:status":L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].status=L}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):h("",!0),n.input_type==="select"?(a(),ge(gs,{key:8,modelValue:e.form.results[(We=n.inspection_point)==null?void 0:We.id].status,"onUpdate:modelValue":[L=>{var m;return e.form.results[(m=n.inspection_point)==null?void 0:m.id].status=L},L=>{var m;return I((m=n.inspection_point)==null?void 0:m.id,L,"status")}],required:(Ke=n.settings)==null?void 0:Ke.is_required,error:e.form.errors[`results.${(Ze=n.inspection_point)==null?void 0:Ze.id}.status`],onSave:L=>{var m;return y((m=n.inspection_point)==null?void 0:m.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):h("",!0)])}),128)),u.value.length===0?(a(),l("div",xa,[C[0]||(C[0]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),C[1]||(C[1]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),e.category.isDamageMenu?(a(),l("p",wa,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):h("",!0)])):h("",!0)])]))}},ka=Se(ya,[["__scopeId","data-v-cdbefdf5"]]),$a={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ca={class:"p-4 space-y-4-6"},Ia={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},_a=["value"],Va={class:"p-4 space-y-4-6"},Sa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ma=["value"],Ua={key:0,class:"p-4 space-y-4"},ja={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Na=["value"],Da={class:"p-4 space-y-2"},Ra={class:"flex gap-1 mb-2 p-2 bg-gray-100 rounded-md"},Ta={class:"text-xs mt-1 text-gray-500"},qa={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const M=e,s=V(null),w=V(!1);V("");const p=V(""),u=`inspection-${M.inspectionId}-note`,b=O=>{if(!O)return{};if(typeof O=="string")try{return JSON.parse(O)||{}}catch(d){return console.error("Error parsing settings JSON:",d),{}}return typeof O=="object"&&O!==null?O:{}},c=te(()=>b(M.inspection.settings).conclusion||{}),i=V({flooded:c.value.flooded||"",collision:c.value.collision||"",collision_severity:c.value.collision_severity||"",conclusion_note:""}),I=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],y=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],S=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Ae(()=>{K();const O=localStorage.getItem(u);O?i.value.conclusion_note=O:M.inspection.notes&&(i.value.conclusion_note=M.inspection.notes),ot(()=>{$()})});const $=()=>{s.value&&i.value.conclusion_note&&(s.value.innerHTML=i.value.conclusion_note)},C=qe.debounce(()=>{if(s.value){const O=window.getSelection();O.rangeCount>0&&O.getRangeAt(0),i.value.conclusion_note=s.value.innerHTML,localStorage.setItem(u,i.value.conclusion_note),U()}},500),n=O=>{O.preventDefault(),document.execCommand("insertParagraph",!1,null)},x=O=>{O.preventDefault();const d=(O.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,d)},j=O=>{if(!s.value)return;s.value.focus();const d=window.getSelection();switch(d.rangeCount>0&&d.getRangeAt(0),O){case"bold":document.execCommand("bold");break;case"italic":document.execCommand("italic");break;case"underline":document.execCommand("underline");break}C()},H=()=>{w.value=!1,s.value&&(i.value.conclusion_note=s.value.innerHTML,localStorage.setItem(u,i.value.conclusion_note),U())},U=qe.debounce(()=>{const O={flooded:i.value.flooded,collision:i.value.collision,collision_severity:i.value.collision==="yes"?i.value.collision_severity:null,conclusion_note:i.value.conclusion_note};Ue.post(route("inspections.updateConclusion",M.inspectionId),O,{preserveScroll:!0,preserveState:!0,only:[],onSuccess:()=>{localStorage.removeItem(u),p.value="⏳ Tersimpan"}})},500);we([()=>i.value.flooded,()=>i.value.collision,()=>i.value.collision_severity],()=>{U()});const K=()=>{const d=b(M.inspection.settings).conclusion||{};i.value.flooded=d.flooded||"",i.value.collision=d.collision||"",i.value.collision_severity=d.collision_severity||""};return(O,d)=>(a(),l("div",$a,[d[18]||(d[18]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),t("div",Ca,[d[11]||(d[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[de(" Apakah kendaraan pernah terkena banjir? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ia,[(a(),l(me,null,ve(I,A=>t("label",{key:A.value,class:"cursor-pointer"},[_e(t("input",{type:"radio","onUpdate:modelValue":d[0]||(d[0]=W=>i.value.flooded=W),value:A.value,class:"hidden peer",onChange:d[1]||(d[1]=(...W)=>ue(U)&&ue(U)(...W))},null,40,_a),[[Be,i.value.flooded]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.flooded===A.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.flooded!==A.value}])},B(A.label),3)])),64))])]),t("div",Va,[d[13]||(d[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[de(" Apakah kendaraan pernah mengalami tabrakan? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Sa,[(a(),l(me,null,ve(y,A=>t("label",{key:A.value,class:"cursor-pointer"},[_e(t("input",{type:"radio","onUpdate:modelValue":d[2]||(d[2]=W=>i.value.collision=W),value:A.value,class:"hidden peer",onChange:d[3]||(d[3]=(...W)=>ue(U)&&ue(U)(...W))},null,40,Ma),[[Be,i.value.collision]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.collision===A.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.collision!==A.value}])},B(A.label),3)])),64))]),i.value.collision==="yes"?(a(),l("div",Ua,[d[12]||(d[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[de("Tingkat kerusakan: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ja,[(a(),l(me,null,ve(S,A=>t("label",{key:A.value,class:"cursor-pointer"},[_e(t("input",{type:"radio","onUpdate:modelValue":d[4]||(d[4]=W=>i.value.collision_severity=W),value:A.value,class:"hidden peer",onChange:d[5]||(d[5]=(...W)=>ue(U)&&ue(U)(...W))},null,40,Na),[[Be,i.value.collision_severity]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.collision_severity===A.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.collision_severity!==A.value}])},B(A.label),3)])),64))])])):h("",!0)]),t("div",Da,[d[17]||(d[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),t("div",Ra,[t("button",{type:"button",onClick:d[6]||(d[6]=A=>j("bold")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Bold"},d[14]||(d[14]=[t("strong",null,"B",-1)])),t("button",{type:"button",onClick:d[7]||(d[7]=A=>j("italic")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Italic"},d[15]||(d[15]=[t("em",null,"I",-1)])),t("button",{type:"button",onClick:d[8]||(d[8]=A=>j("underline")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Underline"},d[16]||(d[16]=[t("u",null,"U",-1)]))]),t("div",{ref_key:"editorRef",ref:s,contenteditable:"true",class:oe(["w-full min-h-[120px] p-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 prose max-w-none",{"bg-white":!w.value,"bg-blue-50":w.value}]),onInput:d[9]||(d[9]=(...A)=>ue(C)&&ue(C)(...A)),onBlur:H,onFocus:d[10]||(d[10]=A=>w.value=!0),onKeydown:it(n,["enter"]),onPaste:x,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34),t("p",Ta,B(p.value),1)])]))}},Aa=Se(qa,[["__scopeId","data-v-819ad3a0"]]),La={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Ba={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Fa={class:"flex overflow-x-auto scrollbar-hide py-3 px-4"},za={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ea=["onClick"],Ha={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Oa={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Wa={class:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1"},Ka={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Za={class:"relative overflow-hidden"},Ga={key:0,class:"flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md"},Ja={key:1},Xa=["disabled"],Ya={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Qa={class:"space-y-4"},Pa={class:"relative"},eo={class:"max-h-64 overflow-y-auto"},to={key:0,class:"text-center py-4 text-gray-500"},so=["onClick"],no={class:"font-medium text-gray-900"},ao={class:"text-sm text-gray-500"},oo={class:"text-xs text-gray-400 mt-1"},io={key:0,class:"text-xs text-green-600 mt-1"},lo={__name:"InspectionForm",props:{inspection:Object,inspectionId:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(e){const M=e,s=V(!1),w=V(!1),p=V(""),u=V(null),b=V(""),c=V(""),i=V(""),I=V(!1),y=V(null),S=(g,k)=>{I.value=!0,y.value=k,Ue.visit(g,{onFinish:()=>{I.value=!1,y.value=null}})},$=te(()=>["vehicle",...M.appMenus.map(g=>g.id),"conclusion"]),C=V($.value[0]),n=V(0);we(C,g=>{n.value=$.value.indexOf(g)});const x=te(()=>{if(C.value==="vehicle"||C.value==="conclusion")return null;const g=M.appMenus.find(k=>k.id===C.value);return g?{...g,points:j(g.menu_point,g.input_type==="damage")}:null}),j=(g,k)=>k?(g||[]).filter(f=>{const r=f.inspection_point_id;return X(r)}):g||[],H=V({plate_number:M.inspection.plate_number,car_id:M.inspection.car_id,car_name:M.inspection.car_name}),U=V(!1),K=g=>{U.value=g},O=V(!1),d=g=>{O.value=g},A=te(()=>{var E;const g=H.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(H.value.plate_number),k=!!((E=H.value.car_name)!=null&&E.trim()),f=!O.value,r=!U.value;return g&&k&&f&&r}),W=te(()=>{if(!p.value.trim())return M.damagePoints||[];const g=p.value.toLowerCase().trim();return(M.damagePoints||[]).filter(k=>{var f,r,E,N,J;return((r=(f=k.inspection_point)==null?void 0:f.name)==null?void 0:r.toLowerCase().includes(g))||((N=(E=k.inspection_point)==null?void 0:E.description)==null?void 0:N.toLowerCase().includes(g))||((J=ee(k))==null?void 0:J.toLowerCase().includes(g))})}),X=g=>{const k=M.existingResults&&M.existingResults[g]!==void 0,f=M.existingImages&&M.existingImages[g]&&M.existingImages[g].length>0,r=o.results[g]&&(o.results[g].status||o.results[g].note),E=o.images[g]&&o.images[g].length>0;return k||f||r||E},ee=g=>{var k;return((k=g.inspection_point.component)==null?void 0:k.name)||"Komponen Tidak Diketahui"},re=g=>M.existingResults[g]||null,Y=g=>{u.value=g;const k=g.inspection_point_id,f=o.results[k]||{};b.value=f.status||"",c.value=f.note||"",s.value=!1,w.value=!0},ie=g=>{u.value&&(o.images[u.value.inspection_point_id]=g)},ce=()=>{if(u.value){const g=u.value.inspection_point_id;o.results[g]={...o.results[g],status:b.value,note:c.value},R(g),i.value="Data berhasil disimpan!",setTimeout(()=>i.value="",1e3)}T()},fe=()=>{s.value=!1,p.value=""},T=()=>{w.value=!1,u.value=null,b.value="",c.value=""},o=Xe((()=>{const g={},k={};return[...M.appMenus.flatMap(r=>r.menu_point||[]),...M.damagePoints||[]].forEach(r=>{const E=r.inspection_point_id,N=M.existingResults[E];g[E]={status:(N==null?void 0:N.status)||"",note:(N==null?void 0:N.note)||""},k[E]=M.existingImages[E]||[]}),{inspection_id:M.inspection.id,results:g,images:k,overall_note:M.inspection.overall_note||""}})()),_=g=>g.input_type==="damage"?j(g.menu_point,!0).length>0:g.id==="conclusion"?F():g.id==="vehicle"?A():j(g.menu_point,!1).every(f=>{var J,ae,le,ne,xe,Me;const r=o.results[f.inspection_point_id],E=o.images[f.inspection_point_id];if(!r)return!1;const N=v(f.settings);switch(f.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((J=r.note)!=null&&J.trim());case"select":case"radio":if(!r.status)return!1;const ye=(ae=N.radios)==null?void 0:ae.find(P=>P.value===r.status);return!(ye!=null&&ye.settings&&(ye.settings.show_textarea&&!((le=r.note)!=null&&le.trim())||ye.settings.show_image_upload&&(E==null?void 0:E.length)===0));case"imageTOradio":if((E==null?void 0:E.length)===0||!r.status)return!1;const ke=(ne=N.radios)==null?void 0:ne.find(P=>P.value===r.status);return!(ke!=null&&ke.settings&&ke.settings.show_textarea&&ke.settings.required&&!((xe=r.note)!=null&&xe.trim()));case"image":return(E==null?void 0:E.length)>0;default:return!!r.status||!!((Me=r.note)!=null&&Me.trim())}}),v=g=>{if(!g)return{};if(typeof g=="string")try{return JSON.parse(g)||{}}catch(k){return console.error("Error parsing settings JSON:",k),{}}return typeof g=="object"&&g!==null?g:{}},F=()=>{var J;const k=v(M.inspection.settings).conclusion||{},f=!!k.flooded,r=!!k.collision,E=k.collision==="yes"?!!k.collision_severity:!0,N=!!((J=M.inspection.notes)!=null&&J.trim());return f&&r&&E&&N},D=te(()=>{const k=v(M.inspection.settings).conclusion||{};return{flooded:k.flooded||null,collision:k.collision||null,collision_severity:k.collision_severity||null,note:M.inspection.notes||null,isComplete:F()}}),G=te(()=>{const g=A.value,k=M.appMenus.every(r=>_(r)),f=F();return g&&k&&f}),q=g=>{C.value=g},R=qe.debounce(async g=>{var k,f;try{await Ue.post(route("inspections.save-result"),{inspection_id:M.inspection.id,point_id:g,status:(k=o.results[g])==null?void 0:k.status,note:(f=o.results[g])==null?void 0:f.note,images:o.images[g]},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{Ue.reload({only:["existingResults","existingImages"]})}})}catch(r){console.error("Error menyimpan hasil:",r)}},500),Z=({pointId:g,type:k,value:f})=>{var r;(r=o.results[g])!=null&&r.hasOwnProperty(k)&&(o.results[g][k]=f),R(g)},Q=async g=>{if(g&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await Ue.post(route("inspections.delete-result"),{inspection_id:M.inspection.id,point_id:g},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{o.results[g]&&delete o.results[g],o.images[g]&&delete o.images[g],i.value="Data berhasil dihapus!",setTimeout(()=>{i.value=""},2e3),Ue.reload({only:["existingResults","existingImages"]})},onError:k=>{console.error("Error menghapus hasil:",k)}})}catch(k){console.error("Error menghapus hasil:",k)}T()}},se=g=>{console.log("Update vehicle:",g)},be=g=>{console.log("Save car details:",g)},he=g=>{Object.assign(o.conclusion,g),$e()},$e=qe.debounce(async()=>{try{await Ue.post(route("inspections.save-conclusion"),{inspection_id:M.inspection.id,...o.conclusion},{preserveScroll:!0,preserveState:!0})}catch(g){console.error("Error menyimpan kesimpulan:",g)}},500),Ce=()=>{if(!G.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}o.post(route("inspections.final-submit",{id:M.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:g=>{console.error("Kesalahan pengiriman:",g)}})},Ie=({pointId:g,imageId:k})=>{o.images[g]&&(o.images[g]=o.images[g].filter(f=>f.id!==k),R(g))};return Ae(()=>{}),(g,k)=>{var f,r,E,N,J,ae,le,ne,xe,Me,ye,ke;return a(),l("div",La,[t("div",Ba,[t("div",Fa,[t("button",{onClick:k[0]||(k[0]=P=>q("vehicle")),class:oe(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":C.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":C.value!=="vehicle"}])},[k[7]||(k[7]=de(" Detail Kendaraan ")),A.value?(a(),l("span",za," ✓ ")):h("",!0)],2),(a(!0),l(me,null,ve(e.appMenus,P=>(a(),l("button",{key:P.id,onClick:je=>q(P.id),class:oe(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":C.value===P.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":C.value!==P.id}])},[de(B(P.name)+" ",1),_(P)?(a(),l("span",Ha," ✓ ")):h("",!0)],10,Ea))),128)),t("button",{onClick:k[1]||(k[1]=P=>q("conclusion")),class:oe(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":C.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":C.value!=="conclusion"}])},[k[8]||(k[8]=de(" Kesimpulan ")),D.value.isComplete?(a(),l("span",Oa," ✓ ")):h("",!0)],2)])]),t("div",Wa,[pe(Fe,{name:"fade"},{default:Ve(()=>[i.value?(a(),l("div",Ka,B(i.value),1)):h("",!0)]),_:1}),t("div",Za,[pe(Fe,{name:"category-slide",mode:"out-in"},{default:Ve(()=>[C.value==="vehicle"?(a(),ge(Ot,{key:0,inspection:e.inspection,CarDetail:e.CarDetail,allInspections:M.allInspections,onUpdateVehicle:se,onSaveCarDetails:be,"onUpdate:validation":d,"onUpdate:hasUnsavedChanges":K},null,8,["inspection","CarDetail","allInspections"])):x.value&&C.value!=="conclusion"?(a(),ge(ka,{key:x.value.id,category:x.value,"inspection-id":e.inspection.id,form:ue(o),onSaveResult:ue(R),onUpdateResult:Z,onHapusPoint:Q,onRemoveImage:Ie},null,8,["category","inspection-id","form","onSaveResult"])):C.value==="conclusion"?(a(),ge(Aa,{key:2,form:ue(o),"inspection-id":e.inspection.id,inspection:e.inspection,settings:e.inspection.settings||{},onUpdateConclusion:he},null,8,["form","inspection-id","inspection","settings"])):h("",!0)]),_:1})]),C.value==="conclusion"?(a(),l("div",Ga,[pe(ue(lt),{href:g.route("inspections.pending",e.inspectionId),as:"button",type:"button",disabled:I.value&&y.value==="pending",onClick:k[2]||(k[2]=Re(P=>S(g.route("inspections.pending",e.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:Ve(()=>[I.value&&y.value==="pending"?(a(),l(me,{key:0},[k[9]||(k[9]=t("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 \r
             5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 \r
             5.824 3 7.938l3-2.647z`})],-1)),k[10]||(k[10]=t("span",null,"Memproses...",-1))],64)):(a(),l("span",Ja,"Tunda"))]),_:1},8,["href","disabled"]),t("button",{type:"button",onClick:Ce,disabled:!G.value||ue(o).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[ue(o).processing?(a(),l("svg",Ya,k[11]||(k[11]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 \r
           5.373 0 12h4zm2 5.291A7.962 7.962 0 \r
           014 12H0c0 3.042 1.135 5.824 3 \r
           7.938l3-2.647z`},null,-1)]))):h("",!0),t("span",null,B(ue(o).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Xa)])):h("",!0),!s.value&&!w.value?(a(),l("button",{key:1,onClick:k[3]||(k[3]=P=>s.value=!0),class:"fixed bottom-4 right-4 z-10 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},k[12]||(k[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):h("",!0),pe(st,{show:s.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:fe},{default:Ve(()=>[t("div",Qa,[t("div",Pa,[_e(t("input",{"onUpdate:modelValue":k[4]||(k[4]=P=>p.value=P),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Ne,p.value]]),k[13]||(k[13]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),t("div",eo,[W.value.length===0?(a(),l("div",to," Tidak ada point yang ditemukan ")):h("",!0),(a(!0),l(me,null,ve(W.value,P=>{var je,De;return a(),l("button",{key:P.id,onClick:Le=>Y(P),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[t("div",no,B((je=P.inspection_point)==null?void 0:je.name),1),t("div",ao,B((De=P.inspection_point)==null?void 0:De.description),1),t("div",oo,B(ee(P)),1),X(P.inspection_point_id)?(a(),l("div",io," ✓ Sudah ada data ")):h("",!0)],8,so)}),128))])])]),_:1},8,["show"]),w.value?(a(),ge(He,{key:(f=u.value)==null?void 0:f.id,show:w.value,title:((E=(r=u.value)==null?void 0:r.inspection_point)==null?void 0:E.name)||"Detail Point",subtitle:(J=(N=u.value)==null?void 0:N.inspection_point)==null?void 0:J.description,name:`point-${(ae=u.value)==null?void 0:ae.id}`,"inspection-id":e.inspection.id,"point-id":(le=u.value)==null?void 0:le.inspection_point_id,settings:((ne=u.value)==null?void 0:ne.settings)||{},options:((Me=(xe=u.value)==null?void 0:xe.settings)==null?void 0:Me.radios)||[],"selected-Point":u.value,"selected-value":b.value,"images-value":ue(o).images[(ye=u.value)==null?void 0:ye.inspection_point_id],"notes-value":c.value,point:u.value,"existing-data":re((ke=u.value)==null?void 0:ke.inspection_point_id),"onUpdate:selectedValue":k[5]||(k[5]=P=>b.value=P),"onUpdate:notesValue":k[6]||(k[6]=P=>c.value=P),"onUpdate:imagesValue":ie,onSave:ce,onClose:T,onHapus:Q},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):h("",!0)])])}}},vo=Se(lo,[["__scopeId","data-v-783043f3"]]);export{vo as default};
