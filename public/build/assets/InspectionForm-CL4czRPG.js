import{e as m,o as d,a,f as I,t as L,F as G,h as X,p as ne,d as V,C as Q,D as ie,n as O,k as Z,E as le,g as ee,b as J,j as de,G as se,c as H,x as ue,W as Y,q as ce,w as me,u as T,l as ge,s as he,T as ve,B as oe}from"./app-CP3L1rCy.js";import{l as re}from"./lodash-tDXwwxZZ.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"mt-1"},fe=["value","required","minlength","maxlength","pattern","placeholder"],we={key:0,class:"mt-2 text-sm text-red-600"},be={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:f}){const r=t,p=f,w=y=>{p("update:modelValue",y.target.value),p("save",r.pointId)};return(y,c)=>(d(),m("div",pe,[a("input",{value:t.modelValue,onInput:w,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,pattern:t.pattern,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,fe),t.error?(d(),m("p",we,L(t.error),1)):I("",!0)]))}},xe={class:"mt-1"},ye=["value","required","min","max","step","placeholder"],ke={key:0,class:"mt-2 text-sm text-red-600"},_e={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:f}){const r=t,p=f,w=y=>{const c=y.target.value;p("update:modelValue",c),p("save",r.pointId)};return(y,c)=>(d(),m("div",xe,[a("input",{value:t.modelValue,onInput:w,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ye),t.error?(d(),m("p",ke,L(t.error),1)):I("",!0)]))}},Ie={class:"mt-1"},$e=["value","required","min","max"],Ce={key:0,class:"mt-2 text-sm text-red-600"},Se={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:f}){const r=t,p=f,w=y=>{p("update:modelValue",y.target.value),p("save",r.pointId)};return(y,c)=>(d(),m("div",Ie,[a("input",{value:t.modelValue,onChange:w,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,$e),t.error?(d(),m("p",Ce,L(t.error),1)):I("",!0)]))}},Ve={class:"mt-1"},Me=["value","required"],Re={key:0,class:"mt-2 text-sm text-red-600"},Le={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:f}){const r=t,p=f,w=y=>{p("update:modelValue",y.target.value),p("save",r.pointId)};return(y,c)=>(d(),m("div",Ve,[a("select",{value:t.modelValue,onChange:w,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},c[0]||(c[0]=[a("option",{value:"",disabled:""},"Select status",-1),a("option",{value:"good"},"Good",-1),a("option",{value:"bad"},"Bad",-1),a("option",{value:"na"},"N/A",-1)]),40,Me),t.error?(d(),m("p",Re,L(t.error),1)):I("",!0)]))}},Ue=K(Le,[["__scopeId","data-v-c34a74db"]]),je={class:"mt-2"},Ne={class:"flex flex-col gap-2 sm:flex-row sm:items-center"},qe=["name","value","checked","onChange","required"],Be={class:"text-sm text-gray-700"},Ee={key:0,class:"mt-2 text-sm text-red-600"},Pe={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number],options:{type:Array,default:()=>[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}]}},emits:["update:modelValue","save"],setup(t,{emit:f}){const r=t,p=f,w=y=>{p("update:modelValue",y),p("save",r.pointId)};return(y,c)=>(d(),m("div",je,[a("div",Ne,[(d(!0),m(G,null,X(t.options,h=>(d(),m("label",{key:h.value,class:"inline-flex items-center space-x-2"},[a("input",{type:"radio",name:"radio-"+t.pointId,value:h.value,checked:t.modelValue===h.value,onChange:$=>w(h.value),required:t.required,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,qe),a("span",Be,L(h.label),1)]))),128))]),t.error?(d(),m("p",Ee,L(t.error),1)):I("",!0)]))}},Fe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 p-4"},Te={class:"bg-white w-full max-w-sm rounded-xl shadow-xl overflow-hidden"},We={class:"p-4"},Ae={class:"flex justify-center gap-6"},De={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","openWebcam","triggerGallery"],setup(t){return(f,r)=>t.show?(d(),m("div",Fe,[a("div",Te,[a("div",We,[r[5]||(r[5]=a("h3",{class:"text-lg font-medium text-center text-gray-800 mb-4"},"Select Image Source",-1)),a("div",Ae,[a("button",{onClick:r[0]||(r[0]=p=>f.$emit("openWebcam")),class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-blue-50 hover:bg-blue-100 transition-colors"},r[3]||(r[3]=[ne('<div class="bg-blue-100 p-3 rounded-full mb-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div><span class="text-sm font-medium text-gray-700">Camera</span>',2)])),a("button",{onClick:r[1]||(r[1]=p=>f.$emit("triggerGallery")),class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-purple-50 hover:bg-purple-100 transition-colors"},r[4]||(r[4]=[a("div",{class:"bg-purple-100 p-3 rounded-full mb-2"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1),a("span",{class:"text-sm font-medium text-gray-700"},"Gallery",-1)]))])]),a("button",{onClick:r[2]||(r[2]=p=>f.$emit("close")),class:"w-full py-3 text-center text-gray-500 font-medium border-t border-gray-100 hover:bg-gray-50 transition-colors"},"Cancel")])])):I("",!0)}},He={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},ze={class:"webcam-content-box"},Oe={class:"webcam-header"},Ge={class:"flex gap-4"},Xe=["disabled"],Ke={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ye={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Je={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Qe=["disabled"],Ze={key:0,class:"screen-flash-overlay"},et={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object},emits:["close","photoCaptured"],setup(t,{emit:f}){const r=t,p=f,w=V(null),y=V(null);let c=null,h=null;const $=V("environment"),v=V(!1),k=V(!1),s=V(!1),M=V(!1),N=async()=>{c&&c.getTracks().forEach(o=>o.stop()),s.value=!1;try{const o={facingMode:$.value,width:{ideal:1280},height:{ideal:960},aspectRatio:{exact:r.aspectRatio}};$.value==="environment"&&(o.advanced=[{focusMode:"continuous"}]),c=await navigator.mediaDevices.getUserMedia({video:o}),h=c.getVideoTracks()[0],w.value.srcObject=c,w.value.onloadedmetadata=async()=>{w.value.style.width="100%",w.value.style.height="auto",w.value.style.objectFit="cover",await E()}}catch(o){console.error("Error accessing camera: ",o),alert("Failed to access camera. Please ensure camera permissions are granted and try again."),p("close")}},q=()=>{c&&c.getTracks().forEach(o=>o.stop()),p("close")},E=async()=>{if(!h)return;const g=(await navigator.mediaDevices.enumerateDevices()).filter(_=>_.kind==="videoinput");v.value=g.length>1;const S=h.getCapabilities();k.value=S.torch||S.fillLightMode&&S.fillLightMode.includes("torch")},U=async()=>{if(!(!h||!r.settings.enable_flash)){if($.value==="user"){s.value=!s.value;return}try{if(h.getCapabilities().torch)await h.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value;else{console.warn("Torch API not directly supported, checking fillLightMode.");const o=h.getCapabilities();o.fillLightMode&&o.fillLightMode.includes("torch")?(await h.applyConstraints({fillLightMode:s.value?"none":"torch"}),s.value=!s.value):(alert("Flash/Torch is not supported on this camera."),k.value=!1)}}catch(o){console.error("Error toggling flash: ",o),alert("Could not toggle flash. Feature might not be supported."),k.value=!1}}},R=async()=>{!v.value||!r.settings.enable_camera_switch||($.value=$.value==="environment"?"user":"environment",await N())},l=async()=>{if(!h)return;const o=h.getCapabilities();if(o.focusMode&&o.focusMode.includes("continuous"))try{await h.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(g){console.warn("Failed to apply continuous focus constraint:",g)}else console.log("Autofocus not explicitly controllable or not supported.")},u=async()=>{if(!w.value||!y.value)return;$.value==="user"&&s.value&&(M.value=!0,await new Promise(e=>setTimeout(e,100)),M.value=!1);const o=w.value,g=y.value,S=g.getContext("2d"),_=o.videoWidth,C=o.videoHeight;let j=_,P=C,A=0,D=0;_/C>r.aspectRatio?(j=C*r.aspectRatio,A=(_-j)/2):_/C<r.aspectRatio&&(P=_/r.aspectRatio,D=(C-P)/2),g.width=j,g.height=P,S.drawImage(o,A,D,j,P,0,0,g.width,g.height),g.toBlob(e=>{if(e){const b=new File([e],`captured_image_${Date.now()}.png`,{type:"image/png"});p("photoCaptured",b)}else console.error("Failed to convert canvas to blob.")},"image/png")};return Q(()=>r.show,o=>{o?N():q()}),ie(()=>{c&&c.getTracks().forEach(o=>o.stop())}),(o,g)=>t.show?(d(),m("div",He,[a("div",ze,[a("div",Oe,[a("button",{onClick:q,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},g[0]||(g[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),a("div",Ge,[t.settings.enable_flash?(d(),m("button",{key:0,onClick:U,disabled:!k.value,class:O(["p-2 rounded-full text-white",{"bg-gray-700":s.value,"hover:bg-gray-700":k.value,"opacity-50 cursor-not-allowed":!k.value}])},[k.value?s.value?(d(),m("svg",Ye,g[2]||(g[2]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):(d(),m("svg",Je,g[3]||(g[3]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6"},null,-1)]))):(d(),m("svg",Ke,g[1]||(g[1]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.102 1.101m-.757 4.898l-4 4L9.828 9.828m4.899-.757l4-4L14.172 14.172"},null,-1)])))],10,Xe)):I("",!0),t.settings.enable_camera_switch?(d(),m("button",{key:1,onClick:R,disabled:!v.value,class:O(["p-2 rounded-full text-white hover:bg-gray-700",{"opacity-50 cursor-not-allowed":!v.value}])},g[4]||(g[4]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8h16M4 16h16M6 4h.01M6 20h.01M10 4h.01M10 20h.01M14 4h.01M14 20h.01M18 4h.01M18 20h.01"})],-1)]),10,Qe)):I("",!0)])]),a("div",{class:"webcam-video-container",onClick:l},[a("video",{ref_key:"webcamVideo",ref:w,autoplay:"",playsinline:"",class:"webcam-video"},null,512),a("canvas",{ref_key:"webcamCanvas",ref:y,class:"hidden"},null,512),M.value?(d(),m("div",Ze)):I("",!0)]),a("div",{class:"webcam-footer"},[a("button",{onClick:u,class:"capture-button"})])])])):I("",!0)}},tt=K(et,[["__scopeId","data-v-dbc06f8e"]]),at={key:0,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center"},st={class:"w-full h-full flex flex-col"},ot={class:"flex justify-between items-center p-4 bg-black bg-opacity-50 text-white"},rt={class:"text-lg font-medium"},nt={class:"flex-1 flex items-center justify-center overflow-hidden relative"},lt=["src"],it={class:"flex justify-between p-4 bg-black bg-opacity-50"},dt=["disabled"],ut={key:1,class:"px-4 py-2 bg-indigo-400 text-white rounded-lg cursor-not-allowed flex items-center justify-center",disabled:""},ct={__name:"ImagePreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean},emits:["close","saveImages","removePreviewImage"],setup(t,{emit:f}){const r=t,p=f,w=V(r.initialIndex),y=V(0),c=V(0),h=Z(()=>r.images.length>0?r.images[w.value]:null);Q(()=>r.initialIndex,R=>{w.value=R},{immediate:!0});const $=()=>{h.value&&(h.value.rotation=(h.value.rotation+90)%360)},v=()=>{w.value<r.images.length-1&&w.value++},k=()=>{w.value>0&&w.value--},s=R=>{y.value=R.touches[0].clientX},M=R=>{c.value=R.touches[0].clientX},N=()=>{y.value-c.value>50?v():c.value-y.value>50&&k()},q=()=>{r.images.length!==0&&(p("removePreviewImage",w.value),w.value>=r.images.length&&(w.value=Math.max(0,r.images.length-1)),r.images.length===0&&U())},E=()=>{p("saveImages",r.images)},U=()=>{p("close")};return Q(()=>r.show,R=>{R?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open")},{immediate:!0}),(R,l)=>t.show?(d(),m("div",at,[a("div",st,[a("div",ot,[a("button",{onClick:U,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},l[0]||(l[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),a("div",rt,"Preview ("+L(w.value+1)+"/"+L(t.images.length)+")",1),a("button",{onClick:$,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},l[1]||(l[1]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))]),a("div",nt,[a("div",{class:"w-full h-full flex items-center justify-center",onTouchstart:s,onTouchmove:M,onTouchend:N},[h.value?(d(),m("img",{key:0,src:h.value.preview||(h.value.image_path?`/storage/${h.value.image_path}`:""),class:"max-w-full max-h-full object-contain",style:le({transform:`rotate(${h.value.rotation}deg)`})},null,12,lt)):I("",!0)],32),t.images.length>1?(d(),m("button",{key:0,onClick:k,class:"absolute left-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},l[2]||(l[2]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):I("",!0),t.images.length>1?(d(),m("button",{key:1,onClick:v,class:"absolute right-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},l[3]||(l[3]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):I("",!0)]),a("div",it,[a("button",{onClick:q,class:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",disabled:t.isUploading}," Hapus ",8,dt),t.isUploading?(d(),m("button",ut,l[4]||(l[4]=[ee(" Menyimpan"),a("span",{class:"loading-dots ml-1"},[a("span",null,"."),a("span",null,"."),a("span",null,".")],-1)]))):(d(),m("button",{key:0,onClick:E,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Simpan "+L(t.images.length),1))])])])):I("",!0)}},mt=K(ct,[["__scopeId","data-v-81dabbf4"]]),gt=["multiple"],ht={key:1,class:"block w-full border-2 border-dashed rounded-lg transition-colors duration-200 border-indigo-300 bg-indigo-50 h-auto p-2","aria-label":"Image gallery"},vt={class:"grid grid-cols-3 gap-2"},pt=["onClick"],ft=["src"],wt=["onClick"],bt={key:0,class:"mt-2 text-center"},xt={key:2,class:"mt-1 text-xs text-red-600"},yt={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!1},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0})}},emits:["update:modelValue","save","removeImage","uploaded"],setup(t,{emit:f}){const r=t,p=f,w=V(null),y=V(null),c=V(!1),h=V(!1),$=V(!1),v=V([]),k=V(0),s=V(!1),M=Z(()=>Number(r.settings.max_files)>1),N=Z(()=>{const e=r.settings.camera_aspect_ratio.split(":");if(e.length===2){const b=parseFloat(e[0]),n=parseFloat(e[1]);if(!isNaN(b)&&!isNaN(n)&&n!==0)return b/n}return 3/4}),q=e=>e.preview||(e.image_path?`/${e.image_path}`:""),E=e=>!e.width||!e.height||e.width===0||e.height===0?{paddingBottom:"100%",position:"relative"}:{paddingBottom:`${e.height/e.width*100}%`,position:"relative"},U=()=>{c.value=!0},R=()=>{c.value=!1,w.value.click()},l=e=>new Promise(b=>{const n=new FileReader;n.onload=i=>{const x=new Image;x.onload=()=>{b({file:e,preview:URL.createObjectURL(e),rotation:0,width:x.naturalWidth,height:x.naturalHeight,isNew:!0})},x.onerror=()=>{console.error("Failed to load image for dimensions:",e.name),b({file:e,preview:URL.createObjectURL(e),rotation:0,width:0,height:0,isNew:!0})},x.src=i.target.result},n.readAsDataURL(e)}),u=e=>{const b=Array.from(e.target.files);b.length&&(M.value||(v.value.forEach(n=>n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview)),v.value=[]),Promise.all(b.map(l)).then(n=>{const i=r.modelValue.length+v.value.length,x=r.settings.max_files-i,B=M.value?n.slice(0,x):n.slice(0,1);v.value.push(...B),k.value=v.value.length-1,$.value=!0,e.target.value=""}).catch(n=>{console.error("Error processing selected images:",n),alert("Failed to process selected images. Please try again.")}))},o=()=>{c.value=!1,h.value=!0},g=()=>{h.value=!1},S=e=>{const b=r.modelValue.length+v.value.length;if(!M.value||b<r.settings.max_files){const n=new Image;n.onload=()=>{const i={file:e,preview:URL.createObjectURL(e),rotation:0,width:n.naturalWidth,height:n.naturalHeight,isNew:!0};M.value?v.value.push(i):(v.value.forEach(x=>x.preview&&x.preview.startsWith("blob:")&&URL.revokeObjectURL(x.preview)),v.value=[i]),k.value=v.value.length-1,h.value=!1,$.value=!0},n.onerror=()=>{console.error("Failed to load captured image for dimensions.");const i={file:e,preview:URL.createObjectURL(e),rotation:0,width:0,height:0,isNew:!0};M.value?v.value.push(i):(v.value.forEach(x=>x.preview&&x.preview.startsWith("blob:")&&URL.revokeObjectURL(x.preview)),v.value=[i]),k.value=v.value.length-1,h.value=!1,$.value=!0},n.src=URL.createObjectURL(e)}else alert(`Maximum ${r.settings.max_files} files allowed.`),h.value=!1},_=async(e=0)=>{const b=await Promise.all(r.modelValue.map(async i=>{if(i.width&&i.height&&i.image_path)return{...i,rotation:i.rotation||0,isNew:!1};{const x=new Image;return new Promise(B=>{x.onload=()=>B({...i,rotation:i.rotation||0,preview:i.image_path?`/${i.image_path}`:null,width:x.naturalWidth,height:x.naturalHeight,isNew:!1}),x.onerror=()=>B({...i,rotation:i.rotation||0,preview:i.image_path?`/${i.image_path}`:null,width:0,height:0,isNew:!1}),x.src=i.image_path?`/${i.image_path}`:""})}})),n=v.value.filter(i=>i.isNew||i.rotation!==0);v.value=[...b,...n],k.value=e,$.value=!0},C=()=>{$.value=!1,v.value.forEach(e=>{e.preview&&e.preview.startsWith("blob:")&&URL.revokeObjectURL(e.preview)}),v.value=[]},j=e=>new Promise(b=>{if(e.rotation===0||!y.value){b({file:e.file,width:e.width,height:e.height});return}const n=new Image;n.onload=()=>{const i=y.value,x=i.getContext("2d"),B=n.width,F=n.height;let W,z;e.rotation===90||e.rotation===270?(W=F,z=B):(W=B,z=F),i.width=W,i.height=z,x.clearRect(0,0,i.width,i.height),x.translate(i.width/2,i.height/2),x.rotate(e.rotation*Math.PI/180),x.drawImage(n,-B/2,-F/2,B,F),x.setTransform(1,0,0,1,0,0),i.toBlob(te=>{const ae=new File([te],e.file.name,{type:e.file.type});b({file:ae,width:W,height:z})},e.file.type)},n.onerror=()=>{console.error("Failed to load image for rotation processing:",e.preview),b({file:e.file,width:e.width,height:e.height})},n.src=e.preview}),P=async e=>{s.value=!0;const b=[];if(!r.pointId){alert("Error: Point ID is missing. Cannot upload image. (Check parent component)"),s.value=!1;return}console.log("Uploading for Inspection ID:",r.inspectionId,"Point ID:",r.pointId);try{for(const n of e)if(n.isNew||n.rotation!==0){const{file:i,width:x,height:B}=await j(n),F=new FormData;F.append("inspection_id",r.inspectionId),F.append("point_id",r.pointId),F.append("image",i);const W=await se.post(route("inspections.upload-image"),F,{headers:{"Content-Type":"multipart/form-data"}}),z=W.data.image,te=W.data.path,ae=W.data.public_url;b.push({id:z.id,image_path:te,width:x,height:B,rotation:0,preview:ae}),n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview)}else b.push({...n,preview:n.preview||`/${n.image_path}`});p("update:modelValue",b.slice(0,r.settings.max_files)),p("save",r.pointId),p("uploaded",{pointId:r.pointId,images:b}),C()}catch(n){if(console.error("Error during image processing/upload:",n),n.response&&n.response.data&&n.response.data.message)alert(`Failed to save images: ${n.response.data.message}`);else if(n.response&&n.response.data&&n.response.data.errors){const i=Object.values(n.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${i}`)}else alert(`Failed to save images: ${n.message}`)}finally{s.value=!1}},A=e=>{v.value.splice(e,1)},D=async e=>{const b=[...r.modelValue],n=b.splice(e,1)[0];if(n.id||n.image_path)try{await se.delete(route("inspections.delete-image"),{data:{image_path:n.image_path,image_id:n.id}}),alert("Image deleted from server successfully!")}catch(i){if(console.error("Error deleting image from server:",i),i.response&&i.response.data&&i.response.data.message)alert(`Failed to delete image from server: ${i.response.data.message}`);else if(i.response&&i.response.data&&i.response.data.errors){const x=Object.values(i.response.data.errors).flat().join(`
`);alert(`Failed to delete image:
${x}`)}else alert(`Failed to delete image from server: ${i.message}`)}n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview),p("update:modelValue",b),p("removeImage",{index:e,pointId:r.pointId,image:n}),b.length===0&&C()};return(e,b)=>(d(),m("div",null,[a("input",{ref_key:"galleryInput",ref:w,type:"file",accept:"image/*",class:"hidden",onChange:u,multiple:M.value},null,40,gt),a("canvas",{ref_key:"processingCanvas",ref:y,class:"hidden"},null,512),t.modelValue.length===0?(d(),m("label",{key:0,onClick:U,class:O(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}])},b[1]||(b[1]=[ne('<div class="h-full flex flex-col items-center justify-center p-4 text-center"><svg class="w-8 h-8 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><p class="text-sm text-gray-600 font-medium">Upload Image</p><p class="text-xs text-gray-500">Click to open options</p></div>',1)]))):(d(),m("div",ht,[a("div",vt,[(d(!0),m(G,null,X(t.modelValue,(n,i)=>(d(),m("div",{key:n.id||i,class:"relative w-full overflow-hidden rounded-md border border-gray-200 cursor-pointer",style:le(E(n)),onClick:x=>_(i)},[a("img",{src:q(n),class:"absolute top-0 left-0 w-full h-full object-contain"},null,8,ft),a("button",{onClick:de(x=>D(i),["stop"]),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm hover:bg-red-600 transition-colors z-10","aria-label":"Remove image"}," × ",8,wt)],12,pt))),128))]),M.value&&t.modelValue.length<t.settings.max_files?(d(),m("div",bt,[a("span",{onClick:U,class:"inline-block px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 hover:bg-indigo-200 transition-colors cursor-pointer"}," + Add More Images ")])):I("",!0)])),t.error?(d(),m("p",xt,L(t.error),1)):I("",!0),J(De,{show:c.value,onClose:b[0]||(b[0]=n=>c.value=!1),onOpenWebcam:o,onTriggerGallery:R},null,8,["show"]),J(tt,{show:h.value,"aspect-ratio":N.value,settings:t.settings,onClose:g,onPhotoCaptured:S},null,8,["show","aspect-ratio","settings"]),J(mt,{show:$.value,images:v.value,"initial-index":k.value,"allow-multiple":M.value,"max-files":t.settings.max_files,"is-uploading":s.value,onClose:C,onSaveImages:P,onRemovePreviewImage:A},null,8,["show","images","initial-index","allow-multiple","max-files","is-uploading"])]))}},kt={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},_t={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},It={class:"text-xl font-semibold text-indigo-700"},$t={class:"p-4 space-y-4"},Ct={class:"flex items-start justify-between"},St={class:"block text-sm font-medium text-gray-700"},Vt={key:0,class:"text-red-500"},Mt={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Rt={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:[String,Number]},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:f}){const r=t,p=f,w=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],y=v=>{var s;const k=r.form.results[v.id];if(!k)return!1;switch(v.input_type){case"text":case"number":case"date":return!!k.note;case"select":case"radio":return!!k.status;case"image":return((s=k.images)==null?void 0:s.length)>0;default:return!1}},c=(v,k)=>{p("updateResult",{pointId:v,value:k})},h=v=>{p("saveResult",v)},$=(v,k)=>{p("removeImage",{pointId:v,imageIndex:k})};return(v,k)=>(d(),m("div",kt,[a("div",_t,[a("h2",It,L(t.category.name),1)]),a("div",$t,[(d(!0),m(G,null,X(t.category.points,s=>{var M,N,q,E,U,R,l,u,o,g,S,_,C,j,P,A,D;return d(),m("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[a("div",Ct,[a("label",St,[ee(L(s.name)+" ",1),(M=s.settings)!=null&&M.is_required?(d(),m("span",Vt,"*")):I("",!0)]),y(s)?(d(),m("span",Mt," ✓ ")):I("",!0)]),s.input_type==="text"?(d(),H(be,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[e=>t.form.results[s.id].note=e,e=>c(s.id,e)],required:(N=s.settings)==null?void 0:N.is_required,"min-length":(q=s.settings)==null?void 0:q.min_length,"max-length":(E=s.settings)==null?void 0:E.max_length,pattern:(U=s.settings)==null?void 0:U.pattern,placeholder:((R=s.settings)==null?void 0:R.placeholder)||"Enter text",error:t.form.errors[`results.${s.id}.note`],onSave:e=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):I("",!0),s.input_type==="number"?(d(),H(_e,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[e=>t.form.results[s.id].note=e,e=>c(s.id,e)],required:(l=s.settings)==null?void 0:l.is_required,min:(u=s.settings)==null?void 0:u.min,max:(o=s.settings)==null?void 0:o.max,step:((g=s.settings)==null?void 0:g.step)||1,placeholder:((S=s.settings)==null?void 0:S.placeholder)||"Enter number",error:t.form.errors[`results.${s.id}.note`],onSave:e=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):I("",!0),s.input_type==="date"?(d(),H(Se,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[e=>t.form.results[s.id].note=e,e=>c(s.id,e)],required:(_=s.settings)==null?void 0:_.is_required,"min-date":(C=s.settings)==null?void 0:C.min_date,"max-date":(j=s.settings)==null?void 0:j.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:e=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):I("",!0),s.input_type==="select"?(d(),H(Ue,{key:3,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[e=>t.form.results[s.id].status=e,e=>c(s.id,e)],required:(P=s.settings)==null?void 0:P.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:e=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):I("",!0),s.input_type==="radio"?(d(),H(Pe,{key:4,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[e=>t.form.results[s.id].status=e,e=>c(s.id,e)],required:(A=s.settings)==null?void 0:A.is_required,options:((D=s.settings)==null?void 0:D.radios)||w,error:t.form.errors[`results.${s.id}.status`],onSave:e=>h(s.id)},null,8,["modelValue","onUpdate:modelValue","required","options","error","onSave"])):I("",!0),s.input_type==="image"?(d(),H(yt,{key:5,modelValue:t.form.results[s.id].images,"onUpdate:modelValue":[e=>t.form.results[s.id].images=e,e=>c(s.id,e)],error:t.form.errors[`results.${s.id}.images`],"inspection-id":t.inspectionId,"point-id":s.id,onSave:e=>h(s.id),onRemoveImage:e=>$(s.id,e)},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","onSave","onRemoveImage"])):I("",!0)])}),128))])]))}},Lt=K(Rt,[["__scopeId","data-v-b0fe3fb7"]]),Ut={class:"container mx-auto px-4 py-2"},jt={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Nt={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},qt=["onClick","data-category-id"],Bt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Et={class:"relative overflow-hidden"},Pt={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},Ft={class:"mb-4"},Tt={class:"mt-6"},Wt={class:"list-disc pl-5"},At={key:0},Dt={key:1},Ht={class:"flex justify-end gap-4 mt-8"},zt=["disabled"],Ot={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Gt={__name:"InspectionForm",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(t){var R;const f=t,r=V(((R=f.categories[0])==null?void 0:R.id)||"summary"),p=V(0);V(null);const w=Z(()=>r.value!=="summary"?f.categories.find(l=>l.id===r.value):null),c=ue((()=>{const l={};return f.categories.forEach(u=>{(u.points||[]).forEach(o=>{var S,_;const g=Array.isArray(f.existingResults)?f.existingResults.find(C=>C.point_id===o.id):null;l[o.id]={status:(g==null?void 0:g.status)||"",note:(g==null?void 0:g.note)||"",images:((_=(S=f.existingImages)==null?void 0:S[o.id])==null?void 0:_.map(C=>({image_path:C.image_path,preview:null})))||[]}})}),{inspection_id:f.inspection.id,results:l,overall_note:f.inspection.overall_note||""}})()),h=re.debounce(()=>{Y.post(route("inspections.save-overall-note"),{inspection_id:f.inspection.id,overall_note:c.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:l=>{console.error("Error menyimpan catatan keseluruhan:",l)}})},800),$=l=>l.points.every(u=>{var g;const o=c.results[u.id];if(!o)return!1;switch(u.input_type){case"text":case"number":case"date":return!!o.note;case"select":case"radio":return!!o.status;case"image":return((g=o.images)==null?void 0:g.length)>0;default:return!!o.status||!!o.note}}),v=l=>{if(l==="summary")p.value=f.categories.length;else{const u=f.categories.findIndex(o=>o.id===l);u>=0&&(p.value=u)}r.value=l},k=l=>{let u=p.value+l;const o=f.categories.length;u>=0&&u<=o&&(p.value=u,u===o?r.value="summary":r.value=f.categories[u].id)},s=()=>{let l=0,u=0;const o=C=>{l=C.changedTouches[0].screenX},g=C=>{u=C.changedTouches[0].screenX,S()},S=()=>{u<l-50?k(1):u>l+50&&k(-1)},_=document.querySelector(".relative.overflow-hidden");return _&&(_.addEventListener("touchstart",o,!1),_.addEventListener("touchend",g,!1)),()=>{_&&(_.removeEventListener("touchstart",o),_.removeEventListener("touchend",g))}},M=re.debounce(async l=>{try{await Y.post(route("inspections.save-result"),{inspection_id:f.inspection.id,point_id:l,status:c.results[l].status,note:c.results[l].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(u){console.error("Error menyimpan hasil:",u)}},500),N=({pointId:l,type:u,value:o})=>{c.results[l].hasOwnProperty(u)&&(c.results[l][u]=o),M(l)},q=async(l,u)=>{const o=l.target.files[0];if(!o)return;const g=URL.createObjectURL(o);try{const S=new FormData;S.append("inspection_id",f.inspection.id),S.append("point_id",u),S.append("image",o),await Y.post(route("inspections.upload-image"),S,{preserveScroll:!0,onSuccess:_=>{var j;const C=((j=_.props.flash)==null?void 0:j.imagePath)||_.props.imagePath;C?c.results[u].images.push({image_path:C,preview:g}):console.error("Path gambar tidak dikembalikan dari unggahan, tidak dapat memperbarui UI.")},onError:_=>{console.error("Error mengunggah gambar:",_),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(S){console.error("Error mengunggah gambar:",S),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{l.target.value=""}},E=async(l,u)=>{const o=c.results[l].images[u];if(o)try{await Y.delete(route("inspections.delete-image"),{data:{image_path:o.image_path,point_id:l,inspection_id:f.inspection.id},preserveScroll:!0,onSuccess:()=>{c.results[l].images.splice(u,1),o.preview&&URL.revokeObjectURL(o.preview)},onError:g=>{console.error("Error menghapus gambar:",g),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(g){console.error("Error menghapus gambar:",g),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},U=()=>{c.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{oe().props.flash.success="Inspeksi berhasil dikirim!"},onError:l=>{console.error("Kesalahan pengiriman:",l),oe().props.flash.error="Ada kesalahan dalam pengiriman Anda. Harap periksa semua bidang."}})};return ce(()=>{s()}),Q(r,l=>{const u=document.querySelector(`.flex-shrink-0[data-category-id="${l}"]`);u&&u.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(l,u)=>(d(),m("div",Ut,[a("div",jt,[a("div",Nt,[(d(!0),m(G,null,X(t.categories,o=>(d(),m("button",{key:o.id,onClick:g=>v(o.id),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":r.value===o.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":r.value!==o.id}]),"data-category-id":o.id},[ee(L(o.name)+" ",1),$(o)?(d(),m("span",Bt," ✓ ")):I("",!0)],10,qt))),128)),a("button",{onClick:u[0]||(u[0]=o=>v("summary")),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":r.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":r.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),a("div",Et,[J(ve,{name:"category-slide",mode:"out-in"},{default:me(()=>[w.value&&r.value!=="summary"?(d(),H(Lt,{key:w.value.id,category:w.value,form:T(c),onSaveResult:T(M),onUpdateResult:N,onRemoveImage:E,onHandleImageUpload:q},null,8,["category","form","onSaveResult"])):r.value==="summary"?(d(),m("div",Pt,[u[6]||(u[6]=a("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),a("div",Ft,[u[3]||(u[3]=a("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),ge(a("textarea",{id:"overall_note","onUpdate:modelValue":u[1]||(u[1]=o=>T(c).overall_note=o),onInput:u[2]||(u[2]=(...o)=>T(h)&&T(h)(...o)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[he,T(c).overall_note]])]),a("div",Tt,[u[4]||(u[4]=a("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Kategori:",-1)),a("ul",Wt,[(d(!0),m(G,null,X(t.categories,o=>(d(),m("li",{key:o.id,class:O({"text-green-600":$(o),"text-red-600":!$(o)})},[ee(L(o.name)+" ",1),$(o)?(d(),m("span",At,"(Selesai ✓)")):(d(),m("span",Dt,"(Belum Selesai ✗)"))],2))),128))])]),a("div",Ht,[a("button",{type:"button",onClick:U,disabled:T(c).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[T(c).processing?(d(),m("svg",Ot,u[5]||(u[5]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):I("",!0),a("span",null,L(T(c).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,zt)])])):I("",!0)]),_:1})])]))}},Jt=K(Gt,[["__scopeId","data-v-22fd310e"]]);export{Jt as default};
