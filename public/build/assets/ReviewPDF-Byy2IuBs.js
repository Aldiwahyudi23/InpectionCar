import{r as k,g as tt,q as E,c as o,o as r,b,d as e,t as d,F as _,m as w,a as et,n as G}from"./vendor-CV8_PVEu.js";import{_ as st}from"./app-BqF7l3Ee.js";const ot={class:"p-6 bg-white rounded-lg shadow-md"},rt={key:0,class:"mt-2 mb-6"},at={key:1},nt={class:"header flex flex-col gap-5 mb-6 mt-6"},dt={class:"flex items-center gap-5"},it=["src"],lt={key:1,class:"w-40 h-40 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-gray-400"},ut={class:"mt-8"},ct={class:"text-3xl font-bold m-0 text-gray-800"},gt={key:0,class:"car-info"},pt={class:"w-full border-collapse border border-gray-300 rounded-lg overflow-hidden"},bt={class:"bg-gray-50"},yt={class:"p-2 border border-gray-300 text-gray-600"},mt={class:"p-2 border border-gray-300 text-gray-600"},_t={class:"bg-gray-50"},ft={class:"p-2 border border-gray-300 text-gray-600"},vt={class:"p-2 border border-gray-300 text-gray-600"},xt={class:"bg-gray-50"},ht={class:"p-2 border border-gray-300 text-gray-600"},kt={class:"p-2 border border-gray-300 text-gray-600"},wt={class:"bg-gray-50"},It={class:"p-2 border border-gray-300 text-gray-600"},jt={class:"p-2 border border-gray-300 text-gray-600"},Ft={class:"bg-gray-50"},Dt={class:"p-2 border border-gray-300 text-gray-600"},Tt={class:"bg-gray-50"},Ct={class:"p-2 border border-gray-300 text-gray-600"},Pt={class:"bg-gray-50"},St={class:"p-2 border border-gray-300 text-gray-600"},Lt={class:"bg-gray-50"},Mt={class:"p-2 border border-gray-300 text-gray-600"},Nt={class:"bg-gray-50"},Ot={class:"p-2 border border-gray-300 text-gray-600"},Kt={key:1,class:"conclusion p-4 bg-gray-50 border-l-4 border-gray-800 rounded-lg"},Rt={class:"m-0 text-gray-600"},Bt=["innerHTML"],Ht={class:"component-title bg-gray-100 px-3 py-2 border-l-4 border-gray-800 font-bold rounded-l-lg"},Vt={key:0,class:"images flex flex-wrap gap-2 mt-4"},At=["src"],Et={key:1,class:"w-28 h-28 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-xs text-gray-400"},Gt={class:"point-name inline-block min-w-[160px] font-bold align-top text-gray-700"},Ut={class:"point-content inline-block w-[calc(100%-170px)] align-top"},$t={key:1,class:"point-note italic text-gray-600 my-1"},qt={key:0,class:"inspection-images flex flex-wrap gap-2 mt-4"},zt=["src"],Jt={key:1,class:"w-20 h-20 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-xs text-gray-400"},Wt={key:1,class:"textarea-note italic text-gray-600 my-2"},Qt={key:2,class:"flex flex-col items-center justify-center h-96 text-center"},Xt=["href"],Yt={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},Zt={class:"bg-white p-6 rounded-lg shadow-xl w-96 max-w-sm"},te={class:"flex justify-end space-x-4"},ee=["disabled"],se={key:0},oe={key:1},re={key:1,class:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200 cursor-not-allowed"},ae={__name:"ReviewPDF",props:{inspection:{type:Object,required:!0},menu_points:{type:Array,default:()=>[]},coverImage:{type:Object,default:null},encryptedIds:Object},setup(N){const m=N,I=k(!1),j=k(!1),a=k(m.inspection),O=k(m.menu_points),F=k(m.coverImage),U=async()=>{if(a.value.status==="in_progress")try{const s=await et.get(route("inspections.detail",m.encryptedIds));a.value=s.data.inspection,O.value=s.data.menu_points,F.value=s.data.coverImage}catch(s){console.error("Polling gagal:",s)}};tt(()=>{setInterval(U,5e3)});const $=E(()=>{const s={};return O.value.forEach(t=>{var u,l;const n=((l=(u=t.inspection_point)==null?void 0:u.component)==null?void 0:l.name)||"Tanpa Komponen";s[n]||(s[n]=[]),s[n].push(t)}),s}),q=()=>{j.value=!0,setTimeout(()=>{window.location.href=route("inspections.download.pdf",m.encryptedIds),j.value=!1,I.value=!1},2e3)},z=E(()=>{const s=m.menu_points.some(n=>D(n)||L(n)),t=m.coverImage&&m.coverImage.image_path;return s||t}),P=s=>s&&s.length>0,S=s=>`/${s}`,D=s=>{var t;return((t=s.inspection_point)==null?void 0:t.results)&&s.inspection_point.results.length>0},L=s=>{var t;return((t=s.inspection_point)==null?void 0:t.images)&&s.inspection_point.images.length>0},K=s=>D(s)&&s.inspection_point.results[0].note,J=s=>{var u,l,c;const t=s.input_type||"",n=(c=(l=(u=s.inspection_point)==null?void 0:u.results)==null?void 0:l[0])==null?void 0:c.status;return["radio","imageTOradio"].includes(t)&&n},W=s=>{const t=s.input_type||"";return["text","number","date","textarea"].includes(t)&&K(s)},Q=s=>{var p,g,y,f;const t=s.input_type||"",n=s.settings||{},u=((g=(p=s.inspection_point)==null?void 0:p.results)==null?void 0:g[0])||{},c=((f=(((y=n.radios)==null?void 0:y.find(x=>x.value===u.status))||{}).settings)==null?void 0:f.show_image_upload)||!1;return(t==="image"||t==="imageTOradio"||t==="radio"&&c)&&L(s)},X=s=>{var l,c,p,g;const t=s.settings||{},n=((c=(l=s.inspection_point)==null?void 0:l.results)==null?void 0:c[0])||{};return((g=(((p=t.radios)==null?void 0:p.find(y=>y.value===n.status))||{}).settings)==null?void 0:g.show_textarea)||!1},Y=s=>{if(!s)return"status-warning";const t=s.toLowerCase();return["normal","ada","baik","good","ok"].includes(t)?"status-good":["tidak normal","tidak ada","rusak","bad","not ok"].includes(t)?"status-bad":"status-warning"},Z=s=>{var l,c;const t=s.input_type||"",n=((c=(l=s.inspection_point)==null?void 0:l.results)==null?void 0:c[0])||{},u=s.settings||{};if(t==="account"&&n.note){const p=n.note.replace(/[^\d.-]/g,""),g=parseFloat(p);if(isNaN(g))return n.note;const y=u.currency_symbol||"Rp";return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:2}).format(g).replace("Rp",y)}return n.note};return(s,t)=>{var n,u,l,c,p,g,y,f,x,R,B;return r(),o("div",ot,[a.value.status==="pending_review"?(r(),o("div",rt,[e("button",{onClick:t[0]||(t[0]=T=>I.value=!0),class:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"}," Setujui Laporan "),t[2]||(t[2]=e("p",{class:"text-sm text-gray-500 mt-2 italic"}," Catatan: Halaman ini hanya simulasi dan mungkin berbeda dengan tampilan file PDF. Silakan periksa lebih detail untuk memastikan tidak ada kesalahan. Jika sudah yakin, silakan setujui untuk proses selanjutnya. ",-1))])):b("",!0),z.value?(r(),o("div",at,[e("div",nt,[e("div",dt,[F.value&&P(F.value.image_path)?(r(),o("img",{key:0,src:S(F.value.image_path),alt:"Foto Utama",class:"w-40 h-40 object-cover rounded-lg border border-gray-300"},null,8,it)):(r(),o("div",lt,t[3]||(t[3]=[e("span",null,"Gambar tidak tersedia",-1)]))),e("div",ut,[e("h2",ct,d(a.value.car_name),1)])]),a.value.car_id?(r(),o("div",gt,[e("table",pt,[e("tr",bt,[t[4]||(t[4]=e("td",{class:"p-2 border border-gray-300 font-bold w-1/3 text-gray-700"},"Nomor Polisi",-1)),e("td",yt,d(a.value.plate_number),1)]),e("tr",null,[t[5]||(t[5]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Merek",-1)),e("td",mt,d((u=(n=a.value.car)==null?void 0:n.brand)==null?void 0:u.name),1)]),e("tr",_t,[t[6]||(t[6]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Model",-1)),e("td",ft,d((c=(l=a.value.car)==null?void 0:l.model)==null?void 0:c.name),1)]),e("tr",null,[t[7]||(t[7]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Tipe",-1)),e("td",vt,d((g=(p=a.value.car)==null?void 0:p.type)==null?void 0:g.name),1)]),e("tr",xt,[t[8]||(t[8]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"CC",-1)),e("td",ht,d((y=a.value.car)==null?void 0:y.cc),1)]),e("tr",null,[t[9]||(t[9]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Bahan Bakar",-1)),e("td",kt,d((f=a.value.car)==null?void 0:f.fuel_type),1)]),e("tr",wt,[t[10]||(t[10]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Transmisi",-1)),e("td",It,d((x=a.value.car)==null?void 0:x.transmission),1)]),e("tr",null,[t[11]||(t[11]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Periode Model",-1)),e("td",jt,d(((R=a.value.car)==null?void 0:R.production_period)||"-"),1)]),e("tr",Ft,[t[12]||(t[12]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Tahun Pembuatan",-1)),e("td",Dt,d((B=a.value.car)==null?void 0:B.year),1)]),e("tr",Tt,[t[13]||(t[13]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Warna",-1)),e("td",Ct,d(a.value.color),1)]),e("tr",Pt,[t[14]||(t[14]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"No Rangka",-1)),e("td",St,d(a.value.noka),1)]),e("tr",Lt,[t[15]||(t[15]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"No Mesin",-1)),e("td",Mt,d(a.value.nosin),1)]),e("tr",Nt,[t[16]||(t[16]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"KM",-1)),e("td",Ot,d(a.value.km),1)])])])):b("",!0),a.value.notes?(r(),o("div",Kt,[t[17]||(t[17]=e("h3",{class:"text-lg font-bold mb-2 text-gray-800"},"Kesimpulan Inspeksi:",-1)),e("p",Rt,[e("div",{innerHTML:a.value.notes||"-"},null,8,Bt)])])):b("",!0)]),t[20]||(t[20]=e("h2",{class:"text-2xl font-bold border-b-2 border-gray-800 pb-2 mb-6"},"Hasil Inspeksi",-1)),(r(!0),o(_,null,w($.value,(T,C)=>(r(),o("div",{key:C,class:G(["section mb-6",C==="Foto Kendaraan"?"photo-component":""])},[e("div",Ht,d(C||"Tanpa Komponen"),1),C==="Foto Kendaraan"?(r(),o("div",Vt,[(r(!0),o(_,null,w(T,i=>{var h;return r(),o("div",{key:i.id},[(r(!0),o(_,null,w((h=i.inspection_point)==null?void 0:h.images,v=>(r(),o("div",{key:v.id,class:"image-container"},[P(v.image_path)?(r(),o("img",{key:0,src:S(v.image_path),alt:"Foto Kendaraan",class:"w-28 h-28 object-cover border border-gray-300 rounded-lg"},null,8,At)):(r(),o("div",Et,t[18]||(t[18]=[e("span",null,"Gambar tidak ditemukan",-1)])))]))),128))])}),128))])):(r(!0),o(_,{key:1},w(T,i=>{var h,v,H,V,A;return r(),o("div",{key:i.id,class:"point ml-4 py-3 border-b border-gray-100"},[D(i)||L(i)?(r(),o(_,{key:0},[e("span",Gt,d(((h=i.inspection_point)==null?void 0:h.name)||"-"),1),e("div",Ut,[D(i)?(r(),o(_,{key:0},[J(i)?(r(),o("span",{key:0,class:G(["status-badge",Y((v=i.inspection_point)==null?void 0:v.results[0].status)])},d((H=i.inspection_point)==null?void 0:H.results[0].status),3)):b("",!0),W(i)?(r(),o("div",$t,d(Z(i)),1)):b("",!0)],64)):b("",!0)]),Q(i)?(r(),o("div",qt,[(r(!0),o(_,null,w((V=i.inspection_point)==null?void 0:V.images,M=>(r(),o("div",{key:M.id,class:"image-container"},[P(M.image_path)?(r(),o("img",{key:0,src:S(M.image_path),alt:"image",class:"w-20 h-20 object-cover border border-gray-300 rounded-lg"},null,8,zt)):(r(),o("div",Jt,t[19]||(t[19]=[e("span",null,"Gambar tidak ditemukan",-1)])))]))),128))])):b("",!0),X(i)&&K(i)?(r(),o("div",Wt,d((A=i.inspection_point)==null?void 0:A.results[0].note),1)):b("",!0)],64)):b("",!0)])}),128))],2))),128))])):(r(),o("div",Qt,[t[21]||(t[21]=e("p",{class:"text-lg font-semibold text-gray-700"}," Data sudah tidak ada, karena sudah dijadikan PDF. ",-1)),e("a",{href:s.route("inspections.download.approved.pdf",N.encryptedIds),class:"mt-4 inline-block bg-blue-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Download PDF ",8,Xt)])),I.value?(r(),o("div",Yt,[e("div",Zt,[t[23]||(t[23]=e("h3",{class:"text-lg font-bold mb-4"},"Konfirmasi Laporan",-1)),t[24]||(t[24]=e("p",{class:"text-gray-700 mb-6"}," Apakah Anda yakin semua data sudah sesuai? Setelah disetujui, laporan akan diproses menjadi file PDF. ",-1)),e("div",te,[e("button",{onClick:t[1]||(t[1]=T=>I.value=!1),class:"bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400"}," Batal "),a.value.file?(r(),o("button",re,t[22]||(t[22]=[e("span",null,"Laporan sudah di buat",-1)]))):(r(),o("button",{key:0,onClick:q,class:"bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 transition-colors duration-200",disabled:j.value},[j.value?(r(),o("span",se,"Membuat file PDF...")):(r(),o("span",oe,"Setujui Laporan"))],8,ee))])])])):b("",!0)])}}},ie=st(ae,[["__scopeId","data-v-a03e3df6"]]);export{ie as default};
