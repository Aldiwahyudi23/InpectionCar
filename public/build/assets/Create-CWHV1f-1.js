import{x as te,C as oe,g as c,q as U,s as se,D as re,E as le,G as ne,b as ae,o as l,w as ie,e as de,d as t,u as a,l as ue,f as n,i as u,t as m,v as g,y as k,F as j,k as $,j as K,H as G,A as ce,n as pe,p as S}from"./vendor-BTHpbkmK.js";import{l as me}from"./lodash-DIQq7uM1.js";import{A as ge}from"./AppLayout-DN0OSRb8.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},ve={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},ye={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},xe={class:"mb-6"},he={class:"flex items-center space-x-2"},ke={class:"mb-6"},_e={class:"relative"},we={key:0,class:"absolute right-3 top-3"},Ce={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ie={key:0},Ae=["onMousedown"],Be={class:"font-medium text-gray-900"},Me={key:1,class:"p-4 text-sm text-gray-500 text-center"},je={class:"mb-6"},$e={class:"block text-sm font-medium text-gray-700 mb-2",for:"category"},Te=["value"],Ve={class:"mb-6 flex items-center justify-between"},Le={class:"relative inline-flex items-center cursor-pointer"},Ue={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={key:0,class:"mb-6"},Ne=["value"],ze={class:"mt-6 flex justify-end"},Ee=["disabled"],De={key:2,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Pe={key:0,class:"mb-4"},qe=["innerHTML"],Fe={key:1},He={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Ke=["onClick"],Ge=["src","alt"],Je={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Re={class:"text-white text-xs text-center"},Ze={key:2,class:"text-center py-4 text-gray-500 text-sm"},Oe={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Qe=["src","alt"],We={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Xe={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Ye={__name:"Create",props:{CarDetail:Array,Category:Array,team:Array},setup(N){const z=N,r=te({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null,inspector_id:null}),A=oe(),x=A.props.global.user,E=A.props.global.region,f=A.props.global.has_roles;A.props.global.permissions;const _=c(""),w=c(""),C=c(""),v=c(""),h=c(!1),T=c(!1),B=c([]),y=c(null),i=c([]),M=c(!1),p=c(0),J=()=>{const o=`${_.value}${w.value}${C.value}`;r.plate_number=o},V=o=>{o==="area"?_.value=_.value.toUpperCase().replace(/[^A-Z]/g,""):o==="number"?w.value=w.value.replace(/[^0-9]/g,""):o==="suffix"&&(C.value=C.value.toUpperCase().replace(/[^A-Z]/g,"")),J()},R=U(()=>!r.plate_number.trim()||!r.category_id||!r.car_id&&!v.value.trim()?!1:r.is_scheduled?r.scheduled_at_date&&r.scheduled_at_time:!((f.includes("Admin")||f.includes("coordinator"))&&!r.inspector_id)),Z=U(()=>r.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),O=U(()=>{const o=z.team.filter(s=>s.status==="active"),e=f.includes("Admin"),d=f.includes("coordinator");if(e)return o;if(d){const s=E.id;return o.filter(b=>b.region_id===s)}return[]}),I=o=>{var d,s,b;if(!o)return"";const e=[];return(d=o.brand)!=null&&d.name&&e.push(o.brand.name),(s=o.model)!=null&&s.name&&e.push(o.model.name),(b=o.type)!=null&&b.name&&e.push(o.type.name),o.cc&&e.push(`${o.cc}cc`),o.transmission&&e.push(o.transmission),o.fuel_type&&e.push(o.fuel_type),o.year&&e.push(o.year.toString()),o.production_period&&e.push(`(${o.production_period})`),e.join(" ")},D=me.debounce(()=>{if(!v.value.trim()){B.value=[],h.value=!1;return}T.value=!0;const o=v.value.toLowerCase().trim();B.value=z.CarDetail.filter(e=>I(e).toLowerCase().includes(o)),h.value=!0,T.value=!1},300),Q=()=>{setTimeout(()=>{h.value=!1},200)},W=async o=>{y.value=o,v.value=I(o),r.car_id=o.id,r.car_name=I(o),h.value=!1,await X(o.id)},X=async o=>{try{const e=await fetch(`/api/cars/${o}/images`);if(e.ok){const d=await e.json();i.value=Array.isArray(d)?d:[]}else i.value=[]}catch(e){console.error("Error loading car images:",e),i.value=[]}},P=o=>!o||!o.file_path?"":`/storage/${o.file_path}`,Y=o=>{p.value=o,M.value=!0,document.body.style.overflow="hidden"},L=()=>{M.value=!1,document.body.style.overflow=""},q=()=>{p.value=(p.value+1)%i.value.length},F=()=>{p.value=(p.value-1+i.value.length)%i.value.length},H=o=>{if(M.value)switch(o.key){case"Escape":L();break;case"ArrowRight":q();break;case"ArrowLeft":F();break}};se(()=>{window.addEventListener("keydown",H)}),re(()=>{window.removeEventListener("keydown",H)}),le(v,o=>{(!y.value||I(y.value)!==o)&&(r.car_id=null,r.car_name=o,y.value=null,i.value=[])}),ne(()=>{const o=f.includes("Admin")||f.includes("coordinator");r.inspector_id=(x==null?void 0:x.id)||null});const ee=()=>{const o={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name,category_id:r.category_id,is_scheduled:r.is_scheduled,inspector_id:r.inspector_id};r.is_scheduled&&(o.scheduled_at=`${r.scheduled_at_date} ${r.scheduled_at_time}`),r.post(route("inspections.store"),{preserveScroll:!0,onSuccess:e=>{if(o.is_scheduled)console.log("Inspeksi berhasil dijadwalkan.");else{const d=e.props.flash.newInspectionId;d?window.location.href=route("inspections.start",d):console.error("Tidak ada ID inspeksi baru yang dikembalikan.")}},onError:()=>{}})};return(o,e)=>(l(),ae(ge,{title:"Buat Inspeksi Baru"},{default:ie(()=>{var d;return[de(a(ue),{title:"Inspek Baru"}),t("div",be,[t("div",ve,[e[31]||(e[31]=t("div",{class:"mb-4"},[t("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),t("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),a(r).errors.form_error?(l(),n("div",ye,m(a(r).errors.form_error),1)):u("",!0),t("div",xe,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),t("div",he,[g(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),type:"text",placeholder:"D",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[1]||(e[1]=s=>V("area")),maxlength:"2"},null,544),[[k,_.value]]),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>w.value=s),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[3]||(e[3]=s=>V("number")),maxlength:"4"},null,544),[[k,w.value]]),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>C.value=s),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[5]||(e[5]=s=>V("suffix")),maxlength:"3"},null,544),[[k,C.value]])])]),t("div",ke,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),t("div",_e,[g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>v.value=s),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:e[7]||(e[7]=(...s)=>a(D)&&a(D)(...s)),onFocus:e[8]||(e[8]=s=>h.value=!0),onBlur:Q},null,544),[[k,v.value]]),T.value?(l(),n("div",we,e[16]||(e[16]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):u("",!0),h.value?(l(),n("div",Ce,[B.value.length>0?(l(),n("div",Ie,[(l(!0),n(j,null,$(B.value,s=>(l(),n("div",{key:s.id,class:"px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:b=>W(s)},[t("div",Be,m(I(s)),1)],40,Ae))),128))])):(l(),n("div",Me,e[17]||(e[17]=[K(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),K(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):u("",!0)])]),t("div",je,[t("label",$e," Kategori Inspeksi "+m(a(E).id),1),g(t("select",{id:"category","onUpdate:modelValue":e[9]||(e[9]=s=>a(r).category_id=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[19]||(e[19]=t("option",{value:"",disabled:""},"Pilih Kategori",-1)),(l(!0),n(j,null,$(N.Category,s=>(l(),n("option",{key:s.id,value:s.id},m(s.name),9,Te))),128))],512),[[G,a(r).category_id]])]),t("div",Ve,[e[21]||(e[21]=t("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),t("label",Le,[g(t("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=s=>a(r).is_scheduled=s),id:"schedule-toggle",class:"sr-only peer"},null,512),[[ce,a(r).is_scheduled]]),e[20]||(e[20]=t("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),a(r).is_scheduled?(l(),n("div",Ue,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),g(t("input",{type:"date",id:"schedule-date","onUpdate:modelValue":e[11]||(e[11]=s=>a(r).scheduled_at_date=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[k,a(r).scheduled_at_date]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),g(t("input",{type:"time",id:"schedule-time","onUpdate:modelValue":e[12]||(e[12]=s=>a(r).scheduled_at_time=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[k,a(r).scheduled_at_time]])]),a(f).includes("Admin")||a(f).includes("coordinator")?(l(),n("div",Se,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"inspector"}," Pilih Inspektor ",-1)),g(t("select",{id:"inspector","onUpdate:modelValue":e[13]||(e[13]=s=>a(r).inspector_id=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[24]||(e[24]=t("option",{value:"",disabled:""},"Pilih Inspektor",-1)),(l(!0),n(j,null,$(O.value,s=>(l(),n("option",{key:s.id,value:s.id},m(s.user.name),9,Ne))),128))],512),[[G,a(r).inspector_id]])])):u("",!0)])):u("",!0),t("div",ze,[t("button",{onClick:ee,disabled:!R.value||a(r).processing,class:pe({"px-6 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600  border border-transparent text-white hover:bg-blue-700":!a(r).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600  border-transparent text-white hover:bg-green-700":a(r).is_scheduled})},m(Z.value),11,Ee)]),a(r).car_id&&y.value?(l(),n("div",De,[y.value.description?(l(),n("div",Pe,[e[26]||(e[26]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:y.value.description},null,8,qe)])):u("",!0),i.value.length>0?(l(),n("div",Fe,[e[27]||(e[27]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",He,[(l(!0),n(j,null,$(i.value,(s,b)=>(l(),n("div",{key:s.id||b,class:"relative group cursor-pointer",onClick:et=>Y(b)},[t("img",{src:P(s),alt:s.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ge),s.note?(l(),n("div",Je,[t("p",Re,m(s.note),1)])):u("",!0)],8,Ke))),128))])])):(l(),n("div",Ze," Tidak ada gambar tersedia untuk mobil ini "))])):u("",!0),M.value?(l(),n("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:L},[t("div",Oe,[t("button",{onClick:L,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},e[28]||(e[28]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),i.value.length>1?(l(),n("button",{key:0,onClick:S(F,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[29]||(e[29]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):u("",!0),i.value.length>1?(l(),n("button",{key:1,onClick:S(q,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[30]||(e[30]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):u("",!0),t("img",{src:P(i.value[p.value]),alt:"Car Image "+(p.value+1),class:"max-w-full max-h-full object-contain",onClick:e[14]||(e[14]=S(()=>{},["stop"]))},null,8,Qe),i.value.length>1?(l(),n("div",We,m(p.value+1)+" / "+m(i.value.length),1)):u("",!0),(d=i.value[p.value])!=null&&d.note?(l(),n("div",Xe,m(i.value[p.value].note),1)):u("",!0)])])):u("",!0)])])]}),_:1}))}},lt=fe(Ye,[["__scopeId","data-v-0f9a7818"]]);export{lt as default};
