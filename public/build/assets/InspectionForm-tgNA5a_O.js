import{e as u,o as l,a as e,f as x,t as R,F as O,h as H,d as C,k as Q,q as ie,C as ue,j as Se,n as z,p as Ce,D as Ve,c as P,g as ee,x as Ie,W as J,b as $e,w as Me,u as F,l as Le,s as Re,T as je,B as ne}from"./app-C9WRuIBM.js";import{l as le}from"./lodash-CMVLfwBI.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ue={class:"mt-1"},qe=["value","required","minlength","maxlength","pattern","placeholder"],Ee={key:0,class:"mt-2 text-sm text-red-600"},Be={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,p=v,V=b=>{p("update:modelValue",b.target.value),p("save",d.pointId)};return(b,c)=>(l(),u("div",Ue,[e("input",{value:t.modelValue,onInput:V,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,pattern:t.pattern,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,qe),t.error?(l(),u("p",Ee,R(t.error),1)):x("",!0)]))}},Fe={class:"mt-1"},Te=["value","required","min","max","step","placeholder"],Ne={key:0,class:"mt-2 text-sm text-red-600"},Ae={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,p=v,V=b=>{const c=b.target.value;p("update:modelValue",c),p("save",d.pointId)};return(b,c)=>(l(),u("div",Fe,[e("input",{value:t.modelValue,onInput:V,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Te),t.error?(l(),u("p",Ne,R(t.error),1)):x("",!0)]))}},Pe={class:"mt-1"},ze=["value","required","min","max"],De={key:0,class:"mt-2 text-sm text-red-600"},Oe={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,p=v,V=b=>{p("update:modelValue",b.target.value),p("save",d.pointId)};return(b,c)=>(l(),u("div",Pe,[e("input",{value:t.modelValue,onChange:V,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ze),t.error?(l(),u("p",De,R(t.error),1)):x("",!0)]))}},He={class:"mt-1"},We=["value","required"],Xe={key:0,class:"mt-2 text-sm text-red-600"},Ge={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,p=v,V=b=>{p("update:modelValue",b.target.value),p("save",d.pointId)};return(b,c)=>(l(),u("div",He,[e("select",{value:t.modelValue,onChange:V,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},c[0]||(c[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,We),t.error?(l(),u("p",Xe,R(t.error),1)):x("",!0)]))}},Ke=Z(Ge,[["__scopeId","data-v-c34a74db"]]),Ye={class:"mt-2"},Je={class:"flex flex-col gap-2 sm:flex-row sm:items-center"},Qe=["name","value","checked","onChange","required"],Ze={class:"text-sm text-gray-700"},et={key:0,class:"mt-2 text-sm text-red-600"},tt={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number],options:{type:Array,default:()=>[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}]}},emits:["update:modelValue","save"],setup(t,{emit:v}){const d=t,p=v,V=b=>{p("update:modelValue",b),p("save",d.pointId)};return(b,c)=>(l(),u("div",Ye,[e("div",Je,[(l(!0),u(O,null,H(t.options,k=>(l(),u("label",{key:k.value,class:"inline-flex items-center space-x-2"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:k.value,checked:t.modelValue===k.value,onChange:m=>V(k.value),required:t.required,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,Qe),e("span",Ze,R(k.label),1)]))),128))]),t.error?(l(),u("p",et,R(t.error),1)):x("",!0)]))}},st=["multiple"],at={key:0,class:"h-full flex flex-col items-center justify-center p-4 text-center"},ot={key:1,class:"p-2"},rt={class:"grid grid-cols-3 gap-2"},nt=["src"],lt=["onClick"],it={key:0,class:"mt-2 text-center"},ut={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 p-4"},dt={class:"bg-white w-full max-w-sm rounded-xl shadow-xl overflow-hidden"},ct={key:1,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},mt={class:"webcam-content-box"},gt={class:"webcam-header"},vt={class:"flex gap-4"},ht=["disabled"],pt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ft={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},bt={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},wt=["disabled"],xt={key:0,class:"screen-flash-overlay"},yt={key:2,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center"},kt={class:"w-full h-full flex flex-col"},_t={class:"flex justify-between items-center p-4 bg-black bg-opacity-50 text-white"},St={class:"text-lg font-medium"},Ct={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Vt=["src"],It={class:"flex justify-between p-4 bg-black bg-opacity-50"},$t={key:3,class:"mt-1 text-xs text-red-600"},Mt={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,pointId:[String,Number],settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png"],camera_aspect_ratio:"4:3",enable_flash:!0,enable_camera_switch:!0})}},emits:["update:modelValue","save","removeImage"],setup(t,{emit:v}){const d=t,p=v,V=C(null),b=C(null),c=C(null),k=C(null),m=C([]),I=C(!1),$=C(!1),s=C(0),q=C(0),T=C(0),N=C(0);let j=null,M=null;const E=C("environment"),i=C(!1),n=C(!1),o=C(!1),w=C(!1),y=Q(()=>Number(d.settings.max_files)>1),_=Q(()=>{const a=m.value[s.value];return a?{...a,rotation:q.value}:null}),S=Q(()=>{const a=d.settings.camera_aspect_ratio.split(":");if(a.length===2){const r=parseFloat(a[0]),h=parseFloat(a[1]);if(!isNaN(r)&&!isNaN(h)&&h!==0)return r/h}return 4/3}),A=()=>{I.value=!0},W=()=>{I.value=!1,V.value.click()},D=async()=>{j&&j.getTracks().forEach(a=>a.stop());try{const a={facingMode:E.value,width:{ideal:1280},height:{ideal:960},aspectRatio:{exact:S.value}};E.value==="environment"&&(a.advanced=[{focusMode:"continuous"}]),j=await navigator.mediaDevices.getUserMedia({video:a}),M=j.getVideoTracks()[0],b.value.srcObject=j,b.value.onloadedmetadata=async()=>{b.value.style.width="100%",b.value.style.height="auto",b.value.style.objectFit="cover",await de()}}catch(a){console.error("Error accessing camera: ",a),alert("Failed to access camera. Please ensure camera permissions are granted and try again."),$.value=!1}},X=async()=>{I.value=!1,$.value=!0,await D()},g=()=>{j&&j.getTracks().forEach(a=>a.stop()),$.value=!1,o.value=!1},de=async()=>{if(!M)return;const r=(await navigator.mediaDevices.enumerateDevices()).filter(f=>f.kind==="videoinput");i.value=r.length>1;const h=M.getCapabilities();n.value=h.torch||h.fillLightMode&&h.fillLightMode.includes("torch")},ce=async()=>{if(!(!M||!d.settings.enable_flash)){if(E.value==="user"){o.value=!o.value;return}try{if(M.getCapabilities().torch)await M.applyConstraints({advanced:[{torch:!o.value}]}),o.value=!o.value;else{console.warn("Torch API not directly supported, checking fillLightMode.");const a=M.getCapabilities();a.fillLightMode&&a.fillLightMode.includes("torch")?(await M.applyConstraints({fillLightMode:o.value?"none":"torch"}),o.value=!o.value):(alert("Flash/Torch is not supported on this camera."),n.value=!1)}}catch(a){console.error("Error toggling flash: ",a),alert("Could not toggle flash. Feature might not be supported."),n.value=!1}}},me=async()=>{!i.value||!d.settings.enable_camera_switch||(E.value=E.value==="environment"?"user":"environment",await D(),o.value=!1)},ge=async()=>{if(!M)return;const a=M.getCapabilities();if(a.focusMode&&a.focusMode.includes("continuous")){console.log("Triggering continuous autofocus (if supported).");try{await M.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(r){console.warn("Failed to apply continuous focus constraint:",r)}}else console.log("Autofocus not explicitly controllable or not supported.")},ve=async()=>{if(!b.value||!c.value)return;E.value==="user"&&o.value&&(w.value=!0,await new Promise(Y=>setTimeout(Y,100)),w.value=!1);const a=b.value,r=c.value,h=r.getContext("2d"),f=a.videoWidth,L=a.videoHeight;let B=f,U=L,G=0,K=0;f/L>S.value?(B=L*S.value,G=(f-B)/2):f/L<S.value&&(U=f/S.value,K=(L-U)/2),r.width=B,r.height=U,h.drawImage(a,G,K,B,U,0,0,r.width,r.height),r.toBlob(Y=>{if(Y){const oe=new File([Y],`captured_image_${Date.now()}.png`,{type:"image/png"}),re={file:oe,preview:URL.createObjectURL(oe),rotation:0};y.value&&d.modelValue.length<d.settings.max_files?m.value.push(re):(m.value.length>0&&URL.revokeObjectURL(m.value[0].preview),m.value=[re]),s.value=m.value.length-1,q.value=0,(!y.value||m.value.length>=d.settings.max_files)&&g()}else console.error("Failed to convert canvas to blob.")},"image/png")},he=a=>{const r=Array.from(a.target.files);if(!r.length)return;const h=d.modelValue.length,f=d.settings.max_files-h,L=r.slice(0,f);(!y.value||f===0&&L.length>0)&&(m.value.forEach(U=>URL.revokeObjectURL(U.preview)),m.value=[]);const B=L.map(U=>({file:U,preview:URL.createObjectURL(U),rotation:0}));m.value.push(...B),s.value=0,q.value=0,a.target.value=""},pe=a=>new Promise(r=>{if(a.rotation===0||!k.value){r(a.file);return}const h=new Image;h.onload=()=>{const f=k.value,L=f.getContext("2d"),B=h.width,U=h.height;a.rotation===90||a.rotation===270?(f.width=U,f.height=B):(f.width=B,f.height=U),L.clearRect(0,0,f.width,f.height),L.translate(f.width/2,f.height/2),L.rotate(a.rotation*Math.PI/180),L.drawImage(h,-B/2,-U/2,B,U),L.setTransform(1,0,0,1,0,0),f.toBlob(G=>{const K=new File([G],a.file.name,{type:a.file.type});r(K)},a.file.type)},h.src=a.preview}),fe=async()=>{const a=[];for(const h of m.value){const f=await pe(h);a.push({file:f,preview:URL.createObjectURL(f)}),h.preview&&URL.revokeObjectURL(h.preview)}const r=[...d.modelValue,...a];p("update:modelValue",r.slice(0,d.settings.max_files)),p("save",d.pointId),m.value=[]},te=()=>{m.value.forEach(a=>URL.revokeObjectURL(a.preview)),m.value=[]},be=a=>{const r=[...d.modelValue],h=r.splice(a,1)[0];h.preview&&URL.revokeObjectURL(h.preview),p("update:modelValue",r),p("removeImage",{index:a,pointId:d.pointId})},we=a=>{const r=m.value.splice(a,1)[0];r.preview&&URL.revokeObjectURL(r.preview),m.value.length===0?te():s.value>=m.value.length&&(s.value=m.value.length-1)},xe=()=>{const a=m.value[s.value];a&&(a.rotation=(a.rotation+90)%360,q.value=a.rotation)},se=()=>{s.value<m.value.length-1&&s.value++},ae=()=>{s.value>0&&s.value--},ye=a=>{T.value=a.touches[0].clientX},ke=a=>{N.value=a.touches[0].clientX},_e=()=>{T.value-N.value>50?se():N.value-T.value>50&&ae()};return ie(()=>{j&&j.getTracks().forEach(a=>a.stop())}),ue(s,a=>{m.value[a]&&(q.value=m.value[a].rotation)}),(a,r)=>(l(),u("div",null,[e("input",{ref_key:"galleryInput",ref:V,type:"file",accept:"image/*",class:"hidden",onChange:he,multiple:y.value},null,40,st),e("canvas",{ref_key:"processingCanvas",ref:k,class:"hidden"},null,512),e("label",{onClick:A,class:z(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200",{"border-gray-300 hover:border-indigo-400 bg-gray-50":t.modelValue.length===0,"border-indigo-300 bg-indigo-50":t.modelValue.length>0,"h-28":t.modelValue.length===0,"h-auto":t.modelValue.length>0}])},[t.modelValue.length===0?(l(),u("div",at,r[2]||(r[2]=[e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1),e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)]))):(l(),u("div",ot,[e("div",rt,[(l(!0),u(O,null,H(t.modelValue,(h,f)=>(l(),u("div",{key:f,class:"relative aspect-square"},[e("img",{src:h.preview||"/storage/"+h.image_path,class:"w-full h-full object-cover rounded-md border border-gray-200"},null,8,nt),e("button",{onClick:Se(L=>be(f),["stop"]),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm hover:bg-red-600 transition-colors"}," × ",8,lt)]))),128))]),y.value?(l(),u("div",it,r[3]||(r[3]=[e("span",{class:"inline-block px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 hover:bg-indigo-200 transition-colors"}," + Add More Images ",-1)]))):x("",!0)]))],2),I.value?(l(),u("div",ut,[e("div",dt,[e("div",{class:"p-4"},[r[6]||(r[6]=e("h3",{class:"text-lg font-medium text-center text-gray-800 mb-4"},"Select Image Source",-1)),e("div",{class:"flex justify-center gap-6"},[e("button",{onClick:X,class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-blue-50 hover:bg-blue-100 transition-colors"},r[4]||(r[4]=[Ce('<div class="bg-blue-100 p-3 rounded-full mb-2" data-v-ed2ca820><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-ed2ca820><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" data-v-ed2ca820></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" data-v-ed2ca820></path></svg></div><span class="text-sm font-medium text-gray-700" data-v-ed2ca820>Camera</span>',2)])),e("button",{onClick:W,class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-purple-50 hover:bg-purple-100 transition-colors"},r[5]||(r[5]=[e("div",{class:"bg-purple-100 p-3 rounded-full mb-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1),e("span",{class:"text-sm font-medium text-gray-700"},"Gallery",-1)]))])]),e("button",{onClick:r[0]||(r[0]=h=>I.value=!1),class:"w-full py-3 text-center text-gray-500 font-medium border-t border-gray-100 hover:bg-gray-50 transition-colors"},"Cancel")])])):x("",!0),$.value?(l(),u("div",ct,[e("div",mt,[e("div",gt,[e("button",{onClick:g,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},r[7]||(r[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",vt,[e("button",{onClick:ce,disabled:!n.value,class:z(["p-2 rounded-full text-white",{"bg-gray-700":o.value,"hover:bg-gray-700":n.value,"opacity-50 cursor-not-allowed":!n.value}])},[n.value?o.value?(l(),u("svg",ft,r[9]||(r[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):(l(),u("svg",bt,r[10]||(r[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6"},null,-1)]))):(l(),u("svg",pt,r[8]||(r[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.102 1.101m-.757 4.898l-4 4L9.828 9.828m4.899-.757l4-4L14.172 14.172"},null,-1)])))],10,ht),e("button",{onClick:me,disabled:!i.value,class:z(["p-2 rounded-full text-white hover:bg-gray-700",{"opacity-50 cursor-not-allowed":!i.value}])},r[11]||(r[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8h16M4 16h16M6 4h.01M6 20h.01M10 4h.01M10 20h.01M14 4h.01M14 20h.01M18 4h.01M18 20h.01"})],-1)]),10,wt)])]),e("div",{class:"webcam-video-container",onClick:ge},[e("video",{ref_key:"webcamVideo",ref:b,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:c,class:"hidden"},null,512),w.value?(l(),u("div",xt)):x("",!0)]),e("div",{class:"webcam-footer"},[e("button",{onClick:ve,class:"capture-button"})])])])):x("",!0),m.value.length?(l(),u("div",yt,[e("div",kt,[e("div",_t,[e("button",{onClick:te,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},r[12]||(r[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",St,"Preview ("+R(s.value+1)+"/"+R(m.value.length)+")",1),e("button",{onClick:xe,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},r[13]||(r[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))]),e("div",Ct,[e("div",{class:"w-full h-full flex items-center justify-center",onTouchstart:ye,onTouchmove:ke,onTouchend:_e},[e("img",{src:_.value.preview,class:"max-w-full max-h-full object-contain",style:Ve({transform:`rotate(${q.value}deg)`})},null,12,Vt)],32),m.value.length>1?(l(),u("button",{key:0,onClick:ae,class:"absolute left-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},r[14]||(r[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):x("",!0),m.value.length>1?(l(),u("button",{key:1,onClick:se,class:"absolute right-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},r[15]||(r[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):x("",!0)]),e("div",It,[e("button",{onClick:r[1]||(r[1]=h=>we(s.value)),class:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"}," Delete "),e("button",{onClick:fe,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Save "+R(m.value.length)+" Image(s) ",1)])])])):x("",!0),t.error?(l(),u("p",$t,R(t.error),1)):x("",!0)]))}},Lt=Z(Mt,[["__scopeId","data-v-ed2ca820"]]),Rt={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},jt={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},Ut={class:"text-xl font-semibold text-indigo-700"},qt={class:"p-6 space-y-8"},Et={class:"flex items-start justify-between"},Bt={class:"block text-sm font-medium text-gray-700"},Ft={key:0,class:"text-red-500"},Tt={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Nt={__name:"CategorySection",props:{category:Object,form:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:v}){const d=t,p=v,V=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],b=I=>{var s;const $=d.form.results[I.id];if(!$)return!1;switch(I.input_type){case"text":case"number":case"date":return!!$.note;case"select":case"radio":return!!$.status;case"image":return((s=$.images)==null?void 0:s.length)>0;default:return!1}},c=(I,$)=>{p("updateResult",{pointId:I,value:$})},k=I=>{p("saveResult",I)},m=(I,$)=>{p("removeImage",{pointId:I,imageIndex:$})};return(I,$)=>(l(),u("div",Rt,[e("div",jt,[e("h2",Ut,R(t.category.name),1)]),e("div",qt,[(l(!0),u(O,null,H(t.category.points,s=>{var q,T,N,j,M,E,i,n,o,w,y,_,S,A,W,D,X;return l(),u("div",{key:s.id,class:"space-y-4 pb-6 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",Et,[e("label",Bt,[ee(R(s.name)+" ",1),(q=s.settings)!=null&&q.is_required?(l(),u("span",Ft,"*")):x("",!0)]),b(s)?(l(),u("span",Tt," ✓ ")):x("",!0)]),s.input_type==="text"?(l(),P(Be,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[g=>t.form.results[s.id].note=g,g=>c(s.id,g)],required:(T=s.settings)==null?void 0:T.is_required,"min-length":(N=s.settings)==null?void 0:N.min_length,"max-length":(j=s.settings)==null?void 0:j.max_length,pattern:(M=s.settings)==null?void 0:M.pattern,placeholder:((E=s.settings)==null?void 0:E.placeholder)||"Enter text",error:t.form.errors[`results.${s.id}.note`],onSave:g=>k(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):x("",!0),s.input_type==="number"?(l(),P(Ae,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[g=>t.form.results[s.id].note=g,g=>c(s.id,g)],required:(i=s.settings)==null?void 0:i.is_required,min:(n=s.settings)==null?void 0:n.min,max:(o=s.settings)==null?void 0:o.max,step:((w=s.settings)==null?void 0:w.step)||1,placeholder:((y=s.settings)==null?void 0:y.placeholder)||"Enter number",error:t.form.errors[`results.${s.id}.note`],onSave:g=>k(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):x("",!0),s.input_type==="date"?(l(),P(Oe,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[g=>t.form.results[s.id].note=g,g=>c(s.id,g)],required:(_=s.settings)==null?void 0:_.is_required,"min-date":(S=s.settings)==null?void 0:S.min_date,"max-date":(A=s.settings)==null?void 0:A.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:g=>k(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):x("",!0),s.input_type==="select"?(l(),P(Ke,{key:3,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[g=>t.form.results[s.id].status=g,g=>c(s.id,g)],required:(W=s.settings)==null?void 0:W.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:g=>k(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):x("",!0),s.input_type==="radio"?(l(),P(tt,{key:4,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[g=>t.form.results[s.id].status=g,g=>c(s.id,g)],required:(D=s.settings)==null?void 0:D.is_required,options:((X=s.settings)==null?void 0:X.radios)||V,error:t.form.errors[`results.${s.id}.status`],onSave:g=>k(s.id)},null,8,["modelValue","onUpdate:modelValue","required","options","error","onSave"])):x("",!0),s.input_type==="image"?(l(),P(Lt,{key:5,modelValue:t.form.results[s.id].images,"onUpdate:modelValue":[g=>t.form.results[s.id].images=g,g=>c(s.id,g)],error:t.form.errors[`results.${s.id}.images`],onSave:g=>k(s.id),onRemoveImage:g=>m(s.id,g)},null,8,["modelValue","onUpdate:modelValue","error","onSave","onRemoveImage"])):x("",!0)])}),128))])]))}},At=Z(Nt,[["__scopeId","data-v-0537cb06"]]),Pt={class:"container mx-auto px-4 py-2"},zt={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Dt={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Ot=["onClick","data-category-id"],Ht={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Wt={class:"relative overflow-hidden"},Xt={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},Gt={class:"mb-4"},Kt={class:"mt-6"},Yt={class:"list-disc pl-5"},Jt={key:0},Qt={key:1},Zt={class:"flex justify-end gap-4 mt-8"},es=["disabled"],ts={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ss={__name:"InspectionForm",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(t){var E;const v=t,d=C(((E=v.categories[0])==null?void 0:E.id)||"summary"),p=C(0);C(null);const V=Q(()=>d.value!=="summary"?v.categories.find(i=>i.id===d.value):null),c=Ie((()=>{const i={};return v.categories.forEach(n=>{(n.points||[]).forEach(o=>{var y,_;const w=Array.isArray(v.existingResults)?v.existingResults.find(S=>S.point_id===o.id):null;i[o.id]={status:(w==null?void 0:w.status)||"",note:(w==null?void 0:w.note)||"",images:((_=(y=v.existingImages)==null?void 0:y[o.id])==null?void 0:_.map(S=>({image_path:S.image_path,preview:null})))||[]}})}),{inspection_id:v.inspection.id,results:i,overall_note:v.inspection.overall_note||""}})()),k=le.debounce(()=>{J.post(route("inspections.save-overall-note"),{inspection_id:v.inspection.id,overall_note:c.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:i=>{console.error("Error menyimpan catatan keseluruhan:",i)}})},800),m=i=>i.points.every(n=>{var w;const o=c.results[n.id];if(!o)return!1;switch(n.input_type){case"text":case"number":case"date":return!!o.note;case"select":case"radio":return!!o.status;case"image":return((w=o.images)==null?void 0:w.length)>0;default:return!!o.status||!!o.note}}),I=i=>{if(i==="summary")p.value=v.categories.length;else{const n=v.categories.findIndex(o=>o.id===i);n>=0&&(p.value=n)}d.value=i},$=i=>{let n=p.value+i;const o=v.categories.length;n>=0&&n<=o&&(p.value=n,n===o?d.value="summary":d.value=v.categories[n].id)},s=()=>{let i=0,n=0;const o=S=>{i=S.changedTouches[0].screenX},w=S=>{n=S.changedTouches[0].screenX,y()},y=()=>{n<i-50?$(1):n>i+50&&$(-1)},_=document.querySelector(".relative.overflow-hidden");return _&&(_.addEventListener("touchstart",o,!1),_.addEventListener("touchend",w,!1)),()=>{_&&(_.removeEventListener("touchstart",o),_.removeEventListener("touchend",w))}},q=le.debounce(async i=>{try{await J.post(route("inspections.save-result"),{inspection_id:v.inspection.id,point_id:i,status:c.results[i].status,note:c.results[i].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(n){console.error("Error menyimpan hasil:",n)}},500),T=({pointId:i,type:n,value:o})=>{c.results[i].hasOwnProperty(n)&&(c.results[i][n]=o),q(i)},N=async(i,n)=>{const o=i.target.files[0];if(!o)return;const w=URL.createObjectURL(o);try{const y=new FormData;y.append("inspection_id",v.inspection.id),y.append("point_id",n),y.append("image",o),await J.post(route("inspections.upload-image"),y,{preserveScroll:!0,onSuccess:_=>{var A;const S=((A=_.props.flash)==null?void 0:A.imagePath)||_.props.imagePath;S?c.results[n].images.push({image_path:S,preview:w}):console.error("Path gambar tidak dikembalikan dari unggahan, tidak dapat memperbarui UI.")},onError:_=>{console.error("Error mengunggah gambar:",_),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(y){console.error("Error mengunggah gambar:",y),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{i.target.value=""}},j=async(i,n)=>{const o=c.results[i].images[n];if(o)try{await J.delete(route("inspections.delete-image"),{data:{image_path:o.image_path,point_id:i,inspection_id:v.inspection.id},preserveScroll:!0,onSuccess:()=>{c.results[i].images.splice(n,1),o.preview&&URL.revokeObjectURL(o.preview)},onError:w=>{console.error("Error menghapus gambar:",w),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(w){console.error("Error menghapus gambar:",w),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},M=()=>{c.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{ne().props.flash.success="Inspeksi berhasil dikirim!"},onError:i=>{console.error("Kesalahan pengiriman:",i),ne().props.flash.error="Ada kesalahan dalam pengiriman Anda. Harap periksa semua bidang."}})};return ie(()=>{s()}),ue(d,i=>{const n=document.querySelector(`.flex-shrink-0[data-category-id="${i}"]`);n&&n.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(i,n)=>(l(),u("div",Pt,[e("div",zt,[e("div",Dt,[(l(!0),u(O,null,H(t.categories,o=>(l(),u("button",{key:o.id,onClick:w=>I(o.id),class:z(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":d.value===o.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":d.value!==o.id}]),"data-category-id":o.id},[ee(R(o.name)+" ",1),m(o)?(l(),u("span",Ht," ✓ ")):x("",!0)],10,Ot))),128)),e("button",{onClick:n[0]||(n[0]=o=>I("summary")),class:z(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":d.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":d.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),e("div",Wt,[$e(je,{name:"category-slide",mode:"out-in"},{default:Me(()=>[V.value&&d.value!=="summary"?(l(),P(At,{key:V.value.id,category:V.value,form:F(c),onSaveResult:F(q),onUpdateResult:T,onRemoveImage:j,onHandleImageUpload:N},null,8,["category","form","onSaveResult"])):d.value==="summary"?(l(),u("div",Xt,[n[6]||(n[6]=e("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),e("div",Gt,[n[3]||(n[3]=e("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),Le(e("textarea",{id:"overall_note","onUpdate:modelValue":n[1]||(n[1]=o=>F(c).overall_note=o),onInput:n[2]||(n[2]=(...o)=>F(k)&&F(k)(...o)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[Re,F(c).overall_note]])]),e("div",Kt,[n[4]||(n[4]=e("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Kategori:",-1)),e("ul",Yt,[(l(!0),u(O,null,H(t.categories,o=>(l(),u("li",{key:o.id,class:z({"text-green-600":m(o),"text-red-600":!m(o)})},[ee(R(o.name)+" ",1),m(o)?(l(),u("span",Jt,"(Selesai ✓)")):(l(),u("span",Qt,"(Belum Selesai ✗)"))],2))),128))])]),e("div",Zt,[e("button",{type:"button",onClick:M,disabled:F(c).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[F(c).processing?(l(),u("svg",ts,n[5]||(n[5]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):x("",!0),e("span",null,R(F(c).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,es)])])):x("",!0)]),_:1})])]))}},ns=Z(ss,[["__scopeId","data-v-22fd310e"]]);export{ns as default};
