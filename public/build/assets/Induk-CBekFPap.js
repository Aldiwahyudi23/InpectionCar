import{r as _,p as nt,q as N,G as Qe,c as p,o as a,d as l,b as f,t as O,F as $e,m as We,j as S,f as Ge,x as it,W as oe,g as ot,u as r,L as Xe,n as I,k as Ie,w as Ke,T as Pe,y as at,S as lt,z as rt,A as ut}from"./vendor-CV8_PVEu.js";import{l as et}from"./lodash-BRlxIpe8.js";import{_ as dt,a as ct,b as pt,c as gt,d as mt,e as ft,I as vt,f as ht,u as tt,V as yt,C as xt,B as bt,g as wt}from"./useDraggableButton-DlvQfsgl.js";import{_ as st}from"./app-DFvWhYi8.js";import{_ as kt}from"./InputNumber-BcABGAJA.js";import"./PrimaryButton-Dgy-kueV.js";import"./ActionMessage-Dm4wSOXc.js";const _t={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ct={class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},Vt={class:"text-xl font-semibold text-indigo-700"},$t={class:"p-4 space-y-4"},Dt={class:"flex items-start justify-between"},St={class:"block text-sm font-medium text-gray-700"},Mt={key:0,class:"text-red-500"},Ut={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},jt={key:0,class:"text-center py-8 text-gray-500"},Tt={key:0,class:"text-xs text-gray-400"},qt={__name:"CategoryCadangan",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(o,{emit:g}){const y=o,L=g,U=_(!1),Z=nt(),Je=N(()=>(y.category.points||[]).some(u=>u.is_default===!1)),K=N(()=>{var m;if(console.log("CategorySection - Filtering points:",{categoryName:y.category.name,isDamageMenu:y.category.isDamageMenu,allPoints:y.category.points,allPointsCount:(m=y.category.points)==null?void 0:m.length}),!y.category.isDamageMenu){const t=(y.category.points||[]).filter(k=>{var D;const b=(D=k.inspection_point)==null?void 0:D.id,w=ae(b);return U.value||k.is_default||w?!0:(console.log(`Non-damage Point ${b}: is_default=${k.is_default}, hasData=${w}`),!1)});return console.log("Filtered non-damage points:",t),t}const u=(y.category.points||[]).filter(t=>{var w;const k=(w=t.inspection_point)==null?void 0:w.id,b=ae(k);return U.value||t.is_default||!t.is_default&&b?!0:(console.log(`Damage Point ${k}: hasData=${b}`),b)});return console.log("Filtered damage points:",u),u}),ae=u=>{if(!u)return console.log("hasPointData: pointId is null/undefined"),!1;const m=Z.props.existingResults[u]!==void 0,t=Z.props.existingImages[u]&&Z.props.existingImages[u].length>0,k=y.form.results[u]&&(y.form.results[u].status||y.form.results[u].note),b=y.form.images[u]&&y.form.images[u].length>0,w=m||t||k||b;return console.log(`Point ${u} data check:`,{hasServerResult:m,hasServerImages:t,hasLocalResult:k,hasLocalImages:b,finalResult:w}),w},W=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],Q=u=>{var k,b,w,D,H,j,h,T,q;const m=y.form.results[(k=u.inspection_point)==null?void 0:k.id],t=y.form.images[(b=u.inspection_point)==null?void 0:b.id];if(!m)return!1;switch(u.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!m.note;case"select":case"radio":if(!m.status)return!1;const $=(D=(w=u.settings)==null?void 0:w.radios)==null?void 0:D.find(R=>R.value===m.status);return!($!=null&&$.settings&&($.settings.show_textarea&&!((H=m.note)!=null&&H.trim())||$.settings.show_image_upload&&(t==null?void 0:t.length)===0));case"imageTOradio":if((t==null?void 0:t.length)===0||!m.status)return!1;const M=(h=(j=u.settings)==null?void 0:j.radios)==null?void 0:h.find(R=>R.value===m.status);return!(M!=null&&M.settings&&M.settings.show_textarea&&!((T=m.note)!=null&&T.trim()));case"image":return(t==null?void 0:t.length)>0;default:return!!m.status||!!((q=m.note)!=null&&q.trim())}};Qe(()=>y.form.results,u=>{Object.keys(u).forEach(m=>{!u[m]||!u[m].status&&u[m].note})},{deep:!0}),Qe(()=>y.form.images,u=>{Object.keys(u).forEach(m=>{!u[m]||u[m].length})},{deep:!0});const B=(u,m,t)=>{L("updateResult",{pointId:u,type:t,value:m})},V=u=>{L("saveResult",u)},Y=u=>{L("hapusPoint",u)};return(u,m)=>(a(),p("div",_t,[l("div",Ct,[l("h3",Vt,O(o.category.name),1),Je.value?(a(),p("button",{key:0,onClick:m[0]||(m[0]=t=>U.value=!U.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},O(U.value?"Sembunyikan Point Yang Tidak Perlu":"Tampilkan Point Tersembunyi"),1)):f("",!0)]),l("div",$t,[(a(!0),p($e,null,We(K.value,t=>{var k,b,w,D,H,j,h,T,q,$,M,R,De,Se,le,x,Me,X,P,ee,re,Ue,ue,je,G,de,ce,pe,Te,qe,Re,ze,Le,te,ge,d,se,ne,ie,me,fe,A,J,Be,ve,He,Oe,Ae,Ne,Ee,Fe,he,ye,xe,be,n;return a(),p("div",{key:t.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[l("div",Dt,[l("label",St,[Ge(O((k=t.inspection_point)==null?void 0:k.name)+" ",1),(b=t.settings)!=null&&b.is_required?(a(),p("span",Mt,"*")):f("",!0)]),Q(t)?(a(),p("span",Ut," âœ“ ")):f("",!0)]),t.input_type==="text"?(a(),S(dt,{key:0,modelValue:o.form.results[(w=t.inspection_point)==null?void 0:w.id].note,"onUpdate:modelValue":[e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].note=e},e=>{var s;return B((s=t.inspection_point)==null?void 0:s.id,e,"note")}],required:(D=t.settings)==null?void 0:D.is_required,"min-length":(H=t.settings)==null?void 0:H.min_length,"max-length":(j=t.settings)==null?void 0:j.max_length,allowSpace:(h=t.settings)==null?void 0:h.allow_space,textTransform:(T=t.settings)==null?void 0:T.text_transform,placeholder:((q=t.settings)==null?void 0:q.placeholder)||"Masukan text",error:o.form.errors[`results.${($=t.inspection_point)==null?void 0:$.id}.note`],onSave:e=>{var s;return V((s=t.inspection_point)==null?void 0:s.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):f("",!0),t.input_type==="number"?(a(),S(kt,{key:1,modelValue:o.form.results[(M=t.inspection_point)==null?void 0:M.id].note,"onUpdate:modelValue":[e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].note=e},e=>{var s;return B((s=t.inspection_point)==null?void 0:s.id,e,"note")}],required:(R=t.settings)==null?void 0:R.is_required,min:(De=t.settings)==null?void 0:De.min,max:(Se=t.settings)==null?void 0:Se.max,step:((le=t.settings)==null?void 0:le.step)||1,placeholder:((x=t.settings)==null?void 0:x.placeholder)||"Masukan number",error:o.form.errors[`results.${(Me=t.inspection_point)==null?void 0:Me.id}.note`],onSave:e=>{var s;return V((s=t.inspection_point)==null?void 0:s.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):f("",!0),t.input_type==="account"?(a(),S(ct,{key:2,modelValue:o.form.results[(X=t.inspection_point)==null?void 0:X.id].note,"onUpdate:modelValue":[e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].note=e},e=>{var s;return B((s=t.inspection_point)==null?void 0:s.id,e,"note")}],required:(P=t.settings)==null?void 0:P.is_required,placeholder:((ee=t.settings)==null?void 0:ee.placeholder)||"Masukkan nilai",error:o.form.errors[`results.${(re=t.inspection_point)==null?void 0:re.id}.note`],"point-id":(Ue=t.inspection_point)==null?void 0:Ue.id,settings:t.settings,onSave:e=>{var s;return V((s=t.inspection_point)==null?void 0:s.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):f("",!0),t.input_type==="date"?(a(),S(pt,{key:3,modelValue:o.form.results[(ue=t.inspection_point)==null?void 0:ue.id].note,"onUpdate:modelValue":[e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].note=e},e=>{var s;return B((s=t.inspection_point)==null?void 0:s.id,e,"note")}],required:(je=t.settings)==null?void 0:je.is_required,"min-date":(G=t.settings)==null?void 0:G.min_date,"max-date":(de=t.settings)==null?void 0:de.max_date,error:o.form.errors[`results.${(ce=t.inspection_point)==null?void 0:ce.id}.note`],onSave:e=>{var s;return V((s=t.inspection_point)==null?void 0:s.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):f("",!0),t.input_type==="textarea"?(a(),S(gt,{key:4,modelValue:o.form.results[(pe=t.inspection_point)==null?void 0:pe.id].note,"onUpdate:modelValue":[e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].note=e},e=>{var s;return B((s=t.inspection_point)==null?void 0:s.id,e,"note")}],required:(Te=t.settings)==null?void 0:Te.is_required,"min-length":(qe=t.settings)==null?void 0:qe.min_length,"max-length":(Re=t.settings)==null?void 0:Re.max_length,placeholder:((ze=t.settings)==null?void 0:ze.placeholder)||"Masukkan teks di sini",settings:t.settings,error:o.form.errors[`results.${(Le=t.inspection_point)==null?void 0:Le.id}.note`],onSave:e=>{var s;return V((s=t.inspection_point)==null?void 0:s.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):f("",!0),t.input_type==="radio"?(a(),S(mt,{key:5,modelValue:o.form.results[(te=t.inspection_point)==null?void 0:te.id].status,"onUpdate:modelValue":[e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].status=e},e=>{var s;return B((s=t.inspection_point)==null?void 0:s.id,e,"status")}],notes:o.form.results[(ge=t.inspection_point)==null?void 0:ge.id].note,images:o.form.images[(d=t.inspection_point)==null?void 0:d.id],required:(se=t.settings)==null?void 0:se.is_required,"point-id":(ne=t.inspection_point)==null?void 0:ne.id,point:t.inspection_point,"inspection-id":o.inspectionId,settings:t.settings,"point-name":(ie=t.inspection_point)==null?void 0:ie.name,"selected-point":t.inspection_point??null,options:((me=t.settings)==null?void 0:me.radios)||W,error:o.form.errors[`results.${(fe=t.inspection_point)==null?void 0:fe.id}.status`],"onUpdate:notes":e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].note=e},"onUpdate:images":e=>{var s;return o.form.images[(s=t.inspection_point)==null?void 0:s.id]=e},onSave:e=>{var s;return V((s=t.inspection_point)==null?void 0:s.id)},onHapus:e=>{var s;return Y((s=t.inspection_point)==null?void 0:s.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):f("",!0),t.input_type==="imageTOradio"?(a(),S(ft,{key:6,modelValue:o.form.results[(A=t.inspection_point)==null?void 0:A.id].status,"onUpdate:modelValue":[e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].status=e},e=>{var s;return B((s=t.inspection_point)==null?void 0:s.id,e,"status")}],notes:o.form.results[(J=t.inspection_point)==null?void 0:J.id].note,images:o.form.images[(Be=t.inspection_point)==null?void 0:Be.id],required:(ve=t.settings)==null?void 0:ve.is_required,"point-id":(He=t.inspection_point)==null?void 0:He.id,"inspection-id":o.inspectionId,settings:t.settings,"point-name":(Oe=t.inspection_point)==null?void 0:Oe.name,point:t,"selected-point":t.inspection_point??null,options:((Ae=t.settings)==null?void 0:Ae.radios)||W,error:o.form.errors[`results.${(Ne=t.inspection_point)==null?void 0:Ne.id}.status`],"onUpdate:notes":e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].note=e},"onUpdate:images":e=>{var s;return o.form.images[(s=t.inspection_point)==null?void 0:s.id]=e},onSave:e=>{var s;return V((s=t.inspection_point)==null?void 0:s.id)},onHapus:e=>{var s;return Y((s=t.inspection_point)==null?void 0:s.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):f("",!0),t.input_type==="image"?(a(),S(vt,{key:7,modelValue:o.form.images[(Ee=t.inspection_point)==null?void 0:Ee.id],"onUpdate:modelValue":e=>{var s;return o.form.images[(s=t.inspection_point)==null?void 0:s.id]=e},error:o.form.errors[`images.${(Fe=t.inspection_point)==null?void 0:Fe.id}`],"inspection-id":o.inspectionId,"point-id":(he=t.inspection_point)==null?void 0:he.id,point:t.inspection_point,"point-name":(ye=t.inspection_point)==null?void 0:ye.name,settings:t.settings,"onUpdate:notes":e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].note=e},"onUpdate:status":e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].status=e}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):f("",!0),t.input_type==="select"?(a(),S(ht,{key:8,modelValue:o.form.results[(xe=t.inspection_point)==null?void 0:xe.id].status,"onUpdate:modelValue":[e=>{var s;return o.form.results[(s=t.inspection_point)==null?void 0:s.id].status=e},e=>{var s;return B((s=t.inspection_point)==null?void 0:s.id,e,"status")}],required:(be=t.settings)==null?void 0:be.is_required,error:o.form.errors[`results.${(n=t.inspection_point)==null?void 0:n.id}.status`],onSave:e=>{var s;return V((s=t.inspection_point)==null?void 0:s.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):f("",!0)])}),128)),K.value.length===0?(a(),p("div",jt,[m[1]||(m[1]=l("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),m[2]||(m[2]=l("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),o.category.isDamageMenu?(a(),p("p",Tt,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):f("",!0)])):f("",!0)])]))}},Rt=st(qt,[["__scopeId","data-v-e09c094b"]]),zt={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Lt={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},Bt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Ht={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Ot={class:"flex overflow-x-auto scrollbar-hide py-3 px-4"},At={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Nt=["onClick"],Et={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ft={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},It={key:3,class:"fixed inset-0 z-30"},Kt={class:"mt-2 space-y-2"},Wt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Gt=["onClick"],Jt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Zt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Qt={class:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1"},Yt={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Xt={class:"relative overflow-hidden"},Pt={key:0,class:"flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md"},es={key:1},ts=["disabled"],ss={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ns={class:"space-y-4"},is={class:"relative"},os={class:"max-h-64 overflow-y-auto"},as={key:0,class:"text-center py-4 text-gray-500"},ls=["onClick"],rs={class:"font-medium text-gray-900"},us={class:"text-sm text-gray-500"},ds={class:"text-xs text-gray-400 mt-1"},cs={key:0,class:"text-xs text-green-600 mt-1"},ps={__name:"Induk",props:{inspection:Object,inspectionId:Object,category:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(o){var he,ye,xe,be;const g=o,y=_(((ye=(he=g.category)==null?void 0:he.settings)==null?void 0:ye.menu_model)||"horizontal"),L=_(((be=(xe=g.category)==null?void 0:xe.settings)==null?void 0:be.position)||"top"),U=_(!1),{pos:Z,dragging:Je,startLongPress:K,cancelLongPress:ae,onDrag:W,stopDrag:Q}=tt("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),B=()=>{U.value=!U.value},V=()=>{U.value=!1},Y=n=>n?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:u,dragging:m,startLongPress:t,cancelLongPress:k,onDrag:b,stopDrag:w}=tt("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),D=_(!1),H=_(!1),j=_(""),h=_(null),T=_(""),q=_(""),$=_(""),M=_(!1),R=_(null),De=(n,e)=>{M.value=!0,R.value=e,oe.visit(n,{onFinish:()=>{M.value=!1,R.value=null}})},Se=N(()=>g.appMenus.some(n=>n.input_type==="damage")),le=N(()=>["vehicle",...g.appMenus.map(n=>n.id),"conclusion"]),x=_(le.value[0]),Me=_(0);Qe(x,n=>{Me.value=le.value.indexOf(n)});const X=N(()=>{if(x.value==="vehicle"||x.value==="conclusion")return null;const n=g.appMenus.find(e=>e.id===x.value);return n?{...n,points:P(n.menu_point,n.input_type==="damage")}:null}),P=(n,e)=>e?(n||[]).filter(s=>{const c=s.inspection_point_id;return ce(c)}):n||[],ee=_({plate_number:g.inspection.plate_number,car_id:g.inspection.car_id,car_name:g.inspection.car_name}),re=_(!1),Ue=n=>{re.value=n},ue=_(!1),je=n=>{ue.value=n},G=N(()=>{var v;const n=ee.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(ee.value.plate_number),e=!!((v=ee.value.car_name)!=null&&v.trim()),s=!ue.value,c=!re.value;return n&&e&&s&&c}),de=N(()=>{if(!j.value.trim())return g.damagePoints||[];const n=j.value.toLowerCase().trim();return(g.damagePoints||[]).filter(e=>{var s,c,v,C,z;return((c=(s=e.inspection_point)==null?void 0:s.name)==null?void 0:c.toLowerCase().includes(n))||((C=(v=e.inspection_point)==null?void 0:v.description)==null?void 0:C.toLowerCase().includes(n))||((z=pe(e))==null?void 0:z.toLowerCase().includes(n))})}),ce=n=>{const e=g.existingResults&&g.existingResults[n]!==void 0,s=g.existingImages&&g.existingImages[n]&&g.existingImages[n].length>0,c=d.results[n]&&(d.results[n].status||d.results[n].note),v=d.images[n]&&d.images[n].length>0;return e||s||c||v},pe=n=>{var e;return((e=n.inspection_point.component)==null?void 0:e.name)||"Komponen Tidak Diketahui"},Te=n=>g.existingResults[n]||null,qe=n=>{h.value=n;const e=n.inspection_point_id,s=d.results[e]||{};T.value=s.status||"",q.value=s.note||"",D.value=!1,H.value=!0},Re=n=>{h.value&&(d.images[h.value.inspection_point_id]=n)},ze=()=>{if(h.value){const n=h.value.inspection_point_id;d.results[n]={...d.results[n],status:T.value,note:q.value},J(n),$.value="Data berhasil disimpan!",setTimeout(()=>$.value="",1e3)}te()},Le=()=>{D.value=!1,j.value=""},te=()=>{H.value=!1,h.value=null,T.value="",q.value=""},ge=()=>{const n={},e={};return[...g.appMenus.flatMap(c=>c.menu_point||[]),...g.damagePoints||[]].forEach(c=>{const v=c.inspection_point_id,C=g.existingResults[v];n[v]={status:(C==null?void 0:C.status)||"",note:(C==null?void 0:C.note)||""},e[v]=g.existingImages[v]||[]}),{inspection_id:g.inspection.id,results:n,images:e,overall_note:g.inspection.overall_note||""}},d=it(ge()),se=n=>n.input_type==="damage"?P(n.menu_point,!0).length>0:n.id==="conclusion"?ie():n.id==="vehicle"?G():(P(n.menu_point,!1)||[]).filter(s=>s.is_default).every(s=>{var z,we,ke,_e,Ce,Ve;const c=d.results[s.inspection_point_id],v=d.images[s.inspection_point_id];if(!c)return!1;const C=ne(s.settings);switch(s.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((z=c.note)!=null&&z.trim());case"select":case"radio":if(!c.status)return!1;const E=(we=C.radios)==null?void 0:we.find(i=>i.value===c.status);return!(E!=null&&E.settings&&(E.settings.show_textarea&&!((ke=c.note)!=null&&ke.trim())||E.settings.show_image_upload&&(v==null?void 0:v.length)===0));case"imageTOradio":if((v==null?void 0:v.length)===0||!c.status)return!1;const F=(_e=C.radios)==null?void 0:_e.find(i=>i.value===c.status);return!(F!=null&&F.settings&&F.settings.show_textarea&&F.settings.required&&!((Ce=c.note)!=null&&Ce.trim()));case"image":return(v==null?void 0:v.length)>0;default:return!!c.status||!!((Ve=c.note)!=null&&Ve.trim())}}),ne=n=>{if(!n)return{};if(typeof n=="string")try{return JSON.parse(n)||{}}catch(e){return console.error("Error parsing settings JSON:",e),{}}return typeof n=="object"&&n!==null?n:{}},ie=()=>{var z;const e=ne(g.inspection.settings).conclusion||{},s=!!e.flooded,c=!!e.collision,v=e.collision==="yes"?!!e.collision_severity:!0,C=!!((z=g.inspection.notes)!=null&&z.trim());return s&&c&&v&&C},me=N(()=>{const e=ne(g.inspection.settings).conclusion||{};return{flooded:e.flooded||null,collision:e.collision||null,collision_severity:e.collision_severity||null,note:g.inspection.notes||null,isComplete:ie()}}),fe=N(()=>{const n=G.value,e=g.appMenus.every(c=>se(c)),s=ie();return n&&e&&s}),A=n=>{x.value=n},J=et.debounce(async n=>{var e,s;try{await oe.post(route("inspections.save-result"),{inspection_id:g.inspection.id,point_id:n,status:(e=d.results[n])==null?void 0:e.status,note:(s=d.results[n])==null?void 0:s.note,images:d.images[n]},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{oe.reload({only:["existingResults","existingImages"]})}})}catch(c){console.error("Error menyimpan hasil:",c)}},500),Be=({pointId:n,type:e,value:s})=>{var c;(c=d.results[n])!=null&&c.hasOwnProperty(e)&&(d.results[n][e]=s),J(n)},ve=async n=>{if(n&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await oe.post(route("inspections.delete-result"),{inspection_id:g.inspection.id,point_id:n},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{d.results[n]&&(d.results[n]={status:"",note:""}),d.images[n]&&(d.images[n]=[]),$.value="Data berhasil dihapus!",setTimeout(()=>{oe.reload({only:["existingResults","existingImages"],onSuccess:()=>{Object.assign(d,ge())}})},100)},onError:e=>{console.error("Error menghapus hasil:",e)}})}catch(e){console.error("Error menghapus hasil:",e)}te()}},He=n=>{console.log("Update vehicle:",n)},Oe=n=>{console.log("Save car details:",n)},Ae=n=>{Object.assign(d.conclusion,n),Ne()},Ne=et.debounce(async()=>{try{await oe.post(route("inspections.save-conclusion"),{inspection_id:g.inspection.id,...d.conclusion},{preserveScroll:!0,preserveState:!0})}catch(n){console.error("Error menyimpan kesimpulan:",n)}},500),Ee=()=>{if(!fe.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}d.post(route("inspections.final-submit",{id:g.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:n=>{console.error("Kesalahan pengiriman:",n)}})},Fe=({pointId:n,imageId:e})=>{d.images[n]&&(d.images[n]=d.images[n].filter(s=>s.id!==e),J(n))};return ot(()=>{}),(n,e)=>{var s,c,v,C,z,we,ke,_e,Ce,Ve,E,F;return a(),p("div",zt,[r(m)||r(Je)?(a(),p("div",Lt)):f("",!0),y.value==="vertical"?(a(),p("button",{key:1,onMousedown:e[0]||(e[0]=(...i)=>r(K)&&r(K)(...i)),onMouseup:e[1]||(e[1]=(...i)=>r(Q)&&r(Q)(...i)),onMouseleave:e[2]||(e[2]=(...i)=>r(ae)&&r(ae)(...i)),onMousemove:e[3]||(e[3]=(...i)=>r(W)&&r(W)(...i)),onTouchstart:e[4]||(e[4]=(...i)=>r(K)&&r(K)(...i)),onTouchend:e[5]||(e[5]=(...i)=>r(Q)&&r(Q)(...i)),onTouchmove:e[6]||(e[6]=(...i)=>r(W)&&r(W)(...i)),onClick:B,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:Xe({left:r(Z).x+"px",top:r(Z).y+"px"}),"aria-label":"Toggle vertical menu"},[U.value?(a(),p("svg",Ht,e[24]||(e[24]=[l("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(a(),p("svg",Bt,e[23]||(e[23]=[l("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):f("",!0),y.value==="horizontal"?(a(),p("div",{key:2,class:I(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":L.value==="top","fixed bottom-0 left-0 right-0":L.value==="bottom"}])},[l("div",Ot,[l("button",{onClick:e[7]||(e[7]=i=>A("vehicle")),class:I(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":x.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":x.value!=="vehicle"}])},[e[25]||(e[25]=Ge(" Detail Kendaraan ")),G.value?(a(),p("span",At," âœ“ ")):f("",!0)],2),(a(!0),p($e,null,We(o.appMenus,i=>(a(),p("button",{key:i.id,onClick:Ze=>A(i.id),class:I(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":x.value===i.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":x.value!==i.id}])},[Ge(O(i.name)+" ",1),se(i)?(a(),p("span",Et," âœ“ ")):f("",!0)],10,Nt))),128)),l("button",{onClick:e[8]||(e[8]=i=>A("conclusion")),class:I(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":x.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":x.value!=="conclusion"}])},[e[26]||(e[26]=Ge(" Kesimpulan ")),me.value.isComplete?(a(),p("span",Ft," âœ“ ")):f("",!0)],2)])],2)):f("",!0),y.value==="vertical"&&U.value?(a(),p("div",It,[l("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:V}),l("div",{class:I(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":L.value==="top-right","top-16 left-4":L.value==="top-left","bottom-16 right-4":L.value==="bottom-right","bottom-16 left-4":L.value==="bottom-left"}])},[l("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[e[27]||(e[27]=l("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),l("button",{onClick:V,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),l("div",Kt,[l("button",{onClick:e[9]||(e[9]=i=>{A("vehicle"),V()}),class:I([Y(x.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[e[28]||(e[28]=l("span",null,"Detail Kendaraan",-1)),G.value?(a(),p("span",Wt,"âœ“")):f("",!0)],2),(a(!0),p($e,null,We(o.appMenus,i=>(a(),p("button",{key:`vmenu-${i.id}`,onClick:()=>{A(i.id),V()},class:I([Y(x.value===i.id),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[l("span",null,O(i.name),1),se(i)?(a(),p("span",Jt,"âœ“")):f("",!0)],10,Gt))),128)),l("button",{onClick:e[10]||(e[10]=i=>{A("conclusion"),V()}),class:I([Y(x.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[e[29]||(e[29]=l("span",null,"Kesimpulan",-1)),me.value.isComplete?(a(),p("span",Zt,"âœ“")):f("",!0)],2)])],2)])):f("",!0),l("div",Qt,[Ie(Pe,{name:"fade"},{default:Ke(()=>[$.value?(a(),p("div",Yt,O($.value),1)):f("",!0)]),_:1}),l("div",Xt,[Ie(Pe,{name:"category-slide",mode:"out-in"},{default:Ke(()=>[x.value==="vehicle"?(a(),S(yt,{key:0,inspection:o.inspection,CarDetail:o.CarDetail,allInspections:g.allInspections,onUpdateVehicle:He,onSaveCarDetails:Oe,"onUpdate:validation":je,"onUpdate:hasUnsavedChanges":Ue},null,8,["inspection","CarDetail","allInspections"])):X.value&&x.value!=="conclusion"?(a(),S(Rt,{key:X.value.id,category:X.value,"inspection-id":o.inspection.id,form:r(d),onSaveResult:r(J),onUpdateResult:Be,onHapusPoint:ve,onRemoveImage:Fe},null,8,["category","inspection-id","form","onSaveResult"])):x.value==="conclusion"?(a(),S(xt,{key:2,form:r(d),"inspection-id":o.inspection.id,inspection:o.inspection,settings:o.inspection.settings||{},onUpdateConclusion:Ae},null,8,["form","inspection-id","inspection","settings"])):f("",!0)]),_:1})]),x.value==="conclusion"?(a(),p("div",Pt,[Ie(r(lt),{href:n.route("inspections.pending",o.inspectionId),as:"button",type:"button",disabled:M.value&&R.value==="pending",onClick:e[11]||(e[11]=at(i=>De(n.route("inspections.pending",o.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:Ke(()=>[M.value&&R.value==="pending"?(a(),p($e,{key:0},[e[30]||(e[30]=l("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 \r
                5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 \r
                5.824 3 7.938l3-2.647z`})],-1)),e[31]||(e[31]=l("span",null,"Memproses...",-1))],64)):(a(),p("span",es,"Tunda"))]),_:1},8,["href","disabled"]),l("button",{type:"button",onClick:Ee,disabled:!fe.value||r(d).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[r(d).processing?(a(),p("svg",ss,e[32]||(e[32]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 \r
              5.373 0 12h4zm2 5.291A7.962 7.962 0 \r
              014 12H0c0 3.042 1.135 5.824 3 \r
              7.938l3-2.647z`},null,-1)]))):f("",!0),l("span",null,O(r(d).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ts)])):f("",!0),Se.value?(a(),p("button",{key:1,onMousedown:e[12]||(e[12]=(...i)=>r(t)&&r(t)(...i)),onMouseup:e[13]||(e[13]=(...i)=>r(w)&&r(w)(...i)),onMouseleave:e[14]||(e[14]=(...i)=>r(k)&&r(k)(...i)),onMousemove:e[15]||(e[15]=(...i)=>r(b)&&r(b)(...i)),onTouchstart:e[16]||(e[16]=(...i)=>r(t)&&r(t)(...i)),onTouchend:e[17]||(e[17]=(...i)=>r(w)&&r(w)(...i)),onTouchmove:e[18]||(e[18]=(...i)=>r(b)&&r(b)(...i)),onClick:e[19]||(e[19]=i=>D.value=!0),class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:Xe({left:r(u).x+"px",top:r(u).y+"px"})},e[33]||(e[33]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):f("",!0),Ie(bt,{show:D.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:Le},{default:Ke(()=>[l("div",ns,[l("div",is,[rt(l("input",{"onUpdate:modelValue":e[20]||(e[20]=i=>j.value=i),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[ut,j.value]]),e[34]||(e[34]=l("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[l("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),l("div",os,[de.value.length===0?(a(),p("div",as," Tidak ada point yang ditemukan ")):f("",!0),(a(!0),p($e,null,We(de.value,i=>{var Ze,Ye;return a(),p("button",{key:i.id,onClick:gs=>qe(i),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[l("div",rs,O((Ze=i.inspection_point)==null?void 0:Ze.name),1),l("div",us,O((Ye=i.inspection_point)==null?void 0:Ye.description),1),l("div",ds,O(pe(i)),1),ce(i.inspection_point_id)?(a(),p("div",cs," âœ“ Sudah ada data ")):f("",!0)],8,ls)}),128))])])]),_:1},8,["show"]),H.value?(a(),S(wt,{key:(s=h.value)==null?void 0:s.id,show:H.value,title:((v=(c=h.value)==null?void 0:c.inspection_point)==null?void 0:v.name)||"Detail Point",subtitle:(z=(C=h.value)==null?void 0:C.inspection_point)==null?void 0:z.description,name:`point-${(we=h.value)==null?void 0:we.id}`,"inspection-id":o.inspection.id,"point-id":(ke=h.value)==null?void 0:ke.inspection_point_id,settings:((_e=h.value)==null?void 0:_e.settings)||{},options:((Ve=(Ce=h.value)==null?void 0:Ce.settings)==null?void 0:Ve.radios)||[],"selected-Point":h.value,"selected-value":T.value,"images-value":r(d).images[(E=h.value)==null?void 0:E.inspection_point_id],"notes-value":q.value,point:h.value,"existing-data":Te((F=h.value)==null?void 0:F.inspection_point_id),"onUpdate:selectedValue":e[21]||(e[21]=i=>T.value=i),"onUpdate:notesValue":e[22]||(e[22]=i=>q.value=i),"onUpdate:imagesValue":Re,onSave:ze,onClose:te,onHapus:ve},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):f("",!0)])])}}},ws=st(ps,[["__scopeId","data-v-5f39f1e2"]]);export{ws as default};
