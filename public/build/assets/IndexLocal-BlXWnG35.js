import{x as Nt,r as w,g as at,q as le,E as mt,G as he,c as n,o,d as e,b as c,k as ke,z as Ne,A as Pe,n as ne,t as B,u as X,e as os,F as Ve,m as Me,f as Ce,y as st,w as Le,L as Fe,M as as,a as ut,j as De,l as Ut,T as ot,p as ns,N as Dt,D as Lt,J as ct,B as is,O as ls,I as jt,S as rs,W as lt}from"./vendor-CwaeDJfC.js";import{l as Bt}from"./lodash-DfwitXkl.js";import{_ as ds}from"./PrimaryButton-DTE9tPxx.js";import{_ as us}from"./ActionMessage-PedWn-P3.js";import{_ as Ae}from"./app-DX4i6Fwq.js";import{u as Tt}from"./useDraggableButton-B7ftwxmu.js";const cs={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},gs={key:0,class:"p-4 space-y-2"},ms={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ps={class:"flex items-center space-x-2"},vs={key:0,class:"text-xs text-red-500 font-normal ml-2"},fs={key:1,class:"text-xs text-red-500 font-normal ml-2"},hs={key:2,class:"text-xs text-green-500 font-normal ml-2"},bs={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ys={class:"relative"},xs={key:0,class:"absolute right-3 top-3"},ws={key:1,class:"text-xs text-red-500 font-normal ml-2"},ks={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},$s={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Cs={key:0},Is=["onMousedown"],Ss={class:"font-medium text-gray-900"},_s={class:"text-sm text-gray-500"},Vs={key:1,class:"p-4 text-sm text-gray-500 text-center"},Ms={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Us={key:0,class:"mb-4"},Ds=["innerHTML"],js={key:1},Ts={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Ns=["onClick"],Ls=["src","alt"],Bs={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},qs={class:"text-white text-xs text-center"},Fs={key:2,class:"text-center py-4 text-gray-500 text-sm"},As={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Rs=["src","alt"],Es={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},zs={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Os={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Hs={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges"],setup(t,{emit:Y}){var U,E,se,O,oe,ee;const s=t,x=Y,u=Nt({plate_number:((U=s.inspection)==null?void 0:U.plate_number)||"",car_id:((E=s.inspection)==null?void 0:E.car_id)||null,car_name:((se=s.inspection)==null?void 0:se.car_name)||""}),h=w(((O=s.inspection)==null?void 0:O.plate_number)||""),p=w(((oe=s.inspection)==null?void 0:oe.car_id)||null),r=w(((ee=s.inspection)==null?void 0:ee.car_name)||""),g=w(""),k=w(""),V=w(""),C=w(!1),q=w(""),G=w(""),b=w(u.car_name),S=w(!1),a=w(!1),I=w([]),y=w(null),D=w([]),K=w(!1),T=w(0);at(()=>{var $,m,Z,W,F;if(te(($=s.inspection)==null?void 0:$.plate_number),(m=s.inspection)!=null&&m.car_id&&((Z=s.CarDetail)==null?void 0:Z.length)>0){const pe=s.CarDetail.find(xe=>xe.id===s.inspection.car_id);pe&&me(pe)}else!((W=s.inspection)!=null&&W.car_id)&&((F=s.inspection)!=null&&F.car_name)&&(b.value=s.inspection.car_name,u.car_id=null);window.addEventListener("keydown",d),x("update:hasUnsavedChanges",Ie.value),x("update:validation",ge.value)}),mt(()=>{window.removeEventListener("keydown",d)});const te=$=>{if(!$){g.value="",k.value="",V.value="";return}const m=$.toUpperCase().trim(),Z=m.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(Z)g.value=Z[1]||"",k.value=Z[2]||"",V.value=Z[3]||"";else{let W="area",F="",pe="",xe="";for(const we of m)W==="area"&&/[A-Z]/.test(we)?F+=we:W==="area"&&/[0-9]/.test(we)?(W="number",pe+=we):W==="number"&&/[0-9]/.test(we)?pe+=we:W==="number"&&/[A-Z]/.test(we)?(W="suffix",xe+=we):W==="suffix"&&/[A-Z]/.test(we)&&(xe+=we);g.value=F,k.value=pe,V.value=xe}Q()},Q=()=>{const $=`${g.value}${k.value}${V.value}`;u.plate_number=$,_()},N=$=>{$==="area"?g.value=g.value.toUpperCase().replace(/[^A-Z]/g,""):$==="number"?k.value=k.value.replace(/[^0-9]/g,""):$==="suffix"&&(V.value=V.value.toUpperCase().replace(/[^A-Z]/g,"")),Q()},M=le(()=>{const $=u.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test($)}),z=le(()=>!b.value||b.value.trim()===""),P=le(()=>u.plate_number.length>0&&!M.value?"Format plat nomor tidak valid.":null),ge=le(()=>{const $=!u.plate_number||u.plate_number.trim()==="",m=!b.value||b.value.trim()==="";return $||m||!M.value||C.value}),Ie=le(()=>{const $=u.plate_number!==h.value,m=u.car_id!==p.value||b.value!==r.value;return $||m}),$e=le(()=>Ie.value&&!ge.value),A=$=>{var Z,W,F;if(!$)return"";const m=[];return(Z=$.brand)!=null&&Z.name&&m.push($.brand.name),(W=$.model)!=null&&W.name&&m.push($.model.name),(F=$.type)!=null&&F.name&&m.push($.type.name),$.cc&&m.push(($.cc/1e3).toFixed(1)),$.transmission&&m.push($.transmission),$.year&&m.push($.year.toString()),$.fuel_type&&m.push($.fuel_type),$.production_period&&m.push(`(${$.production_period})`),m.join(" ")},H=()=>{u.car_id&&(u.car_id=null,y.value=null,D.value=[]),ie()},ie=Bt.debounce(()=>{if(!b.value.trim()){I.value=[],S.value=!1;return}a.value=!0;try{const $=b.value.toLowerCase().trim();I.value=s.CarDetail.filter(m=>A(m).toLowerCase().includes($)),S.value=!0}finally{a.value=!1}},300),re=()=>{setTimeout(()=>{S.value=!1,u.car_name=b.value,_()},200)},me=async $=>{y.value=$,b.value=A($),u.car_id=$.id,u.car_name=A($),S.value=!1,await ue($.id),_(),x("update:hasUnsavedChanges",Ie.value),x("update:validation",ge.value)},de=$=>!$||!$.file_path?"":`/storage/${$.file_path}`,ue=async $=>{try{const m=await fetch(`/api/cars/${$}/images`);if(m.ok){const Z=await m.json();D.value=Array.isArray(Z)?Z:[]}else D.value=[]}catch(m){console.error("Error loading car images:",m),D.value=[]}},be=$=>{T.value=$,K.value=!0,document.body.style.overflow="hidden"},L=()=>{K.value=!1,document.body.style.overflow=""},ye=()=>{T.value=(T.value+1)%D.value.length},fe=()=>{T.value=(T.value-1+D.value.length)%D.value.length},d=$=>{if(K.value)switch($.key){case"Escape":L();break;case"ArrowRight":ye();break;case"ArrowLeft":fe();break}},_=()=>{const $={plate_number:u.plate_number,car_id:u.car_id,car_name:u.car_name};x("update-vehicle",$)},f=()=>{s.inspection&&u.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0,onSuccess:()=>{h.value=u.plate_number,p.value=u.car_id,r.value=u.car_name,x("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:$=>{console.error("Gagal menyimpan data:",$)}})};return he([()=>u.plate_number,()=>u.car_name],$=>{q.value="",C.value=!1,G.value="";const m=$[0];if(m&&m.length>=6){const Z=s.allInspections.filter(W=>{var F;return W.plate_number===m&&W.id!==((F=s.inspection)==null?void 0:F.id)});if(Z.length>0){const W=["draft","in_progress","pending","pending_review","revision"],F=Z.find(pe=>W.includes(pe.status));if(F)C.value=!0,q.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${F.status.replace(/_/g," ").toUpperCase()}.`;else{const pe=Z.filter(xe=>["approved","rejected","completed","cancelled"].includes(xe.status));if(pe.length>0){pe.sort((we,Re)=>new Date(Re.created_at)-new Date(we.created_at));const xe=pe[0];if(xe.car_id){const we=s.CarDetail.find(Re=>Re.id===xe.car_id);we&&me(we)}else xe.car_name&&(b.value=xe.car_name,u.car_name=xe.car_name,u.car_id=null);G.value=`Nomor plat ini sudah pernah diperiksa ${pe.length} kali sebelumnya.`}}}}x("update:hasUnsavedChanges",Ie.value),x("update:validation",ge.value)},{deep:!0}),($,m)=>{var Z;return o(),n("div",cs,[m[21]||(m[21]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(o(),n("div",gs,[e("div",ms,[m[9]||(m[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),e("div",ps,[Ne(e("input",{"onUpdate:modelValue":m[0]||(m[0]=W=>g.value=W),type:"text",placeholder:"Contoh: B",class:ne(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||C.value}]),onInput:m[1]||(m[1]=W=>N("area")),maxlength:"2"},null,34),[[Pe,g.value]]),Ne(e("input",{"onUpdate:modelValue":m[2]||(m[2]=W=>k.value=W),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:ne(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||C.value}]),onInput:m[3]||(m[3]=W=>N("number")),maxlength:"4"},null,34),[[Pe,k.value]]),Ne(e("input",{"onUpdate:modelValue":m[4]||(m[4]=W=>V.value=W),type:"text",placeholder:"ABC",class:ne(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||C.value}]),onInput:m[5]||(m[5]=W=>N("suffix")),maxlength:"3"},null,34),[[Pe,V.value]])]),P.value?(o(),n("span",vs,B(P.value),1)):c("",!0),q.value?(o(),n("span",fs,B(q.value),1)):c("",!0),G.value?(o(),n("span",hs,B(G.value),1)):c("",!0)]),e("div",bs,[m[13]||(m[13]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",ys,[Ne(e("input",{"onUpdate:modelValue":m[6]||(m[6]=W=>b.value=W),type:"text",placeholder:"Cari atau ketik nama mobil...",class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":z.value}]),onInput:H,onFocus:m[7]||(m[7]=W=>S.value=!0),onBlur:re},null,34),[[Pe,b.value]]),a.value?(o(),n("div",xs,m[10]||(m[10]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),z.value?(o(),n("span",ws,"Nama mobil tidak boleh kosong.")):c("",!0),!X(u).car_id&&b.value?(o(),n("div",ks,m[11]||(m[11]=[os('<div class="flex items-start" data-v-1fd1424d><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-1fd1424d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-1fd1424d></path></svg><div data-v-1fd1424d><p class="text-yellow-800 font-medium mb-1" data-v-1fd1424d>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-1fd1424d> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-1fd1424d>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-1fd1424d> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-1fd1424d> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-1fd1424d>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-1fd1424d>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):c("",!0),S.value?(o(),n("div",$s,[I.value.length>0?(o(),n("div",Cs,[(o(!0),n(Ve,null,Me(I.value,W=>(o(),n("div",{key:W.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:F=>me(W)},[e("div",Ss,B(A(W)),1),e("div",_s,B(W.year)+" • "+B(W.cc)+"cc • "+B(W.transmission)+" • "+B(W.fuel_type),1)],40,Is))),128))])):(o(),n("div",Vs,m[12]||(m[12]=[Ce(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),Ce(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),X(u).car_id&&y.value?(o(),n("div",Ms,[y.value.description?(o(),n("div",Us,[m[14]||(m[14]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:y.value.description},null,8,Ds)])):c("",!0),D.value.length>0?(o(),n("div",js,[m[15]||(m[15]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",Ts,[(o(!0),n(Ve,null,Me(D.value,(W,F)=>(o(),n("div",{key:W.id||F,class:"relative group cursor-pointer",onClick:pe=>be(F)},[e("img",{src:de(W),alt:W.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ls),W.note?(o(),n("div",Bs,[e("p",qs,B(W.note),1)])):c("",!0)],8,Ns))),128))])])):(o(),n("div",Fs," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),K.value?(o(),n("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:L},[e("div",As,[e("button",{onClick:L,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},m[16]||(m[16]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),D.value.length>1?(o(),n("button",{key:0,onClick:st(fe,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},m[17]||(m[17]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),D.value.length>1?(o(),n("button",{key:1,onClick:st(ye,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},m[18]||(m[18]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),e("img",{src:de(D.value[T.value]),alt:"Car Image "+(T.value+1),class:"max-w-full max-h-full object-contain",onClick:m[8]||(m[8]=st(()=>{},["stop"]))},null,8,Rs),D.value.length>1?(o(),n("div",Es,B(T.value+1)+" / "+B(D.value.length),1)):c("",!0),(Z=D.value[T.value])!=null&&Z.note?(o(),n("div",zs,B(D.value[T.value].note),1)):c("",!0)])])):c("",!0),ke(ds,{type:"button",onClick:f,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!$e.value},{default:Le(()=>[X(u).processing?(o(),n("svg",Os,m[19]||(m[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,B(X(u).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),ke(us,{on:X(u).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:Le(()=>m[20]||(m[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),Ce(" Tersimpan. ")])),_:1,__:[20]},8,["on"])]),_:1},8,["disabled"])])):c("",!0)])}}},Ws=Ae(Hs,[["__scopeId","data-v-1fd1424d"]]),Ks={class:"mt-1"},Zs=["value","required","minlength","maxlength","allowSpace","placeholder"],Gs={key:0,class:"mt-2 text-sm text-red-600"},qt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,u=le(()=>{if(!s.modelValue)return"";let p=s.modelValue;switch(s.allowSpace||(p=p.replace(/\s+/g,"")),s.textTransform){case"uppercase":return p.toUpperCase();case"lowercase":return p.toLowerCase();case"capitalize":return p.replace(/\b\w/g,r=>r.toUpperCase());default:return p}}),h=p=>{let r=p.target.value;switch(s.allowSpace||(r=r.replace(/\s+/g,"")),s.textTransform){case"uppercase":r=r.toUpperCase();break;case"lowercase":r=r.toLowerCase();break;case"capitalize":r=r.replace(/\b\w/g,g=>g.toUpperCase());break}x("update:modelValue",r),x("save",s.pointId)};return(p,r)=>(o(),n("div",Ks,[e("input",{value:u.value,onInput:h,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,Zs),t.error?(o(),n("p",Gs,B(t.error),1)):c("",!0)]))}},Ps={class:"mt-1"},Js=["value","required","min","max","step","placeholder"],Xs={key:0,class:"mt-2 text-sm text-red-600"},Ft={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,u=h=>{const p=h.target.value;x("update:modelValue",p),x("save",s.pointId)};return(h,p)=>(o(),n("div",Ps,[e("input",{value:t.modelValue,onInput:u,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Js),t.error?(o(),n("p",Xs,B(t.error),1)):c("",!0)]))}},Ys={class:"mt-1"},Qs=["value","required","min","max"],eo={key:0,class:"mt-2 text-sm text-red-600"},At={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,u=h=>{x("update:modelValue",h.target.value),x("save",s.pointId)};return(h,p)=>(o(),n("div",Ys,[e("input",{value:t.modelValue,onChange:u,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Qs),t.error?(o(),n("p",eo,B(t.error),1)):c("",!0)]))}},to={class:"mt-1"},so=["value","required","placeholder"],oo={key:0,class:"mt-2 text-sm text-red-600"},Rt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,u=w(""),h=le(()=>{var V,C,q,G;return{currency_symbol:((V=s.settings)==null?void 0:V.currency_symbol)||"Rp",thousands_separator:((C=s.settings)==null?void 0:C.thousands_separator)||",",min_value:((q=s.settings)==null?void 0:q.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((G=s.settings)==null?void 0:G.max_value)!==void 0?Number(s.settings.max_value):1e9}}),p=V=>{if(V==null||V==="")return"";const C=Number(V);if(isNaN(C))return"";let q=C.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return h.value.thousands_separator!==","&&(q=q.replace(/,/g,h.value.thousands_separator)),q},r=V=>V?V.replace(/[^\d]/g,""):"",g=le(()=>u.value?`${h.value.currency_symbol} ${p(u.value)}`:""),k=V=>{let C=r(V.target.value),q=Number(C);h.value.min_value!==void 0&&q<h.value.min_value&&(C=h.value.min_value.toString()),h.value.max_value!==void 0&&q>h.value.max_value&&(C=h.value.max_value.toString()),u.value=C,x("update:modelValue",C),x("save",s.pointId)};return he(()=>s.modelValue,V=>{V!=null&&(u.value=V.toString())},{immediate:!0}),(V,C)=>(o(),n("div",to,[e("input",{value:g.value,onInput:k,type:"text",required:t.required,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,so),t.error?(o(),n("p",oo,B(t.error),1)):c("",!0)]))}},ao={class:"mt-1 space-y-3"},no={key:0,class:"space-y-2"},io={class:"flex flex-wrap gap-2"},lo=["onClick"],ro=["value","required","minlength","maxlength","placeholder"],uo={class:"flex justify-between items-center mt-1"},co={class:"text-xs text-gray-500"},go={key:0,class:"text-xs text-red-600"},Et={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,u=w([]),h=w(""),p=V=>u.value.some(C=>C.value===V),r=V=>{p(V.value)?u.value=u.value.filter(b=>b.value!==V.value):u.value.push(V);const q=[...u.value.map(b=>b.value)];h.value.trim()&&q.push(h.value.trim());const G=q.join(", ");x("update:modelValue",G),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:G})},g=V=>{const C=V.target.value;x("update:modelValue",C),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:C}),k(C)},k=V=>{var b,S,a,I;if(!V){u.value=[],h.value="";return}const C=V.split(",").map(y=>y.trim()).filter(y=>y),q=((S=(b=s.settings)==null?void 0:b.damage_options)==null?void 0:S.map(y=>y.value))||[];u.value=((I=(a=s.settings)==null?void 0:a.damage_options)==null?void 0:I.filter(y=>C.includes(y.value)))||[];const G=C.filter(y=>!q.includes(y));h.value=G.join(", ")};return he(()=>s.modelValue,V=>{V!=null&&k(V)},{immediate:!0}),(V,C)=>{var q,G,b;return o(),n("div",ao,[(q=t.settings)!=null&&q.enable_damage&&((G=t.settings)!=null&&G.damage_options)?(o(),n("div",no,[C[0]||(C[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",io,[(o(!0),n(Ve,null,Me(t.settings.damage_options,(S,a)=>(o(),n("button",{key:a,type:"button",onClick:I=>r(S),class:ne(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":p(S.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!p(S.value)}])},B(S.label),11,lo))),128))])])):c("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:g,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,ro),e("div",uo,[e("span",co,B(((b=t.modelValue)==null?void 0:b.length)||0)+"/"+B(t.maxLength||400),1),t.error?(o(),n("p",go,B(t.error),1)):c("",!0)])])])}}},mo={class:"mt-1"},po=["value","required"],vo={key:0,class:"mt-2 text-sm text-red-600"},fo={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Y}){const s=t,x=Y,u=h=>{x("update:modelValue",h.target.value),x("save",s.pointId)};return(h,p)=>(o(),n("div",mo,[e("select",{value:t.modelValue,onChange:u,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},p[0]||(p[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,po),t.error?(o(),n("p",vo,B(t.error),1)):c("",!0)]))}},ho=Ae(fo,[["__scopeId","data-v-1b6c0201"]]),bo={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},yo={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},xo={class:"text-xs text-gray-500 mt-2 text-center"},wo={class:"flex flex-row space-x-4 mb-6"},ko={class:"mt-4 text-right"},$o={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(Y,s)=>t.show?(o(),n("div",bo,[e("div",yo,[s[7]||(s[7]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),e("p",xo,[s[3]||(s[3]=Ce("Ambil Foto Maksimal: ")),e("b",null,B(t.settings.max_files),1),s[4]||(s[4]=Ce(" Dengan Rasio & Ukuran: ")),e("b",null,B(t.settings.camera_aspect_ratio),1)]),e("div",wo,[e("button",{onClick:s[0]||(s[0]=x=>Y.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:s[1]||(s[1]=x=>Y.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",ko,[e("button",{onClick:s[2]||(s[2]=x=>Y.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):c("",!0)}},Co={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Io={class:"webcam-content-box"},So={class:"webcam-header"},_o={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},Vo={class:"inspection-point-name"},Mo={key:0,class:"screen-flash-overlay"},Uo={key:2,class:"zoom-controls"},Do=["max"],jo={class:"webcam-footer"},To={class:"camera-controls"},No=["disabled"],Lo={class:"camera-icon-container"},Bo={key:0,class:"camera-spinner"},qo={key:1,class:"camera-body"},Fo={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:Y}){const s=t,x=Y,u=w(null),h=w(null);let p=null,r=null;const g=w("environment"),k=w(!1),V=w(!1),C=w(!1),q=w(!1),G=w(!1),b=w({}),S=w(!1),a=w(1),I=w(1),y=w(!1),D=le(()=>{var A;return((A=s.settings)==null?void 0:A.max_size)||2048}),K=le(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),T=le(()=>{if(!s.aspectRatio)return{};const A=s.aspectRatio,H=A>1?80:60,ie=A>1?80/A:60*A;return{width:`${H}%`,height:`${ie}%`}}),te=async()=>{p&&p.getTracks().forEach(A=>A.stop());try{const A={facingMode:g.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};p=await navigator.mediaDevices.getUserMedia({video:A,audio:!1}),r=p.getVideoTracks()[0],u.value.srcObject=p,u.value.onloadedmetadata=async()=>{await N(),await u.value.play()}}catch(A){console.error("Error accessing camera: ",A),alert("Failed to access camera. Please allow camera permission."),x("close")}},Q=()=>{p&&p.getTracks().forEach(A=>A.stop()),x("close")},N=async()=>{if(r)try{const A=await navigator.mediaDevices.enumerateDevices();k.value=A.filter(ie=>ie.kind==="videoinput").length>1;const H=r.getCapabilities();H.zoom?(y.value=!0,I.value=H.zoom.max,console.log(`Zoom supported. Max zoom: ${I.value}`)):(y.value=!1,console.warn("Zoom is not supported by this camera.")),V.value=H.torch||H.fillLightMode&&H.fillLightMode.includes("torch")}catch(A){console.error("Error checking camera capabilities:",A)}},M=async A=>{if(!r)return;const H=u.value.getBoundingClientRect(),ie=A.clientX-H.left,re=A.clientY-H.top;G.value=!0,b.value={left:`${ie}px`,top:`${re}px`,transform:"translate(-50%, -50%)"};try{if(r.getCapabilities().pointsOfInterest){const de=ie/H.width,ue=re/H.height;await r.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:de,y:ue}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(me){console.warn("Manual focus failed:",me)}setTimeout(()=>{G.value=!1,r.getCapabilities().focusMode.includes("continuous")&&r.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},z=async A=>{if(!r||!y.value)return;const H=Math.min(Math.max(A,1),I.value);a.value=H;try{await r.applyConstraints({advanced:[{zoom:H}]})}catch(ie){console.error("Failed to set zoom:",ie)}},P=async()=>{if(!(!r||!V.value))try{g.value==="user"?(C.value=!C.value,q.value=C.value):(await r.applyConstraints({advanced:[{torch:!C.value}]}),C.value=!C.value)}catch(A){console.error("Flash toggle failed:",A)}},ge=async()=>{k.value&&(g.value=g.value==="environment"?"user":"environment",p&&p.getTracks().forEach(A=>A.stop()),await te())},Ie=async A=>new Promise(H=>{const ie=D.value*1024;if(A.size<=ie){H(A);return}const re=new Image,me=new FileReader;me.onload=de=>{re.onload=()=>{const ue=document.createElement("canvas"),be=ue.getContext("2d"),L=Math.sqrt(ie/A.size);ue.width=re.width*L,ue.height=re.height*L,be.drawImage(re,0,0,ue.width,ue.height);let ye=.9;const fe=()=>{ue.toBlob(d=>{d.size>ie&&ye>.1?(ye-=.1,fe()):H(d)},"image/jpeg",ye)};fe()},re.src=de.target.result},me.readAsDataURL(A)}),$e=async()=>{if(!(S.value||!u.value||!h.value)){S.value=!0;try{const A=u.value,H=h.value,ie=A.videoWidth,re=A.videoHeight;let me,de,ue,be;ie/re>s.aspectRatio?(de=re,me=re*s.aspectRatio,ue=(ie-me)/2,be=0):(me=ie,de=ie/s.aspectRatio,ue=0,be=(re-de)/2),H.width=me,H.height=de,H.getContext("2d").drawImage(A,ue,be,me,de,0,0,me,de);const ye=await new Promise(d=>{H.toBlob(d,"image/jpeg",1)}),fe=await Ie(ye);if(fe){const d=new File([fe],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});x("photoCaptured",d),q.value=!0,setTimeout(()=>{q.value=!1},100)}}catch(A){console.error("Error capturing photo:",A),alert("Failed to capture photo. Please try again.")}finally{S.value=!1}}};return he(()=>s.show,A=>{A?te():Q()}),mt(()=>{p&&p.getTracks().forEach(A=>A.stop())}),(A,H)=>{var ie;return t.show?(o(),n("div",Co,[e("div",Io,[e("div",So,[e("p",_o,B(t.settings.camera_aspect_ratio),1),e("div",Vo,B(((ie=t.point)==null?void 0:ie.name)||"Camera"),1),e("button",{onClick:Q,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},H[2]||(H[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:Fe(K.value),onClick:M,onTouchstart:M},[e("video",{ref_key:"webcamVideo",ref:u,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:h,class:"hidden"},null,512),q.value?(o(),n("div",Mo)):c("",!0),e("div",{class:"aspect-ratio-guide",style:Fe(T.value)},null,4),G.value?(o(),n("div",{key:1,class:"focus-indicator",style:Fe(b.value)},H[3]||(H[3]=[e("div",{class:"focus-ring"},null,-1)]),4)):c("",!0),H[4]||(H[4]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),y.value?(o(),n("div",Uo,[Ne(e("input",{type:"range",min:"1",max:I.value,step:"0.1","onUpdate:modelValue":H[0]||(H[0]=re=>a.value=re),onInput:H[1]||(H[1]=re=>z(parseFloat(re.target.value))),class:"zoom-slider"},null,40,Do),[[Pe,a.value]])])):c("",!0)],36),e("div",jo,[e("div",To,[t.settings.enable_flash&&V.value?(o(),n("button",{key:0,onClick:P,class:ne(["control-button",{active:C.value,disabled:!V.value}])},H[5]||(H[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):c("",!0),e("button",{onClick:$e,class:"capture-button",disabled:S.value},[e("div",Lo,[S.value?(o(),n("div",Bo)):(o(),n("div",qo,H[6]||(H[6]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,No),t.settings.enable_camera_switch&&k.value?(o(),n("button",{key:1,onClick:ge,class:"control-button"},H[7]||(H[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):c("",!0)])])])])):c("",!0)}}},Ao=Ae(Fo,[["__scopeId","data-v-d307c818"]]),Ro={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Eo={class:"w-full h-full flex flex-col"},zo={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Oo=["disabled"],Ho={class:"text-lg font-semibold"},Wo={class:"flex items-center gap-2"},Ko=["disabled"],Zo=["disabled"],Go={key:0,class:"bg-blue-900 bg-opacity-50 text-white p-3"},Po={class:"flex items-center justify-between mb-2"},Jo={class:"text-xs"},Xo={class:"w-full bg-blue-700 bg-opacity-50 rounded-full h-2"},Yo={class:"text-xs mt-1 text-blue-300"},Qo={class:"flex-1 flex items-center justify-center overflow-hidden relative"},ea=["src"],ta={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},sa={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},oa=["disabled"],aa=["disabled"],na=["disabled"],ia={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},la={class:"flex justify-between items-center w-full"},ra=["disabled"],da={key:1,class:"flex-1"},ua=["disabled"],ca={class:"flex gap-3 w-full"},ga={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},ma={class:"flex items-center gap-2"},pa={key:0,class:"text-center"},va={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images","retryImage"],setup(t,{emit:Y}){const s=t,x=Y,u=w(0),h=w([]),p=le(()=>h.value.length>0?h.value[u.value]:null);he(()=>s.images,I=>{h.value=I.map(y=>({...y,rotation:y.rotation||0})),I.length===0&&s.show&&q()},{deep:!0,immediate:!0}),he(()=>s.show,I=>{I&&s.images.length>0&&(u.value=s.initialIndex)}),he(()=>s.uploadProgress,I=>{I===100&&console.log("Upload completed")});const r=I=>I.preview||(I.image_path?`/${I.image_path}`:""),g=()=>{if(p.value&&!s.isUploading){const I=(p.value.rotation+90)%360;h.value[u.value].rotation=I,x("update:images",h.value)}},k=()=>{s.isUploading||(u.value=u.value<h.value.length-1?u.value+1:0)},V=()=>{s.isUploading||(u.value=u.value>0?u.value-1:h.value.length-1)},C=()=>{s.isUploading||x("saveImages",h.value)},q=()=>{s.isUploading||x("close")},G=()=>{if(p.value&&!s.isUploading){const I=p.value,y=h.value.findIndex(D=>D.isNew&&I.isNew&&D.preview===I.preview||!D.isNew&&!I.isNew&&D.id===I.id);y!==-1&&(x("removePreviewImage",I),h.value.splice(y,1),x("update:images",h.value)),u.value>=h.value.length&&(u.value=Math.max(0,h.value.length-1)),h.value.length===0&&x("close")}},b=()=>{s.isUploading||x("triggerAddMorePhotos")},S=()=>{p.value&&!s.isUploading&&x("retryImage",p.value)},a=I=>{I.key==="Escape"&&!s.isUploading&&q()};return at(()=>{document.addEventListener("keydown",a)}),mt(()=>{document.removeEventListener("keydown",a)}),(I,y)=>{var D;return t.show?(o(),n("div",Ro,[e("div",Eo,[e("div",zo,[e("button",{onClick:q,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},y[0]||(y[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Oo),e("div",Ho,B(((D=t.point)==null?void 0:D.name)||"Preview")+" ("+B(u.value+1)+"/"+B(h.value.length)+") ",1),e("div",Wo,[p.value&&p.value.isNew?(o(),n("button",{key:0,onClick:G,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:t.isUploading},y[1]||(y[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,Ko)):c("",!0),p.value&&p.value.isNew?(o(),n("button",{key:1,onClick:g,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},y[2]||(y[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,Zo)):c("",!0)])]),t.isUploading?(o(),n("div",Go,[e("div",Po,[y[3]||(y[3]=e("span",{class:"text-sm font-medium"},"Mengupload gambar...",-1)),e("span",Jo,B(t.uploadProgress)+"%",1)]),e("div",Xo,[e("div",{class:"bg-blue-400 h-2 rounded-full transition-all duration-300",style:Fe({width:t.uploadProgress+"%"})},null,4)]),e("p",Yo,B(t.currentUpload)+"/"+B(t.totalUpload)+" gambar terupload",1)])):c("",!0),e("div",Qo,[e("div",{class:"relative w-full max-w-full",style:Fe({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"})},[p.value?(o(),n("img",{key:0,src:r(p.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Fe({transform:`rotate(${p.value.rotation}deg)`})},null,12,ea)):c("",!0),p.value&&p.value.isUploading?(o(),n("div",ta,y[4]||(y[4]=[e("div",{class:"text-center text-white"},[e("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e("p",{class:"text-sm"},"Mengupload...")],-1)]))):c("",!0),p.value&&p.value.isFailed?(o(),n("div",sa,[y[5]||(y[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),y[6]||(y[6]=e("p",{class:"text-lg font-medium mb-2"},"Upload Gagal",-1)),e("button",{onClick:S,class:"px-4 py-2 bg-white text-red-600 rounded-lg font-medium hover:bg-gray-100 transition-colors",disabled:t.isUploading}," Coba Lagi ",8,oa)])):c("",!0)],4),h.value.length>1&&!t.isUploading?(o(),n("button",{key:0,onClick:V,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},y[7]||(y[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,aa)):c("",!0),h.value.length>1&&!t.isUploading?(o(),n("button",{key:1,onClick:k,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},y[8]||(y[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,na)):c("",!0)]),e("div",ia,[e("div",la,[p.value&&!p.value.isNew?(o(),n("button",{key:0,onClick:G,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},y[9]||(y[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ce(" Hapus Foto ")]),8,ra)):(o(),n("div",da)),t.allowMultiple&&h.value.length<t.maxFiles&&!t.isUploading?(o(),n("button",{key:2,onClick:b,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},y[10]||(y[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Ce(" Tambah Foto ")]),8,ua)):c("",!0)]),e("div",ca,[t.isUploading?(o(),n("button",ga,[e("div",ma,[y[11]||(y[11]=e("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),e("span",null,"Mengupload... "+B(t.uploadProgress)+"%",1)])])):(o(),n("button",{key:0,onClick:C,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),t.isUploading?(o(),n("div",pa,y[12]||(y[12]=[e("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):c("",!0)])])])):c("",!0)}}},fa=Ae(va,[["__scopeId","data-v-581782f4"]]),ha=["accept","multiple","disabled"],ba={class:"text-xs text-gray-500 mb-2"},ya=["disabled"],xa={class:"h-full flex flex-col items-center justify-center p-4 text-center"},wa={class:"text-xs text-gray-400 mt-1"},ka={key:0,class:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},$a={class:"flex items-center justify-between mb-2"},Ca={class:"text-xs text-blue-600"},Ia={class:"w-full bg-blue-200 rounded-full h-2"},Sa={class:"text-xs text-blue-600 mt-1"},_a={key:1,class:"flex items-center gap-4"},Va=["src"],Ma={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Ua=["disabled"],Da={key:2,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ja=["disabled"],Ta=["onClick"],Na=["src"],La={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ba={key:0},qa={key:1,class:"ml-1"},Fa={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Aa={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},Ra={key:2,class:"mt-1 text-xs text-red-600"},Ea={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(t,{emit:Y}){const s=t,x=Y,u=w(null),h=w(null),p=w(!1),r=w(!1),g=w(!1),k=w([]),V=w(0),C=w(!1),q=w(0),G=w(0),b=w(0),S=as("imageSourceSetting",w("all")),a=`inspection-${s.inspectionId}-point-${s.pointId}-backup`,I=le(()=>Number(s.settings.max_files)>1),y=le(()=>s.settings.allowed_types.map(d=>`.${d}`).join(", ")),D=le(()=>{const d=s.settings.camera_aspect_ratio.split(":");if(d.length===2){const _=parseFloat(d[0]),f=parseFloat(d[1]);if(!isNaN(_)&&!isNaN(f)&&f!==0)return _/f}return 3/4}),K=le(()=>{const d=[],_=new Set;for(const f of s.modelValue)f.id&&_.add(f.id),d.push({...f,rotation:f.rotation||0,isNew:!1,isUploaded:!0,preview:f.preview||(f.image_path?`/${f.image_path}`:null)});for(const f of k.value)f.id&&_.add(f.id),d.push({...f,isUploading:f.isUploading||!1});return d}),T=d=>d.preview||(d.image_path?`/${d.image_path}`:""),te=()=>{g.value&&(g.value=!1),S.value==="camera"?N():S.value==="gallery"?Q():p.value=!0},Q=()=>{p.value=!1,u.value.click()},N=()=>{p.value=!1,r.value=!0},M=()=>{p.value=!1,K.value.length>0&&(g.value=!0)},z=()=>{r.value=!1,K.value.length>0&&(g.value=!0)},P=()=>{g.value=!1,C.value||(k.value.forEach(d=>{d.preview&&d.preview.startsWith("blob:")&&URL.revokeObjectURL(d.preview)}),k.value=[])},ge=d=>new Promise(_=>{const f=new FileReader;f.onload=U=>{const E=new Image;E.onload=()=>{_({file:d,preview:URL.createObjectURL(d),rotation:0,width:E.naturalWidth,height:E.naturalHeight,isNew:!0})},E.onerror=()=>{console.error("Failed to load image for dimensions:",d.name),_({file:d,preview:URL.createObjectURL(d),rotation:0,width:0,height:0,isNew:!0})},E.src=U.target.result},f.readAsDataURL(d)}),Ie=d=>{const _=d.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(_)},$e=async d=>{const f=(s.settings.max_size||2048)*1024;return new Promise(U=>{const E=new Image,se=new FileReader;se.onload=O=>{E.onload=()=>{const oe=document.createElement("canvas"),ee=oe.getContext("2d"),$=Math.max(E.width,E.height);oe.width=$,oe.height=$,ee.fillStyle="white",ee.fillRect(0,0,$,$);const m=($-E.width)/2,Z=($-E.height)/2;ee.drawImage(E,m,Z,E.width,E.height);let W=.9;const F=()=>{oe.toBlob(pe=>{if(pe.size>f&&W>.1)W-=.1,F();else{const xe=new File([pe],d.name,{type:"image/jpeg",lastModified:Date.now()});U(xe)}},"image/jpeg",W)};F()},E.src=O.target.result},se.readAsDataURL(d)})},A=async d=>{const _=Array.from(d.target.files);if(!_.length){p.value=!1,K.value.length>0&&(g.value=!0);return}try{const f=_.filter(ee=>!Ie(ee));if(f.length>0){const ee=f.map($=>$.name.split(".").pop()).join(", ");alert(`File type not allowed: ${ee}. Allowed types: ${s.settings.allowed_types.join(", ")}`),d.target.value="";return}const U=K.value.length,E=s.settings.max_files-U,se=await Promise.all(_.slice(0,E).map(async ee=>await $e(ee))),O=await Promise.all(se.map(ge)),oe=I.value?O:O.slice(0,1);I.value?k.value.push(...oe):(k.value.forEach(ee=>{ee.preview&&ee.preview.startsWith("blob:")&&URL.revokeObjectURL(ee.preview)}),k.value=oe),p.value=!1,oe.length>0?(V.value=Math.max(0,K.value.length-oe.length),g.value=!0):K.value.length>0&&(g.value=!0),d.target.value=""}catch(f){console.error("Error processing selected images:",f),alert("Failed to process selected images. Please try again."),p.value=!1,K.value.length>0&&(g.value=!0)}},H=async d=>{const _=K.value.length;if(!I.value||_<s.settings.max_files)try{const f=await $e(d),U=new Image;U.onload=()=>{const E={file:f,preview:URL.createObjectURL(f),rotation:0,width:U.naturalWidth,height:U.naturalHeight,isNew:!0};I.value?k.value.push(E):(k.value.forEach(se=>{se.preview&&se.preview.startsWith("blob:")&&URL.revokeObjectURL(se.preview)}),k.value=[E]),r.value=!1,p.value=!1,V.value=K.value.length-1,g.value=!0},U.src=URL.createObjectURL(f)}catch(f){console.error("Error processing captured image:",f),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),r.value=!1,p.value=!1,K.value.length>0&&(g.value=!0)},ie=(d=0)=>{V.value=d,g.value=!0},re=d=>new Promise(_=>{if(d.rotation===0||!h.value){if(!d.isNew&&!d.file){_({file:null,width:d.width,height:d.height,isOriginal:!0});return}_({file:d.file,width:d.width,height:d.height});return}const f=new Image;f.onload=async()=>{try{const U=h.value,E=U.getContext("2d"),se=f.width,O=f.height;let oe,ee;d.rotation===90||d.rotation===270?(oe=O,ee=se):(oe=se,ee=O),U.width=oe,U.height=ee,E.clearRect(0,0,U.width,U.height),E.translate(U.width/2,U.height/2),E.rotate(d.rotation*Math.PI/180),E.drawImage(f,-se/2,-O/2,se,O),E.setTransform(1,0,0,1,0,0);const $=await new Promise(W=>{U.toBlob(W,"image/jpeg",.9)}),m=new File([$],d.file?d.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),Z=await $e(m);_({file:Z,width:oe,height:ee})}catch(U){console.error("Error processing rotated image:",U),_({file:d.file,width:d.width,height:d.height})}},f.onerror=()=>{console.error("Failed to load image for rotation processing:",d.preview),_({file:d.file,width:d.width,height:d.height})},f.src=d.preview}),me=d=>{try{const _={images:d.map(f=>{var U;return{fileName:((U=f.file)==null?void 0:U.name)||`image-${Date.now()}.jpg`,rotation:f.rotation||0,width:f.width||0,height:f.height||0,timestamp:Date.now()}}),inspectionId:s.inspectionId,pointId:s.pointId};localStorage.setItem(a,JSON.stringify(_))}catch(_){console.error("Error saving backup:",_)}},de=()=>{localStorage.removeItem(a)},ue=async d=>{C.value=!0;const _=[],f=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),C.value=!1;return}try{me(d);for(const U of d){if(!U.isNew&&U.rotation===0&&U.id&&U.image_path){_.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:0,preview:U.preview,isUploaded:!0});continue}const{file:E,width:se,height:O,isOriginal:oe}=await re(U);if(oe&&!U.isNew){_.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:U.rotation||0,preview:U.preview,isUploaded:!0});continue}E&&f.push({file:E,width:se,height:O,rotation:U.rotation||0,originalImage:U})}P(),f.length>0?await be(f,_):(x("update:modelValue",_),x("save",s.pointId))}catch(U){console.error("Error during image processing:",U),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{C.value=!1}},be=async(d,_)=>{b.value=d.length,G.value=0,q.value=0;const f=[..._];let U=0;try{for(let E=0;E<d.length;E++){const se=d[E],O=new FormData;O.append("inspection_id",s.inspectionId),O.append("point_id",s.pointId),O.append("images[]",se.file);const oe=k.value.findIndex(ee=>{var $;return ee.preview===(($=se.originalImage)==null?void 0:$.preview)});oe!==-1&&(k.value[oe].isUploading=!0,k.value[oe].isFailed=!1);try{const $=(await ut.post(route("inspections.upload-image"),O,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:m=>{if(m.total){const Z=Math.round(m.loaded*100/m.total);q.value=Math.round((E+m.loaded/m.total)/d.length*100),G.value=E+1}}})).data.images;if($&&$.length>0){const m=$[0];if(f.push({id:m.image_id,image_path:m.path,width:m.width||se.width||0,height:m.height||se.height||0,rotation:se.rotation||0,preview:m.public_url,isUploaded:!0}),oe!==-1){const Z=k.value.splice(oe,1)[0];Z.preview&&Z.preview.startsWith("blob:")&&URL.revokeObjectURL(Z.preview)}U++}}catch(ee){console.error(`Error uploading image ${E+1}:`,ee),oe!==-1&&(k.value[oe].isUploading=!1,k.value[oe].isFailed=!0)}}U>0&&(x("update:modelValue",f),x("save",s.pointId),x("uploaded",{pointId:s.pointId,images:f,newImagesCount:U})),U===d.length&&de(),console.log(`✅ Successfully uploaded ${U}/${d.length} images`)}catch(E){console.error("Error in upload process:",E),d.forEach(se=>{const O=k.value.findIndex(oe=>{var ee;return oe.preview===((ee=se.originalImage)==null?void 0:ee.preview)});O!==-1&&(k.value[O].isUploading=!1,k.value[O].isFailed=!0)})}finally{q.value=0,G.value=0,b.value=0,C.value=!1}},L=async d=>{if(!d||!d.file){console.error("No file to retry upload");return}C.value=!0;const _=[...s.modelValue];try{const f=new FormData;f.append("inspection_id",s.inspectionId),f.append("point_id",s.pointId),f.append("images[]",d.file);const U=k.value.findIndex(O=>O.preview===d.preview);U!==-1&&(k.value[U].isUploading=!0,k.value[U].isFailed=!1);const se=(await ut.post(route("inspections.upload-image"),f,{headers:{"Content-Type":"multipart/form-data"}})).data.images;if(se&&se.length>0){const O=se[0];if(_.push({id:O.image_id,image_path:O.path,width:O.width||d.width||0,height:O.height||d.height||0,rotation:d.rotation||0,preview:O.public_url,isUploaded:!0}),U!==-1){const ee=k.value.splice(U,1)[0];ee.preview&&ee.preview.startsWith("blob:")&&URL.revokeObjectURL(ee.preview)}x("update:modelValue",_),x("save",s.pointId),x("uploaded",{pointId:s.pointId,images:_,newImagesCount:1}),k.value.some(ee=>ee.isFailed)||de(),console.log("✅ Successfully retried upload for 1 image")}}catch(f){console.error("Error retrying upload:",f),previewIndex!==-1&&(k.value[previewIndex].isUploading=!1,k.value[previewIndex].isFailed=!0)}finally{C.value=!1}},ye=d=>{if(d){if(d.id&&!d.isNew)fe(d);else{const _=k.value.findIndex(f=>f.preview&&f.preview===d.preview&&f.isNew||f.id&&f.id===d.id);if(_!==-1){const f=k.value.splice(_,1)[0];f.preview&&f.preview.startsWith("blob:")&&URL.revokeObjectURL(f.preview)}x("update:modelValue",s.modelValue.filter(f=>!(f.id&&f.id===d.id)&&!(f.preview&&f.preview===d.preview)))}V.value>=K.value.length&&(V.value=Math.max(0,K.value.length-1)),K.value.length===0&&P()}},fe=async d=>{var f,U;if(d.id||d.image_path)try{await ut.delete(route("inspections.delete-image"),{data:{image_id:d.id,image_path:d.image_path}})}catch(E){console.error("Error deleting image from server:",E),(U=(f=E.response)==null?void 0:f.data)!=null&&U.message?alert(`Failed to delete image from server: ${E.response.data.message}`):alert(`Failed to delete image from server: ${E.message}`);return}d.preview&&d.preview.startsWith("blob:")&&URL.revokeObjectURL(d.preview);const _=s.modelValue.filter(E=>E.id!==d.id);x("update:modelValue",_),k.value=k.value.filter(E=>E.isNew&&d.isNew?E.preview!==d.preview:E.id!==d.id),x("removeImage",{image:d}),g.value&&K.value.length===0?P():g.value&&V.value>=K.value.length&&(V.value=Math.max(0,K.value.length-1))};return at(()=>{try{localStorage.getItem(a)&&console.log("Found backup images, ready for recovery if needed")}catch(d){console.error("Error loading backup:",d)}}),(d,_)=>(o(),n("div",null,[e("input",{ref_key:"galleryInput",ref:u,type:"file",accept:y.value,class:"hidden",onChange:A,multiple:I.value,disabled:C.value},null,40,ha),e("canvas",{ref_key:"processingCanvas",ref:h,class:"hidden"},null,512),e("p",ba,"Foto Maksimal: "+B(t.settings.max_files)+" | Rasio: "+B(t.settings.camera_aspect_ratio),1),K.value.length===0?(o(),n("label",{key:0,onClick:te,class:ne(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:C.value},[e("div",xa,[_[2]||(_[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),_[3]||(_[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),e("p",wa,"Tipe: "+B(y.value),1)])],8,ya)):(o(),n("div",{key:1,class:ne(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[C.value?(o(),n("div",ka,[e("div",$a,[_[4]||(_[4]=e("span",{class:"text-sm font-medium text-blue-700"},"Mengupload gambar...",-1)),e("span",Ca,B(q.value)+"%",1)]),e("div",Ia,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Fe({width:q.value+"%"})},null,4)]),e("p",Sa,B(G.value)+"/"+B(b.value)+" gambar terupload",1)])):c("",!0),t.settings.max_files===1?(o(),n("div",_a,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:_[0]||(_[0]=f=>ie(0))},[e("img",{src:T(K.value[0]),class:"w-full h-full object-cover"},null,8,Va),K.value[0].isUploading?(o(),n("div",Ma,_[5]||(_[5]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0)]),e("button",{onClick:_[1]||(_[1]=st(f=>fe(K.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:C.value},_[6]||(_[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ce(" Hapus Foto ")]),8,Ua)])):(o(),n("div",Da,[I.value&&K.value.length<t.settings.max_files?(o(),n("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:te,disabled:C.value},_[7]||(_[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,ja)):c("",!0),(o(!0),n(Ve,null,Me(K.value,(f,U)=>(o(),n("div",{key:f.id||f.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:E=>f.isFailed?L(f):ie(U)},[e("img",{src:T(f),class:"w-full h-full object-cover"},null,8,Na),f.isNew||f.rotation!==0?(o(),n("div",La,[f.isNew?(o(),n("span",Ba,"BARU")):c("",!0),f.rotation!==0?(o(),n("span",qa,"ROTASI")):c("",!0)])):c("",!0),f.isUploading?(o(),n("div",Fa,_[8]||(_[8]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0),f.isFailed?(o(),n("div",Aa,_[9]||(_[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),e("span",{class:"text-xs font-medium"},"Retry",-1)]))):c("",!0)],8,Ta))),128))]))],2)),t.error?(o(),n("p",Ra,B(t.error),1)):c("",!0),ke($o,{show:p.value,settings:t.settings,onClose:M,onOpenWebcam:N,onTriggerGallery:Q},null,8,["show","settings"]),ke(Ao,{show:r.value,"aspect-ratio":D.value,settings:t.settings,point:t.point,onClose:z,onPhotoCaptured:H},null,8,["show","aspect-ratio","settings","point"]),ke(fa,{show:g.value,images:K.value,point:t.point,"initial-index":V.value,"allow-multiple":I.value,"max-files":t.settings.max_files,"is-uploading":C.value,"aspect-ratio":D.value,"upload-progress":q.value,"current-upload":G.value,"total-upload":b.value,onClose:P,onSaveImages:ue,onRemovePreviewImage:ye,onTriggerAddMorePhotos:te,onRetryImage:L},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},gt=Ae(Ea,[["__scopeId","data-v-a1838a9b"]]),za={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Oa={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Ha={class:"px-4 pb-2 border-b border-gray-200"},Wa={class:"text-lg font-semibold text-gray-900"},Ka={key:0,class:"text-sm text-gray-500 mt-1"},Za={class:"flex-1 overflow-y-auto p-4"},Ga={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Pa={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},setup(t){return(Y,s)=>(o(),De(ot,{name:"bottom-sheet"},{default:Le(()=>[t.show?(o(),n("div",za,[s[1]||(s[1]=e("div",{class:"absolute inset-0 bg-black bg-opacity-50"},null,-1)),e("div",Oa,[s[0]||(s[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Ha,[e("h3",Wa,B(t.title),1),t.subtitle?(o(),n("p",Ka,B(t.subtitle),1)):c("",!0)]),e("div",Za,[Ut(Y.$slots,"default",{},void 0,!0)]),Y.$slots.footer?(o(),n("div",Ga,[Ut(Y.$slots,"footer",{},void 0,!0)])):c("",!0)])])):c("",!0)]),_:3}))}},zt=Ae(Pa,[["__scopeId","data-v-fd942535"]]),Ja={class:"space-y-4"},Xa={key:0,class:"mt-2"},Ya={key:1,class:"mt-2"},Qa={key:2,class:"mt-2"},en={key:3,class:"mt-2"},tn={key:4,class:"mt-2"},sn={class:"text-sm font-medium text-gray-700 mb-2"},on={key:0,class:"text-red-500"},an={key:0,class:"text-xs text-red-500"},nn=["name","value","checked"],ln={key:6,class:"space-y-2"},rn={key:0,class:"text-red-500"},dn={key:1,class:"text-xs text-red-500"},un={key:7,class:"mt-4"},cn={class:"text-sm font-medium text-gray-700 mb-2"},gn={key:0,class:"text-red-500"},mn={key:0,class:"text-xs text-red-500"},pn={class:"flex gap-2"},vn=["disabled"],pt={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(t,{emit:Y}){const s=t,x=Y,u=r=>x("hapus",r),h=le(()=>s.options.find(r=>r.value===s.selectedValue)),p=le(()=>{var g,k,V,C,q,G,b;if(s.point.input_type==="text"&&(!((g=s.notesValue)!=null&&g.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((k=s.notesValue)!=null&&k.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((V=s.notesValue)!=null&&V.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!((C=s.notesValue)!=null&&C.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date))return!1;if(s.point.input_type==="imageTOradio"){if(s.imagesValue.length===0)return!1;const S=s.imagesValue.some(I=>I.status==="error"),a=s.imagesValue.some(I=>I.status==="uploading");if(S||a)return!1}if(s.options.length&&!s.selectedValue)return!1;const r=h.value;if(s.showTextarea&&((q=r==null?void 0:r.settings)!=null&&q.show_textarea)&&(!((G=s.notesValue)!=null&&G.trim())||r.settings.min_length&&s.notesValue.length<r.settings.min_length||r.settings.max_length&&s.notesValue.length>r.settings.max_length))return!1;if(s.showImageUpload&&((b=r==null?void 0:r.settings)!=null&&b.show_image_upload)){if(s.imagesValue.length===0||r.settings.max_files&&s.imagesValue.length>r.settings.max_files)return!1;const S=s.imagesValue.some(I=>I.status==="error"),a=s.imagesValue.some(I=>I.status==="uploading");if(S||a)return!1}return!0});return(r,g)=>(o(),De(zt,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:g[18]||(g[18]=k=>r.$emit("close"))},{footer:Le(()=>[t.selectedPoint?(o(),n("button",{key:0,onClick:g[15]||(g[15]=k=>u(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},g[20]||(g[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),Ce(" Hapus Data ")]))):c("",!0),e("div",pn,[e("button",{type:"button",onClick:g[16]||(g[16]=k=>r.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:g[17]||(g[17]=k=>r.$emit("save")),disabled:!p.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,vn)])]),default:Le(()=>{var k,V,C,q,G,b,S,a,I,y,D,K,T,te,Q,N,M,z,P,ge,Ie,$e,A,H,ie,re,me,de,ue,be;return[e("div",Ja,[t.point.input_type==="text"?(o(),n("div",Xa,[ke(qt,{"model-value":t.notesValue,required:(k=t.point.settings)==null?void 0:k.is_required,"min-length":(V=t.point.settings)==null?void 0:V.min_length,"max-length":(C=t.point.settings)==null?void 0:C.max_length,allowSpace:(q=t.point.settings)==null?void 0:q.allow_space,textTransform:(G=t.point.settings)==null?void 0:G.text_transform,placeholder:((b=t.point.settings)==null?void 0:b.placeholder)||"Masukan text",error:r.error,"onUpdate:modelValue":g[0]||(g[0]=L=>r.$emit("update:notesValue",L)),onSave:g[1]||(g[1]=L=>r.$emit("saveText",L))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):c("",!0),t.point.input_type==="number"?(o(),n("div",Ya,[ke(Ft,{"model-value":t.notesValue,required:(S=t.point.settings)==null?void 0:S.is_required,min:(a=t.point.settings)==null?void 0:a.min,max:(I=t.point.settings)==null?void 0:I.max,step:((y=t.point.settings)==null?void 0:y.step)||1,placeholder:((D=t.point.settings)==null?void 0:D.placeholder)||"Masukan number",error:r.error,"onUpdate:modelValue":g[2]||(g[2]=L=>r.$emit("update:notesValue",L)),onSave:g[3]||(g[3]=L=>r.$emit("saveNumber",L))},null,8,["model-value","required","min","max","step","placeholder","error"])])):c("",!0),t.point.input_type==="account"?(o(),n("div",Qa,[ke(Rt,{"model-value":t.notesValue,required:(K=t.point.settings)==null?void 0:K.is_required,placeholder:((T=t.point.settings)==null?void 0:T.placeholder)||"Masukkan nilai",error:r.error,"point-id":t.pointId,settings:t.point.settings,"onUpdate:modelValue":g[4]||(g[4]=L=>r.$emit("update:notesValue",L)),onSave:g[5]||(g[5]=L=>r.$emit("saveAccount",L))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):c("",!0),t.point.input_type==="date"?(o(),n("div",en,[ke(At,{"model-value":t.notesValue,required:(te=t.point.settings)==null?void 0:te.is_required,"min-date":(Q=t.point.settings)==null?void 0:Q.min_date,"max-date":(N=t.point.settings)==null?void 0:N.max_date,error:r.error,"onUpdate:modelValue":g[6]||(g[6]=L=>r.$emit("update:notesValue",L)),onSave:g[7]||(g[7]=L=>r.$emit("saveDate",L))},null,8,["model-value","required","min-date","max-date","error"])])):c("",!0),t.point.input_type==="imageTOradio"?(o(),n("div",tn,[e("h4",sn,[(M=t.point.settings)!=null&&M.required?(o(),n("span",on,"*")):c("",!0)]),ke(gt,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point.inspection_point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":g[8]||(g[8]=L=>r.$emit("update:imagesValue",L)),onSave:g[9]||(g[9]=L=>r.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(z=t.point.settings)!=null&&z.required&&t.imagesValue.length===0?(o(),n("p",an," Foto wajib diupload ")):c("",!0)])):c("",!0),t.options.length?(o(),n("div",{key:5,class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Ve,null,Me(t.options,(L,ye)=>(o(),n("label",{key:ye,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:L.value,checked:t.selectedValue===L.value,onChange:g[10]||(g[10]=fe=>r.$emit("update:selectedValue",fe.target.value)),class:"hidden peer"},null,40,nn),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==L.value}])},B(L.label),3)]))),128))],2)):c("",!0),t.showTextarea&&((ge=(P=h.value)==null?void 0:P.settings)!=null&&ge.show_textarea)?(o(),n("div",ln,[(Ie=h.value.settings)!=null&&Ie.required?(o(),n("span",rn,"*")):c("",!0),ke(Et,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:h.value.settings,required:($e=h.value.settings)==null?void 0:$e.required,"min-length":(A=h.value.settings)==null?void 0:A.min_length,"max-length":(H=h.value.settings)==null?void 0:H.max_length,placeholder:((ie=h.value.settings)==null?void 0:ie.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":g[11]||(g[11]=L=>r.$emit("update:notesValue",L)),onSave:g[12]||(g[12]=L=>r.$emit("saveTextarea",L))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(re=h.value.settings)!=null&&re.required&&!t.notesValue?(o(),n("p",dn," Keterangan wajib diisi ")):c("",!0)])):c("",!0),t.showImageUpload&&((de=(me=h.value)==null?void 0:me.settings)!=null&&de.show_image_upload)?(o(),n("div",un,[e("h4",cn,[g[19]||(g[19]=Ce(" Upload Foto ")),(ue=h.value.settings)!=null&&ue.required?(o(),n("span",gn,"*")):c("",!0)]),ke(gt,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:h.value.settings,"onUpdate:modelValue":g[13]||(g[13]=L=>r.$emit("update:imagesValue",L)),onSave:g[14]||(g[14]=L=>r.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(be=h.value.settings)!=null&&be.required&&t.imagesValue.length===0?(o(),n("p",mn," Foto wajib diupload ")):c("",!0)])):c("",!0)])]}),_:1},8,["show","title","subtitle"]))}},fn={class:"mt-2 space-y-2"},hn=["name","value","checked","onChange","required"],bn={key:0,class:"p-2 rounded-lg bg-gray-50"},yn={key:0,class:"mt-2"},xn={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},wn=["src"],kn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},$n={key:1,class:"mt-2"},Cn={class:"text-sm text-gray-600"},In={key:2,class:"mt-2 text-sm text-red-600"},Sn={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:Y}){const s=t,x=Y,u=w(s.notes),h=w([...s.images]),p=w(!1),r=w(""),g=w([]),k=w(""),V=w([]),C=le(()=>s.options.find(T=>T.value===s.modelValue)),q=T=>T.settings&&(T.settings.show_textarea||T.settings.show_image_upload);he(()=>s.notes,T=>{u.value=T}),he(()=>s.images,T=>{h.value=[...T]}),he(()=>s.modelValue,T=>{T&&(k.value=T)});const G=T=>{x("update:modelValue",T.value),q(T)?S():x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:T.value,notes:"",images:[]})},b=T=>T.preview||(T.image_path?`/${T.image_path}`:T),S=()=>{k.value=s.modelValue,r.value=u.value,g.value=[...h.value],V.value=[...h.value],p.value=!0},a=()=>{r.value="",g.value=[],k.value="",p.value=!1},I=T=>{g.value=T,h.value=[...T],x("update:images",[...T]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:u.value,images:[...T]})},y=T=>{},D=()=>{k.value!==s.modelValue&&x("update:modelValue",k.value),u.value=r.value,x("update:notes",r.value),h.value=[...g.value],x("update:images",[...g.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:k.value,notes:r.value,images:g.value}),p.value=!1},K=T=>{k.value="",r.value="",g.value=[],u.value="",h.value=[],x("update:modelValue",""),x("update:notes",""),x("update:images",[]),x("hapus",T),p.value=!1};return(T,te)=>{var Q,N,M,z;return o(),n("div",fn,[e("div",{class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Ve,null,Me(t.options,(P,ge)=>(o(),n("label",{key:ge,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:P.value,checked:t.modelValue===P.value,onChange:Ie=>G(P),class:"hidden peer",required:t.required},null,40,hn),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===P.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==P.value}])},B(P.label),3)]))),128))],2),t.modelValue&&C.value&&q(C.value)?(o(),n("div",bn,[e("div",{class:"flex justify-between items-start"},[te[4]||(te[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:S,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((Q=C.value.settings)!=null&&Q.show_image_upload)?(o(),n("div",yn,[e("div",xn,[(o(!0),n(Ve,null,Me(t.images,(P,ge)=>(o(),n("div",{key:ge,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:b(P),class:"w-full h-full object-cover rounded"},null,8,wn),ge===3&&t.images.length>4?(o(),n("span",kn," +"+B(t.images.length-4),1)):c("",!0)]))),128))])])):c("",!0),t.notes&&((N=C.value.settings)!=null&&N.show_textarea)?(o(),n("div",$n,[e("p",Cn,B(t.notes),1)])):c("",!0)])):c("",!0),p.value?(o(),De(pt,{key:(M=t.selectedPoint)==null?void 0:M.id,show:p.value,title:t.pointName||"Detail",subtitle:(z=C.value)==null?void 0:z.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":k.value,"notes-value":r.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":te[0]||(te[0]=P=>k.value=P),"onUpdate:notesValue":te[1]||(te[1]=P=>r.value=P),"onUpdate:imagesValue":te[2]||(te[2]=P=>I(P)),onClose:a,onSave:D,onSaveTextarea:T.handleTextareaSave,onSaveImage:y,onHapus:te[3]||(te[3]=P=>K(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):c("",!0),t.error?(o(),n("p",In,B(t.error),1)):c("",!0)])}}},_n={class:"mt-2 space-y-2"},Vn={key:0,class:"flex flex-wrap gap-3"},Mn={key:1,class:"p-2"},Un={key:0,class:"mt-2"},Dn={class:"flex gap-2 overflow-x-auto scrollbar-hide"},jn=["src"],Tn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Nn=["name","value","checked"],Ln={key:1,class:"mt-2"},Bn={class:"text-sm text-gray-600"},qn={key:3,class:"mt-2 text-sm text-red-600"},Fn={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:Y}){const s=t,x=Y,u=w(s.notes),h=w([...s.images]),p=w(!1),r=w(""),g=w([]),k=w(""),V=w([]),C=le(()=>s.options.find(y=>y.value===s.modelValue)),q=y=>y.preview||(y.image_path?`/${y.image_path}`:y);he(()=>s.notes,y=>{u.value=y});const G=()=>{k.value=s.modelValue||"",r.value=u.value,g.value=[...h.value],V.value=[...h.value],p.value=!0},b=()=>{r.value="",g.value=[],k.value="",p.value=!1},S=y=>{g.value=y,h.value=[...y],x("update:images",[...y]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:u.value,images:[...y]})},a=()=>{k.value!==s.modelValue&&x("update:modelValue",k.value),u.value=r.value,x("update:notes",r.value),h.value=[...g.value],x("update:images",[...g.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:k.value,notes:r.value,images:g.value}),p.value=!1},I=y=>{k.value="",r.value="",g.value=[],u.value="",h.value=[],x("update:modelValue",""),x("update:notes",""),x("update:images",[]),x("hapus",y),p.value=!1};return(y,D)=>{var K,T,te;return o(),n("div",_n,[!t.modelValue&&h.value.length===0&&!u.value?(o(),n("div",Vn,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:G},D[4]||(D[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(o(),n("div",Mn,[e("div",{class:"flex justify-between items-start"},[D[5]||(D[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:G,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),h.value.length>0?(o(),n("div",Un,[e("div",Dn,[(o(!0),n(Ve,null,Me(h.value,(Q,N)=>(o(),n("div",{key:N,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:q(Q),class:"w-full h-full object-cover rounded"},null,8,jn),N===3&&h.value.length>4?(o(),n("span",Tn," +"+B(h.value.length-4),1)):c("",!0)]))),128))])])):c("",!0),e("div",{class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Ve,null,Me(t.options,(Q,N)=>(o(),n("label",{key:N,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:Q.value,checked:t.modelValue===Q.value,disabled:!0,class:"hidden peer"},null,8,Nn),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===Q.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==Q.value}])},B(Q.label),3)]))),128))],2),u.value&&((K=C.value.settings)!=null&&K.show_textarea)?(o(),n("div",Ln,[e("p",Bn,B(u.value),1)])):c("",!0)])),p.value?(o(),De(pt,{key:(T=t.selectedPoint)==null?void 0:T.id,show:p.value,title:t.pointName||"Detail",subtitle:(te=C.value)==null?void 0:te.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":k.value,"notes-value":r.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":D[0]||(D[0]=Q=>k.value=Q),"onUpdate:notesValue":D[1]||(D[1]=Q=>r.value=Q),"onUpdate:imagesValue":D[2]||(D[2]=Q=>S(Q)),onClose:b,onSave:a,onHapus:D[3]||(D[3]=Q=>I(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):c("",!0),t.error?(o(),n("p",qn,B(t.error),1)):c("",!0)])}}},An={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Rn={class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},En={class:"text-xl font-semibold text-indigo-700"},zn={class:"p-4 space-y-4"},On={class:"flex items-start justify-between"},Hn={class:"block text-sm font-medium text-gray-700"},Wn={key:0,class:"text-red-500"},Kn={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Zn={key:0,class:"text-center py-8 text-gray-500"},Gn={key:0,class:"text-xs text-gray-400"},Pn={__name:"CategoryCadangan",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(t,{emit:Y}){const s=t,x=Y,u=w(!1),h=ns(),p=le(()=>(s.category.points||[]).some(b=>b.is_default===!1)),r=le(()=>{var S;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(S=s.category.points)==null?void 0:S.length}),!s.category.isDamageMenu){const a=(s.category.points||[]).filter(I=>{var K;const y=(K=I.inspection_point)==null?void 0:K.id,D=g(y);return u.value||I.is_default||D?!0:(console.log(`Non-damage Point ${y}: is_default=${I.is_default}, hasData=${D}`),!1)});return console.log("Filtered non-damage points:",a),a}const b=(s.category.points||[]).filter(a=>{var D;const I=(D=a.inspection_point)==null?void 0:D.id,y=g(I);return u.value||a.is_default||!a.is_default&&y?!0:(console.log(`Damage Point ${I}: hasData=${y}`),y)});return console.log("Filtered damage points:",b),b}),g=b=>{if(!b)return console.log("hasPointData: pointId is null/undefined"),!1;const S=h.props.existingResults[b]!==void 0,a=h.props.existingImages[b]&&h.props.existingImages[b].length>0,I=s.form.results[b]&&(s.form.results[b].status||s.form.results[b].note),y=s.form.images[b]&&s.form.images[b].length>0,D=S||a||I||y;return console.log(`Point ${b} data check:`,{hasServerResult:S,hasServerImages:a,hasLocalResult:I,hasLocalImages:y,finalResult:D}),D},k=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],V=b=>{var I,y,D,K,T,te,Q,N,M;const S=s.form.results[(I=b.inspection_point)==null?void 0:I.id],a=s.form.images[(y=b.inspection_point)==null?void 0:y.id];if(!S)return!1;switch(b.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!S.note;case"select":case"radio":if(!S.status)return!1;const z=(K=(D=b.settings)==null?void 0:D.radios)==null?void 0:K.find(ge=>ge.value===S.status);return!(z!=null&&z.settings&&(z.settings.show_textarea&&!((T=S.note)!=null&&T.trim())||z.settings.show_image_upload&&(a==null?void 0:a.length)===0));case"imageTOradio":if((a==null?void 0:a.length)===0||!S.status)return!1;const P=(Q=(te=b.settings)==null?void 0:te.radios)==null?void 0:Q.find(ge=>ge.value===S.status);return!(P!=null&&P.settings&&P.settings.show_textarea&&!((N=S.note)!=null&&N.trim()));case"image":return(a==null?void 0:a.length)>0;default:return!!S.status||!!((M=S.note)!=null&&M.trim())}};he(()=>s.form.results,b=>{Object.keys(b).forEach(S=>{!b[S]||!b[S].status&&b[S].note})},{deep:!0}),he(()=>s.form.images,b=>{Object.keys(b).forEach(S=>{!b[S]||b[S].length})},{deep:!0});const C=(b,S,a)=>{x("updateResult",{pointId:b,type:a,value:S})},q=b=>{x("saveResult",b)},G=b=>{x("hapusPoint",b)};return(b,S)=>(o(),n("div",An,[e("div",Rn,[e("h3",En,B(t.category.name),1),p.value?(o(),n("button",{key:0,onClick:S[0]||(S[0]=a=>u.value=!u.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},B(u.value?"Sembunyikan Point Yang Tidak Perlu":"Tampilkan Point Tersembunyi"),1)):c("",!0)]),e("div",zn,[(o(!0),n(Ve,null,Me(r.value,a=>{var I,y,D,K,T,te,Q,N,M,z,P,ge,Ie,$e,A,H,ie,re,me,de,ue,be,L,ye,fe,d,_,f,U,E,se,O,oe,ee,$,m,Z,W,F,pe,xe,we,Re,Oe,Je,Xe,Ye,nt,We,Qe,et,Ke,Se,Te,He,Ze;return o(),n("div",{key:a.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",On,[e("label",Hn,[Ce(B((I=a.inspection_point)==null?void 0:I.name)+" ",1),(y=a.settings)!=null&&y.is_required?(o(),n("span",Wn,"*")):c("",!0)]),V(a)?(o(),n("span",Kn," ✓ ")):c("",!0)]),a.input_type==="text"?(o(),De(qt,{key:0,modelValue:t.form.results[(D=a.inspection_point)==null?void 0:D.id].note,"onUpdate:modelValue":[R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].note=R},R=>{var v;return C((v=a.inspection_point)==null?void 0:v.id,R,"note")}],required:(K=a.settings)==null?void 0:K.is_required,"min-length":(T=a.settings)==null?void 0:T.min_length,"max-length":(te=a.settings)==null?void 0:te.max_length,allowSpace:(Q=a.settings)==null?void 0:Q.allow_space,textTransform:(N=a.settings)==null?void 0:N.text_transform,placeholder:((M=a.settings)==null?void 0:M.placeholder)||"Masukan text",error:t.form.errors[`results.${(z=a.inspection_point)==null?void 0:z.id}.note`],onSave:R=>{var v;return q((v=a.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):c("",!0),a.input_type==="number"?(o(),De(Ft,{key:1,modelValue:t.form.results[(P=a.inspection_point)==null?void 0:P.id].note,"onUpdate:modelValue":[R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].note=R},R=>{var v;return C((v=a.inspection_point)==null?void 0:v.id,R,"note")}],required:(ge=a.settings)==null?void 0:ge.is_required,min:(Ie=a.settings)==null?void 0:Ie.min,max:($e=a.settings)==null?void 0:$e.max,step:((A=a.settings)==null?void 0:A.step)||1,placeholder:((H=a.settings)==null?void 0:H.placeholder)||"Masukan number",error:t.form.errors[`results.${(ie=a.inspection_point)==null?void 0:ie.id}.note`],onSave:R=>{var v;return q((v=a.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):c("",!0),a.input_type==="account"?(o(),De(Rt,{key:2,modelValue:t.form.results[(re=a.inspection_point)==null?void 0:re.id].note,"onUpdate:modelValue":[R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].note=R},R=>{var v;return C((v=a.inspection_point)==null?void 0:v.id,R,"note")}],required:(me=a.settings)==null?void 0:me.is_required,placeholder:((de=a.settings)==null?void 0:de.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${(ue=a.inspection_point)==null?void 0:ue.id}.note`],"point-id":(be=a.inspection_point)==null?void 0:be.id,settings:a.settings,onSave:R=>{var v;return q((v=a.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):c("",!0),a.input_type==="date"?(o(),De(At,{key:3,modelValue:t.form.results[(L=a.inspection_point)==null?void 0:L.id].note,"onUpdate:modelValue":[R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].note=R},R=>{var v;return C((v=a.inspection_point)==null?void 0:v.id,R,"note")}],required:(ye=a.settings)==null?void 0:ye.is_required,"min-date":(fe=a.settings)==null?void 0:fe.min_date,"max-date":(d=a.settings)==null?void 0:d.max_date,error:t.form.errors[`results.${(_=a.inspection_point)==null?void 0:_.id}.note`],onSave:R=>{var v;return q((v=a.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):c("",!0),a.input_type==="textarea"?(o(),De(Et,{key:4,modelValue:t.form.results[(f=a.inspection_point)==null?void 0:f.id].note,"onUpdate:modelValue":[R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].note=R},R=>{var v;return C((v=a.inspection_point)==null?void 0:v.id,R,"note")}],required:(U=a.settings)==null?void 0:U.is_required,"min-length":(E=a.settings)==null?void 0:E.min_length,"max-length":(se=a.settings)==null?void 0:se.max_length,placeholder:((O=a.settings)==null?void 0:O.placeholder)||"Masukkan teks di sini",settings:a.settings,error:t.form.errors[`results.${(oe=a.inspection_point)==null?void 0:oe.id}.note`],onSave:R=>{var v;return q((v=a.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):c("",!0),a.input_type==="radio"?(o(),De(Sn,{key:5,modelValue:t.form.results[(ee=a.inspection_point)==null?void 0:ee.id].status,"onUpdate:modelValue":[R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].status=R},R=>{var v;return C((v=a.inspection_point)==null?void 0:v.id,R,"status")}],notes:t.form.results[($=a.inspection_point)==null?void 0:$.id].note,images:t.form.images[(m=a.inspection_point)==null?void 0:m.id],required:(Z=a.settings)==null?void 0:Z.is_required,"point-id":(W=a.inspection_point)==null?void 0:W.id,point:a.inspection_point,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(F=a.inspection_point)==null?void 0:F.name,"selected-point":a.inspection_point??null,options:((pe=a.settings)==null?void 0:pe.radios)||k,error:t.form.errors[`results.${(xe=a.inspection_point)==null?void 0:xe.id}.status`],"onUpdate:notes":R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].note=R},"onUpdate:images":R=>{var v;return t.form.images[(v=a.inspection_point)==null?void 0:v.id]=R},onSave:R=>{var v;return q((v=a.inspection_point)==null?void 0:v.id)},onHapus:R=>{var v;return G((v=a.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="imageTOradio"?(o(),De(Fn,{key:6,modelValue:t.form.results[(we=a.inspection_point)==null?void 0:we.id].status,"onUpdate:modelValue":[R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].status=R},R=>{var v;return C((v=a.inspection_point)==null?void 0:v.id,R,"status")}],notes:t.form.results[(Re=a.inspection_point)==null?void 0:Re.id].note,images:t.form.images[(Oe=a.inspection_point)==null?void 0:Oe.id],required:(Je=a.settings)==null?void 0:Je.is_required,"point-id":(Xe=a.inspection_point)==null?void 0:Xe.id,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(Ye=a.inspection_point)==null?void 0:Ye.name,point:a,"selected-point":a.inspection_point??null,options:((nt=a.settings)==null?void 0:nt.radios)||k,error:t.form.errors[`results.${(We=a.inspection_point)==null?void 0:We.id}.status`],"onUpdate:notes":R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].note=R},"onUpdate:images":R=>{var v;return t.form.images[(v=a.inspection_point)==null?void 0:v.id]=R},onSave:R=>{var v;return q((v=a.inspection_point)==null?void 0:v.id)},onHapus:R=>{var v;return G((v=a.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="image"?(o(),De(gt,{key:7,modelValue:t.form.images[(Qe=a.inspection_point)==null?void 0:Qe.id],"onUpdate:modelValue":R=>{var v;return t.form.images[(v=a.inspection_point)==null?void 0:v.id]=R},error:t.form.errors[`images.${(et=a.inspection_point)==null?void 0:et.id}`],"inspection-id":t.inspectionId,"point-id":(Ke=a.inspection_point)==null?void 0:Ke.id,point:a.inspection_point,"point-name":(Se=a.inspection_point)==null?void 0:Se.name,settings:a.settings,"onUpdate:notes":R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].note=R},"onUpdate:status":R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].status=R}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):c("",!0),a.input_type==="select"?(o(),De(ho,{key:8,modelValue:t.form.results[(Te=a.inspection_point)==null?void 0:Te.id].status,"onUpdate:modelValue":[R=>{var v;return t.form.results[(v=a.inspection_point)==null?void 0:v.id].status=R},R=>{var v;return C((v=a.inspection_point)==null?void 0:v.id,R,"status")}],required:(He=a.settings)==null?void 0:He.is_required,error:t.form.errors[`results.${(Ze=a.inspection_point)==null?void 0:Ze.id}.status`],onSave:R=>{var v;return q((v=a.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):c("",!0)])}),128)),r.value.length===0?(o(),n("div",Zn,[S[1]||(S[1]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),S[2]||(S[2]=e("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),t.category.isDamageMenu?(o(),n("p",Gn,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):c("",!0)])):c("",!0)])]))}},Jn=Ae(Pn,[["__scopeId","data-v-819f08b2"]]),Xn={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Yn={class:"p-4 space-y-4-6"},Qn={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ei=["value"],ti={class:"p-4 space-y-4-6"},si={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},oi=["value"],ai={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},ni={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ii=["value"],li={class:"p-4 space-y-2"},ri={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},di={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},ui={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},ci={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},gi={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},mi={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(t,{emit:Y}){const s=t,x=Y,u=w(null),h=w(!1),p=Dt({bold:!1,italic:!1,underline:!1}),r=Dt({flooded:"",collision:"",collision_severity:"",notes:""}),g=N=>{if(!N)return{};if(typeof N=="string")try{return JSON.parse(N)||{}}catch(M){return console.error("Error parsing settings JSON:",M),{}}return typeof N=="object"&&N!==null?N:{}};le(()=>g(s.inspection.settings).conclusion||{});const k=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],V=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],C=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];at(()=>{G(),Lt(()=>{q(),b()})});const q=()=>{u.value&&r.notes&&(u.value.innerHTML=r.notes)},G=()=>{const M=g(s.inspection.settings).conclusion||{},z=s.form.conclusion||{};r.flooded=z.flooded||M.flooded||"",r.collision=z.collision||M.collision||"",r.collision_severity=z.collision_severity||M.collision_severity||"",r.notes=z.notes||s.inspection.notes||""},b=()=>{if(!u.value)return;const N=window.getSelection();N.rangeCount===0||N.isCollapsed||(p.bold=document.queryCommandState("bold"),p.italic=document.queryCommandState("italic"),p.underline=document.queryCommandState("underline"))},S=N=>{if(!u.value)return;u.value.focus();const M=p[N];switch(N){case"bold":document.execCommand("bold",!1,!M);break;case"italic":document.execCommand("italic",!1,!M);break;case"underline":document.execCommand("underline",!1,!M);break}setTimeout(()=>{b(),I()},10)},a=()=>{u.value&&(u.value.focus(),document.execCommand("removeFormat",!1,null),Object.keys(p).forEach(N=>{p[N]=!1}),I())},I=Bt.debounce(()=>{u.value&&(r.notes=u.value.innerHTML,Q())},200),y=N=>{N.preventDefault(),document.execCommand("insertParagraph",!1,null)},D=N=>{N.preventDefault();const M=(N.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,M)},K=()=>{h.value=!0},T=()=>{h.value=!1,u.value&&(r.notes=u.value.innerHTML,Q())},te=()=>{Q()},Q=()=>{const N={flooded:r.flooded,collision:r.collision,collision_severity:r.collision==="yes"?r.collision_severity:null,notes:r.notes};x("updateConclusion",N)};return he(()=>s.form.conclusion,N=>{N&&(r.flooded=N.flooded!==void 0?N.flooded:r.flooded,r.collision=N.collision!==void 0?N.collision:r.collision,r.collision_severity=N.collision_severity!==void 0?N.collision_severity:r.collision_severity,r.notes=N.notes!==void 0?N.notes:r.notes,u.value&&N.notes!==void 0&&u.value.innerHTML!==N.notes&&(u.value.innerHTML=N.notes))},{deep:!0,immediate:!0}),he([()=>r.flooded,()=>r.collision,()=>r.collision_severity,()=>r.notes],()=>{Q()},{deep:!0}),(N,M)=>(o(),n("div",Xn,[M[16]||(M[16]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),e("div",Yn,[M[8]||(M[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ce(" Apakah kendaraan pernah terkena banjir? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Qn,[(o(),n(Ve,null,Me(k,z=>e("label",{key:z.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[0]||(M[0]=P=>r.flooded=P),value:z.value,class:"hidden peer",onChange:te},null,40,ei),[[ct,r.flooded]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":r.flooded===z.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":r.flooded!==z.value}])},B(z.label),3)])),64))])]),e("div",ti,[M[10]||(M[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ce(" Apakah kendaraan pernah mengalami tabrakan? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",si,[(o(),n(Ve,null,Me(V,z=>e("label",{key:z.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[1]||(M[1]=P=>r.collision=P),value:z.value,class:"hidden peer",onChange:te},null,40,oi),[[ct,r.collision]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":r.collision===z.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":r.collision!==z.value}])},B(z.label),3)])),64))]),ke(ot,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:Le(()=>[r.collision==="yes"?(o(),n("div",ai,[M[9]||(M[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ce("Tingkat kerusakan: "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ni,[(o(),n(Ve,null,Me(C,z=>e("label",{key:z.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[2]||(M[2]=P=>r.collision_severity=P),value:z.value,class:"hidden peer",onChange:te},null,40,ii),[[ct,r.collision_severity]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":r.collision_severity===z.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":r.collision_severity!==z.value}])},B(z.label),3)])),64))])])):c("",!0)]),_:1})]),e("div",li,[M[15]||(M[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),e("div",ri,[e("button",{type:"button",onClick:M[3]||(M[3]=z=>S("bold")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},M[11]||(M[11]=[e("strong",null,"B",-1)]),2),e("button",{type:"button",onClick:M[4]||(M[4]=z=>S("italic")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},M[12]||(M[12]=[e("em",null,"I",-1)]),2),e("button",{type:"button",onClick:M[5]||(M[5]=z=>S("underline")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},M[13]||(M[13]=[e("u",null,"U",-1)]),2),e("button",{type:"button",onClick:M[6]||(M[6]=z=>a()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Formatting"}," 🗑️ Clear ")]),ke(ot,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:Le(()=>[Object.values(p).some(z=>z)?(o(),n("div",di,[M[14]||(M[14]=Ce(" Format aktif: ")),p.bold?(o(),n("span",ui,"Bold")):c("",!0),p.italic?(o(),n("span",ci,"Italic")):c("",!0),p.underline?(o(),n("span",gi,"Underline")):c("",!0)])):c("",!0)]),_:1}),e("div",{ref_key:"editorRef",ref:u,contenteditable:"true",class:ne(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!h.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":h.value}]),onInput:M[7]||(M[7]=(...z)=>X(I)&&X(I)(...z)),onBlur:T,onFocus:K,onKeydown:is(y,["enter"]),onPaste:D,onMouseup:b,onKeyup:b,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},pi=Ae(mi,[["__scopeId","data-v-e687622b"]]),vi={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},fi={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},hi={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},bi={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},yi={class:"flex items-center space-x-2 flex-shrink-0"},xi=["aria-checked"],wi={class:"flex items-center space-x-2 flex-shrink-0"},ki={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},$i=["onClick","data-category"],Ci={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ii={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Si={key:3,class:"fixed inset-0 z-30"},_i={class:"mt-2 space-y-2"},Vi={class:"flex items-center space-x-2"},Mi=["aria-checked"],Ui={class:"flex items-center space-x-2"},Di={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ji=["onClick"],Ti={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ni={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Li={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Bi={class:"relative overflow-hidden"},qi={key:"vehicle"},Fi={key:"conclusion"},Ai={key:1},Ri=["disabled"],Ei={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},zi={class:"space-y-4"},Oi={class:"relative"},Hi={class:"max-h-64 overflow-y-auto"},Wi={key:0,class:"text-center py-4 text-gray-500"},Ki=["onClick"],Zi={class:"font-medium text-gray-900"},Gi={class:"text-sm text-gray-500"},Pi={class:"text-xs text-gray-400 mt-1"},Ji={key:0,class:"text-xs text-green-600 mt-1"},Xi={key:3,class:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 text-center"},Yi={__name:"IndexLocal",props:{inspection:Object,inspectionId:Object,category:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(t){var yt,xt,wt,kt,$t,Ct,It,St,_t,Vt;const Y=i=>{if(!i)return{};if(typeof i=="string")try{return JSON.parse(i)||{}}catch(l){return console.error("Error parsing settings JSON:",l),{}}return typeof i=="object"&&i!==null?i:{}},s=t,x=le(()=>`inspection_data_${s.inspection.id}`),u=le(()=>`swipe_toggle_${s.inspection.id}`),h=le(()=>`image_source_${s.inspection.id}`),p=()=>{try{const i=localStorage.getItem(x.value);return i?JSON.parse(i):{}}catch(i){return console.error("Error reading local storage:",i),{}}},r=i=>{try{localStorage.setItem(x.value,JSON.stringify(i))}catch(l){console.error("Error writing to local storage:",l)}},g=()=>{try{localStorage.removeItem(x.value),localStorage.removeItem(u.value),localStorage.removeItem(h.value)}catch(i){console.error("Error clearing local storage:",i)}},k=()=>{try{const i=localStorage.getItem(u.value);return i?JSON.parse(i):!0}catch(i){return console.error("Error reading swipe toggle state:",i),!0}},V=i=>{try{localStorage.setItem(u.value,JSON.stringify(i))}catch(l){console.error("Error writing swipe toggle state:",l)}},C=()=>{try{return localStorage.getItem(h.value)||"all"}catch(i){return console.error("Error reading image source setting:",i),"all"}},q=i=>{try{localStorage.setItem(h.value,i)}catch(l){console.error("Error writing image source setting:",l)}},G=w(((xt=(yt=s.category)==null?void 0:yt.settings)==null?void 0:xt.menu_model)||"horizontal"),b=w(((kt=(wt=s.category)==null?void 0:wt.settings)==null?void 0:kt.position)||"top"),S=w(!1),a=w(!1),{pos:I,dragging:y,startLongPress:D,cancelLongPress:K,onDrag:T,stopDrag:te,handleClick:Q}=Tt("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),N=i=>{Q(i)&&M()},M=()=>{S.value=!S.value},z=()=>{S.value=!1},P=i=>i?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:ge,dragging:Ie,startLongPress:$e,cancelLongPress:A,onDrag:H,stopDrag:ie,handleClick:re}=Tt("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),me=i=>{re(i)&&(de.value=!0)},de=w(!1),ue=w(!1),be=w(""),L=w(null),ye=w(""),fe=w(""),d=w(""),_=w(!1),f=w(null),U=(i,l)=>{_.value=!0,f.value=l,lt.visit(i,{onFinish:()=>{_.value=!1,f.value=null}})},E=le(()=>s.appMenus.some(i=>i.input_type==="damage")),se=le(()=>["vehicle",...s.appMenus.map(i=>i.id),"conclusion"]),O=w(se.value[0]),oe=w(0);he(O,i=>{oe.value=se.value.indexOf(i)});const ee=le(()=>{if(O.value==="vehicle"||O.value==="conclusion")return null;const i=s.appMenus.find(l=>l.id===O.value);return i?{...i,points:$(i.menu_point,i.input_type==="damage")}:null}),$=(i,l)=>l?(i||[]).filter(J=>{const ae=J.inspection_point_id;return Xe(ae)}):i||[],m=w({plate_number:s.inspection.plate_number,car_id:s.inspection.car_id,car_name:s.inspection.car_name}),Z=w({notes:s.inspection.overall_note||"",flooded:((Ct=($t=Y(s.inspection.settings))==null?void 0:$t.conclusion)==null?void 0:Ct.flooded)||null,collision:((St=(It=Y(s.inspection.settings))==null?void 0:It.conclusion)==null?void 0:St.collision)||null,collision_severity:((Vt=(_t=Y(s.inspection.settings))==null?void 0:_t.conclusion)==null?void 0:Vt.collision_severity)||null}),F=Nt((()=>{const i=[...s.appMenus.flatMap(qe=>qe.menu_point||[]),...s.damagePoints||[]],l={},J={};i.forEach(qe=>{const Be=qe.inspection_point_id,je=s.existingResults[Be];l[Be]={status:(je==null?void 0:je.status)||"",note:(je==null?void 0:je.note)||""},J[Be]=s.existingImages[Be]||[]});const ae=p(),ce={...l,...ae.results||{}},_e={...J,...ae.images||{}},Ue={...m.value,...ae.vehicleDetails||{}},ve=ae.overall_note!==void 0?ae.overall_note:s.inspection.overall_note||"";return{inspection_id:s.inspection.id,results:ce,images:_e,overall_note:ve,plate_number:Ue.plate_number,car_id:Ue.car_id,car_name:Ue.car_name}})());he(F,i=>{r({results:i.results,images:i.images,overall_note:i.overall_note,vehicleDetails:m.value,conclusion:Z.value})},{deep:!0}),he(m,i=>{F.plate_number=i.plate_number,F.car_id=i.car_id,F.car_name=i.car_name},{deep:!0}),he(Z,i=>{F.overall_note=i.notes},{deep:!0});const pe=w(!1),xe=i=>{pe.value=i},we=w(!1),Re=i=>{we.value=i},Oe=le(()=>{var ce;const i=m.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(m.value.plate_number),l=!!((ce=m.value.car_name)!=null&&ce.trim()),J=!we.value,ae=!pe.value;return i&&l&&J&&ae}),Je=le(()=>{if(!be.value.trim())return s.damagePoints||[];const i=be.value.toLowerCase().trim();return(s.damagePoints||[]).filter(l=>{var J,ae,ce,_e,Ue;return((ae=(J=l.inspection_point)==null?void 0:J.name)==null?void 0:ae.toLowerCase().includes(i))||((_e=(ce=l.inspection_point)==null?void 0:ce.description)==null?void 0:_e.toLowerCase().includes(i))||((Ue=Ye(l))==null?void 0:Ue.toLowerCase().includes(i))})}),Xe=i=>{const l=F.results[i]&&(F.results[i].status||F.results[i].note),J=F.images[i]&&F.images[i].length>0;return l||J},Ye=i=>{var l;return((l=i.inspection_point.component)==null?void 0:l.name)||"Komponen Tidak Diketahui"},nt=i=>F.results[i]||null,We=()=>{var _e;const i=Z.value,l=!!i.flooded,J=!!i.collision,ae=i.collision==="yes"?!!i.collision_severity:!0,ce=!!((_e=i.notes)!=null&&_e.trim());return l&&J&&ae&&ce},Qe=le(()=>({flooded:Z.value.flooded||null,collision:Z.value.collision||null,collision_severity:Z.value.collision_severity||null,note:Z.value.notes||null,isComplete:We()})),et=le(()=>{const i=Oe.value,l=s.appMenus.every(ae=>Ke(ae)),J=We();return i&&l&&J}),Ke=i=>i.input_type==="damage"?$(i.menu_point,!0).length>0:i.id==="conclusion"?We():i.id==="vehicle"?Oe.value:($(i.menu_point,!1)||[]).filter(J=>J.is_default).every(J=>{var Ue,ve,qe,Be,je,tt;const ae=F.results[J.inspection_point_id],ce=F.images[J.inspection_point_id];if(!ae)return!1;const _e=Y(J.settings);switch(J.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((Ue=ae.note)!=null&&Ue.trim());case"select":case"radio":if(!ae.status)return!1;const Ee=(ve=_e.radios)==null?void 0:ve.find(j=>j.value===ae.status);return!(Ee!=null&&Ee.settings&&(Ee.settings.show_textarea&&!((qe=ae.note)!=null&&qe.trim())||Ee.settings.show_image_upload&&(ce==null?void 0:ce.length)===0));case"imageTOradio":if((ce==null?void 0:ce.length)===0||!ae.status)return!1;const ze=(Be=_e.radios)==null?void 0:Be.find(j=>j.value===ae.status);return!(ze!=null&&ze.settings&&ze.settings.show_textarea&&ze.settings.required&&!((je=ae.note)!=null&&je.trim()));case"image":return(ce==null?void 0:ce.length)>0;default:return!!ae.status||!!((tt=ae.note)!=null&&tt.trim())}}),Se=w(!0),Te=w("all"),He=w(null),Ze=w([]),R=w(0),v=w(!1);ls("imageSourceSetting",Te);const vt=()=>{Se.value=!Se.value,V(Se.value)},ft=()=>{q(Te.value),console.log("Image source setting updated to:",Te.value)},it=()=>{He.value&&Lt(()=>{const i=He.value.querySelector(`[data-category="${O.value}"]`);if(!i)return;const l=He.value,J=l.clientWidth,ae=i.offsetLeft,ce=i.clientWidth,_e=ae-J/2+ce/2;l.scrollTo({left:_e,behavior:"smooth"})})},Ot=()=>R.value===0?(R.value=1,v.value=!0,setTimeout(()=>{R.value=0,v.value=!1},2e3),window.history.pushState(null,null,window.location.href),!1):(R.value=0,v.value=!1,lt.visit(route("job.index")),!0),Ht=()=>{window.history.state===null&&window.history.replaceState({isBackButtonControlled:!0},""),window.history.pushState({isBackButtonControlled:!0},""),window.addEventListener("popstate",i=>{i.state&&i.state.isBackButtonControlled&&(i.preventDefault(),Ot())})},Wt=i=>{L.value=i;const l=i.inspection_point_id,J=F.results[l]||{};ye.value=J.status||"",fe.value=J.note||"",de.value=!1,ue.value=!0},Kt=i=>{L.value&&(F.images[L.value.inspection_point_id]=i)},Zt=()=>{if(L.value){const i=L.value.inspection_point_id;F.results[i]={...F.results[i],status:ye.value,note:fe.value},d.value="Data berhasil disimpan di lokal!",setTimeout(()=>d.value="",1e3)}rt()},Gt=({pointId:i,type:l,value:J})=>{var ae;(ae=F.results[i])!=null&&ae.hasOwnProperty(l)&&(F.results[i][l]=J)},ht=async i=>{if(i&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await lt.post(route("inspections.delete-result"),{inspection_id:s.inspection.id,point_id:i},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{F.results[i]&&(F.results[i]={status:"",note:""}),F.images[i]&&(F.images[i]=[]),d.value="Data berhasil dihapus!",setTimeout(()=>d.value="",1e3)},onError:l=>{console.error("Error menghapus hasil:",l)}})}catch(l){console.error("Error menghapus hasil:",l)}rt()}},Pt=i=>{Object.assign(m.value,i),xe(!0)},Jt=i=>{console.log("Save car details locally:",i)},Xt=i=>{console.log("Received conclusion data from child:",i),Z.value={...Z.value,...i},F.overall_note=i.notes||"",console.log("Conclusion state updated:",Z.value)},Yt=()=>{if(!et.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}if(!confirm("Apakah Anda yakin ingin mengirim semua data inspeksi? Data lokal akan dihapus setelah berhasil dikirim."))return;a.value=!0;const i={...F.data(),overall_note:Z.value.notes,conclusion:{notes:Z.value.notes,flooded:Z.value.flooded,collision:Z.value.collision,collision_severity:Z.value.collision_severity}};lt.post(route("inspections.final-submit-local",{id:s.inspection.id}),i,{preserveScroll:!0,onSuccess:()=>{g()},onError:l=>{console.error("Kesalahan pengiriman:",l),a.value=!1}})},Qt=({pointId:i,imageId:l})=>{F.images[i]&&(F.images[i]=F.images[i].filter(J=>J.id!==l))},es=()=>{de.value=!1,be.value=""},rt=()=>{ue.value=!1,L.value=null,ye.value="",fe.value=""},ts=()=>{},Ge=i=>{O.value=i,it()},bt=i=>{let l=oe.value+i;l>=0&&l<se.value.length&&(O.value=se.value[l],it())},ss=()=>{let i=0,l=0,J=null;const ae=ve=>{Se.value&&(i=ve.changedTouches[0].screenX)},ce=ve=>{Se.value&&(l=ve.changedTouches[0].screenX,_e())},_e=()=>{if(!Se.value)return;const ve=250;l<i-ve?bt(1):l>i+ve&&bt(-1)},Ue=()=>{const ve=document.querySelector(".relative.overflow-hidden");return ve&&(ve.addEventListener("touchstart",ae,{passive:!0}),ve.addEventListener("touchend",ce,{passive:!0})),()=>{ve&&(ve.removeEventListener("touchstart",ae),ve.removeEventListener("touchend",ce))}};return J=Ue(),he(Se,ve=>{J&&J(),ve&&(J=Ue())}),()=>{J&&J()}};return he(O,(i,l)=>{it()}),he(O,i=>{oe.value=se.value.indexOf(i)}),at(()=>{const i=p();if(Se.value=k(),Te.value=C(),i.vehicleDetails&&(Object.assign(m.value,i.vehicleDetails),F.plate_number=i.vehicleDetails.plate_number,F.car_id=i.vehicleDetails.car_id,F.car_name=i.vehicleDetails.car_name),i.conclusion)console.log("Loading conclusion from localStorage:",i.conclusion),Object.assign(Z.value,i.conclusion),F.overall_note=i.conclusion.notes||"";else{const J=Y(s.inspection.settings).conclusion||{};Z.value={notes:s.inspection.notes||"",flooded:J.flooded||"",collision:J.collision||"",collision_severity:J.collision_severity||""},F.overall_note=s.inspection.notes||""}i.results&&Object.assign(F.results,i.results),i.images&&Object.assign(F.images,i.images),ss(),Ht(),setTimeout(()=>{it()},100)}),(i,l)=>{var J,ae,ce,_e,Ue,ve,qe,Be,je,tt,Ee,ze;return o(),n("div",vi,[X(Ie)||X(y)?(o(),n("div",fi)):c("",!0),G.value==="vertical"?(o(),n("button",{key:1,onMousedown:l[0]||(l[0]=(...j)=>X(D)&&X(D)(...j)),onMouseup:l[1]||(l[1]=(...j)=>X(te)&&X(te)(...j)),onMouseleave:l[2]||(l[2]=(...j)=>X(K)&&X(K)(...j)),onMousemove:l[3]||(l[3]=(...j)=>X(T)&&X(T)(...j)),onTouchstart:l[4]||(l[4]=(...j)=>X(D)&&X(D)(...j)),onTouchend:l[5]||(l[5]=(...j)=>X(te)&&X(te)(...j)),onTouchmove:l[6]||(l[6]=(...j)=>X(T)&&X(T)(...j)),onClick:N,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:Fe({left:X(I).x+"px",top:X(I).y+"px"}),"aria-label":"Toggle vertical menu"},[S.value?(o(),n("svg",bi,l[25]||(l[25]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(o(),n("svg",hi,l[24]||(l[24]=[e("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):c("",!0),G.value==="horizontal"?(o(),n("div",{key:2,class:ne(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":b.value==="top","fixed bottom-0 left-0 right-0":b.value==="bottom"}])},[e("div",{ref_key:"menuContainer",ref:He,class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2 menu-container",onScroll:ts},[e("div",yi,[l[26]||(l[26]=e("span",{class:"text-sm text-gray-600"},"Swipe",-1)),e("button",{onClick:vt,type:"button",class:ne(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Se.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Se.value},[e("span",{"aria-hidden":"true",class:ne(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Se.value?"translate-x-5":"translate-x-0"])},null,2)],10,xi)]),e("div",wi,[l[28]||(l[28]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ne(e("select",{"onUpdate:modelValue":l[7]||(l[7]=j=>Te.value=j),onChange:ft,class:"text-sm border border-gray-300 rounded-md px-5 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},l[27]||(l[27]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[jt,Te.value]])]),e("button",{ref_key:"menuItems",ref:Ze,onClick:l[8]||(l[8]=j=>Ge("vehicle")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":O.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":O.value!=="vehicle"}]),"data-category":"vehicle"},[l[29]||(l[29]=Ce(" Detail Kendaraan ")),Oe.value?(o(),n("span",ki," ✓ ")):c("",!0)],2),(o(!0),n(Ve,null,Me(t.appMenus,j=>(o(),n("button",{key:j.id,ref_for:!0,ref_key:"menuItems",ref:Ze,onClick:dt=>Ge(j.id),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":O.value===j.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":O.value!==j.id}]),"data-category":j.id},[Ce(B(j.name)+" ",1),Ke(j)?(o(),n("span",Ci," ✓ ")):c("",!0)],10,$i))),128)),e("button",{ref_key:"menuItems",ref:Ze,onClick:l[9]||(l[9]=j=>Ge("conclusion")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":O.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":O.value!=="conclusion"}]),"data-category":"conclusion"},[l[30]||(l[30]=Ce(" Kesimpulan ")),Qe.value.isComplete?(o(),n("span",Ii," ✓ ")):c("",!0)],2)],544)],2)):c("",!0),G.value==="vertical"&&S.value?(o(),n("div",Si,[e("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:z}),e("div",{class:ne(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":b.value==="top-right","top-16 left-4":b.value==="top-left","bottom-16 right-4":b.value==="bottom-right","bottom-16 left-4":b.value==="bottom-left"}])},[e("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[l[31]||(l[31]=e("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),e("button",{onClick:z,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),e("div",_i,[e("div",Vi,[l[32]||(l[32]=e("span",{class:"text-sm text-gray-600"},"Swipe Gesture",-1)),e("button",{onClick:vt,type:"button",class:ne(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Se.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Se.value},[e("span",{"aria-hidden":"true",class:ne(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Se.value?"translate-x-5":"translate-x-0"])},null,2)],10,Mi)]),e("div",Ui,[l[34]||(l[34]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ne(e("select",{"onUpdate:modelValue":l[10]||(l[10]=j=>Te.value=j),onChange:ft,class:"text-sm border border-gray-300 rounded-md px-6 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},l[33]||(l[33]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[jt,Te.value]])]),e("button",{onClick:l[11]||(l[11]=j=>{Ge("vehicle"),z()}),class:ne([P(O.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[l[35]||(l[35]=e("span",null,"Detail Kendaraan",-1)),Oe.value?(o(),n("span",Di,"✓")):c("",!0)],2),(o(!0),n(Ve,null,Me(t.appMenus,j=>(o(),n("button",{key:`vmenu-${j.id}`,onClick:()=>{Ge(j.id),z()},class:ne([P(O.value===j.id),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[e("span",null,B(j.name),1),Ke(j)?(o(),n("span",Ti,"✓")):c("",!0)],10,ji))),128)),e("button",{onClick:l[12]||(l[12]=j=>{Ge("conclusion"),z()}),class:ne([P(O.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[l[36]||(l[36]=e("span",null,"Kesimpulan",-1)),Qe.value.isComplete?(o(),n("span",Ni,"✓")):c("",!0)],2)])],2)])):c("",!0),e("div",{class:ne(["max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1",{"pb-4 pt-1":b.value==="top","pb-20 pt-4":b.value==="bottom","pb-4 pt-4":G.value==="vertical"}])},[ke(ot,{name:"fade"},{default:Le(()=>[d.value?(o(),n("div",Li,B(d.value),1)):c("",!0)]),_:1}),e("div",Bi,[ke(ot,{name:"category-slide",mode:"out-in"},{default:Le(()=>[O.value==="vehicle"?(o(),n("div",qi,[ke(Ws,{inspection:t.inspection,CarDetail:t.CarDetail,allInspections:s.allInspections,onUpdateVehicle:Pt,onSaveCarDetails:Jt,"onUpdate:validation":Re,"onUpdate:hasUnsavedChanges":xe},null,8,["inspection","CarDetail","allInspections"])])):ee.value&&O.value!=="conclusion"?(o(),n("div",{key:ee.value.id},[ke(Jn,{category:ee.value,"inspection-id":t.inspection.id,form:X(F),onUpdateResult:Gt,onHapusPoint:ht,onRemoveImage:Qt},null,8,["category","inspection-id","form"])])):O.value==="conclusion"?(o(),n("div",Fi,[ke(pi,{form:{conclusion:Z.value},"inspection-id":t.inspection.id,inspection:t.inspection,settings:t.inspection.settings||{},onUpdateConclusion:Xt},null,8,["form","inspection-id","inspection","settings"])])):c("",!0)]),_:1})]),O.value==="conclusion"?(o(),n("div",{key:0,class:ne(["flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md",{"mb-4":b.value==="top","mb-20":b.value==="bottom"}])},[ke(X(rs),{href:i.route("inspections.pending",t.inspectionId),as:"button",type:"button",disabled:_.value&&f.value==="pending",onClick:l[13]||(l[13]=st(j=>U(i.route("inspections.pending",t.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:Le(()=>[_.value&&f.value==="pending"?(o(),n(Ve,{key:0},[l[37]||(l[37]=e("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),l[38]||(l[38]=e("span",null,"Memproses...",-1))],64)):(o(),n("span",Ai,"Tunda"))]),_:1},8,["href","disabled"]),e("button",{type:"button",onClick:Yt,disabled:!et.value||a.value,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[a.value?(o(),n("svg",Ei,l[39]||(l[39]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,B(a.value?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Ri)],2)):c("",!0),E.value?(o(),n("button",{key:1,onMousedown:l[14]||(l[14]=(...j)=>X($e)&&X($e)(...j)),onMouseup:l[15]||(l[15]=(...j)=>X(ie)&&X(ie)(...j)),onMouseleave:l[16]||(l[16]=(...j)=>X(A)&&X(A)(...j)),onMousemove:l[17]||(l[17]=(...j)=>X(H)&&X(H)(...j)),onTouchstart:l[18]||(l[18]=(...j)=>X($e)&&X($e)(...j)),onTouchend:l[19]||(l[19]=(...j)=>X(ie)&&X(ie)(...j)),onTouchmove:l[20]||(l[20]=(...j)=>X(H)&&X(H)(...j)),onClick:me,class:"fixed z-5 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:Fe({left:X(ge).x+"px",top:X(ge).y+"px"})},l[40]||(l[40]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):c("",!0),ke(zt,{show:de.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:es},{default:Le(()=>[e("div",zi,[e("div",Oi,[Ne(e("input",{"onUpdate:modelValue":l[21]||(l[21]=j=>be.value=j),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Pe,be.value]]),l[41]||(l[41]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",Hi,[Je.value.length===0?(o(),n("div",Wi," Tidak ada point yang ditemukan ")):c("",!0),(o(!0),n(Ve,null,Me(Je.value,j=>{var dt,Mt;return o(),n("button",{key:j.id,onClick:Qi=>Wt(j),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",Zi,B((dt=j.inspection_point)==null?void 0:dt.name),1),e("div",Gi,B((Mt=j.inspection_point)==null?void 0:Mt.description),1),e("div",Pi,B(Ye(j)),1),Xe(j.inspection_point_id)?(o(),n("div",Ji," ✓ Sudah ada data ")):c("",!0)],8,Ki)}),128))])])]),_:1},8,["show"]),ue.value?(o(),De(pt,{key:(J=L.value)==null?void 0:J.id,show:ue.value,title:((ce=(ae=L.value)==null?void 0:ae.inspection_point)==null?void 0:ce.name)||"Detail Point",subtitle:(Ue=(_e=L.value)==null?void 0:_e.inspection_point)==null?void 0:Ue.description,name:`point-${(ve=L.value)==null?void 0:ve.id}`,"inspection-id":t.inspection.id,"point-id":(qe=L.value)==null?void 0:qe.inspection_point_id,settings:((Be=L.value)==null?void 0:Be.settings)||{},options:((tt=(je=L.value)==null?void 0:je.settings)==null?void 0:tt.radios)||[],"selected-Point":L.value,"selected-value":ye.value,"images-value":X(F).images[(Ee=L.value)==null?void 0:Ee.inspection_point_id],"notes-value":fe.value,point:L.value,"existing-data":nt((ze=L.value)==null?void 0:ze.inspection_point_id),"onUpdate:selectedValue":l[22]||(l[22]=j=>ye.value=j),"onUpdate:notesValue":l[23]||(l[23]=j=>fe.value=j),"onUpdate:imagesValue":Kt,onSave:Zt,onClose:rt,onHapus:ht},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):c("",!0),v.value?(o(),n("div",Xi,l[42]||(l[42]=[e("p",{class:"text-sm"},"Tekan sekali lagi untuk keluar dari inspeksi",-1),e("p",{class:"text-xs text-gray-300 mt-1"},"Data inspeksi telah disimpan secara lokal",-1)]))):c("",!0)],2)])}}},il=Ae(Yi,[["__scopeId","data-v-d494ab92"]]);export{il as default};
