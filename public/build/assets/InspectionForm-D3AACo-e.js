import{x as je,d as _,m as ke,z as _e,A as re,e as l,o as n,a as e,f as y,b as de,p as ce,v as we,u as G,F as oe,h as ae,t as q,g as ue,k as be,w as me,l as J,n as ne,C as ye,D as Ue,c as se,r as Te,T as Ce,E as Ie,W as Se,G as Re}from"./app-kDmSYEi6.js";import{l as xe}from"./lodash-Bef2NTOi.js";import{_ as qe}from"./PrimaryButton-Dfet85IJ.js";import{_ as Le}from"./ActionMessage-0q8wGmBn.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Pe}from"./InputNumber-CAEH3SZc.js";const Ae={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Be={key:0,class:"p-4 space-y-4"},Fe={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},Ee={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},ze={class:"relative"},He={key:0,class:"absolute right-3 top-3"},Oe={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},We={key:0},Ke=["onMousedown"],Xe={class:"font-medium text-gray-900"},Ge={class:"text-sm text-gray-500"},Ze={key:1,class:"p-4 text-sm text-gray-500 text-center"},Ye={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Je={key:0,class:"mb-4"},Qe=["innerHTML"],et={key:1},tt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},st=["onClick"],ot=["src","alt"],at={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},nt={class:"text-white text-xs text-center"},lt={key:2,class:"text-center py-4 text-gray-500 text-sm"},it={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},rt=["src","alt"],ut={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},dt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},ct={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},mt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(t,{emit:V}){var z,O,Q,le;const a=t,k=V,r=je({plate_number:((z=a.inspection)==null?void 0:z.plate_number)||"",car_id:((O=a.inspection)==null?void 0:O.car_id)||null,car_name:((le=(Q=a.inspection)==null?void 0:Q.car)==null?void 0:le.name)||""}),i=_(r.car_name),h=_(!1),u=_(!1),g=_([]),b=_(null),p=_([]),s=_(!1),f=_(0);ke(()=>{var C,$,Z,o;if((C=a.inspection)!=null&&C.car_id&&(($=a.CarDetail)==null?void 0:$.length)>0){const d=a.CarDetail.find(m=>m.id===a.inspection.car_id);d&&E(d)}else!((Z=a.inspection)!=null&&Z.car_id)&&((o=a.inspection)!=null&&o.car_name)&&(i.value=a.inspection.car_name);window.addEventListener("keydown",R)}),_e(()=>{window.removeEventListener("keydown",R)}),re(i,C=>{r.car_id&&I(b.value)!==C&&(r.car_id=null,b.value=null,p.value=[]),r.car_name=C});const I=C=>{var Z,o,d;if(!C)return"";const $=[];return(Z=C.brand)!=null&&Z.name&&$.push(C.brand.name),(o=C.model)!=null&&o.name&&$.push(C.model.name),(d=C.type)!=null&&d.name&&$.push(C.type.name),C.cc&&$.push(`${C.cc}cc`),C.transmission&&$.push(C.transmission),C.fuel_type&&$.push(C.fuel_type),C.year&&$.push(C.year.toString()),C.production_period&&$.push(`(${C.production_period})`),$.join(" ")},L=xe.debounce(()=>{if(!i.value.trim()){g.value=[],h.value=!1;return}u.value=!0;try{const C=i.value.toLowerCase().trim();g.value=a.CarDetail.filter($=>I($).toLowerCase().includes(C)),h.value=!0}finally{u.value=!1}},300),U=()=>{setTimeout(()=>{h.value=!1},200)},E=async C=>{b.value=C,i.value=I(C),r.car_id=C.id,r.car_name=I(C),h.value=!1,await j(C.id),X()},A=C=>!C||!C.file_path?"":`/storage/${C.file_path}`,j=async C=>{try{const $=await fetch(`/api/cars/${C}/images`);if($.ok){const Z=await $.json();p.value=Array.isArray(Z)?Z:[]}else p.value=[]}catch($){console.error("Error loading car images:",$),p.value=[]}},F=C=>{f.value=C,s.value=!0,document.body.style.overflow="hidden"},P=()=>{s.value=!1,document.body.style.overflow=""},x=()=>{f.value=(f.value+1)%p.value.length},T=()=>{f.value=(f.value-1+p.value.length)%p.value.length},R=C=>{if(s.value)switch(C.key){case"Escape":P();break;case"ArrowRight":x();break;case"ArrowLeft":T();break}},X=()=>{const C={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name};k("update-vehicle",C)},ee=()=>{a.inspection&&r.post(route("inspections.updateVehicleDetails",{inspection:a.inspection.id}),{preserveScroll:!0})};return re(()=>a.inspection,C=>{var $;if(C)if(r.plate_number=C.plate_number||"",r.car_id=C.car_id||null,C.car_id&&(($=a.CarDetail)==null?void 0:$.length)>0){const Z=a.CarDetail.find(o=>o.id===C.car_id);Z&&E(Z)}else C.car_name&&(i.value=C.car_name,r.car_name=C.car_name)},{deep:!0}),(C,$)=>{var Z;return n(),l("div",Ae,[$[17]||($[17]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(n(),l("div",Be,[e("div",Fe,[$[6]||($[6]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nomor Plat Kendaraan ",-1)),ce(e("input",{"onUpdate:modelValue":$[0]||($[0]=o=>G(r).plate_number=o),type:"text",placeholder:"Contoh: B 1234 ABC",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:X},null,544),[[we,G(r).plate_number]])]),e("div",Ee,[$[9]||($[9]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",ze,[ce(e("input",{"onUpdate:modelValue":$[1]||($[1]=o=>i.value=o),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:$[2]||($[2]=(...o)=>G(L)&&G(L)(...o)),onFocus:$[3]||($[3]=o=>h.value=!0),onBlur:U},null,544),[[we,i.value]]),u.value?(n(),l("div",He,$[7]||($[7]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):y("",!0),h.value?(n(),l("div",Oe,[g.value.length>0?(n(),l("div",We,[(n(!0),l(oe,null,ae(g.value,o=>(n(),l("div",{key:o.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:d=>E(o)},[e("div",Xe,q(I(o)),1),e("div",Ge,q(o.year)+" • "+q(o.cc)+"cc • "+q(o.transmission)+" • "+q(o.fuel_type),1)],40,Ke))),128))])):(n(),l("div",Ze,$[8]||($[8]=[ue(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),ue(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):y("",!0)]),ce(e("input",{type:"hidden","onUpdate:modelValue":$[4]||($[4]=o=>G(r).car_id=o)},null,512),[[we,G(r).car_id]])]),G(r).car_id&&b.value?(n(),l("div",Ye,[b.value.description?(n(),l("div",Je,[$[10]||($[10]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:b.value.description},null,8,Qe)])):y("",!0),p.value.length>0?(n(),l("div",et,[$[11]||($[11]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",tt,[(n(!0),l(oe,null,ae(p.value,(o,d)=>(n(),l("div",{key:o.id||d,class:"relative group cursor-pointer",onClick:m=>F(d)},[e("img",{src:A(o),alt:o.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ot),o.note?(n(),l("div",at,[e("p",nt,q(o.note),1)])):y("",!0)],8,st))),128))])])):(n(),l("div",lt," Tidak ada gambar tersedia untuk mobil ini "))])):y("",!0),s.value?(n(),l("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:P},[e("div",it,[e("button",{onClick:P,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},$[12]||($[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),p.value.length>1?(n(),l("button",{key:0,onClick:be(T,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},$[13]||($[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),p.value.length>1?(n(),l("button",{key:1,onClick:be(x,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},$[14]||($[14]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0),e("img",{src:A(p.value[f.value]),alt:"Car Image "+(f.value+1),class:"max-w-full max-h-full object-contain",onClick:$[5]||($[5]=be(()=>{},["stop"]))},null,8,rt),p.value.length>1?(n(),l("div",ut,q(f.value+1)+" / "+q(p.value.length),1)):y("",!0),(Z=p.value[f.value])!=null&&Z.note?(n(),l("div",dt,q(p.value[f.value].note),1)):y("",!0)])])):y("",!0),de(qe,{type:"button",onClick:ee,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},{default:me(()=>[G(r).processing?(n(),l("svg",ct,$[15]||($[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),e("span",null,q(G(r).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),de(Le,{on:G(r).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:me(()=>$[16]||($[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ue(" Tersimpan. ")])),_:1,__:[16]},8,["on"])]),_:1})])):y("",!0)])}}},gt=ge(mt,[["__scopeId","data-v-04b281af"]]),vt={class:"mt-1"},pt=["value","required","minlength","maxlength","allowSpace","placeholder"],ht={key:0,class:"mt-2 text-sm text-red-600"},ft={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,k=V,r=J(()=>{if(!a.modelValue)return"";let h=a.modelValue;switch(a.allowSpace||(h=h.replace(/\s+/g,"")),a.textTransform){case"uppercase":return h.toUpperCase();case"lowercase":return h.toLowerCase();case"capitalize":return h.replace(/\b\w/g,u=>u.toUpperCase());default:return h}}),i=h=>{let u=h.target.value;switch(a.allowSpace||(u=u.replace(/\s+/g,"")),a.textTransform){case"uppercase":u=u.toUpperCase();break;case"lowercase":u=u.toLowerCase();break;case"capitalize":u=u.replace(/\b\w/g,g=>g.toUpperCase());break}k("update:modelValue",u),k("save",a.pointId)};return(h,u)=>(n(),l("div",vt,[e("input",{value:r.value,onInput:i,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,pt),t.error?(n(),l("p",ht,q(t.error),1)):y("",!0)]))}},wt={class:"mt-1"},yt=["value","required","min","max"],bt={key:0,class:"mt-2 text-sm text-red-600"},xt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,k=V,r=i=>{k("update:modelValue",i.target.value),k("save",a.pointId)};return(i,h)=>(n(),l("div",wt,[e("input",{value:t.modelValue,onChange:r,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,yt),t.error?(n(),l("p",bt,q(t.error),1)):y("",!0)]))}},kt={class:"mt-1"},$t=["value","required","placeholder"],It={key:0,class:"mt-2 text-sm text-red-600"},Ct={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,k=V,r=_(""),i=J(()=>{var p,s,f,I;return{currency_symbol:((p=a.settings)==null?void 0:p.currency_symbol)||"Rp",thousands_separator:((s=a.settings)==null?void 0:s.thousands_separator)||",",min_value:((f=a.settings)==null?void 0:f.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((I=a.settings)==null?void 0:I.max_value)!==void 0?Number(a.settings.max_value):1e9}}),h=p=>{if(p==null||p==="")return"";const s=Number(p);if(isNaN(s))return"";let f=s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return i.value.thousands_separator!==","&&(f=f.replace(/,/g,i.value.thousands_separator)),f},u=p=>p?p.replace(/[^\d]/g,""):"",g=J(()=>r.value?`${i.value.currency_symbol} ${h(r.value)}`:""),b=p=>{let s=u(p.target.value),f=Number(s);i.value.min_value!==void 0&&f<i.value.min_value&&(s=i.value.min_value.toString()),i.value.max_value!==void 0&&f>i.value.max_value&&(s=i.value.max_value.toString()),r.value=s,k("update:modelValue",s),k("save",a.pointId)};return re(()=>a.modelValue,p=>{p!=null&&(r.value=p.toString())},{immediate:!0}),(p,s)=>(n(),l("div",kt,[e("input",{value:g.value,onInput:b,type:"text",required:t.required,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,$t),t.error?(n(),l("p",It,q(t.error),1)):y("",!0)]))}},St={class:"mt-1 space-y-3"},Vt={key:0,class:"space-y-2"},_t={class:"flex flex-wrap gap-2"},Mt=["onClick"],Ut=["value","required","minlength","maxlength","placeholder"],Tt={class:"flex justify-between items-center mt-1"},jt={class:"text-xs text-gray-500"},Nt={key:0,class:"text-xs text-red-600"},Ne={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,k=V,r=_([]),i=_(""),h=p=>r.value.some(s=>s.value===p),u=p=>{h(p.value)?r.value=r.value.filter(L=>L.value!==p.value):r.value.push(p);const f=[...r.value.map(L=>L.value)];i.value.trim()&&f.push(i.value.trim());const I=f.join(", ");k("update:modelValue",I),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:I})},g=p=>{const s=p.target.value;k("update:modelValue",s),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:s}),b(s)},b=p=>{var L,U,E,A;if(!p){r.value=[],i.value="";return}const s=p.split(",").map(j=>j.trim()).filter(j=>j),f=((U=(L=a.settings)==null?void 0:L.damage_options)==null?void 0:U.map(j=>j.value))||[];r.value=((A=(E=a.settings)==null?void 0:E.damage_options)==null?void 0:A.filter(j=>s.includes(j.value)))||[];const I=s.filter(j=>!f.includes(j));i.value=I.join(", ")};return re(()=>a.modelValue,p=>{p!=null&&b(p)},{immediate:!0}),(p,s)=>{var f,I,L;return n(),l("div",St,[(f=t.settings)!=null&&f.enable_damage&&((I=t.settings)!=null&&I.damage_options)?(n(),l("div",Vt,[s[0]||(s[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",_t,[(n(!0),l(oe,null,ae(t.settings.damage_options,(U,E)=>(n(),l("button",{key:E,type:"button",onClick:A=>u(U),class:ne(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":h(U.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!h(U.value)}])},q(U.label),11,Mt))),128))])])):y("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:g,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Ut),e("div",Tt,[e("span",jt,q(((L=t.modelValue)==null?void 0:L.length)||0)+"/"+q(t.maxLength||400),1),t.error?(n(),l("p",Nt,q(t.error),1)):y("",!0)])])])}}},Dt={class:"mt-1"},Rt=["value","required"],qt={key:0,class:"mt-2 text-sm text-red-600"},Lt={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,k=V,r=i=>{k("update:modelValue",i.target.value),k("save",a.pointId)};return(i,h)=>(n(),l("div",Dt,[e("select",{value:t.modelValue,onChange:r,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},h[0]||(h[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Rt),t.error?(n(),l("p",qt,q(t.error),1)):y("",!0)]))}},Pt=ge(Lt,[["__scopeId","data-v-c34a74db"]]),At={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Bt={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Ft={class:"flex flex-row space-x-4 mb-6"},Et={class:"mt-4 text-right"},zt={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(V,a)=>t.show?(n(),l("div",At,[e("div",Bt,[a[5]||(a[5]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),e("div",Ft,[e("button",{onClick:a[0]||(a[0]=k=>V.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[3]||(a[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:a[1]||(a[1]=k=>V.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[4]||(a[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",Et,[e("button",{onClick:a[2]||(a[2]=k=>V.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):y("",!0)}},Ht={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Ot={class:"webcam-content-box"},Wt={class:"webcam-header"},Kt={class:"inspection-point-name"},Xt={key:0,class:"screen-flash-overlay"},Gt={class:"absolute top-4 right-4 z-10 flex flex-col items-end gap-2 text-white"},Zt={key:0,class:"px-2 py-1 bg-black bg-opacity-50 rounded-lg text-xs"},Yt={class:"webcam-footer"},Jt={class:"camera-controls"},Qt=["disabled"],es={class:"camera-icon-container"},ts={key:0,class:"camera-spinner"},ss={key:1,class:"camera-body"},os={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:V}){const a=t,k=V,r=_(null),i=_(null);let h=null,u=null;const g=_("environment"),b=_(!1),p=_(!1),s=_(!1),f=_(!1),I=_(!1),L=_({}),U=_(!1),E=_(!1),A=_(1),j=_(0),F=J(()=>{var o;return((o=a.settings)==null?void 0:o.max_size)||2048}),P=J(()=>({aspectRatio:a.aspectRatio?`${a.aspectRatio} / 1`:"4 / 3"})),x=async()=>{h&&h.getTracks().forEach(o=>o.stop());try{const o={facingMode:g.value,width:{ideal:1920,max:3840},height:{ideal:1080,max:2160},aspectRatio:{exact:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"manual"}]};h=await navigator.mediaDevices.getUserMedia({video:o,audio:!1}),u=h.getVideoTracks()[0],r.value.srcObject=h,r.value.onloadedmetadata=async()=>{await r.value.play(),await R()}}catch(o){console.error("Error accessing camera: ",o),alert("Failed to access camera. Please allow camera permission."),k("close")}},T=()=>{h&&h.getTracks().forEach(o=>o.stop()),k("close")},R=async()=>{if(u)try{const o=await navigator.mediaDevices.enumerateDevices();b.value=o.filter(m=>m.kind==="videoinput").length>1;const d=u.getCapabilities();p.value=d.torch||d.fillLightMode&&d.fillLightMode.includes("torch"),E.value=!!d.zoom,E.value&&(A.value=d.zoom.min||1,u.applyConstraints({advanced:[{zoom:A.value}]}))}catch(o){console.error("Error checking camera capabilities:",o)}},X=async o=>{if(!u)return;const d=r.value.getBoundingClientRect(),m=o.clientX-d.left,D=o.clientY-d.top;I.value=!0,L.value={left:`${m}px`,top:`${D}px`,transform:"translate(-50%, -50%)"};try{if(u.getCapabilities().pointsOfInterest){const w=m/d.width,W=D/d.height;await u.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:w,y:W}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(S){console.warn("Manual focus failed:",S)}setTimeout(()=>{I.value=!1},1e3)},ee=o=>{const d=o[0].clientX-o[1].clientX,m=o[0].clientY-o[1].clientY;return Math.sqrt(d*d+m*m)},z=o=>{o.touches.length===2&&E.value?j.value=ee(o.touches):o.touches.length===1&&X(o.touches[0])},O=o=>{if(o.touches.length===2&&j.value>0&&E.value){const d=u.getCapabilities(),m=ee(o.touches),D=m/j.value,S=Math.min(Math.max(d.zoom.min,A.value*D),d.zoom.max);A.value=S,u.applyConstraints({advanced:[{zoom:S}]}),j.value=m}},Q=()=>{j.value=0},le=async()=>{if(!(!u||!p.value))try{g.value==="user"?(s.value=!s.value,f.value=s.value):(await u.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value)}catch(o){console.error("Flash toggle failed:",o)}},C=async()=>{b.value&&(g.value=g.value==="environment"?"user":"environment",h&&h.getTracks().forEach(o=>o.stop()),await x())},$=async o=>new Promise(d=>{const m=F.value*1024;if(o.size<=m){d(o);return}const D=new Image,S=new FileReader;S.onload=w=>{D.onload=()=>{const W=document.createElement("canvas"),N=W.getContext("2d"),v=Math.sqrt(m/o.size);W.width=D.width*v,W.height=D.height*v,N.drawImage(D,0,0,W.width,W.height);let c=.9;const M=()=>{W.toBlob(B=>{B.size>m&&c>.1?(c-=.1,M()):d(B)},"image/jpeg",c)};M()},D.src=w.target.result},S.readAsDataURL(o)}),Z=async()=>{if(!(U.value||!r.value||!i.value)){U.value=!0;try{const o=r.value,d=i.value,m=o.videoWidth,D=o.videoHeight;let S,w,W,N;const v=a.aspectRatio;m/D>v?(w=D,S=D*v,W=(m-S)/2,N=0):(S=m,w=m/v,W=0,N=(D-w)/2),d.width=S,d.height=w,d.getContext("2d").drawImage(o,W,N,S,w,0,0,S,w);const B=await new Promise(Y=>{d.toBlob(Y,"image/jpeg",1)}),K=await $(B);if(K){const Y=new File([K],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});k("photoCaptured",Y),f.value=!0,setTimeout(()=>{f.value=!1},100)}}catch(o){console.error("Error capturing photo:",o),alert("Failed to capture photo. Please try again.")}finally{U.value=!1}}};return re(()=>a.show,o=>{o?x():T()}),_e(()=>{h&&h.getTracks().forEach(o=>o.stop())}),(o,d)=>{var m;return t.show?(n(),l("div",Ht,[e("div",Ot,[e("div",Wt,[e("div",Kt,q(((m=t.point)==null?void 0:m.name)||"Camera"),1),e("button",{onClick:T,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},d[0]||(d[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:ye(P.value),onClick:X,onTouchstart:z,onTouchmove:O,onTouchend:Q},[e("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video",style:ye({transform:`scale(${A.value})`})},null,4),e("canvas",{ref_key:"webcamCanvas",ref:i,class:"hidden"},null,512),f.value?(n(),l("div",Xt)):y("",!0),I.value?(n(),l("div",{key:1,class:"focus-indicator",style:ye(L.value)},d[1]||(d[1]=[e("div",{class:"focus-ring"},null,-1)]),4)):y("",!0),e("div",Gt,[d[2]||(d[2]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),E.value?(n(),l("div",Zt," Zoom: "+q((A.value*100).toFixed(0))+"% ",1)):y("",!0)])],36),e("div",Yt,[e("div",Jt,[t.settings.enable_flash&&p.value?(n(),l("button",{key:0,onClick:le,class:ne(["control-button",{active:s.value}])},d[3]||(d[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):y("",!0),e("button",{onClick:Z,class:"capture-button",disabled:U.value},[e("div",es,[U.value?(n(),l("div",ts)):(n(),l("div",ss,d[4]||(d[4]=[e("div",{class:"camera-lens"},null,-1)])))])],8,Qt),t.settings.enable_camera_switch&&b.value?(n(),l("button",{key:1,onClick:C,class:"control-button"},d[5]||(d[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):y("",!0)])])])])):y("",!0)}}},as=ge(os,[["__scopeId","data-v-dea51ce5"]]),ns={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},ls={class:"w-full h-full flex flex-col"},is={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},rs={class:"text-lg font-semibold"},us={class:"flex items-center gap-2"},ds={class:"flex-1 flex items-center justify-center overflow-hidden relative"},cs=["src"],ms={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},gs={class:"flex justify-between items-center w-full"},vs=["disabled"],ps={key:1,class:"flex-1"},hs=["disabled"],fs={class:"flex gap-3 w-full"},ws=["disabled"],ys={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},bs={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(t,{emit:V}){const a=t,k=V,r=_(0),i=_([]),h=_(0),u=_(0),g=J(()=>i.value.length>0?i.value[r.value]:null);re(()=>a.images,P=>{i.value=P.map(x=>({...x,rotation:x.rotation||0})),P.length===0&&a.show&&A()},{deep:!0,immediate:!0}),re(()=>a.show,P=>{P&&a.images.length>0&&(r.value=a.initialIndex)});const b=P=>P.preview||(P.image_path?`/${P.image_path}`:""),p=()=>{if(g.value){const P=(g.value.rotation+90)%360;i.value[r.value].rotation=P,k("update:images",i.value)}},s=()=>{r.value=r.value<i.value.length-1?r.value+1:0},f=()=>{r.value=r.value>0?r.value-1:i.value.length-1},I=P=>{h.value=P.touches[0].clientX},L=P=>{u.value=P.touches[0].clientX},U=()=>{h.value-u.value>50?s():u.value-h.value>50&&f(),h.value=0,u.value=0},E=()=>{a.isUploading||k("saveImages",i.value)},A=()=>{a.isUploading||k("close")},j=()=>{if(g.value&&!a.isUploading){const P=g.value,x=i.value.findIndex(T=>T.isNew&&P.isNew&&T.preview===P.preview||!T.isNew&&!P.isNew&&T.id===P.id);x!==-1&&(k("removePreviewImage",P),i.value.splice(x,1),k("update:images",i.value)),r.value>=i.value.length&&(r.value=Math.max(0,i.value.length-1)),i.value.length===0&&k("close")}},F=()=>{a.isUploading||k("triggerAddMorePhotos")};return(P,x)=>{var T;return t.show?(n(),l("div",ns,[e("div",ls,[e("div",is,[e("button",{onClick:A,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},x[0]||(x[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",rs,q(((T=t.point)==null?void 0:T.name)||"Preview")+" ("+q(r.value+1)+"/"+q(i.value.length)+") ",1),e("div",us,[g.value&&g.value.isNew?(n(),l("button",{key:0,onClick:j,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},x[1]||(x[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):y("",!0),e("button",{onClick:p,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},x[2]||(x[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))])]),e("div",ds,[e("div",{class:"relative w-full max-w-full",style:ye({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"}),onTouchstart:I,onTouchmove:L,onTouchend:U},[g.value?(n(),l("img",{key:0,src:b(g.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ye({transform:`rotate(${g.value.rotation}deg)`})},null,12,cs)):y("",!0)],36),i.value.length>1?(n(),l("button",{key:0,onClick:f,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},x[3]||(x[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),i.value.length>1?(n(),l("button",{key:1,onClick:s,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},x[4]||(x[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0)]),e("div",ms,[e("div",gs,[g.value&&!g.value.isNew?(n(),l("button",{key:0,onClick:j,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},x[5]||(x[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,vs)):(n(),l("div",ps)),t.allowMultiple&&i.value.length<t.maxFiles?(n(),l("button",{key:2,onClick:F,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},x[6]||(x[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ue(" Tambah Foto ")]),8,hs)):y("",!0)]),e("div",fs,[e("button",{onClick:A,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:t.isUploading}," Batal ",8,ws),t.isUploading?(n(),l("button",ys,x[7]||(x[7]=[ue(" Menyimpan"),e("span",{class:"loading-dots ml-1"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1)]))):(n(),l("button",{key:0,onClick:E,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):y("",!0)}}},xs=ge(bs,[["__scopeId","data-v-4ea64c3d"]]),ks=["accept","multiple","disabled"],$s=["disabled"],Is={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Cs={class:"text-xs text-gray-400 mt-1"},Ss={key:0,class:"flex items-center gap-4"},Vs=["src"],_s=["disabled"],Ms={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Us=["disabled"],Ts=["onClick"],js=["src"],Ns={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ds={key:0},Rs={key:1,class:"ml-1"},qs={key:2,class:"mt-1 text-xs text-red-600"},Ls={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(t,{emit:V}){const a=t,k=V,r=_(null),i=_(null),h=_(!1),u=_(!1),g=_(!1),b=_([]),p=_(0),s=_(!1),f=J(()=>Number(a.settings.max_files)>1),I=J(()=>a.settings.allowed_types.map(o=>`.${o}`).join(", ")),L=J(()=>{const o=a.settings.camera_aspect_ratio.split(":");if(o.length===2){const d=parseFloat(o[0]),m=parseFloat(o[1]);if(!isNaN(d)&&!isNaN(m)&&m!==0)return d/m}return 3/4}),U=J(()=>{const o=[],d=new Set;for(const m of b.value)m.id&&d.add(m.id),o.push(m);for(const m of a.modelValue)d.has(m.id)||o.push({...m,rotation:m.rotation||0,isNew:!1,preview:m.preview||(m.image_path?`/${m.image_path}`:null)});return o}),E=o=>o.preview||(o.image_path?`/${o.image_path}`:""),A=()=>{g.value&&(g.value=!1),h.value=!0},j=()=>{h.value=!1,r.value.click()},F=()=>{h.value=!1,u.value=!0},P=()=>{h.value=!1,U.value.length>0&&(g.value=!0)},x=()=>{u.value=!1,U.value.length>0&&(g.value=!0)},T=()=>{g.value=!1,b.value.forEach(o=>{o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview)}),b.value=[]},R=o=>new Promise(d=>{const m=new FileReader;m.onload=D=>{const S=new Image;S.onload=()=>{d({file:o,preview:URL.createObjectURL(o),rotation:0,width:S.naturalWidth,height:S.naturalHeight,isNew:!0})},S.onerror=()=>{console.error("Failed to load image for dimensions:",o.name),d({file:o,preview:URL.createObjectURL(o),rotation:0,width:0,height:0,isNew:!0})},S.src=D.target.result},m.readAsDataURL(o)}),X=o=>{const d=o.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes(d)},ee=async o=>{const m=(a.settings.max_size||2048)*1024;return new Promise(D=>{const S=new Image,w=new FileReader;w.onload=W=>{S.onload=()=>{const N=document.createElement("canvas"),v=N.getContext("2d"),c=Math.max(S.width,S.height);N.width=c,N.height=c,v.fillStyle="white",v.fillRect(0,0,c,c);const M=(c-S.width)/2,B=(c-S.height)/2;v.drawImage(S,M,B,S.width,S.height);let K=.9;const Y=()=>{N.toBlob(te=>{if(te.size>m&&K>.1)K-=.1,Y();else{const ie=new File([te],o.name,{type:"image/jpeg",lastModified:Date.now()});D(ie)}},"image/jpeg",K)};Y()},S.src=W.target.result},w.readAsDataURL(o)})},z=async o=>{const d=Array.from(o.target.files);if(!d.length){h.value=!1,U.value.length>0&&(g.value=!0);return}try{const m=d.filter(v=>!X(v));if(m.length>0){const v=m.map(c=>c.name.split(".").pop()).join(", ");alert(`File type not allowed: ${v}. Allowed types: ${a.settings.allowed_types.join(", ")}`),o.target.value="";return}const D=U.value.length,S=a.settings.max_files-D,w=await Promise.all(d.slice(0,S).map(async v=>await ee(v))),W=await Promise.all(w.map(R)),N=f.value?W:W.slice(0,1);f.value?b.value.push(...N):(b.value.forEach(v=>{v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}),b.value=N),h.value=!1,N.length>0?(p.value=Math.max(0,U.value.length-N.length),g.value=!0):U.value.length>0&&(g.value=!0),o.target.value=""}catch(m){console.error("Error processing selected images:",m),alert("Failed to process selected images. Please try again."),h.value=!1,U.value.length>0&&(g.value=!0)}},O=async o=>{const d=U.value.length;if(!f.value||d<a.settings.max_files)try{const m=await ee(o),D=new Image;D.onload=()=>{const S={file:m,preview:URL.createObjectURL(m),rotation:0,width:D.naturalWidth,height:D.naturalHeight,isNew:!0};f.value?b.value.push(S):(b.value.forEach(w=>{w.preview&&w.preview.startsWith("blob:")&&URL.revokeObjectURL(w.preview)}),b.value=[S]),u.value=!1,h.value=!1,p.value=U.value.length-1,g.value=!0},D.src=URL.createObjectURL(m)}catch(m){console.error("Error processing captured image:",m),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),u.value=!1,h.value=!1,U.value.length>0&&(g.value=!0)},Q=(o=0)=>{p.value=o,g.value=!0},le=o=>new Promise(d=>{if(o.rotation===0||!i.value){if(!o.isNew&&!o.file){d({file:null,width:o.width,height:o.height,isOriginal:!0});return}d({file:o.file,width:o.width,height:o.height});return}const m=new Image;m.onload=async()=>{try{const D=i.value,S=D.getContext("2d"),w=m.width,W=m.height;let N,v;o.rotation===90||o.rotation===270?(N=W,v=w):(N=w,v=W),D.width=N,D.height=v,S.clearRect(0,0,D.width,D.height),S.translate(D.width/2,D.height/2),S.rotate(o.rotation*Math.PI/180),S.drawImage(m,-w/2,-W/2,w,W),S.setTransform(1,0,0,1,0,0);const c=await new Promise(K=>{D.toBlob(K,"image/jpeg",.9)}),M=new File([c],o.file?o.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),B=await ee(M);d({file:B,width:N,height:v})}catch(D){console.error("Error processing rotated image:",D),d({file:o.file,width:o.width,height:o.height})}},m.onerror=()=>{console.error("Failed to load image for rotation processing:",o.preview),d({file:o.file,width:o.width,height:o.height})},m.src=o.preview}),C=async o=>{var D,S,w,W;s.value=!0;const d=[],m=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),s.value=!1;return}try{for(const N of o){if(!N.isNew&&N.rotation===0&&N.id&&N.image_path){d.push({id:N.id,image_path:N.image_path,width:N.width,height:N.height,rotation:0,preview:N.preview});continue}const{file:v,width:c,height:M,isOriginal:B}=await le(N);if(B&&!N.isNew){d.push({id:N.id,image_path:N.image_path,width:N.width,height:N.height,rotation:0,preview:N.preview});continue}v&&m.push({file:v,width:c,height:M,rotation:0})}if(m.length>0){const N=new FormData;N.append("inspection_id",a.inspectionId),N.append("point_id",a.pointId),m.forEach(M=>{N.append("images[]",M.file)});const c=(await Ue.post(route("inspections.upload-image"),N,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const M of c)d.push({id:M.image_id,image_path:M.path,width:M.width||0,height:M.height||0,rotation:M.rotation||0,preview:M.public_url});m.forEach(M=>{M.file&&M.file.preview&&M.file.preview.startsWith("blob:")&&URL.revokeObjectURL(M.file.preview)})}k("update:modelValue",d),k("save",a.pointId),k("uploaded",{pointId:a.pointId,images:d}),T()}catch(N){if(console.error("Error during image processing/upload:",N),(S=(D=N.response)==null?void 0:D.data)!=null&&S.message)alert(`Failed to save images: ${N.response.data.message}`);else if((W=(w=N.response)==null?void 0:w.data)!=null&&W.errors){const v=Object.values(N.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${v}`)}else alert(`Failed to save images: ${N.message}`)}finally{s.value=!1}},$=o=>{if(o){if(o.id&&!o.isNew)Z(o);else{const d=b.value.findIndex(m=>m.preview&&m.preview===o.preview&&m.isNew||m.id&&m.id===o.id);if(d!==-1){const m=b.value.splice(d,1)[0];m.preview&&m.preview.startsWith("blob:")&&URL.revokeObjectURL(m.preview)}k("update:modelValue",a.modelValue.filter(m=>!(m.id&&m.id===o.id)&&!(m.preview&&m.preview===o.preview)))}p.value>=U.value.length&&(p.value=Math.max(0,U.value.length-1)),U.value.length===0&&T()}},Z=async o=>{var m,D;if(o.id||o.image_path)try{await Ue.delete(route("inspections.delete-image"),{data:{image_id:o.id,image_path:o.image_path}})}catch(S){console.error("Error deleting image from server:",S),(D=(m=S.response)==null?void 0:m.data)!=null&&D.message?alert(`Failed to delete image from server: ${S.response.data.message}`):alert(`Failed to delete image from server: ${S.message}`);return}o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview);const d=a.modelValue.filter(S=>S.id!==o.id);k("update:modelValue",d),b.value=b.value.filter(S=>S.isNew&&o.isNew?S.preview!==o.preview:S.id!==o.id),k("removeImage",{image:o}),g.value&&U.value.length===0?T():g.value&&p.value>=U.value.length&&(p.value=Math.max(0,U.value.length-1))};return(o,d)=>(n(),l("div",null,[e("input",{ref_key:"galleryInput",ref:r,type:"file",accept:I.value,class:"hidden",onChange:z,multiple:f.value,disabled:s.value},null,40,ks),e("canvas",{ref_key:"processingCanvas",ref:i,class:"hidden"},null,512),U.value.length===0?(n(),l("label",{key:0,onClick:A,class:ne(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:s.value},[e("div",Is,[d[2]||(d[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),d[3]||(d[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),d[4]||(d[4]=e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),e("p",Cs,"Allowed types: "+q(I.value),1)])],8,$s)):(n(),l("div",{key:1,class:ne(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[t.settings.max_files===1?(n(),l("div",Ss,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:d[0]||(d[0]=m=>Q(0))},[e("img",{src:E(U.value[0]),class:"w-full h-full object-cover"},null,8,Vs)]),e("button",{onClick:d[1]||(d[1]=be(m=>Z(U.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:s.value},d[5]||(d[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,_s)])):(n(),l("div",Ms,[f.value&&U.value.length<t.settings.max_files?(n(),l("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:A,disabled:s.value},d[6]||(d[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Us)):y("",!0),(n(!0),l(oe,null,ae(U.value,(m,D)=>(n(),l("div",{key:m.id||m.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:S=>Q(D)},[e("img",{src:E(m),class:"w-full h-full object-cover"},null,8,js),m.isNew||m.rotation!==0?(n(),l("div",Ns,[m.isNew?(n(),l("span",Ds,"BARU")):y("",!0),m.rotation!==0?(n(),l("span",Rs,"ROTASI")):y("",!0)])):y("",!0)],8,Ts))),128))]))],2)),t.error?(n(),l("p",qs,q(t.error),1)):y("",!0),de(zt,{show:h.value,onClose:P,onOpenWebcam:F,onTriggerGallery:j},null,8,["show"]),de(as,{show:u.value,"aspect-ratio":L.value,settings:t.settings,point:t.point,onClose:x,onPhotoCaptured:O},null,8,["show","aspect-ratio","settings","point"]),de(xs,{show:g.value,images:U.value,point:t.point,"initial-index":p.value,"allow-multiple":f.value,"max-files":t.settings.max_files,"is-uploading":s.value,"aspect-ratio":L.value,onClose:T,onSaveImages:C,onRemovePreviewImage:$,onTriggerAddMorePhotos:A},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},Ve=ge(Ls,[["__scopeId","data-v-396cd9aa"]]),Ps={key:0,class:"fixed inset-0 z-50 overflow-hidden"},As={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Bs={class:"px-4 pb-2 border-b border-gray-200"},Fs={class:"text-lg font-semibold text-gray-900"},Es={key:0,class:"text-sm text-gray-500 mt-1"},zs={class:"flex-1 overflow-y-auto p-4"},Hs={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Os={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:V}){const a=V,k=()=>{a("close")},r=i=>{i.key==="Escape"&&k()};return ke(()=>{document.addEventListener("keydown",r)}),_e(()=>{document.removeEventListener("keydown",r)}),(i,h)=>(n(),se(Ce,{name:"bottom-sheet"},{default:me(()=>[t.show?(n(),l("div",Ps,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:k}),e("div",As,[h[0]||(h[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Bs,[e("h3",Fs,q(t.title),1),t.subtitle?(n(),l("p",Es,q(t.subtitle),1)):y("",!0)]),e("div",zs,[Te(i.$slots,"default",{},void 0,!0)]),i.$slots.footer?(n(),l("div",Hs,[Te(i.$slots,"footer",{},void 0,!0)])):y("",!0)])])):y("",!0)]),_:3}))}},De=ge(Os,[["__scopeId","data-v-7893c2dc"]]),Ws={class:"space-y-4"},Ks={key:0,class:"mt-2"},Xs={class:"text-sm font-medium text-gray-700 mb-2"},Gs={key:0,class:"text-red-500"},Zs={key:0,class:"text-xs text-red-500"},Ys={key:1,class:"grid grid-cols-2 gap-2"},Js=["name","value","checked"],Qs={key:2,class:"space-y-2"},eo={key:0,class:"text-red-500"},to={key:1,class:"text-xs text-red-500"},so={key:3,class:"mt-4"},oo={class:"text-sm font-medium text-gray-700 mb-2"},ao={key:0,class:"text-red-500"},no={key:0,class:"text-xs text-red-500"},lo={class:"flex gap-2"},io=["disabled"],Me={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(t,{emit:V}){const a=t,k=V,r=u=>k("hapus",u),i=J(()=>a.options.find(u=>u.value===a.selectedValue)),h=J(()=>{var g,b,p;if(a.point.input_type==="imageTOradio"&&a.imagesValue.length===0||a.options.length&&!a.selectedValue)return!1;const u=i.value;return!(a.showTextarea&&((g=u==null?void 0:u.settings)!=null&&g.show_textarea)&&(!((b=a.notesValue)!=null&&b.trim())||u.settings.min_length&&a.notesValue.length<u.settings.min_length||u.settings.max_length&&a.notesValue.length>u.settings.max_length)||a.showImageUpload&&((p=u==null?void 0:u.settings)!=null&&p.show_image_upload)&&(a.imagesValue.length===0||u.settings.max_files&&a.imagesValue.length>u.settings.max_files))});return(u,g)=>(n(),se(De,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:g[10]||(g[10]=b=>u.$emit("close"))},{footer:me(()=>[t.selectedPoint?(n(),l("button",{key:0,onClick:g[7]||(g[7]=b=>r(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},g[12]||(g[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ue(" Hapus Data ")]))):y("",!0),e("div",lo,[e("button",{type:"button",onClick:g[8]||(g[8]=b=>u.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:g[9]||(g[9]=b=>u.$emit("save")),disabled:!h.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,io)])]),default:me(()=>{var b,p,s,f,I,L,U,E,A,j,F,P,x,T;return[e("div",Ws,[t.point.input_type==="imageTOradio"?(n(),l("div",Ks,[e("h4",Xs,[(b=t.point.settings)!=null&&b.required?(n(),l("span",Gs,"*")):y("",!0)]),de(Ve,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":g[0]||(g[0]=R=>u.$emit("update:imagesValue",R)),onSave:g[1]||(g[1]=R=>u.$emit("saveImage",R))},null,8,["model-value","point-id","point","inspection-id","settings"]),(p=t.point.settings)!=null&&p.required&&t.imagesValue.length===0?(n(),l("p",Zs," Foto wajib diupload ")):y("",!0)])):y("",!0),t.options.length?(n(),l("div",Ys,[(n(!0),l(oe,null,ae(t.options,(R,X)=>(n(),l("label",{key:X,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:R.value,checked:t.selectedValue===R.value,onChange:g[2]||(g[2]=ee=>u.$emit("update:selectedValue",ee.target.value)),class:"hidden peer"},null,40,Js),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===R.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==R.value}])},q(R.label),3)]))),128))])):y("",!0),t.showTextarea&&((f=(s=i.value)==null?void 0:s.settings)!=null&&f.show_textarea)?(n(),l("div",Qs,[(I=i.value.settings)!=null&&I.required?(n(),l("span",eo,"*")):y("",!0),de(Ne,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:i.value.settings,required:(L=i.value.settings)==null?void 0:L.required,"min-length":(U=i.value.settings)==null?void 0:U.min_length,"max-length":(E=i.value.settings)==null?void 0:E.max_length,placeholder:((A=i.value.settings)==null?void 0:A.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":g[3]||(g[3]=R=>u.$emit("update:notesValue",R)),onSave:g[4]||(g[4]=R=>u.$emit("saveTextarea",R))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(j=i.value.settings)!=null&&j.required&&!t.notesValue?(n(),l("p",to," Keterangan wajib diisi ")):y("",!0)])):y("",!0),t.showImageUpload&&((P=(F=i.value)==null?void 0:F.settings)!=null&&P.show_image_upload)?(n(),l("div",so,[e("h4",oo,[g[11]||(g[11]=ue(" Upload Foto ")),(x=i.value.settings)!=null&&x.required?(n(),l("span",ao,"*")):y("",!0)]),de(Ve,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:i.value.settings,"onUpdate:modelValue":g[5]||(g[5]=R=>u.$emit("update:imagesValue",R)),onSave:g[6]||(g[6]=R=>u.$emit("saveImage",R))},null,8,["model-value","point-id","point","inspection-id","settings"]),(T=i.value.settings)!=null&&T.required&&t.imagesValue.length===0?(n(),l("p",no," Foto wajib diupload ")):y("",!0)])):y("",!0)])]}),_:1},8,["show","title","subtitle"]))}},ro={class:"mt-2 space-y-4"},uo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},co=["name","value","checked","onChange","required"],mo={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},go={key:0,class:"mt-3"},vo={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},po=["src"],ho={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},fo={key:1,class:"mt-2"},wo={class:"text-sm text-gray-600"},yo={key:2,class:"mt-2 text-sm text-red-600"},bo={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:V}){const a=t,k=V,r=_(a.notes),i=_([...a.images]),h=_(!1),u=_(""),g=_([]),b=_(""),p=_([]),s=J(()=>a.options.find(x=>x.value===a.modelValue)),f=x=>x.settings&&(x.settings.show_textarea||x.settings.show_image_upload);re(()=>a.notes,x=>{r.value=x}),re(()=>a.images,x=>{i.value=[...x]}),re(()=>a.modelValue,x=>{x&&(b.value=x)});const I=x=>{k("update:modelValue",x.value),f(x)?U():k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:x.value,notes:"",images:[]})},L=x=>x.preview||(x.image_path?`/${x.image_path}`:x),U=()=>{b.value=a.modelValue,u.value=r.value,g.value=[...i.value],p.value=[...i.value],h.value=!0},E=()=>{u.value="",g.value=[],b.value="",h.value=!1},A=x=>{g.value=x,i.value=[...x],k("update:images",[...x]),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:r.value,images:[...x]})},j=x=>{},F=()=>{b.value!==a.modelValue&&k("update:modelValue",b.value),r.value=u.value,k("update:notes",u.value),i.value=[...g.value],k("update:images",[...g.value]),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:b.value,notes:u.value,images:g.value}),h.value=!1},P=x=>{k("hapus",x),h.value=!1};return(x,T)=>{var R,X,ee,z;return n(),l("div",ro,[e("div",uo,[(n(!0),l(oe,null,ae(t.options,(O,Q)=>(n(),l("label",{key:Q,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:O.value,checked:t.modelValue===O.value,onChange:le=>I(O),class:"hidden peer",required:t.required},null,40,co),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===O.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==O.value}])},q(O.label),3)]))),128))]),t.modelValue&&s.value&&f(s.value)?(n(),l("div",mo,[e("div",{class:"flex justify-between items-start"},[T[4]||(T[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:U,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((R=s.value.settings)!=null&&R.show_image_upload)?(n(),l("div",go,[e("div",vo,[(n(!0),l(oe,null,ae(t.images,(O,Q)=>(n(),l("div",{key:Q,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:L(O),class:"w-full h-full object-cover rounded"},null,8,po),Q===3&&t.images.length>4?(n(),l("span",ho," +"+q(t.images.length-4),1)):y("",!0)]))),128))])])):y("",!0),t.notes&&((X=s.value.settings)!=null&&X.show_textarea)?(n(),l("div",fo,[e("p",wo,q(t.notes),1)])):y("",!0)])):y("",!0),h.value?(n(),se(Me,{key:(ee=t.selectedPoint)==null?void 0:ee.id,show:h.value,title:t.pointName||"Detail",subtitle:(z=s.value)==null?void 0:z.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":b.value,"notes-value":u.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":T[0]||(T[0]=O=>b.value=O),"onUpdate:notesValue":T[1]||(T[1]=O=>u.value=O),"onUpdate:imagesValue":T[2]||(T[2]=O=>A(O)),onClose:E,onSave:F,onSaveTextarea:x.handleTextareaSave,onSaveImage:j,onHapus:T[3]||(T[3]=O=>P(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):y("",!0),t.error?(n(),l("p",yo,q(t.error),1)):y("",!0)])}}},xo={class:"mt-2 space-y-4"},ko={key:0,class:"flex flex-wrap gap-3"},$o={key:1,class:"p-4 border rounded-lg bg-gray-50"},Io={key:0,class:"mt-3"},Co={class:"flex gap-2 overflow-x-auto scrollbar-hide"},So=["src"],Vo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},_o={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},Mo=["name","value","checked"],Uo={key:1,class:"mt-2"},To={class:"text-sm text-gray-600"},jo={key:3,class:"mt-2 text-sm text-red-600"},No={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:V}){const a=t,k=V,r=_(a.notes),i=_([...a.images]),h=_(!1),u=_(""),g=_([]),b=_(""),p=_([]),s=J(()=>a.options.find(j=>j.value===a.modelValue)),f=j=>j.preview||(j.image_path?`/${j.image_path}`:j),I=()=>{b.value=a.modelValue||"",u.value=r.value,g.value=[...i.value],p.value=[...i.value],h.value=!0},L=()=>{u.value="",g.value=[],b.value="",h.value=!1},U=j=>{g.value=j,i.value=[...j],k("update:images",[...j]),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:r.value,images:[...j]})},E=()=>{b.value!==a.modelValue&&k("update:modelValue",b.value),r.value=u.value,k("update:notes",u.value),i.value=[...g.value],k("update:images",[...g.value]),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:b.value,notes:u.value,images:g.value}),h.value=!1},A=j=>{k("hapus",j),h.value=!1};return(j,F)=>{var P,x,T;return n(),l("div",xo,[!t.modelValue&&i.value.length===0&&!r.value?(n(),l("div",ko,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:I},F[4]||(F[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),l("div",$o,[e("div",{class:"flex justify-between items-start"},[F[5]||(F[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:I,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),i.value.length>0?(n(),l("div",Io,[e("div",Co,[(n(!0),l(oe,null,ae(i.value,(R,X)=>(n(),l("div",{key:X,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:f(R),class:"w-full h-full object-cover rounded"},null,8,So),X===3&&i.value.length>4?(n(),l("span",Vo," +"+q(i.value.length-4),1)):y("",!0)]))),128))])])):y("",!0),e("div",_o,[(n(!0),l(oe,null,ae(t.options,(R,X)=>(n(),l("label",{key:X,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:R.value,checked:t.modelValue===R.value,disabled:!0,class:"hidden peer"},null,8,Mo),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===R.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==R.value}])},q(R.label),3)]))),128))]),r.value&&((P=s.value.settings)!=null&&P.show_textarea)?(n(),l("div",Uo,[e("p",To,q(r.value),1)])):y("",!0)])),h.value?(n(),se(Me,{key:(x=t.selectedPoint)==null?void 0:x.id,show:h.value,title:t.pointName||"Detail",subtitle:(T=s.value)==null?void 0:T.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":b.value,"notes-value":u.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":F[0]||(F[0]=R=>b.value=R),"onUpdate:notesValue":F[1]||(F[1]=R=>u.value=R),"onUpdate:imagesValue":F[2]||(F[2]=R=>U(R)),onClose:L,onSave:E,onHapus:F[3]||(F[3]=R=>A(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):y("",!0),t.error?(n(),l("p",jo,q(t.error),1)):y("",!0)])}}},Do={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ro={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},qo={class:"text-xl font-semibold text-indigo-700"},Lo={class:"p-4 space-y-4"},Po={class:"flex items-start justify-between"},Ao={class:"block text-sm font-medium text-gray-700"},Bo={key:0,class:"text-red-500"},Fo={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Eo={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:V}){const a=t,k=V,r=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],i=b=>{var f,I,L,U,E;const p=a.form.results[b.id],s=a.form.images[b.id];if(!p)return!1;switch(b.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!p.note;case"select":case"radio":if(!p.status)return!1;const A=(f=b.settings.radios)==null?void 0:f.find(F=>F.value===p.status);return!(A!=null&&A.settings&&(A.settings.show_textarea&&!((I=p.note)!=null&&I.trim())||A.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!p.status)return!1;const j=(L=b.settings.radios)==null?void 0:L.find(F=>F.value===p.status);return!(j!=null&&j.settings&&j.settings.show_textarea&&!((U=p.note)!=null&&U.trim()));case"image":return s.length>0;default:return!!p.status||!!((E=p.note)!=null&&E.trim())}},h=(b,p)=>{k("updateResult",{pointId:b,value:p})},u=b=>{k("saveResult",b)},g=b=>{k("hapusPoint",b)};return(b,p)=>(n(),l("div",Do,[e("div",Ro,[e("h2",qo,q(t.category.name),1)]),e("div",Lo,[(n(!0),l(oe,null,ae(t.category.points,s=>{var f,I,L,U,E,A,j,F,P,x,T,R,X,ee,z,O,Q,le,C,$,Z,o,d,m,D,S;return n(),l("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",Po,[e("label",Ao,[ue(q(s.name)+" ",1),(f=s.settings)!=null&&f.is_required?(n(),l("span",Bo,"*")):y("",!0)]),i(s)?(n(),l("span",Fo," ✓ ")):y("",!0)]),s.input_type==="text"?(n(),se(ft,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[w=>t.form.results[s.id].note=w,w=>h(s.id,w)],required:(I=s.settings)==null?void 0:I.is_required,"min-length":(L=s.settings)==null?void 0:L.min_length,"max-length":(U=s.settings)==null?void 0:U.max_length,allowSpace:(E=s.settings)==null?void 0:E.allow_space,textTransform:(A=s.settings)==null?void 0:A.text_transform,placeholder:((j=s.settings)==null?void 0:j.placeholder)||"Masukan text",error:t.form.errors[`results.${s.id}.note`],onSave:w=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):y("",!0),s.input_type==="number"?(n(),se(Pe,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[w=>t.form.results[s.id].note=w,w=>h(s.id,w)],required:(F=s.settings)==null?void 0:F.is_required,min:(P=s.settings)==null?void 0:P.min,max:(x=s.settings)==null?void 0:x.max,step:((T=s.settings)==null?void 0:T.step)||1,placeholder:((R=s.settings)==null?void 0:R.placeholder)||"Masukan number",error:t.form.errors[`results.${s.id}.note`],onSave:w=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):y("",!0),s.input_type==="account"?(n(),se(Ct,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[w=>t.form.results[s.id].note=w,w=>h(s.id,w)],required:(X=s.settings)==null?void 0:X.is_required,placeholder:((ee=s.settings)==null?void 0:ee.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:w=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):y("",!0),s.input_type==="date"?(n(),se(xt,{key:3,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[w=>t.form.results[s.id].note=w,w=>h(s.id,w)],required:(z=s.settings)==null?void 0:z.is_required,"min-date":(O=s.settings)==null?void 0:O.min_date,"max-date":(Q=s.settings)==null?void 0:Q.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:w=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):y("",!0),s.input_type==="textarea"?(n(),se(Ne,{key:4,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[w=>t.form.results[s.id].note=w,w=>h(s.id,w)],required:(le=s.settings)==null?void 0:le.is_required,"min-length":(C=s.settings)==null?void 0:C.min_length,"max-length":($=s.settings)==null?void 0:$.max_length,placeholder:((Z=s.settings)==null?void 0:Z.placeholder)||"Masukkan teks di sini",settings:s.settings,error:t.form.errors[`results.${s.id}.note`],onSave:w=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):y("",!0),s.input_type==="radio"?(n(),se(bo,{key:5,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[w=>t.form.results[s.id].status=w,w=>h(s.id,w)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(o=s.settings)==null?void 0:o.is_required,"point-id":s.id,point:s,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((d=s.settings)==null?void 0:d.radios)||r,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":w=>t.form.results[s.id].note=w,"onUpdate:images":w=>t.form.images[s.id]=w,onSave:w=>u(s.id),onHapus:w=>g(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="imageTOradio"?(n(),se(No,{key:6,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[w=>t.form.results[s.id].status=w,w=>h(s.id,w)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(m=s.settings)==null?void 0:m.is_required,"point-id":s.id,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((D=s.settings)==null?void 0:D.radios)||r,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":w=>t.form.results[s.id].note=w,"onUpdate:images":w=>t.form.images[s.id]=w,onSave:w=>u(s.id),onHapus:w=>g(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="image"?(n(),se(Ve,{key:7,modelValue:t.form.images[s.id],"onUpdate:modelValue":w=>t.form.images[s.id]=w,error:t.form.errors[`images.${s.id}`],"inspection-id":t.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,"onUpdate:notes":w=>t.form.results[s.id].note=w,"onUpdate:status":w=>t.form.results[s.id].status=w},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):y("",!0),s.input_type==="select"?(n(),se(Pt,{key:8,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[w=>t.form.results[s.id].status=w,w=>h(s.id,w)],required:(S=s.settings)==null?void 0:S.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:w=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):y("",!0)])}),128))])]))}},zo=ge(Eo,[["__scopeId","data-v-54d0f511"]]),Ho={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Oo={class:"p-4 space-y-4-6"},Wo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ko=["value"],Xo={class:"p-4 space-y-4-6"},Go={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Zo=["value"],Yo={key:0,class:"p-4 space-y-4-6"},Jo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Qo=["value"],ea={class:"p-4 space-y-4-6"},ta={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(t){const V=t,a=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(f){return console.error("Error parsing settings JSON:",f),{}}return typeof s=="object"&&s!==null?s:{}},k=J(()=>a(V.inspection.settings).conclusion||{}),r=_({flooded:k.value.flooded||"",collision:k.value.collision||"",collision_severity:k.value.collision_severity||"",conclusion_note:V.inspection.notes||""}),i=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],h=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],u=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],g=()=>{const s={flooded:r.value.flooded,collision:r.value.collision,collision_severity:r.value.collision==="yes"?r.value.collision_severity:null,conclusion_note:r.value.conclusion_note};Se.post(route("inspections.updateConclusion",V.inspectionId),s,{preserveScroll:!0,preserveState:!0,onError:f=>{console.error("Error saving conclusion:",f)}})},b=xe.debounce(g,500);re([()=>r.value.flooded,()=>r.value.collision,()=>r.value.collision_severity],()=>{g()}),ke(()=>{p()}),re(()=>V.inspection,()=>{p()},{deep:!0});const p=()=>{const f=a(V.inspection.settings).conclusion||{};r.value={flooded:f.flooded||"",collision:f.collision||"",collision_severity:f.collision_severity||"",conclusion_note:V.inspection.notes||""}};return(s,f)=>(n(),l("div",Ho,[f[9]||(f[9]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),e("div",Oo,[f[5]||(f[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),e("div",Wo,[(n(),l(oe,null,ae(i,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":f[0]||(f[0]=L=>r.value.flooded=L),value:I.value,class:"hidden peer"},null,8,Ko),[[Ie,r.value.flooded]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.flooded===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.flooded!==I.value}])},q(I.label),3)])),64))])]),e("div",Xo,[f[7]||(f[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),e("div",Go,[(n(),l(oe,null,ae(h,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":f[1]||(f[1]=L=>r.value.collision=L),value:I.value,class:"hidden peer"},null,8,Zo),[[Ie,r.value.collision]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision!==I.value}])},q(I.label),3)])),64))]),r.value.collision==="yes"?(n(),l("div",Yo,[f[6]||(f[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),e("div",Jo,[(n(),l(oe,null,ae(u,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":f[2]||(f[2]=L=>r.value.collision_severity=L),value:I.value,class:"hidden peer"},null,8,Qo),[[Ie,r.value.collision_severity]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision_severity===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision_severity!==I.value}])},q(I.label),3)])),64))])])):y("",!0)]),e("div",ea,[f[8]||(f[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),ce(e("textarea",{"onUpdate:modelValue":f[3]||(f[3]=I=>r.value.conclusion_note=I),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:f[4]||(f[4]=(...I)=>G(b)&&G(b)(...I))},null,544),[[we,r.value.conclusion_note]])])]))}},sa={class:"container mx-auto px-4 py-2"},oa={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},aa={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},na=["onClick"],la={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ia={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ra={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},ua={class:"relative overflow-hidden"},da={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},ca=["disabled"],ma={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ga={class:"space-y-4"},va={class:"relative"},pa={class:"max-h-64 overflow-y-auto"},ha={key:0,class:"text-center py-4 text-gray-500"},fa=["onClick"],wa={class:"font-medium text-gray-900"},ya={class:"text-sm text-gray-500"},ba={class:"text-xs text-gray-400 mt-1"},xa={key:0,class:"text-xs text-green-600 mt-1"},ka={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup(t){var N;const V=t,a=_(!1),k=_(!1),r=_(""),i=_(null),h=_(""),u=_(""),g=_([]),b=_(""),p=(v,c)=>v.filter(M=>c?I(M.id):!0),s=J(()=>V.damagePoints||[]),f=J(()=>{if(!r.value.trim())return s.value;const v=r.value.toLowerCase().trim();return s.value.filter(c=>{var M,B,K;return((M=c.name)==null?void 0:M.toLowerCase().includes(v))||((B=c.description)==null?void 0:B.toLowerCase().includes(v))||((K=L(c))==null?void 0:K.toLowerCase().includes(v))})}),I=v=>{var M;const c=z.results[v];return c&&(c.status||c.note||((M=c.images)==null?void 0:M.length)>0)},L=v=>{const c=V.components.find(M=>M.id===v.component_id);return c?c.name:"Komponen Tidak Diketahui"},U=v=>v&&Array.isArray(V.existingResults)?V.existingResults.find(c=>c.point_id===v):null,E=v=>{i.value=v;const c=z.results[v.id]||{};h.value=c.status||"",u.value=c.note||"",g.value=Array.isArray(c.images)?[...c.images]:[],a.value=!1,k.value=!0},A=()=>{i.value&&(z.results[i.value.id]={...z.results[i.value.id],status:h.value,note:u.value,images:Array.isArray(g.value)?[...g.value]:[]},d(i.value.id),b.value="Data berhasil disimpan!",setTimeout(()=>{b.value=""},1e3)),F()},j=()=>{a.value=!1,r.value=""},F=()=>{k.value=!1,i.value=null,h.value="",u.value="",g.value=[]},x=Re().props.inspection,T=_(((N=V.appMenu[0])==null?void 0:N.id)||"conclusion"),R=_(0),X=J(()=>T.value!=="conclusion"?V.appMenu.find(v=>v.id===T.value):null);function ee(){const v={},c={};return V.appMenu.forEach(M=>{(M.points||[]).forEach(B=>{var te;const K=Array.isArray(V.existingResults)?V.existingResults.find(ie=>ie.point_id===B.id):null;v[B.id]={status:(K==null?void 0:K.status)||"",note:(K==null?void 0:K.note)||""};const Y=((te=V.existingImages)==null?void 0:te[B.id])||[];c[B.id]=Y.map(ie=>({id:ie.id,image_path:ie.image_path,preview:`/${ie.image_path}`,rotation:ie.rotation||0,isNew:!1}))})}),{inspection_id:V.inspection.id,results:v,images:c,overall_note:V.inspection.overall_note||""}}const z=je(ee()),O=v=>v.input_type==="damage"?!0:v.id==="conclusion"?le():v.points.every(c=>{var Y,te,ie,pe,he,fe;const M=z.results[c.id],B=z.images[c.id];if(!M)return!1;const K=Q(c.settings);switch(c.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((Y=M.note)!=null&&Y.trim());case"select":case"radio":if(!M.status)return!1;const H=(te=K.radios)==null?void 0:te.find($e=>$e.value===M.status);return!(H!=null&&H.settings&&(H.settings.show_textarea&&!((ie=M.note)!=null&&ie.trim())||H.settings.show_image_upload&&(B==null?void 0:B.length)===0));case"imageTOradio":if((B==null?void 0:B.length)===0||!M.status)return!1;const ve=(pe=K.radios)==null?void 0:pe.find($e=>$e.value===M.status);return!(ve!=null&&ve.settings&&ve.settings.show_textarea&&ve.settings.required&&!((he=M.note)!=null&&he.trim()));case"image":return(B==null?void 0:B.length)>0;default:return!!M.status||!!((fe=M.note)!=null&&fe.trim())}}),Q=v=>{if(!v)return{};if(typeof v=="string")try{return JSON.parse(v)||{}}catch(c){return console.error("Error parsing settings JSON:",c),{}}return typeof v=="object"&&v!==null?v:{}},le=()=>{var te;const c=Q(V.inspection.settings).conclusion||{},M=!!c.flooded,B=!!c.collision,K=c.collision==="yes"?!!c.collision_severity:!0,Y=!!((te=V.inspection.notes)!=null&&te.trim());return M&&B&&K&&Y},C=J(()=>{const c=Q(V.inspection.settings).conclusion||{};return{flooded:c.flooded||null,collision:c.collision||null,collision_severity:c.collision_severity||null,note:V.inspection.notes||null,isComplete:le()}}),$=v=>{T.value=v},Z=v=>{var B;let c=R.value+v;const M=V.appMenu.length;c>=0&&c<=M&&(R.value=c,T.value=((B=V.appMenu[c])==null?void 0:B.id)||"conclusion")},o=()=>{let v=0,c=0;const M=te=>{v=te.changedTouches[0].screenX},B=te=>{c=te.changedTouches[0].screenX,K()},K=()=>{c<v-150?Z(1):c>v+150&&Z(-1)},Y=document.querySelector(".relative.overflow-hidden");return Y&&(Y.addEventListener("touchstart",M,!1),Y.addEventListener("touchend",B,!1)),()=>{Y&&(Y.removeEventListener("touchstart",M),Y.removeEventListener("touchend",B))}},d=xe.debounce(async v=>{try{await Se.post(route("inspections.save-result"),{inspection_id:V.inspection.id,point_id:v,status:z.results[v].status,note:z.results[v].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(c){console.error("Error menyimpan hasil:",c)}},500),m=({pointId:v,type:c,value:M})=>{z.results[v].hasOwnProperty(c)&&(z.results[v][c]=M),d(v)},D=async v=>{if(v&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await Se.post(route("inspections.delete-result"),{inspection_id:V.inspection.id,point_id:v},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{z.results[v]&&delete z.results[v],b.value="Data berhasil dihapus!",setTimeout(()=>{b.value=""},2e3)}})}catch(c){console.error("Error menghapus hasil:",c)}F()}},S=v=>{Object.assign(z.conclusion,v),saveConclusion()},w=()=>{if(!W.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}z.post(route("inspections.final-submit",{id:V.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:v=>{console.error("Kesalahan pengiriman:",v)}})};re(T,v=>{const c=document.querySelector(`.flex-shrink-0[data-category-id="${v}"]`);c&&c.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const W=J(()=>{const v=V.appMenu.every(M=>O(M)),c=le();return v&&c});return re(r,xe.debounce(()=>{},300)),ke(()=>{o()}),(v,c)=>{var M,B,K,Y,te,ie,pe,he,fe;return n(),l("div",sa,[e("div",oa,[e("div",aa,[e("button",{onClick:c[0]||(c[0]=H=>$("vehicle")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":T.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":T.value!=="vehicle"}])}," Detail Kendaraan ",2),(n(!0),l(oe,null,ae(t.appMenu,H=>(n(),l("button",{key:H.id,onClick:ve=>$(H.id),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":T.value===H.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":T.value!==H.id}])},[ue(q(H.name)+" ",1),O(H)?(n(),l("span",la," ✓ ")):y("",!0)],10,na))),128)),e("button",{onClick:c[1]||(c[1]=H=>$("conclusion")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":T.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":T.value!=="conclusion"}])},[c[7]||(c[7]=ue(" Kesimpulan ")),C.value.isComplete?(n(),l("span",ia," ✓ ")):y("",!0)],2)])]),de(Ce,{name:"fade"},{default:me(()=>[b.value?(n(),l("div",ra,q(b.value),1)):y("",!0)]),_:1}),e("div",ua,[de(Ce,{name:"category-slide",mode:"out-in"},{default:me(()=>[T.value==="vehicle"?(n(),se(gt,{key:0,inspection:G(x),CarDetail:t.CarDetail,onUpdateVehicle:v.updateVehicleDetails,onSaveCarDetails:v.saveNewCarDetails},null,8,["inspection","CarDetail","onUpdateVehicle","onSaveCarDetails"])):X.value&&T.value!=="conclusion"?(n(),se(zo,{key:X.value.id,category:{...X.value,points:p(X.value.points||[],X.value.input_type==="damage")},"inspection-id":G(x).id,form:G(z),onSaveResult:G(d),onUpdateResult:m,onHapusPoint:D,onRemoveImage:v.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):T.value==="conclusion"?(n(),se(ta,{key:2,form:G(z),"inspection-id":G(x).id,inspection:G(x),settings:G(x).settings||{},onUpdateConclusion:S},null,8,["form","inspection-id","inspection","settings"])):y("",!0)]),_:1})]),T.value==="conclusion"?(n(),l("div",da,[e("button",{type:"button",onClick:w,disabled:!W.value||G(z).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[G(z).processing?(n(),l("svg",ma,c[8]||(c[8]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),e("span",null,q(G(z).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ca)])):y("",!0),!a.value&&!k.value?(n(),l("button",{key:1,onClick:c[2]||(c[2]=H=>a.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},c[9]||(c[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):y("",!0),de(De,{show:a.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:j},{default:me(()=>[e("div",ga,[e("div",va,[ce(e("input",{"onUpdate:modelValue":c[3]||(c[3]=H=>r.value=H),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[we,r.value]]),c[10]||(c[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",pa,[f.value.length===0?(n(),l("div",ha," Tidak ada point yang ditemukan ")):y("",!0),(n(!0),l(oe,null,ae(f.value,H=>(n(),l("button",{key:H.id,onClick:ve=>E(H),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",wa,q(H.name),1),e("div",ya,q(H.description),1),e("div",ba,q(L(H)),1),I(H.id)?(n(),l("div",xa," ✓ Sudah ada data ")):y("",!0)],8,fa))),128))])])]),_:1},8,["show"]),k.value?(n(),se(Me,{key:(M=i.value)==null?void 0:M.id,show:k.value,title:((B=i.value)==null?void 0:B.name)||"Detail Point",subtitle:(K=i.value)==null?void 0:K.description,name:`point-${(Y=i.value)==null?void 0:Y.id}`,"inspection-id":G(x).id,"point-id":(te=i.value)==null?void 0:te.id,settings:((ie=i.value)==null?void 0:ie.settings)||{},options:((he=(pe=i.value)==null?void 0:pe.settings)==null?void 0:he.radios)||[],"selected-Point":i.value,"selected-value":h.value,"images-value":G(z).images[i.value.id],"notes-value":u.value,point:i.value,"existing-data":U((fe=i.value)==null?void 0:fe.id),"onUpdate:selectedValue":c[4]||(c[4]=H=>h.value=H),"onUpdate:notesValue":c[5]||(c[5]=H=>u.value=H),"onUpdate:imagesValue":c[6]||(c[6]=H=>G(z).images[i.value.id]=H),onSave:A,onClose:F,onHapus:D},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):y("",!0)])}}},Ma=ge(ka,[["__scopeId","data-v-f5189791"]]);export{Ma as default};
