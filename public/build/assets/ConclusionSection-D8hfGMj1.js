import{x as et,g as T,s as ke,D as $e,q as J,E as ie,f as l,o as a,d as t,i as b,e as ne,v as re,y as ce,u as Q,F as se,k as oe,t as A,j as le,p as he,w as ve,n as P,L as pe,a as Ze,b as te,r as Ke,T as tt,C as st,B as be,W as ot,M as we,z as at}from"./vendor-BTHpbkmK.js";import{l as xe}from"./lodash-DIQq7uM1.js";import{_ as nt}from"./PrimaryButton-CGeACnVc.js";import{_ as it}from"./ActionMessage-BtaXIXoO.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Xe}from"./InputNumber-pQ_KuJkf.js";const lt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},rt={key:0,class:"p-4 space-y-2"},dt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ut={class:"flex items-center space-x-2"},ct={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},gt={class:"relative"},mt={key:0,class:"absolute right-3 top-3"},pt={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},vt={key:0},ft=["onMousedown"],ht={class:"font-medium text-gray-900"},bt={class:"text-sm text-gray-500"},wt={key:1,class:"p-4 text-sm text-gray-500 text-center"},xt={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},yt={key:0,class:"mb-4"},kt=["innerHTML"],$t={key:1},Vt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},It=["onClick"],Ct=["src","alt"],St={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Mt={class:"text-white text-xs text-center"},Ut={key:2,class:"text-center py-4 text-gray-500 text-sm"},_t={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Tt=["src","alt"],qt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Nt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Rt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},jt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(e,{emit:F}){var d,x,f,B;const s=e,V=F,h=et({plate_number:((d=s.inspection)==null?void 0:d.plate_number)||"",car_id:((x=s.inspection)==null?void 0:x.car_id)||null,car_name:((B=(f=s.inspection)==null?void 0:f.car)==null?void 0:B.name)||""}),g=T(""),c=T(""),u=T(""),r=T(h.car_name),M=T(!1),y=T(!1),k=T([]),w=T(null),I=T([]),o=T(!1),C=T(0);ke(()=>{var i,m,$,p,L;if(z((i=s.inspection)==null?void 0:i.plate_number),(m=s.inspection)!=null&&m.car_id&&(($=s.CarDetail)==null?void 0:$.length)>0){const H=s.CarDetail.find(Z=>Z.id===s.inspection.car_id);H&&S(H)}else!((p=s.inspection)!=null&&p.car_id)&&((L=s.inspection)!=null&&L.car_name)&&(r.value=s.inspection.car_name);window.addEventListener("keydown",ee)}),$e(()=>{window.removeEventListener("keydown",ee)});const z=i=>{if(!i){g.value="",c.value="",u.value="";return}const m=i.toUpperCase().trim(),$=m.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if($)g.value=$[1]||"",c.value=$[2]||"",u.value=$[3]||"";else{let p="area",L="",H="",Z="";for(const G of m)p==="area"&&/[A-Z]/.test(G)?L+=G:p==="area"&&/[0-9]/.test(G)?(p="number",H+=G):p==="number"&&/[0-9]/.test(G)?H+=G:p==="number"&&/[A-Z]/.test(G)?(p="suffix",Z+=G):p==="suffix"&&/[A-Z]/.test(G)&&(Z+=G);g.value=L,c.value=H,u.value=Z}D()},D=()=>{const i=`${g.value}${c.value}${u.value}`;h.plate_number=i,ae()},U=i=>{i==="area"?g.value=g.value.toUpperCase().replace(/[^A-Z]/g,""):i==="number"?c.value=c.value.replace(/[^0-9]/g,""):i==="suffix"&&(u.value=u.value.toUpperCase().replace(/[^A-Z]/g,"")),D()},E=i=>{var $,p,L;if(!i)return"";const m=[];return($=i.brand)!=null&&$.name&&m.push(i.brand.name),(p=i.model)!=null&&p.name&&m.push(i.model.name),(L=i.type)!=null&&L.name&&m.push(i.type.name),i.cc&&m.push(`${i.cc}cc`),i.transmission&&m.push(i.transmission),i.fuel_type&&m.push(i.fuel_type),i.year&&m.push(i.year.toString()),i.production_period&&m.push(`(${i.production_period})`),m.join(" ")},_=xe.debounce(()=>{if(!r.value.trim()){k.value=[],M.value=!1;return}y.value=!0;try{const i=r.value.toLowerCase().trim();k.value=s.CarDetail.filter(m=>E(m).toLowerCase().includes(i)),M.value=!0}finally{y.value=!1}},300),n=()=>{setTimeout(()=>{M.value=!1},200)},S=async i=>{w.value=i,r.value=E(i),h.car_id=i.id,h.car_name=E(i),M.value=!1,await O(i.id),ae()},R=i=>!i||!i.file_path?"":`/storage/${i.file_path}`,O=async i=>{try{const m=await fetch(`/api/cars/${i}/images`);if(m.ok){const $=await m.json();I.value=Array.isArray($)?$:[]}else I.value=[]}catch(m){console.error("Error loading car images:",m),I.value=[]}},K=i=>{C.value=i,o.value=!0,document.body.style.overflow="hidden"},X=()=>{o.value=!1,document.body.style.overflow=""},W=()=>{C.value=(C.value+1)%I.value.length},Y=()=>{C.value=(C.value-1+I.value.length)%I.value.length},ee=i=>{if(o.value)switch(i.key){case"Escape":X();break;case"ArrowRight":W();break;case"ArrowLeft":Y();break}},ae=()=>{const i={plate_number:h.plate_number,car_id:h.car_id,car_name:h.car_name};V("update-vehicle",i)},N=()=>{s.inspection&&h.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0})},j=J(()=>!!h.plate_number&&!!h.car_name);return ie(()=>s.inspection,i=>{var m;if(i)if(z(i.plate_number),h.car_id=i.car_id||null,i.car_id&&((m=s.CarDetail)==null?void 0:m.length)>0){const $=s.CarDetail.find(p=>p.id===i.car_id);$&&S($)}else i.car_name&&(r.value=i.car_name,h.car_name=i.car_name)},{deep:!0}),(i,m)=>{var $;return a(),l("div",lt,[m[22]||(m[22]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),e.inspection?(a(),l("div",rt,[t("div",dt,[m[11]||(m[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",ut,[re(t("input",{"onUpdate:modelValue":m[0]||(m[0]=p=>g.value=p),type:"text",placeholder:"Contoh: B",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:m[1]||(m[1]=p=>U("area")),maxlength:"2"},null,544),[[ce,g.value]]),re(t("input",{"onUpdate:modelValue":m[2]||(m[2]=p=>c.value=p),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:m[3]||(m[3]=p=>U("number")),maxlength:"4"},null,544),[[ce,c.value]]),re(t("input",{"onUpdate:modelValue":m[4]||(m[4]=p=>u.value=p),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:m[5]||(m[5]=p=>U("suffix")),maxlength:"3"},null,544),[[ce,u.value]])])]),t("div",ct,[m[14]||(m[14]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",gt,[re(t("input",{"onUpdate:modelValue":m[6]||(m[6]=p=>r.value=p),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:m[7]||(m[7]=(...p)=>Q(_)&&Q(_)(...p)),onFocus:m[8]||(m[8]=p=>M.value=!0),onBlur:n},null,544),[[ce,r.value]]),y.value?(a(),l("div",mt,m[12]||(m[12]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):b("",!0),M.value?(a(),l("div",pt,[k.value.length>0?(a(),l("div",vt,[(a(!0),l(se,null,oe(k.value,p=>(a(),l("div",{key:p.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:L=>S(p)},[t("div",ht,A(E(p)),1),t("div",bt,A(p.year)+" • "+A(p.cc)+"cc • "+A(p.transmission)+" • "+A(p.fuel_type),1)],40,ft))),128))])):(a(),l("div",wt,m[13]||(m[13]=[le(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),le(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):b("",!0)]),re(t("input",{type:"hidden","onUpdate:modelValue":m[9]||(m[9]=p=>Q(h).car_id=p)},null,512),[[ce,Q(h).car_id]])]),Q(h).car_id&&w.value?(a(),l("div",xt,[w.value.description?(a(),l("div",yt,[m[15]||(m[15]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:w.value.description},null,8,kt)])):b("",!0),I.value.length>0?(a(),l("div",$t,[m[16]||(m[16]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",Vt,[(a(!0),l(se,null,oe(I.value,(p,L)=>(a(),l("div",{key:p.id||L,class:"relative group cursor-pointer",onClick:H=>K(L)},[t("img",{src:R(p),alt:p.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ct),p.note?(a(),l("div",St,[t("p",Mt,A(p.note),1)])):b("",!0)],8,It))),128))])])):(a(),l("div",Ut," Tidak ada gambar tersedia untuk mobil ini "))])):b("",!0),o.value?(a(),l("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:X},[t("div",_t,[t("button",{onClick:X,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},m[17]||(m[17]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),I.value.length>1?(a(),l("button",{key:0,onClick:he(Y,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},m[18]||(m[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):b("",!0),I.value.length>1?(a(),l("button",{key:1,onClick:he(W,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},m[19]||(m[19]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):b("",!0),t("img",{src:R(I.value[C.value]),alt:"Car Image "+(C.value+1),class:"max-w-full max-h-full object-contain",onClick:m[10]||(m[10]=he(()=>{},["stop"]))},null,8,Tt),I.value.length>1?(a(),l("div",qt,A(C.value+1)+" / "+A(I.value.length),1)):b("",!0),($=I.value[C.value])!=null&&$.note?(a(),l("div",Nt,A(I.value[C.value].note),1)):b("",!0)])])):b("",!0),ne(nt,{type:"button",onClick:N,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!j.value},{default:ve(()=>[Q(h).processing?(a(),l("svg",Rt,m[20]||(m[20]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):b("",!0),t("span",null,A(Q(h).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),ne(it,{on:Q(h).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:ve(()=>m[21]||(m[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),le(" Tersimpan. ")])),_:1,__:[21]},8,["on"])]),_:1},8,["disabled"])])):b("",!0)])}}},Ta=ue(jt,[["__scopeId","data-v-a54fbcbd"]]),Bt={class:"mt-1"},Lt=["value","required","minlength","maxlength","allowSpace","placeholder"],Dt={key:0,class:"mt-2 text-sm text-red-600"},Ge={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,V=F,h=J(()=>{if(!s.modelValue)return"";let c=s.modelValue;switch(s.allowSpace||(c=c.replace(/\s+/g,"")),s.textTransform){case"uppercase":return c.toUpperCase();case"lowercase":return c.toLowerCase();case"capitalize":return c.replace(/\b\w/g,u=>u.toUpperCase());default:return c}}),g=c=>{let u=c.target.value;switch(s.allowSpace||(u=u.replace(/\s+/g,"")),s.textTransform){case"uppercase":u=u.toUpperCase();break;case"lowercase":u=u.toLowerCase();break;case"capitalize":u=u.replace(/\b\w/g,r=>r.toUpperCase());break}V("update:modelValue",u),V("save",s.pointId)};return(c,u)=>(a(),l("div",Bt,[t("input",{value:h.value,onInput:g,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,allowSpace:e.allowSpace,placeholder:e.placeholder,class:P(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:e.textTransform==="uppercase",lowercase:e.textTransform==="lowercase",capitalize:e.textTransform==="capitalize"}])},null,42,Lt),e.error?(a(),l("p",Dt,A(e.error),1)):b("",!0)]))}},At={class:"mt-1"},Ft=["value","required","min","max"],zt={key:0,class:"mt-2 text-sm text-red-600"},Ye={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,V=F,h=g=>{V("update:modelValue",g.target.value),V("save",s.pointId)};return(g,c)=>(a(),l("div",At,[t("input",{value:e.modelValue,onChange:h,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ft),e.error?(a(),l("p",zt,A(e.error),1)):b("",!0)]))}},Et={class:"mt-1"},Ht=["value","required","placeholder"],Ot={key:0,class:"mt-2 text-sm text-red-600"},Je={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,V=F,h=T(""),g=J(()=>{var y,k,w,I;return{currency_symbol:((y=s.settings)==null?void 0:y.currency_symbol)||"Rp",thousands_separator:((k=s.settings)==null?void 0:k.thousands_separator)||",",min_value:((w=s.settings)==null?void 0:w.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((I=s.settings)==null?void 0:I.max_value)!==void 0?Number(s.settings.max_value):1e9}}),c=y=>{if(y==null||y==="")return"";const k=Number(y);if(isNaN(k))return"";let w=k.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return g.value.thousands_separator!==","&&(w=w.replace(/,/g,g.value.thousands_separator)),w},u=y=>y?y.replace(/[^\d]/g,""):"",r=J(()=>h.value?`${g.value.currency_symbol} ${c(h.value)}`:""),M=y=>{let k=u(y.target.value),w=Number(k);g.value.min_value!==void 0&&w<g.value.min_value&&(k=g.value.min_value.toString()),g.value.max_value!==void 0&&w>g.value.max_value&&(k=g.value.max_value.toString()),h.value=k,V("update:modelValue",k),V("save",s.pointId)};return ie(()=>s.modelValue,y=>{y!=null&&(h.value=y.toString())},{immediate:!0}),(y,k)=>(a(),l("div",Et,[t("input",{value:r.value,onInput:M,type:"text",required:e.required,placeholder:e.placeholder,class:P(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,Ht),e.error?(a(),l("p",Ot,A(e.error),1)):b("",!0)]))}},Wt={class:"mt-1 space-y-3"},Zt={key:0,class:"space-y-2"},Kt={class:"flex flex-wrap gap-2"},Xt=["onClick"],Gt=["value","required","minlength","maxlength","placeholder"],Yt={class:"flex justify-between items-center mt-1"},Jt={class:"text-xs text-gray-500"},Qt={key:0,class:"text-xs text-red-600"},Qe={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,V=F,h=T([]),g=T(""),c=y=>h.value.some(k=>k.value===y),u=y=>{c(y.value)?h.value=h.value.filter(o=>o.value!==y.value):h.value.push(y);const w=[...h.value.map(o=>o.value)];g.value.trim()&&w.push(g.value.trim());const I=w.join(", ");V("update:modelValue",I),V("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:I})},r=y=>{const k=y.target.value;V("update:modelValue",k),V("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:k}),M(k)},M=y=>{var o,C,z,D;if(!y){h.value=[],g.value="";return}const k=y.split(",").map(U=>U.trim()).filter(U=>U),w=((C=(o=s.settings)==null?void 0:o.damage_options)==null?void 0:C.map(U=>U.value))||[];h.value=((D=(z=s.settings)==null?void 0:z.damage_options)==null?void 0:D.filter(U=>k.includes(U.value)))||[];const I=k.filter(U=>!w.includes(U));g.value=I.join(", ")};return ie(()=>s.modelValue,y=>{y!=null&&M(y)},{immediate:!0}),(y,k)=>{var w,I,o;return a(),l("div",Wt,[(w=e.settings)!=null&&w.enable_damage&&((I=e.settings)!=null&&I.damage_options)?(a(),l("div",Zt,[k[0]||(k[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",Kt,[(a(!0),l(se,null,oe(e.settings.damage_options,(C,z)=>(a(),l("button",{key:z,type:"button",onClick:D=>u(C),class:P(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":c(C.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!c(C.value)}])},A(C.label),11,Xt))),128))])])):b("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:r,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Gt),t("div",Yt,[t("span",Jt,A(((o=e.modelValue)==null?void 0:o.length)||0)+"/"+A(e.maxLength||400),1),e.error?(a(),l("p",Qt,A(e.error),1)):b("",!0)])])])}}},Pt={class:"mt-1"},es=["value","required"],ts={key:0,class:"mt-2 text-sm text-red-600"},ss={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,V=F,h=g=>{V("update:modelValue",g.target.value),V("save",s.pointId)};return(g,c)=>(a(),l("div",Pt,[t("select",{value:e.modelValue,onChange:h,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},c[0]||(c[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,es),e.error?(a(),l("p",ts,A(e.error),1)):b("",!0)]))}},os=ue(ss,[["__scopeId","data-v-c34a74db"]]),as={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},ns={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},is={class:"flex flex-row space-x-4 mb-6"},ls={class:"mt-4 text-right"},rs={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(F,s)=>e.show?(a(),l("div",as,[t("div",ns,[s[5]||(s[5]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),t("div",is,[t("button",{onClick:s[0]||(s[0]=V=>F.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[3]||(s[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:s[1]||(s[1]=V=>F.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[4]||(s[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",ls,[t("button",{onClick:s[2]||(s[2]=V=>F.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):b("",!0)}},ds={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},us={class:"webcam-content-box"},cs={class:"webcam-header"},gs={class:"inspection-point-name"},ms={key:0,class:"screen-flash-overlay"},ps={key:2,class:"zoom-controls"},vs=["max"],fs={class:"webcam-footer"},hs={class:"camera-controls"},bs=["disabled"],ws={class:"camera-icon-container"},xs={key:0,class:"camera-spinner"},ys={key:1,class:"camera-body"},ks={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(e,{emit:F}){const s=e,V=F,h=T(null),g=T(null);let c=null,u=null;const r=T("environment"),M=T(!1),y=T(!1),k=T(!1),w=T(!1),I=T(!1),o=T({}),C=T(!1),z=T(1),D=T(1),U=T(!1),E=J(()=>{var N;return((N=s.settings)==null?void 0:N.max_size)||2048}),_=J(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),n=J(()=>{if(!s.aspectRatio)return{};const N=s.aspectRatio,j=N>1?80:60,d=N>1?80/N:60*N;return{width:`${j}%`,height:`${d}%`}}),S=async()=>{c&&c.getTracks().forEach(N=>N.stop());try{const N={facingMode:r.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};c=await navigator.mediaDevices.getUserMedia({video:N,audio:!1}),u=c.getVideoTracks()[0],h.value.srcObject=c,h.value.onloadedmetadata=async()=>{await O(),await h.value.play()}}catch(N){console.error("Error accessing camera: ",N),alert("Failed to access camera. Please allow camera permission."),V("close")}},R=()=>{c&&c.getTracks().forEach(N=>N.stop()),V("close")},O=async()=>{if(u)try{const N=await navigator.mediaDevices.enumerateDevices();M.value=N.filter(d=>d.kind==="videoinput").length>1;const j=u.getCapabilities();j.zoom?(U.value=!0,D.value=j.zoom.max,console.log(`Zoom supported. Max zoom: ${D.value}`)):(U.value=!1,console.warn("Zoom is not supported by this camera.")),y.value=j.torch||j.fillLightMode&&j.fillLightMode.includes("torch")}catch(N){console.error("Error checking camera capabilities:",N)}},K=async N=>{if(!u)return;const j=h.value.getBoundingClientRect(),d=N.clientX-j.left,x=N.clientY-j.top;I.value=!0,o.value={left:`${d}px`,top:`${x}px`,transform:"translate(-50%, -50%)"};try{if(u.getCapabilities().pointsOfInterest){const B=d/j.width,i=x/j.height;await u.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:B,y:i}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(f){console.warn("Manual focus failed:",f)}setTimeout(()=>{I.value=!1,u.getCapabilities().focusMode.includes("continuous")&&u.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},X=async N=>{if(!u||!U.value)return;const j=Math.min(Math.max(N,1),D.value);z.value=j;try{await u.applyConstraints({advanced:[{zoom:j}]})}catch(d){console.error("Failed to set zoom:",d)}},W=async()=>{if(!(!u||!y.value))try{r.value==="user"?(k.value=!k.value,w.value=k.value):(await u.applyConstraints({advanced:[{torch:!k.value}]}),k.value=!k.value)}catch(N){console.error("Flash toggle failed:",N)}},Y=async()=>{M.value&&(r.value=r.value==="environment"?"user":"environment",c&&c.getTracks().forEach(N=>N.stop()),await S())},ee=async N=>new Promise(j=>{const d=E.value*1024;if(N.size<=d){j(N);return}const x=new Image,f=new FileReader;f.onload=B=>{x.onload=()=>{const i=document.createElement("canvas"),m=i.getContext("2d"),$=Math.sqrt(d/N.size);i.width=x.width*$,i.height=x.height*$,m.drawImage(x,0,0,i.width,i.height);let p=.9;const L=()=>{i.toBlob(H=>{H.size>d&&p>.1?(p-=.1,L()):j(H)},"image/jpeg",p)};L()},x.src=B.target.result},f.readAsDataURL(N)}),ae=async()=>{if(!(C.value||!h.value||!g.value)){C.value=!0;try{const N=h.value,j=g.value,d=N.videoWidth,x=N.videoHeight;let f,B,i,m;d/x>s.aspectRatio?(B=x,f=x*s.aspectRatio,i=(d-f)/2,m=0):(f=d,B=d/s.aspectRatio,i=0,m=(x-B)/2),j.width=f,j.height=B,j.getContext("2d").drawImage(N,i,m,f,B,0,0,f,B);const p=await new Promise(H=>{j.toBlob(H,"image/jpeg",1)}),L=await ee(p);if(L){const H=new File([L],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});V("photoCaptured",H),w.value=!0,setTimeout(()=>{w.value=!1},100)}}catch(N){console.error("Error capturing photo:",N),alert("Failed to capture photo. Please try again.")}finally{C.value=!1}}};return ie(()=>s.show,N=>{N?S():R()}),$e(()=>{c&&c.getTracks().forEach(N=>N.stop())}),(N,j)=>{var d;return e.show?(a(),l("div",ds,[t("div",us,[t("div",cs,[t("div",gs,A(((d=e.point)==null?void 0:d.name)||"Camera"),1),t("button",{onClick:R,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},j[2]||(j[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:pe(_.value),onClick:K,onTouchstart:K},[t("video",{ref_key:"webcamVideo",ref:h,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:g,class:"hidden"},null,512),w.value?(a(),l("div",ms)):b("",!0),t("div",{class:"aspect-ratio-guide",style:pe(n.value)},null,4),I.value?(a(),l("div",{key:1,class:"focus-indicator",style:pe(o.value)},j[3]||(j[3]=[t("div",{class:"focus-ring"},null,-1)]),4)):b("",!0),j[4]||(j[4]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),U.value?(a(),l("div",ps,[re(t("input",{type:"range",min:"1",max:D.value,step:"0.1","onUpdate:modelValue":j[0]||(j[0]=x=>z.value=x),onInput:j[1]||(j[1]=x=>X(parseFloat(x.target.value))),class:"zoom-slider"},null,40,vs),[[ce,z.value]])])):b("",!0)],36),t("div",fs,[t("div",hs,[e.settings.enable_flash&&y.value?(a(),l("button",{key:0,onClick:W,class:P(["control-button",{active:k.value,disabled:!y.value}])},j[5]||(j[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):b("",!0),t("button",{onClick:ae,class:"capture-button",disabled:C.value},[t("div",ws,[C.value?(a(),l("div",xs)):(a(),l("div",ys,j[6]||(j[6]=[t("div",{class:"camera-lens"},null,-1),t("div",{class:"camera-flash"},null,-1)])))])],8,bs),e.settings.enable_camera_switch&&M.value?(a(),l("button",{key:1,onClick:Y,class:"control-button"},j[7]||(j[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):b("",!0)])])])])):b("",!0)}}},$s=ue(ks,[["__scopeId","data-v-a032b4ac"]]),Vs={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Is={class:"w-full h-full flex flex-col"},Cs={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Ss={class:"text-lg font-semibold"},Ms={class:"flex items-center gap-2"},Us={class:"flex-1 flex items-center justify-center overflow-hidden relative"},_s=["src"],Ts={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},qs={class:"flex justify-between items-center w-full"},Ns=["disabled"],Rs={key:1,class:"flex-1"},js=["disabled"],Bs={class:"flex gap-3 w-full"},Ls=["disabled"],Ds={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},As={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(e,{emit:F}){const s=e,V=F,h=T(0),g=T([]),c=T(0),u=T(0),r=J(()=>g.value.length>0?g.value[h.value]:null);ie(()=>s.images,_=>{g.value=_.map(n=>({...n,rotation:n.rotation||0})),_.length===0&&s.show&&D()},{deep:!0,immediate:!0}),ie(()=>s.show,_=>{_&&s.images.length>0&&(h.value=s.initialIndex)});const M=_=>_.preview||(_.image_path?`/${_.image_path}`:""),y=()=>{if(r.value){const _=(r.value.rotation+90)%360;g.value[h.value].rotation=_,V("update:images",g.value)}},k=()=>{h.value=h.value<g.value.length-1?h.value+1:0},w=()=>{h.value=h.value>0?h.value-1:g.value.length-1},I=_=>{c.value=_.touches[0].clientX},o=_=>{u.value=_.touches[0].clientX},C=()=>{c.value-u.value>50?k():u.value-c.value>50&&w(),c.value=0,u.value=0},z=()=>{s.isUploading||V("saveImages",g.value)},D=()=>{s.isUploading||V("close")},U=()=>{if(r.value&&!s.isUploading){const _=r.value,n=g.value.findIndex(S=>S.isNew&&_.isNew&&S.preview===_.preview||!S.isNew&&!_.isNew&&S.id===_.id);n!==-1&&(V("removePreviewImage",_),g.value.splice(n,1),V("update:images",g.value)),h.value>=g.value.length&&(h.value=Math.max(0,g.value.length-1)),g.value.length===0&&V("close")}},E=()=>{s.isUploading||V("triggerAddMorePhotos")};return(_,n)=>{var S;return e.show?(a(),l("div",Vs,[t("div",Is,[t("div",Cs,[t("button",{onClick:D,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},n[0]||(n[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",Ss,A(((S=e.point)==null?void 0:S.name)||"Preview")+" ("+A(h.value+1)+"/"+A(g.value.length)+") ",1),t("div",Ms,[r.value&&r.value.isNew?(a(),l("button",{key:0,onClick:U,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},n[1]||(n[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):b("",!0),r.value&&r.value.isNew?(a(),l("button",{key:1,onClick:y,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},n[2]||(n[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))):b("",!0)])]),t("div",Us,[t("div",{class:"relative w-full max-w-full",style:pe({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"}),onTouchstart:I,onTouchmove:o,onTouchend:C},[r.value?(a(),l("img",{key:0,src:M(r.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:pe({transform:`rotate(${r.value.rotation}deg)`})},null,12,_s)):b("",!0)],36),g.value.length>1?(a(),l("button",{key:0,onClick:w,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},n[3]||(n[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):b("",!0),g.value.length>1?(a(),l("button",{key:1,onClick:k,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},n[4]||(n[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):b("",!0)]),t("div",Ts,[t("div",qs,[r.value&&!r.value.isNew?(a(),l("button",{key:0,onClick:U,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:e.isUploading},n[5]||(n[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),le(" Hapus Foto ")]),8,Ns)):(a(),l("div",Rs)),e.allowMultiple&&g.value.length<e.maxFiles?(a(),l("button",{key:2,onClick:E,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:e.isUploading},n[6]||(n[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),le(" Tambah Foto ")]),8,js)):b("",!0)]),t("div",Bs,[t("button",{onClick:D,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:e.isUploading}," Batal ",8,Ls),e.isUploading?(a(),l("button",Ds,n[7]||(n[7]=[le(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(a(),l("button",{key:0,onClick:z,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):b("",!0)}}},Fs=ue(As,[["__scopeId","data-v-ec0018df"]]),zs=["accept","multiple","disabled"],Es=["disabled"],Hs={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Os={class:"text-xs text-gray-400 mt-1"},Ws={key:0,class:"flex items-center gap-4"},Zs=["src"],Ks=["disabled"],Xs={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Gs=["disabled"],Ys=["onClick"],Js=["src"],Qs={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ps={key:0},eo={key:1,class:"ml-1"},to={key:2,class:"mt-1 text-xs text-red-600"},so={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:F}){const s=e,V=F,h=T(null),g=T(null),c=T(!1),u=T(!1),r=T(!1),M=T([]),y=T(0),k=T(!1),w=J(()=>Number(s.settings.max_files)>1),I=J(()=>s.settings.allowed_types.map(d=>`.${d}`).join(", ")),o=J(()=>{const d=s.settings.camera_aspect_ratio.split(":");if(d.length===2){const x=parseFloat(d[0]),f=parseFloat(d[1]);if(!isNaN(x)&&!isNaN(f)&&f!==0)return x/f}return 3/4}),C=J(()=>{const d=[],x=new Set;for(const f of M.value)f.id&&x.add(f.id),d.push(f);for(const f of s.modelValue)x.has(f.id)||d.push({...f,rotation:f.rotation||0,isNew:!1,preview:f.preview||(f.image_path?`/${f.image_path}`:null)});return d}),z=d=>d.preview||(d.image_path?`/${d.image_path}`:""),D=()=>{r.value&&(r.value=!1),c.value=!0},U=()=>{c.value=!1,h.value.click()},E=()=>{c.value=!1,u.value=!0},_=()=>{c.value=!1,C.value.length>0&&(r.value=!0)},n=()=>{u.value=!1,C.value.length>0&&(r.value=!0)},S=()=>{r.value=!1,M.value.forEach(d=>{d.preview&&d.preview.startsWith("blob:")&&URL.revokeObjectURL(d.preview)}),M.value=[]},R=d=>new Promise(x=>{const f=new FileReader;f.onload=B=>{const i=new Image;i.onload=()=>{x({file:d,preview:URL.createObjectURL(d),rotation:0,width:i.naturalWidth,height:i.naturalHeight,isNew:!0})},i.onerror=()=>{console.error("Failed to load image for dimensions:",d.name),x({file:d,preview:URL.createObjectURL(d),rotation:0,width:0,height:0,isNew:!0})},i.src=B.target.result},f.readAsDataURL(d)}),O=d=>{const x=d.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(x)},K=async d=>{const f=(s.settings.max_size||2048)*1024;return new Promise(B=>{const i=new Image,m=new FileReader;m.onload=$=>{i.onload=()=>{const p=document.createElement("canvas"),L=p.getContext("2d"),H=Math.max(i.width,i.height);p.width=H,p.height=H,L.fillStyle="white",L.fillRect(0,0,H,H);const Z=(H-i.width)/2,G=(H-i.height)/2;L.drawImage(i,Z,G,i.width,i.height);let de=.9;const ge=()=>{p.toBlob(me=>{if(me.size>f&&de>.1)de-=.1,ge();else{const fe=new File([me],d.name,{type:"image/jpeg",lastModified:Date.now()});B(fe)}},"image/jpeg",de)};ge()},i.src=$.target.result},m.readAsDataURL(d)})},X=async d=>{const x=Array.from(d.target.files);if(!x.length){c.value=!1,C.value.length>0&&(r.value=!0);return}try{const f=x.filter(L=>!O(L));if(f.length>0){const L=f.map(H=>H.name.split(".").pop()).join(", ");alert(`File type not allowed: ${L}. Allowed types: ${s.settings.allowed_types.join(", ")}`),d.target.value="";return}const B=C.value.length,i=s.settings.max_files-B,m=await Promise.all(x.slice(0,i).map(async L=>await K(L))),$=await Promise.all(m.map(R)),p=w.value?$:$.slice(0,1);w.value?M.value.push(...p):(M.value.forEach(L=>{L.preview&&L.preview.startsWith("blob:")&&URL.revokeObjectURL(L.preview)}),M.value=p),c.value=!1,p.length>0?(y.value=Math.max(0,C.value.length-p.length),r.value=!0):C.value.length>0&&(r.value=!0),d.target.value=""}catch(f){console.error("Error processing selected images:",f),alert("Failed to process selected images. Please try again."),c.value=!1,C.value.length>0&&(r.value=!0)}},W=async d=>{const x=C.value.length;if(!w.value||x<s.settings.max_files)try{const f=await K(d),B=new Image;B.onload=()=>{const i={file:f,preview:URL.createObjectURL(f),rotation:0,width:B.naturalWidth,height:B.naturalHeight,isNew:!0};w.value?M.value.push(i):(M.value.forEach(m=>{m.preview&&m.preview.startsWith("blob:")&&URL.revokeObjectURL(m.preview)}),M.value=[i]),u.value=!1,c.value=!1,y.value=C.value.length-1,r.value=!0},B.src=URL.createObjectURL(f)}catch(f){console.error("Error processing captured image:",f),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),u.value=!1,c.value=!1,C.value.length>0&&(r.value=!0)},Y=(d=0)=>{y.value=d,r.value=!0},ee=d=>new Promise(x=>{if(d.rotation===0||!g.value){if(!d.isNew&&!d.file){x({file:null,width:d.width,height:d.height,isOriginal:!0});return}x({file:d.file,width:d.width,height:d.height});return}const f=new Image;f.onload=async()=>{try{const B=g.value,i=B.getContext("2d"),m=f.width,$=f.height;let p,L;d.rotation===90||d.rotation===270?(p=$,L=m):(p=m,L=$),B.width=p,B.height=L,i.clearRect(0,0,B.width,B.height),i.translate(B.width/2,B.height/2),i.rotate(d.rotation*Math.PI/180),i.drawImage(f,-m/2,-$/2,m,$),i.setTransform(1,0,0,1,0,0);const H=await new Promise(de=>{B.toBlob(de,"image/jpeg",.9)}),Z=new File([H],d.file?d.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),G=await K(Z);x({file:G,width:p,height:L})}catch(B){console.error("Error processing rotated image:",B),x({file:d.file,width:d.width,height:d.height})}},f.onerror=()=>{console.error("Failed to load image for rotation processing:",d.preview),x({file:d.file,width:d.width,height:d.height})},f.src=d.preview}),ae=async d=>{var B,i,m,$;k.value=!0;const x=[],f=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),k.value=!1;return}try{for(const p of d){if(!p.isNew&&p.rotation===0&&p.id&&p.image_path){x.push({id:p.id,image_path:p.image_path,width:p.width,height:p.height,rotation:0,preview:p.preview});continue}const{file:L,width:H,height:Z,isOriginal:G}=await ee(p);if(G&&!p.isNew){x.push({id:p.id,image_path:p.image_path,width:p.width,height:p.height,rotation:0,preview:p.preview});continue}L&&f.push({file:L,width:H,height:Z,rotation:0})}if(f.length>0){const p=new FormData;p.append("inspection_id",s.inspectionId),p.append("point_id",s.pointId),f.forEach(Z=>{p.append("images[]",Z.file)});const H=(await Ze.post(route("inspections.upload-image"),p,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const Z of H)x.push({id:Z.image_id,image_path:Z.path,width:Z.width||0,height:Z.height||0,rotation:Z.rotation||0,preview:Z.public_url});f.forEach(Z=>{Z.file&&Z.file.preview&&Z.file.preview.startsWith("blob:")&&URL.revokeObjectURL(Z.file.preview)})}V("update:modelValue",x),V("save",s.pointId),V("uploaded",{pointId:s.pointId,images:x}),S()}catch(p){if(console.error("Error during image processing/upload:",p),(i=(B=p.response)==null?void 0:B.data)!=null&&i.message)alert(`Failed to save images: ${p.response.data.message}`);else if(($=(m=p.response)==null?void 0:m.data)!=null&&$.errors){const L=Object.values(p.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${L}`)}else alert(`Failed to save images: ${p.message}`)}finally{k.value=!1}},N=d=>{if(d){if(d.id&&!d.isNew)j(d);else{const x=M.value.findIndex(f=>f.preview&&f.preview===d.preview&&f.isNew||f.id&&f.id===d.id);if(x!==-1){const f=M.value.splice(x,1)[0];f.preview&&f.preview.startsWith("blob:")&&URL.revokeObjectURL(f.preview)}V("update:modelValue",s.modelValue.filter(f=>!(f.id&&f.id===d.id)&&!(f.preview&&f.preview===d.preview)))}y.value>=C.value.length&&(y.value=Math.max(0,C.value.length-1)),C.value.length===0&&S()}},j=async d=>{var f,B;if(d.id||d.image_path)try{await Ze.delete(route("inspections.delete-image"),{data:{image_id:d.id,image_path:d.image_path}})}catch(i){console.error("Error deleting image from server:",i),(B=(f=i.response)==null?void 0:f.data)!=null&&B.message?alert(`Failed to delete image from server: ${i.response.data.message}`):alert(`Failed to delete image from server: ${i.message}`);return}d.preview&&d.preview.startsWith("blob:")&&URL.revokeObjectURL(d.preview);const x=s.modelValue.filter(i=>i.id!==d.id);V("update:modelValue",x),M.value=M.value.filter(i=>i.isNew&&d.isNew?i.preview!==d.preview:i.id!==d.id),V("removeImage",{image:d}),r.value&&C.value.length===0?S():r.value&&y.value>=C.value.length&&(y.value=Math.max(0,C.value.length-1))};return(d,x)=>(a(),l("div",null,[t("input",{ref_key:"galleryInput",ref:h,type:"file",accept:I.value,class:"hidden",onChange:X,multiple:w.value,disabled:k.value},null,40,zs),t("canvas",{ref_key:"processingCanvas",ref:g,class:"hidden"},null,512),C.value.length===0?(a(),l("label",{key:0,onClick:D,class:P(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:k.value},[t("div",Hs,[x[2]||(x[2]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),x[3]||(x[3]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),x[4]||(x[4]=t("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),t("p",Os,"Allowed types: "+A(I.value),1)])],8,Es)):(a(),l("div",{key:1,class:P(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":e.settings.max_files==1,"bg-transparent":e.settings.max_files>1}]),"aria-label":"Image gallery"},[e.settings.max_files===1?(a(),l("div",Ws,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:x[0]||(x[0]=f=>Y(0))},[t("img",{src:z(C.value[0]),class:"w-full h-full object-cover"},null,8,Zs)]),t("button",{onClick:x[1]||(x[1]=he(f=>j(C.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:k.value},x[5]||(x[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),le(" Hapus Foto ")]),8,Ks)])):(a(),l("div",Xs,[w.value&&C.value.length<e.settings.max_files?(a(),l("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:D,disabled:k.value},x[6]||(x[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Gs)):b("",!0),(a(!0),l(se,null,oe(C.value,(f,B)=>(a(),l("div",{key:f.id||f.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:i=>Y(B)},[t("img",{src:z(f),class:"w-full h-full object-cover"},null,8,Js),f.isNew||f.rotation!==0?(a(),l("div",Qs,[f.isNew?(a(),l("span",Ps,"BARU")):b("",!0),f.rotation!==0?(a(),l("span",eo,"ROTASI")):b("",!0)])):b("",!0)],8,Ys))),128))]))],2)),e.error?(a(),l("p",to,A(e.error),1)):b("",!0),ne(rs,{show:c.value,onClose:_,onOpenWebcam:E,onTriggerGallery:U},null,8,["show"]),ne($s,{show:u.value,"aspect-ratio":o.value,settings:e.settings,point:e.point,onClose:n,onPhotoCaptured:W},null,8,["show","aspect-ratio","settings","point"]),ne(Fs,{show:r.value,images:C.value,point:e.point,"initial-index":y.value,"allow-multiple":w.value,"max-files":e.settings.max_files,"is-uploading":k.value,"aspect-ratio":o.value,onClose:S,onSaveImages:ae,onRemovePreviewImage:N,onTriggerAddMorePhotos:D},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},ye=ue(so,[["__scopeId","data-v-396cd9aa"]]),oo={key:0,class:"fixed inset-0 z-50 overflow-hidden"},ao={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},no={class:"px-4 pb-2 border-b border-gray-200"},io={class:"text-lg font-semibold text-gray-900"},lo={key:0,class:"text-sm text-gray-500 mt-1"},ro={class:"flex-1 overflow-y-auto p-4"},uo={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},co={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:F}){const s=F,V=()=>{s("close")},h=g=>{g.key==="Escape"&&V()};return ke(()=>{document.addEventListener("keydown",h)}),$e(()=>{document.removeEventListener("keydown",h)}),(g,c)=>(a(),te(tt,{name:"bottom-sheet"},{default:ve(()=>[e.show?(a(),l("div",oo,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:V}),t("div",ao,[c[0]||(c[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",no,[t("h3",io,A(e.title),1),e.subtitle?(a(),l("p",lo,A(e.subtitle),1)):b("",!0)]),t("div",ro,[Ke(g.$slots,"default",{},void 0,!0)]),g.$slots.footer?(a(),l("div",uo,[Ke(g.$slots,"footer",{},void 0,!0)])):b("",!0)])])):b("",!0)]),_:3}))}},go=ue(co,[["__scopeId","data-v-7893c2dc"]]),mo={class:"space-y-4"},po={key:0,class:"mt-2"},vo={key:1,class:"mt-2"},fo={key:2,class:"mt-2"},ho={key:3,class:"mt-2"},bo={key:4,class:"mt-2"},wo={class:"text-sm font-medium text-gray-700 mb-2"},xo={key:0,class:"text-red-500"},yo={key:0,class:"text-xs text-red-500"},ko=["name","value","checked"],$o={key:6,class:"space-y-2"},Vo={key:0,class:"text-red-500"},Io={key:1,class:"text-xs text-red-500"},Co={key:7,class:"mt-4"},So={class:"text-sm font-medium text-gray-700 mb-2"},Mo={key:0,class:"text-red-500"},Uo={key:0,class:"text-xs text-red-500"},_o={class:"flex gap-2"},To=["disabled"],Pe={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(e,{emit:F}){const s=e,V=F,h=u=>V("hapus",u),g=J(()=>s.options.find(u=>u.value===s.selectedValue)),c=J(()=>{var r,M,y,k,w,I,o;if(s.point.input_type==="text"&&(!((r=s.notesValue)!=null&&r.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((M=s.notesValue)!=null&&M.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((y=s.notesValue)!=null&&y.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!((k=s.notesValue)!=null&&k.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date)||s.point.input_type==="imageTOradio"&&s.imagesValue.length===0||s.options.length&&!s.selectedValue)return!1;const u=g.value;return!(s.showTextarea&&((w=u==null?void 0:u.settings)!=null&&w.show_textarea)&&(!((I=s.notesValue)!=null&&I.trim())||u.settings.min_length&&s.notesValue.length<u.settings.min_length||u.settings.max_length&&s.notesValue.length>u.settings.max_length)||s.showImageUpload&&((o=u==null?void 0:u.settings)!=null&&o.show_image_upload)&&(s.imagesValue.length===0||u.settings.max_files&&s.imagesValue.length>u.settings.max_files))});return(u,r)=>(a(),te(go,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:r[18]||(r[18]=M=>u.$emit("close"))},{footer:ve(()=>[e.selectedPoint?(a(),l("button",{key:0,onClick:r[15]||(r[15]=M=>h(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},r[20]||(r[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),le(" Hapus Data ")]))):b("",!0),t("div",_o,[t("button",{type:"button",onClick:r[16]||(r[16]=M=>u.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:r[17]||(r[17]=M=>u.$emit("save")),disabled:!c.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,To)])]),default:ve(()=>{var M,y,k,w,I,o,C,z,D,U,E,_,n,S,R,O,K,X,W,Y,ee,ae,N,j,d,x,f,B,i,m;return[t("div",mo,[e.point.input_type==="text"?(a(),l("div",po,[ne(Ge,{"model-value":e.notesValue,required:(M=e.point.settings)==null?void 0:M.is_required,"min-length":(y=e.point.settings)==null?void 0:y.min_length,"max-length":(k=e.point.settings)==null?void 0:k.max_length,allowSpace:(w=e.point.settings)==null?void 0:w.allow_space,textTransform:(I=e.point.settings)==null?void 0:I.text_transform,placeholder:((o=e.point.settings)==null?void 0:o.placeholder)||"Masukan text",error:u.error,"onUpdate:modelValue":r[0]||(r[0]=$=>u.$emit("update:notesValue",$)),onSave:r[1]||(r[1]=$=>u.$emit("saveText",$))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):b("",!0),e.point.input_type==="number"?(a(),l("div",vo,[ne(Xe,{"model-value":e.notesValue,required:(C=e.point.settings)==null?void 0:C.is_required,min:(z=e.point.settings)==null?void 0:z.min,max:(D=e.point.settings)==null?void 0:D.max,step:((U=e.point.settings)==null?void 0:U.step)||1,placeholder:((E=e.point.settings)==null?void 0:E.placeholder)||"Masukan number",error:u.error,"onUpdate:modelValue":r[2]||(r[2]=$=>u.$emit("update:notesValue",$)),onSave:r[3]||(r[3]=$=>u.$emit("saveNumber",$))},null,8,["model-value","required","min","max","step","placeholder","error"])])):b("",!0),e.point.input_type==="account"?(a(),l("div",fo,[ne(Je,{"model-value":e.notesValue,required:(_=e.point.settings)==null?void 0:_.is_required,placeholder:((n=e.point.settings)==null?void 0:n.placeholder)||"Masukkan nilai",error:u.error,"point-id":e.pointId,settings:e.point.settings,"onUpdate:modelValue":r[4]||(r[4]=$=>u.$emit("update:notesValue",$)),onSave:r[5]||(r[5]=$=>u.$emit("saveAccount",$))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):b("",!0),e.point.input_type==="date"?(a(),l("div",ho,[ne(Ye,{"model-value":e.notesValue,required:(S=e.point.settings)==null?void 0:S.is_required,"min-date":(R=e.point.settings)==null?void 0:R.min_date,"max-date":(O=e.point.settings)==null?void 0:O.max_date,error:u.error,"onUpdate:modelValue":r[6]||(r[6]=$=>u.$emit("update:notesValue",$)),onSave:r[7]||(r[7]=$=>u.$emit("saveDate",$))},null,8,["model-value","required","min-date","max-date","error"])])):b("",!0),e.point.input_type==="imageTOradio"?(a(),l("div",bo,[t("h4",wo,[(K=e.point.settings)!=null&&K.required?(a(),l("span",xo,"*")):b("",!0)]),ne(ye,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point.inspection_point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":r[8]||(r[8]=$=>u.$emit("update:imagesValue",$)),onSave:r[9]||(r[9]=$=>u.$emit("saveImage",$))},null,8,["model-value","point-id","point","inspection-id","settings"]),(X=e.point.settings)!=null&&X.required&&e.imagesValue.length===0?(a(),l("p",yo," Foto wajib diupload ")):b("",!0)])):b("",!0),e.options.length?(a(),l("div",{key:5,class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),l(se,null,oe(e.options,($,p)=>(a(),l("label",{key:p,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:$.value,checked:e.selectedValue===$.value,onChange:r[10]||(r[10]=L=>u.$emit("update:selectedValue",L.target.value)),class:"hidden peer"},null,40,ko),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===$.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==$.value}])},A($.label),3)]))),128))],2)):b("",!0),e.showTextarea&&((Y=(W=g.value)==null?void 0:W.settings)!=null&&Y.show_textarea)?(a(),l("div",$o,[(ee=g.value.settings)!=null&&ee.required?(a(),l("span",Vo,"*")):b("",!0),ne(Qe,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:g.value.settings,required:(ae=g.value.settings)==null?void 0:ae.required,"min-length":(N=g.value.settings)==null?void 0:N.min_length,"max-length":(j=g.value.settings)==null?void 0:j.max_length,placeholder:((d=g.value.settings)==null?void 0:d.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":r[11]||(r[11]=$=>u.$emit("update:notesValue",$)),onSave:r[12]||(r[12]=$=>u.$emit("saveTextarea",$))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(x=g.value.settings)!=null&&x.required&&!e.notesValue?(a(),l("p",Io," Keterangan wajib diisi ")):b("",!0)])):b("",!0),e.showImageUpload&&((B=(f=g.value)==null?void 0:f.settings)!=null&&B.show_image_upload)?(a(),l("div",Co,[t("h4",So,[r[19]||(r[19]=le(" Upload Foto ")),(i=g.value.settings)!=null&&i.required?(a(),l("span",Mo,"*")):b("",!0)]),ne(ye,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:g.value.settings,"onUpdate:modelValue":r[13]||(r[13]=$=>u.$emit("update:imagesValue",$)),onSave:r[14]||(r[14]=$=>u.$emit("saveImage",$))},null,8,["model-value","point-id","point","inspection-id","settings"]),(m=g.value.settings)!=null&&m.required&&e.imagesValue.length===0?(a(),l("p",Uo," Foto wajib diupload ")):b("",!0)])):b("",!0)])]}),_:1},8,["show","title","subtitle"]))}},qo={class:"mt-2 space-y-2"},No=["name","value","checked","onChange","required"],Ro={key:0,class:"p-2 rounded-lg bg-gray-50"},jo={key:0,class:"mt-2"},Bo={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Lo=["src"],Do={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Ao={key:1,class:"mt-2"},Fo={class:"text-sm text-gray-600"},zo={key:2,class:"mt-2 text-sm text-red-600"},Eo={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:F}){const s=e,V=F,h=T(s.notes),g=T([...s.images]),c=T(!1),u=T(""),r=T([]),M=T(""),y=T([]),k=J(()=>s.options.find(n=>n.value===s.modelValue)),w=n=>n.settings&&(n.settings.show_textarea||n.settings.show_image_upload);ie(()=>s.notes,n=>{h.value=n}),ie(()=>s.images,n=>{g.value=[...n]}),ie(()=>s.modelValue,n=>{n&&(M.value=n)});const I=n=>{V("update:modelValue",n.value),w(n)?C():V("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:n.value,notes:"",images:[]})},o=n=>n.preview||(n.image_path?`/${n.image_path}`:n),C=()=>{M.value=s.modelValue,u.value=h.value,r.value=[...g.value],y.value=[...g.value],c.value=!0},z=()=>{u.value="",r.value=[],M.value="",c.value=!1},D=n=>{r.value=n,g.value=[...n],V("update:images",[...n]),V("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:h.value,images:[...n]})},U=n=>{},E=()=>{M.value!==s.modelValue&&V("update:modelValue",M.value),h.value=u.value,V("update:notes",u.value),g.value=[...r.value],V("update:images",[...r.value]),V("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:M.value,notes:u.value,images:r.value}),c.value=!1},_=n=>{V("hapus",n),c.value=!1};return(n,S)=>{var R,O,K,X;return a(),l("div",qo,[t("div",{class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),l(se,null,oe(e.options,(W,Y)=>(a(),l("label",{key:Y,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:W.value,checked:e.modelValue===W.value,onChange:ee=>I(W),class:"hidden peer",required:e.required},null,40,No),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===W.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==W.value}])},A(W.label),3)]))),128))],2),e.modelValue&&k.value&&w(k.value)?(a(),l("div",Ro,[t("div",{class:"flex justify-between items-start"},[S[4]||(S[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:C,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((R=k.value.settings)!=null&&R.show_image_upload)?(a(),l("div",jo,[t("div",Bo,[(a(!0),l(se,null,oe(e.images,(W,Y)=>(a(),l("div",{key:Y,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:o(W),class:"w-full h-full object-cover rounded"},null,8,Lo),Y===3&&e.images.length>4?(a(),l("span",Do," +"+A(e.images.length-4),1)):b("",!0)]))),128))])])):b("",!0),e.notes&&((O=k.value.settings)!=null&&O.show_textarea)?(a(),l("div",Ao,[t("p",Fo,A(e.notes),1)])):b("",!0)])):b("",!0),c.value?(a(),te(Pe,{key:(K=e.selectedPoint)==null?void 0:K.id,show:c.value,title:e.pointName||"Detail",subtitle:(X=k.value)==null?void 0:X.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":M.value,"notes-value":u.value,"images-value":r.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":S[0]||(S[0]=W=>M.value=W),"onUpdate:notesValue":S[1]||(S[1]=W=>u.value=W),"onUpdate:imagesValue":S[2]||(S[2]=W=>D(W)),onClose:z,onSave:E,onSaveTextarea:n.handleTextareaSave,onSaveImage:U,onHapus:S[3]||(S[3]=W=>_(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):b("",!0),e.error?(a(),l("p",zo,A(e.error),1)):b("",!0)])}}},Ho={class:"mt-2 space-y-2"},Oo={key:0,class:"flex flex-wrap gap-3"},Wo={key:1,class:"p-2"},Zo={key:0,class:"mt-2"},Ko={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Xo=["src"],Go={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Yo=["name","value","checked"],Jo={key:1,class:"mt-2"},Qo={class:"text-sm text-gray-600"},Po={key:3,class:"mt-2 text-sm text-red-600"},ea={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:F}){const s=e,V=F,h=T(s.notes),g=T([...s.images]),c=T(!1),u=T(""),r=T([]),M=T(""),y=T([]),k=J(()=>s.options.find(U=>U.value===s.modelValue)),w=U=>U.preview||(U.image_path?`/${U.image_path}`:U);ie(()=>s.notes,U=>{h.value=U});const I=()=>{M.value=s.modelValue||"",u.value=h.value,r.value=[...g.value],y.value=[...g.value],c.value=!0},o=()=>{u.value="",r.value=[],M.value="",c.value=!1},C=U=>{r.value=U,g.value=[...U],V("update:images",[...U]),V("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:h.value,images:[...U]})},z=()=>{M.value!==s.modelValue&&V("update:modelValue",M.value),h.value=u.value,V("update:notes",u.value),g.value=[...r.value],V("update:images",[...r.value]),V("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:M.value,notes:u.value,images:r.value}),c.value=!1},D=U=>{V("hapus",U),c.value=!1};return(U,E)=>{var _,n,S;return a(),l("div",Ho,[!e.modelValue&&g.value.length===0&&!h.value?(a(),l("div",Oo,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:I},E[4]||(E[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(a(),l("div",Wo,[t("div",{class:"flex justify-between items-start"},[E[5]||(E[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:I,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),g.value.length>0?(a(),l("div",Zo,[t("div",Ko,[(a(!0),l(se,null,oe(g.value,(R,O)=>(a(),l("div",{key:O,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:w(R),class:"w-full h-full object-cover rounded"},null,8,Xo),O===3&&g.value.length>4?(a(),l("span",Go," +"+A(g.value.length-4),1)):b("",!0)]))),128))])])):b("",!0),t("div",{class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),l(se,null,oe(e.options,(R,O)=>(a(),l("label",{key:O,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:R.value,checked:e.modelValue===R.value,disabled:!0,class:"hidden peer"},null,8,Yo),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===R.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==R.value}])},A(R.label),3)]))),128))],2),h.value&&((_=k.value.settings)!=null&&_.show_textarea)?(a(),l("div",Jo,[t("p",Qo,A(h.value),1)])):b("",!0)])),c.value?(a(),te(Pe,{key:(n=e.selectedPoint)==null?void 0:n.id,show:c.value,title:e.pointName||"Detail",subtitle:(S=k.value)==null?void 0:S.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":M.value,"notes-value":u.value,"images-value":r.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":E[0]||(E[0]=R=>M.value=R),"onUpdate:notesValue":E[1]||(E[1]=R=>u.value=R),"onUpdate:imagesValue":E[2]||(E[2]=R=>C(R)),onClose:o,onSave:z,onHapus:E[3]||(E[3]=R=>D(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):b("",!0),e.error?(a(),l("p",Po,A(e.error),1)):b("",!0)])}}},ta={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},sa={class:"bg-indigo-200 px-6 py-2 border-b"},oa={class:"text-xl font-semibold text-indigo-700"},aa={class:"p-4 space-y-4"},na={class:"flex items-start justify-between"},ia={class:"block text-sm font-medium text-gray-700"},la={key:0,class:"text-red-500"},ra={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},da={key:0,class:"text-center py-8 text-gray-500"},ua={key:0,class:"text-xs text-gray-400"},ca={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(e,{emit:F}){const s=e,V=F,h=st(),g=J(()=>{var I;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(I=s.category.points)==null?void 0:I.length}),!s.category.isDamageMenu)return console.log("Menu biasa - tampilkan semua points"),s.category.points||[];const w=(s.category.points||[]).filter(o=>{var D,U;const C=(D=o.inspection_point)==null?void 0:D.id,z=c(C);return console.log(`Point ${C} (${(U=o.inspection_point)==null?void 0:U.name}): hasData = ${z}`),z});return console.log("Filtered damage points:",w),w}),c=w=>{if(!w)return console.log("hasPointData: pointId is null/undefined"),!1;const I=h.props.existingResults[w]!==void 0,o=h.props.existingImages[w]&&h.props.existingImages[w].length>0,C=s.form.results[w]&&(s.form.results[w].status||s.form.results[w].note),z=s.form.images[w]&&s.form.images[w].length>0,D=I||o||C||z;return console.log(`Point ${w} data check:`,{hasServerResult:I,hasServerImages:o,hasLocalResult:C,hasLocalImages:z,finalResult:D}),D},u=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],r=w=>{var C,z,D,U,E,_,n,S,R;const I=s.form.results[(C=w.inspection_point)==null?void 0:C.id],o=s.form.images[(z=w.inspection_point)==null?void 0:z.id];if(!I)return!1;switch(w.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!I.note;case"select":case"radio":if(!I.status)return!1;const O=(U=(D=w.settings)==null?void 0:D.radios)==null?void 0:U.find(X=>X.value===I.status);return!(O!=null&&O.settings&&(O.settings.show_textarea&&!((E=I.note)!=null&&E.trim())||O.settings.show_image_upload&&(o==null?void 0:o.length)===0));case"imageTOradio":if((o==null?void 0:o.length)===0||!I.status)return!1;const K=(n=(_=w.settings)==null?void 0:_.radios)==null?void 0:n.find(X=>X.value===I.status);return!(K!=null&&K.settings&&K.settings.show_textarea&&!((S=I.note)!=null&&S.trim()));case"image":return(o==null?void 0:o.length)>0;default:return!!I.status||!!((R=I.note)!=null&&R.trim())}},M=(w,I,o)=>{V("updateResult",{pointId:w,type:o,value:I})},y=w=>{V("saveResult",w)},k=w=>{V("hapusPoint",w)};return(w,I)=>(a(),l("div",ta,[t("div",sa,[t("h3",oa,A(e.category.name),1)]),t("div",aa,[(a(!0),l(se,null,oe(g.value,o=>{var C,z,D,U,E,_,n,S,R,O,K,X,W,Y,ee,ae,N,j,d,x,f,B,i,m,$,p,L,H,Z,G,de,ge,me,fe,Ve,Ie,Ce,Se,Me,Ue,_e,Te,qe,Ne,Re,je,Be,Le,De,Ae,Fe,ze,Ee,He,Oe,We;return a(),l("div",{key:o.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",na,[t("label",ia,[le(A((C=o.inspection_point)==null?void 0:C.name)+" ",1),(z=o.settings)!=null&&z.is_required?(a(),l("span",la,"*")):b("",!0)]),r(o)?(a(),l("span",ra," ✓ ")):b("",!0)]),o.input_type==="text"?(a(),te(Ge,{key:0,modelValue:e.form.results[(D=o.inspection_point)==null?void 0:D.id].note,"onUpdate:modelValue":[q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].note=q},q=>{var v;return M((v=o.inspection_point)==null?void 0:v.id,q,"note")}],required:(U=o.settings)==null?void 0:U.is_required,"min-length":(E=o.settings)==null?void 0:E.min_length,"max-length":(_=o.settings)==null?void 0:_.max_length,allowSpace:(n=o.settings)==null?void 0:n.allow_space,textTransform:(S=o.settings)==null?void 0:S.text_transform,placeholder:((R=o.settings)==null?void 0:R.placeholder)||"Masukan text",error:e.form.errors[`results.${(O=o.inspection_point)==null?void 0:O.id}.note`],onSave:q=>{var v;return y((v=o.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):b("",!0),o.input_type==="number"?(a(),te(Xe,{key:1,modelValue:e.form.results[(K=o.inspection_point)==null?void 0:K.id].note,"onUpdate:modelValue":[q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].note=q},q=>{var v;return M((v=o.inspection_point)==null?void 0:v.id,q,"note")}],required:(X=o.settings)==null?void 0:X.is_required,min:(W=o.settings)==null?void 0:W.min,max:(Y=o.settings)==null?void 0:Y.max,step:((ee=o.settings)==null?void 0:ee.step)||1,placeholder:((ae=o.settings)==null?void 0:ae.placeholder)||"Masukan number",error:e.form.errors[`results.${(N=o.inspection_point)==null?void 0:N.id}.note`],onSave:q=>{var v;return y((v=o.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):b("",!0),o.input_type==="account"?(a(),te(Je,{key:2,modelValue:e.form.results[(j=o.inspection_point)==null?void 0:j.id].note,"onUpdate:modelValue":[q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].note=q},q=>{var v;return M((v=o.inspection_point)==null?void 0:v.id,q,"note")}],required:(d=o.settings)==null?void 0:d.is_required,placeholder:((x=o.settings)==null?void 0:x.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${(f=o.inspection_point)==null?void 0:f.id}.note`],"point-id":(B=o.inspection_point)==null?void 0:B.id,settings:o.settings,onSave:q=>{var v;return y((v=o.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):b("",!0),o.input_type==="date"?(a(),te(Ye,{key:3,modelValue:e.form.results[(i=o.inspection_point)==null?void 0:i.id].note,"onUpdate:modelValue":[q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].note=q},q=>{var v;return M((v=o.inspection_point)==null?void 0:v.id,q,"note")}],required:(m=o.settings)==null?void 0:m.is_required,"min-date":($=o.settings)==null?void 0:$.min_date,"max-date":(p=o.settings)==null?void 0:p.max_date,error:e.form.errors[`results.${(L=o.inspection_point)==null?void 0:L.id}.note`],onSave:q=>{var v;return y((v=o.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):b("",!0),o.input_type==="textarea"?(a(),te(Qe,{key:4,modelValue:e.form.results[(H=o.inspection_point)==null?void 0:H.id].note,"onUpdate:modelValue":[q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].note=q},q=>{var v;return M((v=o.inspection_point)==null?void 0:v.id,q,"note")}],required:(Z=o.settings)==null?void 0:Z.is_required,"min-length":(G=o.settings)==null?void 0:G.min_length,"max-length":(de=o.settings)==null?void 0:de.max_length,placeholder:((ge=o.settings)==null?void 0:ge.placeholder)||"Masukkan teks di sini",settings:o.settings,error:e.form.errors[`results.${(me=o.inspection_point)==null?void 0:me.id}.note`],onSave:q=>{var v;return y((v=o.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):b("",!0),o.input_type==="radio"?(a(),te(Eo,{key:5,modelValue:e.form.results[(fe=o.inspection_point)==null?void 0:fe.id].status,"onUpdate:modelValue":[q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].status=q},q=>{var v;return M((v=o.inspection_point)==null?void 0:v.id,q,"status")}],notes:e.form.results[(Ve=o.inspection_point)==null?void 0:Ve.id].note,images:e.form.images[(Ie=o.inspection_point)==null?void 0:Ie.id],required:(Ce=o.settings)==null?void 0:Ce.is_required,"point-id":(Se=o.inspection_point)==null?void 0:Se.id,point:o.inspection_point,"inspection-id":e.inspectionId,settings:o.settings,"point-name":(Me=o.inspection_point)==null?void 0:Me.name,"selected-point":o.input_type==="damage"?o.inspection_point:null,options:((Ue=o.settings)==null?void 0:Ue.radios)||u,error:e.form.errors[`results.${(_e=o.inspection_point)==null?void 0:_e.id}.status`],"onUpdate:notes":q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].note=q},"onUpdate:images":q=>{var v;return e.form.images[(v=o.inspection_point)==null?void 0:v.id]=q},onSave:q=>{var v;return y((v=o.inspection_point)==null?void 0:v.id)},onHapus:q=>{var v;return k((v=o.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):b("",!0),o.input_type==="imageTOradio"?(a(),te(ea,{key:6,modelValue:e.form.results[(Te=o.inspection_point)==null?void 0:Te.id].status,"onUpdate:modelValue":[q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].status=q},q=>{var v;return M((v=o.inspection_point)==null?void 0:v.id,q,"status")}],notes:e.form.results[(qe=o.inspection_point)==null?void 0:qe.id].note,images:e.form.images[(Ne=o.inspection_point)==null?void 0:Ne.id],required:(Re=o.settings)==null?void 0:Re.is_required,"point-id":(je=o.inspection_point)==null?void 0:je.id,"inspection-id":e.inspectionId,settings:o.settings,"point-name":(Be=o.inspection_point)==null?void 0:Be.name,point:o,"selected-point":o.input_type==="damage"?o.inspection_point:null,options:((Le=o.settings)==null?void 0:Le.radios)||u,error:e.form.errors[`results.${(De=o.inspection_point)==null?void 0:De.id}.status`],"onUpdate:notes":q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].note=q},"onUpdate:images":q=>{var v;return e.form.images[(v=o.inspection_point)==null?void 0:v.id]=q},onSave:q=>{var v;return y((v=o.inspection_point)==null?void 0:v.id)},onHapus:q=>{var v;return k((v=o.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):b("",!0),o.input_type==="image"?(a(),te(ye,{key:7,modelValue:e.form.images[(Ae=o.inspection_point)==null?void 0:Ae.id],"onUpdate:modelValue":q=>{var v;return e.form.images[(v=o.inspection_point)==null?void 0:v.id]=q},error:e.form.errors[`images.${(Fe=o.inspection_point)==null?void 0:Fe.id}`],"inspection-id":e.inspectionId,"point-id":(ze=o.inspection_point)==null?void 0:ze.id,point:o.inspection_point,"point-name":(Ee=o.inspection_point)==null?void 0:Ee.name,settings:o.settings,"onUpdate:notes":q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].note=q},"onUpdate:status":q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].status=q}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):b("",!0),o.input_type==="select"?(a(),te(os,{key:8,modelValue:e.form.results[(He=o.inspection_point)==null?void 0:He.id].status,"onUpdate:modelValue":[q=>{var v;return e.form.results[(v=o.inspection_point)==null?void 0:v.id].status=q},q=>{var v;return M((v=o.inspection_point)==null?void 0:v.id,q,"status")}],required:(Oe=o.settings)==null?void 0:Oe.is_required,error:e.form.errors[`results.${(We=o.inspection_point)==null?void 0:We.id}.status`],onSave:q=>{var v;return y((v=o.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):b("",!0)])}),128)),g.value.length===0?(a(),l("div",da,[I[0]||(I[0]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),I[1]||(I[1]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),e.category.isDamageMenu?(a(),l("p",ua,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):b("",!0)])):b("",!0)])]))}},qa=ue(ca,[["__scopeId","data-v-cdbefdf5"]]),ga={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ma={class:"p-4 space-y-4-6"},pa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},va=["value"],fa={class:"p-4 space-y-4-6"},ha={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ba=["value"],wa={key:0,class:"p-4 space-y-4"},xa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ya=["value"],ka={class:"p-4 space-y-4"},$a={class:"flex gap-1 mb-2 p-2 bg-gray-100 rounded-md"},Va={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const F=e,s=T(null),V=T(!1),h=_=>{if(!_)return{};if(typeof _=="string")try{return JSON.parse(_)||{}}catch(n){return console.error("Error parsing settings JSON:",n),{}}return typeof _=="object"&&_!==null?_:{}},g=J(()=>h(F.inspection.settings).conclusion||{}),c=T({flooded:g.value.flooded||"",collision:g.value.collision||"",collision_severity:g.value.collision_severity||"",conclusion_note:F.inspection.notes||""}),u=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],r=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],M=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];ke(()=>{E(),be(()=>{y()})});const y=()=>{s.value&&c.value.conclusion_note&&(s.value.innerHTML=c.value.conclusion_note)},k=xe.debounce(()=>{s.value&&(c.value.conclusion_note=s.value.innerHTML,U())},500),w=_=>{_.preventDefault(),document.execCommand("insertParagraph",!1,null)},I=_=>{_.preventDefault();const n=(_.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,n)},o=_=>{if(s.value){switch(s.value.focus(),_){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"underline":document.execCommand("underline",!1,null);break}k()}},C=()=>{s.value&&(s.value.focus(),document.execCommand("insertUnorderedList",!1,null),k())},z=()=>{s.value&&(s.value.focus(),document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),k())},D=()=>{V.value=!1,s.value&&(c.value.conclusion_note=s.value.innerHTML,U())},U=xe.debounce(()=>{const _=window.getSelection(),n=_.rangeCount>0?_.getRangeAt(0):null,S={flooded:c.value.flooded,collision:c.value.collision,collision_severity:c.value.collision==="yes"?c.value.collision_severity:null,conclusion_note:c.value.conclusion_note};ot.post(route("inspections.updateConclusion",F.inspectionId),S,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{be(()=>{if(n&&s.value){const R=window.getSelection();if(R.removeAllRanges(),R.addRange(n),s.value.focus(),n.collapsed){const O=document.createRange();O.selectNodeContents(s.value),O.collapse(!1),R.removeAllRanges(),R.addRange(O)}}})},onError:R=>{console.error("Error saving conclusion:",R)}})},500);ie([()=>c.value.flooded,()=>c.value.collision,()=>c.value.collision_severity],()=>{U()});const E=()=>{const n=h(F.inspection.settings).conclusion||{};c.value={flooded:n.flooded||"",collision:n.collision||"",collision_severity:n.collision_severity||"",conclusion_note:F.inspection.notes||""}};return ie(()=>F.inspection,()=>{E(),be(()=>{y()})},{deep:!0}),(_,n)=>(a(),l("div",ga,[n[20]||(n[20]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),t("div",ma,[n[13]||(n[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),t("div",pa,[(a(),l(se,null,oe(u,S=>t("label",{key:S.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":n[0]||(n[0]=R=>c.value.flooded=R),value:S.value,class:"hidden peer",onChange:n[1]||(n[1]=(...R)=>Q(U)&&Q(U)(...R))},null,40,va),[[we,c.value.flooded]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":c.value.flooded===S.value,"border-gray-300 text-gray-700 hover:bg-gray-50":c.value.flooded!==S.value}])},A(S.label),3)])),64))])]),t("div",fa,[n[15]||(n[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),t("div",ha,[(a(),l(se,null,oe(r,S=>t("label",{key:S.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":n[2]||(n[2]=R=>c.value.collision=R),value:S.value,class:"hidden peer",onChange:n[3]||(n[3]=(...R)=>Q(U)&&Q(U)(...R))},null,40,ba),[[we,c.value.collision]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":c.value.collision===S.value,"border-gray-300 text-gray-700 hover:bg-gray-50":c.value.collision!==S.value}])},A(S.label),3)])),64))]),c.value.collision==="yes"?(a(),l("div",wa,[n[14]||(n[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[le(" Tingkat kerusakan: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",xa,[(a(),l(se,null,oe(M,S=>t("label",{key:S.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":n[4]||(n[4]=R=>c.value.collision_severity=R),value:S.value,class:"hidden peer",onChange:n[5]||(n[5]=(...R)=>Q(U)&&Q(U)(...R))},null,40,ya),[[we,c.value.collision_severity]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":c.value.collision_severity===S.value,"border-gray-300 text-gray-700 hover:bg-gray-50":c.value.collision_severity!==S.value}])},A(S.label),3)])),64))])])):b("",!0)]),t("div",ka,[n[19]||(n[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),t("div",$a,[t("button",{type:"button",onClick:n[6]||(n[6]=S=>o("bold")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Bold"},n[16]||(n[16]=[t("strong",null,"B",-1)])),t("button",{type:"button",onClick:n[7]||(n[7]=S=>o("italic")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Italic"},n[17]||(n[17]=[t("em",null,"I",-1)])),t("button",{type:"button",onClick:n[8]||(n[8]=S=>o("underline")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Underline"},n[18]||(n[18]=[t("u",null,"U",-1)])),t("button",{type:"button",onClick:n[9]||(n[9]=S=>C()),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Bullet List"}," • List "),t("button",{type:"button",onClick:n[10]||(n[10]=S=>z()),class:"p-2 rounded hover:bg-gray-200 transition-colors ml-2",title:"Clear Formatting"}," 🗑️ Clear ")]),t("div",{ref_key:"editorRef",ref:s,contenteditable:"true",class:P(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 prose max-w-none",{"bg-white":!V.value,"bg-blue-50":V.value}]),onInput:n[11]||(n[11]=(...S)=>Q(k)&&Q(k)(...S)),onBlur:D,onFocus:n[12]||(n[12]=S=>V.value=!0),onKeydown:at(w,["enter"]),onPaste:I,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},Na=ue(Va,[["__scopeId","data-v-b9a0d7b2"]]);export{go as B,qa as C,Ta as V,Pe as _,Na as a};
