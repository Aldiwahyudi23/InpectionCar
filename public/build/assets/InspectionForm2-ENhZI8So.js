import{d as g,k as _,q as xe,x as we,W as R,s as te,y as be,e as m,o as u,a as i,b as N,f as h,c as E,n as $,F as se,h as ne,g as oe,w as L,t as x,T as ie,u as f,l as ke,z as _e}from"./app-DQohUcZt.js";import{l as F,_ as Ce,C as Se,a as Me,B as De,b as Ae}from"./ConclusionSection-CFkzichu.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Re={class:"container mx-auto px-4 py-2"},Ee={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Ve={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Te=["onClick"],je={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ze={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Be={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Ne={class:"relative overflow-hidden"},$e={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},Le=["disabled"],Fe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Oe={class:"space-y-4"},Ue={class:"relative"},Ke={class:"max-h-64 overflow-y-auto"},He={key:0,class:"text-center py-4 text-gray-500"},Ie=["onClick"],qe={class:"font-medium text-gray-900"},Xe={class:"text-sm text-gray-500"},Je={class:"text-xs text-gray-400 mt-1"},We={key:0,class:"text-xs text-green-600 mt-1"},Qe={__name:"InspectionForm2",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Object,components:Array,damagePoints:Array},setup(V){var G;const n=V,C=g(!1),S=g(!1),w=g(""),r=g(null),M=g(null),D=g(""),b=g([]),k=g(""),ae=(t,e)=>t.filter(s=>e?K(s.id):!0),O=_(()=>n.damagePoints||[]),U=_(()=>{if(!w.value.trim())return O.value;const t=w.value.toLowerCase().trim();return O.value.filter(e=>{var s,a,d;return((s=e.name)==null?void 0:s.toLowerCase().includes(t))||((a=e.description)==null?void 0:a.toLowerCase().includes(t))||((d=H(e))==null?void 0:d.toLowerCase().includes(t))})}),K=t=>{var s;const e=l.results[t];return e&&(e.status||e.note||((s=e.images)==null?void 0:s.length)>0)};_(()=>{var t;return r.value?((t=r.value.component)==null?void 0:t.input_type)==="damage":!1});const H=t=>{const e=n.components.find(s=>s.id===t.component_id);return e?e.name:"Komponen Tidak Diketahui"},le=t=>t&&Array.isArray(n.existingResults)?n.existingResults.find(e=>e.point_id===t):null,re=t=>{r.value=t;const e=l.results[t.id]||{};M.value=e.status||"",D.value=e.note||"",b.value=Array.isArray(e.images)?[...e.images]:[],C.value=!1,S.value=!0},ue=t=>{r.value&&(l.results[r.value.id]={...l.results[r.value.id],status:M.value,note:D.value,images:Array.isArray(b.value)?[...b.value]:[]},B(r.value.id),k.value="Data berhasil disimpan!",setTimeout(()=>{k.value=""},2e3)),T()},ce=()=>{C.value=!1,w.value=""},T=()=>{S.value=!1,r.value=null,M.value="",D.value="",b.value=[]},I=xe(),y=I.props.inspection;I.props.car;const c=g(((G=n.appMenu[0])==null?void 0:G.id)||"summary"),P=g(0);g(null);const A=_(()=>c.value!=="summary"?n.appMenu.find(t=>t.id===c.value):null),l=we((()=>{const t={};return n.appMenu.forEach(e=>{(e.points||[]).forEach(s=>{var d,p;const a=Array.isArray(n.existingResults)?n.existingResults.find(v=>v.point_id===s.id):null;t[s.id]={status:(a==null?void 0:a.status)||"",note:(a==null?void 0:a.note)||"",images:((p=(d=n.existingImages)==null?void 0:d[s.id])==null?void 0:p.map(v=>({image_path:v.image_path,preview:null})))||[]}})}),{inspection_id:n.inspection.id,results:t,overall_note:n.inspection.overall_note||""}})()),q=t=>t.input_type==="damage"||j?!0:t.points.every(e=>{var a,d;const s=l.results[e.id];if(!s)return!1;switch(e.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!s.note;case"select":case"radio":return!!s.status;case"image":return((a=s.images)==null?void 0:a.length)>0;case"imageTOradio":return((d=s.images)==null?void 0:d.length)>0;default:return!!s.status||!!s.note}}),X=t=>{if(!t)return{};if(typeof t=="string")try{return JSON.parse(t)||{}}catch(e){return console.error("Error parsing settings JSON:",e),{}}return typeof t=="object"&&t!==null?t:{}},j=()=>{var v;const e=X(n.inspection.settings).conclusion||{},s=!!e.flooded,a=!!e.collision,d=e.collision==="yes"?!!e.collision_severity:!0,p=!!((v=n.inspection.notes)!=null&&v.trim());return s&&a&&d&&p},de=_(()=>{const e=X(n.inspection.settings).conclusion||{};return{flooded:e.flooded||null,collision:e.collision||null,collision_severity:e.collision_severity||null,note:n.inspection.notes||null,isComplete:j()}}),z=t=>{if(t==="summary")P.value=n.appMenu.length;else{const e=n.appMenu.findIndex(s=>s.id===t);e>=0&&(P.value=e)}c.value=t},J=t=>{let e=P.value+t;const s=n.appMenu.length;e>=0&&e<=s&&(P.value=e,e===s?c.value="summary":c.value=n.appMenu[e].id)},pe=()=>{let t=0,e=0;const s=v=>{t=v.changedTouches[0].screenX},a=v=>{e=v.changedTouches[0].screenX,d()},d=()=>{e<t-100?J(1):e>t+100&&J(-1)},p=document.querySelector(".relative.overflow-hidden");return p&&(p.addEventListener("touchstart",s,!1),p.addEventListener("touchend",a,!1)),()=>{p&&(p.removeEventListener("touchstart",s),p.removeEventListener("touchend",a))}},B=F.debounce(async t=>{try{await R.post(route("inspections.save-result"),{inspection_id:n.inspection.id,point_id:t,status:l.results[t].status,note:l.results[t].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(e){console.error("Error menyimpan hasil:",e)}},500),ve=({pointId:t,type:e,value:s})=>{l.results[t].hasOwnProperty(e)&&(l.results[t][e]=s),B(t)},W=async t=>{if(!(!t||!t)&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await R.post(route("inspections.delete-result"),{inspection_id:n.inspection.id,point_id:t},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{l.results[t]&&delete l.results[t],k.value="Data berhasil dihapus!",setTimeout(()=>{k.value=""},2e3)}})}catch(e){console.error("Error menghapus hasil:",e)}T()}},me=t=>{R.post(route("inspections.update-vehicle"),{inspection_id:y.id,...t},{preserveScroll:!0,onSuccess:()=>{console.log("Data kendaraan berhasil diupdate")}})},ge=t=>{Object.assign(l.conclusion,t),fe()},fe=F.debounce(()=>{R.post(route("inspections.save-conclusion"),{inspection_id:y.id,...l.conclusion},{preserveScroll:!0,onSuccess:()=>{console.log("Kesimpulan berhasil disimpan")}})},500),he=()=>{if(!Q.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}l.post(route("inspections.final-submit",{id:n.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:t=>{console.error("Kesalahan pengiriman:",t)}})};te(c,t=>{const e=document.querySelector(`.flex-shrink-0[data-category-id="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const Q=_(()=>{const t=n.appMenu.every(s=>q(s)),e=j();return t&&e});return g(!1),te(w,F.debounce(()=>{},300)),be(()=>{pe()}),(t,e)=>{var s,a,d,p,v,Y,Z,ee;return u(),m("div",Re,[i("div",Ee,[i("div",Ve,[i("button",{onClick:e[0]||(e[0]=o=>z("vehicle")),class:$(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":c.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":c.value!=="vehicle"}])}," Detail Kendaraan ",2),(u(!0),m(se,null,ne(V.appMenu,o=>(u(),m("button",{key:o.id,onClick:ye=>z(o.id),class:$(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":c.value===o.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":c.value!==o.id}])},[oe(x(o.name)+" ",1),q(o)?(u(),m("span",je," ✓ ")):h("",!0)],10,Te))),128)),i("button",{onClick:e[1]||(e[1]=o=>z("conclusion")),class:$(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":c.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":c.value!=="conclusion"}])},[e[7]||(e[7]=oe(" Kesimpulan ")),de.value.isComplete?(u(),m("span",ze," ✓ ")):h("",!0)],2)])]),N(ie,{name:"fade"},{default:L(()=>[k.value?(u(),m("div",Be,x(k.value),1)):h("",!0)]),_:1}),i("div",Ne,[N(ie,{name:"category-slide",mode:"out-in"},{default:L(()=>[c.value==="vehicle"?(u(),E(Ce,{key:0,inspection:f(y),CarDetail:V.CarDetail,onUpdateVehicle:me,onSaveCarDetails:t.saveNewCarDetails},null,8,["inspection","CarDetail","onSaveCarDetails"])):A.value&&c.value!=="conclusion"?(u(),E(Se,{key:A.value.id,category:{...A.value,points:ae(A.value.points||[],A.value.input_type==="damage")},"inspection-id":f(y).id,form:f(l),onSaveResult:f(B),onUpdateResult:ve,onHapusPoint:W,onRemoveImage:t.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):c.value==="conclusion"?(u(),E(Me,{key:2,form:f(l),"inspection-id":f(y).id,inspection:f(y),settings:f(y).settings||{},onUpdateConclusion:ge},null,8,["form","inspection-id","inspection","settings"])):h("",!0)]),_:1})]),c.value==="conclusion"?(u(),m("div",$e,[i("button",{type:"button",onClick:he,disabled:!Q.value||f(l).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[f(l).processing?(u(),m("svg",Fe,e[8]||(e[8]=[i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):h("",!0),i("span",null,x(f(l).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Le)])):h("",!0),!C.value&&!S.value?(u(),m("button",{key:1,onClick:e[2]||(e[2]=o=>C.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},e[9]||(e[9]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):h("",!0),N(De,{show:C.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:ce},{default:L(()=>[i("div",Oe,[i("div",Ue,[ke(i("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>w.value=o),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[_e,w.value]]),e[10]||(e[10]=i("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[i("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),i("div",Ke,[U.value.length===0?(u(),m("div",He," Tidak ada point yang ditemukan "+x(),1)):h("",!0),(u(!0),m(se,null,ne(U.value,o=>(u(),m("button",{key:o.id,onClick:ye=>re(o),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[i("div",qe,x(o.name),1),i("div",Xe,x(o.description),1),i("div",Je,x(H(o)),1),K(o.id)?(u(),m("div",We," ✓ Sudah ada data ")):h("",!0)],8,Ie))),128))])])]),_:1},8,["show"]),S.value?(u(),E(Ae,{key:(s=t.modalselectedPoint)==null?void 0:s.id,show:S.value,title:((a=r.value)==null?void 0:a.name)||"Detail Point",subtitle:(d=r.value)==null?void 0:d.description,name:`point-${(p=r.value)==null?void 0:p.id}`,"inspection-id":f(y).id,"point-id":(v=r.value)==null?void 0:v.id,settings:((Y=r.value)==null?void 0:Y.settings)||{},options:((Z=r.value)==null?void 0:Z.settings.radios)||[],"selected-Point":r.value,"selected-value":M.value??"","images-value":b.value??[],"notes-value":D.value??"","selected-point":r.value,point:r.value,"existing-data":le((ee=r.value)==null?void 0:ee.id),"onUpdate:selectedValue":e[4]||(e[4]=o=>M.value=o),"onUpdate:notesValue":e[5]||(e[5]=o=>D.value=o),"onUpdate:imagesValue":e[6]||(e[6]=o=>b.value=o),onSave:ue,onClose:T,onHapus:W},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","selected-point","point","existing-data"])):h("",!0)])}}},tt=Pe(Qe,[["__scopeId","data-v-2d99f26d"]]);export{tt as default};
