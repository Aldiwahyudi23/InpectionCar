import{r as g,q as R,G as Y,c as n,o as s,d as e,b as T,z as A,A as O,n as ue,t as k,u as _,F as P,m as U,f as oe,g as pe,I as G,J as ye,x as he,p as ke,H as ce,E as xe,j as ne,w as _e,k as me,v as we,C as Ce,y as ie}from"./vendor-lhzHoW6A.js";import{A as $e}from"./AppLayout-B8aVOUmv.js";import{l as Te}from"./lodash-DrtvmM31.js";import{_ as Be}from"./app-Da3-dAnJ.js";const Me={class:"mb-2"},Se={class:"flex items-center space-x-2"},Ae=["disabled"],Ie=["disabled"],De={key:1,class:"mt-2 text-sm text-red-600"},Pe={key:2,class:"mt-2 text-sm text-green-600"},je={key:3,class:"mt-2 text-sm text-yellow-600"},Ve={__name:"PlateNumberInput",props:{plateNumber:String,inspections:Array},emits:["update:plateNumber","plateValidityUpdate","carDataUpdate"],setup(F,{emit:I}){const o=F,B=I,v=g(""),h=g(""),f=g(""),$=g(""),w=g(""),b=g(""),m=g(!0),C={BL:"Aceh",BB:"Tapanuli (Sumatera Utara)",BK:"Medan, Deli Serdang, Binjai (Sumatera Utara)",BA:"Sumatera Barat",BM:"Riau",BH:"Jambi",BD:"Bengkulu",BG:"Sumatera Selatan",BN:"Bangka Belitung",BE:"Lampung",A:"Banten (Serang, Pandeglang, Cilegon, Lebak)",B:"Jakarta, Depok, Tangerang, Bekasi (Jadetabek)",D:"Bandung, Cimahi",E:"Cirebon, Indramayu, Majalengka, Kuningan",F:"Bogor, Sukabumi, Cianjur",T:"Karawang, Purwakarta, Subang, Bekasi Kabupaten, sebagian Cikampek",Z:"Garut, Tasikmalaya, Ciamis, Banjar, Sumedang",G:"Pekalongan, Tegal, Brebes, Pemalang, Batang",H:"Semarang, Kendal, Salatiga, Demak",K:"Pati, Kudus, Rembang, Blora, Jepara",R:"Banyumas, Cilacap, Purbalingga, Banjarnegara",AA:"Magelang, Temanggung, Purworejo, Wonosobo",AB:"DI Yogyakarta (Sleman, Bantul, Gunungkidul, Kulonprogo, Kota Jogja)",AD:"Surakarta (Solo), Sragen, Boyolali, Klaten, Wonogiri, Sukoharjo, Karanganyar",L:"Surabaya",M:"Madura (Bangkalan, Sampang, Pamekasan, Sumenep)",N:"Malang, Pasuruan, Probolinggo, Lumajang, Batu",P:"Jember, Banyuwangi, Bondowoso, Situbondo",S:"Bojonegoro, Lamongan, Tuban, Mojokerto, Jombang",W:"Sidoarjo, Gresik",AE:"Madiun, Magetan, Ngawi, Ponorogo, Pacitan",AG:"Kediri, Blitar, Tulungagung, Trenggalek",DK:"Bali",DR:"Lombok (NTB)",EA:"Sumbawa, Dompu, Bima (NTB)",DH:"Nusa Tenggara Timur (Kupang, Timor)",EB:"Flores, Lembata",ED:"Sumba",DA:"Kalimantan Selatan (Banjarmasin, Banjarbaru, dll.)",KB:"Kalimantan Barat (Pontianak, Singkawang, dll.)",KH:"Kalimantan Tengah (Palangkaraya, Sampit, dll.)",KT:"Kalimantan Timur (Balikpapan, Samarinda, Bontang, dll.)",KU:"Kalimantan Utara (Tarakan, Nunukan, Malinau, Tana Tidung, Bulungan)",DB:"Sulawesi Utara (Manado, Bitung, Minahasa, dll.)",DL:"Sangihe, Talaud (Sulut)",DM:"Gorontalo",DN:"Sulawesi Tengah (Palu, Poso, Banggai, dll.)",DT:"Sulawesi Tenggara (Kendari, Bau-bau, Kolaka, dll.)",DD:"Sulawesi Selatan (Makassar, Gowa, Bone, dll.)",DC:"Polewali Mandar, Majene, Mamasa (Sulbar)",DW:"Mamuju, Pasangkayu, Mamuju Tengah (Sulbar)",DE:"Maluku (Ambon, Maluku Tengah, dll.)",DG:"Maluku Utara (Ternate, Halmahera, dll.)",PA:"Papua (Jayapura, Merauke, dll.)",PB:"Papua Barat (Manokwari, Sorong, Fakfak, dll.)"},S=()=>{const i=`${v.value}${h.value}${f.value}`.toUpperCase();B("update:plateNumber",i)},D=i=>{i==="area"?v.value=v.value.toUpperCase().replace(/[^A-Z]/g,""):i==="number"?h.value=h.value.replace(/[^0-9]/g,""):i==="suffix"&&(f.value=f.value.toUpperCase().replace(/[^A-Z]/g,"")),S(),E()},E=()=>{v.value&&C[v.value]?(w.value=`âœ… ${v.value} = ${C[v.value]}`,m.value=!1):v.value?(w.value=`ðŸš« Kode wilayah "${v.value}" tidak valid`,m.value=!0):(w.value="âš  Masukkan kode wilayah (contoh: D, B, DK)",m.value=!0)},N=R(()=>v.value.trim().length>=1&&h.value.trim().length>=1&&!m.value);Y(N,i=>{B("plateValidityUpdate",i)}),Y([v,h,f],()=>{$.value="",b.value=""}),Y(()=>o.plateNumber,i=>{i.length>=3&&d(i)});const d=i=>{const c=o.inspections.filter(x=>x.plate_number===i);if(c.length>0){const x=["draft","in_progress","pending","pending_review","revision"],y=c.find(L=>x.includes(L.status));if(y){$.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${y.status.replace(/_/g," ").toUpperCase()}. Selesaikan inspeksi tersebut terlebih dahulu.`,B("plateValidityUpdate",!1);return}const z=c.filter(L=>["approved","rejected","completed","cancelled"].includes(L.status));if(z.length>0){z.sort((J,j)=>new Date(j.created_at)-new Date(J.created_at));const L=z[0];B("carDataUpdate",{id:L.car_id,name:L.car_name}),b.value=`Nomor plat ini sudah pernah diperiksa ${z.length} kali sebelumnya.`}}};return(i,c)=>(s(),n("div",Me,[c[6]||(c[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),e("div",Se,[A(e("input",{"onUpdate:modelValue":c[0]||(c[0]=x=>v.value=x),type:"text",placeholder:"D",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition",onInput:c[1]||(c[1]=x=>D("area")),maxlength:"2"},null,544),[[O,v.value]]),A(e("input",{"onUpdate:modelValue":c[2]||(c[2]=x=>h.value=x),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition",onInput:c[3]||(c[3]=x=>D("number")),disabled:m.value,maxlength:"4"},null,40,Ae),[[O,h.value]]),A(e("input",{"onUpdate:modelValue":c[4]||(c[4]=x=>f.value=x),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition",onInput:c[5]||(c[5]=x=>D("suffix")),disabled:m.value,maxlength:"3"},null,40,Ie),[[O,f.value]])]),w.value?(s(),n("div",{key:0,class:ue(["mt-2 text-sm",m.value?"text-red-600":"text-green-600"])},k(w.value),3)):T("",!0),$.value?(s(),n("div",De,k($.value),1)):T("",!0),b.value?(s(),n("div",Pe,k(b.value),1)):T("",!0),N.value?T("",!0):(s(),n("div",je," âš  Kolom kode wilayah dan nomor plat harus diisi "))]))}},Ue={class:"mb-2"},Ke={class:"relative"},Ne={key:0,class:"absolute right-3 top-3"},Le={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ee={key:0},Ge=["onMousedown"],ze={class:"font-medium text-gray-900"},Fe={key:1,class:"p-4 text-sm text-gray-500 text-center"},He={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200"},Je={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},We=["onClick"],qe=["src","alt"],Re={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Ye={class:"text-white text-xs text-center"},Oe={__name:"CarSearchInput",props:{carId:[Number,String],carName:String,carDetail:Array},emits:["update:carId","update:carName","carSelected","carImagesLoaded"],setup(F,{emit:I}){const o=F,B=I,v=g(""),h=g(!1),f=g(!1),$=g([]),w=g(null),b=g([]),m=d=>{var c,x,y;if(!d)return"";const i=[];return(c=d.brand)!=null&&c.name&&i.push(d.brand.name),(x=d.model)!=null&&x.name&&i.push(d.model.name),(y=d.type)!=null&&y.name&&i.push(d.type.name),d.cc&&i.push((d.cc/1e3).toFixed(1)),d.transmission&&i.push(d.transmission),d.year&&i.push(d.year.toString()),d.fuel_type&&i.push(d.fuel_type),d.production_period&&i.push(`(${d.production_period})`),i.join(" ")},C=Te.debounce(()=>{if(!v.value.trim()){$.value=[],h.value=!1;return}f.value=!0;const d=v.value.toLowerCase().trim();$.value=o.carDetail.filter(i=>m(i).toLowerCase().includes(d)),h.value=!0,f.value=!1},300),S=()=>{setTimeout(()=>{h.value=!1},200)},D=async d=>{w.value=d,v.value=m(d),B("update:carId",d.id),B("update:carName",m(d)),B("carSelected",d),h.value=!1;const i=await E(d.id);B("carImagesLoaded",i)},E=async d=>{try{const i=await fetch(`/api/cars/${d}/images`);if(i.ok){const c=await i.json(),x=Array.isArray(c)?c:[];return b.value=x,x}else return b.value=[],[]}catch(i){return console.error("Error loading car images:",i),b.value=[],[]}},N=d=>!d||!d.file_path?"":`/storage/${d.file_path}`;return Y(()=>o.carId,d=>{d||(w.value=null,v.value="",b.value=[])}),Y(v,d=>{(!w.value||m(w.value)!==d)&&(B("update:carId",null),w.value=null,b.value=[])}),(d,i)=>(s(),n(P,null,[e("div",Ue,[i[5]||(i[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),e("div",Ke,[A(e("input",{"onUpdate:modelValue":i[0]||(i[0]=c=>v.value=c),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:i[1]||(i[1]=(...c)=>_(C)&&_(C)(...c)),onFocus:i[2]||(i[2]=c=>h.value=!0),onBlur:S},null,544),[[O,v.value]]),f.value?(s(),n("div",Ne,i[3]||(i[3]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):T("",!0),h.value?(s(),n("div",Le,[$.value.length>0?(s(),n("div",Ee,[(s(!0),n(P,null,U($.value,c=>(s(),n("div",{key:c.id,class:"px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:x=>D(c)},[e("div",ze,k(m(c)),1)],40,Ge))),128))])):(s(),n("div",Fe,i[4]||(i[4]=[oe(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),oe(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):T("",!0)])]),w.value&&b.value.length>0?(s(),n("div",He,[i[6]||(i[6]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",Je,[(s(!0),n(P,null,U(b.value,(c,x)=>(s(),n("div",{key:c.id||x,class:"relative group cursor-pointer",onClick:y=>d.openLightbox(x)},[e("img",{src:N(c),alt:c.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,qe),c.note?(s(),n("div",Re,[e("p",Ye,k(c.note),1)])):T("",!0)],8,We))),128))])])):T("",!0)],64))}},Ze={class:"mb-2"},Qe={class:"mb-4"},Xe=["disabled"],ea=["value"],aa={class:"mb-4"},ta=["disabled"],oa=["value"],la={class:"mb-4"},sa=["disabled"],ra=["value"],na={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ia=["disabled"],ua=["value"],da=["disabled"],ca=["value"],ma={class:"mb-4"},pa={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},ga=["value","disabled"],va={class:"mb-4"},fa=["disabled"],ba=["value"],ya={class:"mb-4"},ha=["disabled"],ka=["value"],xa={key:0,class:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg"},_a={class:"text-green-700"},wa={key:1,class:"mt-2 text-sm text-gray-500 flex items-center"},Ca={__name:"CarSelectionWizard",props:{carDetail:Array},emits:["car-selected","car-images-loaded"],setup(F,{emit:I}){const o=I,B=g(""),v=g(""),h=g(""),f=g(""),$=g(""),w=g(""),b=g(""),m=g(""),C=g(null),S=g([]),D=g([]),E=g([]),N=g([]),d=g([]),i=g([]),c=g([]),x=g([]),y=g({brand:!1,model:!1,type:!1,capacity:!1,year:!1,transmission:!1,fuel:!1,period:!1}),z=R(()=>Object.values(y.value).some(u=>u)),L=u=>(u/1e3).toFixed(1)+"L",J=u=>{const t={AT:{category:"AT",label:"Automatic"},MT:{category:"MT",label:"Manual"},CVT:{category:"AT",label:"CVT"},"e-CVT":{category:"AT",label:"e-CVT"},DCT:{category:"AT",label:"DCT"},IVT:{category:"AT",label:"IVT"},SSG:{category:"AT",label:"SSG"},AGS:{category:"AT",label:"AGS"},DHT:{category:"AT",label:"DHT"},AMT:{category:"MT",label:"AMT"}}[u];return t?t.label==="Automatic"||t.label==="Manual"?t.category:`${t.category} (${t.label})`:u},j=async(u,a={})=>{const t=new AbortController,M=setTimeout(()=>t.abort(),5e3);try{const V=await fetch(u,{...a,signal:t.signal});return clearTimeout(M),V}catch(V){throw clearTimeout(M),V}},Q=async()=>{y.value.brand=!0;try{const u=await j("/api/car-brands");S.value=await u.json()}catch(u){console.error("Error fetching brands:",u)}finally{y.value.brand=!1}},X=async u=>{if(u){y.value.model=!0;try{const a=await j(`/api/car-models/${u}`);D.value=await a.json()}catch(a){console.error("Error fetching models:",a)}finally{y.value.model=!1}}},le=async u=>{if(u){y.value.type=!0;try{const a=await j(`/api/car-types/${u}`);E.value=await a.json()}catch(a){console.error("Error fetching types:",a)}finally{y.value.type=!1}}},Z=async u=>{if(u){y.value.capacity=!0;try{const a=await j(`/api/car-capacities/${u}`);N.value=await a.json()}catch(a){console.error("Error fetching capacities:",a)}finally{y.value.capacity=!1}}},ee=async(u,a)=>{if(!(!u||!a)){y.value.year=!0;try{const t=await j(`/api/car-years/${u}/${a}`);d.value=await t.json()}catch(t){console.error("Error fetching years:",t)}finally{y.value.year=!1}}},ae=async(u,a,t)=>{if(!(!u||!a||!t)){y.value.transmission=!0;try{const M=await j(`/api/car-transmissions/${u}/${a}/${t}`);i.value=await M.json()}catch(M){console.error("Error fetching transmissions:",M)}finally{y.value.transmission=!1}}},te=async(u,a,t,M)=>{if(!(!u||!a||!t||!M)){y.value.fuel=!0;try{const V=await j(`/api/car-fuels/${u}/${a}/${t}/${M}`);c.value=await V.json()}catch(V){console.error("Error fetching fuels:",V)}finally{y.value.fuel=!1}}},se=async(u,a,t,M,V)=>{if(!(!u||!a||!t||!M||!V)){y.value.period=!0;try{const q=await j(`/api/car-periods/${u}/${a}/${t}/${M}/${V}`);x.value=await q.json()}catch(q){console.error("Error fetching periods:",q)}finally{y.value.period=!1}}},r=async u=>{try{const a=await fetch(`/api/cars/${u}/images`);if(a.ok){const t=await a.json(),M=Array.isArray(t)?t:[];return o("car-images-loaded",M),M}return[]}catch(a){return console.error("Error loading car images:",a),[]}},l=async(u,a,t,M,V,q)=>{if(!(!u||!a||!t||!M||!V||!q))try{const re=await j(`/api/car-details/${u}/${a}/${t}/${M}/${V}/${q}`);C.value=await re.json(),C.value&&(o("car-selected",C.value),await r(C.value.id))}catch(re){console.error("Error fetching car detail:",re)}},K=()=>{H(["model","type","capacity","year","transmission","fuel","period"]),B.value&&X(B.value)},p=()=>{H(["type","capacity","year","transmission","fuel","period"]),v.value&&le(v.value)},W=()=>{H(["capacity","year","transmission","fuel","period"]),h.value&&Z(h.value)},de=()=>{H(["year","transmission","fuel","period"]),h.value&&f.value&&ee(h.value,f.value)},ge=()=>{H(["transmission","fuel","period"]),h.value&&f.value&&$.value&&ae(h.value,f.value,$.value)},ve=()=>{H(["fuel","period"]),h.value&&f.value&&$.value&&w.value&&te(h.value,f.value,$.value,w.value)},fe=()=>{H(["period"]),h.value&&f.value&&$.value&&w.value&&b.value&&se(h.value,f.value,$.value,w.value,b.value)},be=()=>{C.value=null,h.value&&f.value&&$.value&&w.value&&b.value&&m.value&&l(h.value,f.value,$.value,w.value,b.value,m.value)},H=u=>{u.forEach(a=>{a==="model"&&(v.value=""),a==="type"&&(h.value=""),a==="capacity"&&(f.value=""),a==="year"&&($.value=""),a==="transmission"&&(w.value=""),a==="fuel"&&(b.value=""),a==="period"&&(m.value="")}),C.value=null,u.includes("model")&&(D.value=[]),u.includes("type")&&(E.value=[]),u.includes("capacity")&&(N.value=[]),u.includes("year")&&(d.value=[]),u.includes("transmission")&&(i.value=[]),u.includes("fuel")&&(c.value=[]),u.includes("period")&&(x.value=[])};return pe(()=>{Q()}),(u,a)=>(s(),n("div",Ze,[e("div",Qe,[a[9]||(a[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Brand",-1)),A(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>B.value=t),onChange:K,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:y.value.brand},[a[8]||(a[8]=e("option",{value:""},"Pilih Brand",-1)),(s(!0),n(P,null,U(S.value,t=>(s(),n("option",{key:t.id,value:t.id},k(t.name),9,ea))),128))],40,Xe),[[G,B.value]])]),e("div",aa,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Model",-1)),A(e("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>v.value=t),onChange:p,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!B.value||y.value.model},[a[10]||(a[10]=e("option",{disabled:"",value:""},"Pilih Model",-1)),(s(!0),n(P,null,U(D.value,t=>(s(),n("option",{key:t.id,value:t.id},k(t.name),9,oa))),128))],40,ta),[[G,v.value]])]),e("div",la,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type/Varian",-1)),A(e("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>h.value=t),onChange:W,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!v.value||y.value.type},[a[12]||(a[12]=e("option",{disabled:"",value:""},"Pilih Type",-1)),(s(!0),n(P,null,U(E.value,t=>(s(),n("option",{key:t.id,value:t.id},k(t.name),9,ra))),128))],40,sa),[[G,h.value]])]),e("div",na,[e("div",null,[a[15]||(a[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Kapasitas Mesin",-1)),A(e("select",{"onUpdate:modelValue":a[3]||(a[3]=t=>f.value=t),onChange:de,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!h.value||y.value.capacity},[a[14]||(a[14]=e("option",{disabled:"",value:""},"Pilih Kapasitas",-1)),(s(!0),n(P,null,U(N.value,t=>(s(),n("option",{key:t.cc,value:t.cc},k(t.display),9,ua))),128))],40,ia),[[G,f.value]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun",-1)),A(e("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>$.value=t),onChange:ge,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!f.value||y.value.year},[a[16]||(a[16]=e("option",{disabled:"",value:""},"Pilih Tahun",-1)),(s(!0),n(P,null,U(d.value,t=>(s(),n("option",{key:t.year,value:t.year},k(t.year),9,ca))),128))],40,da),[[G,$.value]])])]),e("div",ma,[a[18]||(a[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Transmisi",-1)),e("div",pa,[(s(!0),n(P,null,U(i.value,t=>(s(),n("label",{key:t.transmission,class:ue(["flex items-center justify-center cursor-pointer rounded-xl border p-3 text-sm font-medium transition-all duration-200",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":w.value===t.transmission,"border-gray-300 text-gray-700 hover:border-indigo-300":w.value!==t.transmission}])},[A(e("input",{type:"radio","onUpdate:modelValue":a[5]||(a[5]=M=>w.value=M),value:t.transmission,onChange:ve,class:"sr-only",disabled:!$.value||y.value.transmission},null,40,ga),[[ye,w.value]]),oe(" "+k(J(t.transmission)),1)],2))),128))])]),e("div",va,[a[20]||(a[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bahan Bakar",-1)),A(e("select",{"onUpdate:modelValue":a[6]||(a[6]=t=>b.value=t),onChange:fe,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!w.value||y.value.fuel},[a[19]||(a[19]=e("option",{disabled:"",value:""},"Pilih Bahan Bakar",-1)),(s(!0),n(P,null,U(c.value,t=>(s(),n("option",{key:t.fuel_type,value:t.fuel_type},k(t.fuel_type),9,ba))),128))],40,fa),[[G,b.value]])]),e("div",ya,[a[22]||(a[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Periode Produksi",-1)),A(e("select",{"onUpdate:modelValue":a[7]||(a[7]=t=>m.value=t),onChange:be,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!b.value||y.value.period},[a[21]||(a[21]=e("option",{disbaled:"",value:""},"Pilih Periode Produksi",-1)),(s(!0),n(P,null,U(x.value,t=>(s(),n("option",{key:t.production_period,value:t.production_period},k(t.production_period),9,ka))),128))],40,ha),[[G,m.value]])]),C.value?(s(),n("div",xa,[a[23]||(a[23]=e("h4",{class:"font-medium text-green-800 mb-2"},"Mobil Terpilih:",-1)),e("p",_a,k(C.value.brand.name)+" "+k(C.value.model.name)+" "+k(C.value.type.name)+" "+k(L(C.value.cc))+" "+k(J(C.value.transmission))+" "+k(C.value.fuel_type)+" "+k(C.value.year)+" ("+k(C.value.production_period)+")",1)])):T("",!0),z.value?(s(),n("div",wa,a[24]||(a[24]=[e("svg",{class:"animate-spin h-4 w-4 mr-2 text-indigo-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),oe(" Memuat data... ")]))):T("",!0)]))}},$a={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},Ta={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},Ba={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},Ma={class:"mb-2 flex justify-end"},Sa={class:"mb-4"},Aa=["value"],Ia={class:"mb-4 flex items-center justify-between"},Da={class:"relative inline-flex items-center cursor-pointer"},Pa=["disabled"],ja={key:3,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Va=["min"],Ua={key:0,class:"mb-6"},Ka=["value"],Na={class:"mt-6 flex justify-end"},La=["disabled"],Ea={key:4,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ga={key:0,class:"mb-4"},za=["innerHTML"],Fa={key:1},Ha={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Ja=["onClick"],Wa=["src","alt"],qa={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Ra={class:"text-white text-xs text-center"},Ya={key:2,class:"text-center py-4 text-gray-500 text-sm"},Oa={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Za=["src","alt"],Qa={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Xa={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},et={__name:"Index",props:{CarDetail:Array,Category:Array,team:Array,inspection:Array,activeInspections:Boolean},setup(F){const I=F,o=he({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null,inspector_id:null}),B=ke(),v=B.props.global.user,h=B.props.global.region,f=B.props.global.has_roles,$=g(!1),w=g(new Date().toISOString().split("T")[0]),b=g(null),m=g([]),C=g(!1),S=g(0),D=g("search"),E=()=>{D.value=D.value==="search"?"wizard":"search",o.car_id=null,o.car_name="",b.value=null,m.value=[]},N=r=>{var l,K,p;r.car_id&&r.car_name?(o.car_id=r.car_id,o.car_name=r.car_name,b.value=I.CarDetail.find(W=>W.id===r.car_id)||null):r.id&&(o.car_id=r.id,o.car_name=`${(l=r.brand)==null?void 0:l.name} ${(K=r.model)==null?void 0:K.name} ${(p=r.type)==null?void 0:p.name} ${y(r.cc)} ${z(r.transmission)} ${r.fuel_type} ${r.year} (${r.production_period})`,b.value=r)},d=R(()=>I.activeInspections),i=R(()=>!(!o.plate_number.trim()||!o.category_id||!o.car_id&&!o.car_name.trim()||o.is_scheduled&&(!o.scheduled_at_date||!o.scheduled_at_time)||(f.includes("Admin")||f.includes("coordinator"))&&!o.inspector_id)),c=R(()=>o.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),x=R(()=>{const r=I.team.filter(p=>p.status==="active"),l=f.includes("Admin"),K=f.includes("coordinator");return l?r:K?r.filter(p=>p.region_id===h.id):[]}),y=r=>(r/1e3).toFixed(1)+"L",z=r=>({AT:"Automatic",MT:"Manual",CVT:"CVT",AMT:"AMT"})[r]||r,L=r=>{$.value=!r},J=r=>{console.log("Car data received from plate validation:",r),r?(o.car_id=r.id,o.car_name=r.name,r.id&&(b.value=I.CarDetail.find(l=>l.id===r.id)||null,b.value&&j(b.value.id)),r.inspectionData&&console.log("Inspection data available:",r.inspectionData)):(o.car_id=null,o.car_name="",b.value=null,m.value=[])},j=async r=>{try{const l=await fetch(`/api/cars/${r}/images`);if(l.ok){const K=await l.json();m.value=Array.isArray(K)?K:[]}else m.value=[]}catch(l){console.error("Error loading car images:",l),m.value=[]}},Q=r=>{m.value=r},X=r=>r!=null&&r.file_path?`/storage/${r.file_path}`:"",le=r=>{S.value=r,C.value=!0,document.body.style.overflow="hidden"},Z=()=>{C.value=!1,document.body.style.overflow=""},ee=()=>{S.value=(S.value+1)%m.value.length},ae=()=>{S.value=(S.value-1+m.value.length)%m.value.length},te=r=>{if(C.value)switch(r.key){case"Escape":Z();break;case"ArrowRight":ee();break;case"ArrowLeft":ae();break}};ce(()=>{const r=f.includes("Admin")||f.includes("coordinator");o.inspector_id=(v==null?void 0:v.id)||null}),ce(()=>{d.value&&(o.is_scheduled=!0)}),Y(()=>o.car_id,r=>{r?b.value=I.CarDetail.find(l=>l.id===r)||null:(b.value=null,m.value=[])}),pe(()=>{window.addEventListener("keydown",te)}),xe(()=>{window.removeEventListener("keydown",te)});const se=()=>{o.plate_number,o.car_id,o.car_name,o.category_id,o.is_scheduled,o.inspector_id,o.is_scheduled&&`${o.scheduled_at_date}${o.scheduled_at_time}`,o.post(route("inspections.store"),{preserveScroll:!0,onSuccess:()=>{},onError:()=>{}})};return(r,l)=>(s(),ne($e,{title:"Buat Inspeksi Baru"},{default:_e(()=>{var K;return[me(_(we),{title:"Inspek Baru"}),e("div",$a,[e("div",Ta,[l[22]||(l[22]=e("div",{class:"mb-4"},[e("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),e("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),_(o).errors.form_error?(s(),n("div",Ba,k(_(o).errors.form_error),1)):T("",!0),me(Ve,{"plate-number":_(o).plate_number,"onUpdate:plateNumber":l[0]||(l[0]=p=>_(o).plate_number=p),inspections:I.inspection,"car-detail":I.CarDetail,onPlateValidityUpdate:L,onCarDataUpdate:J},null,8,["plate-number","inspections","car-detail"]),e("div",Ma,[e("button",{onClick:E,class:"text-sm text-indigo-600 hover:text-indigo-800 underline"},k(D.value==="search"?"Ganti ke Pilihan Dropdown":"Ganti ke Pencarian Teks"),1)]),D.value==="search"?(s(),ne(Oe,{key:1,"car-id":_(o).car_id,"onUpdate:carId":l[1]||(l[1]=p=>_(o).car_id=p),"car-name":_(o).car_name,"onUpdate:carName":l[2]||(l[2]=p=>_(o).car_name=p),"car-detail":I.CarDetail,onCarSelected:N,onCarImagesLoaded:Q},null,8,["car-id","car-name","car-detail"])):(s(),ne(Ca,{key:2,"car-detail":I.CarDetail,onCarSelected:N,onCarImagesLoaded:Q},null,8,["car-detail"])),e("div",Sa,[l[10]||(l[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"category"}," Kategori Inspeksi ",-1)),A(e("select",{id:"category","onUpdate:modelValue":l[3]||(l[3]=p=>_(o).category_id=p),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[l[9]||(l[9]=e("option",{value:"",disabled:""},"Pilih Kategori",-1)),(s(!0),n(P,null,U(F.Category,p=>(s(),n("option",{key:p.id,value:p.id},k(p.name),9,Aa))),128))],512),[[G,_(o).category_id]])]),e("div",Ia,[l[12]||(l[12]=e("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),e("label",Da,[A(e("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=p=>_(o).is_scheduled=p),id:"schedule-toggle",class:"sr-only peer",disabled:d.value},null,8,Pa),[[Ce,_(o).is_scheduled]]),l[11]||(l[11]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),_(o).is_scheduled?(s(),n("div",ja,[e("div",null,[l[13]||(l[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),A(e("input",{type:"date",id:"schedule-date","onUpdate:modelValue":l[5]||(l[5]=p=>_(o).scheduled_at_date=p),min:w.value,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,8,Va),[[O,_(o).scheduled_at_date]])]),e("div",null,[l[14]||(l[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),A(e("input",{type:"time",id:"schedule-time","onUpdate:modelValue":l[6]||(l[6]=p=>_(o).scheduled_at_time=p),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[O,_(o).scheduled_at_time]])]),_(f).includes("Admin")||_(f).includes("coordinator")?(s(),n("div",Ua,[l[16]||(l[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"inspector"}," Pilih Inspektor ",-1)),A(e("select",{id:"inspector","onUpdate:modelValue":l[7]||(l[7]=p=>_(o).inspector_id=p),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[l[15]||(l[15]=e("option",{value:"",disabled:""},"Pilih Inspektor",-1)),(s(!0),n(P,null,U(x.value,p=>(s(),n("option",{key:p.id,value:p.user.id},k(p.user.name),9,Ka))),128))],512),[[G,_(o).inspector_id]])])):T("",!0)])):T("",!0),e("div",Na,[e("button",{onClick:se,disabled:!i.value||_(o).processing||$.value,class:ue({"px-6 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600 border border-transparent text-white hover:bg-blue-700":!_(o).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600 border-transparent text-white hover:bg-green-700":_(o).is_scheduled})},k(c.value),11,La)]),_(o).car_id&&b.value?(s(),n("div",Ea,[b.value.description?(s(),n("div",Ga,[l[17]||(l[17]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:b.value.description},null,8,za)])):T("",!0),m.value.length>0?(s(),n("div",Fa,[l[18]||(l[18]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",Ha,[(s(!0),n(P,null,U(m.value,(p,W)=>(s(),n("div",{key:p.id||W,class:"relative group cursor-pointer",onClick:de=>le(W)},[e("img",{src:X(p),alt:p.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Wa),p.note?(s(),n("div",qa,[e("p",Ra,k(p.note),1)])):T("",!0)],8,Ja))),128))])])):(s(),n("div",Ya," Tidak ada gambar tersedia untuk mobil ini "))])):T("",!0),C.value?(s(),n("div",{key:5,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:Z},[e("div",Oa,[e("button",{onClick:Z,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},l[19]||(l[19]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),m.value.length>1?(s(),n("button",{key:0,onClick:ie(ae,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},l[20]||(l[20]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):T("",!0),m.value.length>1?(s(),n("button",{key:1,onClick:ie(ee,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},l[21]||(l[21]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):T("",!0),e("img",{src:X(m.value[S.value]),alt:"Car Image "+(S.value+1),class:"max-w-full max-h-full object-contain",onClick:l[8]||(l[8]=ie(()=>{},["stop"]))},null,8,Za),m.value.length>1?(s(),n("div",Qa,k(S.value+1)+" / "+k(m.value.length),1)):T("",!0),(K=m.value[S.value])!=null&&K.note?(s(),n("div",Xa,k(m.value[S.value].note),1)):T("",!0)])])):T("",!0)])])]}),_:1}))}},st=Be(et,[["__scopeId","data-v-8c826072"]]);export{st as default};
