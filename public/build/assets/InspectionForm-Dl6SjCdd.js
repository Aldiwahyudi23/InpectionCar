import{x as Te,d as _,m as ke,z as _e,A as re,e as l,o,a as e,f,b as de,p as ce,v as we,u as G,F as oe,h as ne,t as P,g as ue,k as be,w as me,l as Z,n as le,C as ye,D as Ue,c as se,r as je,T as Ce,E as Ie,W as Ve,G as De}from"./app-D9mR6lxF.js";import{l as xe}from"./lodash-DDf8vTZD.js";import{_ as qe}from"./PrimaryButton-Ba2fOi3u.js";import{_ as Pe}from"./ActionMessage-C_c2Wkvt.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Be}from"./InputNumber-C3S89GMW.js";const Le={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ae={key:0,class:"p-4 space-y-4"},Fe={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},Ee={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},ze={class:"relative"},He={key:0,class:"absolute right-3 top-3"},Oe={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},We={key:0},Ke=["onMousedown"],Xe={class:"font-medium text-gray-900"},Ge={class:"text-sm text-gray-500"},Je={key:1,class:"p-4 text-sm text-gray-500 text-center"},Ye={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ze={key:0,class:"mb-4"},Qe=["innerHTML"],et={key:1},tt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},st=["onClick"],at=["src","alt"],ot={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},nt={class:"text-white text-xs text-center"},lt={key:2,class:"text-center py-4 text-gray-500 text-sm"},it={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},rt=["src","alt"],ut={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},dt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},ct={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},mt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(t,{emit:S}){var z,C,N,W;const a=t,k=S,i=Te({plate_number:((z=a.inspection)==null?void 0:z.plate_number)||"",car_id:((C=a.inspection)==null?void 0:C.car_id)||null,car_name:((W=(N=a.inspection)==null?void 0:N.car)==null?void 0:W.name)||""}),r=_(i.car_name),v=_(!1),u=_(!1),d=_([]),w=_(null),m=_([]),s=_(!1),p=_(0);ke(()=>{var $,y,H,n;if(($=a.inspection)!=null&&$.car_id&&((y=a.CarDetail)==null?void 0:y.length)>0){const I=a.CarDetail.find(h=>h.id===a.inspection.car_id);I&&K(I)}else!((H=a.inspection)!=null&&H.car_id)&&((n=a.inspection)!=null&&n.car_name)&&(r.value=a.inspection.car_name);window.addEventListener("keydown",D)}),_e(()=>{window.removeEventListener("keydown",D)}),re(r,$=>{i.car_id&&V(w.value)!==$&&(i.car_id=null,w.value=null,m.value=[]),i.car_name=$});const V=$=>{var H,n,I;if(!$)return"";const y=[];return(H=$.brand)!=null&&H.name&&y.push($.brand.name),(n=$.model)!=null&&n.name&&y.push($.model.name),(I=$.type)!=null&&I.name&&y.push($.type.name),$.cc&&y.push(`${$.cc}cc`),$.transmission&&y.push($.transmission),$.fuel_type&&y.push($.fuel_type),$.year&&y.push($.year.toString()),$.production_period&&y.push(`(${$.production_period})`),y.join(" ")},B=xe.debounce(()=>{if(!r.value.trim()){d.value=[],v.value=!1;return}u.value=!0;try{const $=r.value.toLowerCase().trim();d.value=a.CarDetail.filter(y=>V(y).toLowerCase().includes($)),v.value=!0}finally{u.value=!1}},300),M=()=>{setTimeout(()=>{v.value=!1},200)},K=async $=>{w.value=$,r.value=V($),i.car_id=$.id,i.car_name=V($),v.value=!1,await R($.id),J()},E=$=>!$||!$.file_path?"":`/storage/${$.file_path}`,R=async $=>{try{const y=await fetch(`/api/cars/${$}/images`);if(y.ok){const H=await y.json();m.value=Array.isArray(H)?H:[]}else m.value=[]}catch(y){console.error("Error loading car images:",y),m.value=[]}},F=$=>{p.value=$,s.value=!0,document.body.style.overflow="hidden"},L=()=>{s.value=!1,document.body.style.overflow=""},x=()=>{p.value=(p.value+1)%m.value.length},j=()=>{p.value=(p.value-1+m.value.length)%m.value.length},D=$=>{if(s.value)switch($.key){case"Escape":L();break;case"ArrowRight":x();break;case"ArrowLeft":j();break}},J=()=>{const $={plate_number:i.plate_number,car_id:i.car_id,car_name:i.car_name};k("update-vehicle",$)},te=()=>{a.inspection&&i.post(route("inspections.updateVehicleDetails",{inspection:a.inspection.id}),{preserveScroll:!0})};return re(()=>a.inspection,$=>{var y;if($)if(i.plate_number=$.plate_number||"",i.car_id=$.car_id||null,$.car_id&&((y=a.CarDetail)==null?void 0:y.length)>0){const H=a.CarDetail.find(n=>n.id===$.car_id);H&&K(H)}else $.car_name&&(r.value=$.car_name,i.car_name=$.car_name)},{deep:!0}),($,y)=>{var H;return o(),l("div",Le,[y[17]||(y[17]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(o(),l("div",Ae,[e("div",Fe,[y[6]||(y[6]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nomor Plat Kendaraan ",-1)),ce(e("input",{"onUpdate:modelValue":y[0]||(y[0]=n=>G(i).plate_number=n),type:"text",placeholder:"Contoh: B 1234 ABC",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:J},null,544),[[we,G(i).plate_number]])]),e("div",Ee,[y[9]||(y[9]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",ze,[ce(e("input",{"onUpdate:modelValue":y[1]||(y[1]=n=>r.value=n),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:y[2]||(y[2]=(...n)=>G(B)&&G(B)(...n)),onFocus:y[3]||(y[3]=n=>v.value=!0),onBlur:M},null,544),[[we,r.value]]),u.value?(o(),l("div",He,y[7]||(y[7]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):f("",!0),v.value?(o(),l("div",Oe,[d.value.length>0?(o(),l("div",We,[(o(!0),l(oe,null,ne(d.value,n=>(o(),l("div",{key:n.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:I=>K(n)},[e("div",Xe,P(V(n)),1),e("div",Ge,P(n.year)+" • "+P(n.cc)+"cc • "+P(n.transmission)+" • "+P(n.fuel_type),1)],40,Ke))),128))])):(o(),l("div",Je,y[8]||(y[8]=[ue(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),ue(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):f("",!0)]),ce(e("input",{type:"hidden","onUpdate:modelValue":y[4]||(y[4]=n=>G(i).car_id=n)},null,512),[[we,G(i).car_id]])]),G(i).car_id&&w.value?(o(),l("div",Ye,[w.value.description?(o(),l("div",Ze,[y[10]||(y[10]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:w.value.description},null,8,Qe)])):f("",!0),m.value.length>0?(o(),l("div",et,[y[11]||(y[11]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",tt,[(o(!0),l(oe,null,ne(m.value,(n,I)=>(o(),l("div",{key:n.id||I,class:"relative group cursor-pointer",onClick:h=>F(I)},[e("img",{src:E(n),alt:n.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,at),n.note?(o(),l("div",ot,[e("p",nt,P(n.note),1)])):f("",!0)],8,st))),128))])])):(o(),l("div",lt," Tidak ada gambar tersedia untuk mobil ini "))])):f("",!0),s.value?(o(),l("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:L},[e("div",it,[e("button",{onClick:L,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},y[12]||(y[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),m.value.length>1?(o(),l("button",{key:0,onClick:be(j,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},y[13]||(y[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):f("",!0),m.value.length>1?(o(),l("button",{key:1,onClick:be(x,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},y[14]||(y[14]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):f("",!0),e("img",{src:E(m.value[p.value]),alt:"Car Image "+(p.value+1),class:"max-w-full max-h-full object-contain",onClick:y[5]||(y[5]=be(()=>{},["stop"]))},null,8,rt),m.value.length>1?(o(),l("div",ut,P(p.value+1)+" / "+P(m.value.length),1)):f("",!0),(H=m.value[p.value])!=null&&H.note?(o(),l("div",dt,P(m.value[p.value].note),1)):f("",!0)])])):f("",!0),de(qe,{type:"button",onClick:te,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},{default:me(()=>[G(i).processing?(o(),l("svg",ct,y[15]||(y[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):f("",!0),e("span",null,P(G(i).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),de(Pe,{on:G(i).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:me(()=>y[16]||(y[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ue(" Tersimpan. ")])),_:1,__:[16]},8,["on"])]),_:1})])):f("",!0)])}}},gt=ge(mt,[["__scopeId","data-v-04b281af"]]),vt={class:"mt-1"},pt=["value","required","minlength","maxlength","allowSpace","placeholder"],ht={key:0,class:"mt-2 text-sm text-red-600"},ft={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:S}){const a=t,k=S,i=Z(()=>{if(!a.modelValue)return"";let v=a.modelValue;switch(a.allowSpace||(v=v.replace(/\s+/g,"")),a.textTransform){case"uppercase":return v.toUpperCase();case"lowercase":return v.toLowerCase();case"capitalize":return v.replace(/\b\w/g,u=>u.toUpperCase());default:return v}}),r=v=>{let u=v.target.value;switch(a.allowSpace||(u=u.replace(/\s+/g,"")),a.textTransform){case"uppercase":u=u.toUpperCase();break;case"lowercase":u=u.toLowerCase();break;case"capitalize":u=u.replace(/\b\w/g,d=>d.toUpperCase());break}k("update:modelValue",u),k("save",a.pointId)};return(v,u)=>(o(),l("div",vt,[e("input",{value:i.value,onInput:r,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:le(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,pt),t.error?(o(),l("p",ht,P(t.error),1)):f("",!0)]))}},wt={class:"mt-1"},yt=["value","required","min","max"],bt={key:0,class:"mt-2 text-sm text-red-600"},xt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:S}){const a=t,k=S,i=r=>{k("update:modelValue",r.target.value),k("save",a.pointId)};return(r,v)=>(o(),l("div",wt,[e("input",{value:t.modelValue,onChange:i,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,yt),t.error?(o(),l("p",bt,P(t.error),1)):f("",!0)]))}},kt={class:"mt-1"},$t=["value","required","placeholder"],It={key:0,class:"mt-2 text-sm text-red-600"},Ct={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:S}){const a=t,k=S,i=_(""),r=Z(()=>{var m,s,p,V;return{currency_symbol:((m=a.settings)==null?void 0:m.currency_symbol)||"Rp",thousands_separator:((s=a.settings)==null?void 0:s.thousands_separator)||",",min_value:((p=a.settings)==null?void 0:p.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((V=a.settings)==null?void 0:V.max_value)!==void 0?Number(a.settings.max_value):1e9}}),v=m=>{if(m==null||m==="")return"";const s=Number(m);if(isNaN(s))return"";let p=s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return r.value.thousands_separator!==","&&(p=p.replace(/,/g,r.value.thousands_separator)),p},u=m=>m?m.replace(/[^\d]/g,""):"",d=Z(()=>i.value?`${r.value.currency_symbol} ${v(i.value)}`:""),w=m=>{let s=u(m.target.value),p=Number(s);r.value.min_value!==void 0&&p<r.value.min_value&&(s=r.value.min_value.toString()),r.value.max_value!==void 0&&p>r.value.max_value&&(s=r.value.max_value.toString()),i.value=s,k("update:modelValue",s),k("save",a.pointId)};return re(()=>a.modelValue,m=>{m!=null&&(i.value=m.toString())},{immediate:!0}),(m,s)=>(o(),l("div",kt,[e("input",{value:d.value,onInput:w,type:"text",required:t.required,placeholder:t.placeholder,class:le(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,$t),t.error?(o(),l("p",It,P(t.error),1)):f("",!0)]))}},Vt={class:"mt-1 space-y-3"},St={key:0,class:"space-y-2"},_t={class:"flex flex-wrap gap-2"},Mt=["onClick"],Ut=["value","required","minlength","maxlength","placeholder"],jt={class:"flex justify-between items-center mt-1"},Tt={class:"text-xs text-gray-500"},Nt={key:0,class:"text-xs text-red-600"},Ne={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:S}){const a=t,k=S,i=_([]),r=_(""),v=m=>i.value.some(s=>s.value===m),u=m=>{v(m.value)?i.value=i.value.filter(B=>B.value!==m.value):i.value.push(m);const p=[...i.value.map(B=>B.value)];r.value.trim()&&p.push(r.value.trim());const V=p.join(", ");k("update:modelValue",V),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:V})},d=m=>{const s=m.target.value;k("update:modelValue",s),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:s}),w(s)},w=m=>{var B,M,K,E;if(!m){i.value=[],r.value="";return}const s=m.split(",").map(R=>R.trim()).filter(R=>R),p=((M=(B=a.settings)==null?void 0:B.damage_options)==null?void 0:M.map(R=>R.value))||[];i.value=((E=(K=a.settings)==null?void 0:K.damage_options)==null?void 0:E.filter(R=>s.includes(R.value)))||[];const V=s.filter(R=>!p.includes(R));r.value=V.join(", ")};return re(()=>a.modelValue,m=>{m!=null&&w(m)},{immediate:!0}),(m,s)=>{var p,V,B;return o(),l("div",Vt,[(p=t.settings)!=null&&p.enable_damage&&((V=t.settings)!=null&&V.damage_options)?(o(),l("div",St,[s[0]||(s[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",_t,[(o(!0),l(oe,null,ne(t.settings.damage_options,(M,K)=>(o(),l("button",{key:K,type:"button",onClick:E=>u(M),class:le(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":v(M.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!v(M.value)}])},P(M.label),11,Mt))),128))])])):f("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:d,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Ut),e("div",jt,[e("span",Tt,P(((B=t.modelValue)==null?void 0:B.length)||0)+"/"+P(t.maxLength||400),1),t.error?(o(),l("p",Nt,P(t.error),1)):f("",!0)])])])}}},Rt={class:"mt-1"},Dt=["value","required"],qt={key:0,class:"mt-2 text-sm text-red-600"},Pt={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:S}){const a=t,k=S,i=r=>{k("update:modelValue",r.target.value),k("save",a.pointId)};return(r,v)=>(o(),l("div",Rt,[e("select",{value:t.modelValue,onChange:i,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},v[0]||(v[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Dt),t.error?(o(),l("p",qt,P(t.error),1)):f("",!0)]))}},Bt=ge(Pt,[["__scopeId","data-v-c34a74db"]]),Lt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},At={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Ft={class:"flex flex-row space-x-4 mb-6"},Et={class:"mt-4 text-right"},zt={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(S,a)=>t.show?(o(),l("div",Lt,[e("div",At,[a[5]||(a[5]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),e("div",Ft,[e("button",{onClick:a[0]||(a[0]=k=>S.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[3]||(a[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:a[1]||(a[1]=k=>S.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[4]||(a[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",Et,[e("button",{onClick:a[2]||(a[2]=k=>S.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):f("",!0)}},Ht={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Ot={class:"webcam-content-box"},Wt={class:"webcam-header"},Kt={class:"inspection-point-name"},Xt={key:0,class:"screen-flash-overlay"},Gt={class:"webcam-footer"},Jt={class:"camera-controls"},Yt=["disabled"],Zt={class:"camera-icon-container"},Qt={key:0,class:"camera-spinner"},es={key:1,class:"camera-body"},ts={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:S}){const a=t,k=S,i=_(null),r=_(null);let v=null,u=null;const d=_("environment"),w=_(!1),m=_(!1),s=_(!1),p=_(!1),V=_(!1),B=_({}),M=_(!1),K=Z(()=>{var C;return((C=a.settings)==null?void 0:C.max_size)||2048}),E=Z(()=>a.aspectRatio?{aspectRatio:`${a.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),R=Z(()=>{if(!a.aspectRatio)return{};const C=a.aspectRatio,N=C>1?80:60,W=C>1?80/C:60*C;return{width:`${N}%`,height:`${W}%`}}),F=async()=>{v&&v.getTracks().forEach(C=>C.stop());try{const C={facingMode:d.value,width:{ideal:1920,max:3840},height:{ideal:1080,max:2160},aspectRatio:{ideal:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"manual"}]};v=await navigator.mediaDevices.getUserMedia({video:C,audio:!1}),u=v.getVideoTracks()[0],i.value.srcObject=v,i.value.onloadedmetadata=async()=>{await x(),await i.value.play()}}catch(C){console.error("Error accessing camera: ",C),alert("Failed to access camera. Please allow camera permission."),k("close")}},L=()=>{v&&v.getTracks().forEach(C=>C.stop()),k("close")},x=async()=>{if(u)try{const C=await navigator.mediaDevices.enumerateDevices();w.value=C.filter(W=>W.kind==="videoinput").length>1;const N=u.getCapabilities();m.value=N.torch||N.fillLightMode&&N.fillLightMode.includes("torch")}catch(C){console.error("Error checking camera capabilities:",C)}},j=async C=>{if(!u)return;const N=i.value.getBoundingClientRect(),W=C.clientX-N.left,$=C.clientY-N.top;V.value=!0,B.value={left:`${W}px`,top:`${$}px`,transform:"translate(-50%, -50%)"};try{if(u.getCapabilities().pointsOfInterest){const H=W/N.width,n=$/N.height;await u.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:H,y:n}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(y){console.warn("Manual focus failed:",y)}setTimeout(()=>{V.value=!1},1e3)},D=async()=>{if(!(!u||!m.value))try{d.value==="user"?(s.value=!s.value,p.value=s.value):(await u.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value)}catch(C){console.error("Flash toggle failed:",C)}},J=async()=>{w.value&&(d.value=d.value==="environment"?"user":"environment",v&&v.getTracks().forEach(C=>C.stop()),await F())},te=async C=>new Promise(N=>{const W=K.value*1024;if(C.size<=W){N(C);return}const $=new Image,y=new FileReader;y.onload=H=>{$.onload=()=>{const n=document.createElement("canvas"),I=n.getContext("2d"),h=Math.sqrt(W/C.size);n.width=$.width*h,n.height=$.height*h,I.drawImage($,0,0,n.width,n.height);let A=.9;const T=()=>{n.toBlob(b=>{b.size>W&&A>.1?(A-=.1,T()):N(b)},"image/jpeg",A)};T()},$.src=H.target.result},y.readAsDataURL(C)}),z=async()=>{if(!(M.value||!i.value||!r.value)){M.value=!0;try{const C=i.value,N=r.value,W=C.videoWidth,$=C.videoHeight;let y,H,n,I;W/$>a.aspectRatio?(H=$,y=$*a.aspectRatio,n=(W-y)/2,I=0):(y=W,H=W/a.aspectRatio,n=0,I=($-H)/2),N.width=y,N.height=H,N.getContext("2d").drawImage(C,n,I,y,H,0,0,y,H);const A=await new Promise(b=>{N.toBlob(b,"image/jpeg",1)}),T=await te(A);if(T){const b=new File([T],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});k("photoCaptured",b),p.value=!0,setTimeout(()=>{p.value=!1},100)}}catch(C){console.error("Error capturing photo:",C),alert("Failed to capture photo. Please try again.")}finally{M.value=!1}}};return re(()=>a.show,C=>{C?F():L()}),_e(()=>{v&&v.getTracks().forEach(C=>C.stop())}),(C,N)=>{var W;return t.show?(o(),l("div",Ht,[e("div",Ot,[e("div",Wt,[e("div",Kt,P(((W=t.point)==null?void 0:W.name)||"Camera"),1),e("button",{onClick:L,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},N[0]||(N[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:ye(E.value),onClick:j,onTouchstart:j},[e("video",{ref_key:"webcamVideo",ref:i,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:r,class:"hidden"},null,512),p.value?(o(),l("div",Xt)):f("",!0),e("div",{class:"aspect-ratio-guide",style:ye(R.value)},null,4),V.value?(o(),l("div",{key:1,class:"focus-indicator",style:ye(B.value)},N[1]||(N[1]=[e("div",{class:"focus-ring"},null,-1)]),4)):f("",!0),N[2]||(N[2]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1))],36),e("div",Gt,[e("div",Jt,[t.settings.enable_flash&&m.value?(o(),l("button",{key:0,onClick:D,class:le(["control-button",{active:s.value,disabled:!m.value}])},N[3]||(N[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):f("",!0),e("button",{onClick:z,class:"capture-button",disabled:M.value},[e("div",Zt,[M.value?(o(),l("div",Qt)):(o(),l("div",es,N[4]||(N[4]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,Yt),t.settings.enable_camera_switch&&w.value?(o(),l("button",{key:1,onClick:J,class:"control-button"},N[5]||(N[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):f("",!0)])])])])):f("",!0)}}},ss=ge(ts,[["__scopeId","data-v-56dbe55a"]]),as={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},os={class:"w-full h-full flex flex-col"},ns={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},ls={class:"text-lg font-semibold"},is={class:"flex items-center gap-2"},rs={class:"flex-1 flex items-center justify-center overflow-hidden relative"},us=["src"],ds={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},cs={class:"flex justify-between items-center w-full"},ms=["disabled"],gs={key:1,class:"flex-1"},vs=["disabled"],ps={class:"flex gap-3 w-full"},hs=["disabled"],fs={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},ws={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos"],setup(t,{emit:S}){const a=t,k=S,i=_(0),r=_([]),v=_(0),u=_(0),d=Z(()=>r.value.length>0?r.value[i.value]:null);re(()=>a.images,L=>{r.value=L.map(x=>({...x})),L.length===0&&a.show&&E()},{deep:!0,immediate:!0}),re(()=>a.show,L=>{L&&a.images.length>0&&(i.value=a.initialIndex)});const w=L=>L.preview||(L.image_path?`/${L.image_path}`:""),m=()=>{d.value&&(d.value.rotation=(d.value.rotation+90)%360)},s=()=>{i.value=i.value<r.value.length-1?i.value+1:0},p=()=>{i.value=i.value>0?i.value-1:r.value.length-1},V=L=>{v.value=L.touches[0].clientX},B=L=>{u.value=L.touches[0].clientX},M=()=>{v.value-u.value>50?s():u.value-v.value>50&&p(),v.value=0,u.value=0},K=()=>{a.isUploading||k("saveImages",r.value)},E=()=>{a.isUploading||k("close")},R=()=>{if(d.value&&!a.isUploading){const L=d.value;k("removePreviewImage",L);const x=r.value.findIndex(j=>j.isNew&&L.isNew&&j.preview===L.preview||!j.isNew&&!L.isNew&&j.id===L.id);x!==-1&&r.value.splice(x,1),i.value>=r.value.length&&(i.value=Math.max(0,r.value.length-1)),r.value.length===0&&k("close")}},F=()=>{a.isUploading||k("triggerAddMorePhotos")};return(L,x)=>{var j;return t.show?(o(),l("div",as,[e("div",os,[e("div",ns,[e("button",{onClick:E,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},x[0]||(x[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",ls,P(((j=t.point)==null?void 0:j.name)||"Preview")+" ("+P(i.value+1)+"/"+P(r.value.length)+") ",1),e("div",is,[d.value&&d.value.isNew?(o(),l("button",{key:0,onClick:R,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},x[1]||(x[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):f("",!0),e("button",{onClick:m,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},x[2]||(x[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))])]),e("div",rs,[e("div",{class:"relative w-full max-w-full",style:ye({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"}),onTouchstart:V,onTouchmove:B,onTouchend:M},[d.value?(o(),l("img",{key:0,src:w(d.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ye({transform:`rotate(${d.value.rotation}deg)`})},null,12,us)):f("",!0)],36),r.value.length>1?(o(),l("button",{key:0,onClick:p,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},x[3]||(x[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):f("",!0),r.value.length>1?(o(),l("button",{key:1,onClick:s,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},x[4]||(x[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):f("",!0)]),e("div",ds,[e("div",cs,[d.value&&!d.value.isNew?(o(),l("button",{key:0,onClick:R,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},x[5]||(x[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,ms)):(o(),l("div",gs)),t.allowMultiple&&r.value.length<t.maxFiles?(o(),l("button",{key:2,onClick:F,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},x[6]||(x[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ue(" Tambah Foto ")]),8,vs)):f("",!0)]),e("div",ps,[e("button",{onClick:E,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:t.isUploading}," Batal ",8,hs),t.isUploading?(o(),l("button",fs,x[7]||(x[7]=[ue(" Menyimpan"),e("span",{class:"loading-dots ml-1"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1)]))):(o(),l("button",{key:0,onClick:K,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):f("",!0)}}},ys=ge(ws,[["__scopeId","data-v-3eb083d8"]]),bs=["accept","multiple","disabled"],xs=["disabled"],ks={class:"h-full flex flex-col items-center justify-center p-4 text-center"},$s={class:"text-xs text-gray-400 mt-1"},Is={key:0,class:"flex items-center gap-4"},Cs=["src"],Vs=["disabled"],Ss={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},_s=["disabled"],Ms=["onClick"],Us=["src"],js={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ts={key:0},Ns={key:1,class:"ml-1"},Rs={key:2,class:"mt-1 text-xs text-red-600"},Ds={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(t,{emit:S}){const a=t,k=S,i=_(null),r=_(null),v=_(!1),u=_(!1),d=_(!1),w=_([]),m=_(0),s=_(!1),p=Z(()=>Number(a.settings.max_files)>1),V=Z(()=>a.settings.allowed_types.map(n=>`.${n}`).join(", ")),B=Z(()=>{const n=a.settings.camera_aspect_ratio.split(":");if(n.length===2){const I=parseFloat(n[0]),h=parseFloat(n[1]);if(!isNaN(I)&&!isNaN(h)&&h!==0)return I/h}return 4/3}),M=Z(()=>{const n=[],I=new Set;for(const h of w.value)h.id&&I.add(h.id),n.push(h);for(const h of a.modelValue)I.has(h.id)||n.push({...h,rotation:h.rotation||0,isNew:!1,preview:h.preview||(h.image_path?`/${h.image_path}`:null)});return n}),K=n=>n.preview||(n.image_path?`/${n.image_path}`:""),E=()=>{d.value&&(d.value=!1),v.value=!0},R=()=>{v.value=!1,i.value.click()},F=()=>{v.value=!1,u.value=!0},L=()=>{v.value=!1,M.value.length>0&&(d.value=!0)},x=()=>{u.value=!1,M.value.length>0&&(d.value=!0)},j=()=>{d.value=!1,w.value.forEach(n=>{n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview)}),w.value=[]},D=n=>new Promise(I=>{const h=new FileReader;h.onload=A=>{const T=new Image;T.onload=()=>{I({file:n,preview:URL.createObjectURL(n),rotation:0,width:T.naturalWidth,height:T.naturalHeight,isNew:!0})},T.onerror=()=>{console.error("Failed to load image for dimensions:",n.name),I({file:n,preview:URL.createObjectURL(n),rotation:0,width:0,height:0,isNew:!0})},T.src=A.target.result},h.readAsDataURL(n)}),J=n=>{const I=n.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes(I)},te=async n=>{const h=(a.settings.max_size||2048)*1024;return new Promise(A=>{const T=new Image,b=new FileReader;b.onload=ae=>{T.onload=()=>{const q=document.createElement("canvas"),g=q.getContext("2d"),c=Math.max(T.width,T.height);q.width=c,q.height=c,g.fillStyle="white",g.fillRect(0,0,c,c);const U=(c-T.width)/2,O=(c-T.height)/2;g.drawImage(T,U,O,T.width,T.height);let Y=.9;const Q=()=>{q.toBlob(ee=>{if(ee.size>h&&Y>.1)Y-=.1,Q();else{const ie=new File([ee],n.name,{type:"image/jpeg",lastModified:Date.now()});A(ie)}},"image/jpeg",Y)};Q()},T.src=ae.target.result},b.readAsDataURL(n)})},z=async n=>{const I=Array.from(n.target.files);if(!I.length){v.value=!1,M.value.length>0&&(d.value=!0);return}try{const h=I.filter(g=>!J(g));if(h.length>0){const g=h.map(c=>c.name.split(".").pop()).join(", ");alert(`File type not allowed: ${g}. Allowed types: ${a.settings.allowed_types.join(", ")}`),n.target.value="";return}const A=M.value.length,T=a.settings.max_files-A,b=await Promise.all(I.slice(0,T).map(async g=>await te(g))),ae=await Promise.all(b.map(D)),q=p.value?ae:ae.slice(0,1);p.value?w.value.push(...q):(w.value.forEach(g=>{g.preview&&g.preview.startsWith("blob:")&&URL.revokeObjectURL(g.preview)}),w.value=q),v.value=!1,q.length>0?(m.value=Math.max(0,M.value.length-q.length),d.value=!0):M.value.length>0&&(d.value=!0),n.target.value=""}catch(h){console.error("Error processing selected images:",h),alert("Failed to process selected images. Please try again."),v.value=!1,M.value.length>0&&(d.value=!0)}},C=async n=>{const I=M.value.length;if(!p.value||I<a.settings.max_files)try{const h=await te(n),A=new Image;A.onload=()=>{const T={file:h,preview:URL.createObjectURL(h),rotation:0,width:A.naturalWidth,height:A.naturalHeight,isNew:!0};p.value?w.value.push(T):(w.value.forEach(b=>{b.preview&&b.preview.startsWith("blob:")&&URL.revokeObjectURL(b.preview)}),w.value=[T]),u.value=!1,v.value=!1,m.value=M.value.length-1,d.value=!0},A.src=URL.createObjectURL(h)}catch(h){console.error("Error processing captured image:",h),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),u.value=!1,v.value=!1,M.value.length>0&&(d.value=!0)},N=(n=0)=>{m.value=n,d.value=!0},W=n=>new Promise(I=>{if(n.rotation===0||!r.value){if(!n.isNew&&!n.file){I({file:null,width:n.width,height:n.height,isOriginal:!0});return}I({file:n.file,width:n.width,height:n.height});return}const h=new Image;h.onload=async()=>{try{const A=r.value,T=A.getContext("2d"),b=h.width,ae=h.height;let q,g;n.rotation===90||n.rotation===270?(q=ae,g=b):(q=b,g=ae),A.width=q,A.height=g,T.clearRect(0,0,A.width,A.height),T.translate(A.width/2,A.height/2),T.rotate(n.rotation*Math.PI/180),T.drawImage(h,-b/2,-ae/2,b,ae),T.setTransform(1,0,0,1,0,0);const c=await new Promise(Y=>{A.toBlob(Y,"image/jpeg",.9)}),U=new File([c],n.file?n.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),O=await te(U);I({file:O,width:q,height:g})}catch(A){console.error("Error processing rotated image:",A),I({file:n.file,width:n.width,height:n.height})}},h.onerror=()=>{console.error("Failed to load image for rotation processing:",n.preview),I({file:n.file,width:n.width,height:n.height})},h.src=n.preview}),$=async n=>{var A,T,b,ae;s.value=!0;const I=[],h=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),s.value=!1;return}try{for(const q of n){if(!q.isNew&&q.rotation===0&&q.id&&q.image_path){I.push({id:q.id,image_path:q.image_path,width:q.width,height:q.height,rotation:0,preview:q.preview});continue}const{file:g,width:c,height:U,isOriginal:O}=await W(q);if(O&&!q.isNew){I.push({id:q.id,image_path:q.image_path,width:q.width,height:q.height,rotation:0,preview:q.preview});continue}g&&h.push({file:g,width:c,height:U,rotation:0})}if(h.length>0){const q=new FormData;q.append("inspection_id",a.inspectionId),q.append("point_id",a.pointId),h.forEach(U=>{q.append("images[]",U.file)});const c=(await Ue.post(route("inspections.upload-image"),q,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const U of c)I.push({id:U.image_id,image_path:U.path,width:U.width||0,height:U.height||0,rotation:U.rotation||0,preview:U.public_url});h.forEach(U=>{U.file&&U.file.preview&&U.file.preview.startsWith("blob:")&&URL.revokeObjectURL(U.file.preview)})}k("update:modelValue",I),k("save",a.pointId),k("uploaded",{pointId:a.pointId,images:I}),j()}catch(q){if(console.error("Error during image processing/upload:",q),(T=(A=q.response)==null?void 0:A.data)!=null&&T.message)alert(`Failed to save images: ${q.response.data.message}`);else if((ae=(b=q.response)==null?void 0:b.data)!=null&&ae.errors){const g=Object.values(q.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${g}`)}else alert(`Failed to save images: ${q.message}`)}finally{s.value=!1}},y=n=>{if(n){if(n.id&&!n.isNew)H(n);else{const I=w.value.findIndex(h=>h.preview&&h.preview===n.preview&&h.isNew||h.id&&h.id===n.id);if(I!==-1){const h=w.value.splice(I,1)[0];h.preview&&h.preview.startsWith("blob:")&&URL.revokeObjectURL(h.preview)}k("update:modelValue",a.modelValue.filter(h=>!(h.id&&h.id===n.id)&&!(h.preview&&h.preview===n.preview)))}m.value>=M.value.length&&(m.value=Math.max(0,M.value.length-1)),M.value.length===0&&j()}},H=async n=>{var h,A;if(n.id||n.image_path)try{await Ue.delete(route("inspections.delete-image"),{data:{image_id:n.id,image_path:n.image_path}})}catch(T){console.error("Error deleting image from server:",T),(A=(h=T.response)==null?void 0:h.data)!=null&&A.message?alert(`Failed to delete image from server: ${T.response.data.message}`):alert(`Failed to delete image from server: ${T.message}`);return}n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview);const I=a.modelValue.filter(T=>T.id!==n.id);k("update:modelValue",I),w.value=w.value.filter(T=>T.isNew&&n.isNew?T.preview!==n.preview:T.id!==n.id),k("removeImage",{image:n}),d.value&&M.value.length===0?j():d.value&&m.value>=M.value.length&&(m.value=Math.max(0,M.value.length-1))};return(n,I)=>(o(),l("div",null,[e("input",{ref_key:"galleryInput",ref:i,type:"file",accept:V.value,class:"hidden",onChange:z,multiple:p.value,disabled:s.value},null,40,bs),e("canvas",{ref_key:"processingCanvas",ref:r,class:"hidden"},null,512),M.value.length===0?(o(),l("label",{key:0,onClick:E,class:le(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:s.value},[e("div",ks,[I[2]||(I[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),I[3]||(I[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),I[4]||(I[4]=e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),e("p",$s,"Allowed types: "+P(V.value),1)])],8,xs)):(o(),l("div",{key:1,class:le(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[t.settings.max_files===1?(o(),l("div",Is,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:I[0]||(I[0]=h=>N(0))},[e("img",{src:K(M.value[0]),class:"w-full h-full object-cover"},null,8,Cs)]),e("button",{onClick:I[1]||(I[1]=be(h=>H(M.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:s.value},I[5]||(I[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,Vs)])):(o(),l("div",Ss,[p.value&&M.value.length<t.settings.max_files?(o(),l("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:E,disabled:s.value},I[6]||(I[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,_s)):f("",!0),(o(!0),l(oe,null,ne(M.value,(h,A)=>(o(),l("div",{key:h.id||h.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:T=>N(A)},[e("img",{src:K(h),class:"w-full h-full object-cover"},null,8,Us),h.isNew||h.rotation!==0?(o(),l("div",js,[h.isNew?(o(),l("span",Ts,"BARU")):f("",!0),h.rotation!==0?(o(),l("span",Ns,"ROTASI")):f("",!0)])):f("",!0)],8,Ms))),128))]))],2)),t.error?(o(),l("p",Rs,P(t.error),1)):f("",!0),de(zt,{show:v.value,onClose:L,onOpenWebcam:F,onTriggerGallery:R},null,8,["show"]),de(ss,{show:u.value,"aspect-ratio":B.value,settings:t.settings,point:t.point,onClose:x,onPhotoCaptured:C},null,8,["show","aspect-ratio","settings","point"]),de(ys,{show:d.value,images:M.value,point:t.point,"initial-index":m.value,"allow-multiple":p.value,"max-files":t.settings.max_files,"is-uploading":s.value,"aspect-ratio":B.value,onClose:j,onSaveImages:$,onRemovePreviewImage:y,onTriggerAddMorePhotos:E},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},Se=ge(Ds,[["__scopeId","data-v-cdcbdbbe"]]),qs={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Ps={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Bs={class:"px-4 pb-2 border-b border-gray-200"},Ls={class:"text-lg font-semibold text-gray-900"},As={key:0,class:"text-sm text-gray-500 mt-1"},Fs={class:"flex-1 overflow-y-auto p-4"},Es={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},zs={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:S}){const a=S,k=()=>{a("close")},i=r=>{r.key==="Escape"&&k()};return ke(()=>{document.addEventListener("keydown",i)}),_e(()=>{document.removeEventListener("keydown",i)}),(r,v)=>(o(),se(Ce,{name:"bottom-sheet"},{default:me(()=>[t.show?(o(),l("div",qs,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:k}),e("div",Ps,[v[0]||(v[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Bs,[e("h3",Ls,P(t.title),1),t.subtitle?(o(),l("p",As,P(t.subtitle),1)):f("",!0)]),e("div",Fs,[je(r.$slots,"default",{},void 0,!0)]),r.$slots.footer?(o(),l("div",Es,[je(r.$slots,"footer",{},void 0,!0)])):f("",!0)])])):f("",!0)]),_:3}))}},Re=ge(zs,[["__scopeId","data-v-7893c2dc"]]),Hs={class:"space-y-4"},Os={key:0,class:"mt-2"},Ws={class:"text-sm font-medium text-gray-700 mb-2"},Ks={key:0,class:"text-red-500"},Xs={key:0,class:"text-xs text-red-500"},Gs={key:1,class:"grid grid-cols-2 gap-2"},Js=["name","value","checked"],Ys={key:2,class:"space-y-2"},Zs={key:0,class:"text-red-500"},Qs={key:1,class:"text-xs text-red-500"},ea={key:3,class:"mt-4"},ta={class:"text-sm font-medium text-gray-700 mb-2"},sa={key:0,class:"text-red-500"},aa={key:0,class:"text-xs text-red-500"},oa={class:"flex gap-2"},na=["disabled"],Me={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(t,{emit:S}){const a=t,k=S,i=u=>k("hapus",u),r=Z(()=>a.options.find(u=>u.value===a.selectedValue)),v=Z(()=>{var d,w,m;if(a.point.input_type==="imageTOradio"&&a.imagesValue.length===0||a.options.length&&!a.selectedValue)return!1;const u=r.value;return!(a.showTextarea&&((d=u==null?void 0:u.settings)!=null&&d.show_textarea)&&(!((w=a.notesValue)!=null&&w.trim())||u.settings.min_length&&a.notesValue.length<u.settings.min_length||u.settings.max_length&&a.notesValue.length>u.settings.max_length)||a.showImageUpload&&((m=u==null?void 0:u.settings)!=null&&m.show_image_upload)&&(a.imagesValue.length===0||u.settings.max_files&&a.imagesValue.length>u.settings.max_files))});return(u,d)=>(o(),se(Re,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:d[10]||(d[10]=w=>u.$emit("close"))},{footer:me(()=>[t.selectedPoint?(o(),l("button",{key:0,onClick:d[7]||(d[7]=w=>i(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},d[12]||(d[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ue(" Hapus Data ")]))):f("",!0),e("div",oa,[e("button",{type:"button",onClick:d[8]||(d[8]=w=>u.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:d[9]||(d[9]=w=>u.$emit("save")),disabled:!v.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,na)])]),default:me(()=>{var w,m,s,p,V,B,M,K,E,R,F,L,x,j;return[e("div",Hs,[t.point.input_type==="imageTOradio"?(o(),l("div",Os,[e("h4",Ws,[(w=t.point.settings)!=null&&w.required?(o(),l("span",Ks,"*")):f("",!0)]),de(Se,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":d[0]||(d[0]=D=>u.$emit("update:imagesValue",D)),onSave:d[1]||(d[1]=D=>u.$emit("saveImage",D))},null,8,["model-value","point-id","point","inspection-id","settings"]),(m=t.point.settings)!=null&&m.required&&t.imagesValue.length===0?(o(),l("p",Xs," Foto wajib diupload ")):f("",!0)])):f("",!0),t.options.length?(o(),l("div",Gs,[(o(!0),l(oe,null,ne(t.options,(D,J)=>(o(),l("label",{key:J,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:D.value,checked:t.selectedValue===D.value,onChange:d[2]||(d[2]=te=>u.$emit("update:selectedValue",te.target.value)),class:"hidden peer"},null,40,Js),e("div",{class:le(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===D.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==D.value}])},P(D.label),3)]))),128))])):f("",!0),t.showTextarea&&((p=(s=r.value)==null?void 0:s.settings)!=null&&p.show_textarea)?(o(),l("div",Ys,[(V=r.value.settings)!=null&&V.required?(o(),l("span",Zs,"*")):f("",!0),de(Ne,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:r.value.settings,required:(B=r.value.settings)==null?void 0:B.required,"min-length":(M=r.value.settings)==null?void 0:M.min_length,"max-length":(K=r.value.settings)==null?void 0:K.max_length,placeholder:((E=r.value.settings)==null?void 0:E.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":d[3]||(d[3]=D=>u.$emit("update:notesValue",D)),onSave:d[4]||(d[4]=D=>u.$emit("saveTextarea",D))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(R=r.value.settings)!=null&&R.required&&!t.notesValue?(o(),l("p",Qs," Keterangan wajib diisi ")):f("",!0)])):f("",!0),t.showImageUpload&&((L=(F=r.value)==null?void 0:F.settings)!=null&&L.show_image_upload)?(o(),l("div",ea,[e("h4",ta,[d[11]||(d[11]=ue(" Upload Foto ")),(x=r.value.settings)!=null&&x.required?(o(),l("span",sa,"*")):f("",!0)]),de(Se,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:r.value.settings,"onUpdate:modelValue":d[5]||(d[5]=D=>u.$emit("update:imagesValue",D)),onSave:d[6]||(d[6]=D=>u.$emit("saveImage",D))},null,8,["model-value","point-id","point","inspection-id","settings"]),(j=r.value.settings)!=null&&j.required&&t.imagesValue.length===0?(o(),l("p",aa," Foto wajib diupload ")):f("",!0)])):f("",!0)])]}),_:1},8,["show","title","subtitle"]))}},la={class:"mt-2 space-y-4"},ia={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ra=["name","value","checked","onChange","required"],ua={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},da={key:0,class:"mt-3"},ca={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},ma=["src"],ga={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},va={key:1,class:"mt-2"},pa={class:"text-sm text-gray-600"},ha={key:2,class:"mt-2 text-sm text-red-600"},fa={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:S}){const a=t,k=S,i=_(a.notes),r=_([...a.images]),v=_(!1),u=_(""),d=_([]),w=_(""),m=_([]),s=Z(()=>a.options.find(x=>x.value===a.modelValue)),p=x=>x.settings&&(x.settings.show_textarea||x.settings.show_image_upload);re(()=>a.notes,x=>{i.value=x}),re(()=>a.images,x=>{r.value=[...x]}),re(()=>a.modelValue,x=>{x&&(w.value=x)});const V=x=>{k("update:modelValue",x.value),p(x)?M():k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:x.value,notes:"",images:[]})},B=x=>x.preview||(x.image_path?`/${x.image_path}`:x),M=()=>{w.value=a.modelValue,u.value=i.value,d.value=[...r.value],m.value=[...r.value],v.value=!0},K=()=>{u.value="",d.value=[],w.value="",v.value=!1},E=x=>{d.value=x,r.value=[...x],k("update:images",[...x]),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:i.value,images:[...x]})},R=x=>{},F=()=>{w.value!==a.modelValue&&k("update:modelValue",w.value),i.value=u.value,k("update:notes",u.value),r.value=[...d.value],k("update:images",[...d.value]),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:w.value,notes:u.value,images:d.value}),v.value=!1},L=x=>{k("hapus",x),v.value=!1};return(x,j)=>{var D,J,te,z;return o(),l("div",la,[e("div",ia,[(o(!0),l(oe,null,ne(t.options,(C,N)=>(o(),l("label",{key:N,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:C.value,checked:t.modelValue===C.value,onChange:W=>V(C),class:"hidden peer",required:t.required},null,40,ra),e("div",{class:le(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===C.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==C.value}])},P(C.label),3)]))),128))]),t.modelValue&&s.value&&p(s.value)?(o(),l("div",ua,[e("div",{class:"flex justify-between items-start"},[j[4]||(j[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:M,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((D=s.value.settings)!=null&&D.show_image_upload)?(o(),l("div",da,[e("div",ca,[(o(!0),l(oe,null,ne(t.images,(C,N)=>(o(),l("div",{key:N,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:B(C),class:"w-full h-full object-cover rounded"},null,8,ma),N===3&&t.images.length>4?(o(),l("span",ga," +"+P(t.images.length-4),1)):f("",!0)]))),128))])])):f("",!0),t.notes&&((J=s.value.settings)!=null&&J.show_textarea)?(o(),l("div",va,[e("p",pa,P(t.notes),1)])):f("",!0)])):f("",!0),v.value?(o(),se(Me,{key:(te=t.selectedPoint)==null?void 0:te.id,show:v.value,title:t.pointName||"Detail",subtitle:(z=s.value)==null?void 0:z.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":w.value,"notes-value":u.value,"images-value":d.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":j[0]||(j[0]=C=>w.value=C),"onUpdate:notesValue":j[1]||(j[1]=C=>u.value=C),"onUpdate:imagesValue":j[2]||(j[2]=C=>E(C)),onClose:K,onSave:F,onSaveTextarea:x.handleTextareaSave,onSaveImage:R,onHapus:j[3]||(j[3]=C=>L(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):f("",!0),t.error?(o(),l("p",ha,P(t.error),1)):f("",!0)])}}},wa={class:"mt-2 space-y-4"},ya={key:0,class:"flex flex-wrap gap-3"},ba={key:1,class:"p-4 border rounded-lg bg-gray-50"},xa={key:0,class:"mt-3"},ka={class:"flex gap-2 overflow-x-auto scrollbar-hide"},$a=["src"],Ia={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Ca={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},Va=["name","value","checked"],Sa={key:1,class:"mt-2"},_a={class:"text-sm text-gray-600"},Ma={key:3,class:"mt-2 text-sm text-red-600"},Ua={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:S}){const a=t,k=S,i=_(a.notes),r=_([...a.images]),v=_(!1),u=_(""),d=_([]),w=_(""),m=_([]),s=Z(()=>a.options.find(R=>R.value===a.modelValue)),p=R=>R.preview||(R.image_path?`/${R.image_path}`:R),V=()=>{w.value=a.modelValue||"",u.value=i.value,d.value=[...r.value],m.value=[...r.value],v.value=!0},B=()=>{u.value="",d.value=[],w.value="",v.value=!1},M=R=>{d.value=R,r.value=[...R],k("update:images",[...R]),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:i.value,images:[...R]})},K=()=>{w.value!==a.modelValue&&k("update:modelValue",w.value),i.value=u.value,k("update:notes",u.value),r.value=[...d.value],k("update:images",[...d.value]),k("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:w.value,notes:u.value,images:d.value}),v.value=!1},E=R=>{k("hapus",R),v.value=!1};return(R,F)=>{var L,x,j;return o(),l("div",wa,[!t.modelValue&&r.value.length===0&&!i.value?(o(),l("div",ya,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:V},F[4]||(F[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(o(),l("div",ba,[e("div",{class:"flex justify-between items-start"},[F[5]||(F[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:V,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),r.value.length>0?(o(),l("div",xa,[e("div",ka,[(o(!0),l(oe,null,ne(r.value,(D,J)=>(o(),l("div",{key:J,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:p(D),class:"w-full h-full object-cover rounded"},null,8,$a),J===3&&r.value.length>4?(o(),l("span",Ia," +"+P(r.value.length-4),1)):f("",!0)]))),128))])])):f("",!0),e("div",Ca,[(o(!0),l(oe,null,ne(t.options,(D,J)=>(o(),l("label",{key:J,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:D.value,checked:t.modelValue===D.value,disabled:!0,class:"hidden peer"},null,8,Va),e("div",{class:le(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===D.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==D.value}])},P(D.label),3)]))),128))]),i.value&&((L=s.value.settings)!=null&&L.show_textarea)?(o(),l("div",Sa,[e("p",_a,P(i.value),1)])):f("",!0)])),v.value?(o(),se(Me,{key:(x=t.selectedPoint)==null?void 0:x.id,show:v.value,title:t.pointName||"Detail",subtitle:(j=s.value)==null?void 0:j.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":w.value,"notes-value":u.value,"images-value":d.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":F[0]||(F[0]=D=>w.value=D),"onUpdate:notesValue":F[1]||(F[1]=D=>u.value=D),"onUpdate:imagesValue":F[2]||(F[2]=D=>M(D)),onClose:B,onSave:K,onHapus:F[3]||(F[3]=D=>E(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):f("",!0),t.error?(o(),l("p",Ma,P(t.error),1)):f("",!0)])}}},ja={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ta={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},Na={class:"text-xl font-semibold text-indigo-700"},Ra={class:"p-4 space-y-4"},Da={class:"flex items-start justify-between"},qa={class:"block text-sm font-medium text-gray-700"},Pa={key:0,class:"text-red-500"},Ba={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},La={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:S}){const a=t,k=S,i=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],r=w=>{var p,V,B,M,K;const m=a.form.results[w.id],s=a.form.images[w.id];if(!m)return!1;switch(w.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!m.note;case"select":case"radio":if(!m.status)return!1;const E=(p=w.settings.radios)==null?void 0:p.find(F=>F.value===m.status);return!(E!=null&&E.settings&&(E.settings.show_textarea&&!((V=m.note)!=null&&V.trim())||E.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!m.status)return!1;const R=(B=w.settings.radios)==null?void 0:B.find(F=>F.value===m.status);return!(R!=null&&R.settings&&R.settings.show_textarea&&!((M=m.note)!=null&&M.trim()));case"image":return s.length>0;default:return!!m.status||!!((K=m.note)!=null&&K.trim())}},v=(w,m)=>{k("updateResult",{pointId:w,value:m})},u=w=>{k("saveResult",w)},d=w=>{k("hapusPoint",w)};return(w,m)=>(o(),l("div",ja,[e("div",Ta,[e("h2",Na,P(t.category.name),1)]),e("div",Ra,[(o(!0),l(oe,null,ne(t.category.points,s=>{var p,V,B,M,K,E,R,F,L,x,j,D,J,te,z,C,N,W,$,y,H,n,I,h,A,T;return o(),l("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",Da,[e("label",qa,[ue(P(s.name)+" ",1),(p=s.settings)!=null&&p.is_required?(o(),l("span",Pa,"*")):f("",!0)]),r(s)?(o(),l("span",Ba," ✓ ")):f("",!0)]),s.input_type==="text"?(o(),se(ft,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[b=>t.form.results[s.id].note=b,b=>v(s.id,b)],required:(V=s.settings)==null?void 0:V.is_required,"min-length":(B=s.settings)==null?void 0:B.min_length,"max-length":(M=s.settings)==null?void 0:M.max_length,allowSpace:(K=s.settings)==null?void 0:K.allow_space,textTransform:(E=s.settings)==null?void 0:E.text_transform,placeholder:((R=s.settings)==null?void 0:R.placeholder)||"Masukan text",error:t.form.errors[`results.${s.id}.note`],onSave:b=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):f("",!0),s.input_type==="number"?(o(),se(Be,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[b=>t.form.results[s.id].note=b,b=>v(s.id,b)],required:(F=s.settings)==null?void 0:F.is_required,min:(L=s.settings)==null?void 0:L.min,max:(x=s.settings)==null?void 0:x.max,step:((j=s.settings)==null?void 0:j.step)||1,placeholder:((D=s.settings)==null?void 0:D.placeholder)||"Masukan number",error:t.form.errors[`results.${s.id}.note`],onSave:b=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):f("",!0),s.input_type==="account"?(o(),se(Ct,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[b=>t.form.results[s.id].note=b,b=>v(s.id,b)],required:(J=s.settings)==null?void 0:J.is_required,placeholder:((te=s.settings)==null?void 0:te.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:b=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):f("",!0),s.input_type==="date"?(o(),se(xt,{key:3,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[b=>t.form.results[s.id].note=b,b=>v(s.id,b)],required:(z=s.settings)==null?void 0:z.is_required,"min-date":(C=s.settings)==null?void 0:C.min_date,"max-date":(N=s.settings)==null?void 0:N.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:b=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):f("",!0),s.input_type==="textarea"?(o(),se(Ne,{key:4,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[b=>t.form.results[s.id].note=b,b=>v(s.id,b)],required:(W=s.settings)==null?void 0:W.is_required,"min-length":($=s.settings)==null?void 0:$.min_length,"max-length":(y=s.settings)==null?void 0:y.max_length,placeholder:((H=s.settings)==null?void 0:H.placeholder)||"Masukkan teks di sini",settings:s.settings,error:t.form.errors[`results.${s.id}.note`],onSave:b=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):f("",!0),s.input_type==="radio"?(o(),se(fa,{key:5,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[b=>t.form.results[s.id].status=b,b=>v(s.id,b)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(n=s.settings)==null?void 0:n.is_required,"point-id":s.id,point:s,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((I=s.settings)==null?void 0:I.radios)||i,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":b=>t.form.results[s.id].note=b,"onUpdate:images":b=>t.form.images[s.id]=b,onSave:b=>u(s.id),onHapus:b=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):f("",!0),s.input_type==="imageTOradio"?(o(),se(Ua,{key:6,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[b=>t.form.results[s.id].status=b,b=>v(s.id,b)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(h=s.settings)==null?void 0:h.is_required,"point-id":s.id,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((A=s.settings)==null?void 0:A.radios)||i,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":b=>t.form.results[s.id].note=b,"onUpdate:images":b=>t.form.images[s.id]=b,onSave:b=>u(s.id),onHapus:b=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):f("",!0),s.input_type==="image"?(o(),se(Se,{key:7,modelValue:t.form.images[s.id],"onUpdate:modelValue":b=>t.form.images[s.id]=b,error:t.form.errors[`images.${s.id}`],"inspection-id":t.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,"onUpdate:notes":b=>t.form.results[s.id].note=b,"onUpdate:status":b=>t.form.results[s.id].status=b},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):f("",!0),s.input_type==="select"?(o(),se(Bt,{key:8,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[b=>t.form.results[s.id].status=b,b=>v(s.id,b)],required:(T=s.settings)==null?void 0:T.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:b=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):f("",!0)])}),128))])]))}},Aa=ge(La,[["__scopeId","data-v-54d0f511"]]),Fa={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ea={class:"p-4 space-y-4-6"},za={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ha=["value"],Oa={class:"p-4 space-y-4-6"},Wa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ka=["value"],Xa={key:0,class:"p-4 space-y-4-6"},Ga={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ja=["value"],Ya={class:"p-4 space-y-4-6"},Za={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(t){const S=t,a=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(p){return console.error("Error parsing settings JSON:",p),{}}return typeof s=="object"&&s!==null?s:{}},k=Z(()=>a(S.inspection.settings).conclusion||{}),i=_({flooded:k.value.flooded||"",collision:k.value.collision||"",collision_severity:k.value.collision_severity||"",conclusion_note:S.inspection.notes||""}),r=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],v=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],u=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],d=()=>{const s={flooded:i.value.flooded,collision:i.value.collision,collision_severity:i.value.collision==="yes"?i.value.collision_severity:null,conclusion_note:i.value.conclusion_note};Ve.post(route("inspections.updateConclusion",S.inspectionId),s,{preserveScroll:!0,preserveState:!0,onError:p=>{console.error("Error saving conclusion:",p)}})},w=xe.debounce(d,500);re([()=>i.value.flooded,()=>i.value.collision,()=>i.value.collision_severity],()=>{d()}),ke(()=>{m()}),re(()=>S.inspection,()=>{m()},{deep:!0});const m=()=>{const p=a(S.inspection.settings).conclusion||{};i.value={flooded:p.flooded||"",collision:p.collision||"",collision_severity:p.collision_severity||"",conclusion_note:S.inspection.notes||""}};return(s,p)=>(o(),l("div",Fa,[p[9]||(p[9]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),e("div",Ea,[p[5]||(p[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),e("div",za,[(o(),l(oe,null,ne(r,V=>e("label",{key:V.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":p[0]||(p[0]=B=>i.value.flooded=B),value:V.value,class:"hidden peer"},null,8,Ha),[[Ie,i.value.flooded]]),e("div",{class:le(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.flooded===V.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.flooded!==V.value}])},P(V.label),3)])),64))])]),e("div",Oa,[p[7]||(p[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),e("div",Wa,[(o(),l(oe,null,ne(v,V=>e("label",{key:V.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":p[1]||(p[1]=B=>i.value.collision=B),value:V.value,class:"hidden peer"},null,8,Ka),[[Ie,i.value.collision]]),e("div",{class:le(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.collision===V.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.collision!==V.value}])},P(V.label),3)])),64))]),i.value.collision==="yes"?(o(),l("div",Xa,[p[6]||(p[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),e("div",Ga,[(o(),l(oe,null,ne(u,V=>e("label",{key:V.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":p[2]||(p[2]=B=>i.value.collision_severity=B),value:V.value,class:"hidden peer"},null,8,Ja),[[Ie,i.value.collision_severity]]),e("div",{class:le(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":i.value.collision_severity===V.value,"border-gray-300 text-gray-700 hover:bg-gray-50":i.value.collision_severity!==V.value}])},P(V.label),3)])),64))])])):f("",!0)]),e("div",Ya,[p[8]||(p[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),ce(e("textarea",{"onUpdate:modelValue":p[3]||(p[3]=V=>i.value.conclusion_note=V),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:p[4]||(p[4]=(...V)=>G(w)&&G(w)(...V))},null,544),[[we,i.value.conclusion_note]])])]))}},Qa={class:"container mx-auto px-4 py-2"},eo={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},to={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},so=["onClick"],ao={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},oo={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},no={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},lo={class:"relative overflow-hidden"},io={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},ro=["disabled"],uo={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},co={class:"space-y-4"},mo={class:"relative"},go={class:"max-h-64 overflow-y-auto"},vo={key:0,class:"text-center py-4 text-gray-500"},po=["onClick"],ho={class:"font-medium text-gray-900"},fo={class:"text-sm text-gray-500"},wo={class:"text-xs text-gray-400 mt-1"},yo={key:0,class:"text-xs text-green-600 mt-1"},bo={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup(t){var q;const S=t,a=_(!1),k=_(!1),i=_(""),r=_(null),v=_(""),u=_(""),d=_([]),w=_(""),m=(g,c)=>g.filter(U=>c?V(U.id):!0),s=Z(()=>S.damagePoints||[]),p=Z(()=>{if(!i.value.trim())return s.value;const g=i.value.toLowerCase().trim();return s.value.filter(c=>{var U,O,Y;return((U=c.name)==null?void 0:U.toLowerCase().includes(g))||((O=c.description)==null?void 0:O.toLowerCase().includes(g))||((Y=B(c))==null?void 0:Y.toLowerCase().includes(g))})}),V=g=>{var U;const c=z.results[g];return c&&(c.status||c.note||((U=c.images)==null?void 0:U.length)>0)},B=g=>{const c=S.components.find(U=>U.id===g.component_id);return c?c.name:"Komponen Tidak Diketahui"},M=g=>g&&Array.isArray(S.existingResults)?S.existingResults.find(c=>c.point_id===g):null,K=g=>{r.value=g;const c=z.results[g.id]||{};v.value=c.status||"",u.value=c.note||"",d.value=Array.isArray(c.images)?[...c.images]:[],a.value=!1,k.value=!0},E=()=>{r.value&&(z.results[r.value.id]={...z.results[r.value.id],status:v.value,note:u.value,images:Array.isArray(d.value)?[...d.value]:[]},I(r.value.id),w.value="Data berhasil disimpan!",setTimeout(()=>{w.value=""},1e3)),F()},R=()=>{a.value=!1,i.value=""},F=()=>{k.value=!1,r.value=null,v.value="",u.value="",d.value=[]},x=De().props.inspection,j=_(((q=S.appMenu[0])==null?void 0:q.id)||"conclusion"),D=_(0),J=Z(()=>j.value!=="conclusion"?S.appMenu.find(g=>g.id===j.value):null);function te(){const g={},c={};return S.appMenu.forEach(U=>{(U.points||[]).forEach(O=>{var ee;const Y=Array.isArray(S.existingResults)?S.existingResults.find(ie=>ie.point_id===O.id):null;g[O.id]={status:(Y==null?void 0:Y.status)||"",note:(Y==null?void 0:Y.note)||""};const Q=((ee=S.existingImages)==null?void 0:ee[O.id])||[];c[O.id]=Q.map(ie=>({id:ie.id,image_path:ie.image_path,preview:`/${ie.image_path}`,rotation:ie.rotation||0,isNew:!1}))})}),{inspection_id:S.inspection.id,results:g,images:c,overall_note:S.inspection.overall_note||""}}const z=Te(te()),C=g=>g.input_type==="damage"?!0:g.id==="conclusion"?W():g.points.every(c=>{var Q,ee,ie,pe,he,fe;const U=z.results[c.id],O=z.images[c.id];if(!U)return!1;const Y=N(c.settings);switch(c.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((Q=U.note)!=null&&Q.trim());case"select":case"radio":if(!U.status)return!1;const X=(ee=Y.radios)==null?void 0:ee.find($e=>$e.value===U.status);return!(X!=null&&X.settings&&(X.settings.show_textarea&&!((ie=U.note)!=null&&ie.trim())||X.settings.show_image_upload&&(O==null?void 0:O.length)===0));case"imageTOradio":if((O==null?void 0:O.length)===0||!U.status)return!1;const ve=(pe=Y.radios)==null?void 0:pe.find($e=>$e.value===U.status);return!(ve!=null&&ve.settings&&ve.settings.show_textarea&&ve.settings.required&&!((he=U.note)!=null&&he.trim()));case"image":return(O==null?void 0:O.length)>0;default:return!!U.status||!!((fe=U.note)!=null&&fe.trim())}}),N=g=>{if(!g)return{};if(typeof g=="string")try{return JSON.parse(g)||{}}catch(c){return console.error("Error parsing settings JSON:",c),{}}return typeof g=="object"&&g!==null?g:{}},W=()=>{var ee;const c=N(S.inspection.settings).conclusion||{},U=!!c.flooded,O=!!c.collision,Y=c.collision==="yes"?!!c.collision_severity:!0,Q=!!((ee=S.inspection.notes)!=null&&ee.trim());return U&&O&&Y&&Q},$=Z(()=>{const c=N(S.inspection.settings).conclusion||{};return{flooded:c.flooded||null,collision:c.collision||null,collision_severity:c.collision_severity||null,note:S.inspection.notes||null,isComplete:W()}}),y=g=>{j.value=g},H=g=>{var O;let c=D.value+g;const U=S.appMenu.length;c>=0&&c<=U&&(D.value=c,j.value=((O=S.appMenu[c])==null?void 0:O.id)||"conclusion")},n=()=>{let g=0,c=0;const U=ee=>{g=ee.changedTouches[0].screenX},O=ee=>{c=ee.changedTouches[0].screenX,Y()},Y=()=>{c<g-150?H(1):c>g+150&&H(-1)},Q=document.querySelector(".relative.overflow-hidden");return Q&&(Q.addEventListener("touchstart",U,!1),Q.addEventListener("touchend",O,!1)),()=>{Q&&(Q.removeEventListener("touchstart",U),Q.removeEventListener("touchend",O))}},I=xe.debounce(async g=>{try{await Ve.post(route("inspections.save-result"),{inspection_id:S.inspection.id,point_id:g,status:z.results[g].status,note:z.results[g].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(c){console.error("Error menyimpan hasil:",c)}},500),h=({pointId:g,type:c,value:U})=>{z.results[g].hasOwnProperty(c)&&(z.results[g][c]=U),I(g)},A=async g=>{if(g&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await Ve.post(route("inspections.delete-result"),{inspection_id:S.inspection.id,point_id:g},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{z.results[g]&&delete z.results[g],w.value="Data berhasil dihapus!",setTimeout(()=>{w.value=""},2e3)}})}catch(c){console.error("Error menghapus hasil:",c)}F()}},T=g=>{Object.assign(z.conclusion,g),saveConclusion()},b=()=>{if(!ae.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}z.post(route("inspections.final-submit",{id:S.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:g=>{console.error("Kesalahan pengiriman:",g)}})};re(j,g=>{const c=document.querySelector(`.flex-shrink-0[data-category-id="${g}"]`);c&&c.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const ae=Z(()=>{const g=S.appMenu.every(U=>C(U)),c=W();return g&&c});return re(i,xe.debounce(()=>{},300)),ke(()=>{n()}),(g,c)=>{var U,O,Y,Q,ee,ie,pe,he,fe;return o(),l("div",Qa,[e("div",eo,[e("div",to,[e("button",{onClick:c[0]||(c[0]=X=>y("vehicle")),class:le(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":j.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":j.value!=="vehicle"}])}," Detail Kendaraan ",2),(o(!0),l(oe,null,ne(t.appMenu,X=>(o(),l("button",{key:X.id,onClick:ve=>y(X.id),class:le(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":j.value===X.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":j.value!==X.id}])},[ue(P(X.name)+" ",1),C(X)?(o(),l("span",ao," ✓ ")):f("",!0)],10,so))),128)),e("button",{onClick:c[1]||(c[1]=X=>y("conclusion")),class:le(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":j.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":j.value!=="conclusion"}])},[c[7]||(c[7]=ue(" Kesimpulan ")),$.value.isComplete?(o(),l("span",oo," ✓ ")):f("",!0)],2)])]),de(Ce,{name:"fade"},{default:me(()=>[w.value?(o(),l("div",no,P(w.value),1)):f("",!0)]),_:1}),e("div",lo,[de(Ce,{name:"category-slide",mode:"out-in"},{default:me(()=>[j.value==="vehicle"?(o(),se(gt,{key:0,inspection:G(x),CarDetail:t.CarDetail,onUpdateVehicle:g.updateVehicleDetails,onSaveCarDetails:g.saveNewCarDetails},null,8,["inspection","CarDetail","onUpdateVehicle","onSaveCarDetails"])):J.value&&j.value!=="conclusion"?(o(),se(Aa,{key:J.value.id,category:{...J.value,points:m(J.value.points||[],J.value.input_type==="damage")},"inspection-id":G(x).id,form:G(z),onSaveResult:G(I),onUpdateResult:h,onHapusPoint:A,onRemoveImage:g.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):j.value==="conclusion"?(o(),se(Za,{key:2,form:G(z),"inspection-id":G(x).id,inspection:G(x),settings:G(x).settings||{},onUpdateConclusion:T},null,8,["form","inspection-id","inspection","settings"])):f("",!0)]),_:1})]),j.value==="conclusion"?(o(),l("div",io,[e("button",{type:"button",onClick:b,disabled:!ae.value||G(z).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[G(z).processing?(o(),l("svg",uo,c[8]||(c[8]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):f("",!0),e("span",null,P(G(z).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ro)])):f("",!0),!a.value&&!k.value?(o(),l("button",{key:1,onClick:c[2]||(c[2]=X=>a.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},c[9]||(c[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):f("",!0),de(Re,{show:a.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:R},{default:me(()=>[e("div",co,[e("div",mo,[ce(e("input",{"onUpdate:modelValue":c[3]||(c[3]=X=>i.value=X),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[we,i.value]]),c[10]||(c[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",go,[p.value.length===0?(o(),l("div",vo," Tidak ada point yang ditemukan ")):f("",!0),(o(!0),l(oe,null,ne(p.value,X=>(o(),l("button",{key:X.id,onClick:ve=>K(X),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",ho,P(X.name),1),e("div",fo,P(X.description),1),e("div",wo,P(B(X)),1),V(X.id)?(o(),l("div",yo," ✓ Sudah ada data ")):f("",!0)],8,po))),128))])])]),_:1},8,["show"]),k.value?(o(),se(Me,{key:(U=r.value)==null?void 0:U.id,show:k.value,title:((O=r.value)==null?void 0:O.name)||"Detail Point",subtitle:(Y=r.value)==null?void 0:Y.description,name:`point-${(Q=r.value)==null?void 0:Q.id}`,"inspection-id":G(x).id,"point-id":(ee=r.value)==null?void 0:ee.id,settings:((ie=r.value)==null?void 0:ie.settings)||{},options:((he=(pe=r.value)==null?void 0:pe.settings)==null?void 0:he.radios)||[],"selected-Point":r.value,"selected-value":v.value,"images-value":G(z).images[r.value.id],"notes-value":u.value,point:r.value,"existing-data":M((fe=r.value)==null?void 0:fe.id),"onUpdate:selectedValue":c[4]||(c[4]=X=>v.value=X),"onUpdate:notesValue":c[5]||(c[5]=X=>u.value=X),"onUpdate:imagesValue":c[6]||(c[6]=X=>G(z).images[r.value.id]=X),onSave:E,onClose:F,onHapus:A},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):f("",!0)])}}},So=ge(bo,[["__scopeId","data-v-f5189791"]]);export{So as default};
