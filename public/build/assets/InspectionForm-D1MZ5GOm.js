import{g as h,q as k,E as De,x as Me,W as _,s as Ve,f as v,o as c,d as r,n as J,j as Q,i as f,F as G,k as re,e as F,b as O,w as U,t as C,T as ue,u as w,p as Ee,S as Pe,v as Te,y as Re}from"./vendor-BTHpbkmK.js";import{l as ce}from"./lodash-DIQq7uM1.js";import{V as je,C as Le,a as ze,B as Ae,_ as Be}from"./ConclusionSection-CtPKZrGa.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-CGeACnVc.js";import"./ActionMessage-BtaXIXoO.js";import"./InputNumber-pQ_KuJkf.js";const Fe={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Oe={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Ue={class:"flex overflow-x-auto scrollbar-hide py-3 px-4"},$e={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},He=["onClick"],Ie={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ke={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},qe={class:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1"},We={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Xe={class:"relative overflow-hidden"},Je={key:0,class:"flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md"},Qe={key:1},Ge=["disabled"],Ye={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ze={class:"space-y-4"},et={class:"relative"},tt={class:"max-h-64 overflow-y-auto"},st={key:0,class:"text-center py-4 text-gray-500"},nt=["onClick"],it={class:"font-medium text-gray-900"},ot={class:"text-sm text-gray-500"},at={class:"text-xs text-gray-400 mt-1"},lt={key:0,class:"text-xs text-green-600 mt-1"},rt={__name:"InspectionForm",props:{inspection:Object,inspectionId:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array},setup(m){const o=m,S=h(!1),D=h(!1),M=h(""),d=h(null),V=h(""),E=h(""),b=h(""),z=h(!1),A=h(null),de=(e,t)=>{z.value=!0,A.value=t,_.visit(e,{onFinish:()=>{z.value=!1,A.value=null}})},B=k(()=>["vehicle",...o.appMenus.map(e=>e.id),"conclusion"]),p=h(B.value[0]),Y=h(0);De(p,e=>{Y.value=B.value.indexOf(e)});const $=k(()=>{if(p.value==="vehicle"||p.value==="conclusion")return null;const e=o.appMenus.find(t=>t.id===p.value);return e?{...e,points:H(e.menu_point,e.input_type==="damage")}:null}),H=(e,t)=>t?(e||[]).filter(s=>{const n=s.inspection_point_id;return te(n)}):e||[],Z=k(()=>{o.CarDetail;const e=o.inspection;return!!e.plate_number&&!!e.car_name}),ee=k(()=>{if(!M.value.trim())return o.damagePoints||[];const e=M.value.toLowerCase().trim();return(o.damagePoints||[]).filter(t=>{var s,n,l,u,g;return((n=(s=t.inspection_point)==null?void 0:s.name)==null?void 0:n.toLowerCase().includes(e))||((u=(l=t.inspection_point)==null?void 0:l.description)==null?void 0:u.toLowerCase().includes(e))||((g=se(t))==null?void 0:g.toLowerCase().includes(e))})}),te=e=>{const t=o.existingResults&&o.existingResults[e]!==void 0,s=o.existingImages&&o.existingImages[e]&&o.existingImages[e].length>0,n=i.results[e]&&(i.results[e].status||i.results[e].note),l=i.images[e]&&i.images[e].length>0;return t||s||n||l},se=e=>{var t,s;return((s=(t=e.inspection_point)==null?void 0:t.component)==null?void 0:s.name)||"Komponen Tidak Diketahui"},pe=e=>o.existingResults[e]||null,ge=e=>{d.value=e;const t=e.inspection_point_id,s=i.results[t]||{};V.value=s.status||"",E.value=s.note||"",S.value=!1,D.value=!0},ve=e=>{d.value&&(i.images[d.value.inspection_point_id]=e)},me=()=>{if(d.value){const e=d.value.inspection_point_id;i.results[e]={...i.results[e],status:V.value,note:E.value},N(e),b.value="Data berhasil disimpan!",setTimeout(()=>b.value="",1e3)}I()},he=()=>{S.value=!1,M.value=""},I=()=>{D.value=!1,d.value=null,V.value="",E.value=""},i=Me((()=>{const e={},t={};return[...o.appMenus.flatMap(n=>n.menu_point||[]),...o.damagePoints||[]].forEach(n=>{const l=n.inspection_point_id,u=o.existingResults[l];e[l]={status:(u==null?void 0:u.status)||"",note:(u==null?void 0:u.note)||""},t[l]=o.existingImages[l]||[]}),{inspection_id:o.inspection.id,results:e,images:t,overall_note:o.inspection.overall_note||""}})()),ne=e=>e.input_type==="damage"?H(e.menu_point,!0).length>0:e.id==="conclusion"?q():H(e.menu_point,!1).every(s=>{var g,P,T,R,j,L;const n=i.results[s.inspection_point_id],l=i.images[s.inspection_point_id];if(!n)return!1;const u=K(s.settings);switch(s.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((g=n.note)!=null&&g.trim());case"select":case"radio":if(!n.status)return!1;const y=(P=u.radios)==null?void 0:P.find(a=>a.value===n.status);return!(y!=null&&y.settings&&(y.settings.show_textarea&&!((T=n.note)!=null&&T.trim())||y.settings.show_image_upload&&(l==null?void 0:l.length)===0));case"imageTOradio":if((l==null?void 0:l.length)===0||!n.status)return!1;const x=(R=u.radios)==null?void 0:R.find(a=>a.value===n.status);return!(x!=null&&x.settings&&x.settings.show_textarea&&x.settings.required&&!((j=n.note)!=null&&j.trim()));case"image":return(l==null?void 0:l.length)>0;default:return!!n.status||!!((L=n.note)!=null&&L.trim())}}),K=e=>{if(!e)return{};if(typeof e=="string")try{return JSON.parse(e)||{}}catch(t){return console.error("Error parsing settings JSON:",t),{}}return typeof e=="object"&&e!==null?e:{}},q=()=>{var g;const t=K(o.inspection.settings).conclusion||{},s=!!t.flooded,n=!!t.collision,l=t.collision==="yes"?!!t.collision_severity:!0,u=!!((g=o.inspection.notes)!=null&&g.trim());return s&&n&&l&&u},fe=k(()=>{const t=K(o.inspection.settings).conclusion||{};return{flooded:t.flooded||null,collision:t.collision||null,collision_severity:t.collision_severity||null,note:o.inspection.notes||null,isComplete:q()}}),ie=k(()=>{const e=Z.value,t=o.appMenus.every(n=>ne(n)),s=q();return e&&t&&s}),W=e=>{p.value=e},oe=e=>{let t=Y.value+e;t>=0&&t<B.value.length&&(p.value=B.value[t])},N=ce.debounce(async e=>{var t,s;try{await _.post(route("inspections.save-result"),{inspection_id:o.inspection.id,point_id:e,status:(t=i.results[e])==null?void 0:t.status,note:(s=i.results[e])==null?void 0:s.note,images:i.images[e]},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{_.reload({only:["existingResults","existingImages"]})}})}catch(n){console.error("Error menyimpan hasil:",n)}},500),ye=({pointId:e,type:t,value:s})=>{var n;(n=i.results[e])!=null&&n.hasOwnProperty(t)&&(i.results[e][t]=s),N(e)},ae=async e=>{if(e&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await _.post(route("inspections.delete-result"),{inspection_id:o.inspection.id,point_id:e},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{i.results[e]&&delete i.results[e],i.images[e]&&delete i.images[e],b.value="Data berhasil dihapus!",setTimeout(()=>{b.value=""},2e3),_.reload({only:["existingResults","existingImages"]})},onError:t=>{console.error("Error menghapus hasil:",t)}})}catch(t){console.error("Error menghapus hasil:",t)}I()}},xe=e=>{console.log("Update vehicle:",e)},we=e=>{console.log("Save car details:",e)},be=e=>{Object.assign(i.conclusion,e),ke()},ke=ce.debounce(async()=>{try{await _.post(route("inspections.save-conclusion"),{inspection_id:o.inspection.id,...i.conclusion},{preserveScroll:!0,preserveState:!0})}catch(e){console.error("Error menyimpan kesimpulan:",e)}},500),_e=()=>{if(!ie.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}i.post(route("inspections.final-submit",{id:o.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:e=>{console.error("Kesalahan pengiriman:",e)}})},Ce=({pointId:e,imageId:t})=>{i.images[e]&&(i.images[e]=i.images[e].filter(s=>s.id!==t),N(e))},Se=()=>{let e=0,t=0;const s=g=>{e=g.changedTouches[0].screenX},n=g=>{t=g.changedTouches[0].screenX,l()},l=()=>{t<e-150?oe(1):t>e+150&&oe(-1)},u=document.querySelector(".relative.overflow-hidden");return u&&(u.addEventListener("touchstart",s,!1),u.addEventListener("touchend",n,!1)),()=>{u&&(u.removeEventListener("touchstart",s),u.removeEventListener("touchend",n))}};return Ve(()=>{Se()}),(e,t)=>{var s,n,l,u,g,P,T,R,j,L,y,x;return c(),v("div",Fe,[r("div",Oe,[r("div",Ue,[r("button",{onClick:t[0]||(t[0]=a=>W("vehicle")),class:J(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="vehicle"}])},[t[7]||(t[7]=Q(" Detail Kendaraan ")),Z.value?(c(),v("span",$e," ✓ ")):f("",!0)],2),(c(!0),v(G,null,re(m.appMenus,a=>(c(),v("button",{key:a.id,onClick:X=>W(a.id),class:J(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value===a.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!==a.id}])},[Q(C(a.name)+" ",1),ne(a)?(c(),v("span",Ie," ✓ ")):f("",!0)],10,He))),128)),r("button",{onClick:t[1]||(t[1]=a=>W("conclusion")),class:J(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":p.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="conclusion"}])},[t[8]||(t[8]=Q(" Kesimpulan ")),fe.value.isComplete?(c(),v("span",Ke," ✓ ")):f("",!0)],2)])]),r("div",qe,[F(ue,{name:"fade"},{default:U(()=>[b.value?(c(),v("div",We,C(b.value),1)):f("",!0)]),_:1}),r("div",Xe,[F(ue,{name:"category-slide",mode:"out-in"},{default:U(()=>[p.value==="vehicle"?(c(),O(je,{key:0,inspection:m.inspection,CarDetail:m.CarDetail,onUpdateVehicle:xe,onSaveCarDetails:we},null,8,["inspection","CarDetail"])):$.value&&p.value!=="conclusion"?(c(),O(Le,{key:$.value.id,category:$.value,"inspection-id":m.inspection.id,form:w(i),onSaveResult:w(N),onUpdateResult:ye,onHapusPoint:ae,onRemoveImage:Ce},null,8,["category","inspection-id","form","onSaveResult"])):p.value==="conclusion"?(c(),O(ze,{key:2,form:w(i),"inspection-id":m.inspection.id,inspection:m.inspection,settings:m.inspection.settings||{},onUpdateConclusion:be},null,8,["form","inspection-id","inspection","settings"])):f("",!0)]),_:1})]),p.value==="conclusion"?(c(),v("div",Je,[F(w(Pe),{href:e.route("inspections.pending",m.inspectionId),as:"button",type:"button",disabled:z.value&&A.value==="pending",onClick:t[2]||(t[2]=Ee(a=>de(e.route("inspections.pending",m.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:U(()=>[z.value&&A.value==="pending"?(c(),v(G,{key:0},[t[9]||(t[9]=r("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 \r
             5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 \r
             5.824 3 7.938l3-2.647z`})],-1)),t[10]||(t[10]=r("span",null,"Memproses...",-1))],64)):(c(),v("span",Qe,"Tunda"))]),_:1},8,["href","disabled"]),r("button",{type:"button",onClick:_e,disabled:!ie.value||w(i).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[w(i).processing?(c(),v("svg",Ye,t[11]||(t[11]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 \r
           5.373 0 12h4zm2 5.291A7.962 7.962 0 \r
           014 12H0c0 3.042 1.135 5.824 3 \r
           7.938l3-2.647z`},null,-1)]))):f("",!0),r("span",null,C(w(i).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Ge)])):f("",!0),!S.value&&!D.value?(c(),v("button",{key:1,onClick:t[3]||(t[3]=a=>S.value=!0),class:"fixed bottom-4 right-4 z-50 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},t[12]||(t[12]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):f("",!0),F(Ae,{show:S.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:he},{default:U(()=>[r("div",Ze,[r("div",et,[Te(r("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>M.value=a),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Re,M.value]]),t[13]||(t[13]=r("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[r("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),r("div",tt,[ee.value.length===0?(c(),v("div",st," Tidak ada point yang ditemukan ")):f("",!0),(c(!0),v(G,null,re(ee.value,a=>{var X,le;return c(),v("button",{key:a.id,onClick:ct=>ge(a),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[r("div",it,C((X=a.inspection_point)==null?void 0:X.name),1),r("div",ot,C((le=a.inspection_point)==null?void 0:le.description),1),r("div",at,C(se(a)),1),te(a.inspection_point_id)?(c(),v("div",lt," ✓ Sudah ada data ")):f("",!0)],8,nt)}),128))])])]),_:1},8,["show"]),D.value?(c(),O(Be,{key:(s=d.value)==null?void 0:s.id,show:D.value,title:((l=(n=d.value)==null?void 0:n.inspection_point)==null?void 0:l.name)||"Detail Point",subtitle:(g=(u=d.value)==null?void 0:u.inspection_point)==null?void 0:g.description,name:`point-${(P=d.value)==null?void 0:P.id}`,"inspection-id":m.inspection.id,"point-id":(T=d.value)==null?void 0:T.inspection_point_id,settings:((R=d.value)==null?void 0:R.settings)||{},options:((L=(j=d.value)==null?void 0:j.settings)==null?void 0:L.radios)||[],"selected-Point":d.value,"selected-value":V.value,"images-value":w(i).images[(y=d.value)==null?void 0:y.inspection_point_id],"notes-value":E.value,point:d.value,"existing-data":pe((x=d.value)==null?void 0:x.inspection_point_id),"onUpdate:selectedValue":t[5]||(t[5]=a=>V.value=a),"onUpdate:notesValue":t[6]||(t[6]=a=>E.value=a),"onUpdate:imagesValue":ve,onSave:me,onClose:I,onHapus:ae},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):f("",!0)])])}}},yt=Ne(rt,[["__scopeId","data-v-f6809857"]]);export{yt as default};
