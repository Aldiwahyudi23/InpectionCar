import{x as D,d as g,l as B,z as U,c as $,o as l,w as q,b as F,a as t,u as a,i as L,e as i,f as c,t as d,p as b,v,F as h,h as k,g as T,A as E,s as K,n as G}from"./app-DDbkdHwV.js";import{l as J}from"./lodash-nYPKdAxv.js";import{A as P}from"./AppLayout-BgZV8DiB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},Q={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},W={class:"mb-6"},O={class:"mb-6"},R={class:"relative"},X={key:0,class:"absolute right-3 top-3"},Y={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Z={key:0},ee=["onMousedown"],te={class:"font-medium text-gray-900"},se={class:"text-sm text-gray-500"},re={key:1,class:"p-4 text-sm text-gray-500 text-center"},oe={class:"mb-6"},ae=["value"],le={class:"mb-6 flex items-center justify-between"},ie={class:"relative inline-flex items-center cursor-pointer"},de={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ne={class:"mt-6 flex justify-end"},ue=["disabled"],ce={key:2,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},me={key:0,class:"mb-4"},pe={class:"text-gray-600 text-sm"},ge={key:1},be={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},fe=["src","alt"],ye={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},ve={class:"text-white text-xs text-center"},_e={key:2,class:"text-center py-4 text-gray-500 text-sm"},Ce={__name:"Create",props:{CarDetail:Array,Category:Array},setup(w){const V=w,r=D({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null}),n=g(""),m=g(!1),_=g(!1),y=g([]),u=g(null),p=g([]),A=B(()=>!r.plate_number.trim()||!r.category_id||!r.car_id&&!n.value.trim()?!1:r.is_scheduled?r.scheduled_at_date&&r.scheduled_at_time:!0),M=B(()=>r.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),f=o=>{var s,x,I;if(!o)return"";const e=[];return(s=o.brand)!=null&&s.name&&e.push(o.brand.name),(x=o.model)!=null&&x.name&&e.push(o.model.name),(I=o.type)!=null&&I.name&&e.push(o.type.name),e.join(" ")},C=J.debounce(()=>{if(!n.value.trim()){y.value=[],m.value=!1;return}_.value=!0;const o=n.value.toLowerCase().trim();y.value=V.CarDetail.filter(e=>f(e).toLowerCase().includes(o)),m.value=!0,_.value=!1},300),N=()=>{setTimeout(()=>{m.value=!1},200)},S=async o=>{u.value=o,n.value=f(o),r.car_id=o.id,r.car_name=f(o),m.value=!1,await j(o.id)},j=async o=>{try{const e=await fetch(`/api/cars/${o}/images`);e.ok?p.value=await e.json():p.value=[]}catch{p.value=[]}};U(n,o=>{(!u.value||f(u.value)!==o)&&(r.car_id=null,r.car_name=o,u.value=null,p.value=[])});const z=()=>{const o={plate_number:r.plate_number,category_id:r.category_id,is_scheduled:r.is_scheduled};r.is_scheduled&&(o.scheduled_at=`${r.scheduled_at_date} ${r.scheduled_at_time}`),r.car_id?o.car_id=r.car_id:o.car_name=n.value,r.post(route("inspections.store"),{preserveScroll:!0,onSuccess:e=>{if(o.is_scheduled)console.log("Inspeksi berhasil dijadwalkan.");else{const s=e.props.flash.newInspectionId;s?window.location.href=route("inspections.start",s):console.error("Tidak ada ID inspeksi baru yang dikembalikan.")}},onError:()=>{}})};return(o,e)=>(l(),$(P,{title:"Buat Inspeksi Baru"},{default:q(()=>[F(a(L),{title:"Inspek Baru"}),t("div",H,[e[20]||(e[20]=t("div",{class:"mb-4"},[t("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),t("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),a(r).errors.form_error?(l(),i("div",Q,d(a(r).errors.form_error),1)):c("",!0),t("div",W,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a(r).plate_number=s),type:"text",placeholder:"Contoh: B 1234 ABC",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"},null,512),[[v,a(r).plate_number]])]),t("div",O,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),t("div",R,[b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.value=s),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:e[2]||(e[2]=(...s)=>a(C)&&a(C)(...s)),onFocus:e[3]||(e[3]=s=>m.value=!0),onBlur:N},null,544),[[v,n.value]]),_.value?(l(),i("div",X,e[9]||(e[9]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),m.value?(l(),i("div",Y,[y.value.length>0?(l(),i("div",Z,[(l(!0),i(h,null,k(y.value,s=>(l(),i("div",{key:s.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:x=>S(s)},[t("div",te,d(f(s)),1),t("div",se,d(s.year)+" • "+d(s.cc)+"cc • "+d(s.transmission)+" • "+d(s.fuel_type),1)],40,ee))),128))])):(l(),i("div",re,e[10]||(e[10]=[T(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),T(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),t("div",oe,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"category"}," Kategori Inspeksi ",-1)),b(t("select",{id:"category","onUpdate:modelValue":e[4]||(e[4]=s=>a(r).category_id=s),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[12]||(e[12]=t("option",{value:"",disabled:""},"Pilih Kategori",-1)),(l(!0),i(h,null,k(w.Category,s=>(l(),i("option",{key:s.id,value:s.id},d(s.name),9,ae))),128))],512),[[E,a(r).category_id]])]),t("div",le,[e[15]||(e[15]=t("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),t("label",ie,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>a(r).is_scheduled=s),id:"schedule-toggle",class:"sr-only peer"},null,512),[[K,a(r).is_scheduled]]),e[14]||(e[14]=t("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),a(r).is_scheduled?(l(),i("div",de,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),b(t("input",{type:"date",id:"schedule-date","onUpdate:modelValue":e[6]||(e[6]=s=>a(r).scheduled_at_date=s),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[v,a(r).scheduled_at_date]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),b(t("input",{type:"time",id:"schedule-time","onUpdate:modelValue":e[7]||(e[7]=s=>a(r).scheduled_at_time=s),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[v,a(r).scheduled_at_time]])])])):c("",!0),t("div",ne,[t("button",{onClick:z,disabled:!A.value||a(r).processing,class:G({"px-6 py-3 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600  border border-transparent text-white hover:bg-blue-700":!a(r).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600  border-transparent text-white hover:bg-green-700":a(r).is_scheduled})},d(M.value),11,ue)]),a(r).car_id&&u.value?(l(),i("div",ce,[u.value.description?(l(),i("div",me,[e[18]||(e[18]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("p",pe,d(u.value.description),1)])):c("",!0),p.value.length>0?(l(),i("div",ge,[e[19]||(e[19]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",be,[(l(!0),i(h,null,k(p.value,s=>(l(),i("div",{key:s.id,class:"relative group"},[t("img",{src:s.file_path,alt:s.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200"},null,8,fe),s.note?(l(),i("div",ye,[t("p",ve,d(s.note),1)])):c("",!0)]))),128))])])):(l(),i("div",_e," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0)])]),_:1}))}};export{Ce as default};
