import{r as m,q as _,G as Me,x as Ve,W as k,g as Pe,c as p,o as u,d as l,n as G,f as Q,b as h,F as X,m as re,k as T,j as I,w as U,t as C,T as ue,u as w,y as Re,S as je,z as Ae,A as ze}from"./vendor-BqG4I4EA.js";import{l as ce}from"./lodash-DLuEGnHR.js";import{V as Ne,C as Be,a as Ee,B as Fe,_ as Te}from"./ConclusionSection-3CwX-BEM.js";import{_ as Ie}from"./app-CcYMJtIW.js";import"./PrimaryButton--cgeMo_3.js";import"./ActionMessage-D_gbHEWg.js";import"./InputNumber-CIbQabXg.js";const Ue={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},$e={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Le={class:"flex overflow-x-auto scrollbar-hide py-3 px-4"},Oe={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},He=["onClick"],Ke={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},We={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},qe={class:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1"},Je={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Ze={class:"relative overflow-hidden"},Ge={key:0,class:"flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md"},Qe={key:1},Xe=["disabled"],Ye={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},et={class:"space-y-4"},tt={class:"relative"},st={class:"max-h-64 overflow-y-auto"},nt={key:0,class:"text-center py-4 text-gray-500"},it=["onClick"],ot={class:"font-medium text-gray-900"},at={class:"text-sm text-gray-500"},lt={class:"text-xs text-gray-400 mt-1"},rt={key:0,class:"text-xs text-green-600 mt-1"},ut={__name:"InspectionForm",props:{inspection:Object,inspectionId:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(v){const o=v,S=m(!1),D=m(!1),M=m(""),c=m(null),V=m(""),P=m(""),b=m(""),B=m(!1),E=m(null),de=(e,t)=>{B.value=!0,E.value=t,k.visit(e,{onFinish:()=>{B.value=!1,E.value=null}})},Y=_(()=>["vehicle",...o.appMenus.map(e=>e.id),"conclusion"]),g=m(Y.value[0]),pe=m(0);Me(g,e=>{pe.value=Y.value.indexOf(e)});const $=_(()=>{if(g.value==="vehicle"||g.value==="conclusion")return null;const e=o.appMenus.find(t=>t.id===g.value);return e?{...e,points:L(e.menu_point,e.input_type==="damage")}:null}),L=(e,t)=>t?(e||[]).filter(i=>{const s=i.inspection_point_id;return se(s)}):e||[],O=m({plate_number:o.inspection.plate_number,car_id:o.inspection.car_id,car_name:o.inspection.car_name}),ee=m(!1),ge=e=>{ee.value=e},H=_(()=>{var s;const e=O.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(O.value.plate_number),t=!!((s=O.value.car_name)!=null&&s.trim()),i=!ee.value;return e&&t&&i}),te=_(()=>{if(!M.value.trim())return o.damagePoints||[];const e=M.value.toLowerCase().trim();return(o.damagePoints||[]).filter(t=>{var i,s,r,d,f;return((s=(i=t.inspection_point)==null?void 0:i.name)==null?void 0:s.toLowerCase().includes(e))||((d=(r=t.inspection_point)==null?void 0:r.description)==null?void 0:d.toLowerCase().includes(e))||((f=ne(t))==null?void 0:f.toLowerCase().includes(e))})}),se=e=>{const t=o.existingResults&&o.existingResults[e]!==void 0,i=o.existingImages&&o.existingImages[e]&&o.existingImages[e].length>0,s=n.results[e]&&(n.results[e].status||n.results[e].note),r=n.images[e]&&n.images[e].length>0;return t||i||s||r},ne=e=>{var t;return((t=e.inspection_point.component)==null?void 0:t.name)||"Komponen Tidak Diketahui"},me=e=>o.existingResults[e]||null,ve=e=>{c.value=e;const t=e.inspection_point_id,i=n.results[t]||{};V.value=i.status||"",P.value=i.note||"",S.value=!1,D.value=!0},fe=e=>{c.value&&(n.images[c.value.inspection_point_id]=e)},he=()=>{if(c.value){const e=c.value.inspection_point_id;n.results[e]={...n.results[e],status:V.value,note:P.value},F(e),b.value="Data berhasil disimpan!",setTimeout(()=>b.value="",1e3)}K()},ye=()=>{S.value=!1,M.value=""},K=()=>{D.value=!1,c.value=null,V.value="",P.value=""},n=Ve((()=>{const e={},t={};return[...o.appMenus.flatMap(s=>s.menu_point||[]),...o.damagePoints||[]].forEach(s=>{const r=s.inspection_point_id,d=o.existingResults[r];e[r]={status:(d==null?void 0:d.status)||"",note:(d==null?void 0:d.note)||""},t[r]=o.existingImages[r]||[]}),{inspection_id:o.inspection.id,results:e,images:t,overall_note:o.inspection.overall_note||""}})()),ie=e=>e.input_type==="damage"?L(e.menu_point,!0).length>0:e.id==="conclusion"?q():e.id==="vehicle"?H():L(e.menu_point,!1).every(i=>{var f,R,j,A,z,N;const s=n.results[i.inspection_point_id],r=n.images[i.inspection_point_id];if(!s)return!1;const d=W(i.settings);switch(i.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((f=s.note)!=null&&f.trim());case"select":case"radio":if(!s.status)return!1;const y=(R=d.radios)==null?void 0:R.find(a=>a.value===s.status);return!(y!=null&&y.settings&&(y.settings.show_textarea&&!((j=s.note)!=null&&j.trim())||y.settings.show_image_upload&&(r==null?void 0:r.length)===0));case"imageTOradio":if((r==null?void 0:r.length)===0||!s.status)return!1;const x=(A=d.radios)==null?void 0:A.find(a=>a.value===s.status);return!(x!=null&&x.settings&&x.settings.show_textarea&&x.settings.required&&!((z=s.note)!=null&&z.trim()));case"image":return(r==null?void 0:r.length)>0;default:return!!s.status||!!((N=s.note)!=null&&N.trim())}}),W=e=>{if(!e)return{};if(typeof e=="string")try{return JSON.parse(e)||{}}catch(t){return console.error("Error parsing settings JSON:",t),{}}return typeof e=="object"&&e!==null?e:{}},q=()=>{var f;const t=W(o.inspection.settings).conclusion||{},i=!!t.flooded,s=!!t.collision,r=t.collision==="yes"?!!t.collision_severity:!0,d=!!((f=o.inspection.notes)!=null&&f.trim());return i&&s&&r&&d},xe=_(()=>{const t=W(o.inspection.settings).conclusion||{};return{flooded:t.flooded||null,collision:t.collision||null,collision_severity:t.collision_severity||null,note:o.inspection.notes||null,isComplete:q()}}),oe=_(()=>{const e=H.value,t=o.appMenus.every(s=>ie(s)),i=q();return e&&t&&i}),J=e=>{g.value=e},F=ce.debounce(async e=>{var t,i;try{await k.post(route("inspections.save-result"),{inspection_id:o.inspection.id,point_id:e,status:(t=n.results[e])==null?void 0:t.status,note:(i=n.results[e])==null?void 0:i.note,images:n.images[e]},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{k.reload({only:["existingResults","existingImages"]})}})}catch(s){console.error("Error menyimpan hasil:",s)}},500),we=({pointId:e,type:t,value:i})=>{var s;(s=n.results[e])!=null&&s.hasOwnProperty(t)&&(n.results[e][t]=i),F(e)},ae=async e=>{if(e&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await k.post(route("inspections.delete-result"),{inspection_id:o.inspection.id,point_id:e},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{n.results[e]&&delete n.results[e],n.images[e]&&delete n.images[e],b.value="Data berhasil dihapus!",setTimeout(()=>{b.value=""},2e3),k.reload({only:["existingResults","existingImages"]})},onError:t=>{console.error("Error menghapus hasil:",t)}})}catch(t){console.error("Error menghapus hasil:",t)}K()}},be=e=>{console.log("Update vehicle:",e)},_e=e=>{console.log("Save car details:",e)},ke=e=>{Object.assign(n.conclusion,e),Ce()},Ce=ce.debounce(async()=>{try{await k.post(route("inspections.save-conclusion"),{inspection_id:o.inspection.id,...n.conclusion},{preserveScroll:!0,preserveState:!0})}catch(e){console.error("Error menyimpan kesimpulan:",e)}},500),Se=()=>{if(!oe.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}n.post(route("inspections.final-submit",{id:o.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:e=>{console.error("Kesalahan pengiriman:",e)}})},De=({pointId:e,imageId:t})=>{n.images[e]&&(n.images[e]=n.images[e].filter(i=>i.id!==t),F(e))};return Pe(()=>{}),(e,t)=>{var i,s,r,d,f,R,j,A,z,N,y,x;return u(),p("div",Ue,[l("div",$e,[l("div",Le,[l("button",{onClick:t[0]||(t[0]=a=>J("vehicle")),class:G(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!=="vehicle"}])},[t[7]||(t[7]=Q(" Detail Kendaraan ")),H.value?(u(),p("span",Oe," ✓ ")):h("",!0)],2),(u(!0),p(X,null,re(v.appMenus,a=>(u(),p("button",{key:a.id,onClick:Z=>J(a.id),class:G(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value===a.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!==a.id}])},[Q(C(a.name)+" ",1),ie(a)?(u(),p("span",Ke," ✓ ")):h("",!0)],10,He))),128)),l("button",{onClick:t[1]||(t[1]=a=>J("conclusion")),class:G(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!=="conclusion"}])},[t[8]||(t[8]=Q(" Kesimpulan ")),xe.value.isComplete?(u(),p("span",We," ✓ ")):h("",!0)],2)])]),l("div",qe,[T(ue,{name:"fade"},{default:U(()=>[b.value?(u(),p("div",Je,C(b.value),1)):h("",!0)]),_:1}),l("div",Ze,[T(ue,{name:"category-slide",mode:"out-in"},{default:U(()=>[g.value==="vehicle"?(u(),I(Ne,{key:0,inspection:v.inspection,CarDetail:v.CarDetail,allInspections:o.allInspections,onUpdateVehicle:be,onSaveCarDetails:_e,"onUpdate:validation":ge},null,8,["inspection","CarDetail","allInspections"])):$.value&&g.value!=="conclusion"?(u(),I(Be,{key:$.value.id,category:$.value,"inspection-id":v.inspection.id,form:w(n),onSaveResult:w(F),onUpdateResult:we,onHapusPoint:ae,onRemoveImage:De},null,8,["category","inspection-id","form","onSaveResult"])):g.value==="conclusion"?(u(),I(Ee,{key:2,form:w(n),"inspection-id":v.inspection.id,inspection:v.inspection,settings:v.inspection.settings||{},onUpdateConclusion:ke},null,8,["form","inspection-id","inspection","settings"])):h("",!0)]),_:1})]),g.value==="conclusion"?(u(),p("div",Ge,[T(w(je),{href:e.route("inspections.pending",v.inspectionId),as:"button",type:"button",disabled:B.value&&E.value==="pending",onClick:t[2]||(t[2]=Re(a=>de(e.route("inspections.pending",v.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:U(()=>[B.value&&E.value==="pending"?(u(),p(X,{key:0},[t[9]||(t[9]=l("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 \r
             5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 \r
             5.824 3 7.938l3-2.647z`})],-1)),t[10]||(t[10]=l("span",null,"Memproses...",-1))],64)):(u(),p("span",Qe,"Tunda"))]),_:1},8,["href","disabled"]),l("button",{type:"button",onClick:Se,disabled:!oe.value||w(n).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[w(n).processing?(u(),p("svg",Ye,t[11]||(t[11]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 \r
           5.373 0 12h4zm2 5.291A7.962 7.962 0 \r
           014 12H0c0 3.042 1.135 5.824 3 \r
           7.938l3-2.647z`},null,-1)]))):h("",!0),l("span",null,C(w(n).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Xe)])):h("",!0),!S.value&&!D.value?(u(),p("button",{key:1,onClick:t[3]||(t[3]=a=>S.value=!0),class:"fixed bottom-4 right-4 z-10 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},t[12]||(t[12]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):h("",!0),T(Fe,{show:S.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:ye},{default:U(()=>[l("div",et,[l("div",tt,[Ae(l("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>M.value=a),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[ze,M.value]]),t[13]||(t[13]=l("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[l("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),l("div",st,[te.value.length===0?(u(),p("div",nt," Tidak ada point yang ditemukan ")):h("",!0),(u(!0),p(X,null,re(te.value,a=>{var Z,le;return u(),p("button",{key:a.id,onClick:dt=>ve(a),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[l("div",ot,C((Z=a.inspection_point)==null?void 0:Z.name),1),l("div",at,C((le=a.inspection_point)==null?void 0:le.description),1),l("div",lt,C(ne(a)),1),se(a.inspection_point_id)?(u(),p("div",rt," ✓ Sudah ada data ")):h("",!0)],8,it)}),128))])])]),_:1},8,["show"]),D.value?(u(),I(Te,{key:(i=c.value)==null?void 0:i.id,show:D.value,title:((r=(s=c.value)==null?void 0:s.inspection_point)==null?void 0:r.name)||"Detail Point",subtitle:(f=(d=c.value)==null?void 0:d.inspection_point)==null?void 0:f.description,name:`point-${(R=c.value)==null?void 0:R.id}`,"inspection-id":v.inspection.id,"point-id":(j=c.value)==null?void 0:j.inspection_point_id,settings:((A=c.value)==null?void 0:A.settings)||{},options:((N=(z=c.value)==null?void 0:z.settings)==null?void 0:N.radios)||[],"selected-Point":c.value,"selected-value":V.value,"images-value":w(n).images[(y=c.value)==null?void 0:y.inspection_point_id],"notes-value":P.value,point:c.value,"existing-data":me((x=c.value)==null?void 0:x.inspection_point_id),"onUpdate:selectedValue":t[5]||(t[5]=a=>V.value=a),"onUpdate:notesValue":t[6]||(t[6]=a=>P.value=a),"onUpdate:imagesValue":fe,onSave:he,onClose:K,onHapus:ae},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):h("",!0)])])}}},xt=Ie(ut,[["__scopeId","data-v-425b8c04"]]);export{xt as default};
