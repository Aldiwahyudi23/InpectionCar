import{r as w,g as Z,q as H,c as o,o as r,b as y,d as e,t as l,F as f,m as I,a as tt,n as V}from"./vendor-CwaeDJfC.js";import{_ as et}from"./app-BT3C7vU4.js";const st={class:"p-6 bg-white rounded-lg shadow-md"},ot={key:0,class:"mt-2 mb-6"},rt={key:1},at={class:"header flex flex-col gap-5 mb-6 mt-6"},nt={class:"flex items-center gap-5"},dt=["src"],it={key:1,class:"w-40 h-40 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-gray-400"},lt={class:"mt-8"},ct={class:"text-3xl font-bold m-0 text-gray-800"},ut={key:0,class:"car-info"},gt={class:"w-full border-collapse border border-gray-300 rounded-lg overflow-hidden"},pt={class:"bg-gray-50"},yt={class:"p-2 border border-gray-300 text-gray-600"},bt={class:"p-2 border border-gray-300 text-gray-600"},mt={class:"bg-gray-50"},_t={class:"p-2 border border-gray-300 text-gray-600"},ft={class:"p-2 border border-gray-300 text-gray-600"},vt={class:"bg-gray-50"},xt={class:"p-2 border border-gray-300 text-gray-600"},ht={class:"p-2 border border-gray-300 text-gray-600"},kt={class:"bg-gray-50"},wt={class:"p-2 border border-gray-300 text-gray-600"},It={class:"p-2 border border-gray-300 text-gray-600"},jt={class:"bg-gray-50"},Dt={class:"p-2 border border-gray-300 text-gray-600"},Ft={class:"bg-gray-50"},Tt={class:"p-2 border border-gray-300 text-gray-600"},Ct={class:"bg-gray-50"},Nt={class:"p-2 border border-gray-300 text-gray-600"},Pt={class:"bg-gray-50"},Mt={class:"p-2 border border-gray-300 text-gray-600"},St={class:"bg-gray-50"},Lt={class:"p-2 border border-gray-300 text-gray-600"},Ot={key:1,class:"conclusion p-4 bg-gray-50 border-l-4 border-gray-800 rounded-lg"},Kt={class:"m-0 text-gray-600"},Rt=["innerHTML"],Bt={class:"component-title bg-gray-100 px-3 py-2 border-l-4 border-gray-800 font-bold rounded-l-lg"},At={key:0,class:"images flex flex-wrap gap-2 mt-4"},Et=["src"],Ht={key:1,class:"w-28 h-28 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-xs text-gray-400"},Vt={class:"point-name inline-block min-w-[160px] font-bold align-top text-gray-700"},Gt={class:"point-content inline-block w-[calc(100%-70px)] align-top"},Ut={key:1,class:"point-note italic text-gray-600 my-1"},$t={key:0,class:"inspection-images flex flex-wrap gap-2 mt-4"},qt=["src"],zt={key:1,class:"w-20 h-20 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-xs text-gray-400"},Jt={key:1,class:"textarea-note italic text-gray-600 my-2"},Wt={key:2,class:"flex flex-col items-center justify-center h-96 text-center"},Qt=["href"],Xt={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},Yt={class:"bg-white p-6 rounded-lg shadow-xl w-96 max-w-sm"},Zt={class:"flex justify-end space-x-4"},te=["disabled"],ee={key:0},se={key:1},oe={key:1,class:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200 cursor-not-allowed"},re={__name:"ReviewPDF",props:{inspection:{type:Object,required:!0},menu_points:{type:Array,default:()=>[]},coverImage:{type:Object,default:null},encryptedIds:Object},setup(L){const m=L,j=w(!1),D=w(!1),d=w(m.inspection),C=w(m.menu_points),F=w(m.coverImage),G=async()=>{if(d.value.status==="in_progress")try{const s=await tt.get(route("inspections.detail",m.encryptedIds));d.value=s.data.inspection,C.value=s.data.menu_points,F.value=s.data.coverImage}catch(s){console.error("Polling gagal:",s)}};Z(()=>{setInterval(G,5e3)});const U=H(()=>{if(!C.value)return[];const s=new Map;C.value.forEach(a=>{var u;const n=(u=a.inspection_point)==null?void 0:u.component,i=(n==null?void 0:n.id)||0;s.has(i)||s.set(i,{component:n||{id:0,name:"Tanpa Komponen",order:9999},points:[]}),s.get(i).points.push(a)});const t=Array.from(s.values()).sort((a,n)=>a.component.order===n.component.order?new Date(a.component.created_at)-new Date(n.component.created_at):(a.component.order||9999)-(n.component.order||9999));return t.forEach(a=>{a.points.sort((n,i)=>n.order===i.order?new Date(n.created_at)-new Date(i.created_at):(n.order||9999)-(i.order||9999))}),t}),$=()=>{D.value=!0,setTimeout(()=>{window.location.href=route("inspections.download.pdf",m.encryptedIds),D.value=!1,j.value=!1},2e3)},q=H(()=>{const s=m.menu_points.some(a=>T(a)||M(a)),t=m.coverImage&&m.coverImage.image_path;return s||t}),N=s=>s&&s.length>0,P=s=>`/${s}`,T=s=>{var t;return((t=s.inspection_point)==null?void 0:t.results)&&s.inspection_point.results.length>0},M=s=>{var t;return((t=s.inspection_point)==null?void 0:t.images)&&s.inspection_point.images.length>0},O=s=>T(s)&&s.inspection_point.results[0].note,z=s=>{var n,i,u;const t=s.input_type||"",a=(u=(i=(n=s.inspection_point)==null?void 0:n.results)==null?void 0:i[0])==null?void 0:u.status;return["radio","imageTOradio"].includes(t)&&a},J=s=>{const t=s.input_type||"";return["text","number","date","textarea"].includes(t)&&O(s)},W=s=>{var p,g,b,v;const t=s.input_type||"",a=s.settings||{},n=((g=(p=s.inspection_point)==null?void 0:p.results)==null?void 0:g[0])||{},u=((v=(((b=a.radios)==null?void 0:b.find(h=>h.value===n.status))||{}).settings)==null?void 0:v.show_image_upload)||!1;return(t==="image"||t==="imageTOradio"||t==="radio"&&u)&&M(s)},Q=s=>{var i,u,p,g;const t=s.settings||{},a=((u=(i=s.inspection_point)==null?void 0:i.results)==null?void 0:u[0])||{};return((g=(((p=t.radios)==null?void 0:p.find(b=>b.value===a.status))||{}).settings)==null?void 0:g.show_textarea)||!1},X=s=>{if(!s)return"status-warning";const t=s.toLowerCase();return["normal","ada","baik","good","ok"].includes(t)?"status-good":["tidak normal","tidak ada","rusak","bad","not ok"].includes(t)?"status-bad":"status-warning"},Y=s=>{var i,u;const t=s.input_type||"",a=((u=(i=s.inspection_point)==null?void 0:i.results)==null?void 0:u[0])||{},n=s.settings||{};if(t==="account"&&a.note){const p=a.note.replace(/[^\d.-]/g,""),g=parseFloat(p);if(isNaN(g))return a.note;const b=n.currency_symbol||"Rp";return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:2}).format(g).replace("Rp",b)}return a.note};return(s,t)=>{var a,n,i,u,p,g,b,v,h,K,R;return r(),o("div",st,[d.value.status==="pending_review"?(r(),o("div",ot,[e("button",{onClick:t[0]||(t[0]=_=>j.value=!0),class:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"}," Setujui Laporan "),t[2]||(t[2]=e("p",{class:"text-sm text-gray-500 mt-2 italic"}," Catatan: Halaman ini hanya simulasi dan mungkin berbeda dengan tampilan file PDF. Silakan periksa lebih detail untuk memastikan tidak ada kesalahan. Jika sudah yakin, silakan setujui untuk proses selanjutnya. ",-1))])):y("",!0),q.value?(r(),o("div",rt,[e("div",at,[e("div",nt,[F.value&&N(F.value.image_path)?(r(),o("img",{key:0,src:P(F.value.image_path),alt:"Foto Utama",class:"w-40 h-40 object-cover rounded-lg border border-gray-300"},null,8,dt)):(r(),o("div",it,t[3]||(t[3]=[e("span",null,"Gambar tidak tersedia",-1)]))),e("div",lt,[e("h2",ct,l(d.value.car_name),1)])]),d.value.car_id?(r(),o("div",ut,[e("table",gt,[e("tr",pt,[t[4]||(t[4]=e("td",{class:"p-2 border border-gray-300 font-bold w-1/3 text-gray-700"},"Nomor Polisi",-1)),e("td",yt,l(d.value.plate_number),1)]),e("tr",null,[t[5]||(t[5]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Merek",-1)),e("td",bt,l((n=(a=d.value.car)==null?void 0:a.brand)==null?void 0:n.name),1)]),e("tr",mt,[t[6]||(t[6]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Model",-1)),e("td",_t,l((u=(i=d.value.car)==null?void 0:i.model)==null?void 0:u.name),1)]),e("tr",null,[t[7]||(t[7]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Tipe",-1)),e("td",ft,l((g=(p=d.value.car)==null?void 0:p.type)==null?void 0:g.name),1)]),e("tr",vt,[t[8]||(t[8]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"CC",-1)),e("td",xt,l((b=d.value.car)==null?void 0:b.cc),1)]),e("tr",null,[t[9]||(t[9]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Bahan Bakar",-1)),e("td",ht,l((v=d.value.car)==null?void 0:v.fuel_type),1)]),e("tr",kt,[t[10]||(t[10]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Transmisi",-1)),e("td",wt,l((h=d.value.car)==null?void 0:h.transmission),1)]),e("tr",null,[t[11]||(t[11]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Periode Model",-1)),e("td",It,l(((K=d.value.car)==null?void 0:K.production_period)||"-"),1)]),e("tr",jt,[t[12]||(t[12]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Tahun Pembuatan",-1)),e("td",Dt,l((R=d.value.car)==null?void 0:R.year),1)]),e("tr",Ft,[t[13]||(t[13]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Warna",-1)),e("td",Tt,l(d.value.color),1)]),e("tr",Ct,[t[14]||(t[14]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"No Rangka",-1)),e("td",Nt,l(d.value.noka),1)]),e("tr",Pt,[t[15]||(t[15]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"No Mesin",-1)),e("td",Mt,l(d.value.nosin),1)]),e("tr",St,[t[16]||(t[16]=e("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"KM",-1)),e("td",Lt,l(d.value.km),1)])])])):y("",!0),d.value.notes?(r(),o("div",Ot,[t[17]||(t[17]=e("h3",{class:"text-lg font-bold mb-2 text-gray-800"},"Kesimpulan Inspeksi:",-1)),e("p",Kt,[e("div",{innerHTML:d.value.notes||"-"},null,8,Rt)])])):y("",!0)]),t[20]||(t[20]=e("h2",{class:"text-2xl font-bold border-b-2 border-gray-800 pb-2 mb-6"},"Hasil Inspeksi",-1)),(r(!0),o(f,null,I(U.value,_=>(r(),o("div",{key:_.component.id,class:V(["section mb-6",_.component.name==="Foto Kendaraan"?"photo-component":""])},[e("div",Bt,l(_.component.name||"Tanpa Komponen"),1),_.component.name==="Foto Kendaraan"?(r(),o("div",At,[(r(!0),o(f,null,I(_.points,c=>{var k;return r(),o("div",{key:c.id},[(r(!0),o(f,null,I((k=c.inspection_point)==null?void 0:k.images,x=>(r(),o("div",{key:x.id,class:"image-container"},[N(x.image_path)?(r(),o("img",{key:0,src:P(x.image_path),alt:"Foto Kendaraan",class:"w-28 h-28 object-cover border border-gray-300 rounded-lg"},null,8,Et)):(r(),o("div",Ht,t[18]||(t[18]=[e("span",null,"Gambar tidak ditemukan",-1)])))]))),128))])}),128))])):(r(!0),o(f,{key:1},I(_.points,c=>{var k,x,B,A,E;return r(),o("div",{key:c.id,class:"point ml-4 py-3 border-b border-gray-100"},[T(c)||M(c)?(r(),o(f,{key:0},[e("span",Vt,l(((k=c.inspection_point)==null?void 0:k.name)||"-"),1),e("div",Gt,[T(c)?(r(),o(f,{key:0},[z(c)?(r(),o("span",{key:0,class:V(["status-badge",X((x=c.inspection_point)==null?void 0:x.results[0].status)])},l((B=c.inspection_point)==null?void 0:B.results[0].status),3)):y("",!0),J(c)?(r(),o("div",Ut,l(Y(c)),1)):y("",!0)],64)):y("",!0)]),W(c)?(r(),o("div",$t,[(r(!0),o(f,null,I((A=c.inspection_point)==null?void 0:A.images,S=>(r(),o("div",{key:S.id,class:"image-container"},[N(S.image_path)?(r(),o("img",{key:0,src:P(S.image_path),alt:"image",class:"w-20 h-20 object-cover border border-gray-300 rounded-lg"},null,8,qt)):(r(),o("div",zt,t[19]||(t[19]=[e("span",null,"Gambar tidak ditemukan",-1)])))]))),128))])):y("",!0),Q(c)&&O(c)?(r(),o("div",Jt,l((E=c.inspection_point)==null?void 0:E.results[0].note),1)):y("",!0)],64)):y("",!0)])}),128))],2))),128))])):(r(),o("div",Wt,[t[21]||(t[21]=e("p",{class:"text-lg font-semibold text-gray-700"}," Data sudah tidak ada, karena sudah dijadikan PDF. ",-1)),e("a",{href:s.route("inspections.download.approved.pdf",L.encryptedIds),class:"mt-4 inline-block bg-blue-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Download PDF ",8,Qt)])),j.value?(r(),o("div",Xt,[e("div",Yt,[t[23]||(t[23]=e("h3",{class:"text-lg font-bold mb-4"},"Konfirmasi Laporan",-1)),t[24]||(t[24]=e("p",{class:"text-gray-700 mb-6"}," Apakah Anda yakin semua data sudah sesuai? Setelah disetujui, laporan akan diproses menjadi file PDF. ",-1)),e("div",Zt,[e("button",{onClick:t[1]||(t[1]=_=>j.value=!1),class:"bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400"}," Batal "),d.value.file?(r(),o("button",oe,t[22]||(t[22]=[e("span",null,"Laporan sudah di buat",-1)]))):(r(),o("button",{key:0,onClick:$,class:"bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 transition-colors duration-200",disabled:D.value},[D.value?(r(),o("span",ee,"Membuat file PDF...")):(r(),o("span",se,"Setujui Laporan"))],8,te))])])])):y("",!0)])}}},de=et(re,[["__scopeId","data-v-4a5d5248"]]);export{de as default};
