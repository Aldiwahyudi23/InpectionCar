import{g as f,m as k,G as Ce,x as Se,W as _,y as De,f as p,o as u,d as l,n as J,j as G,i as h,F as Q,k as ae,e as F,b as L,w as O,t as C,T as le,u as w,v as Me,S as Ve,z as Pe,A as Re}from"./vendor-CeYqQ7tF.js";import{l as re}from"./lodash-C5Ilt7en.js";import{V as je,C as ze,a as Ae,B as Ee,_ as Be}from"./ConclusionSection-hsoD0pem.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-BTguZwZJ.js";import"./ActionMessage-BOiCSxZ_.js";import"./InputNumber-BPVjtaZE.js";const Te={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Fe={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Le={class:"flex overflow-x-auto scrollbar-hide py-3 px-4"},Oe={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ue=["onClick"],$e={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},He={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ke={class:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1"},Ie={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},We={class:"relative overflow-hidden"},qe={key:0,class:"flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md"},Je={key:1},Ge=["disabled"],Qe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Xe={class:"space-y-4"},Ye={class:"relative"},Ze={class:"max-h-64 overflow-y-auto"},et={key:0,class:"text-center py-4 text-gray-500"},tt=["onClick"],st={class:"font-medium text-gray-900"},nt={class:"text-sm text-gray-500"},it={class:"text-xs text-gray-400 mt-1"},ot={key:0,class:"text-xs text-green-600 mt-1"},at={__name:"InspectionForm",props:{inspection:Object,inspectionId:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array},setup(m){const o=m,S=f(!1),D=f(!1),M=f(""),c=f(null),V=f(""),P=f(""),b=f(""),B=f(!1),N=f(null),ue=(e,t)=>{B.value=!0,N.value=t,_.visit(e,{onFinish:()=>{B.value=!1,N.value=null}})},X=k(()=>["vehicle",...o.appMenus.map(e=>e.id),"conclusion"]),g=f(X.value[0]),ce=f(0);Ce(g,e=>{ce.value=X.value.indexOf(e)});const U=k(()=>{if(g.value==="vehicle"||g.value==="conclusion")return null;const e=o.appMenus.find(t=>t.id===g.value);return e?{...e,points:$(e.menu_point,e.input_type==="damage")}:null}),$=(e,t)=>t?(e||[]).filter(s=>{const n=s.inspection_point_id;return ee(n)}):e||[],Y=k(()=>{o.CarDetail;const e=o.inspection;return!!e.plate_number&&!!e.car_name}),Z=k(()=>{if(!M.value.trim())return o.damagePoints||[];const e=M.value.toLowerCase().trim();return(o.damagePoints||[]).filter(t=>{var s,n,r,d,v;return((n=(s=t.inspection_point)==null?void 0:s.name)==null?void 0:n.toLowerCase().includes(e))||((d=(r=t.inspection_point)==null?void 0:r.description)==null?void 0:d.toLowerCase().includes(e))||((v=te(t))==null?void 0:v.toLowerCase().includes(e))})}),ee=e=>{const t=o.existingResults&&o.existingResults[e]!==void 0,s=o.existingImages&&o.existingImages[e]&&o.existingImages[e].length>0,n=i.results[e]&&(i.results[e].status||i.results[e].note),r=i.images[e]&&i.images[e].length>0;return t||s||n||r},te=e=>{var t,s;return((s=(t=e.inspection_point)==null?void 0:t.component)==null?void 0:s.name)||"Komponen Tidak Diketahui"},de=e=>o.existingResults[e]||null,pe=e=>{c.value=e;const t=e.inspection_point_id,s=i.results[t]||{};V.value=s.status||"",P.value=s.note||"",S.value=!1,D.value=!0},ge=e=>{c.value&&(i.images[c.value.inspection_point_id]=e)},me=()=>{if(c.value){const e=c.value.inspection_point_id;i.results[e]={...i.results[e],status:V.value,note:P.value},T(e),b.value="Data berhasil disimpan!",setTimeout(()=>b.value="",1e3)}H()},ve=()=>{S.value=!1,M.value=""},H=()=>{D.value=!1,c.value=null,V.value="",P.value=""},i=Se((()=>{const e={},t={};return[...o.appMenus.flatMap(n=>n.menu_point||[]),...o.damagePoints||[]].forEach(n=>{const r=n.inspection_point_id,d=o.existingResults[r];e[r]={status:(d==null?void 0:d.status)||"",note:(d==null?void 0:d.note)||""},t[r]=o.existingImages[r]||[]}),{inspection_id:o.inspection.id,results:e,images:t,overall_note:o.inspection.overall_note||""}})()),se=e=>e.input_type==="damage"?$(e.menu_point,!0).length>0:e.id==="conclusion"?I():$(e.menu_point,!1).every(s=>{var v,R,j,z,A,E;const n=i.results[s.inspection_point_id],r=i.images[s.inspection_point_id];if(!n)return!1;const d=K(s.settings);switch(s.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((v=n.note)!=null&&v.trim());case"select":case"radio":if(!n.status)return!1;const y=(R=d.radios)==null?void 0:R.find(a=>a.value===n.status);return!(y!=null&&y.settings&&(y.settings.show_textarea&&!((j=n.note)!=null&&j.trim())||y.settings.show_image_upload&&(r==null?void 0:r.length)===0));case"imageTOradio":if((r==null?void 0:r.length)===0||!n.status)return!1;const x=(z=d.radios)==null?void 0:z.find(a=>a.value===n.status);return!(x!=null&&x.settings&&x.settings.show_textarea&&x.settings.required&&!((A=n.note)!=null&&A.trim()));case"image":return(r==null?void 0:r.length)>0;default:return!!n.status||!!((E=n.note)!=null&&E.trim())}}),K=e=>{if(!e)return{};if(typeof e=="string")try{return JSON.parse(e)||{}}catch(t){return console.error("Error parsing settings JSON:",t),{}}return typeof e=="object"&&e!==null?e:{}},I=()=>{var v;const t=K(o.inspection.settings).conclusion||{},s=!!t.flooded,n=!!t.collision,r=t.collision==="yes"?!!t.collision_severity:!0,d=!!((v=o.inspection.notes)!=null&&v.trim());return s&&n&&r&&d},fe=k(()=>{const t=K(o.inspection.settings).conclusion||{};return{flooded:t.flooded||null,collision:t.collision||null,collision_severity:t.collision_severity||null,note:o.inspection.notes||null,isComplete:I()}}),ne=k(()=>{const e=Y.value,t=o.appMenus.every(n=>se(n)),s=I();return e&&t&&s}),W=e=>{g.value=e},T=re.debounce(async e=>{var t,s;try{await _.post(route("inspections.save-result"),{inspection_id:o.inspection.id,point_id:e,status:(t=i.results[e])==null?void 0:t.status,note:(s=i.results[e])==null?void 0:s.note,images:i.images[e]},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{_.reload({only:["existingResults","existingImages"]})}})}catch(n){console.error("Error menyimpan hasil:",n)}},500),he=({pointId:e,type:t,value:s})=>{var n;(n=i.results[e])!=null&&n.hasOwnProperty(t)&&(i.results[e][t]=s),T(e)},ie=async e=>{if(e&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await _.post(route("inspections.delete-result"),{inspection_id:o.inspection.id,point_id:e},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{i.results[e]&&delete i.results[e],i.images[e]&&delete i.images[e],b.value="Data berhasil dihapus!",setTimeout(()=>{b.value=""},2e3),_.reload({only:["existingResults","existingImages"]})},onError:t=>{console.error("Error menghapus hasil:",t)}})}catch(t){console.error("Error menghapus hasil:",t)}H()}},ye=e=>{console.log("Update vehicle:",e)},xe=e=>{console.log("Save car details:",e)},we=e=>{Object.assign(i.conclusion,e),be()},be=re.debounce(async()=>{try{await _.post(route("inspections.save-conclusion"),{inspection_id:o.inspection.id,...i.conclusion},{preserveScroll:!0,preserveState:!0})}catch(e){console.error("Error menyimpan kesimpulan:",e)}},500),ke=()=>{if(!ne.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}i.post(route("inspections.final-submit",{id:o.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:e=>{console.error("Kesalahan pengiriman:",e)}})},_e=({pointId:e,imageId:t})=>{i.images[e]&&(i.images[e]=i.images[e].filter(s=>s.id!==t),T(e))};return De(()=>{}),(e,t)=>{var s,n,r,d,v,R,j,z,A,E,y,x;return u(),p("div",Te,[l("div",Fe,[l("div",Le,[l("button",{onClick:t[0]||(t[0]=a=>W("vehicle")),class:J(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!=="vehicle"}])},[t[7]||(t[7]=G(" Detail Kendaraan ")),Y.value?(u(),p("span",Oe," ✓ ")):h("",!0)],2),(u(!0),p(Q,null,ae(m.appMenus,a=>(u(),p("button",{key:a.id,onClick:q=>W(a.id),class:J(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value===a.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!==a.id}])},[G(C(a.name)+" ",1),se(a)?(u(),p("span",$e," ✓ ")):h("",!0)],10,Ue))),128)),l("button",{onClick:t[1]||(t[1]=a=>W("conclusion")),class:J(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!=="conclusion"}])},[t[8]||(t[8]=G(" Kesimpulan ")),fe.value.isComplete?(u(),p("span",He," ✓ ")):h("",!0)],2)])]),l("div",Ke,[F(le,{name:"fade"},{default:O(()=>[b.value?(u(),p("div",Ie,C(b.value),1)):h("",!0)]),_:1}),l("div",We,[F(le,{name:"category-slide",mode:"out-in"},{default:O(()=>[g.value==="vehicle"?(u(),L(je,{key:0,inspection:m.inspection,CarDetail:m.CarDetail,onUpdateVehicle:ye,onSaveCarDetails:xe},null,8,["inspection","CarDetail"])):U.value&&g.value!=="conclusion"?(u(),L(ze,{key:U.value.id,category:U.value,"inspection-id":m.inspection.id,form:w(i),onSaveResult:w(T),onUpdateResult:he,onHapusPoint:ie,onRemoveImage:_e},null,8,["category","inspection-id","form","onSaveResult"])):g.value==="conclusion"?(u(),L(Ae,{key:2,form:w(i),"inspection-id":m.inspection.id,inspection:m.inspection,settings:m.inspection.settings||{},onUpdateConclusion:we},null,8,["form","inspection-id","inspection","settings"])):h("",!0)]),_:1})]),g.value==="conclusion"?(u(),p("div",qe,[F(w(Ve),{href:e.route("inspections.pending",m.inspectionId),as:"button",type:"button",disabled:B.value&&N.value==="pending",onClick:t[2]||(t[2]=Me(a=>ue(e.route("inspections.pending",m.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:O(()=>[B.value&&N.value==="pending"?(u(),p(Q,{key:0},[t[9]||(t[9]=l("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 \r
             5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 \r
             5.824 3 7.938l3-2.647z`})],-1)),t[10]||(t[10]=l("span",null,"Memproses...",-1))],64)):(u(),p("span",Je,"Tunda"))]),_:1},8,["href","disabled"]),l("button",{type:"button",onClick:ke,disabled:!ne.value||w(i).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[w(i).processing?(u(),p("svg",Qe,t[11]||(t[11]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 \r
           5.373 0 12h4zm2 5.291A7.962 7.962 0 \r
           014 12H0c0 3.042 1.135 5.824 3 \r
           7.938l3-2.647z`},null,-1)]))):h("",!0),l("span",null,C(w(i).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Ge)])):h("",!0),!S.value&&!D.value?(u(),p("button",{key:1,onClick:t[3]||(t[3]=a=>S.value=!0),class:"fixed bottom-4 right-4 z-10 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},t[12]||(t[12]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):h("",!0),F(Ee,{show:S.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:ve},{default:O(()=>[l("div",Xe,[l("div",Ye,[Pe(l("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>M.value=a),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Re,M.value]]),t[13]||(t[13]=l("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[l("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),l("div",Ze,[Z.value.length===0?(u(),p("div",et," Tidak ada point yang ditemukan ")):h("",!0),(u(!0),p(Q,null,ae(Z.value,a=>{var q,oe;return u(),p("button",{key:a.id,onClick:rt=>pe(a),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[l("div",st,C((q=a.inspection_point)==null?void 0:q.name),1),l("div",nt,C((oe=a.inspection_point)==null?void 0:oe.description),1),l("div",it,C(te(a)),1),ee(a.inspection_point_id)?(u(),p("div",ot," ✓ Sudah ada data ")):h("",!0)],8,tt)}),128))])])]),_:1},8,["show"]),D.value?(u(),L(Be,{key:(s=c.value)==null?void 0:s.id,show:D.value,title:((r=(n=c.value)==null?void 0:n.inspection_point)==null?void 0:r.name)||"Detail Point",subtitle:(v=(d=c.value)==null?void 0:d.inspection_point)==null?void 0:v.description,name:`point-${(R=c.value)==null?void 0:R.id}`,"inspection-id":m.inspection.id,"point-id":(j=c.value)==null?void 0:j.inspection_point_id,settings:((z=c.value)==null?void 0:z.settings)||{},options:((E=(A=c.value)==null?void 0:A.settings)==null?void 0:E.radios)||[],"selected-Point":c.value,"selected-value":V.value,"images-value":w(i).images[(y=c.value)==null?void 0:y.inspection_point_id],"notes-value":P.value,point:c.value,"existing-data":de((x=c.value)==null?void 0:x.inspection_point_id),"onUpdate:selectedValue":t[5]||(t[5]=a=>V.value=a),"onUpdate:notesValue":t[6]||(t[6]=a=>P.value=a),"onUpdate:imagesValue":ge,onSave:me,onClose:H,onHapus:ie},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):h("",!0)])])}}},ft=Ne(at,[["__scopeId","data-v-e24f1d2a"]]);export{ft as default};
