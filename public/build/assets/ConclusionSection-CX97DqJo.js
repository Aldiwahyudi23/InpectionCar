import{x as et,g as T,y as ke,E as $e,m as J,G as le,f as i,o as a,d as t,i as b,e as ie,z as re,A as ce,u as Q,F as se,k as oe,t as F,j as ae,v as he,w as ve,n as P,L as pe,a as Ze,b as te,r as Ke,T as tt,l as st,D as we,W as ot,M as be,B as at}from"./vendor-CeYqQ7tF.js";import{l as xe}from"./lodash-C5Ilt7en.js";import{_ as nt}from"./PrimaryButton-BTguZwZJ.js";import{_ as it}from"./ActionMessage-BOiCSxZ_.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ge}from"./InputNumber-BPVjtaZE.js";const lt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},rt={key:0,class:"p-4 space-y-2"},dt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ut={class:"flex items-center space-x-2"},ct={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},gt={class:"relative"},mt={key:0,class:"absolute right-3 top-3"},pt={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},vt={key:0},ft=["onMousedown"],ht={class:"font-medium text-gray-900"},wt={class:"text-sm text-gray-500"},bt={key:1,class:"p-4 text-sm text-gray-500 text-center"},xt={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},yt={key:0,class:"mb-4"},kt=["innerHTML"],$t={key:1},Vt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},It=["onClick"],Ct=["src","alt"],St={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Mt={class:"text-white text-xs text-center"},_t={key:2,class:"text-center py-4 text-gray-500 text-sm"},Ut={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Tt=["src","alt"],Nt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},qt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},jt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Rt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(e,{emit:z}){var r,k,v,R;const s=e,I=z,h=et({plate_number:((r=s.inspection)==null?void 0:r.plate_number)||"",car_id:((k=s.inspection)==null?void 0:k.car_id)||null,car_name:((R=(v=s.inspection)==null?void 0:v.car)==null?void 0:R.name)||""}),c=T(""),u=T(""),d=T(""),l=T(h.car_name),U=T(!1),$=T(!1),C=T([]),x=T(null),S=T([]),o=T(!1),M=T(0);ke(()=>{var n,g,V,m,B;if(L((n=s.inspection)==null?void 0:n.plate_number),(g=s.inspection)!=null&&g.car_id&&((V=s.CarDetail)==null?void 0:V.length)>0){const H=s.CarDetail.find(W=>W.id===s.inspection.car_id);H&&D(H)}else!((m=s.inspection)!=null&&m.car_id)&&((B=s.inspection)!=null&&B.car_name)&&(l.value=s.inspection.car_name);window.addEventListener("keydown",ee)}),$e(()=>{window.removeEventListener("keydown",ee)});const L=n=>{if(!n){c.value="",u.value="",d.value="";return}const g=n.toUpperCase().trim(),V=g.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(V)c.value=V[1]||"",u.value=V[2]||"",d.value=V[3]||"";else{let m="area",B="",H="",W="";for(const X of g)m==="area"&&/[A-Z]/.test(X)?B+=X:m==="area"&&/[0-9]/.test(X)?(m="number",H+=X):m==="number"&&/[0-9]/.test(X)?H+=X:m==="number"&&/[A-Z]/.test(X)?(m="suffix",W+=X):m==="suffix"&&/[A-Z]/.test(X)&&(W+=X);c.value=B,u.value=H,d.value=W}A()},A=()=>{const n=`${c.value}${u.value}${d.value}`;h.plate_number=n,ne()},y=n=>{n==="area"?c.value=c.value.toUpperCase().replace(/[^A-Z]/g,""):n==="number"?u.value=u.value.replace(/[^0-9]/g,""):n==="suffix"&&(d.value=d.value.toUpperCase().replace(/[^A-Z]/g,"")),A()},f=n=>{var V,m,B;if(!n)return"";const g=[];return(V=n.brand)!=null&&V.name&&g.push(n.brand.name),(m=n.model)!=null&&m.name&&g.push(n.model.name),(B=n.type)!=null&&B.name&&g.push(n.type.name),n.cc&&g.push(`${n.cc}cc`),n.transmission&&g.push(n.transmission),n.fuel_type&&g.push(n.fuel_type),n.year&&g.push(n.year.toString()),n.production_period&&g.push(`(${n.production_period})`),g.join(" ")},_=xe.debounce(()=>{if(!l.value.trim()){C.value=[],U.value=!1;return}$.value=!0;try{const n=l.value.toLowerCase().trim();C.value=s.CarDetail.filter(g=>f(g).toLowerCase().includes(n)),U.value=!0}finally{$.value=!1}},300),w=()=>{setTimeout(()=>{U.value=!1},200)},D=async n=>{x.value=n,l.value=f(n),h.car_id=n.id,h.car_name=f(n),U.value=!1,await Z(n.id),ne()},E=n=>!n||!n.file_path?"":`/storage/${n.file_path}`,Z=async n=>{try{const g=await fetch(`/api/cars/${n}/images`);if(g.ok){const V=await g.json();S.value=Array.isArray(V)?V:[]}else S.value=[]}catch(g){console.error("Error loading car images:",g),S.value=[]}},K=n=>{M.value=n,o.value=!0,document.body.style.overflow="hidden"},G=()=>{o.value=!1,document.body.style.overflow=""},O=()=>{M.value=(M.value+1)%S.value.length},Y=()=>{M.value=(M.value-1+S.value.length)%S.value.length},ee=n=>{if(o.value)switch(n.key){case"Escape":G();break;case"ArrowRight":O();break;case"ArrowLeft":Y();break}},ne=()=>{const n={plate_number:h.plate_number,car_id:h.car_id,car_name:h.car_name};I("update-vehicle",n)},q=()=>{s.inspection&&h.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0})},j=J(()=>!!h.plate_number&&!!h.car_name);return le(()=>s.inspection,n=>{var g;if(n)if(L(n.plate_number),h.car_id=n.car_id||null,n.car_id&&((g=s.CarDetail)==null?void 0:g.length)>0){const V=s.CarDetail.find(m=>m.id===n.car_id);V&&D(V)}else n.car_name&&(l.value=n.car_name,h.car_name=n.car_name)},{deep:!0}),(n,g)=>{var V;return a(),i("div",lt,[g[22]||(g[22]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),e.inspection?(a(),i("div",rt,[t("div",dt,[g[11]||(g[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",ut,[re(t("input",{"onUpdate:modelValue":g[0]||(g[0]=m=>c.value=m),type:"text",placeholder:"Contoh: B",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[1]||(g[1]=m=>y("area")),maxlength:"2"},null,544),[[ce,c.value]]),re(t("input",{"onUpdate:modelValue":g[2]||(g[2]=m=>u.value=m),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[3]||(g[3]=m=>y("number")),maxlength:"4"},null,544),[[ce,u.value]]),re(t("input",{"onUpdate:modelValue":g[4]||(g[4]=m=>d.value=m),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[5]||(g[5]=m=>y("suffix")),maxlength:"3"},null,544),[[ce,d.value]])])]),t("div",ct,[g[14]||(g[14]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",gt,[re(t("input",{"onUpdate:modelValue":g[6]||(g[6]=m=>l.value=m),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:g[7]||(g[7]=(...m)=>Q(_)&&Q(_)(...m)),onFocus:g[8]||(g[8]=m=>U.value=!0),onBlur:w},null,544),[[ce,l.value]]),$.value?(a(),i("div",mt,g[12]||(g[12]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):b("",!0),U.value?(a(),i("div",pt,[C.value.length>0?(a(),i("div",vt,[(a(!0),i(se,null,oe(C.value,m=>(a(),i("div",{key:m.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:B=>D(m)},[t("div",ht,F(f(m)),1),t("div",wt,F(m.year)+" • "+F(m.cc)+"cc • "+F(m.transmission)+" • "+F(m.fuel_type),1)],40,ft))),128))])):(a(),i("div",bt,g[13]||(g[13]=[ae(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),ae(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):b("",!0)]),re(t("input",{type:"hidden","onUpdate:modelValue":g[9]||(g[9]=m=>Q(h).car_id=m)},null,512),[[ce,Q(h).car_id]])]),Q(h).car_id&&x.value?(a(),i("div",xt,[x.value.description?(a(),i("div",yt,[g[15]||(g[15]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:x.value.description},null,8,kt)])):b("",!0),S.value.length>0?(a(),i("div",$t,[g[16]||(g[16]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",Vt,[(a(!0),i(se,null,oe(S.value,(m,B)=>(a(),i("div",{key:m.id||B,class:"relative group cursor-pointer",onClick:H=>K(B)},[t("img",{src:E(m),alt:m.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ct),m.note?(a(),i("div",St,[t("p",Mt,F(m.note),1)])):b("",!0)],8,It))),128))])])):(a(),i("div",_t," Tidak ada gambar tersedia untuk mobil ini "))])):b("",!0),o.value?(a(),i("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:G},[t("div",Ut,[t("button",{onClick:G,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},g[17]||(g[17]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),S.value.length>1?(a(),i("button",{key:0,onClick:he(Y,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},g[18]||(g[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):b("",!0),S.value.length>1?(a(),i("button",{key:1,onClick:he(O,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},g[19]||(g[19]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):b("",!0),t("img",{src:E(S.value[M.value]),alt:"Car Image "+(M.value+1),class:"max-w-full max-h-full object-contain",onClick:g[10]||(g[10]=he(()=>{},["stop"]))},null,8,Tt),S.value.length>1?(a(),i("div",Nt,F(M.value+1)+" / "+F(S.value.length),1)):b("",!0),(V=S.value[M.value])!=null&&V.note?(a(),i("div",qt,F(S.value[M.value].note),1)):b("",!0)])])):b("",!0),ie(nt,{type:"button",onClick:q,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!j.value},{default:ve(()=>[Q(h).processing?(a(),i("svg",jt,g[20]||(g[20]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):b("",!0),t("span",null,F(Q(h).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),ie(it,{on:Q(h).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:ve(()=>g[21]||(g[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ae(" Tersimpan. ")])),_:1,__:[21]},8,["on"])]),_:1},8,["disabled"])])):b("",!0)])}}},Ta=ue(Rt,[["__scopeId","data-v-a54fbcbd"]]),Bt={class:"mt-1"},Lt=["value","required","minlength","maxlength","allowSpace","placeholder"],Dt={key:0,class:"mt-2 text-sm text-red-600"},Xe={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,I=z,h=J(()=>{if(!s.modelValue)return"";let u=s.modelValue;switch(s.allowSpace||(u=u.replace(/\s+/g,"")),s.textTransform){case"uppercase":return u.toUpperCase();case"lowercase":return u.toLowerCase();case"capitalize":return u.replace(/\b\w/g,d=>d.toUpperCase());default:return u}}),c=u=>{let d=u.target.value;switch(s.allowSpace||(d=d.replace(/\s+/g,"")),s.textTransform){case"uppercase":d=d.toUpperCase();break;case"lowercase":d=d.toLowerCase();break;case"capitalize":d=d.replace(/\b\w/g,l=>l.toUpperCase());break}I("update:modelValue",d),I("save",s.pointId)};return(u,d)=>(a(),i("div",Bt,[t("input",{value:h.value,onInput:c,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,allowSpace:e.allowSpace,placeholder:e.placeholder,class:P(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:e.textTransform==="uppercase",lowercase:e.textTransform==="lowercase",capitalize:e.textTransform==="capitalize"}])},null,42,Lt),e.error?(a(),i("p",Dt,F(e.error),1)):b("",!0)]))}},At={class:"mt-1"},Ft=["value","required","min","max"],zt={key:0,class:"mt-2 text-sm text-red-600"},Ye={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,I=z,h=c=>{I("update:modelValue",c.target.value),I("save",s.pointId)};return(c,u)=>(a(),i("div",At,[t("input",{value:e.modelValue,onChange:h,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ft),e.error?(a(),i("p",zt,F(e.error),1)):b("",!0)]))}},Et={class:"mt-1"},Ht=["value","required","placeholder"],Ot={key:0,class:"mt-2 text-sm text-red-600"},Je={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,I=z,h=T(""),c=J(()=>{var $,C,x,S;return{currency_symbol:(($=s.settings)==null?void 0:$.currency_symbol)||"Rp",thousands_separator:((C=s.settings)==null?void 0:C.thousands_separator)||",",min_value:((x=s.settings)==null?void 0:x.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((S=s.settings)==null?void 0:S.max_value)!==void 0?Number(s.settings.max_value):1e9}}),u=$=>{if($==null||$==="")return"";const C=Number($);if(isNaN(C))return"";let x=C.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return c.value.thousands_separator!==","&&(x=x.replace(/,/g,c.value.thousands_separator)),x},d=$=>$?$.replace(/[^\d]/g,""):"",l=J(()=>h.value?`${c.value.currency_symbol} ${u(h.value)}`:""),U=$=>{let C=d($.target.value),x=Number(C);c.value.min_value!==void 0&&x<c.value.min_value&&(C=c.value.min_value.toString()),c.value.max_value!==void 0&&x>c.value.max_value&&(C=c.value.max_value.toString()),h.value=C,I("update:modelValue",C),I("save",s.pointId)};return le(()=>s.modelValue,$=>{$!=null&&(h.value=$.toString())},{immediate:!0}),($,C)=>(a(),i("div",Et,[t("input",{value:l.value,onInput:U,type:"text",required:e.required,placeholder:e.placeholder,class:P(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,Ht),e.error?(a(),i("p",Ot,F(e.error),1)):b("",!0)]))}},Wt={class:"mt-1 space-y-3"},Zt={key:0,class:"space-y-2"},Kt={class:"flex flex-wrap gap-2"},Gt=["onClick"],Xt=["value","required","minlength","maxlength","placeholder"],Yt={class:"flex justify-between items-center mt-1"},Jt={class:"text-xs text-gray-500"},Qt={key:0,class:"text-xs text-red-600"},Qe={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,I=z,h=T([]),c=T(""),u=$=>h.value.some(C=>C.value===$),d=$=>{u($.value)?h.value=h.value.filter(o=>o.value!==$.value):h.value.push($);const x=[...h.value.map(o=>o.value)];c.value.trim()&&x.push(c.value.trim());const S=x.join(", ");I("update:modelValue",S),I("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:S})},l=$=>{const C=$.target.value;I("update:modelValue",C),I("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:C}),U(C)},U=$=>{var o,M,L,A;if(!$){h.value=[],c.value="";return}const C=$.split(",").map(y=>y.trim()).filter(y=>y),x=((M=(o=s.settings)==null?void 0:o.damage_options)==null?void 0:M.map(y=>y.value))||[];h.value=((A=(L=s.settings)==null?void 0:L.damage_options)==null?void 0:A.filter(y=>C.includes(y.value)))||[];const S=C.filter(y=>!x.includes(y));c.value=S.join(", ")};return le(()=>s.modelValue,$=>{$!=null&&U($)},{immediate:!0}),($,C)=>{var x,S,o;return a(),i("div",Wt,[(x=e.settings)!=null&&x.enable_damage&&((S=e.settings)!=null&&S.damage_options)?(a(),i("div",Zt,[C[0]||(C[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",Kt,[(a(!0),i(se,null,oe(e.settings.damage_options,(M,L)=>(a(),i("button",{key:L,type:"button",onClick:A=>d(M),class:P(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":u(M.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!u(M.value)}])},F(M.label),11,Gt))),128))])])):b("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:l,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Xt),t("div",Yt,[t("span",Jt,F(((o=e.modelValue)==null?void 0:o.length)||0)+"/"+F(e.maxLength||400),1),e.error?(a(),i("p",Qt,F(e.error),1)):b("",!0)])])])}}},Pt={class:"mt-1"},es=["value","required"],ts={key:0,class:"mt-2 text-sm text-red-600"},ss={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,I=z,h=c=>{I("update:modelValue",c.target.value),I("save",s.pointId)};return(c,u)=>(a(),i("div",Pt,[t("select",{value:e.modelValue,onChange:h,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},u[0]||(u[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,es),e.error?(a(),i("p",ts,F(e.error),1)):b("",!0)]))}},os=ue(ss,[["__scopeId","data-v-c34a74db"]]),as={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},ns={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},is={class:"flex flex-row space-x-4 mb-6"},ls={class:"mt-4 text-right"},rs={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(z,s)=>e.show?(a(),i("div",as,[t("div",ns,[s[5]||(s[5]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),t("div",is,[t("button",{onClick:s[0]||(s[0]=I=>z.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[3]||(s[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:s[1]||(s[1]=I=>z.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[4]||(s[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",ls,[t("button",{onClick:s[2]||(s[2]=I=>z.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):b("",!0)}},ds={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},us={class:"webcam-content-box"},cs={class:"webcam-header"},gs={class:"inspection-point-name"},ms={key:0,class:"screen-flash-overlay"},ps={key:2,class:"zoom-controls"},vs=["max"],fs={class:"webcam-footer"},hs={class:"camera-controls"},ws=["disabled"],bs={class:"camera-icon-container"},xs={key:0,class:"camera-spinner"},ys={key:1,class:"camera-body"},ks={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(e,{emit:z}){const s=e,I=z,h=T(null),c=T(null);let u=null,d=null;const l=T("environment"),U=T(!1),$=T(!1),C=T(!1),x=T(!1),S=T(!1),o=T({}),M=T(!1),L=T(1),A=T(1),y=T(!1),f=J(()=>{var q;return((q=s.settings)==null?void 0:q.max_size)||2048}),_=J(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),w=J(()=>{if(!s.aspectRatio)return{};const q=s.aspectRatio,j=q>1?80:60,r=q>1?80/q:60*q;return{width:`${j}%`,height:`${r}%`}}),D=async()=>{u&&u.getTracks().forEach(q=>q.stop());try{const q={facingMode:l.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};u=await navigator.mediaDevices.getUserMedia({video:q,audio:!1}),d=u.getVideoTracks()[0],h.value.srcObject=u,h.value.onloadedmetadata=async()=>{await Z(),await h.value.play()}}catch(q){console.error("Error accessing camera: ",q),alert("Failed to access camera. Please allow camera permission."),I("close")}},E=()=>{u&&u.getTracks().forEach(q=>q.stop()),I("close")},Z=async()=>{if(d)try{const q=await navigator.mediaDevices.enumerateDevices();U.value=q.filter(r=>r.kind==="videoinput").length>1;const j=d.getCapabilities();j.zoom?(y.value=!0,A.value=j.zoom.max,console.log(`Zoom supported. Max zoom: ${A.value}`)):(y.value=!1,console.warn("Zoom is not supported by this camera.")),$.value=j.torch||j.fillLightMode&&j.fillLightMode.includes("torch")}catch(q){console.error("Error checking camera capabilities:",q)}},K=async q=>{if(!d)return;const j=h.value.getBoundingClientRect(),r=q.clientX-j.left,k=q.clientY-j.top;S.value=!0,o.value={left:`${r}px`,top:`${k}px`,transform:"translate(-50%, -50%)"};try{if(d.getCapabilities().pointsOfInterest){const R=r/j.width,n=k/j.height;await d.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:R,y:n}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(v){console.warn("Manual focus failed:",v)}setTimeout(()=>{S.value=!1,d.getCapabilities().focusMode.includes("continuous")&&d.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},G=async q=>{if(!d||!y.value)return;const j=Math.min(Math.max(q,1),A.value);L.value=j;try{await d.applyConstraints({advanced:[{zoom:j}]})}catch(r){console.error("Failed to set zoom:",r)}},O=async()=>{if(!(!d||!$.value))try{l.value==="user"?(C.value=!C.value,x.value=C.value):(await d.applyConstraints({advanced:[{torch:!C.value}]}),C.value=!C.value)}catch(q){console.error("Flash toggle failed:",q)}},Y=async()=>{U.value&&(l.value=l.value==="environment"?"user":"environment",u&&u.getTracks().forEach(q=>q.stop()),await D())},ee=async q=>new Promise(j=>{const r=f.value*1024;if(q.size<=r){j(q);return}const k=new Image,v=new FileReader;v.onload=R=>{k.onload=()=>{const n=document.createElement("canvas"),g=n.getContext("2d"),V=Math.sqrt(r/q.size);n.width=k.width*V,n.height=k.height*V,g.drawImage(k,0,0,n.width,n.height);let m=.9;const B=()=>{n.toBlob(H=>{H.size>r&&m>.1?(m-=.1,B()):j(H)},"image/jpeg",m)};B()},k.src=R.target.result},v.readAsDataURL(q)}),ne=async()=>{if(!(M.value||!h.value||!c.value)){M.value=!0;try{const q=h.value,j=c.value,r=q.videoWidth,k=q.videoHeight;let v,R,n,g;r/k>s.aspectRatio?(R=k,v=k*s.aspectRatio,n=(r-v)/2,g=0):(v=r,R=r/s.aspectRatio,n=0,g=(k-R)/2),j.width=v,j.height=R,j.getContext("2d").drawImage(q,n,g,v,R,0,0,v,R);const m=await new Promise(H=>{j.toBlob(H,"image/jpeg",1)}),B=await ee(m);if(B){const H=new File([B],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});I("photoCaptured",H),x.value=!0,setTimeout(()=>{x.value=!1},100)}}catch(q){console.error("Error capturing photo:",q),alert("Failed to capture photo. Please try again.")}finally{M.value=!1}}};return le(()=>s.show,q=>{q?D():E()}),$e(()=>{u&&u.getTracks().forEach(q=>q.stop())}),(q,j)=>{var r;return e.show?(a(),i("div",ds,[t("div",us,[t("div",cs,[t("div",gs,F(((r=e.point)==null?void 0:r.name)||"Camera"),1),t("button",{onClick:E,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},j[2]||(j[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:pe(_.value),onClick:K,onTouchstart:K},[t("video",{ref_key:"webcamVideo",ref:h,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:c,class:"hidden"},null,512),x.value?(a(),i("div",ms)):b("",!0),t("div",{class:"aspect-ratio-guide",style:pe(w.value)},null,4),S.value?(a(),i("div",{key:1,class:"focus-indicator",style:pe(o.value)},j[3]||(j[3]=[t("div",{class:"focus-ring"},null,-1)]),4)):b("",!0),j[4]||(j[4]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),y.value?(a(),i("div",ps,[re(t("input",{type:"range",min:"1",max:A.value,step:"0.1","onUpdate:modelValue":j[0]||(j[0]=k=>L.value=k),onInput:j[1]||(j[1]=k=>G(parseFloat(k.target.value))),class:"zoom-slider"},null,40,vs),[[ce,L.value]])])):b("",!0)],36),t("div",fs,[t("div",hs,[e.settings.enable_flash&&$.value?(a(),i("button",{key:0,onClick:O,class:P(["control-button",{active:C.value,disabled:!$.value}])},j[5]||(j[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):b("",!0),t("button",{onClick:ne,class:"capture-button",disabled:M.value},[t("div",bs,[M.value?(a(),i("div",xs)):(a(),i("div",ys,j[6]||(j[6]=[t("div",{class:"camera-lens"},null,-1),t("div",{class:"camera-flash"},null,-1)])))])],8,ws),e.settings.enable_camera_switch&&U.value?(a(),i("button",{key:1,onClick:Y,class:"control-button"},j[7]||(j[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):b("",!0)])])])])):b("",!0)}}},$s=ue(ks,[["__scopeId","data-v-a032b4ac"]]),Vs={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Is={class:"w-full h-full flex flex-col"},Cs={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Ss={class:"text-lg font-semibold"},Ms={class:"flex items-center gap-2"},_s={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Us=["src"],Ts={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Ns={class:"flex justify-between items-center w-full"},qs=["disabled"],js={key:1,class:"flex-1"},Rs=["disabled"],Bs={class:"flex gap-3 w-full"},Ls=["disabled"],Ds={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},As={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(e,{emit:z}){const s=e,I=z,h=T(0),c=T([]),u=T(0),d=T(0),l=J(()=>c.value.length>0?c.value[h.value]:null);le(()=>s.images,_=>{c.value=_.map(w=>({...w,rotation:w.rotation||0})),_.length===0&&s.show&&A()},{deep:!0,immediate:!0}),le(()=>s.show,_=>{_&&s.images.length>0&&(h.value=s.initialIndex)});const U=_=>_.preview||(_.image_path?`/${_.image_path}`:""),$=()=>{if(l.value){const _=(l.value.rotation+90)%360;c.value[h.value].rotation=_,I("update:images",c.value)}},C=()=>{h.value=h.value<c.value.length-1?h.value+1:0},x=()=>{h.value=h.value>0?h.value-1:c.value.length-1},S=_=>{u.value=_.touches[0].clientX},o=_=>{d.value=_.touches[0].clientX},M=()=>{u.value-d.value>50?C():d.value-u.value>50&&x(),u.value=0,d.value=0},L=()=>{s.isUploading||I("saveImages",c.value)},A=()=>{s.isUploading||I("close")},y=()=>{if(l.value&&!s.isUploading){const _=l.value,w=c.value.findIndex(D=>D.isNew&&_.isNew&&D.preview===_.preview||!D.isNew&&!_.isNew&&D.id===_.id);w!==-1&&(I("removePreviewImage",_),c.value.splice(w,1),I("update:images",c.value)),h.value>=c.value.length&&(h.value=Math.max(0,c.value.length-1)),c.value.length===0&&I("close")}},f=()=>{s.isUploading||I("triggerAddMorePhotos")};return(_,w)=>{var D;return e.show?(a(),i("div",Vs,[t("div",Is,[t("div",Cs,[t("button",{onClick:A,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},w[0]||(w[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",Ss,F(((D=e.point)==null?void 0:D.name)||"Preview")+" ("+F(h.value+1)+"/"+F(c.value.length)+") ",1),t("div",Ms,[l.value&&l.value.isNew?(a(),i("button",{key:0,onClick:y,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},w[1]||(w[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):b("",!0),l.value&&l.value.isNew?(a(),i("button",{key:1,onClick:$,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},w[2]||(w[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))):b("",!0)])]),t("div",_s,[t("div",{class:"relative w-full max-w-full",style:pe({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"}),onTouchstart:S,onTouchmove:o,onTouchend:M},[l.value?(a(),i("img",{key:0,src:U(l.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:pe({transform:`rotate(${l.value.rotation}deg)`})},null,12,Us)):b("",!0)],36),c.value.length>1?(a(),i("button",{key:0,onClick:x,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},w[3]||(w[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):b("",!0),c.value.length>1?(a(),i("button",{key:1,onClick:C,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},w[4]||(w[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):b("",!0)]),t("div",Ts,[t("div",Ns,[l.value&&!l.value.isNew?(a(),i("button",{key:0,onClick:y,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:e.isUploading},w[5]||(w[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ae(" Hapus Foto ")]),8,qs)):(a(),i("div",js)),e.allowMultiple&&c.value.length<e.maxFiles?(a(),i("button",{key:2,onClick:f,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:e.isUploading},w[6]||(w[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ae(" Tambah Foto ")]),8,Rs)):b("",!0)]),t("div",Bs,[t("button",{onClick:A,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:e.isUploading}," Batal ",8,Ls),e.isUploading?(a(),i("button",Ds,w[7]||(w[7]=[ae(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(a(),i("button",{key:0,onClick:L,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):b("",!0)}}},Fs=ue(As,[["__scopeId","data-v-ec0018df"]]),zs=["accept","multiple","disabled"],Es=["disabled"],Hs={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Os={class:"text-xs text-gray-400 mt-1"},Ws={key:0,class:"flex items-center gap-4"},Zs=["src"],Ks=["disabled"],Gs={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Xs=["disabled"],Ys=["onClick"],Js=["src"],Qs={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Ps={key:0},eo={key:1,class:"ml-1"},to={key:2,class:"mt-1 text-xs text-red-600"},so={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:z}){const s=e,I=z,h=T(null),c=T(null),u=T(!1),d=T(!1),l=T(!1),U=T([]),$=T(0),C=T(!1),x=J(()=>Number(s.settings.max_files)>1),S=J(()=>s.settings.allowed_types.map(r=>`.${r}`).join(", ")),o=J(()=>{const r=s.settings.camera_aspect_ratio.split(":");if(r.length===2){const k=parseFloat(r[0]),v=parseFloat(r[1]);if(!isNaN(k)&&!isNaN(v)&&v!==0)return k/v}return 3/4}),M=J(()=>{const r=[],k=new Set;for(const v of U.value)v.id&&k.add(v.id),r.push(v);for(const v of s.modelValue)k.has(v.id)||r.push({...v,rotation:v.rotation||0,isNew:!1,preview:v.preview||(v.image_path?`/${v.image_path}`:null)});return r}),L=r=>r.preview||(r.image_path?`/${r.image_path}`:""),A=()=>{l.value&&(l.value=!1),u.value=!0},y=()=>{u.value=!1,h.value.click()},f=()=>{u.value=!1,d.value=!0},_=()=>{u.value=!1,M.value.length>0&&(l.value=!0)},w=()=>{d.value=!1,M.value.length>0&&(l.value=!0)},D=()=>{l.value=!1,U.value.forEach(r=>{r.preview&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview)}),U.value=[]},E=r=>new Promise(k=>{const v=new FileReader;v.onload=R=>{const n=new Image;n.onload=()=>{k({file:r,preview:URL.createObjectURL(r),rotation:0,width:n.naturalWidth,height:n.naturalHeight,isNew:!0})},n.onerror=()=>{console.error("Failed to load image for dimensions:",r.name),k({file:r,preview:URL.createObjectURL(r),rotation:0,width:0,height:0,isNew:!0})},n.src=R.target.result},v.readAsDataURL(r)}),Z=r=>{const k=r.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(k)},K=async r=>{const v=(s.settings.max_size||2048)*1024;return new Promise(R=>{const n=new Image,g=new FileReader;g.onload=V=>{n.onload=()=>{const m=document.createElement("canvas"),B=m.getContext("2d"),H=Math.max(n.width,n.height);m.width=H,m.height=H,B.fillStyle="white",B.fillRect(0,0,H,H);const W=(H-n.width)/2,X=(H-n.height)/2;B.drawImage(n,W,X,n.width,n.height);let de=.9;const ge=()=>{m.toBlob(me=>{if(me.size>v&&de>.1)de-=.1,ge();else{const fe=new File([me],r.name,{type:"image/jpeg",lastModified:Date.now()});R(fe)}},"image/jpeg",de)};ge()},n.src=V.target.result},g.readAsDataURL(r)})},G=async r=>{const k=Array.from(r.target.files);if(!k.length){u.value=!1,M.value.length>0&&(l.value=!0);return}try{const v=k.filter(B=>!Z(B));if(v.length>0){const B=v.map(H=>H.name.split(".").pop()).join(", ");alert(`File type not allowed: ${B}. Allowed types: ${s.settings.allowed_types.join(", ")}`),r.target.value="";return}const R=M.value.length,n=s.settings.max_files-R,g=await Promise.all(k.slice(0,n).map(async B=>await K(B))),V=await Promise.all(g.map(E)),m=x.value?V:V.slice(0,1);x.value?U.value.push(...m):(U.value.forEach(B=>{B.preview&&B.preview.startsWith("blob:")&&URL.revokeObjectURL(B.preview)}),U.value=m),u.value=!1,m.length>0?($.value=Math.max(0,M.value.length-m.length),l.value=!0):M.value.length>0&&(l.value=!0),r.target.value=""}catch(v){console.error("Error processing selected images:",v),alert("Failed to process selected images. Please try again."),u.value=!1,M.value.length>0&&(l.value=!0)}},O=async r=>{const k=M.value.length;if(!x.value||k<s.settings.max_files)try{const v=await K(r),R=new Image;R.onload=()=>{const n={file:v,preview:URL.createObjectURL(v),rotation:0,width:R.naturalWidth,height:R.naturalHeight,isNew:!0};x.value?U.value.push(n):(U.value.forEach(g=>{g.preview&&g.preview.startsWith("blob:")&&URL.revokeObjectURL(g.preview)}),U.value=[n]),d.value=!1,u.value=!1,$.value=M.value.length-1,l.value=!0},R.src=URL.createObjectURL(v)}catch(v){console.error("Error processing captured image:",v),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),d.value=!1,u.value=!1,M.value.length>0&&(l.value=!0)},Y=(r=0)=>{$.value=r,l.value=!0},ee=r=>new Promise(k=>{if(r.rotation===0||!c.value){if(!r.isNew&&!r.file){k({file:null,width:r.width,height:r.height,isOriginal:!0});return}k({file:r.file,width:r.width,height:r.height});return}const v=new Image;v.onload=async()=>{try{const R=c.value,n=R.getContext("2d"),g=v.width,V=v.height;let m,B;r.rotation===90||r.rotation===270?(m=V,B=g):(m=g,B=V),R.width=m,R.height=B,n.clearRect(0,0,R.width,R.height),n.translate(R.width/2,R.height/2),n.rotate(r.rotation*Math.PI/180),n.drawImage(v,-g/2,-V/2,g,V),n.setTransform(1,0,0,1,0,0);const H=await new Promise(de=>{R.toBlob(de,"image/jpeg",.9)}),W=new File([H],r.file?r.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),X=await K(W);k({file:X,width:m,height:B})}catch(R){console.error("Error processing rotated image:",R),k({file:r.file,width:r.width,height:r.height})}},v.onerror=()=>{console.error("Failed to load image for rotation processing:",r.preview),k({file:r.file,width:r.width,height:r.height})},v.src=r.preview}),ne=async r=>{var R,n,g,V;C.value=!0;const k=[],v=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),C.value=!1;return}try{for(const m of r){if(!m.isNew&&m.rotation===0&&m.id&&m.image_path){k.push({id:m.id,image_path:m.image_path,width:m.width,height:m.height,rotation:0,preview:m.preview});continue}const{file:B,width:H,height:W,isOriginal:X}=await ee(m);if(X&&!m.isNew){k.push({id:m.id,image_path:m.image_path,width:m.width,height:m.height,rotation:0,preview:m.preview});continue}B&&v.push({file:B,width:H,height:W,rotation:0})}if(v.length>0){const m=new FormData;m.append("inspection_id",s.inspectionId),m.append("point_id",s.pointId),v.forEach(W=>{m.append("images[]",W.file)});const H=(await Ze.post(route("inspections.upload-image"),m,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const W of H)k.push({id:W.image_id,image_path:W.path,width:W.width||0,height:W.height||0,rotation:W.rotation||0,preview:W.public_url});v.forEach(W=>{W.file&&W.file.preview&&W.file.preview.startsWith("blob:")&&URL.revokeObjectURL(W.file.preview)})}I("update:modelValue",k),I("save",s.pointId),I("uploaded",{pointId:s.pointId,images:k}),D()}catch(m){if(console.error("Error during image processing/upload:",m),(n=(R=m.response)==null?void 0:R.data)!=null&&n.message)alert(`Failed to save images: ${m.response.data.message}`);else if((V=(g=m.response)==null?void 0:g.data)!=null&&V.errors){const B=Object.values(m.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${B}`)}else alert(`Failed to save images: ${m.message}`)}finally{C.value=!1}},q=r=>{if(r){if(r.id&&!r.isNew)j(r);else{const k=U.value.findIndex(v=>v.preview&&v.preview===r.preview&&v.isNew||v.id&&v.id===r.id);if(k!==-1){const v=U.value.splice(k,1)[0];v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}I("update:modelValue",s.modelValue.filter(v=>!(v.id&&v.id===r.id)&&!(v.preview&&v.preview===r.preview)))}$.value>=M.value.length&&($.value=Math.max(0,M.value.length-1)),M.value.length===0&&D()}},j=async r=>{var v,R;if(r.id||r.image_path)try{await Ze.delete(route("inspections.delete-image"),{data:{image_id:r.id,image_path:r.image_path}})}catch(n){console.error("Error deleting image from server:",n),(R=(v=n.response)==null?void 0:v.data)!=null&&R.message?alert(`Failed to delete image from server: ${n.response.data.message}`):alert(`Failed to delete image from server: ${n.message}`);return}r.preview&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview);const k=s.modelValue.filter(n=>n.id!==r.id);I("update:modelValue",k),U.value=U.value.filter(n=>n.isNew&&r.isNew?n.preview!==r.preview:n.id!==r.id),I("removeImage",{image:r}),l.value&&M.value.length===0?D():l.value&&$.value>=M.value.length&&($.value=Math.max(0,M.value.length-1))};return(r,k)=>(a(),i("div",null,[t("input",{ref_key:"galleryInput",ref:h,type:"file",accept:S.value,class:"hidden",onChange:G,multiple:x.value,disabled:C.value},null,40,zs),t("canvas",{ref_key:"processingCanvas",ref:c,class:"hidden"},null,512),M.value.length===0?(a(),i("label",{key:0,onClick:A,class:P(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:C.value},[t("div",Hs,[k[2]||(k[2]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),k[3]||(k[3]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),k[4]||(k[4]=t("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),t("p",Os,"Allowed types: "+F(S.value),1)])],8,Es)):(a(),i("div",{key:1,class:P(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":e.settings.max_files==1,"bg-transparent":e.settings.max_files>1}]),"aria-label":"Image gallery"},[e.settings.max_files===1?(a(),i("div",Ws,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:k[0]||(k[0]=v=>Y(0))},[t("img",{src:L(M.value[0]),class:"w-full h-full object-cover"},null,8,Zs)]),t("button",{onClick:k[1]||(k[1]=he(v=>j(M.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:C.value},k[5]||(k[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ae(" Hapus Foto ")]),8,Ks)])):(a(),i("div",Gs,[x.value&&M.value.length<e.settings.max_files?(a(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:A,disabled:C.value},k[6]||(k[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Xs)):b("",!0),(a(!0),i(se,null,oe(M.value,(v,R)=>(a(),i("div",{key:v.id||v.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:n=>Y(R)},[t("img",{src:L(v),class:"w-full h-full object-cover"},null,8,Js),v.isNew||v.rotation!==0?(a(),i("div",Qs,[v.isNew?(a(),i("span",Ps,"BARU")):b("",!0),v.rotation!==0?(a(),i("span",eo,"ROTASI")):b("",!0)])):b("",!0)],8,Ys))),128))]))],2)),e.error?(a(),i("p",to,F(e.error),1)):b("",!0),ie(rs,{show:u.value,onClose:_,onOpenWebcam:f,onTriggerGallery:y},null,8,["show"]),ie($s,{show:d.value,"aspect-ratio":o.value,settings:e.settings,point:e.point,onClose:w,onPhotoCaptured:O},null,8,["show","aspect-ratio","settings","point"]),ie(Fs,{show:l.value,images:M.value,point:e.point,"initial-index":$.value,"allow-multiple":x.value,"max-files":e.settings.max_files,"is-uploading":C.value,"aspect-ratio":o.value,onClose:D,onSaveImages:ne,onRemovePreviewImage:q,onTriggerAddMorePhotos:A},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},ye=ue(so,[["__scopeId","data-v-396cd9aa"]]),oo={key:0,class:"fixed inset-0 z-50 overflow-hidden"},ao={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},no={class:"px-4 pb-2 border-b border-gray-200"},io={class:"text-lg font-semibold text-gray-900"},lo={key:0,class:"text-sm text-gray-500 mt-1"},ro={class:"flex-1 overflow-y-auto p-4"},uo={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},co={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:z}){const s=z,I=()=>{s("close")},h=c=>{c.key==="Escape"&&I()};return ke(()=>{document.addEventListener("keydown",h)}),$e(()=>{document.removeEventListener("keydown",h)}),(c,u)=>(a(),te(tt,{name:"bottom-sheet"},{default:ve(()=>[e.show?(a(),i("div",oo,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:I}),t("div",ao,[u[0]||(u[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",no,[t("h3",io,F(e.title),1),e.subtitle?(a(),i("p",lo,F(e.subtitle),1)):b("",!0)]),t("div",ro,[Ke(c.$slots,"default",{},void 0,!0)]),c.$slots.footer?(a(),i("div",uo,[Ke(c.$slots,"footer",{},void 0,!0)])):b("",!0)])])):b("",!0)]),_:3}))}},go=ue(co,[["__scopeId","data-v-7893c2dc"]]),mo={class:"space-y-4"},po={key:0,class:"mt-2"},vo={key:1,class:"mt-2"},fo={key:2,class:"mt-2"},ho={key:3,class:"mt-2"},wo={key:4,class:"mt-2"},bo={class:"text-sm font-medium text-gray-700 mb-2"},xo={key:0,class:"text-red-500"},yo={key:0,class:"text-xs text-red-500"},ko=["name","value","checked"],$o={key:6,class:"space-y-2"},Vo={key:0,class:"text-red-500"},Io={key:1,class:"text-xs text-red-500"},Co={key:7,class:"mt-4"},So={class:"text-sm font-medium text-gray-700 mb-2"},Mo={key:0,class:"text-red-500"},_o={key:0,class:"text-xs text-red-500"},Uo={class:"flex gap-2"},To=["disabled"],Pe={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(e,{emit:z}){const s=e,I=z,h=d=>I("hapus",d),c=J(()=>s.options.find(d=>d.value===s.selectedValue)),u=J(()=>{var l,U,$,C,x,S,o;if(s.point.input_type==="text"&&(!((l=s.notesValue)!=null&&l.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((U=s.notesValue)!=null&&U.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!(($=s.notesValue)!=null&&$.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!((C=s.notesValue)!=null&&C.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date)||s.point.input_type==="imageTOradio"&&s.imagesValue.length===0||s.options.length&&!s.selectedValue)return!1;const d=c.value;return!(s.showTextarea&&((x=d==null?void 0:d.settings)!=null&&x.show_textarea)&&(!((S=s.notesValue)!=null&&S.trim())||d.settings.min_length&&s.notesValue.length<d.settings.min_length||d.settings.max_length&&s.notesValue.length>d.settings.max_length)||s.showImageUpload&&((o=d==null?void 0:d.settings)!=null&&o.show_image_upload)&&(s.imagesValue.length===0||d.settings.max_files&&s.imagesValue.length>d.settings.max_files))});return(d,l)=>(a(),te(go,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:l[18]||(l[18]=U=>d.$emit("close"))},{footer:ve(()=>[e.selectedPoint?(a(),i("button",{key:0,onClick:l[15]||(l[15]=U=>h(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},l[20]||(l[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ae(" Hapus Data ")]))):b("",!0),t("div",Uo,[t("button",{type:"button",onClick:l[16]||(l[16]=U=>d.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:l[17]||(l[17]=U=>d.$emit("save")),disabled:!u.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,To)])]),default:ve(()=>{var U,$,C,x,S,o,M,L,A,y,f,_,w,D,E,Z,K,G,O,Y,ee,ne,q,j,r,k,v,R,n,g;return[t("div",mo,[e.point.input_type==="text"?(a(),i("div",po,[ie(Xe,{"model-value":e.notesValue,required:(U=e.point.settings)==null?void 0:U.is_required,"min-length":($=e.point.settings)==null?void 0:$.min_length,"max-length":(C=e.point.settings)==null?void 0:C.max_length,allowSpace:(x=e.point.settings)==null?void 0:x.allow_space,textTransform:(S=e.point.settings)==null?void 0:S.text_transform,placeholder:((o=e.point.settings)==null?void 0:o.placeholder)||"Masukan text",error:d.error,"onUpdate:modelValue":l[0]||(l[0]=V=>d.$emit("update:notesValue",V)),onSave:l[1]||(l[1]=V=>d.$emit("saveText",V))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):b("",!0),e.point.input_type==="number"?(a(),i("div",vo,[ie(Ge,{"model-value":e.notesValue,required:(M=e.point.settings)==null?void 0:M.is_required,min:(L=e.point.settings)==null?void 0:L.min,max:(A=e.point.settings)==null?void 0:A.max,step:((y=e.point.settings)==null?void 0:y.step)||1,placeholder:((f=e.point.settings)==null?void 0:f.placeholder)||"Masukan number",error:d.error,"onUpdate:modelValue":l[2]||(l[2]=V=>d.$emit("update:notesValue",V)),onSave:l[3]||(l[3]=V=>d.$emit("saveNumber",V))},null,8,["model-value","required","min","max","step","placeholder","error"])])):b("",!0),e.point.input_type==="account"?(a(),i("div",fo,[ie(Je,{"model-value":e.notesValue,required:(_=e.point.settings)==null?void 0:_.is_required,placeholder:((w=e.point.settings)==null?void 0:w.placeholder)||"Masukkan nilai",error:d.error,"point-id":e.pointId,settings:e.point.settings,"onUpdate:modelValue":l[4]||(l[4]=V=>d.$emit("update:notesValue",V)),onSave:l[5]||(l[5]=V=>d.$emit("saveAccount",V))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):b("",!0),e.point.input_type==="date"?(a(),i("div",ho,[ie(Ye,{"model-value":e.notesValue,required:(D=e.point.settings)==null?void 0:D.is_required,"min-date":(E=e.point.settings)==null?void 0:E.min_date,"max-date":(Z=e.point.settings)==null?void 0:Z.max_date,error:d.error,"onUpdate:modelValue":l[6]||(l[6]=V=>d.$emit("update:notesValue",V)),onSave:l[7]||(l[7]=V=>d.$emit("saveDate",V))},null,8,["model-value","required","min-date","max-date","error"])])):b("",!0),e.point.input_type==="imageTOradio"?(a(),i("div",wo,[t("h4",bo,[(K=e.point.settings)!=null&&K.required?(a(),i("span",xo,"*")):b("",!0)]),ie(ye,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point.inspection_point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":l[8]||(l[8]=V=>d.$emit("update:imagesValue",V)),onSave:l[9]||(l[9]=V=>d.$emit("saveImage",V))},null,8,["model-value","point-id","point","inspection-id","settings"]),(G=e.point.settings)!=null&&G.required&&e.imagesValue.length===0?(a(),i("p",yo," Foto wajib diupload ")):b("",!0)])):b("",!0),e.options.length?(a(),i("div",{key:5,class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),i(se,null,oe(e.options,(V,m)=>(a(),i("label",{key:m,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:V.value,checked:e.selectedValue===V.value,onChange:l[10]||(l[10]=B=>d.$emit("update:selectedValue",B.target.value)),class:"hidden peer"},null,40,ko),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===V.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==V.value}])},F(V.label),3)]))),128))],2)):b("",!0),e.showTextarea&&((Y=(O=c.value)==null?void 0:O.settings)!=null&&Y.show_textarea)?(a(),i("div",$o,[(ee=c.value.settings)!=null&&ee.required?(a(),i("span",Vo,"*")):b("",!0),ie(Qe,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:c.value.settings,required:(ne=c.value.settings)==null?void 0:ne.required,"min-length":(q=c.value.settings)==null?void 0:q.min_length,"max-length":(j=c.value.settings)==null?void 0:j.max_length,placeholder:((r=c.value.settings)==null?void 0:r.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":l[11]||(l[11]=V=>d.$emit("update:notesValue",V)),onSave:l[12]||(l[12]=V=>d.$emit("saveTextarea",V))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(k=c.value.settings)!=null&&k.required&&!e.notesValue?(a(),i("p",Io," Keterangan wajib diisi ")):b("",!0)])):b("",!0),e.showImageUpload&&((R=(v=c.value)==null?void 0:v.settings)!=null&&R.show_image_upload)?(a(),i("div",Co,[t("h4",So,[l[19]||(l[19]=ae(" Upload Foto ")),(n=c.value.settings)!=null&&n.required?(a(),i("span",Mo,"*")):b("",!0)]),ie(ye,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:c.value.settings,"onUpdate:modelValue":l[13]||(l[13]=V=>d.$emit("update:imagesValue",V)),onSave:l[14]||(l[14]=V=>d.$emit("saveImage",V))},null,8,["model-value","point-id","point","inspection-id","settings"]),(g=c.value.settings)!=null&&g.required&&e.imagesValue.length===0?(a(),i("p",_o," Foto wajib diupload ")):b("",!0)])):b("",!0)])]}),_:1},8,["show","title","subtitle"]))}},No={class:"mt-2 space-y-2"},qo=["name","value","checked","onChange","required"],jo={key:0,class:"p-2 rounded-lg bg-gray-50"},Ro={key:0,class:"mt-2"},Bo={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Lo=["src"],Do={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Ao={key:1,class:"mt-2"},Fo={class:"text-sm text-gray-600"},zo={key:2,class:"mt-2 text-sm text-red-600"},Eo={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:z}){const s=e,I=z,h=T(s.notes),c=T([...s.images]),u=T(!1),d=T(""),l=T([]),U=T(""),$=T([]),C=J(()=>s.options.find(w=>w.value===s.modelValue)),x=w=>w.settings&&(w.settings.show_textarea||w.settings.show_image_upload);le(()=>s.notes,w=>{h.value=w}),le(()=>s.images,w=>{c.value=[...w]}),le(()=>s.modelValue,w=>{w&&(U.value=w)});const S=w=>{I("update:modelValue",w.value),x(w)?M():I("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:w.value,notes:"",images:[]})},o=w=>w.preview||(w.image_path?`/${w.image_path}`:w),M=()=>{U.value=s.modelValue,d.value=h.value,l.value=[...c.value],$.value=[...c.value],u.value=!0},L=()=>{d.value="",l.value=[],U.value="",u.value=!1},A=w=>{l.value=w,c.value=[...w],I("update:images",[...w]),I("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:h.value,images:[...w]})},y=w=>{},f=()=>{U.value!==s.modelValue&&I("update:modelValue",U.value),h.value=d.value,I("update:notes",d.value),c.value=[...l.value],I("update:images",[...l.value]),I("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:U.value,notes:d.value,images:l.value}),u.value=!1},_=w=>{I("hapus",w),u.value=!1};return(w,D)=>{var E,Z,K,G;return a(),i("div",No,[t("div",{class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),i(se,null,oe(e.options,(O,Y)=>(a(),i("label",{key:Y,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:O.value,checked:e.modelValue===O.value,onChange:ee=>S(O),class:"hidden peer",required:e.required},null,40,qo),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===O.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==O.value}])},F(O.label),3)]))),128))],2),e.modelValue&&C.value&&x(C.value)?(a(),i("div",jo,[t("div",{class:"flex justify-between items-start"},[D[4]||(D[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:M,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((E=C.value.settings)!=null&&E.show_image_upload)?(a(),i("div",Ro,[t("div",Bo,[(a(!0),i(se,null,oe(e.images,(O,Y)=>(a(),i("div",{key:Y,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:o(O),class:"w-full h-full object-cover rounded"},null,8,Lo),Y===3&&e.images.length>4?(a(),i("span",Do," +"+F(e.images.length-4),1)):b("",!0)]))),128))])])):b("",!0),e.notes&&((Z=C.value.settings)!=null&&Z.show_textarea)?(a(),i("div",Ao,[t("p",Fo,F(e.notes),1)])):b("",!0)])):b("",!0),u.value?(a(),te(Pe,{key:(K=e.selectedPoint)==null?void 0:K.id,show:u.value,title:e.pointName||"Detail",subtitle:(G=C.value)==null?void 0:G.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":U.value,"notes-value":d.value,"images-value":l.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":D[0]||(D[0]=O=>U.value=O),"onUpdate:notesValue":D[1]||(D[1]=O=>d.value=O),"onUpdate:imagesValue":D[2]||(D[2]=O=>A(O)),onClose:L,onSave:f,onSaveTextarea:w.handleTextareaSave,onSaveImage:y,onHapus:D[3]||(D[3]=O=>_(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):b("",!0),e.error?(a(),i("p",zo,F(e.error),1)):b("",!0)])}}},Ho={class:"mt-2 space-y-2"},Oo={key:0,class:"flex flex-wrap gap-3"},Wo={key:1,class:"p-2"},Zo={key:0,class:"mt-2"},Ko={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Go=["src"],Xo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Yo=["name","value","checked"],Jo={key:1,class:"mt-2"},Qo={class:"text-sm text-gray-600"},Po={key:3,class:"mt-2 text-sm text-red-600"},ea={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:z}){const s=e,I=z,h=T(s.notes),c=T([...s.images]),u=T(!1),d=T(""),l=T([]),U=T(""),$=T([]),C=J(()=>s.options.find(y=>y.value===s.modelValue)),x=y=>y.preview||(y.image_path?`/${y.image_path}`:y);le(()=>s.notes,y=>{h.value=y});const S=()=>{U.value=s.modelValue||"",d.value=h.value,l.value=[...c.value],$.value=[...c.value],u.value=!0},o=()=>{d.value="",l.value=[],U.value="",u.value=!1},M=y=>{l.value=y,c.value=[...y],I("update:images",[...y]),I("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:h.value,images:[...y]})},L=()=>{U.value!==s.modelValue&&I("update:modelValue",U.value),h.value=d.value,I("update:notes",d.value),c.value=[...l.value],I("update:images",[...l.value]),I("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:U.value,notes:d.value,images:l.value}),u.value=!1},A=y=>{I("hapus",y),u.value=!1};return(y,f)=>{var _,w,D;return a(),i("div",Ho,[!e.modelValue&&c.value.length===0&&!h.value?(a(),i("div",Oo,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:S},f[4]||(f[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(a(),i("div",Wo,[t("div",{class:"flex justify-between items-start"},[f[5]||(f[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:S,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),c.value.length>0?(a(),i("div",Zo,[t("div",Ko,[(a(!0),i(se,null,oe(c.value,(E,Z)=>(a(),i("div",{key:Z,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:x(E),class:"w-full h-full object-cover rounded"},null,8,Go),Z===3&&c.value.length>4?(a(),i("span",Xo," +"+F(c.value.length-4),1)):b("",!0)]))),128))])])):b("",!0),t("div",{class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),i(se,null,oe(e.options,(E,Z)=>(a(),i("label",{key:Z,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:E.value,checked:e.modelValue===E.value,disabled:!0,class:"hidden peer"},null,8,Yo),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===E.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==E.value}])},F(E.label),3)]))),128))],2),h.value&&((_=C.value.settings)!=null&&_.show_textarea)?(a(),i("div",Jo,[t("p",Qo,F(h.value),1)])):b("",!0)])),u.value?(a(),te(Pe,{key:(w=e.selectedPoint)==null?void 0:w.id,show:u.value,title:e.pointName||"Detail",subtitle:(D=C.value)==null?void 0:D.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":U.value,"notes-value":d.value,"images-value":l.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":f[0]||(f[0]=E=>U.value=E),"onUpdate:notesValue":f[1]||(f[1]=E=>d.value=E),"onUpdate:imagesValue":f[2]||(f[2]=E=>M(E)),onClose:o,onSave:L,onHapus:f[3]||(f[3]=E=>A(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):b("",!0),e.error?(a(),i("p",Po,F(e.error),1)):b("",!0)])}}},ta={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},sa={class:"bg-indigo-200 px-6 py-2 border-b"},oa={class:"text-xl font-semibold text-indigo-700"},aa={class:"p-4 space-y-4"},na={class:"flex items-start justify-between"},ia={class:"block text-sm font-medium text-gray-700"},la={key:0,class:"text-red-500"},ra={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},da={key:0,class:"text-center py-8 text-gray-500"},ua={key:0,class:"text-xs text-gray-400"},ca={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(e,{emit:z}){const s=e,I=z,h=st(),c=J(()=>{var S;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(S=s.category.points)==null?void 0:S.length}),!s.category.isDamageMenu)return console.log("Menu biasa - tampilkan semua points"),s.category.points||[];const x=(s.category.points||[]).filter(o=>{var A,y;const M=(A=o.inspection_point)==null?void 0:A.id,L=u(M);return console.log(`Point ${M} (${(y=o.inspection_point)==null?void 0:y.name}): hasData = ${L}`),L});return console.log("Filtered damage points:",x),x}),u=x=>{if(!x)return console.log("hasPointData: pointId is null/undefined"),!1;const S=h.props.existingResults[x]!==void 0,o=h.props.existingImages[x]&&h.props.existingImages[x].length>0,M=s.form.results[x]&&(s.form.results[x].status||s.form.results[x].note),L=s.form.images[x]&&s.form.images[x].length>0,A=S||o||M||L;return console.log(`Point ${x} data check:`,{hasServerResult:S,hasServerImages:o,hasLocalResult:M,hasLocalImages:L,finalResult:A}),A},d=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],l=x=>{var M,L,A,y,f,_,w,D,E;const S=s.form.results[(M=x.inspection_point)==null?void 0:M.id],o=s.form.images[(L=x.inspection_point)==null?void 0:L.id];if(!S)return!1;switch(x.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!S.note;case"select":case"radio":if(!S.status)return!1;const Z=(y=(A=x.settings)==null?void 0:A.radios)==null?void 0:y.find(G=>G.value===S.status);return!(Z!=null&&Z.settings&&(Z.settings.show_textarea&&!((f=S.note)!=null&&f.trim())||Z.settings.show_image_upload&&(o==null?void 0:o.length)===0));case"imageTOradio":if((o==null?void 0:o.length)===0||!S.status)return!1;const K=(w=(_=x.settings)==null?void 0:_.radios)==null?void 0:w.find(G=>G.value===S.status);return!(K!=null&&K.settings&&K.settings.show_textarea&&!((D=S.note)!=null&&D.trim()));case"image":return(o==null?void 0:o.length)>0;default:return!!S.status||!!((E=S.note)!=null&&E.trim())}},U=(x,S,o)=>{I("updateResult",{pointId:x,type:o,value:S})},$=x=>{I("saveResult",x)},C=x=>{I("hapusPoint",x)};return(x,S)=>(a(),i("div",ta,[t("div",sa,[t("h3",oa,F(e.category.name),1)]),t("div",aa,[(a(!0),i(se,null,oe(c.value,o=>{var M,L,A,y,f,_,w,D,E,Z,K,G,O,Y,ee,ne,q,j,r,k,v,R,n,g,V,m,B,H,W,X,de,ge,me,fe,Ve,Ie,Ce,Se,Me,_e,Ue,Te,Ne,qe,je,Re,Be,Le,De,Ae,Fe,ze,Ee,He,Oe,We;return a(),i("div",{key:o.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",na,[t("label",ia,[ae(F((M=o.inspection_point)==null?void 0:M.name)+" ",1),(L=o.settings)!=null&&L.is_required?(a(),i("span",la,"*")):b("",!0)]),l(o)?(a(),i("span",ra," ✓ ")):b("",!0)]),o.input_type==="text"?(a(),te(Xe,{key:0,modelValue:e.form.results[(A=o.inspection_point)==null?void 0:A.id].note,"onUpdate:modelValue":[N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=N},N=>{var p;return U((p=o.inspection_point)==null?void 0:p.id,N,"note")}],required:(y=o.settings)==null?void 0:y.is_required,"min-length":(f=o.settings)==null?void 0:f.min_length,"max-length":(_=o.settings)==null?void 0:_.max_length,allowSpace:(w=o.settings)==null?void 0:w.allow_space,textTransform:(D=o.settings)==null?void 0:D.text_transform,placeholder:((E=o.settings)==null?void 0:E.placeholder)||"Masukan text",error:e.form.errors[`results.${(Z=o.inspection_point)==null?void 0:Z.id}.note`],onSave:N=>{var p;return $((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):b("",!0),o.input_type==="number"?(a(),te(Ge,{key:1,modelValue:e.form.results[(K=o.inspection_point)==null?void 0:K.id].note,"onUpdate:modelValue":[N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=N},N=>{var p;return U((p=o.inspection_point)==null?void 0:p.id,N,"note")}],required:(G=o.settings)==null?void 0:G.is_required,min:(O=o.settings)==null?void 0:O.min,max:(Y=o.settings)==null?void 0:Y.max,step:((ee=o.settings)==null?void 0:ee.step)||1,placeholder:((ne=o.settings)==null?void 0:ne.placeholder)||"Masukan number",error:e.form.errors[`results.${(q=o.inspection_point)==null?void 0:q.id}.note`],onSave:N=>{var p;return $((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):b("",!0),o.input_type==="account"?(a(),te(Je,{key:2,modelValue:e.form.results[(j=o.inspection_point)==null?void 0:j.id].note,"onUpdate:modelValue":[N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=N},N=>{var p;return U((p=o.inspection_point)==null?void 0:p.id,N,"note")}],required:(r=o.settings)==null?void 0:r.is_required,placeholder:((k=o.settings)==null?void 0:k.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${(v=o.inspection_point)==null?void 0:v.id}.note`],"point-id":(R=o.inspection_point)==null?void 0:R.id,settings:o.settings,onSave:N=>{var p;return $((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):b("",!0),o.input_type==="date"?(a(),te(Ye,{key:3,modelValue:e.form.results[(n=o.inspection_point)==null?void 0:n.id].note,"onUpdate:modelValue":[N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=N},N=>{var p;return U((p=o.inspection_point)==null?void 0:p.id,N,"note")}],required:(g=o.settings)==null?void 0:g.is_required,"min-date":(V=o.settings)==null?void 0:V.min_date,"max-date":(m=o.settings)==null?void 0:m.max_date,error:e.form.errors[`results.${(B=o.inspection_point)==null?void 0:B.id}.note`],onSave:N=>{var p;return $((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):b("",!0),o.input_type==="textarea"?(a(),te(Qe,{key:4,modelValue:e.form.results[(H=o.inspection_point)==null?void 0:H.id].note,"onUpdate:modelValue":[N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=N},N=>{var p;return U((p=o.inspection_point)==null?void 0:p.id,N,"note")}],required:(W=o.settings)==null?void 0:W.is_required,"min-length":(X=o.settings)==null?void 0:X.min_length,"max-length":(de=o.settings)==null?void 0:de.max_length,placeholder:((ge=o.settings)==null?void 0:ge.placeholder)||"Masukkan teks di sini",settings:o.settings,error:e.form.errors[`results.${(me=o.inspection_point)==null?void 0:me.id}.note`],onSave:N=>{var p;return $((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):b("",!0),o.input_type==="radio"?(a(),te(Eo,{key:5,modelValue:e.form.results[(fe=o.inspection_point)==null?void 0:fe.id].status,"onUpdate:modelValue":[N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].status=N},N=>{var p;return U((p=o.inspection_point)==null?void 0:p.id,N,"status")}],notes:e.form.results[(Ve=o.inspection_point)==null?void 0:Ve.id].note,images:e.form.images[(Ie=o.inspection_point)==null?void 0:Ie.id],required:(Ce=o.settings)==null?void 0:Ce.is_required,"point-id":(Se=o.inspection_point)==null?void 0:Se.id,point:o.inspection_point,"inspection-id":e.inspectionId,settings:o.settings,"point-name":(Me=o.inspection_point)==null?void 0:Me.name,"selected-point":o.input_type==="damage"?o.inspection_point:null,options:((_e=o.settings)==null?void 0:_e.radios)||d,error:e.form.errors[`results.${(Ue=o.inspection_point)==null?void 0:Ue.id}.status`],"onUpdate:notes":N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=N},"onUpdate:images":N=>{var p;return e.form.images[(p=o.inspection_point)==null?void 0:p.id]=N},onSave:N=>{var p;return $((p=o.inspection_point)==null?void 0:p.id)},onHapus:N=>{var p;return C((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):b("",!0),o.input_type==="imageTOradio"?(a(),te(ea,{key:6,modelValue:e.form.results[(Te=o.inspection_point)==null?void 0:Te.id].status,"onUpdate:modelValue":[N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].status=N},N=>{var p;return U((p=o.inspection_point)==null?void 0:p.id,N,"status")}],notes:e.form.results[(Ne=o.inspection_point)==null?void 0:Ne.id].note,images:e.form.images[(qe=o.inspection_point)==null?void 0:qe.id],required:(je=o.settings)==null?void 0:je.is_required,"point-id":(Re=o.inspection_point)==null?void 0:Re.id,"inspection-id":e.inspectionId,settings:o.settings,"point-name":(Be=o.inspection_point)==null?void 0:Be.name,point:o,"selected-point":o.input_type==="damage"?o.inspection_point:null,options:((Le=o.settings)==null?void 0:Le.radios)||d,error:e.form.errors[`results.${(De=o.inspection_point)==null?void 0:De.id}.status`],"onUpdate:notes":N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=N},"onUpdate:images":N=>{var p;return e.form.images[(p=o.inspection_point)==null?void 0:p.id]=N},onSave:N=>{var p;return $((p=o.inspection_point)==null?void 0:p.id)},onHapus:N=>{var p;return C((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):b("",!0),o.input_type==="image"?(a(),te(ye,{key:7,modelValue:e.form.images[(Ae=o.inspection_point)==null?void 0:Ae.id],"onUpdate:modelValue":N=>{var p;return e.form.images[(p=o.inspection_point)==null?void 0:p.id]=N},error:e.form.errors[`images.${(Fe=o.inspection_point)==null?void 0:Fe.id}`],"inspection-id":e.inspectionId,"point-id":(ze=o.inspection_point)==null?void 0:ze.id,point:o.inspection_point,"point-name":(Ee=o.inspection_point)==null?void 0:Ee.name,settings:o.settings,"onUpdate:notes":N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=N},"onUpdate:status":N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].status=N}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):b("",!0),o.input_type==="select"?(a(),te(os,{key:8,modelValue:e.form.results[(He=o.inspection_point)==null?void 0:He.id].status,"onUpdate:modelValue":[N=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].status=N},N=>{var p;return U((p=o.inspection_point)==null?void 0:p.id,N,"status")}],required:(Oe=o.settings)==null?void 0:Oe.is_required,error:e.form.errors[`results.${(We=o.inspection_point)==null?void 0:We.id}.status`],onSave:N=>{var p;return $((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):b("",!0)])}),128)),c.value.length===0?(a(),i("div",da,[S[0]||(S[0]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),S[1]||(S[1]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),e.category.isDamageMenu?(a(),i("p",ua,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):b("",!0)])):b("",!0)])]))}},Na=ue(ca,[["__scopeId","data-v-cdbefdf5"]]),ga={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ma={class:"p-4 space-y-4-6"},pa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},va=["value"],fa={class:"p-4 space-y-4-6"},ha={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},wa=["value"],ba={key:0,class:"p-4 space-y-4"},xa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ya=["value"],ka={class:"p-4 space-y-2"},$a={class:"flex gap-1 mb-2 p-2 bg-gray-100 rounded-md"},Va={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const z=e,s=T(null),I=T(!1),h=y=>{if(!y)return{};if(typeof y=="string")try{return JSON.parse(y)||{}}catch(f){return console.error("Error parsing settings JSON:",f),{}}return typeof y=="object"&&y!==null?y:{}},c=J(()=>h(z.inspection.settings).conclusion||{}),u=T({flooded:c.value.flooded||"",collision:c.value.collision||"",collision_severity:c.value.collision_severity||"",conclusion_note:z.inspection.notes||""}),d=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],l=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],U=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];ke(()=>{A(),we(()=>{$()})});const $=()=>{s.value&&u.value.conclusion_note&&(s.value.innerHTML=u.value.conclusion_note)},C=xe.debounce(()=>{if(s.value){const y=window.getSelection();y.rangeCount>0&&y.getRangeAt(0),u.value.conclusion_note=s.value.innerHTML,L()}},500),x=y=>{y.preventDefault(),document.execCommand("insertParagraph",!1,null)},S=y=>{y.preventDefault();const f=(y.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,f)},o=y=>{if(!s.value)return;s.value.focus();const f=window.getSelection();switch(f.rangeCount>0&&f.getRangeAt(0),y){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"underline":document.execCommand("underline",!1,null);break}C()},M=()=>{I.value=!1,s.value&&(u.value.conclusion_note=s.value.innerHTML,L())},L=xe.debounce(()=>{const y={flooded:u.value.flooded,collision:u.value.collision,collision_severity:u.value.collision==="yes"?u.value.collision_severity:null,conclusion_note:u.value.conclusion_note};ot.post(route("inspections.updateConclusion",z.inspectionId),y,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{we(()=>{if(s.value){const f=document.createRange(),_=window.getSelection();f.selectNodeContents(s.value),f.collapse(!1),_.removeAllRanges(),_.addRange(f)}})},onError:f=>{console.error("Error saving conclusion:",f)}})},500);le([()=>u.value.flooded,()=>u.value.collision,()=>u.value.collision_severity],()=>{L()});const A=()=>{const f=h(z.inspection.settings).conclusion||{};u.value={flooded:f.flooded||"",collision:f.collision||"",collision_severity:f.collision_severity||"",conclusion_note:z.inspection.notes||""}};return le(()=>z.inspection,()=>{A(),we(()=>{$()})},{deep:!0}),(y,f)=>(a(),i("div",ga,[f[18]||(f[18]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),t("div",ma,[f[11]||(f[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ae(" Apakah kendaraan pernah terkena banjir? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",pa,[(a(),i(se,null,oe(d,_=>t("label",{key:_.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":f[0]||(f[0]=w=>u.value.flooded=w),value:_.value,class:"hidden peer",onChange:f[1]||(f[1]=(...w)=>Q(L)&&Q(L)(...w))},null,40,va),[[be,u.value.flooded]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":u.value.flooded===_.value,"border-gray-300 text-gray-700 hover:bg-gray-50":u.value.flooded!==_.value}])},F(_.label),3)])),64))])]),t("div",fa,[f[13]||(f[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ae(" Apakah kendaraan pernah mengalami tabrakan? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ha,[(a(),i(se,null,oe(l,_=>t("label",{key:_.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":f[2]||(f[2]=w=>u.value.collision=w),value:_.value,class:"hidden peer",onChange:f[3]||(f[3]=(...w)=>Q(L)&&Q(L)(...w))},null,40,wa),[[be,u.value.collision]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":u.value.collision===_.value,"border-gray-300 text-gray-700 hover:bg-gray-50":u.value.collision!==_.value}])},F(_.label),3)])),64))]),u.value.collision==="yes"?(a(),i("div",ba,[f[12]||(f[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ae("Tingkat kerusakan: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",xa,[(a(),i(se,null,oe(U,_=>t("label",{key:_.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":f[4]||(f[4]=w=>u.value.collision_severity=w),value:_.value,class:"hidden peer",onChange:f[5]||(f[5]=(...w)=>Q(L)&&Q(L)(...w))},null,40,ya),[[be,u.value.collision_severity]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":u.value.collision_severity===_.value,"border-gray-300 text-gray-700 hover:bg-gray-50":u.value.collision_severity!==_.value}])},F(_.label),3)])),64))])])):b("",!0)]),t("div",ka,[f[17]||(f[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),t("div",$a,[t("button",{type:"button",onClick:f[6]||(f[6]=_=>o("bold")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Bold"},f[14]||(f[14]=[t("strong",null,"B",-1)])),t("button",{type:"button",onClick:f[7]||(f[7]=_=>o("italic")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Italic"},f[15]||(f[15]=[t("em",null,"I",-1)])),t("button",{type:"button",onClick:f[8]||(f[8]=_=>o("underline")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Underline"},f[16]||(f[16]=[t("u",null,"U",-1)]))]),t("div",{ref_key:"editorRef",ref:s,contenteditable:"true",class:P(["w-full min-h-[120px] p-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 prose max-w-none",{"bg-white":!I.value,"bg-blue-50":I.value}]),onInput:f[9]||(f[9]=(..._)=>Q(C)&&Q(C)(..._)),onBlur:M,onFocus:f[10]||(f[10]=_=>I.value=!0),onKeydown:at(x,["enter"]),onPaste:S,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},qa=ue(Va,[["__scopeId","data-v-d6653a95"]]);export{go as B,Na as C,Ta as V,Pe as _,qa as a};
