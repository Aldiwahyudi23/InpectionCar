import{x as G,g,q as z,s as J,C as P,D as Q,b as R,o as l,w as W,e as O,d as t,u as n,l as X,f as a,i as u,t as m,v as y,y as _,F as I,k as B,j as N,E as Y,A as Z,n as ee,p as M}from"./vendor-DFzpKJ7b.js";import{l as te}from"./lodash-_JgH7_pB.js";import{A as oe}from"./AppLayout-DJByEBEM.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},le={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},ae={class:"mb-6"},ne={class:"mb-6"},ie={class:"relative"},de={key:0,class:"absolute right-3 top-3"},ue={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ce={key:0},pe=["onMousedown"],ge={class:"font-medium text-gray-900"},me={key:1,class:"p-4 text-sm text-gray-500 text-center"},be={class:"mb-6"},fe=["value"],ve={class:"mb-6 flex items-center justify-between"},ye={class:"relative inline-flex items-center cursor-pointer"},he={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe={class:"mt-6 flex justify-end"},ke=["disabled"],_e={key:2,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},we={key:0,class:"mb-4"},Ce=["innerHTML"],Ie={key:1},Be={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Me=["onClick"],je=["src","alt"],Ae={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Le={class:"text-white text-xs text-center"},Te={key:2,class:"text-center py-4 text-gray-500 text-sm"},Se={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Ve=["src","alt"],ze={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Ne={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},$e={__name:"Create",props:{CarDetail:Array,Category:Array},setup(j){const $=j,s=G({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null}),p=g(""),f=g(!1),w=g(!1),x=g([]),b=g(null),i=g([]),k=g(!1),c=g(0),E=z(()=>!s.plate_number.trim()||!s.category_id||!s.car_id&&!p.value.trim()?!1:s.is_scheduled?s.scheduled_at_date&&s.scheduled_at_time:!0),D=z(()=>s.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),h=o=>{var d,r,v;if(!o)return"";const e=[];return(d=o.brand)!=null&&d.name&&e.push(o.brand.name),(r=o.model)!=null&&r.name&&e.push(o.model.name),(v=o.type)!=null&&v.name&&e.push(o.type.name),o.cc&&e.push(`${o.cc}cc`),o.transmission&&e.push(o.transmission),o.fuel_type&&e.push(o.fuel_type),o.year&&e.push(o.year.toString()),o.production_period&&e.push(`(${o.production_period})`),e.join(" ")},A=te.debounce(()=>{if(!p.value.trim()){x.value=[],f.value=!1;return}w.value=!0;const o=p.value.toLowerCase().trim();x.value=$.CarDetail.filter(e=>h(e).toLowerCase().includes(o)),f.value=!0,w.value=!1},300),U=()=>{setTimeout(()=>{f.value=!1},200)},q=async o=>{b.value=o,p.value=h(o),s.car_id=o.id,s.car_name=h(o),f.value=!1,await F(o.id)},F=async o=>{try{const e=await fetch(`/api/cars/${o}/images`);if(e.ok){const d=await e.json();i.value=Array.isArray(d)?d:[]}else i.value=[]}catch(e){console.error("Error loading car images:",e),i.value=[]}},L=o=>!o||!o.file_path?"":`/storage/${o.file_path}`,K=o=>{c.value=o,k.value=!0,document.body.style.overflow="hidden"},C=()=>{k.value=!1,document.body.style.overflow=""},T=()=>{c.value=(c.value+1)%i.value.length},S=()=>{c.value=(c.value-1+i.value.length)%i.value.length},V=o=>{if(k.value)switch(o.key){case"Escape":C();break;case"ArrowRight":T();break;case"ArrowLeft":S();break}};J(()=>{window.addEventListener("keydown",V)}),P(()=>{window.removeEventListener("keydown",V)}),Q(p,o=>{(!b.value||h(b.value)!==o)&&(s.car_id=null,s.car_name=o,b.value=null,i.value=[])});const H=()=>{const o={plate_number:s.plate_number,category_id:s.category_id,is_scheduled:s.is_scheduled};s.is_scheduled&&(o.scheduled_at=`${s.scheduled_at_date} ${s.scheduled_at_time}`),s.car_id?o.car_id=s.car_id:o.car_name=p.value,s.post(route("inspections.store"),{preserveScroll:!0,onSuccess:e=>{if(o.is_scheduled)console.log("Inspeksi berhasil dijadwalkan.");else{const d=e.props.flash.newInspectionId;d?window.location.href=route("inspections.start",d):console.error("Tidak ada ID inspeksi baru yang dikembalikan.")}},onError:()=>{}})};return(o,e)=>(l(),R(oe,{title:"Buat Inspeksi Baru"},{default:W(()=>{var d;return[O(n(X),{title:"Inspek Baru"}),t("div",re,[e[24]||(e[24]=t("div",{class:"mb-4"},[t("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),t("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),n(s).errors.form_error?(l(),a("div",le,m(n(s).errors.form_error),1)):u("",!0),t("div",ae,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>n(s).plate_number=r),type:"text",placeholder:"Contoh: B 1234 ABC",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"},null,512),[[_,n(s).plate_number]])]),t("div",ne,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),t("div",ie,[y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>p.value=r),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:e[2]||(e[2]=(...r)=>n(A)&&n(A)(...r)),onFocus:e[3]||(e[3]=r=>f.value=!0),onBlur:U},null,544),[[_,p.value]]),w.value?(l(),a("div",de,e[10]||(e[10]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):u("",!0),f.value?(l(),a("div",ue,[x.value.length>0?(l(),a("div",ce,[(l(!0),a(I,null,B(x.value,r=>(l(),a("div",{key:r.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:v=>q(r)},[t("div",ge,m(h(r)),1)],40,pe))),128))])):(l(),a("div",me,e[11]||(e[11]=[N(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),N(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):u("",!0)])]),t("div",be,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"category"}," Kategori Inspeksi ",-1)),y(t("select",{id:"category","onUpdate:modelValue":e[4]||(e[4]=r=>n(s).category_id=r),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[13]||(e[13]=t("option",{value:"",disabled:""},"Pilih Kategori",-1)),(l(!0),a(I,null,B(j.Category,r=>(l(),a("option",{key:r.id,value:r.id},m(r.name),9,fe))),128))],512),[[Y,n(s).category_id]])]),t("div",ve,[e[16]||(e[16]=t("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),t("label",ye,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=r=>n(s).is_scheduled=r),id:"schedule-toggle",class:"sr-only peer"},null,512),[[Z,n(s).is_scheduled]]),e[15]||(e[15]=t("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),n(s).is_scheduled?(l(),a("div",he,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),y(t("input",{type:"date",id:"schedule-date","onUpdate:modelValue":e[6]||(e[6]=r=>n(s).scheduled_at_date=r),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[_,n(s).scheduled_at_date]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),y(t("input",{type:"time",id:"schedule-time","onUpdate:modelValue":e[7]||(e[7]=r=>n(s).scheduled_at_time=r),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[_,n(s).scheduled_at_time]])])])):u("",!0),t("div",xe,[t("button",{onClick:H,disabled:!E.value||n(s).processing,class:ee({"px-6 py-3 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600  border border-transparent text-white hover:bg-blue-700":!n(s).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600  border-transparent text-white hover:bg-green-700":n(s).is_scheduled})},m(D.value),11,ke)]),n(s).car_id&&b.value?(l(),a("div",_e,[b.value.description?(l(),a("div",we,[e[19]||(e[19]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:b.value.description},null,8,Ce)])):u("",!0),i.value.length>0?(l(),a("div",Ie,[e[20]||(e[20]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",Be,[(l(!0),a(I,null,B(i.value,(r,v)=>(l(),a("div",{key:r.id||v,class:"relative group cursor-pointer",onClick:Ee=>K(v)},[t("img",{src:L(r),alt:r.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,je),r.note?(l(),a("div",Ae,[t("p",Le,m(r.note),1)])):u("",!0)],8,Me))),128))])])):(l(),a("div",Te," Tidak ada gambar tersedia untuk mobil ini "))])):u("",!0),k.value?(l(),a("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:C},[t("div",Se,[t("button",{onClick:C,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},e[21]||(e[21]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),i.value.length>1?(l(),a("button",{key:0,onClick:M(S,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[22]||(e[22]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):u("",!0),i.value.length>1?(l(),a("button",{key:1,onClick:M(T,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[23]||(e[23]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):u("",!0),t("img",{src:L(i.value[c.value]),alt:"Car Image "+(c.value+1),class:"max-w-full max-h-full object-contain",onClick:e[8]||(e[8]=M(()=>{},["stop"]))},null,8,Ve),i.value.length>1?(l(),a("div",ze,m(c.value+1)+" / "+m(i.value.length),1)):u("",!0),(d=i.value[c.value])!=null&&d.note?(l(),a("div",Ne,m(i.value[c.value].note),1)):u("",!0)])])):u("",!0)])]}),_:1}))}},Ke=se($e,[["__scopeId","data-v-a649b384"]]);export{Ke as default};
