import{x as ue,p as ce,r as p,q as L,g as pe,E as me,G as Q,H as W,j as ge,o as l,w as fe,k as ve,d as t,u as n,v as be,c as a,b as c,t as m,z as v,A as k,F as S,m as N,f as X,I as Y,C as ye,n as xe,y as P}from"./vendor-Dy3A47bM.js";import{l as he}from"./lodash-ibmwMWsP.js";import{A as _e}from"./AppLayout-oKx8CGl-.js";import{_ as ke}from"./app-Ck4Goh0V.js";const we={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},Ce={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},Ie={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},Ae={class:"mb-6"},Be={class:"flex items-center space-x-2"},Me={key:0,class:"mt-2 text-sm text-red-600"},$e={key:1,class:"mt-2 text-sm text-green-600"},je={class:"mb-6"},Ue={class:"relative"},Ve={key:0,class:"absolute right-3 top-3"},Le={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Se={key:0},Ne=["onMousedown"],Te={class:"font-medium text-gray-900"},ze={key:1,class:"p-4 text-sm text-gray-500 text-center"},Ee={class:"mb-6"},De={class:"block text-sm font-medium text-gray-700 mb-2",for:"category"},Pe=["value"],qe={class:"mb-6 flex items-center justify-between"},Fe={class:"relative inline-flex items-center cursor-pointer"},He=["disabled"],Ke={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ge={key:0,class:"mb-6"},Je=["value"],Re={class:"mt-6 flex justify-end"},Ze=["disabled"],Oe={key:2,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Qe={key:0,class:"mb-4"},We=["innerHTML"],Xe={key:1},Ye={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},et=["onClick"],tt=["src","alt"],st={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},ot={class:"text-white text-xs text-center"},rt={key:2,class:"text-center py-4 text-gray-500 text-sm"},lt={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},at=["src","alt"],nt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},it={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},dt={__name:"a",props:{CarDetail:Array,Category:Array,team:Array,inspection:Array,activeInspections:Boolean},setup(q){const B=q,r=ue({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null,inspector_id:null}),M=ce(),h=M.props.global.user,F=M.props.global.region,b=M.props.global.has_roles;M.props.global.permissions;const w=p(""),C=p(""),I=p(""),f=p(""),_=p(!1),T=p(!1),$=p([]),y=p(null),i=p([]),j=p(""),z=p(!1),U=p(""),V=p(!1),g=p(0),H=L(()=>B.activeInspections),ee=()=>{const s=`${w.value}${C.value}${I.value}`.toUpperCase();r.plate_number=s},E=s=>{s==="area"?w.value=w.value.toUpperCase().replace(/[^A-Z]/g,""):s==="number"?C.value=C.value.replace(/[^0-9]/g,""):s==="suffix"&&(I.value=I.value.toUpperCase().replace(/[^A-Z]/g,"")),ee()},te=L(()=>!(!r.plate_number.trim()||!r.category_id||!r.car_id&&!f.value.trim()||r.is_scheduled&&(!r.scheduled_at_date||!r.scheduled_at_time)||(b.includes("Admin")||b.includes("coordinator"))&&!r.inspector_id)),se=L(()=>r.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),oe=L(()=>{const s=B.team.filter(o=>o.status==="active"),e=b.includes("Admin"),d=b.includes("coordinator");if(e)return s;if(d){const o=F.id;return s.filter(u=>u.region_id===o)}return[]}),A=s=>{var d,o,u;if(!s)return"";const e=[];return(d=s.brand)!=null&&d.name&&e.push(s.brand.name),(o=s.model)!=null&&o.name&&e.push(s.model.name),(u=s.type)!=null&&u.name&&e.push(s.type.name),s.cc&&e.push(`${s.cc}cc`),s.transmission&&e.push(s.transmission),s.fuel_type&&e.push(s.fuel_type),s.year&&e.push(s.year.toString()),s.production_period&&e.push(`(${s.production_period})`),e.join(" ")},K=he.debounce(()=>{if(!f.value.trim()){$.value=[],_.value=!1;return}T.value=!0;const s=f.value.toLowerCase().trim();$.value=B.CarDetail.filter(e=>A(e).toLowerCase().includes(s)),_.value=!0,T.value=!1},300),re=()=>{setTimeout(()=>{_.value=!1},200)},G=async s=>{y.value=s,f.value=A(s),r.car_id=s.id,r.car_name=A(s),_.value=!1,await le(s.id)},le=async s=>{try{const e=await fetch(`/api/cars/${s}/images`);if(e.ok){const d=await e.json();i.value=Array.isArray(d)?d:[]}else i.value=[]}catch(e){console.error("Error loading car images:",e),i.value=[]}},J=s=>!s||!s.file_path?"":`/storage/${s.file_path}`,ae=s=>{g.value=s,V.value=!0,document.body.style.overflow="hidden"},D=()=>{V.value=!1,document.body.style.overflow=""},R=()=>{g.value=(g.value+1)%i.value.length},Z=()=>{g.value=(g.value-1+i.value.length)%i.value.length},O=s=>{if(V.value)switch(s.key){case"Escape":D();break;case"ArrowRight":R();break;case"ArrowLeft":Z();break}};pe(()=>{window.addEventListener("keydown",O)}),me(()=>{window.removeEventListener("keydown",O)}),Q(f,s=>{(!y.value||A(y.value)!==s)&&(r.car_id=null,r.car_name=s,y.value=null,i.value=[])}),W(()=>{const s=b.includes("Admin")||b.includes("coordinator");r.inspector_id=(h==null?void 0:h.id)||null}),W(()=>{H.value&&(r.is_scheduled=!0)}),Q(()=>r.plate_number,s=>{if(j.value="",z.value=!1,U.value="",r.car_id=null,r.car_name="",f.value="",s.length>=6){const e=B.inspection.filter(d=>d.plate_number===s);if(e.length>0){const d=["draft","in_progress","pending","pending_review","revision"],o=e.find(u=>d.includes(u.status));if(o)z.value=!0,j.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${o.status.replace(/_/g," ").toUpperCase()}. Silakan selesaikan inspeksi tersebut terlebih dahulu.`;else{const u=e.filter(x=>["approved","rejected","completed","cancelled"].includes(x.status));if(u.length>0){u.sort((ie,de)=>new Date(de.created_at)-new Date(ie.created_at));const x=u[0];r.car_id=x.car_id,r.car_name=x.car_name,f.value=x.car_name,G(x.car),U.value=`Nomor plat ini sudah pernah diperiksa ${u.length} kali sebelumnya.`}}}}});const ne=()=>{r.plate_number,r.car_id,r.car_name,r.category_id,r.is_scheduled,r.inspector_id,r.is_scheduled&&`${r.scheduled_at_date}${r.scheduled_at_time}`,r.post(route("inspections.store"),{preserveScroll:!0,onSuccess:s=>{},onError:()=>{}})};return(s,e)=>(l(),ge(_e,{title:"Buat Inspeksi Baru"},{default:fe(()=>{var d;return[ve(n(be),{title:"Inspek Baru"}),t("div",we,[t("div",Ce,[e[31]||(e[31]=t("div",{class:"mb-4"},[t("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),t("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),n(r).errors.form_error?(l(),a("div",Ie,m(n(r).errors.form_error),1)):c("",!0),t("div",Ae,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),t("div",Be,[v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),type:"text",placeholder:"D",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[1]||(e[1]=o=>E("area")),maxlength:"2"},null,544),[[k,w.value]]),v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>C.value=o),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[3]||(e[3]=o=>E("number")),maxlength:"4"},null,544),[[k,C.value]]),v(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>I.value=o),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:e[5]||(e[5]=o=>E("suffix")),maxlength:"3"},null,544),[[k,I.value]])]),j.value?(l(),a("div",Me,m(j.value),1)):c("",!0),U.value?(l(),a("div",$e,m(U.value),1)):c("",!0)]),t("div",je,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),t("div",Ue,[v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:e[7]||(e[7]=(...o)=>n(K)&&n(K)(...o)),onFocus:e[8]||(e[8]=o=>_.value=!0),onBlur:re},null,544),[[k,f.value]]),T.value?(l(),a("div",Ve,e[16]||(e[16]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),_.value?(l(),a("div",Le,[$.value.length>0?(l(),a("div",Se,[(l(!0),a(S,null,N($.value,o=>(l(),a("div",{key:o.id,class:"px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:u=>G(o)},[t("div",Te,m(A(o)),1)],40,Ne))),128))])):(l(),a("div",ze,e[17]||(e[17]=[X(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),X(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),t("div",Ee,[t("label",De," Kategori Inspeksi "+m(n(F).id),1),v(t("select",{id:"category","onUpdate:modelValue":e[9]||(e[9]=o=>n(r).category_id=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[19]||(e[19]=t("option",{value:"",disabled:""},"Pilih Kategori",-1)),(l(!0),a(S,null,N(q.Category,o=>(l(),a("option",{key:o.id,value:o.id},m(o.name),9,Pe))),128))],512),[[Y,n(r).category_id]])]),t("div",qe,[e[21]||(e[21]=t("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),t("label",Fe,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=o=>n(r).is_scheduled=o),id:"schedule-toggle",class:"sr-only peer",disabled:H.value},null,8,He),[[ye,n(r).is_scheduled]]),e[20]||(e[20]=t("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),n(r).is_scheduled?(l(),a("div",Ke,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),v(t("input",{type:"date",id:"schedule-date","onUpdate:modelValue":e[11]||(e[11]=o=>n(r).scheduled_at_date=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[k,n(r).scheduled_at_date]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),v(t("input",{type:"time",id:"schedule-time","onUpdate:modelValue":e[12]||(e[12]=o=>n(r).scheduled_at_time=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[k,n(r).scheduled_at_time]])]),n(b).includes("Admin")||n(b).includes("coordinator")?(l(),a("div",Ge,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"inspector"}," Pilih Inspektor ",-1)),v(t("select",{id:"inspector","onUpdate:modelValue":e[13]||(e[13]=o=>n(r).inspector_id=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[24]||(e[24]=t("option",{value:"",disabled:""},"Pilih Inspektor",-1)),(l(!0),a(S,null,N(oe.value,o=>(l(),a("option",{key:o.id,value:o.user.id},m(o.user.name),9,Je))),128))],512),[[Y,n(r).inspector_id]])])):c("",!0)])):c("",!0),t("div",Re,[t("button",{onClick:ne,disabled:!te.value||n(r).processing||z.value,class:xe({"px-6 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600  border border-transparent text-white hover:bg-blue-700":!n(r).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600  border-transparent text-white hover:bg-green-700":n(r).is_scheduled})},m(se.value),11,Ze)]),n(r).car_id&&y.value?(l(),a("div",Oe,[y.value.description?(l(),a("div",Qe,[e[26]||(e[26]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:y.value.description},null,8,We)])):c("",!0),i.value.length>0?(l(),a("div",Xe,[e[27]||(e[27]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",Ye,[(l(!0),a(S,null,N(i.value,(o,u)=>(l(),a("div",{key:o.id||u,class:"relative group cursor-pointer",onClick:x=>ae(u)},[t("img",{src:J(o),alt:o.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,tt),o.note?(l(),a("div",st,[t("p",ot,m(o.note),1)])):c("",!0)],8,et))),128))])])):(l(),a("div",rt," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),V.value?(l(),a("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:D},[t("div",lt,[t("button",{onClick:D,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},e[28]||(e[28]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),i.value.length>1?(l(),a("button",{key:0,onClick:P(Z,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[29]||(e[29]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),i.value.length>1?(l(),a("button",{key:1,onClick:P(R,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[30]||(e[30]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),t("img",{src:J(i.value[g.value]),alt:"Car Image "+(g.value+1),class:"max-w-full max-h-full object-contain",onClick:e[14]||(e[14]=P(()=>{},["stop"]))},null,8,at),i.value.length>1?(l(),a("div",nt,m(g.value+1)+" / "+m(i.value.length),1)):c("",!0),(d=i.value[g.value])!=null&&d.note?(l(),a("div",it,m(i.value[g.value].note),1)):c("",!0)])])):c("",!0)])])]}),_:1}))}},gt=ke(dt,[["__scopeId","data-v-0236d795"]]);export{gt as default};
