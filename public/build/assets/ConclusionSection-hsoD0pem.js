import{x as et,g as N,y as ke,E as $e,m as J,G as le,f as i,o as a,d as t,i as w,e as ie,z as re,A as ce,u as Q,F as oe,k as ae,t as A,j as ee,v as he,w as ve,n as P,L as pe,a as Ze,b as se,r as Ke,T as tt,l as st,D as be,W as ot,M as we,B as at}from"./vendor-CeYqQ7tF.js";import{l as xe}from"./lodash-C5Ilt7en.js";import{_ as nt}from"./PrimaryButton-BTguZwZJ.js";import{_ as it}from"./ActionMessage-BOiCSxZ_.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ge}from"./InputNumber-BPVjtaZE.js";const lt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},rt={key:0,class:"p-4 space-y-2"},dt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ut={class:"flex items-center space-x-2"},ct={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},gt={class:"relative"},mt={key:0,class:"absolute right-3 top-3"},pt={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},vt={key:0},ft=["onMousedown"],ht={class:"font-medium text-gray-900"},bt={class:"text-sm text-gray-500"},wt={key:1,class:"p-4 text-sm text-gray-500 text-center"},xt={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},yt={key:0,class:"mb-4"},kt=["innerHTML"],$t={key:1},Vt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},It=["onClick"],Ct=["src","alt"],St={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Mt={class:"text-white text-xs text-center"},_t={key:2,class:"text-center py-4 text-gray-500 text-sm"},Ut={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Tt=["src","alt"],jt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Nt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},qt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Rt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(e,{emit:F}){var l,k,v,R;const s=e,C=F,b=et({plate_number:((l=s.inspection)==null?void 0:l.plate_number)||"",car_id:((k=s.inspection)==null?void 0:k.car_id)||null,car_name:((R=(v=s.inspection)==null?void 0:v.car)==null?void 0:R.name)||""}),c=N(""),r=N(""),d=N(""),u=N(b.car_name),M=N(!1),y=N(!1),S=N([]),x=N(null),$=N([]),o=N(!1),h=N(0);ke(()=>{var n,g,I,m,B;if(_((n=s.inspection)==null?void 0:n.plate_number),(g=s.inspection)!=null&&g.car_id&&((I=s.CarDetail)==null?void 0:I.length)>0){const H=s.CarDetail.find(W=>W.id===s.inspection.car_id);H&&z(H)}else!((m=s.inspection)!=null&&m.car_id)&&((B=s.inspection)!=null&&B.car_name)&&(u.value=s.inspection.car_name);window.addEventListener("keydown",te)}),$e(()=>{window.removeEventListener("keydown",te)});const _=n=>{if(!n){c.value="",r.value="",d.value="";return}const g=n.toUpperCase().trim(),I=g.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(I)c.value=I[1]||"",r.value=I[2]||"",d.value=I[3]||"";else{let m="area",B="",H="",W="";for(const X of g)m==="area"&&/[A-Z]/.test(X)?B+=X:m==="area"&&/[0-9]/.test(X)?(m="number",H+=X):m==="number"&&/[0-9]/.test(X)?H+=X:m==="number"&&/[A-Z]/.test(X)?(m="suffix",W+=X):m==="suffix"&&/[A-Z]/.test(X)&&(W+=X);c.value=B,r.value=H,d.value=W}D()},D=()=>{const n=`${c.value}${r.value}${d.value}`;b.plate_number=n,ne()},V=n=>{n==="area"?c.value=c.value.toUpperCase().replace(/[^A-Z]/g,""):n==="number"?r.value=r.value.replace(/[^0-9]/g,""):n==="suffix"&&(d.value=d.value.toUpperCase().replace(/[^A-Z]/g,"")),D()},f=n=>{var I,m,B;if(!n)return"";const g=[];return(I=n.brand)!=null&&I.name&&g.push(n.brand.name),(m=n.model)!=null&&m.name&&g.push(n.model.name),(B=n.type)!=null&&B.name&&g.push(n.type.name),n.cc&&g.push(`${n.cc}cc`),n.transmission&&g.push(n.transmission),n.fuel_type&&g.push(n.fuel_type),n.year&&g.push(n.year.toString()),n.production_period&&g.push(`(${n.production_period})`),g.join(" ")},L=xe.debounce(()=>{if(!u.value.trim()){S.value=[],M.value=!1;return}y.value=!0;try{const n=u.value.toLowerCase().trim();S.value=s.CarDetail.filter(g=>f(g).toLowerCase().includes(n)),M.value=!0}finally{y.value=!1}},300),U=()=>{setTimeout(()=>{M.value=!1},200)},z=async n=>{x.value=n,u.value=f(n),b.car_id=n.id,b.car_name=f(n),M.value=!1,await Z(n.id),ne()},E=n=>!n||!n.file_path?"":`/storage/${n.file_path}`,Z=async n=>{try{const g=await fetch(`/api/cars/${n}/images`);if(g.ok){const I=await g.json();$.value=Array.isArray(I)?I:[]}else $.value=[]}catch(g){console.error("Error loading car images:",g),$.value=[]}},K=n=>{h.value=n,o.value=!0,document.body.style.overflow="hidden"},G=()=>{o.value=!1,document.body.style.overflow=""},O=()=>{h.value=(h.value+1)%$.value.length},Y=()=>{h.value=(h.value-1+$.value.length)%$.value.length},te=n=>{if(o.value)switch(n.key){case"Escape":G();break;case"ArrowRight":O();break;case"ArrowLeft":Y();break}},ne=()=>{const n={plate_number:b.plate_number,car_id:b.car_id,car_name:b.car_name};C("update-vehicle",n)},j=()=>{s.inspection&&b.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0})},q=J(()=>!!b.plate_number&&!!b.car_name);return le(()=>s.inspection,n=>{var g;if(n)if(_(n.plate_number),b.car_id=n.car_id||null,n.car_id&&((g=s.CarDetail)==null?void 0:g.length)>0){const I=s.CarDetail.find(m=>m.id===n.car_id);I&&z(I)}else n.car_name&&(u.value=n.car_name,b.car_name=n.car_name)},{deep:!0}),(n,g)=>{var I;return a(),i("div",lt,[g[22]||(g[22]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),e.inspection?(a(),i("div",rt,[t("div",dt,[g[11]||(g[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",ut,[re(t("input",{"onUpdate:modelValue":g[0]||(g[0]=m=>c.value=m),type:"text",placeholder:"Contoh: B",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[1]||(g[1]=m=>V("area")),maxlength:"2"},null,544),[[ce,c.value]]),re(t("input",{"onUpdate:modelValue":g[2]||(g[2]=m=>r.value=m),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[3]||(g[3]=m=>V("number")),maxlength:"4"},null,544),[[ce,r.value]]),re(t("input",{"onUpdate:modelValue":g[4]||(g[4]=m=>d.value=m),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",onInput:g[5]||(g[5]=m=>V("suffix")),maxlength:"3"},null,544),[[ce,d.value]])])]),t("div",ct,[g[14]||(g[14]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",gt,[re(t("input",{"onUpdate:modelValue":g[6]||(g[6]=m=>u.value=m),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:g[7]||(g[7]=(...m)=>Q(L)&&Q(L)(...m)),onFocus:g[8]||(g[8]=m=>M.value=!0),onBlur:U},null,544),[[ce,u.value]]),y.value?(a(),i("div",mt,g[12]||(g[12]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):w("",!0),M.value?(a(),i("div",pt,[S.value.length>0?(a(),i("div",vt,[(a(!0),i(oe,null,ae(S.value,m=>(a(),i("div",{key:m.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:B=>z(m)},[t("div",ht,A(f(m)),1),t("div",bt,A(m.year)+" • "+A(m.cc)+"cc • "+A(m.transmission)+" • "+A(m.fuel_type),1)],40,ft))),128))])):(a(),i("div",wt,g[13]||(g[13]=[ee(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),ee(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):w("",!0)]),re(t("input",{type:"hidden","onUpdate:modelValue":g[9]||(g[9]=m=>Q(b).car_id=m)},null,512),[[ce,Q(b).car_id]])]),Q(b).car_id&&x.value?(a(),i("div",xt,[x.value.description?(a(),i("div",yt,[g[15]||(g[15]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:x.value.description},null,8,kt)])):w("",!0),$.value.length>0?(a(),i("div",$t,[g[16]||(g[16]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",Vt,[(a(!0),i(oe,null,ae($.value,(m,B)=>(a(),i("div",{key:m.id||B,class:"relative group cursor-pointer",onClick:H=>K(B)},[t("img",{src:E(m),alt:m.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ct),m.note?(a(),i("div",St,[t("p",Mt,A(m.note),1)])):w("",!0)],8,It))),128))])])):(a(),i("div",_t," Tidak ada gambar tersedia untuk mobil ini "))])):w("",!0),o.value?(a(),i("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:G},[t("div",Ut,[t("button",{onClick:G,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},g[17]||(g[17]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),$.value.length>1?(a(),i("button",{key:0,onClick:he(Y,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},g[18]||(g[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):w("",!0),$.value.length>1?(a(),i("button",{key:1,onClick:he(O,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},g[19]||(g[19]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):w("",!0),t("img",{src:E($.value[h.value]),alt:"Car Image "+(h.value+1),class:"max-w-full max-h-full object-contain",onClick:g[10]||(g[10]=he(()=>{},["stop"]))},null,8,Tt),$.value.length>1?(a(),i("div",jt,A(h.value+1)+" / "+A($.value.length),1)):w("",!0),(I=$.value[h.value])!=null&&I.note?(a(),i("div",Nt,A($.value[h.value].note),1)):w("",!0)])])):w("",!0),ie(nt,{type:"button",onClick:j,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!q.value},{default:ve(()=>[Q(b).processing?(a(),i("svg",qt,g[20]||(g[20]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):w("",!0),t("span",null,A(Q(b).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),ie(it,{on:Q(b).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:ve(()=>g[21]||(g[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ee(" Tersimpan. ")])),_:1,__:[21]},8,["on"])]),_:1},8,["disabled"])])):w("",!0)])}}},Na=ue(Rt,[["__scopeId","data-v-a54fbcbd"]]),Bt={class:"mt-1"},Lt=["value","required","minlength","maxlength","allowSpace","placeholder"],Dt={key:0,class:"mt-2 text-sm text-red-600"},Xe={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,C=F,b=J(()=>{if(!s.modelValue)return"";let r=s.modelValue;switch(s.allowSpace||(r=r.replace(/\s+/g,"")),s.textTransform){case"uppercase":return r.toUpperCase();case"lowercase":return r.toLowerCase();case"capitalize":return r.replace(/\b\w/g,d=>d.toUpperCase());default:return r}}),c=r=>{let d=r.target.value;switch(s.allowSpace||(d=d.replace(/\s+/g,"")),s.textTransform){case"uppercase":d=d.toUpperCase();break;case"lowercase":d=d.toLowerCase();break;case"capitalize":d=d.replace(/\b\w/g,u=>u.toUpperCase());break}C("update:modelValue",d),C("save",s.pointId)};return(r,d)=>(a(),i("div",Bt,[t("input",{value:b.value,onInput:c,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,allowSpace:e.allowSpace,placeholder:e.placeholder,class:P(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:e.textTransform==="uppercase",lowercase:e.textTransform==="lowercase",capitalize:e.textTransform==="capitalize"}])},null,42,Lt),e.error?(a(),i("p",Dt,A(e.error),1)):w("",!0)]))}},At={class:"mt-1"},Ft=["value","required","min","max"],zt={key:0,class:"mt-2 text-sm text-red-600"},Ye={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,C=F,b=c=>{C("update:modelValue",c.target.value),C("save",s.pointId)};return(c,r)=>(a(),i("div",At,[t("input",{value:e.modelValue,onChange:b,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ft),e.error?(a(),i("p",zt,A(e.error),1)):w("",!0)]))}},Et={class:"mt-1"},Ht=["value","required","placeholder"],Ot={key:0,class:"mt-2 text-sm text-red-600"},Je={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,C=F,b=N(""),c=J(()=>{var y,S,x,$;return{currency_symbol:((y=s.settings)==null?void 0:y.currency_symbol)||"Rp",thousands_separator:((S=s.settings)==null?void 0:S.thousands_separator)||",",min_value:((x=s.settings)==null?void 0:x.min_value)!==void 0?Number(s.settings.min_value):0,max_value:(($=s.settings)==null?void 0:$.max_value)!==void 0?Number(s.settings.max_value):1e9}}),r=y=>{if(y==null||y==="")return"";const S=Number(y);if(isNaN(S))return"";let x=S.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return c.value.thousands_separator!==","&&(x=x.replace(/,/g,c.value.thousands_separator)),x},d=y=>y?y.replace(/[^\d]/g,""):"",u=J(()=>b.value?`${c.value.currency_symbol} ${r(b.value)}`:""),M=y=>{let S=d(y.target.value),x=Number(S);c.value.min_value!==void 0&&x<c.value.min_value&&(S=c.value.min_value.toString()),c.value.max_value!==void 0&&x>c.value.max_value&&(S=c.value.max_value.toString()),b.value=S,C("update:modelValue",S),C("save",s.pointId)};return le(()=>s.modelValue,y=>{y!=null&&(b.value=y.toString())},{immediate:!0}),(y,S)=>(a(),i("div",Et,[t("input",{value:u.value,onInput:M,type:"text",required:e.required,placeholder:e.placeholder,class:P(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,Ht),e.error?(a(),i("p",Ot,A(e.error),1)):w("",!0)]))}},Wt={class:"mt-1 space-y-3"},Zt={key:0,class:"space-y-2"},Kt={class:"flex flex-wrap gap-2"},Gt=["onClick"],Xt=["value","required","minlength","maxlength","placeholder"],Yt={class:"flex justify-between items-center mt-1"},Jt={class:"text-xs text-gray-500"},Qt={key:0,class:"text-xs text-red-600"},Qe={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,C=F,b=N([]),c=N(""),r=y=>b.value.some(S=>S.value===y),d=y=>{r(y.value)?b.value=b.value.filter(o=>o.value!==y.value):b.value.push(y);const x=[...b.value.map(o=>o.value)];c.value.trim()&&x.push(c.value.trim());const $=x.join(", ");C("update:modelValue",$),C("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:$})},u=y=>{const S=y.target.value;C("update:modelValue",S),C("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:S}),M(S)},M=y=>{var o,h,_,D;if(!y){b.value=[],c.value="";return}const S=y.split(",").map(V=>V.trim()).filter(V=>V),x=((h=(o=s.settings)==null?void 0:o.damage_options)==null?void 0:h.map(V=>V.value))||[];b.value=((D=(_=s.settings)==null?void 0:_.damage_options)==null?void 0:D.filter(V=>S.includes(V.value)))||[];const $=S.filter(V=>!x.includes(V));c.value=$.join(", ")};return le(()=>s.modelValue,y=>{y!=null&&M(y)},{immediate:!0}),(y,S)=>{var x,$,o;return a(),i("div",Wt,[(x=e.settings)!=null&&x.enable_damage&&(($=e.settings)!=null&&$.damage_options)?(a(),i("div",Zt,[S[0]||(S[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",Kt,[(a(!0),i(oe,null,ae(e.settings.damage_options,(h,_)=>(a(),i("button",{key:_,type:"button",onClick:D=>d(h),class:P(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":r(h.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!r(h.value)}])},A(h.label),11,Gt))),128))])])):w("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:u,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Xt),t("div",Yt,[t("span",Jt,A(((o=e.modelValue)==null?void 0:o.length)||0)+"/"+A(e.maxLength||400),1),e.error?(a(),i("p",Qt,A(e.error),1)):w("",!0)])])])}}},Pt={class:"mt-1"},es=["value","required"],ts={key:0,class:"mt-2 text-sm text-red-600"},ss={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:F}){const s=e,C=F,b=c=>{C("update:modelValue",c.target.value),C("save",s.pointId)};return(c,r)=>(a(),i("div",Pt,[t("select",{value:e.modelValue,onChange:b,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},r[0]||(r[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,es),e.error?(a(),i("p",ts,A(e.error),1)):w("",!0)]))}},os=ue(ss,[["__scopeId","data-v-c34a74db"]]),as={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},ns={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},is={class:"text-xs text-gray-500 mt-2 text-center"},ls={class:"flex flex-row space-x-4 mb-6"},rs={class:"mt-4 text-right"},ds={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(F,s)=>e.show?(a(),i("div",as,[t("div",ns,[s[7]||(s[7]=t("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),t("p",is,[s[3]||(s[3]=ee("Ambil Foto Maksimal: ")),t("b",null,A(e.settings.max_files),1),s[4]||(s[4]=ee(" Dengan Rasio & Ukuran: ")),t("b",null,A(e.settings.camera_aspect_ratio),1)]),t("div",ls,[t("button",{onClick:s[0]||(s[0]=C=>F.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[5]||(s[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:s[1]||(s[1]=C=>F.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[6]||(s[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",rs,[t("button",{onClick:s[2]||(s[2]=C=>F.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):w("",!0)}},us={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},cs={class:"webcam-content-box"},gs={class:"webcam-header"},ms={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},ps={class:"inspection-point-name"},vs={key:0,class:"screen-flash-overlay"},fs={key:2,class:"zoom-controls"},hs=["max"],bs={class:"webcam-footer"},ws={class:"camera-controls"},xs=["disabled"],ys={class:"camera-icon-container"},ks={key:0,class:"camera-spinner"},$s={key:1,class:"camera-body"},Vs={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(e,{emit:F}){const s=e,C=F,b=N(null),c=N(null);let r=null,d=null;const u=N("environment"),M=N(!1),y=N(!1),S=N(!1),x=N(!1),$=N(!1),o=N({}),h=N(!1),_=N(1),D=N(1),V=N(!1),f=J(()=>{var j;return((j=s.settings)==null?void 0:j.max_size)||2048}),L=J(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),U=J(()=>{if(!s.aspectRatio)return{};const j=s.aspectRatio,q=j>1?80:60,l=j>1?80/j:60*j;return{width:`${q}%`,height:`${l}%`}}),z=async()=>{r&&r.getTracks().forEach(j=>j.stop());try{const j={facingMode:u.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};r=await navigator.mediaDevices.getUserMedia({video:j,audio:!1}),d=r.getVideoTracks()[0],b.value.srcObject=r,b.value.onloadedmetadata=async()=>{await Z(),await b.value.play()}}catch(j){console.error("Error accessing camera: ",j),alert("Failed to access camera. Please allow camera permission."),C("close")}},E=()=>{r&&r.getTracks().forEach(j=>j.stop()),C("close")},Z=async()=>{if(d)try{const j=await navigator.mediaDevices.enumerateDevices();M.value=j.filter(l=>l.kind==="videoinput").length>1;const q=d.getCapabilities();q.zoom?(V.value=!0,D.value=q.zoom.max,console.log(`Zoom supported. Max zoom: ${D.value}`)):(V.value=!1,console.warn("Zoom is not supported by this camera.")),y.value=q.torch||q.fillLightMode&&q.fillLightMode.includes("torch")}catch(j){console.error("Error checking camera capabilities:",j)}},K=async j=>{if(!d)return;const q=b.value.getBoundingClientRect(),l=j.clientX-q.left,k=j.clientY-q.top;$.value=!0,o.value={left:`${l}px`,top:`${k}px`,transform:"translate(-50%, -50%)"};try{if(d.getCapabilities().pointsOfInterest){const R=l/q.width,n=k/q.height;await d.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:R,y:n}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(v){console.warn("Manual focus failed:",v)}setTimeout(()=>{$.value=!1,d.getCapabilities().focusMode.includes("continuous")&&d.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},G=async j=>{if(!d||!V.value)return;const q=Math.min(Math.max(j,1),D.value);_.value=q;try{await d.applyConstraints({advanced:[{zoom:q}]})}catch(l){console.error("Failed to set zoom:",l)}},O=async()=>{if(!(!d||!y.value))try{u.value==="user"?(S.value=!S.value,x.value=S.value):(await d.applyConstraints({advanced:[{torch:!S.value}]}),S.value=!S.value)}catch(j){console.error("Flash toggle failed:",j)}},Y=async()=>{M.value&&(u.value=u.value==="environment"?"user":"environment",r&&r.getTracks().forEach(j=>j.stop()),await z())},te=async j=>new Promise(q=>{const l=f.value*1024;if(j.size<=l){q(j);return}const k=new Image,v=new FileReader;v.onload=R=>{k.onload=()=>{const n=document.createElement("canvas"),g=n.getContext("2d"),I=Math.sqrt(l/j.size);n.width=k.width*I,n.height=k.height*I,g.drawImage(k,0,0,n.width,n.height);let m=.9;const B=()=>{n.toBlob(H=>{H.size>l&&m>.1?(m-=.1,B()):q(H)},"image/jpeg",m)};B()},k.src=R.target.result},v.readAsDataURL(j)}),ne=async()=>{if(!(h.value||!b.value||!c.value)){h.value=!0;try{const j=b.value,q=c.value,l=j.videoWidth,k=j.videoHeight;let v,R,n,g;l/k>s.aspectRatio?(R=k,v=k*s.aspectRatio,n=(l-v)/2,g=0):(v=l,R=l/s.aspectRatio,n=0,g=(k-R)/2),q.width=v,q.height=R,q.getContext("2d").drawImage(j,n,g,v,R,0,0,v,R);const m=await new Promise(H=>{q.toBlob(H,"image/jpeg",1)}),B=await te(m);if(B){const H=new File([B],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});C("photoCaptured",H),x.value=!0,setTimeout(()=>{x.value=!1},100)}}catch(j){console.error("Error capturing photo:",j),alert("Failed to capture photo. Please try again.")}finally{h.value=!1}}};return le(()=>s.show,j=>{j?z():E()}),$e(()=>{r&&r.getTracks().forEach(j=>j.stop())}),(j,q)=>{var l;return e.show?(a(),i("div",us,[t("div",cs,[t("div",gs,[t("p",ms,A(e.settings.camera_aspect_ratio),1),t("div",ps,A(((l=e.point)==null?void 0:l.name)||"Camera"),1),t("button",{onClick:E,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},q[2]||(q[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:pe(L.value),onClick:K,onTouchstart:K},[t("video",{ref_key:"webcamVideo",ref:b,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:c,class:"hidden"},null,512),x.value?(a(),i("div",vs)):w("",!0),t("div",{class:"aspect-ratio-guide",style:pe(U.value)},null,4),$.value?(a(),i("div",{key:1,class:"focus-indicator",style:pe(o.value)},q[3]||(q[3]=[t("div",{class:"focus-ring"},null,-1)]),4)):w("",!0),q[4]||(q[4]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),V.value?(a(),i("div",fs,[re(t("input",{type:"range",min:"1",max:D.value,step:"0.1","onUpdate:modelValue":q[0]||(q[0]=k=>_.value=k),onInput:q[1]||(q[1]=k=>G(parseFloat(k.target.value))),class:"zoom-slider"},null,40,hs),[[ce,_.value]])])):w("",!0)],36),t("div",bs,[t("div",ws,[e.settings.enable_flash&&y.value?(a(),i("button",{key:0,onClick:O,class:P(["control-button",{active:S.value,disabled:!y.value}])},q[5]||(q[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):w("",!0),t("button",{onClick:ne,class:"capture-button",disabled:h.value},[t("div",ys,[h.value?(a(),i("div",ks)):(a(),i("div",$s,q[6]||(q[6]=[t("div",{class:"camera-lens"},null,-1),t("div",{class:"camera-flash"},null,-1)])))])],8,xs),e.settings.enable_camera_switch&&M.value?(a(),i("button",{key:1,onClick:Y,class:"control-button"},q[7]||(q[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):w("",!0)])])])])):w("",!0)}}},Is=ue(Vs,[["__scopeId","data-v-b94530cf"]]),Cs={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Ss={class:"w-full h-full flex flex-col"},Ms={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},_s={class:"text-lg font-semibold"},Us={class:"flex items-center gap-2"},Ts={class:"flex-1 flex items-center justify-center overflow-hidden relative"},js=["src"],Ns={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},qs={class:"flex justify-between items-center w-full"},Rs=["disabled"],Bs={key:1,class:"flex-1"},Ls=["disabled"],Ds={class:"flex gap-3 w-full"},As={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},Fs={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(e,{emit:F}){const s=e,C=F,b=N(0),c=N([]),r=J(()=>c.value.length>0?c.value[b.value]:null);le(()=>s.images,h=>{c.value=h.map(_=>({..._,rotation:_.rotation||0})),h.length===0&&s.show&&x()},{deep:!0,immediate:!0}),le(()=>s.show,h=>{h&&s.images.length>0&&(b.value=s.initialIndex)});const d=h=>h.preview||(h.image_path?`/${h.image_path}`:""),u=()=>{if(r.value){const h=(r.value.rotation+90)%360;c.value[b.value].rotation=h,C("update:images",c.value)}},M=()=>{b.value=b.value<c.value.length-1?b.value+1:0},y=()=>{b.value=b.value>0?b.value-1:c.value.length-1},S=()=>{s.isUploading||C("saveImages",c.value)},x=()=>{s.isUploading||C("close")},$=()=>{if(r.value&&!s.isUploading){const h=r.value,_=c.value.findIndex(D=>D.isNew&&h.isNew&&D.preview===h.preview||!D.isNew&&!h.isNew&&D.id===h.id);_!==-1&&(C("removePreviewImage",h),c.value.splice(_,1),C("update:images",c.value)),b.value>=c.value.length&&(b.value=Math.max(0,c.value.length-1)),c.value.length===0&&C("close")}},o=()=>{s.isUploading||C("triggerAddMorePhotos")};return(h,_)=>{var D;return e.show?(a(),i("div",Cs,[t("div",Ss,[t("div",Ms,[t("button",{onClick:x,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},_[0]||(_[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",_s,A(((D=e.point)==null?void 0:D.name)||"Preview")+" ("+A(b.value+1)+"/"+A(c.value.length)+") ",1),t("div",Us,[r.value&&r.value.isNew?(a(),i("button",{key:0,onClick:$,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},_[1]||(_[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):w("",!0),r.value&&r.value.isNew?(a(),i("button",{key:1,onClick:u,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},_[2]||(_[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))):w("",!0)])]),t("div",Ts,[t("div",{class:"relative w-full max-w-full",style:pe({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"})},[r.value?(a(),i("img",{key:0,src:d(r.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:pe({transform:`rotate(${r.value.rotation}deg)`})},null,12,js)):w("",!0)],4),c.value.length>1?(a(),i("button",{key:0,onClick:y,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},_[3]||(_[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):w("",!0),c.value.length>1?(a(),i("button",{key:1,onClick:M,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},_[4]||(_[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):w("",!0)]),t("div",Ns,[t("div",qs,[r.value&&!r.value.isNew?(a(),i("button",{key:0,onClick:$,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:e.isUploading},_[5]||(_[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ee(" Hapus Foto ")]),8,Rs)):(a(),i("div",Bs)),e.allowMultiple&&c.value.length<e.maxFiles?(a(),i("button",{key:2,onClick:o,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:e.isUploading},_[6]||(_[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ee(" Tambah Foto ")]),8,Ls)):w("",!0)]),t("div",Ds,[e.isUploading?(a(),i("button",As,_[7]||(_[7]=[ee(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(a(),i("button",{key:0,onClick:S,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):w("",!0)}}},zs=ue(Fs,[["__scopeId","data-v-41f87672"]]),Es=["accept","multiple","disabled"],Hs={class:"text-xs text-gray-500 mb-2"},Os=["disabled"],Ws={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Zs={class:"text-xs text-gray-400 mt-1"},Ks={key:0,class:"flex items-center gap-4"},Gs=["src"],Xs=["disabled"],Ys={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Js=["disabled"],Qs=["onClick"],Ps=["src"],eo={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},to={key:0},so={key:1,class:"ml-1"},oo={key:2,class:"mt-1 text-xs text-red-600"},ao={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:F}){const s=e,C=F,b=N(null),c=N(null),r=N(!1),d=N(!1),u=N(!1),M=N([]),y=N(0),S=N(!1),x=J(()=>Number(s.settings.max_files)>1),$=J(()=>s.settings.allowed_types.map(l=>`.${l}`).join(", ")),o=J(()=>{const l=s.settings.camera_aspect_ratio.split(":");if(l.length===2){const k=parseFloat(l[0]),v=parseFloat(l[1]);if(!isNaN(k)&&!isNaN(v)&&v!==0)return k/v}return 3/4}),h=J(()=>{const l=[],k=new Set;for(const v of M.value)v.id&&k.add(v.id),l.push(v);for(const v of s.modelValue)k.has(v.id)||l.push({...v,rotation:v.rotation||0,isNew:!1,preview:v.preview||(v.image_path?`/${v.image_path}`:null)});return l}),_=l=>l.preview||(l.image_path?`/${l.image_path}`:""),D=()=>{u.value&&(u.value=!1),r.value=!0},V=()=>{r.value=!1,b.value.click()},f=()=>{r.value=!1,d.value=!0},L=()=>{r.value=!1,h.value.length>0&&(u.value=!0)},U=()=>{d.value=!1,h.value.length>0&&(u.value=!0)},z=()=>{u.value=!1,M.value.forEach(l=>{l.preview&&l.preview.startsWith("blob:")&&URL.revokeObjectURL(l.preview)}),M.value=[]},E=l=>new Promise(k=>{const v=new FileReader;v.onload=R=>{const n=new Image;n.onload=()=>{k({file:l,preview:URL.createObjectURL(l),rotation:0,width:n.naturalWidth,height:n.naturalHeight,isNew:!0})},n.onerror=()=>{console.error("Failed to load image for dimensions:",l.name),k({file:l,preview:URL.createObjectURL(l),rotation:0,width:0,height:0,isNew:!0})},n.src=R.target.result},v.readAsDataURL(l)}),Z=l=>{const k=l.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(k)},K=async l=>{const v=(s.settings.max_size||2048)*1024;return new Promise(R=>{const n=new Image,g=new FileReader;g.onload=I=>{n.onload=()=>{const m=document.createElement("canvas"),B=m.getContext("2d"),H=Math.max(n.width,n.height);m.width=H,m.height=H,B.fillStyle="white",B.fillRect(0,0,H,H);const W=(H-n.width)/2,X=(H-n.height)/2;B.drawImage(n,W,X,n.width,n.height);let de=.9;const ge=()=>{m.toBlob(me=>{if(me.size>v&&de>.1)de-=.1,ge();else{const fe=new File([me],l.name,{type:"image/jpeg",lastModified:Date.now()});R(fe)}},"image/jpeg",de)};ge()},n.src=I.target.result},g.readAsDataURL(l)})},G=async l=>{const k=Array.from(l.target.files);if(!k.length){r.value=!1,h.value.length>0&&(u.value=!0);return}try{const v=k.filter(B=>!Z(B));if(v.length>0){const B=v.map(H=>H.name.split(".").pop()).join(", ");alert(`File type not allowed: ${B}. Allowed types: ${s.settings.allowed_types.join(", ")}`),l.target.value="";return}const R=h.value.length,n=s.settings.max_files-R,g=await Promise.all(k.slice(0,n).map(async B=>await K(B))),I=await Promise.all(g.map(E)),m=x.value?I:I.slice(0,1);x.value?M.value.push(...m):(M.value.forEach(B=>{B.preview&&B.preview.startsWith("blob:")&&URL.revokeObjectURL(B.preview)}),M.value=m),r.value=!1,m.length>0?(y.value=Math.max(0,h.value.length-m.length),u.value=!0):h.value.length>0&&(u.value=!0),l.target.value=""}catch(v){console.error("Error processing selected images:",v),alert("Failed to process selected images. Please try again."),r.value=!1,h.value.length>0&&(u.value=!0)}},O=async l=>{const k=h.value.length;if(!x.value||k<s.settings.max_files)try{const v=await K(l),R=new Image;R.onload=()=>{const n={file:v,preview:URL.createObjectURL(v),rotation:0,width:R.naturalWidth,height:R.naturalHeight,isNew:!0};x.value?M.value.push(n):(M.value.forEach(g=>{g.preview&&g.preview.startsWith("blob:")&&URL.revokeObjectURL(g.preview)}),M.value=[n]),d.value=!1,r.value=!1,y.value=h.value.length-1,u.value=!0},R.src=URL.createObjectURL(v)}catch(v){console.error("Error processing captured image:",v),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),d.value=!1,r.value=!1,h.value.length>0&&(u.value=!0)},Y=(l=0)=>{y.value=l,u.value=!0},te=l=>new Promise(k=>{if(l.rotation===0||!c.value){if(!l.isNew&&!l.file){k({file:null,width:l.width,height:l.height,isOriginal:!0});return}k({file:l.file,width:l.width,height:l.height});return}const v=new Image;v.onload=async()=>{try{const R=c.value,n=R.getContext("2d"),g=v.width,I=v.height;let m,B;l.rotation===90||l.rotation===270?(m=I,B=g):(m=g,B=I),R.width=m,R.height=B,n.clearRect(0,0,R.width,R.height),n.translate(R.width/2,R.height/2),n.rotate(l.rotation*Math.PI/180),n.drawImage(v,-g/2,-I/2,g,I),n.setTransform(1,0,0,1,0,0);const H=await new Promise(de=>{R.toBlob(de,"image/jpeg",.9)}),W=new File([H],l.file?l.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),X=await K(W);k({file:X,width:m,height:B})}catch(R){console.error("Error processing rotated image:",R),k({file:l.file,width:l.width,height:l.height})}},v.onerror=()=>{console.error("Failed to load image for rotation processing:",l.preview),k({file:l.file,width:l.width,height:l.height})},v.src=l.preview}),ne=async l=>{var R,n,g,I;S.value=!0;const k=[],v=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),S.value=!1;return}try{for(const m of l){if(!m.isNew&&m.rotation===0&&m.id&&m.image_path){k.push({id:m.id,image_path:m.image_path,width:m.width,height:m.height,rotation:0,preview:m.preview});continue}const{file:B,width:H,height:W,isOriginal:X}=await te(m);if(X&&!m.isNew){k.push({id:m.id,image_path:m.image_path,width:m.width,height:m.height,rotation:0,preview:m.preview});continue}B&&v.push({file:B,width:H,height:W,rotation:0})}if(v.length>0){const m=new FormData;m.append("inspection_id",s.inspectionId),m.append("point_id",s.pointId),v.forEach(W=>{m.append("images[]",W.file)});const H=(await Ze.post(route("inspections.upload-image"),m,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const W of H)k.push({id:W.image_id,image_path:W.path,width:W.width||0,height:W.height||0,rotation:W.rotation||0,preview:W.public_url});v.forEach(W=>{W.file&&W.file.preview&&W.file.preview.startsWith("blob:")&&URL.revokeObjectURL(W.file.preview)})}C("update:modelValue",k),C("save",s.pointId),C("uploaded",{pointId:s.pointId,images:k}),z()}catch(m){if(console.error("Error during image processing/upload:",m),(n=(R=m.response)==null?void 0:R.data)!=null&&n.message)alert(`Failed to save images: ${m.response.data.message}`);else if((I=(g=m.response)==null?void 0:g.data)!=null&&I.errors){const B=Object.values(m.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${B}`)}else alert(`Failed to save images: ${m.message}`)}finally{S.value=!1}},j=l=>{if(l){if(l.id&&!l.isNew)q(l);else{const k=M.value.findIndex(v=>v.preview&&v.preview===l.preview&&v.isNew||v.id&&v.id===l.id);if(k!==-1){const v=M.value.splice(k,1)[0];v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}C("update:modelValue",s.modelValue.filter(v=>!(v.id&&v.id===l.id)&&!(v.preview&&v.preview===l.preview)))}y.value>=h.value.length&&(y.value=Math.max(0,h.value.length-1)),h.value.length===0&&z()}},q=async l=>{var v,R;if(l.id||l.image_path)try{await Ze.delete(route("inspections.delete-image"),{data:{image_id:l.id,image_path:l.image_path}})}catch(n){console.error("Error deleting image from server:",n),(R=(v=n.response)==null?void 0:v.data)!=null&&R.message?alert(`Failed to delete image from server: ${n.response.data.message}`):alert(`Failed to delete image from server: ${n.message}`);return}l.preview&&l.preview.startsWith("blob:")&&URL.revokeObjectURL(l.preview);const k=s.modelValue.filter(n=>n.id!==l.id);C("update:modelValue",k),M.value=M.value.filter(n=>n.isNew&&l.isNew?n.preview!==l.preview:n.id!==l.id),C("removeImage",{image:l}),u.value&&h.value.length===0?z():u.value&&y.value>=h.value.length&&(y.value=Math.max(0,h.value.length-1))};return(l,k)=>(a(),i("div",null,[t("input",{ref_key:"galleryInput",ref:b,type:"file",accept:$.value,class:"hidden",onChange:G,multiple:x.value,disabled:S.value},null,40,Es),t("canvas",{ref_key:"processingCanvas",ref:c,class:"hidden"},null,512),t("p",Hs,"Foto Maksimal: "+A(e.settings.max_files)+" | Rasio: "+A(e.settings.camera_aspect_ratio),1),h.value.length===0?(a(),i("label",{key:0,onClick:D,class:P(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:S.value},[t("div",Ws,[k[2]||(k[2]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),k[3]||(k[3]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),t("p",Zs,"Tipe: "+A($.value),1)])],8,Os)):(a(),i("div",{key:1,class:P(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":e.settings.max_files==1,"bg-transparent":e.settings.max_files>1}]),"aria-label":"Image gallery"},[e.settings.max_files===1?(a(),i("div",Ks,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:k[0]||(k[0]=v=>Y(0))},[t("img",{src:_(h.value[0]),class:"w-full h-full object-cover"},null,8,Gs)]),t("button",{onClick:k[1]||(k[1]=he(v=>q(h.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:S.value},k[4]||(k[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ee(" Hapus Foto ")]),8,Xs)])):(a(),i("div",Ys,[x.value&&h.value.length<e.settings.max_files?(a(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:D,disabled:S.value},k[5]||(k[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Js)):w("",!0),(a(!0),i(oe,null,ae(h.value,(v,R)=>(a(),i("div",{key:v.id||v.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:n=>Y(R)},[t("img",{src:_(v),class:"w-full h-full object-cover"},null,8,Ps),v.isNew||v.rotation!==0?(a(),i("div",eo,[v.isNew?(a(),i("span",to,"BARU")):w("",!0),v.rotation!==0?(a(),i("span",so,"ROTASI")):w("",!0)])):w("",!0)],8,Qs))),128))]))],2)),e.error?(a(),i("p",oo,A(e.error),1)):w("",!0),ie(ds,{show:r.value,settings:e.settings,onClose:L,onOpenWebcam:f,onTriggerGallery:V},null,8,["show","settings"]),ie(Is,{show:d.value,"aspect-ratio":o.value,settings:e.settings,point:e.point,onClose:U,onPhotoCaptured:O},null,8,["show","aspect-ratio","settings","point"]),ie(zs,{show:u.value,images:h.value,point:e.point,"initial-index":y.value,"allow-multiple":x.value,"max-files":e.settings.max_files,"is-uploading":S.value,"aspect-ratio":o.value,onClose:z,onSaveImages:ne,onRemovePreviewImage:j,onTriggerAddMorePhotos:D},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},ye=ue(ao,[["__scopeId","data-v-771b7e31"]]),no={key:0,class:"fixed inset-0 z-50 overflow-hidden"},io={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},lo={class:"px-4 pb-2 border-b border-gray-200"},ro={class:"text-lg font-semibold text-gray-900"},uo={key:0,class:"text-sm text-gray-500 mt-1"},co={class:"flex-1 overflow-y-auto p-4"},go={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},mo={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:F}){const s=F,C=()=>{s("close")},b=c=>{c.key==="Escape"&&C()};return ke(()=>{document.addEventListener("keydown",b)}),$e(()=>{document.removeEventListener("keydown",b)}),(c,r)=>(a(),se(tt,{name:"bottom-sheet"},{default:ve(()=>[e.show?(a(),i("div",no,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:C}),t("div",io,[r[0]||(r[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",lo,[t("h3",ro,A(e.title),1),e.subtitle?(a(),i("p",uo,A(e.subtitle),1)):w("",!0)]),t("div",co,[Ke(c.$slots,"default",{},void 0,!0)]),c.$slots.footer?(a(),i("div",go,[Ke(c.$slots,"footer",{},void 0,!0)])):w("",!0)])])):w("",!0)]),_:3}))}},po=ue(mo,[["__scopeId","data-v-7893c2dc"]]),vo={class:"space-y-4"},fo={key:0,class:"mt-2"},ho={key:1,class:"mt-2"},bo={key:2,class:"mt-2"},wo={key:3,class:"mt-2"},xo={key:4,class:"mt-2"},yo={class:"text-sm font-medium text-gray-700 mb-2"},ko={key:0,class:"text-red-500"},$o={key:0,class:"text-xs text-red-500"},Vo=["name","value","checked"],Io={key:6,class:"space-y-2"},Co={key:0,class:"text-red-500"},So={key:1,class:"text-xs text-red-500"},Mo={key:7,class:"mt-4"},_o={class:"text-sm font-medium text-gray-700 mb-2"},Uo={key:0,class:"text-red-500"},To={key:0,class:"text-xs text-red-500"},jo={class:"flex gap-2"},No=["disabled"],Pe={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(e,{emit:F}){const s=e,C=F,b=d=>C("hapus",d),c=J(()=>s.options.find(d=>d.value===s.selectedValue)),r=J(()=>{var u,M,y,S,x,$,o;if(s.point.input_type==="text"&&(!((u=s.notesValue)!=null&&u.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((M=s.notesValue)!=null&&M.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((y=s.notesValue)!=null&&y.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!((S=s.notesValue)!=null&&S.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date)||s.point.input_type==="imageTOradio"&&s.imagesValue.length===0||s.options.length&&!s.selectedValue)return!1;const d=c.value;return!(s.showTextarea&&((x=d==null?void 0:d.settings)!=null&&x.show_textarea)&&(!(($=s.notesValue)!=null&&$.trim())||d.settings.min_length&&s.notesValue.length<d.settings.min_length||d.settings.max_length&&s.notesValue.length>d.settings.max_length)||s.showImageUpload&&((o=d==null?void 0:d.settings)!=null&&o.show_image_upload)&&(s.imagesValue.length===0||d.settings.max_files&&s.imagesValue.length>d.settings.max_files))});return(d,u)=>(a(),se(po,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:u[18]||(u[18]=M=>d.$emit("close"))},{footer:ve(()=>[e.selectedPoint?(a(),i("button",{key:0,onClick:u[15]||(u[15]=M=>b(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},u[20]||(u[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ee(" Hapus Data ")]))):w("",!0),t("div",jo,[t("button",{type:"button",onClick:u[16]||(u[16]=M=>d.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:u[17]||(u[17]=M=>d.$emit("save")),disabled:!r.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,No)])]),default:ve(()=>{var M,y,S,x,$,o,h,_,D,V,f,L,U,z,E,Z,K,G,O,Y,te,ne,j,q,l,k,v,R,n,g;return[t("div",vo,[e.point.input_type==="text"?(a(),i("div",fo,[ie(Xe,{"model-value":e.notesValue,required:(M=e.point.settings)==null?void 0:M.is_required,"min-length":(y=e.point.settings)==null?void 0:y.min_length,"max-length":(S=e.point.settings)==null?void 0:S.max_length,allowSpace:(x=e.point.settings)==null?void 0:x.allow_space,textTransform:($=e.point.settings)==null?void 0:$.text_transform,placeholder:((o=e.point.settings)==null?void 0:o.placeholder)||"Masukan text",error:d.error,"onUpdate:modelValue":u[0]||(u[0]=I=>d.$emit("update:notesValue",I)),onSave:u[1]||(u[1]=I=>d.$emit("saveText",I))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):w("",!0),e.point.input_type==="number"?(a(),i("div",ho,[ie(Ge,{"model-value":e.notesValue,required:(h=e.point.settings)==null?void 0:h.is_required,min:(_=e.point.settings)==null?void 0:_.min,max:(D=e.point.settings)==null?void 0:D.max,step:((V=e.point.settings)==null?void 0:V.step)||1,placeholder:((f=e.point.settings)==null?void 0:f.placeholder)||"Masukan number",error:d.error,"onUpdate:modelValue":u[2]||(u[2]=I=>d.$emit("update:notesValue",I)),onSave:u[3]||(u[3]=I=>d.$emit("saveNumber",I))},null,8,["model-value","required","min","max","step","placeholder","error"])])):w("",!0),e.point.input_type==="account"?(a(),i("div",bo,[ie(Je,{"model-value":e.notesValue,required:(L=e.point.settings)==null?void 0:L.is_required,placeholder:((U=e.point.settings)==null?void 0:U.placeholder)||"Masukkan nilai",error:d.error,"point-id":e.pointId,settings:e.point.settings,"onUpdate:modelValue":u[4]||(u[4]=I=>d.$emit("update:notesValue",I)),onSave:u[5]||(u[5]=I=>d.$emit("saveAccount",I))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):w("",!0),e.point.input_type==="date"?(a(),i("div",wo,[ie(Ye,{"model-value":e.notesValue,required:(z=e.point.settings)==null?void 0:z.is_required,"min-date":(E=e.point.settings)==null?void 0:E.min_date,"max-date":(Z=e.point.settings)==null?void 0:Z.max_date,error:d.error,"onUpdate:modelValue":u[6]||(u[6]=I=>d.$emit("update:notesValue",I)),onSave:u[7]||(u[7]=I=>d.$emit("saveDate",I))},null,8,["model-value","required","min-date","max-date","error"])])):w("",!0),e.point.input_type==="imageTOradio"?(a(),i("div",xo,[t("h4",yo,[(K=e.point.settings)!=null&&K.required?(a(),i("span",ko,"*")):w("",!0)]),ie(ye,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point.inspection_point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":u[8]||(u[8]=I=>d.$emit("update:imagesValue",I)),onSave:u[9]||(u[9]=I=>d.$emit("saveImage",I))},null,8,["model-value","point-id","point","inspection-id","settings"]),(G=e.point.settings)!=null&&G.required&&e.imagesValue.length===0?(a(),i("p",$o," Foto wajib diupload ")):w("",!0)])):w("",!0),e.options.length?(a(),i("div",{key:5,class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),i(oe,null,ae(e.options,(I,m)=>(a(),i("label",{key:m,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:I.value,checked:e.selectedValue===I.value,onChange:u[10]||(u[10]=B=>d.$emit("update:selectedValue",B.target.value)),class:"hidden peer"},null,40,Vo),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==I.value}])},A(I.label),3)]))),128))],2)):w("",!0),e.showTextarea&&((Y=(O=c.value)==null?void 0:O.settings)!=null&&Y.show_textarea)?(a(),i("div",Io,[(te=c.value.settings)!=null&&te.required?(a(),i("span",Co,"*")):w("",!0),ie(Qe,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:c.value.settings,required:(ne=c.value.settings)==null?void 0:ne.required,"min-length":(j=c.value.settings)==null?void 0:j.min_length,"max-length":(q=c.value.settings)==null?void 0:q.max_length,placeholder:((l=c.value.settings)==null?void 0:l.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":u[11]||(u[11]=I=>d.$emit("update:notesValue",I)),onSave:u[12]||(u[12]=I=>d.$emit("saveTextarea",I))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(k=c.value.settings)!=null&&k.required&&!e.notesValue?(a(),i("p",So," Keterangan wajib diisi ")):w("",!0)])):w("",!0),e.showImageUpload&&((R=(v=c.value)==null?void 0:v.settings)!=null&&R.show_image_upload)?(a(),i("div",Mo,[t("h4",_o,[u[19]||(u[19]=ee(" Upload Foto ")),(n=c.value.settings)!=null&&n.required?(a(),i("span",Uo,"*")):w("",!0)]),ie(ye,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:c.value.settings,"onUpdate:modelValue":u[13]||(u[13]=I=>d.$emit("update:imagesValue",I)),onSave:u[14]||(u[14]=I=>d.$emit("saveImage",I))},null,8,["model-value","point-id","point","inspection-id","settings"]),(g=c.value.settings)!=null&&g.required&&e.imagesValue.length===0?(a(),i("p",To," Foto wajib diupload ")):w("",!0)])):w("",!0)])]}),_:1},8,["show","title","subtitle"]))}},qo={class:"mt-2 space-y-2"},Ro=["name","value","checked","onChange","required"],Bo={key:0,class:"p-2 rounded-lg bg-gray-50"},Lo={key:0,class:"mt-2"},Do={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Ao=["src"],Fo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},zo={key:1,class:"mt-2"},Eo={class:"text-sm text-gray-600"},Ho={key:2,class:"mt-2 text-sm text-red-600"},Oo={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:F}){const s=e,C=F,b=N(s.notes),c=N([...s.images]),r=N(!1),d=N(""),u=N([]),M=N(""),y=N([]),S=J(()=>s.options.find(U=>U.value===s.modelValue)),x=U=>U.settings&&(U.settings.show_textarea||U.settings.show_image_upload);le(()=>s.notes,U=>{b.value=U}),le(()=>s.images,U=>{c.value=[...U]}),le(()=>s.modelValue,U=>{U&&(M.value=U)});const $=U=>{C("update:modelValue",U.value),x(U)?h():C("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:U.value,notes:"",images:[]})},o=U=>U.preview||(U.image_path?`/${U.image_path}`:U),h=()=>{M.value=s.modelValue,d.value=b.value,u.value=[...c.value],y.value=[...c.value],r.value=!0},_=()=>{d.value="",u.value=[],M.value="",r.value=!1},D=U=>{u.value=U,c.value=[...U],C("update:images",[...U]),C("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:b.value,images:[...U]})},V=U=>{},f=()=>{M.value!==s.modelValue&&C("update:modelValue",M.value),b.value=d.value,C("update:notes",d.value),c.value=[...u.value],C("update:images",[...u.value]),C("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:M.value,notes:d.value,images:u.value}),r.value=!1},L=U=>{C("hapus",U),r.value=!1};return(U,z)=>{var E,Z,K,G;return a(),i("div",qo,[t("div",{class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),i(oe,null,ae(e.options,(O,Y)=>(a(),i("label",{key:Y,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:O.value,checked:e.modelValue===O.value,onChange:te=>$(O),class:"hidden peer",required:e.required},null,40,Ro),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===O.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==O.value}])},A(O.label),3)]))),128))],2),e.modelValue&&S.value&&x(S.value)?(a(),i("div",Bo,[t("div",{class:"flex justify-between items-start"},[z[4]||(z[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:h,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((E=S.value.settings)!=null&&E.show_image_upload)?(a(),i("div",Lo,[t("div",Do,[(a(!0),i(oe,null,ae(e.images,(O,Y)=>(a(),i("div",{key:Y,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:o(O),class:"w-full h-full object-cover rounded"},null,8,Ao),Y===3&&e.images.length>4?(a(),i("span",Fo," +"+A(e.images.length-4),1)):w("",!0)]))),128))])])):w("",!0),e.notes&&((Z=S.value.settings)!=null&&Z.show_textarea)?(a(),i("div",zo,[t("p",Eo,A(e.notes),1)])):w("",!0)])):w("",!0),r.value?(a(),se(Pe,{key:(K=e.selectedPoint)==null?void 0:K.id,show:r.value,title:e.pointName||"Detail",subtitle:(G=S.value)==null?void 0:G.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":M.value,"notes-value":d.value,"images-value":u.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":z[0]||(z[0]=O=>M.value=O),"onUpdate:notesValue":z[1]||(z[1]=O=>d.value=O),"onUpdate:imagesValue":z[2]||(z[2]=O=>D(O)),onClose:_,onSave:f,onSaveTextarea:U.handleTextareaSave,onSaveImage:V,onHapus:z[3]||(z[3]=O=>L(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):w("",!0),e.error?(a(),i("p",Ho,A(e.error),1)):w("",!0)])}}},Wo={class:"mt-2 space-y-2"},Zo={key:0,class:"flex flex-wrap gap-3"},Ko={key:1,class:"p-2"},Go={key:0,class:"mt-2"},Xo={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Yo=["src"],Jo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Qo=["name","value","checked"],Po={key:1,class:"mt-2"},ea={class:"text-sm text-gray-600"},ta={key:3,class:"mt-2 text-sm text-red-600"},sa={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:F}){const s=e,C=F,b=N(s.notes),c=N([...s.images]),r=N(!1),d=N(""),u=N([]),M=N(""),y=N([]),S=J(()=>s.options.find(V=>V.value===s.modelValue)),x=V=>V.preview||(V.image_path?`/${V.image_path}`:V);le(()=>s.notes,V=>{b.value=V});const $=()=>{M.value=s.modelValue||"",d.value=b.value,u.value=[...c.value],y.value=[...c.value],r.value=!0},o=()=>{d.value="",u.value=[],M.value="",r.value=!1},h=V=>{u.value=V,c.value=[...V],C("update:images",[...V]),C("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:b.value,images:[...V]})},_=()=>{M.value!==s.modelValue&&C("update:modelValue",M.value),b.value=d.value,C("update:notes",d.value),c.value=[...u.value],C("update:images",[...u.value]),C("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:M.value,notes:d.value,images:u.value}),r.value=!1},D=V=>{C("hapus",V),r.value=!1};return(V,f)=>{var L,U,z;return a(),i("div",Wo,[!e.modelValue&&c.value.length===0&&!b.value?(a(),i("div",Zo,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:$},f[4]||(f[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(a(),i("div",Ko,[t("div",{class:"flex justify-between items-start"},[f[5]||(f[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:$,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),c.value.length>0?(a(),i("div",Go,[t("div",Xo,[(a(!0),i(oe,null,ae(c.value,(E,Z)=>(a(),i("div",{key:Z,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:x(E),class:"w-full h-full object-cover rounded"},null,8,Yo),Z===3&&c.value.length>4?(a(),i("span",Jo," +"+A(c.value.length-4),1)):w("",!0)]))),128))])])):w("",!0),t("div",{class:P(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(a(!0),i(oe,null,ae(e.options,(E,Z)=>(a(),i("label",{key:Z,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:E.value,checked:e.modelValue===E.value,disabled:!0,class:"hidden peer"},null,8,Qo),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===E.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==E.value}])},A(E.label),3)]))),128))],2),b.value&&((L=S.value.settings)!=null&&L.show_textarea)?(a(),i("div",Po,[t("p",ea,A(b.value),1)])):w("",!0)])),r.value?(a(),se(Pe,{key:(U=e.selectedPoint)==null?void 0:U.id,show:r.value,title:e.pointName||"Detail",subtitle:(z=S.value)==null?void 0:z.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":M.value,"notes-value":d.value,"images-value":u.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":f[0]||(f[0]=E=>M.value=E),"onUpdate:notesValue":f[1]||(f[1]=E=>d.value=E),"onUpdate:imagesValue":f[2]||(f[2]=E=>h(E)),onClose:o,onSave:_,onHapus:f[3]||(f[3]=E=>D(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):w("",!0),e.error?(a(),i("p",ta,A(e.error),1)):w("",!0)])}}},oa={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},aa={class:"bg-indigo-200 px-6 py-2 border-b"},na={class:"text-xl font-semibold text-indigo-700"},ia={class:"p-4 space-y-4"},la={class:"flex items-start justify-between"},ra={class:"block text-sm font-medium text-gray-700"},da={key:0,class:"text-red-500"},ua={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},ca={key:0,class:"text-center py-8 text-gray-500"},ga={key:0,class:"text-xs text-gray-400"},ma={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(e,{emit:F}){const s=e,C=F,b=st(),c=J(()=>{var $;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:($=s.category.points)==null?void 0:$.length}),!s.category.isDamageMenu)return console.log("Menu biasa - tampilkan semua points"),s.category.points||[];const x=(s.category.points||[]).filter(o=>{var D,V;const h=(D=o.inspection_point)==null?void 0:D.id,_=r(h);return console.log(`Point ${h} (${(V=o.inspection_point)==null?void 0:V.name}): hasData = ${_}`),_});return console.log("Filtered damage points:",x),x}),r=x=>{if(!x)return console.log("hasPointData: pointId is null/undefined"),!1;const $=b.props.existingResults[x]!==void 0,o=b.props.existingImages[x]&&b.props.existingImages[x].length>0,h=s.form.results[x]&&(s.form.results[x].status||s.form.results[x].note),_=s.form.images[x]&&s.form.images[x].length>0,D=$||o||h||_;return console.log(`Point ${x} data check:`,{hasServerResult:$,hasServerImages:o,hasLocalResult:h,hasLocalImages:_,finalResult:D}),D},d=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],u=x=>{var h,_,D,V,f,L,U,z,E;const $=s.form.results[(h=x.inspection_point)==null?void 0:h.id],o=s.form.images[(_=x.inspection_point)==null?void 0:_.id];if(!$)return!1;switch(x.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!$.note;case"select":case"radio":if(!$.status)return!1;const Z=(V=(D=x.settings)==null?void 0:D.radios)==null?void 0:V.find(G=>G.value===$.status);return!(Z!=null&&Z.settings&&(Z.settings.show_textarea&&!((f=$.note)!=null&&f.trim())||Z.settings.show_image_upload&&(o==null?void 0:o.length)===0));case"imageTOradio":if((o==null?void 0:o.length)===0||!$.status)return!1;const K=(U=(L=x.settings)==null?void 0:L.radios)==null?void 0:U.find(G=>G.value===$.status);return!(K!=null&&K.settings&&K.settings.show_textarea&&!((z=$.note)!=null&&z.trim()));case"image":return(o==null?void 0:o.length)>0;default:return!!$.status||!!((E=$.note)!=null&&E.trim())}},M=(x,$,o)=>{C("updateResult",{pointId:x,type:o,value:$})},y=x=>{C("saveResult",x)},S=x=>{C("hapusPoint",x)};return(x,$)=>(a(),i("div",oa,[t("div",aa,[t("h3",na,A(e.category.name),1)]),t("div",ia,[(a(!0),i(oe,null,ae(c.value,o=>{var h,_,D,V,f,L,U,z,E,Z,K,G,O,Y,te,ne,j,q,l,k,v,R,n,g,I,m,B,H,W,X,de,ge,me,fe,Ve,Ie,Ce,Se,Me,_e,Ue,Te,je,Ne,qe,Re,Be,Le,De,Ae,Fe,ze,Ee,He,Oe,We;return a(),i("div",{key:o.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",la,[t("label",ra,[ee(A((h=o.inspection_point)==null?void 0:h.name)+" ",1),(_=o.settings)!=null&&_.is_required?(a(),i("span",da,"*")):w("",!0)]),u(o)?(a(),i("span",ua," ✓ ")):w("",!0)]),o.input_type==="text"?(a(),se(Xe,{key:0,modelValue:e.form.results[(D=o.inspection_point)==null?void 0:D.id].note,"onUpdate:modelValue":[T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=T},T=>{var p;return M((p=o.inspection_point)==null?void 0:p.id,T,"note")}],required:(V=o.settings)==null?void 0:V.is_required,"min-length":(f=o.settings)==null?void 0:f.min_length,"max-length":(L=o.settings)==null?void 0:L.max_length,allowSpace:(U=o.settings)==null?void 0:U.allow_space,textTransform:(z=o.settings)==null?void 0:z.text_transform,placeholder:((E=o.settings)==null?void 0:E.placeholder)||"Masukan text",error:e.form.errors[`results.${(Z=o.inspection_point)==null?void 0:Z.id}.note`],onSave:T=>{var p;return y((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):w("",!0),o.input_type==="number"?(a(),se(Ge,{key:1,modelValue:e.form.results[(K=o.inspection_point)==null?void 0:K.id].note,"onUpdate:modelValue":[T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=T},T=>{var p;return M((p=o.inspection_point)==null?void 0:p.id,T,"note")}],required:(G=o.settings)==null?void 0:G.is_required,min:(O=o.settings)==null?void 0:O.min,max:(Y=o.settings)==null?void 0:Y.max,step:((te=o.settings)==null?void 0:te.step)||1,placeholder:((ne=o.settings)==null?void 0:ne.placeholder)||"Masukan number",error:e.form.errors[`results.${(j=o.inspection_point)==null?void 0:j.id}.note`],onSave:T=>{var p;return y((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):w("",!0),o.input_type==="account"?(a(),se(Je,{key:2,modelValue:e.form.results[(q=o.inspection_point)==null?void 0:q.id].note,"onUpdate:modelValue":[T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=T},T=>{var p;return M((p=o.inspection_point)==null?void 0:p.id,T,"note")}],required:(l=o.settings)==null?void 0:l.is_required,placeholder:((k=o.settings)==null?void 0:k.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${(v=o.inspection_point)==null?void 0:v.id}.note`],"point-id":(R=o.inspection_point)==null?void 0:R.id,settings:o.settings,onSave:T=>{var p;return y((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):w("",!0),o.input_type==="date"?(a(),se(Ye,{key:3,modelValue:e.form.results[(n=o.inspection_point)==null?void 0:n.id].note,"onUpdate:modelValue":[T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=T},T=>{var p;return M((p=o.inspection_point)==null?void 0:p.id,T,"note")}],required:(g=o.settings)==null?void 0:g.is_required,"min-date":(I=o.settings)==null?void 0:I.min_date,"max-date":(m=o.settings)==null?void 0:m.max_date,error:e.form.errors[`results.${(B=o.inspection_point)==null?void 0:B.id}.note`],onSave:T=>{var p;return y((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):w("",!0),o.input_type==="textarea"?(a(),se(Qe,{key:4,modelValue:e.form.results[(H=o.inspection_point)==null?void 0:H.id].note,"onUpdate:modelValue":[T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=T},T=>{var p;return M((p=o.inspection_point)==null?void 0:p.id,T,"note")}],required:(W=o.settings)==null?void 0:W.is_required,"min-length":(X=o.settings)==null?void 0:X.min_length,"max-length":(de=o.settings)==null?void 0:de.max_length,placeholder:((ge=o.settings)==null?void 0:ge.placeholder)||"Masukkan teks di sini",settings:o.settings,error:e.form.errors[`results.${(me=o.inspection_point)==null?void 0:me.id}.note`],onSave:T=>{var p;return y((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):w("",!0),o.input_type==="radio"?(a(),se(Oo,{key:5,modelValue:e.form.results[(fe=o.inspection_point)==null?void 0:fe.id].status,"onUpdate:modelValue":[T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].status=T},T=>{var p;return M((p=o.inspection_point)==null?void 0:p.id,T,"status")}],notes:e.form.results[(Ve=o.inspection_point)==null?void 0:Ve.id].note,images:e.form.images[(Ie=o.inspection_point)==null?void 0:Ie.id],required:(Ce=o.settings)==null?void 0:Ce.is_required,"point-id":(Se=o.inspection_point)==null?void 0:Se.id,point:o.inspection_point,"inspection-id":e.inspectionId,settings:o.settings,"point-name":(Me=o.inspection_point)==null?void 0:Me.name,"selected-point":o.input_type==="damage"?o.inspection_point:null,options:((_e=o.settings)==null?void 0:_e.radios)||d,error:e.form.errors[`results.${(Ue=o.inspection_point)==null?void 0:Ue.id}.status`],"onUpdate:notes":T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=T},"onUpdate:images":T=>{var p;return e.form.images[(p=o.inspection_point)==null?void 0:p.id]=T},onSave:T=>{var p;return y((p=o.inspection_point)==null?void 0:p.id)},onHapus:T=>{var p;return S((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):w("",!0),o.input_type==="imageTOradio"?(a(),se(sa,{key:6,modelValue:e.form.results[(Te=o.inspection_point)==null?void 0:Te.id].status,"onUpdate:modelValue":[T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].status=T},T=>{var p;return M((p=o.inspection_point)==null?void 0:p.id,T,"status")}],notes:e.form.results[(je=o.inspection_point)==null?void 0:je.id].note,images:e.form.images[(Ne=o.inspection_point)==null?void 0:Ne.id],required:(qe=o.settings)==null?void 0:qe.is_required,"point-id":(Re=o.inspection_point)==null?void 0:Re.id,"inspection-id":e.inspectionId,settings:o.settings,"point-name":(Be=o.inspection_point)==null?void 0:Be.name,point:o,"selected-point":o.input_type==="damage"?o.inspection_point:null,options:((Le=o.settings)==null?void 0:Le.radios)||d,error:e.form.errors[`results.${(De=o.inspection_point)==null?void 0:De.id}.status`],"onUpdate:notes":T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=T},"onUpdate:images":T=>{var p;return e.form.images[(p=o.inspection_point)==null?void 0:p.id]=T},onSave:T=>{var p;return y((p=o.inspection_point)==null?void 0:p.id)},onHapus:T=>{var p;return S((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):w("",!0),o.input_type==="image"?(a(),se(ye,{key:7,modelValue:e.form.images[(Ae=o.inspection_point)==null?void 0:Ae.id],"onUpdate:modelValue":T=>{var p;return e.form.images[(p=o.inspection_point)==null?void 0:p.id]=T},error:e.form.errors[`images.${(Fe=o.inspection_point)==null?void 0:Fe.id}`],"inspection-id":e.inspectionId,"point-id":(ze=o.inspection_point)==null?void 0:ze.id,point:o.inspection_point,"point-name":(Ee=o.inspection_point)==null?void 0:Ee.name,settings:o.settings,"onUpdate:notes":T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].note=T},"onUpdate:status":T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].status=T}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):w("",!0),o.input_type==="select"?(a(),se(os,{key:8,modelValue:e.form.results[(He=o.inspection_point)==null?void 0:He.id].status,"onUpdate:modelValue":[T=>{var p;return e.form.results[(p=o.inspection_point)==null?void 0:p.id].status=T},T=>{var p;return M((p=o.inspection_point)==null?void 0:p.id,T,"status")}],required:(Oe=o.settings)==null?void 0:Oe.is_required,error:e.form.errors[`results.${(We=o.inspection_point)==null?void 0:We.id}.status`],onSave:T=>{var p;return y((p=o.inspection_point)==null?void 0:p.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):w("",!0)])}),128)),c.value.length===0?(a(),i("div",ca,[$[0]||($[0]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),$[1]||($[1]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),e.category.isDamageMenu?(a(),i("p",ga,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):w("",!0)])):w("",!0)])]))}},qa=ue(ma,[["__scopeId","data-v-cdbefdf5"]]),pa={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},va={class:"p-4 space-y-4-6"},fa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ha=["value"],ba={class:"p-4 space-y-4-6"},wa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},xa=["value"],ya={key:0,class:"p-4 space-y-4"},ka={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},$a=["value"],Va={class:"p-4 space-y-2"},Ia={class:"flex gap-1 mb-2 p-2 bg-gray-100 rounded-md"},Ca={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const F=e,s=N(null),C=N(!1),b=V=>{if(!V)return{};if(typeof V=="string")try{return JSON.parse(V)||{}}catch(f){return console.error("Error parsing settings JSON:",f),{}}return typeof V=="object"&&V!==null?V:{}},c=J(()=>b(F.inspection.settings).conclusion||{}),r=N({flooded:c.value.flooded||"",collision:c.value.collision||"",collision_severity:c.value.collision_severity||"",conclusion_note:F.inspection.notes||""}),d=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],u=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],M=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];ke(()=>{D(),be(()=>{y()})});const y=()=>{s.value&&r.value.conclusion_note&&(s.value.innerHTML=r.value.conclusion_note)},S=xe.debounce(()=>{if(s.value){const V=window.getSelection();V.rangeCount>0&&V.getRangeAt(0),r.value.conclusion_note=s.value.innerHTML,_()}},500),x=V=>{V.preventDefault(),document.execCommand("insertParagraph",!1,null)},$=V=>{V.preventDefault();const f=(V.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,f)},o=V=>{if(!s.value)return;s.value.focus();const f=window.getSelection();switch(f.rangeCount>0&&f.getRangeAt(0),V){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"underline":document.execCommand("underline",!1,null);break}S()},h=()=>{C.value=!1,s.value&&(r.value.conclusion_note=s.value.innerHTML,_())},_=xe.debounce(()=>{const V={flooded:r.value.flooded,collision:r.value.collision,collision_severity:r.value.collision==="yes"?r.value.collision_severity:null,conclusion_note:r.value.conclusion_note};ot.post(route("inspections.updateConclusion",F.inspectionId),V,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{be(()=>{if(s.value){const f=document.createRange(),L=window.getSelection();f.selectNodeContents(s.value),f.collapse(!1),L.removeAllRanges(),L.addRange(f)}})},onError:f=>{console.error("Error saving conclusion:",f)}})},500);le([()=>r.value.flooded,()=>r.value.collision,()=>r.value.collision_severity],()=>{_()});const D=()=>{const f=b(F.inspection.settings).conclusion||{};r.value={flooded:f.flooded||"",collision:f.collision||"",collision_severity:f.collision_severity||"",conclusion_note:F.inspection.notes||""}};return le(()=>F.inspection,()=>{D(),be(()=>{y()})},{deep:!0}),(V,f)=>(a(),i("div",pa,[f[18]||(f[18]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),t("div",va,[f[11]||(f[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ee(" Apakah kendaraan pernah terkena banjir? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",fa,[(a(),i(oe,null,ae(d,L=>t("label",{key:L.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":f[0]||(f[0]=U=>r.value.flooded=U),value:L.value,class:"hidden peer",onChange:f[1]||(f[1]=(...U)=>Q(_)&&Q(_)(...U))},null,40,ha),[[we,r.value.flooded]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.flooded===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.flooded!==L.value}])},A(L.label),3)])),64))])]),t("div",ba,[f[13]||(f[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ee(" Apakah kendaraan pernah mengalami tabrakan? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",wa,[(a(),i(oe,null,ae(u,L=>t("label",{key:L.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":f[2]||(f[2]=U=>r.value.collision=U),value:L.value,class:"hidden peer",onChange:f[3]||(f[3]=(...U)=>Q(_)&&Q(_)(...U))},null,40,xa),[[we,r.value.collision]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision!==L.value}])},A(L.label),3)])),64))]),r.value.collision==="yes"?(a(),i("div",ya,[f[12]||(f[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ee("Tingkat kerusakan: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ka,[(a(),i(oe,null,ae(M,L=>t("label",{key:L.value,class:"cursor-pointer"},[re(t("input",{type:"radio","onUpdate:modelValue":f[4]||(f[4]=U=>r.value.collision_severity=U),value:L.value,class:"hidden peer",onChange:f[5]||(f[5]=(...U)=>Q(_)&&Q(_)(...U))},null,40,$a),[[we,r.value.collision_severity]]),t("div",{class:P(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":r.value.collision_severity===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":r.value.collision_severity!==L.value}])},A(L.label),3)])),64))])])):w("",!0)]),t("div",Va,[f[17]||(f[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),t("div",Ia,[t("button",{type:"button",onClick:f[6]||(f[6]=L=>o("bold")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Bold"},f[14]||(f[14]=[t("strong",null,"B",-1)])),t("button",{type:"button",onClick:f[7]||(f[7]=L=>o("italic")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Italic"},f[15]||(f[15]=[t("em",null,"I",-1)])),t("button",{type:"button",onClick:f[8]||(f[8]=L=>o("underline")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Underline"},f[16]||(f[16]=[t("u",null,"U",-1)]))]),t("div",{ref_key:"editorRef",ref:s,contenteditable:"true",class:P(["w-full min-h-[120px] p-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 prose max-w-none",{"bg-white":!C.value,"bg-blue-50":C.value}]),onInput:f[9]||(f[9]=(...L)=>Q(S)&&Q(S)(...L)),onBlur:h,onFocus:f[10]||(f[10]=L=>C.value=!0),onKeydown:at(x,["enter"]),onPaste:$,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},Ra=ue(Ca,[["__scopeId","data-v-d6653a95"]]);export{po as B,qa as C,Na as V,Pe as _,Ra as a};
