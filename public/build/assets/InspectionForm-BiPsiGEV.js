import{e as i,o,a as e,f as b,t as $,F as P,h as z,d as _,k as W,j as se,n as X,p as ae,C as re,c as N,g as K,x as oe,W as H,q as ne,D as le,b as ie,w as ue,u as R,l as de,s as ce,T as me,B as Q}from"./app-BdToApWV.js";import{l as Y}from"./lodash-ByU1vZxO.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"mt-1"},ve=["value","required","minlength","maxlength","pattern","placeholder"],he={key:0,class:"mt-2 text-sm text-red-600"},pe={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:g}){const d=t,v=g,y=x=>{v("update:modelValue",x.target.value),v("save",d.pointId)};return(x,u)=>(o(),i("div",ge,[e("input",{value:t.modelValue,onInput:y,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,pattern:t.pattern,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ve),t.error?(o(),i("p",he,$(t.error),1)):b("",!0)]))}},fe={class:"mt-1"},be=["value","required","min","max","step","placeholder"],xe={key:0,class:"mt-2 text-sm text-red-600"},we={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:g}){const d=t,v=g,y=x=>{const u=x.target.value;v("update:modelValue",u),v("save",d.pointId)};return(x,u)=>(o(),i("div",fe,[e("input",{value:t.modelValue,onInput:y,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,be),t.error?(o(),i("p",xe,$(t.error),1)):b("",!0)]))}},ye={class:"mt-1"},ke=["value","required","min","max"],Se={key:0,class:"mt-2 text-sm text-red-600"},Ve={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:g}){const d=t,v=g,y=x=>{v("update:modelValue",x.target.value),v("save",d.pointId)};return(x,u)=>(o(),i("div",ye,[e("input",{value:t.modelValue,onChange:y,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ke),t.error?(o(),i("p",Se,$(t.error),1)):b("",!0)]))}},$e={class:"mt-1"},Ie=["value","required"],_e={key:0,class:"mt-2 text-sm text-red-600"},Ce={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:g}){const d=t,v=g,y=x=>{v("update:modelValue",x.target.value),v("save",d.pointId)};return(x,u)=>(o(),i("div",$e,[e("select",{value:t.modelValue,onChange:y,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},u[0]||(u[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Ie),t.error?(o(),i("p",_e,$(t.error),1)):b("",!0)]))}},je=G(Ce,[["__scopeId","data-v-c34a74db"]]),qe={class:"mt-2"},Re={class:"flex flex-col gap-2 sm:flex-row sm:items-center"},Ue=["name","value","checked","onChange","required"],Le={class:"text-sm text-gray-700"},Ee={key:0,class:"mt-2 text-sm text-red-600"},Be={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number],options:{type:Array,default:()=>[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}]}},emits:["update:modelValue","save"],setup(t,{emit:g}){const d=t,v=g,y=x=>{v("update:modelValue",x),v("save",d.pointId)};return(x,u)=>(o(),i("div",qe,[e("div",Re,[(o(!0),i(P,null,z(t.options,m=>(o(),i("label",{key:m.value,class:"inline-flex items-center space-x-2"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:m.value,checked:t.modelValue===m.value,onChange:I=>y(m.value),required:t.required,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,Ue),e("span",Le,$(m.label),1)]))),128))]),t.error?(o(),i("p",Ee,$(t.error),1)):b("",!0)]))}},Me=["multiple"],Ne={key:0,class:"h-full flex flex-col items-center justify-center p-4 text-center"},Ae={key:1,class:"p-2"},Te={class:"grid grid-cols-3 gap-2"},Oe=["src"],Pe=["onClick"],ze={key:0,class:"mt-2 text-center"},De={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 p-4"},Fe={class:"bg-white w-full max-w-sm rounded-xl shadow-xl overflow-hidden"},He={key:1,class:"fixed inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center z-40 p-0"},Xe={class:"webcam-content-box"},Ge={class:"webcam-video-container"},We={key:2,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center"},Ke={class:"w-full h-full flex flex-col"},Je={class:"flex justify-between items-center p-4 bg-black bg-opacity-50 text-white"},Qe={class:"text-lg font-medium"},Ye={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Ze=["src"],et={class:"flex justify-between p-4 bg-black bg-opacity-50"},tt={key:3,class:"mt-1 text-xs text-red-600"},st={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,pointId:[String,Number],settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png"]})}},emits:["update:modelValue","save","removeImage"],setup(t,{emit:g}){const d=t,v=g,y=_(null),x=_(null),u=_(null),m=_([]),I=_(!1),k=_(!1),h=_(0),s=_(0),j=_(0),U=_(0);let q=null;const L=W(()=>Number(d.settings.max_files)>1),A=W(()=>m.value[h.value]),E=()=>{I.value=!0},n=()=>{I.value=!1,y.value.click()},r=async()=>{I.value=!1,k.value=!0;try{q=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),x.value.srcObject=q}catch(f){console.error("Error accessing camera: ",f),alert("Failed to access camera. Please ensure camera permissions are granted."),k.value=!1}},a=()=>{q&&q.getTracks().forEach(f=>f.stop()),k.value=!1},p=()=>{if(!x.value||!u.value)return;const f=x.value,l=u.value,C=l.getContext("2d");l.width=f.videoWidth,l.height=f.videoHeight,C.drawImage(f,0,0,l.width,l.height),l.toBlob(M=>{if(M){const O=new File([M],`captured_image_${Date.now()}.png`,{type:"image/png"});a(),m.value=[{file:O,preview:URL.createObjectURL(O)}],h.value=0,s.value=0}else console.error("Failed to convert canvas to blob.")},"image/png")},S=f=>{const l=Array.from(f.target.files).slice(0,d.settings.max_files);if(!l.length)return;const C=d.modelValue.length,M=d.settings.max_files-C,O=l.slice(0,M);m.value=O.map(J=>({file:J,preview:URL.createObjectURL(J)})),h.value=0,s.value=0,f.target.value=""},w=()=>{const f=[...d.modelValue,...m.value];v("update:modelValue",f.slice(0,d.settings.max_files)),v("save",d.pointId),m.value=[]},V=()=>{m.value.forEach(f=>URL.revokeObjectURL(f.preview)),m.value=[]},B=f=>{const l=[...d.modelValue],C=l.splice(f,1)[0];C.preview&&URL.revokeObjectURL(C.preview),v("update:modelValue",l),v("removeImage",{index:f,pointId:d.pointId})},D=f=>{const l=m.value.splice(f,1)[0];l.preview&&URL.revokeObjectURL(l.preview),m.value.length===0?V():h.value>=m.value.length&&(h.value=m.value.length-1)},F=()=>{s.value=(s.value+90)%360},T=()=>{h.value<m.value.length-1&&(h.value++,s.value=0)},c=()=>{h.value>0&&(h.value--,s.value=0)},Z=f=>{j.value=f.touches[0].clientX},ee=f=>{U.value=f.touches[0].clientX},te=()=>{j.value-U.value>50?T():U.value-j.value>50&&c()};return(f,l)=>(o(),i("div",null,[e("input",{ref_key:"galleryInput",ref:y,type:"file",accept:"image/*",class:"hidden",onChange:S,multiple:L.value},null,40,Me),e("label",{onClick:E,class:X(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200",{"border-gray-300 hover:border-indigo-400 bg-gray-50":t.modelValue.length===0,"border-indigo-300 bg-indigo-50":t.modelValue.length>0,"h-28":t.modelValue.length===0,"h-auto":t.modelValue.length>0}])},[t.modelValue.length===0?(o(),i("div",Ne,l[2]||(l[2]=[e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1),e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)]))):(o(),i("div",Ae,[e("div",Te,[(o(!0),i(P,null,z(t.modelValue,(C,M)=>(o(),i("div",{key:M,class:"relative aspect-square"},[e("img",{src:C.preview||"/storage/"+C.image_path,class:"w-full h-full object-cover rounded-md border border-gray-200"},null,8,Oe),e("button",{onClick:se(O=>B(M),["stop"]),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm hover:bg-red-600 transition-colors"}," Ã— ",8,Pe)]))),128))]),L.value?(o(),i("div",ze,l[3]||(l[3]=[e("span",{class:"inline-block px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 hover:bg-indigo-200 transition-colors"}," + Add More Images ",-1)]))):b("",!0)]))],2),I.value?(o(),i("div",De,[e("div",Fe,[e("div",{class:"p-4"},[l[6]||(l[6]=e("h3",{class:"text-lg font-medium text-center text-gray-800 mb-4"},"Select Image Source",-1)),e("div",{class:"flex justify-center gap-6"},[e("button",{onClick:r,class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-blue-50 hover:bg-blue-100 transition-colors"},l[4]||(l[4]=[ae('<div class="bg-blue-100 p-3 rounded-full mb-2" data-v-7b828569><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-7b828569><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" data-v-7b828569></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" data-v-7b828569></path></svg></div><span class="text-sm font-medium text-gray-700" data-v-7b828569>Camera (Web)</span>',2)])),e("button",{onClick:n,class:"flex flex-col items-center justify-center w-24 h-24 rounded-xl bg-purple-50 hover:bg-purple-100 transition-colors"},l[5]||(l[5]=[e("div",{class:"bg-purple-100 p-3 rounded-full mb-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1),e("span",{class:"text-sm font-medium text-gray-700"},"Gallery (HP)",-1)]))])]),e("button",{onClick:l[0]||(l[0]=C=>I.value=!1),class:"w-full py-3 text-center text-gray-500 font-medium border-t border-gray-100 hover:bg-gray-50 transition-colors"},"Cancel")])])):b("",!0),k.value?(o(),i("div",He,[e("div",Xe,[e("div",{class:"webcam-header"},[l[8]||(l[8]=e("h3",{class:"text-lg font-medium text-white"},"Take Photo",-1)),e("button",{onClick:a,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},l[7]||(l[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Ge,[e("video",{ref_key:"webcamVideo",ref:x,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:u,class:"hidden"},null,512)]),e("div",{class:"webcam-footer"},[e("button",{onClick:p,class:"capture-button"})])])])):b("",!0),m.value.length?(o(),i("div",We,[e("div",Ke,[e("div",Je,[e("button",{onClick:V,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},l[9]||(l[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",Qe,"Preview ("+$(h.value+1)+"/"+$(m.value.length)+")",1),e("button",{onClick:F,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},l[10]||(l[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))]),e("div",Ye,[e("div",{class:"w-full h-full flex items-center justify-center",onTouchstart:Z,onTouchmove:ee,onTouchend:te},[e("img",{src:A.value.preview,class:"max-w-full max-h-full object-contain",style:re({transform:`rotate(${s.value}deg)`})},null,12,Ze)],32),m.value.length>1?(o(),i("button",{key:0,onClick:c,class:"absolute left-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},l[11]||(l[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):b("",!0),m.value.length>1?(o(),i("button",{key:1,onClick:T,class:"absolute right-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},l[12]||(l[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):b("",!0)]),e("div",et,[e("button",{onClick:l[1]||(l[1]=C=>D(h.value)),class:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"}," Delete "),e("button",{onClick:w,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Save "+$(m.value.length)+" Image(s) ",1)])])])):b("",!0),t.error?(o(),i("p",tt,$(t.error),1)):b("",!0)]))}},at=G(st,[["__scopeId","data-v-7b828569"]]),rt={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},ot={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},nt={class:"text-xl font-semibold text-indigo-700"},lt={class:"p-6 space-y-8"},it={class:"flex items-start justify-between"},ut={class:"block text-sm font-medium text-gray-700"},dt={key:0,class:"text-red-500"},ct={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},mt={__name:"CategorySection",props:{category:Object,form:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:g}){const d=t,v=g,y=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],x=k=>{var s;const h=d.form.results[k.id];if(!h)return!1;switch(k.input_type){case"text":case"number":case"date":return!!h.note;case"select":case"radio":return!!h.status;case"image":return((s=h.images)==null?void 0:s.length)>0;default:return!1}},u=(k,h)=>{v("updateResult",{pointId:k,value:h})},m=k=>{v("saveResult",k)},I=(k,h)=>{v("removeImage",{pointId:k,imageIndex:h})};return(k,h)=>(o(),i("div",rt,[e("div",ot,[e("h2",nt,$(t.category.name),1)]),e("div",lt,[(o(!0),i(P,null,z(t.category.points,s=>{var j,U,q,L,A,E,n,r,a,p,S,w,V,B,D,F,T;return o(),i("div",{key:s.id,class:"space-y-4 pb-6 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",it,[e("label",ut,[K($(s.name)+" ",1),(j=s.settings)!=null&&j.is_required?(o(),i("span",dt,"*")):b("",!0)]),x(s)?(o(),i("span",ct," âœ“ ")):b("",!0)]),s.input_type==="text"?(o(),N(pe,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[c=>t.form.results[s.id].note=c,c=>u(s.id,c)],required:(U=s.settings)==null?void 0:U.is_required,"min-length":(q=s.settings)==null?void 0:q.min_length,"max-length":(L=s.settings)==null?void 0:L.max_length,pattern:(A=s.settings)==null?void 0:A.pattern,placeholder:((E=s.settings)==null?void 0:E.placeholder)||"Enter text",error:t.form.errors[`results.${s.id}.note`],onSave:c=>m(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):b("",!0),s.input_type==="number"?(o(),N(we,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[c=>t.form.results[s.id].note=c,c=>u(s.id,c)],required:(n=s.settings)==null?void 0:n.is_required,min:(r=s.settings)==null?void 0:r.min,max:(a=s.settings)==null?void 0:a.max,step:((p=s.settings)==null?void 0:p.step)||1,placeholder:((S=s.settings)==null?void 0:S.placeholder)||"Enter number",error:t.form.errors[`results.${s.id}.note`],onSave:c=>m(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):b("",!0),s.input_type==="date"?(o(),N(Ve,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[c=>t.form.results[s.id].note=c,c=>u(s.id,c)],required:(w=s.settings)==null?void 0:w.is_required,"min-date":(V=s.settings)==null?void 0:V.min_date,"max-date":(B=s.settings)==null?void 0:B.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:c=>m(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):b("",!0),s.input_type==="select"?(o(),N(je,{key:3,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[c=>t.form.results[s.id].status=c,c=>u(s.id,c)],required:(D=s.settings)==null?void 0:D.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:c=>m(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):b("",!0),s.input_type==="radio"?(o(),N(Be,{key:4,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[c=>t.form.results[s.id].status=c,c=>u(s.id,c)],required:(F=s.settings)==null?void 0:F.is_required,options:((T=s.settings)==null?void 0:T.radios)||y,error:t.form.errors[`results.${s.id}.status`],onSave:c=>m(s.id)},null,8,["modelValue","onUpdate:modelValue","required","options","error","onSave"])):b("",!0),s.input_type==="image"?(o(),N(at,{key:5,modelValue:t.form.results[s.id].images,"onUpdate:modelValue":[c=>t.form.results[s.id].images=c,c=>u(s.id,c)],error:t.form.errors[`results.${s.id}.images`],onSave:c=>m(s.id),onRemoveImage:c=>I(s.id,c)},null,8,["modelValue","onUpdate:modelValue","error","onSave","onRemoveImage"])):b("",!0)])}),128))])]))}},gt=G(mt,[["__scopeId","data-v-0537cb06"]]),vt={class:"container mx-auto px-4 py-2"},ht={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},pt={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},ft=["onClick","data-category-id"],bt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},xt={class:"relative overflow-hidden"},wt={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},yt={class:"mb-4"},kt={class:"mt-6"},St={class:"list-disc pl-5"},Vt={key:0},$t={key:1},It={class:"flex justify-end gap-4 mt-8"},_t=["disabled"],Ct={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},jt={__name:"InspectionForm",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(t){var E;const g=t,d=_(((E=g.categories[0])==null?void 0:E.id)||"summary"),v=_(0);_(null);const y=W(()=>d.value!=="summary"?g.categories.find(n=>n.id===d.value):null),u=oe((()=>{const n={};return g.categories.forEach(r=>{(r.points||[]).forEach(a=>{var S,w;const p=Array.isArray(g.existingResults)?g.existingResults.find(V=>V.point_id===a.id):null;n[a.id]={status:(p==null?void 0:p.status)||"",note:(p==null?void 0:p.note)||"",images:((w=(S=g.existingImages)==null?void 0:S[a.id])==null?void 0:w.map(V=>({image_path:V.image_path,preview:null})))||[]}})}),{inspection_id:g.inspection.id,results:n,overall_note:g.inspection.overall_note||""}})()),m=Y.debounce(()=>{H.post(route("inspections.save-overall-note"),{inspection_id:g.inspection.id,overall_note:u.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:n=>{console.error("Error menyimpan catatan keseluruhan:",n)}})},800),I=n=>n.points.every(r=>{var p;const a=u.results[r.id];if(!a)return!1;switch(r.input_type){case"text":case"number":case"date":return!!a.note;case"select":case"radio":return!!a.status;case"image":return((p=a.images)==null?void 0:p.length)>0;default:return!!a.status||!!a.note}}),k=n=>{if(n==="summary")v.value=g.categories.length;else{const r=g.categories.findIndex(a=>a.id===n);r>=0&&(v.value=r)}d.value=n},h=n=>{let r=v.value+n;const a=g.categories.length;r>=0&&r<=a&&(v.value=r,r===a?d.value="summary":d.value=g.categories[r].id)},s=()=>{let n=0,r=0;const a=V=>{n=V.changedTouches[0].screenX},p=V=>{r=V.changedTouches[0].screenX,S()},S=()=>{r<n-50?h(1):r>n+50&&h(-1)},w=document.querySelector(".relative.overflow-hidden");return w&&(w.addEventListener("touchstart",a,!1),w.addEventListener("touchend",p,!1)),()=>{w&&(w.removeEventListener("touchstart",a),w.removeEventListener("touchend",p))}},j=Y.debounce(async n=>{try{await H.post(route("inspections.save-result"),{inspection_id:g.inspection.id,point_id:n,status:u.results[n].status,note:u.results[n].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(r){console.error("Error menyimpan hasil:",r)}},500),U=({pointId:n,type:r,value:a})=>{u.results[n].hasOwnProperty(r)&&(u.results[n][r]=a),j(n)},q=async(n,r)=>{const a=n.target.files[0];if(!a)return;const p=URL.createObjectURL(a);try{const S=new FormData;S.append("inspection_id",g.inspection.id),S.append("point_id",r),S.append("image",a),await H.post(route("inspections.upload-image"),S,{preserveScroll:!0,onSuccess:w=>{var B;const V=((B=w.props.flash)==null?void 0:B.imagePath)||w.props.imagePath;V?u.results[r].images.push({image_path:V,preview:p}):console.error("Path gambar tidak dikembalikan dari unggahan, tidak dapat memperbarui UI.")},onError:w=>{console.error("Error mengunggah gambar:",w),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(S){console.error("Error mengunggah gambar:",S),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{n.target.value=""}},L=async(n,r)=>{const a=u.results[n].images[r];if(a)try{await H.delete(route("inspections.delete-image"),{data:{image_path:a.image_path,point_id:n,inspection_id:g.inspection.id},preserveScroll:!0,onSuccess:()=>{u.results[n].images.splice(r,1),a.preview&&URL.revokeObjectURL(a.preview)},onError:p=>{console.error("Error menghapus gambar:",p),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(p){console.error("Error menghapus gambar:",p),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},A=()=>{u.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{Q().props.flash.success="Inspeksi berhasil dikirim!"},onError:n=>{console.error("Kesalahan pengiriman:",n),Q().props.flash.error="Ada kesalahan dalam pengiriman Anda. Harap periksa semua bidang."}})};return ne(()=>{s()}),le(d,n=>{const r=document.querySelector(`.flex-shrink-0[data-category-id="${n}"]`);r&&r.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(n,r)=>(o(),i("div",vt,[e("div",ht,[e("div",pt,[(o(!0),i(P,null,z(t.categories,a=>(o(),i("button",{key:a.id,onClick:p=>k(a.id),class:X(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":d.value===a.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":d.value!==a.id}]),"data-category-id":a.id},[K($(a.name)+" ",1),I(a)?(o(),i("span",bt," âœ“ ")):b("",!0)],10,ft))),128)),e("button",{onClick:r[0]||(r[0]=a=>k("summary")),class:X(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":d.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":d.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),e("div",xt,[ie(me,{name:"category-slide",mode:"out-in"},{default:ue(()=>[y.value&&d.value!=="summary"?(o(),N(gt,{key:y.value.id,category:y.value,form:R(u),onSaveResult:R(j),onUpdateResult:U,onRemoveImage:L,onHandleImageUpload:q},null,8,["category","form","onSaveResult"])):d.value==="summary"?(o(),i("div",wt,[r[6]||(r[6]=e("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),e("div",yt,[r[3]||(r[3]=e("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),de(e("textarea",{id:"overall_note","onUpdate:modelValue":r[1]||(r[1]=a=>R(u).overall_note=a),onInput:r[2]||(r[2]=(...a)=>R(m)&&R(m)(...a)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[ce,R(u).overall_note]])]),e("div",kt,[r[4]||(r[4]=e("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Kategori:",-1)),e("ul",St,[(o(!0),i(P,null,z(t.categories,a=>(o(),i("li",{key:a.id,class:X({"text-green-600":I(a),"text-red-600":!I(a)})},[K($(a.name)+" ",1),I(a)?(o(),i("span",Vt,"(Selesai âœ“)")):(o(),i("span",$t,"(Belum Selesai âœ—)"))],2))),128))])]),e("div",It,[e("button",{type:"button",onClick:A,disabled:R(u).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[R(u).processing?(o(),i("svg",Ct,r[5]||(r[5]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):b("",!0),e("span",null,$(R(u).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,_t)])])):b("",!0)]),_:1})])]))}},Lt=G(jt,[["__scopeId","data-v-22fd310e"]]);export{Lt as default};
