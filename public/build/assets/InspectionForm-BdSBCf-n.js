import{e as c,o as n,a as e,f as k,t as P,d as U,C as J,D as $e,n as Z,k as ee,E as xe,g as oe,b as se,p as Ce,F as te,h as ae,j as Se,G as fe,l as ye,s as ke,c as O,x as Re,W as le,q as Ve,w as Me,u as G,T as Ue,B as we}from"./app-WLRSsGwh.js";import{l as be}from"./lodash-CUegu-7E.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Le={class:"mt-1"},Ne=["value","required","minlength","maxlength","pattern","placeholder"],Be={key:0,class:"mt-2 text-sm text-red-600"},Pe={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(s,{emit:x}){const l=s,h=x,p=b=>{h("update:modelValue",b.target.value),h("save",l.pointId)};return(b,i)=>(n(),c("div",Le,[e("input",{value:s.modelValue,onInput:p,type:"text",required:s.required,minlength:s.minLength,maxlength:s.maxLength,pattern:s.pattern,placeholder:s.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ne),s.error?(n(),c("p",Be,P(s.error),1)):k("",!0)]))}},je={class:"mt-1"},qe=["value","required","min","max","step","placeholder"],Te={key:0,class:"mt-2 text-sm text-red-600"},Ee={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(s,{emit:x}){const l=s,h=x,p=b=>{const i=b.target.value;h("update:modelValue",i),h("save",l.pointId)};return(b,i)=>(n(),c("div",je,[e("input",{value:s.modelValue,onInput:p,type:"number",required:s.required,min:s.min,max:s.max,step:s.step,placeholder:s.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,qe),s.error?(n(),c("p",Te,P(s.error),1)):k("",!0)]))}},Fe={class:"mt-1"},Ae=["value","required","min","max"],De={key:0,class:"mt-2 text-sm text-red-600"},We={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(s,{emit:x}){const l=s,h=x,p=b=>{h("update:modelValue",b.target.value),h("save",l.pointId)};return(b,i)=>(n(),c("div",Fe,[e("input",{value:s.modelValue,onChange:p,type:"date",required:s.required,min:s.minDate,max:s.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ae),s.error?(n(),c("p",De,P(s.error),1)):k("",!0)]))}},ze={class:"mt-1"},He=["value","required"],Ge={key:0,class:"mt-2 text-sm text-red-600"},Xe={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(s,{emit:x}){const l=s,h=x,p=b=>{h("update:modelValue",b.target.value),h("save",l.pointId)};return(b,i)=>(n(),c("div",ze,[e("select",{value:s.modelValue,onChange:p,required:s.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},i[0]||(i[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,He),s.error?(n(),c("p",Ge,P(s.error),1)):k("",!0)]))}},Ke=Y(Xe,[["__scopeId","data-v-c34a74db"]]),Oe={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Je={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Ye={class:"flex flex-row space-x-4 mb-6"},Qe={class:"mt-4 text-right"},Ze={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(s){return(x,l)=>s.show?(n(),c("div",Oe,[e("div",Je,[l[5]||(l[5]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),e("div",Ye,[e("button",{onClick:l[0]||(l[0]=h=>x.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},l[3]||(l[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:l[1]||(l[1]=h=>x.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},l[4]||(l[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",Qe,[e("button",{onClick:l[2]||(l[2]=h=>x.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):k("",!0)}},et={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},tt={class:"webcam-content-box"},at={class:"webcam-header"},st={class:"flex gap-4"},ot=["disabled"],rt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},lt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},nt={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},it=["disabled"],dt={key:0,class:"screen-flash-overlay"},ut={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object},emits:["close","photoCaptured"],setup(s,{emit:x}){const l=s,h=x,p=U(null),b=U(null);let i=null,y=null;const v=U("environment"),g=U(!1),_=U(!1),o=U(!1),L=U(!1),F=async()=>{i&&i.getTracks().forEach(t=>t.stop()),o.value=!1;try{const t={facingMode:v.value,width:{ideal:1280},height:{ideal:960},aspectRatio:{exact:l.aspectRatio}};v.value==="environment"&&(t.advanced=[{focusMode:"continuous"}]),i=await navigator.mediaDevices.getUserMedia({video:t}),y=i.getVideoTracks()[0],p.value.srcObject=i,p.value.onloadedmetadata=async()=>{p.value.style.width="100%",p.value.style.height="auto",p.value.style.objectFit="cover",await $()}}catch(t){console.error("Error accessing camera: ",t),alert("Failed to access camera. Please ensure camera permissions are granted and try again."),h("close")}},C=()=>{i&&i.getTracks().forEach(t=>t.stop()),h("close")},$=async()=>{if(!y)return;const d=(await navigator.mediaDevices.enumerateDevices()).filter(R=>R.kind==="videoinput");g.value=d.length>1;const V=y.getCapabilities();_.value=V.torch||V.fillLightMode&&V.fillLightMode.includes("torch")},S=async()=>{if(!(!y||!l.settings.enable_flash)){if(v.value==="user"){o.value=!o.value;return}try{if(y.getCapabilities().torch)await y.applyConstraints({advanced:[{torch:!o.value}]}),o.value=!o.value;else{console.warn("Torch API not directly supported, checking fillLightMode.");const t=y.getCapabilities();t.fillLightMode&&t.fillLightMode.includes("torch")?(await y.applyConstraints({fillLightMode:o.value?"none":"torch"}),o.value=!o.value):(alert("Flash/Torch is not supported on this camera."),_.value=!1)}}catch(t){console.error("Error toggling flash: ",t),alert("Could not toggle flash. Feature might not be supported."),_.value=!1}}},B=async()=>{!g.value||!l.settings.enable_camera_switch||(v.value=v.value==="environment"?"user":"environment",await F())},m=async()=>{if(!y)return;const t=y.getCapabilities();if(t.focusMode&&t.focusMode.includes("continuous"))try{await y.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(d){console.warn("Failed to apply continuous focus constraint:",d)}else console.log("Autofocus not explicitly controllable or not supported.")},u=async()=>{if(!p.value||!b.value)return;v.value==="user"&&o.value&&(L.value=!0,await new Promise(w=>setTimeout(w,100)),L.value=!1);const t=p.value,d=b.value,V=d.getContext("2d"),R=t.videoWidth,N=t.videoHeight;let q=R,D=N,z=0,H=0;R/N>l.aspectRatio?(q=N*l.aspectRatio,z=(R-q)/2):R/N<l.aspectRatio&&(D=R/l.aspectRatio,H=(N-D)/2),d.width=q,d.height=D,V.drawImage(t,z,H,q,D,0,0,d.width,d.height),d.toBlob(w=>{if(w){const K=new File([w],`captured_image_${Date.now()}.png`,{type:"image/png"});h("photoCaptured",K)}else console.error("Failed to convert canvas to blob.")},"image/png")};return J(()=>l.show,t=>{t?F():C()}),$e(()=>{i&&i.getTracks().forEach(t=>t.stop())}),(t,d)=>s.show?(n(),c("div",et,[e("div",tt,[e("div",at,[e("button",{onClick:C,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},d[0]||(d[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",st,[s.settings.enable_flash?(n(),c("button",{key:0,onClick:S,disabled:!_.value,class:Z(["p-2 rounded-full text-white",{"bg-gray-700":o.value,"hover:bg-gray-700":_.value,"opacity-50 cursor-not-allowed":!_.value}])},[_.value?o.value?(n(),c("svg",lt,d[2]||(d[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):(n(),c("svg",nt,d[3]||(d[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6"},null,-1)]))):(n(),c("svg",rt,d[1]||(d[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.102 1.101m-.757 4.898l-4 4L9.828 9.828m4.899-.757l4-4L14.172 14.172"},null,-1)])))],10,ot)):k("",!0),s.settings.enable_camera_switch?(n(),c("button",{key:1,onClick:B,disabled:!g.value,class:Z(["p-2 rounded-full text-white hover:bg-gray-700",{"opacity-50 cursor-not-allowed":!g.value}])},d[4]||(d[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8h16M4 16h16M6 4h.01M6 20h.01M10 4h.01M10 20h.01M14 4h.01M14 20h.01M18 4h.01M18 20h.01"})],-1)]),10,it)):k("",!0)])]),e("div",{class:"webcam-video-container",onClick:m},[e("video",{ref_key:"webcamVideo",ref:p,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:b,class:"hidden"},null,512),L.value?(n(),c("div",dt)):k("",!0)]),e("div",{class:"webcam-footer"},[e("button",{onClick:u,class:"capture-button"})])])])):k("",!0)}},ct=Y(ut,[["__scopeId","data-v-608abcc7"]]),gt={key:0,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center"},mt={class:"w-full h-full flex flex-col"},vt={class:"flex justify-between items-center p-4 bg-black bg-opacity-50 text-white"},ht={class:"text-lg font-medium"},pt={class:"flex-1 flex items-center justify-center overflow-hidden relative"},ft=["src"],wt={class:"flex flex-col gap-2 p-4 bg-black bg-opacity-50"},bt={class:"flex justify-between"},xt=["disabled"],yt={key:1,class:"px-4 py-2 bg-indigo-400 text-white rounded-lg cursor-not-allowed flex items-center justify-center",disabled:""},kt={key:0,class:"text-center mt-2"},_t=["disabled"],It={__name:"ImagePreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos"],setup(s,{emit:x}){const l=s,h=x,p=U(0),b=U([]),i=U(0),y=U(0),v=ee(()=>b.value.length>0?b.value[p.value]:null);J(()=>l.images,t=>{b.value=t.map(d=>({...d})),l.show&&t.length>0?l.initialIndex===-1||l.initialIndex>=t.length?p.value=t.length-1:p.value=l.initialIndex:p.value=0,t.length===0&&l.show&&m()},{deep:!0,immediate:!0});const g=t=>t.preview||(t.image_path?`/${t.image_path}`:""),_=()=>{v.value&&(v.value.rotation=(v.value.rotation+90)%360)},o=()=>{p.value<b.value.length-1?p.value++:p.value=0},L=()=>{p.value>0?p.value--:p.value=b.value.length-1},F=t=>{i.value=t.touches[0].clientX},C=t=>{y.value=t.touches[0].clientX},$=()=>{i.value-y.value>50?o():y.value-i.value>50&&L(),i.value=0,y.value=0},S=()=>{v.value&&h("removePreviewImage",v.value)},B=()=>{h("saveImages",b.value)},m=()=>{h("close")},u=()=>{h("triggerAddMorePhotos")};return J(()=>l.show,t=>{t?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open")},{immediate:!0}),(t,d)=>s.show?(n(),c("div",gt,[e("div",mt,[e("div",vt,[e("button",{onClick:m,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},d[0]||(d[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",ht,"Preview ("+P(p.value+1)+"/"+P(b.value.length)+")",1),e("button",{onClick:_,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-10 transition-colors"},d[1]||(d[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))]),e("div",pt,[e("div",{class:"w-full h-full flex items-center justify-center",onTouchstart:F,onTouchmove:C,onTouchend:$},[v.value?(n(),c("img",{key:0,src:g(v.value),class:"max-w-full max-h-full object-contain",style:xe({transform:`rotate(${v.value.rotation}deg)`})},null,12,ft)):k("",!0)],32),b.value.length>1?(n(),c("button",{key:0,onClick:L,class:"absolute left-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},d[2]||(d[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):k("",!0),b.value.length>1?(n(),c("button",{key:1,onClick:o,class:"absolute right-4 p-2 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},d[3]||(d[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):k("",!0)]),e("div",wt,[e("div",bt,[e("button",{onClick:S,class:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",disabled:s.isUploading}," Hapus ",8,xt),s.isUploading?(n(),c("button",yt,d[4]||(d[4]=[oe(" Menyimpan"),e("span",{class:"loading-dots ml-1"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1)]))):(n(),c("button",{key:0,onClick:B,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Simpan "+P(b.value.length),1))]),s.allowMultiple&&b.value.length<s.maxFiles?(n(),c("div",kt,[e("button",{onClick:u,class:"inline-block px-4 py-2 rounded-lg text-sm font-medium bg-indigo-700 text-white hover:bg-indigo-800 transition-colors cursor-pointer",disabled:s.isUploading}," + Tambah Foto ",8,_t)])):k("",!0)])])])):k("",!0)}},$t=Y(It,[["__scopeId","data-v-c92a6be5"]]),Ct=["multiple","disabled"],St=["disabled"],Rt={key:1,class:"block w-full border-2 border-dashed rounded-lg transition-colors duration-200 border-indigo-300 bg-indigo-50 h-auto p-2","aria-label":"Image gallery"},Vt={class:"grid grid-cols-3 gap-2"},Mt=["onClick"],Ut=["src"],Lt={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Nt={key:0},Bt={key:1,class:"ml-1"},Pt=["onClick","disabled"],jt=["disabled"],qt={key:2,class:"mt-1 text-xs text-red-600"},Tt={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!1},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0})}},emits:["update:modelValue","save","removeImage","uploaded"],setup(s,{emit:x}){const l=s,h=x,p=U(null),b=U(null),i=U(!1),y=U(!1),v=U(!1),g=U([]),_=U(0),o=U(!1),L=ee(()=>Number(l.settings.max_files)>1),F=ee(()=>{const r=l.settings.camera_aspect_ratio.split(":");if(r.length===2){const f=parseFloat(r[0]),a=parseFloat(r[1]);if(!isNaN(f)&&!isNaN(a)&&a!==0)return f/a}return 4/3}),C=ee(()=>{const r=[],f=new Set;for(const a of g.value)a.id&&f.add(a.id),r.push(a);for(const a of l.modelValue)f.has(a.id)||r.push({...a,rotation:a.rotation||0,isNew:!1,preview:a.preview||(a.image_path?`/${a.image_path}`:null)});return r}),$=r=>r.preview||(r.image_path?`/${r.image_path}`:""),S=r=>!r.width||!r.height||r.width===0||r.height===0?{paddingBottom:"100%",position:"relative"}:{paddingBottom:`${r.height/r.width*100}%`,position:"relative"},B=()=>{v.value&&(v.value=!1),i.value=!0},m=()=>{i.value=!1,p.value.click()},u=()=>{i.value=!1,y.value=!0},t=()=>{i.value=!1,C.value.length>0&&(v.value=!0)},d=()=>{y.value=!1,C.value.length>0&&(v.value=!0)},V=()=>{v.value=!1,g.value.forEach(r=>{r.preview&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview)}),g.value=[]},R=r=>new Promise(f=>{const a=new FileReader;a.onload=I=>{const M=new Image;M.onload=()=>{f({file:r,preview:URL.createObjectURL(r),rotation:0,width:M.naturalWidth,height:M.naturalHeight,isNew:!0})},M.onerror=()=>{console.error("Failed to load image for dimensions:",r.name),f({file:r,preview:URL.createObjectURL(r),rotation:0,width:0,height:0,isNew:!0})},M.src=I.target.result},a.readAsDataURL(r)}),N=r=>{const f=Array.from(r.target.files);if(!f.length){i.value=!1,C.value.length>0&&(v.value=!0);return}Promise.all(f.map(R)).then(a=>{const I=C.value.length,M=l.settings.max_files-I,E=L.value?a.slice(0,M):a.slice(0,1);L.value?g.value.push(...E):(g.value.forEach(A=>A.preview&&A.preview.startsWith("blob:")&&URL.revokeObjectURL(A.preview)),g.value=E),i.value=!1,E.length>0?(_.value=C.value.length-E.length,_.value<0&&(_.value=0),v.value=!0):C.value.length>0&&(v.value=!0),r.target.value=""}).catch(a=>{console.error("Error processing selected images:",a),alert("Failed to process selected images. Please try again."),i.value=!1,C.value.length>0&&(v.value=!0)})},q=r=>{const f=C.value.length;if(!L.value||f<l.settings.max_files){const a=new Image;a.onload=()=>{const I={file:r,preview:URL.createObjectURL(r),rotation:0,width:a.naturalWidth,height:a.naturalHeight,isNew:!0};L.value?g.value.push(I):(g.value.forEach(M=>M.preview&&M.preview.startsWith("blob:")&&URL.revokeObjectURL(M.preview)),g.value=[I]),y.value=!1,i.value=!1,_.value=C.value.length-1,v.value=!0},a.onerror=()=>{console.error("Failed to load captured image for dimensions.");const I={file:r,preview:URL.createObjectURL(r),rotation:0,width:0,height:0,isNew:!0};L.value?g.value.push(I):(g.value.forEach(M=>M.preview&&M.preview.startsWith("blob:")&&URL.revokeObjectURL(M.preview)),g.value=[I]),_.value=C.value.length-1,y.value=!1,i.value=!1,v.value=!0},a.src=URL.createObjectURL(r)}else alert(`Maksimum ${l.settings.max_files} file diizinkan.`),y.value=!1,i.value=!1,C.value.length>0&&(v.value=!0)},D=(r=0)=>{_.value=r,v.value=!0},z=r=>new Promise(f=>{if(r.rotation===0||!b.value){if(!r.isNew&&!r.file){f({file:null,width:r.width,height:r.height,isOriginal:!0});return}f({file:r.file,width:r.width,height:r.height});return}const a=new Image;a.onload=()=>{const I=b.value,M=I.getContext("2d"),E=a.width,A=a.height;let j,X;r.rotation===90||r.rotation===270?(j=A,X=E):(j=E,X=A),I.width=j,I.height=X,M.clearRect(0,0,I.width,I.height),M.translate(I.width/2,I.height/2),M.rotate(r.rotation*Math.PI/180),M.drawImage(a,-E/2,-A/2,E,A),M.setTransform(1,0,0,1,0,0),I.toBlob(W=>{const Q=new File([W],r.file?r.file.name:`rotated_image_${Date.now()}.png`,{type:r.file?r.file.type:"image/png"});f({file:Q,width:j,height:X})},r.file?r.file.type:"image/png")},a.onerror=()=>{console.error("Failed to load image for rotation processing:",r.preview),f({file:r.file,width:r.width,height:r.height})},a.src=r.preview}),H=async r=>{o.value=!0;const f=[];if(!l.pointId){alert("Error: Point ID is missing. Cannot upload image. (Check parent component)"),o.value=!1;return}console.log("Uploading for Inspection ID:",l.inspectionId,"Point ID:",l.pointId);try{for(const a of r){if(!a.isNew&&a.rotation===0&&a.id&&a.image_path){f.push({id:a.id,image_path:a.image_path,width:a.width,height:a.height,rotation:0,preview:a.preview});continue}const{file:I,width:M,height:E,isOriginal:A}=await z(a);if(A&&!a.isNew){f.push({id:a.id,image_path:a.image_path,width:a.width,height:a.height,rotation:0,preview:a.preview});continue}const j=new FormData;j.append("inspection_id",l.inspectionId),j.append("point_id",l.pointId),j.append("image",I),j.append("width",M),j.append("height",E),j.append("rotation",0),a.id&&!a.isNew&&j.append("image_id",a.id);const W=(await fe.post(route("inspections.upload-image"),j,{headers:{"Content-Type":"multipart/form-data"}})).data.image,Q=W.image_path,re=W.public_url;f.push({id:W.id,image_path:Q,width:W.width,height:W.height,rotation:W.rotation,preview:re}),a.preview&&a.preview.startsWith("blob:")&&URL.revokeObjectURL(a.preview)}h("update:modelValue",f),h("save",l.pointId),h("uploaded",{pointId:l.pointId,images:f}),V()}catch(a){if(console.error("Error during image processing/upload:",a),a.response&&a.response.data&&a.response.data.message)alert(`Failed to save images: ${a.response.data.message}`);else if(a.response&&a.response.data&&a.response.data.errors){const I=Object.values(a.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${I}`)}else alert(`Failed to save images: ${a.message}`)}finally{o.value=!1}},w=r=>{const f=C.value[r];if(f){if(f.id&&!f.isNew)K(f);else{const a=g.value.findIndex(I=>I.preview===f.preview&&I.isNew||I.id&&I.id===f.id);if(a!==-1){const I=g.value.splice(a,1)[0];I.preview&&I.preview.startsWith("blob:")&&URL.revokeObjectURL(I.preview)}}_.value>=C.value.length&&(_.value=Math.max(0,C.value.length-1)),C.value.length===0&&V()}},K=async r=>{if(r.id||r.image_path)try{await fe.delete(route("inspections.delete-image"),{data:{image_id:r.id,image_path:r.image_path}})}catch(a){console.error("Error deleting image from server:",a),a.response&&a.response.data&&a.response.data.message?alert(`Failed to delete image from server: ${a.response.data.message}`):alert(`Failed to delete image from server: ${a.message}`);return}r.preview&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview);const f=l.modelValue.filter(a=>a.id!==r.id);h("update:modelValue",f),g.value=g.value.filter(a=>a.isNew&&r.isNew?a.preview!==r.preview:a.id!==r.id),h("removeImage",{image:r}),v.value&&C.value.length===0?V():v.value&&_.value>=C.value.length&&(_.value=Math.max(0,C.value.length-1))};return(r,f)=>(n(),c("div",null,[e("input",{ref_key:"galleryInput",ref:p,type:"file",accept:"image/*",class:"hidden",onChange:N,multiple:L.value,disabled:o.value},null,40,Ct),e("canvas",{ref_key:"processingCanvas",ref:b,class:"hidden"},null,512),C.value.length===0?(n(),c("label",{key:0,onClick:B,class:Z(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:o.value},f[0]||(f[0]=[Ce('<div class="h-full flex flex-col items-center justify-center p-4 text-center" data-v-8e61fda7><svg class="w-8 h-8 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-8e61fda7><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" data-v-8e61fda7></path></svg><p class="text-sm text-gray-600 font-medium" data-v-8e61fda7>Upload Image</p><p class="text-xs text-gray-500" data-v-8e61fda7>Click to open options</p></div>',1)]),8,St)):(n(),c("div",Rt,[e("div",Vt,[(n(!0),c(te,null,ae(C.value,(a,I)=>(n(),c("div",{key:a.id||a.preview,class:"relative w-full overflow-hidden rounded-md border border-gray-200 cursor-pointer",style:xe(S(a)),onClick:M=>D(I)},[e("img",{src:$(a),class:"absolute top-0 left-0 w-full h-full object-cover"},null,8,Ut),a.isNew||a.rotation!==0?(n(),c("div",Lt,[a.isNew?(n(),c("span",Nt,"BARU")):k("",!0),a.rotation!==0?(n(),c("span",Bt,"ROTASI")):k("",!0)])):k("",!0),e("button",{onClick:Se(M=>K(a),["stop"]),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm hover:bg-red-600 transition-colors z-10","aria-label":"Remove image",disabled:o.value}," × ",8,Pt)],12,Mt))),128)),L.value&&C.value.length<s.settings.max_files?(n(),c("div",{key:0,class:"flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors",onClick:B,disabled:o.value},f[1]||(f[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,jt)):k("",!0)])])),s.error?(n(),c("p",qt,P(s.error),1)):k("",!0),se(Ze,{show:i.value,onClose:t,onOpenWebcam:u,onTriggerGallery:m},null,8,["show"]),se(ct,{show:y.value,"aspect-ratio":F.value,settings:s.settings,onClose:d,onPhotoCaptured:q},null,8,["show","aspect-ratio","settings"]),se($t,{show:v.value,images:C.value,"initial-index":_.value,"allow-multiple":L.value,"max-files":s.settings.max_files,"is-uploading":o.value,onClose:V,onSaveImages:H,onRemovePreviewImage:w,onTriggerAddMorePhotos:B},null,8,["show","images","initial-index","allow-multiple","max-files","is-uploading"])]))}},_e=Y(Tt,[["__scopeId","data-v-8e61fda7"]]),Et={class:"mt-2 space-y-4"},Ft={class:"flex flex-wrap sm:flex-nowrap overflow-x-auto pb-2 gap-4 w-full justify-start sm:justify-start"},At=["name","value","checked","onChange","required"],Dt={class:"px-4 py-2 border rounded-lg peer-checked:border-indigo-500 peer-checked:bg-indigo-50 peer-checked:text-indigo-700 border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors whitespace-nowrap"},Wt={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50 shadow-sm"},zt={key:0,class:"mb-3"},Ht={class:"text-gray-900 text-sm bg-white p-2 rounded-md border border-gray-200"},Gt={key:1},Xt={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"},Kt=["src","alt","onClick"],Ot={key:2,class:"text-sm text-gray-500 mt-2"},Jt={key:1,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50 p-4"},Yt={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Qt={class:"p-6 space-y-6"},Zt={class:"flex justify-between items-center border-b pb-4"},ea={class:"text-lg font-medium text-gray-900"},ta={key:0,class:"border rounded-lg p-4 bg-gray-50"},aa={key:1,class:"border rounded-lg p-4 bg-gray-50"},sa={class:"block text-sm font-medium text-gray-700 mb-2"},oa={class:"text-xs text-gray-500 float-right"},ra=["placeholder","minlength","maxlength"],la={key:2,class:"mt-2 text-sm text-red-600"},na={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number],inspectionId:{type:[String,Number],required:!1},options:{type:Array,default:()=>[{value:"good",label:"Baik",settings:{show_textarea:!1,show_image_upload:!1}},{value:"bad",label:"Tidak Normal",settings:{show_textarea:!0,show_image_upload:!0,textarea_placeholder:"Jelaskan kondisi ini lebih lanjut",textarea_min_length:10,textarea_max_length:400,max_files:3,max_size:2048,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0}},{value:"na",label:"N/A",settings:{show_textarea:!1,show_image_upload:!1}}]},inspectionResult:{type:Object,default:()=>({value:null,notes:"",images:[]})}},emits:["update:modelValue","update:inspectionResult","save"],setup(s,{emit:x}){const l=s,h=x,p=U(!1),b=U(""),i=U([]),y=U(l.modelValue),v=U(l.inspectionResult||{value:null,notes:"",images:[]}),g=ee(()=>l.options.find($=>$.value===y.value));J(()=>l.modelValue,$=>{y.value=$}),J(()=>l.inspectionResult,$=>{v.value=$||{value:null,notes:"",images:[]}},{immediate:!0,deep:!0}),J(p,$=>{$&&(b.value=v.value.notes||"",i.value=v.value.images?[...v.value.images]:[])});const _=$=>{if(y.value=$.value,h("update:modelValue",$.value),!$.settings.show_textarea&&!$.settings.show_image_upload){const S={value:$.value,notes:null,images:[]};h("update:inspectionResult",S),v.value=S,h("save",l.pointId),p.value=!1}else p.value=!0},o=({image:$})=>{console.log("Gambar dihapus dari InputImage (melalui event 'remove-image'):",$)},L=()=>{p.value=!1},F=()=>{var S,B,m,u;const $={value:y.value,notes:null,images:[]};(B=(S=g.value)==null?void 0:S.settings)!=null&&B.show_textarea&&($.notes=b.value),(u=(m=g.value)==null?void 0:m.settings)!=null&&u.show_image_upload&&($.images=i.value),h("update:inspectionResult",$),v.value=$,h("save",l.pointId),L()},C=$=>{console.log("Membuka preview gambar:",$.url||$.path)};return($,S)=>{var B,m,u,t,d,V,R,N,q,D,z,H,w,K,r,f,a,I,M,E,A,j,X,W,Q,re,ne,ie,de,ue,ce,ge,me,ve,he,pe;return n(),c("div",Et,[e("div",Ft,[(n(!0),c(te,null,ae(s.options,T=>(n(),c("label",{key:T.value,class:"cursor-pointer flex-shrink-0"},[e("input",{type:"radio",name:"radio-"+s.pointId,value:T.value,checked:s.modelValue===T.value,onChange:Ie=>_(T),class:"hidden peer",required:s.required},null,40,At),e("div",Dt,P(T.label),1)]))),128))]),s.modelValue===((B=g.value)==null?void 0:B.value)&&((u=(m=g.value)==null?void 0:m.settings)!=null&&u.show_textarea||(d=(t=g.value)==null?void 0:t.settings)!=null&&d.show_image_upload)?(n(),c("div",Wt,[S[4]||(S[4]=e("h4",{class:"text-md font-semibold text-gray-800 mb-2"},"Detail Pilihan Anda:",-1)),v.value.notes&&((R=(V=g.value)==null?void 0:V.settings)!=null&&R.show_textarea)?(n(),c("div",zt,[S[2]||(S[2]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan:",-1)),e("p",Ht,P(v.value.notes),1)])):k("",!0),v.value.images&&v.value.images.length>0&&((q=(N=g.value)==null?void 0:N.settings)!=null&&q.show_image_upload)?(n(),c("div",Gt,[S[3]||(S[3]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Gambar Terlampir:",-1)),e("div",Xt,[(n(!0),c(te,null,ae(v.value.images,T=>(n(),c("div",{key:T.id,class:"relative group aspect-w-1 aspect-h-1 w-full overflow-hidden rounded-lg bg-gray-200 flex items-center justify-center"},[e("img",{src:T.url||T.path,alt:T.name||"Gambar inspeksi",class:"object-cover w-full h-full",onClick:Ie=>C(T)},null,8,Kt)]))),128))])])):(z=(D=g.value)==null?void 0:D.settings)!=null&&z.show_image_upload&&(!v.value.images||v.value.images.length===0)?(n(),c("p",Ot," Belum ada gambar yang dilampirkan. ")):k("",!0)])):k("",!0),p.value?(n(),c("div",Jt,[e("div",Yt,[e("div",Qt,[e("div",Zt,[e("h3",ea,P((H=g.value)==null?void 0:H.label)+" - Detail Inspeksi ",1),e("button",{onClick:L,class:"text-gray-400 hover:text-gray-500"},S[5]||(S[5]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),(K=(w=g.value)==null?void 0:w.settings)!=null&&K.show_image_upload?(n(),c("div",ta,[S[6]||(S[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Upload Images ",-1)),se(_e,{modelValue:i.value,"onUpdate:modelValue":S[0]||(S[0]=T=>i.value=T),"point-id":s.pointId,"inspection-id":s.inspectionId,settings:{max_files:((f=(r=g.value)==null?void 0:r.settings)==null?void 0:f.image_max_files)||1,max_size:((I=(a=g.value)==null?void 0:a.settings)==null?void 0:I.image_max_size)||2048,allowed_types:((E=(M=g.value)==null?void 0:M.settings)==null?void 0:E.image_allowed_types)||["jpg","png"],camera_aspect_ratio:((j=(A=g.value)==null?void 0:A.settings)==null?void 0:j.camera_aspect_ratio)||"3:4",enable_flash:((W=(X=g.value)==null?void 0:X.settings)==null?void 0:W.enable_flash)!==void 0?g.value.settings.enable_flash:!0,enable_camera_switch:((re=(Q=g.value)==null?void 0:Q.settings)==null?void 0:re.enable_camera_switch)!==void 0?g.value.settings.enable_camera_switch:!0},onRemoveImage:o},null,8,["modelValue","point-id","inspection-id","settings"])])):k("",!0),(ie=(ne=g.value)==null?void 0:ne.settings)!=null&&ie.show_textarea?(n(),c("div",aa,[e("label",sa,[S[7]||(S[7]=oe(" Additional Notes ")),e("span",oa,P(b.value.length)+"/"+P(((ue=(de=g.value)==null?void 0:de.settings)==null?void 0:ue.textarea_max_length)||400),1)]),ye(e("textarea",{"onUpdate:modelValue":S[1]||(S[1]=T=>b.value=T),placeholder:((ge=(ce=g.value)==null?void 0:ce.settings)==null?void 0:ge.textarea_placeholder)||"Enter your notes here...",minlength:(ve=(me=g.value)==null?void 0:me.settings)==null?void 0:ve.textarea_min_length,maxlength:(pe=(he=g.value)==null?void 0:he.settings)==null?void 0:pe.textarea_max_length,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",rows:"4"},null,8,ra),[[ke,b.value]])])):k("",!0),e("div",{class:"flex justify-end space-x-3 pt-4 border-t"},[e("button",{onClick:L,type:"button",class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{onClick:F,type:"button",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700"}," Simpan ")])])])])):k("",!0),s.error?(n(),c("p",la,P(s.error),1)):k("",!0)])}}},ia=Y(na,[["__scopeId","data-v-1427582e"]]),da={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},ua={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},ca={class:"text-xl font-semibold text-indigo-700"},ga={class:"p-4 space-y-4"},ma={class:"flex items-start justify-between"},va={class:"block text-sm font-medium text-gray-700"},ha={key:0,class:"text-red-500"},pa={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},fa={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:[String,Number]},emits:["saveResult","updateResult","removeImage"],setup(s,{emit:x}){const l=s,h=x,p=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],b=g=>{var o;const _=l.form.results[g.id];if(!_)return!1;switch(g.input_type){case"text":case"number":case"date":return!!_.note;case"select":case"radio":return!!_.status;case"image":return((o=_.images)==null?void 0:o.length)>0;default:return!1}},i=(g,_)=>{h("updateResult",{pointId:g,value:_})},y=g=>{h("saveResult",g)},v=(g,_)=>{h("removeImage",{pointId:g,imageIndex:_})};return(g,_)=>(n(),c("div",da,[e("div",ua,[e("h2",ca,P(s.category.name),1)]),e("div",ga,[(n(!0),c(te,null,ae(s.category.points,o=>{var L,F,C,$,S,B,m,u,t,d,V,R,N,q,D,z,H;return n(),c("div",{key:o.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",ma,[e("label",va,[oe(P(o.name)+" ",1),(L=o.settings)!=null&&L.is_required?(n(),c("span",ha,"*")):k("",!0)]),b(o)?(n(),c("span",pa," ✓ ")):k("",!0)]),o.input_type==="text"?(n(),O(Pe,{key:0,modelValue:s.form.results[o.id].note,"onUpdate:modelValue":[w=>s.form.results[o.id].note=w,w=>i(o.id,w)],required:(F=o.settings)==null?void 0:F.is_required,"min-length":(C=o.settings)==null?void 0:C.min_length,"max-length":($=o.settings)==null?void 0:$.max_length,pattern:(S=o.settings)==null?void 0:S.pattern,placeholder:((B=o.settings)==null?void 0:B.placeholder)||"Enter text",error:s.form.errors[`results.${o.id}.note`],onSave:w=>y(o.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):k("",!0),o.input_type==="number"?(n(),O(Ee,{key:1,modelValue:s.form.results[o.id].note,"onUpdate:modelValue":[w=>s.form.results[o.id].note=w,w=>i(o.id,w)],required:(m=o.settings)==null?void 0:m.is_required,min:(u=o.settings)==null?void 0:u.min,max:(t=o.settings)==null?void 0:t.max,step:((d=o.settings)==null?void 0:d.step)||1,placeholder:((V=o.settings)==null?void 0:V.placeholder)||"Enter number",error:s.form.errors[`results.${o.id}.note`],onSave:w=>y(o.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):k("",!0),o.input_type==="date"?(n(),O(We,{key:2,modelValue:s.form.results[o.id].note,"onUpdate:modelValue":[w=>s.form.results[o.id].note=w,w=>i(o.id,w)],required:(R=o.settings)==null?void 0:R.is_required,"min-date":(N=o.settings)==null?void 0:N.min_date,"max-date":(q=o.settings)==null?void 0:q.max_date,error:s.form.errors[`results.${o.id}.note`],onSave:w=>y(o.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):k("",!0),o.input_type==="select"?(n(),O(Ke,{key:3,modelValue:s.form.results[o.id].status,"onUpdate:modelValue":[w=>s.form.results[o.id].status=w,w=>i(o.id,w)],required:(D=o.settings)==null?void 0:D.is_required,error:s.form.errors[`results.${o.id}.status`],onSave:w=>y(o.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):k("",!0),o.input_type==="radio"?(n(),O(ia,{key:4,modelValue:s.form.results[o.id].status,"onUpdate:modelValue":[w=>s.form.results[o.id].status=w,w=>i(o.id,w)],required:(z=o.settings)==null?void 0:z.is_required,"point-id":o.id,settings:o.settings,options:((H=o.settings)==null?void 0:H.radios)||p,error:s.form.errors[`results.${o.id}.status`],onSave:w=>y(o.id)},null,8,["modelValue","onUpdate:modelValue","required","point-id","settings","options","error","onSave"])):k("",!0),o.input_type==="image"?(n(),O(_e,{key:5,modelValue:s.form.results[o.id].images,"onUpdate:modelValue":[w=>s.form.results[o.id].images=w,w=>i(o.id,w)],error:s.form.errors[`results.${o.id}.images`],"inspection-id":s.inspectionId,"point-id":o.id,settings:o.settings,onSave:w=>y(o.id),onRemoveImage:w=>v(o.id,w)},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","settings","onSave","onRemoveImage"])):k("",!0)])}),128))])]))}},wa=Y(fa,[["__scopeId","data-v-959459ef"]]),ba={class:"container mx-auto px-4 py-2"},xa={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},ya={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},ka=["onClick","data-category-id"],_a={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ia={class:"relative overflow-hidden"},$a={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},Ca={class:"mb-4"},Sa={class:"mt-6"},Ra={class:"list-disc pl-5"},Va={key:0},Ma={key:1},Ua={class:"flex justify-end gap-4 mt-8"},La=["disabled"],Na={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ba={__name:"InspectionForm",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(s){var B;const x=s,l=U(((B=x.categories[0])==null?void 0:B.id)||"summary"),h=U(0);U(null);const p=ee(()=>l.value!=="summary"?x.categories.find(m=>m.id===l.value):null),i=Re((()=>{const m={};return x.categories.forEach(u=>{(u.points||[]).forEach(t=>{var V,R;const d=Array.isArray(x.existingResults)?x.existingResults.find(N=>N.point_id===t.id):null;m[t.id]={status:(d==null?void 0:d.status)||"",note:(d==null?void 0:d.note)||"",images:((R=(V=x.existingImages)==null?void 0:V[t.id])==null?void 0:R.map(N=>({image_path:N.image_path,preview:null})))||[]}})}),{inspection_id:x.inspection.id,results:m,overall_note:x.inspection.overall_note||""}})()),y=be.debounce(()=>{le.post(route("inspections.save-overall-note"),{inspection_id:x.inspection.id,overall_note:i.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:m=>{console.error("Error menyimpan catatan keseluruhan:",m)}})},800),v=m=>m.points.every(u=>{var d;const t=i.results[u.id];if(!t)return!1;switch(u.input_type){case"text":case"number":case"date":return!!t.note;case"select":case"radio":return!!t.status;case"image":return((d=t.images)==null?void 0:d.length)>0;default:return!!t.status||!!t.note}}),g=m=>{if(m==="summary")h.value=x.categories.length;else{const u=x.categories.findIndex(t=>t.id===m);u>=0&&(h.value=u)}l.value=m},_=m=>{let u=h.value+m;const t=x.categories.length;u>=0&&u<=t&&(h.value=u,u===t?l.value="summary":l.value=x.categories[u].id)},o=()=>{let m=0,u=0;const t=N=>{m=N.changedTouches[0].screenX},d=N=>{u=N.changedTouches[0].screenX,V()},V=()=>{u<m-50?_(1):u>m+50&&_(-1)},R=document.querySelector(".relative.overflow-hidden");return R&&(R.addEventListener("touchstart",t,!1),R.addEventListener("touchend",d,!1)),()=>{R&&(R.removeEventListener("touchstart",t),R.removeEventListener("touchend",d))}},L=be.debounce(async m=>{try{await le.post(route("inspections.save-result"),{inspection_id:x.inspection.id,point_id:m,status:i.results[m].status,note:i.results[m].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(u){console.error("Error menyimpan hasil:",u)}},500),F=({pointId:m,type:u,value:t})=>{i.results[m].hasOwnProperty(u)&&(i.results[m][u]=t),L(m)},C=async(m,u)=>{const t=m.target.files[0];if(!t)return;const d=URL.createObjectURL(t);try{const V=new FormData;V.append("inspection_id",x.inspection.id),V.append("point_id",u),V.append("image",t),await le.post(route("inspections.upload-image"),V,{preserveScroll:!0,onSuccess:R=>{var q;const N=((q=R.props.flash)==null?void 0:q.imagePath)||R.props.imagePath;N?i.results[u].images.push({image_path:N,preview:d}):console.error("Path gambar tidak dikembalikan dari unggahan, tidak dapat memperbarui UI.")},onError:R=>{console.error("Error mengunggah gambar:",R),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(V){console.error("Error mengunggah gambar:",V),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{m.target.value=""}},$=async(m,u)=>{const t=i.results[m].images[u];if(t)try{await le.delete(route("inspections.delete-image"),{data:{image_path:t.image_path,point_id:m,inspection_id:x.inspection.id},preserveScroll:!0,onSuccess:()=>{i.results[m].images.splice(u,1),t.preview&&URL.revokeObjectURL(t.preview)},onError:d=>{console.error("Error menghapus gambar:",d),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(d){console.error("Error menghapus gambar:",d),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},S=()=>{i.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{we().props.flash.success="Inspeksi berhasil dikirim!"},onError:m=>{console.error("Kesalahan pengiriman:",m),we().props.flash.error="Ada kesalahan dalam pengiriman Anda. Harap periksa semua bidang."}})};return Ve(()=>{o()}),J(l,m=>{const u=document.querySelector(`.flex-shrink-0[data-category-id="${m}"]`);u&&u.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(m,u)=>(n(),c("div",ba,[e("div",xa,[e("div",ya,[(n(!0),c(te,null,ae(s.categories,t=>(n(),c("button",{key:t.id,onClick:d=>g(t.id),class:Z(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":l.value===t.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":l.value!==t.id}]),"data-category-id":t.id},[oe(P(t.name)+" ",1),v(t)?(n(),c("span",_a," ✓ ")):k("",!0)],10,ka))),128)),e("button",{onClick:u[0]||(u[0]=t=>g("summary")),class:Z(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":l.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":l.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),e("div",Ia,[se(Ue,{name:"category-slide",mode:"out-in"},{default:Me(()=>[p.value&&l.value!=="summary"?(n(),O(wa,{key:p.value.id,category:p.value,form:G(i),onSaveResult:G(L),onUpdateResult:F,onRemoveImage:$,onHandleImageUpload:C},null,8,["category","form","onSaveResult"])):l.value==="summary"?(n(),c("div",$a,[u[6]||(u[6]=e("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),e("div",Ca,[u[3]||(u[3]=e("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),ye(e("textarea",{id:"overall_note","onUpdate:modelValue":u[1]||(u[1]=t=>G(i).overall_note=t),onInput:u[2]||(u[2]=(...t)=>G(y)&&G(y)(...t)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[ke,G(i).overall_note]])]),e("div",Sa,[u[4]||(u[4]=e("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Kategori:",-1)),e("ul",Ra,[(n(!0),c(te,null,ae(s.categories,t=>(n(),c("li",{key:t.id,class:Z({"text-green-600":v(t),"text-red-600":!v(t)})},[oe(P(t.name)+" ",1),v(t)?(n(),c("span",Va,"(Selesai ✓)")):(n(),c("span",Ma,"(Belum Selesai ✗)"))],2))),128))])]),e("div",Ua,[e("button",{type:"button",onClick:S,disabled:G(i).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[G(i).processing?(n(),c("svg",Na,u[5]||(u[5]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):k("",!0),e("span",null,P(G(i).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,La)])])):k("",!0)]),_:1})])]))}},Ta=Y(Ba,[["__scopeId","data-v-22fd310e"]]);export{Ta as default};
