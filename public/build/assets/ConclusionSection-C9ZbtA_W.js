import{x as $e,d as C,m as he,z as W,e as r,o as n,a as t,f as y,b as se,p as oe,v as me,u as J,F as G,h as K,t as B,g as ne,w as ce,l as z,n as ee,C as Ie,D as ue,k as Ve,E as fe,G as Se,c as Y,r as be,T as Ce,H as ge,W as _e}from"./app-CHJK0z2W.js";import{l as we}from"./lodash-DKusfBpv.js";import{_ as Me}from"./PrimaryButton-BFdhOCBQ.js";import{_ as Ue}from"./ActionMessage-BKKcVfCO.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as qe}from"./InputNumber-C3O3B1zk.js";const Ne={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Re={key:0,class:"p-4 space-y-4"},Be={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},je={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},Pe={class:"relative"},Fe={key:0,class:"absolute right-3 top-3"},Te={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},De={key:0},Le=["onMousedown"],Ae={class:"font-medium text-gray-900"},Ee={class:"text-sm text-gray-500"},He={key:1,class:"p-4 text-sm text-gray-500 text-center"},ze={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Oe={key:0,class:"mb-4"},We={class:"text-gray-600 text-sm"},Ge={key:1},Ke={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},Xe=["src","alt"],Ze={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Je={class:"text-white text-xs text-center"},Ye={key:2,class:"text-center py-4 text-gray-500 text-sm"},Qe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},et={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(e,{emit:R}){var q,M,P,S;const a=e,b=R,l=$e({plate_number:((q=a.inspection)==null?void 0:q.plate_number)||"",car_id:((M=a.inspection)==null?void 0:M.car_id)||null,car_name:((S=(P=a.inspection)==null?void 0:P.car)==null?void 0:S.name)||""}),m=C(l.car_name),v=C(!1),c=C(!1),u=C([]),f=C(null),x=C([]);he(()=>{var p,d,_,E;if((p=a.inspection)!=null&&p.car_id&&((d=a.CarDetail)==null?void 0:d.length)>0){const O=a.CarDetail.find(A=>A.id===a.inspection.car_id);O&&V(O)}else!((_=a.inspection)!=null&&_.car_id)&&((E=a.inspection)!=null&&E.car_name)&&(m.value=a.inspection.car_name)}),W(m,p=>{l.car_id&&s(f.value)!==p&&(l.car_id=null,f.value=null,x.value=[]),l.car_name=p});const s=p=>{var _,E,O;if(!p)return"";const d=[];return(_=p.brand)!=null&&_.name&&d.push(p.brand.name),(E=p.model)!=null&&E.name&&d.push(p.model.name),(O=p.type)!=null&&O.name&&d.push(p.type.name),p.cc&&d.push(`${p.cc}cc`),p.transmission&&d.push(p.transmission),p.fuel_type&&d.push(p.fuel_type),p.year&&d.push(p.year.toString()),p.production_period&&d.push(`(${p.production_period})`),d.join(" ")},w=we.debounce(()=>{if(!m.value.trim()){u.value=[],v.value=!1;return}c.value=!0;try{const p=m.value.toLowerCase().trim();u.value=a.CarDetail.filter(d=>s(d).toLowerCase().includes(p)),v.value=!0}finally{c.value=!1}},300),h=()=>{setTimeout(()=>{v.value=!1},200)},V=async p=>{f.value=p,m.value=s(p),l.car_id=p.id,l.car_name=s(p),v.value=!1,await I(p.id),j()},I=async p=>{try{const d=await fetch(`/api/cars/${p}/images`);d.ok?x.value=await d.json():x.value=[]}catch{x.value=[]}},j=()=>{const p={plate_number:l.plate_number,car_id:l.car_id,car_name:l.car_name};b("update-vehicle",p)},T=()=>{a.inspection&&l.post(route("inspections.updateVehicleDetails",{inspection:a.inspection.id}),{preserveScroll:!0})};return W(()=>a.inspection,p=>{var d;if(p)if(l.plate_number=p.plate_number||"",l.car_id=p.car_id||null,p.car_id&&((d=a.CarDetail)==null?void 0:d.length)>0){const _=a.CarDetail.find(E=>E.id===p.car_id);_&&V(_)}else p.car_name&&(m.value=p.car_name,l.car_name=p.car_name)},{deep:!0}),(p,d)=>(n(),r("div",Ne,[d[13]||(d[13]=t("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[t("h2",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),e.inspection?(n(),r("div",Re,[t("div",Be,[d[5]||(d[5]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nomor Plat Kendaraan ",-1)),oe(t("input",{"onUpdate:modelValue":d[0]||(d[0]=_=>J(l).plate_number=_),type:"text",placeholder:"Contoh: B 1234 ABC",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:j},null,544),[[me,J(l).plate_number]])]),t("div",je,[d[8]||(d[8]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",Pe,[oe(t("input",{"onUpdate:modelValue":d[1]||(d[1]=_=>m.value=_),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:d[2]||(d[2]=(..._)=>J(w)&&J(w)(..._)),onFocus:d[3]||(d[3]=_=>v.value=!0),onBlur:h},null,544),[[me,m.value]]),c.value?(n(),r("div",Fe,d[6]||(d[6]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):y("",!0),v.value?(n(),r("div",Te,[u.value.length>0?(n(),r("div",De,[(n(!0),r(G,null,K(u.value,_=>(n(),r("div",{key:_.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:E=>V(_)},[t("div",Ae,B(s(_)),1),t("div",Ee,B(_.year)+" • "+B(_.cc)+"cc • "+B(_.transmission)+" • "+B(_.fuel_type),1)],40,Le))),128))])):(n(),r("div",He,d[7]||(d[7]=[ne(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),ne(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):y("",!0)]),oe(t("input",{type:"hidden","onUpdate:modelValue":d[4]||(d[4]=_=>J(l).car_id=_)},null,512),[[me,J(l).car_id]])]),J(l).car_id&&f.value?(n(),r("div",ze,[f.value.description?(n(),r("div",Oe,[d[9]||(d[9]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("p",We,B(f.value.description),1)])):y("",!0),x.value.length>0?(n(),r("div",Ge,[d[10]||(d[10]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",Ke,[(n(!0),r(G,null,K(x.value,_=>(n(),r("div",{key:_.id,class:"relative group"},[t("img",{src:_.file_path,alt:_.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200"},null,8,Xe),_.note?(n(),r("div",Ze,[t("p",Je,B(_.note),1)])):y("",!0)]))),128))])])):(n(),r("div",Ye," Tidak ada gambar tersedia untuk mobil ini "))])):y("",!0),se(Me,{type:"button",onClick:T,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},{default:ce(()=>[J(l).processing?(n(),r("svg",Qe,d[11]||(d[11]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),t("span",null,B(J(l).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),se(Ue,{on:J(l).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:ce(()=>d[12]||(d[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ne(" Tersimpan. ")])),_:1,__:[12]},8,["on"])]),_:1})])):y("",!0)]))}},Ta=ie(et,[["__scopeId","data-v-7573ffe7"]]),tt={class:"mt-1"},st=["value","required","minlength","maxlength","pattern","placeholder"],at={key:0,class:"mt-2 text-sm text-red-600"},ot={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,l=m=>{b("update:modelValue",m.target.value),b("save",a.pointId)};return(m,v)=>(n(),r("div",tt,[t("input",{value:e.modelValue,onInput:l,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,pattern:e.pattern,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,st),e.error?(n(),r("p",at,B(e.error),1)):y("",!0)]))}},nt={class:"mt-1"},it=["value","required","min","max"],lt={key:0,class:"mt-2 text-sm text-red-600"},rt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,l=m=>{b("update:modelValue",m.target.value),b("save",a.pointId)};return(m,v)=>(n(),r("div",nt,[t("input",{value:e.modelValue,onChange:l,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,it),e.error?(n(),r("p",lt,B(e.error),1)):y("",!0)]))}},dt={class:"mt-1"},ut=["value","required","placeholder"],ct={key:0,class:"mt-2 text-sm text-red-600"},mt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,l=C(""),m=C(!1),v=z(()=>{var h,V,I,j;return{currency_symbol:((h=a.settings)==null?void 0:h.currency_symbol)||"Rp",thousands_separator:((V=a.settings)==null?void 0:V.thousands_separator)||",",min_value:((I=a.settings)==null?void 0:I.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((j=a.settings)==null?void 0:j.max_value)!==void 0?Number(a.settings.max_value):1e9}}),c=h=>{if(h==null||h==="")return"";const V=Number(h);if(isNaN(V))return"";let I=V.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return v.value.thousands_separator!==","&&(I=I.replace(/,/g,v.value.thousands_separator)),I},u=h=>h?h.replace(/[^\d]/g,""):"",f=z(()=>{if(m.value)return l.value;const h=c(a.modelValue);return h?`${v.value.currency_symbol} ${h}`:""}),x=h=>{const V=h.target.value;l.value=V;const I=u(V);b("update:modelValue",I),b("save",a.pointId)},s=()=>{var h;m.value=!0,l.value=((h=a.modelValue)==null?void 0:h.toString())||""},w=()=>{m.value=!1;const h=u(l.value);if(h){const V=Number(h);let I=h;v.value.min_value!==void 0&&V<v.value.min_value&&(I=v.value.min_value.toString()),v.value.max_value!==void 0&&V>v.value.max_value&&(I=v.value.max_value.toString()),I!==h&&(b("update:modelValue",I),b("save",a.pointId))}};return W(()=>a.modelValue,h=>{!m.value&&h!==void 0&&h!==null&&(l.value=h.toString())},{immediate:!0}),(h,V)=>(n(),r("div",dt,[t("input",{value:f.value,onInput:x,onBlur:w,onFocus:s,type:"text",required:e.required,placeholder:e.placeholder,class:ee(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,ut),e.error?(n(),r("p",ct,B(e.error),1)):y("",!0)]))}},gt={class:"mt-1 space-y-3"},vt={key:0,class:"space-y-2"},ht={class:"flex flex-wrap gap-2"},pt=["onClick"],ft=["value","required","minlength","maxlength","placeholder"],bt={class:"flex justify-between items-center mt-1"},wt={class:"text-xs text-gray-500"},yt={key:0,class:"text-xs text-red-600"},ye={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,l=C([]),m=C(""),v=x=>l.value.some(s=>s.value===x),c=x=>{v(x.value)?l.value=l.value.filter(V=>V.value!==x.value):l.value.push(x);const w=[...l.value.map(V=>V.value)];m.value.trim()&&w.push(m.value.trim());const h=w.join(", ");b("update:modelValue",h),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:h})},u=x=>{const s=x.target.value;b("update:modelValue",s),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:s}),f(s)},f=x=>{var V,I,j,T;if(!x){l.value=[],m.value="";return}const s=x.split(",").map(q=>q.trim()).filter(q=>q),w=((I=(V=a.settings)==null?void 0:V.damage_options)==null?void 0:I.map(q=>q.value))||[];l.value=((T=(j=a.settings)==null?void 0:j.damage_options)==null?void 0:T.filter(q=>s.includes(q.value)))||[];const h=s.filter(q=>!w.includes(q));m.value=h.join(", ")};return W(()=>a.modelValue,x=>{x!=null&&f(x)},{immediate:!0}),(x,s)=>{var w,h,V;return n(),r("div",gt,[(w=e.settings)!=null&&w.enable_damage&&((h=e.settings)!=null&&h.damage_options)?(n(),r("div",vt,[s[0]||(s[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",ht,[(n(!0),r(G,null,K(e.settings.damage_options,(I,j)=>(n(),r("button",{key:j,type:"button",onClick:T=>c(I),class:ee(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":v(I.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!v(I.value)}])},B(I.label),11,pt))),128))])])):y("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:u,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,ft),t("div",bt,[t("span",wt,B(((V=e.modelValue)==null?void 0:V.length)||0)+"/"+B(e.maxLength||400),1),e.error?(n(),r("p",yt,B(e.error),1)):y("",!0)])])])}}},xt={class:"mt-1"},kt=["value","required"],$t={key:0,class:"mt-2 text-sm text-red-600"},It={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:R}){const a=e,b=R,l=m=>{b("update:modelValue",m.target.value),b("save",a.pointId)};return(m,v)=>(n(),r("div",xt,[t("select",{value:e.modelValue,onChange:l,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},v[0]||(v[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,kt),e.error?(n(),r("p",$t,B(e.error),1)):y("",!0)]))}},Vt=ie(It,[["__scopeId","data-v-c34a74db"]]),St={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Ct={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},_t={class:"flex flex-row space-x-4 mb-6"},Mt={class:"mt-4 text-right"},Ut={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(R,a)=>e.show?(n(),r("div",St,[t("div",Ct,[a[5]||(a[5]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),t("div",_t,[t("button",{onClick:a[0]||(a[0]=b=>R.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[3]||(a[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:a[1]||(a[1]=b=>R.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[4]||(a[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",Mt,[t("button",{onClick:a[2]||(a[2]=b=>R.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):y("",!0)}},qt={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Nt={class:"webcam-content-box"},Rt={class:"webcam-header"},Bt={class:"inspection-point-name"},jt={key:0,class:"screen-flash-overlay"},Pt={key:2,class:"focus-status"},Ft={class:"webcam-footer"},Tt={class:"camera-controls"},Dt=["disabled"],Lt={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,inspectionPoint:String,point:Object,pointname:String},emits:["close","photoCaptured"],setup(e,{emit:R}){const a=e,b=R,l=C(null),m=C(null);let v=null,c=null;const u=C("environment"),f=C(!1),x=C(!1),s=C(!1),w=C(!1),h=C(a.inspectionPoint||"Camera"),V=C(!1),I=C({}),j=C(""),T=C("continuous"),q=C("high"),M=z(()=>{switch(q.value){case"high":return{width:1920,height:1080};case"medium":return{width:1280,height:720};case"low":return{width:640,height:480};default:return{width:1920,height:1080}}}),P=z(()=>a.aspectRatio?{aspectRatio:`${a.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),S=z(()=>{if(!a.aspectRatio)return{};const k=a.aspectRatio,o=k>1?80:60,$=k>1?80/k:60*k;return{width:`${o}%`,height:`${$}%`}}),p=z(()=>{var k;return((k=a.settings)==null?void 0:k.max_size)||2048}),d=async()=>{v&&v.getTracks().forEach(k=>k.stop()),s.value=!1,V.value=!1,j.value="";try{const k={facingMode:u.value,width:{ideal:M.value.width},height:{ideal:M.value.height},aspectRatio:{ideal:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30}};q.value==="high"&&(k.width={ideal:1920,max:3840},k.height={ideal:1080,max:2160},k.frameRate={ideal:30,max:60}),T.value!=="manual"&&(k.advanced=[{focusMode:T.value}]),u.value==="environment"&&(k.advanced||(k.advanced=[]),k.advanced.push({focusMode:T.value})),v=await navigator.mediaDevices.getUserMedia({video:k,audio:!1}),c=v.getVideoTracks()[0],l.value.srcObject=v,l.value.onloadedmetadata=async()=>{await E(),(T.value==="continuous"||T.value==="single-shot")&&await O()}}catch(k){console.error("Error accessing camera: ",k),alert("Failed to access camera. Please allow camera permission."),b("close")}},_=()=>{v&&v.getTracks().forEach(k=>k.stop()),b("close")},E=async()=>{if(c)try{const k=await navigator.mediaDevices.enumerateDevices();f.value=k.filter(g=>g.kind==="videoinput").length>1;const o=c.getCapabilities();x.value=o.torch||o.fillLightMode&&o.fillLightMode.includes("torch");const $=o.focusDistance||{};console.log("Camera capabilities:",o)}catch(k){console.error("Error checking camera capabilities:",k)}},O=async()=>{if(c)try{const k=c.getCapabilities();k.focusMode&&k.focusMode.includes("continuous")&&(await c.applyConstraints({advanced:[{focusMode:"continuous"}]}),j.value="Auto Focus Enabled",setTimeout(()=>{j.value=""},2e3))}catch(k){console.warn("Auto focus not supported:",k)}},A=async()=>{if(!(!c||!a.settings.enable_flash)){if(u.value==="user"){s.value=!s.value,w.value=s.value;return}try{c.getCapabilities().torch&&(await c.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value)}catch(k){console.error("Flash toggle failed:",k)}}},Q=async()=>{f.value&&(u.value=u.value==="environment"?"user":"environment",h.value=`${a.inspectionPoint||"Camera"} (${u.value==="environment"?"Rear":"Front"})`,await d())},ae=async()=>{if(!c)return;const k=c.getCapabilities();if(k.focusMode&&k.focusMode.includes("continuous"))try{await c.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(o){console.warn("Focus not supported",o)}},le=async k=>new Promise(o=>{const $=p.value*1024;if(k.size<=$){o(k);return}const g=new Image,N=new FileReader;N.onload=i=>{g.onload=()=>{const F=document.createElement("canvas"),U=F.getContext("2d"),L=Math.sqrt($/k.size);F.width=g.width*L,F.height=g.height*L,U.drawImage(g,0,0,F.width,F.height);let D=.9;const H=()=>{F.toBlob(X=>{X.size>$&&D>.1?(D-=.1,H()):o(X)},"image/png",D)};H()},g.src=i.target.result},N.readAsDataURL(k)}),re=async()=>{const k=l.value,o=m.value;if(!(!k||!o||k.readyState!==4))try{const $=o.getContext("2d"),g=k.videoWidth,N=k.videoHeight;let i,F,U,L;g/N>a.aspectRatio?(F=N,i=N*a.aspectRatio,U=(g-i)/2,L=0):(i=g,F=g/a.aspectRatio,U=0,L=(N-F)/2),o.width=i,o.height=F,$.drawImage(k,U,L,i,F,0,0,i,F);const D=await new Promise(X=>{o.toBlob(X,"image/png",1)}),H=await le(D);if(H){const X=new File([H],`capture_${Date.now()}.png`,{type:"image/png",lastModified:Date.now()});b("photoCaptured",X),w.value=!0,setTimeout(()=>{w.value=!1},100)}}catch($){console.error("Error capturing photo:",$),alert("Failed to capture photo. Please try again.")}};return W(()=>a.show,k=>{k?d():_()}),W(()=>a.inspectionPoint,k=>{h.value=k||"Camera"}),W(()=>a.aspectRatio,()=>{a.show&&d()}),Ie(()=>{v&&v.getTracks().forEach(k=>k.stop())}),(k,o)=>{var $;return e.show?(n(),r("div",qt,[t("div",Nt,[t("div",Rt,[t("div",Bt,B((($=e.point)==null?void 0:$.name)||"Camera"),1),t("button",{onClick:_,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},o[0]||(o[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:ue(P.value),onClick:ae},[t("video",{ref_key:"webcamVideo",ref:l,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:m,class:"hidden"},null,512),w.value?(n(),r("div",jt)):y("",!0),t("div",{class:"aspect-ratio-guide",style:ue(S.value)},null,4),V.value?(n(),r("div",{key:1,class:"focus-indicator",style:ue(I.value)},o[1]||(o[1]=[t("div",{class:"focus-ring"},null,-1)]),4)):y("",!0),o[2]||(o[2]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),j.value?(n(),r("div",Pt,B(j.value),1)):y("",!0)],4),t("div",Ft,[t("div",Tt,[e.settings.enable_flash?(n(),r("button",{key:0,onClick:A,disabled:!x.value,class:ee(["control-button",{active:s.value,disabled:!x.value}])},o[3]||(o[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),10,Dt)):y("",!0),t("button",{onClick:re,class:"capture-button"},o[4]||(o[4]=[t("div",{class:"camera-icon-container"},[t("div",{class:"camera-body"},[t("div",{class:"camera-lens"}),t("div",{class:"camera-flash"})])],-1)])),e.settings.enable_camera_switch&&f.value?(n(),r("button",{key:1,onClick:Q,class:"control-button"},o[5]||(o[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):y("",!0)])])])])):y("",!0)}}},At=ie(Lt,[["__scopeId","data-v-73221082"]]),Et={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Ht={class:"w-full h-full flex flex-col"},zt={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Ot={class:"text-lg font-semibold"},Wt={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Gt=["src"],Kt={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Xt=["disabled"],Zt={class:"flex gap-3 w-full"},Jt=["disabled"],Yt={key:1,class:"flex-1 px-4 py-3 bg-indigo-400 text-white rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},Qt={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos"],setup(e,{emit:R}){const a=e,b=R,l=C(0),m=C([]),v=C(0),c=C(0),u=z(()=>m.value.length>0?m.value[l.value]:null);W(()=>a.images,M=>{m.value=M.map(P=>({...P})),a.show&&M.length>0?l.value=M.length-1:l.value=0,M.length===0&&a.show&&T()},{deep:!0,immediate:!0}),W(()=>a.show,M=>{M&&a.images.length>0&&(l.value=a.images.length-1)});const f=M=>M.preview||(M.image_path?`/${M.image_path}`:""),x=()=>{u.value&&(u.value.rotation=(u.value.rotation+90)%360)},s=()=>{l.value=l.value<m.value.length-1?l.value+1:0},w=()=>{l.value=l.value>0?l.value-1:m.value.length-1},h=M=>{v.value=M.touches[0].clientX},V=M=>{c.value=M.touches[0].clientX},I=()=>{v.value-c.value>50?s():c.value-v.value>50&&w(),v.value=0,c.value=0},j=()=>{a.isUploading||b("saveImages",m.value)},T=()=>{a.isUploading||b("close")},q=()=>{a.isUploading||b("triggerAddMorePhotos")};return(M,P)=>{var S;return e.show?(n(),r("div",Et,[t("div",Ht,[t("div",zt,[t("button",{onClick:T,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},P[0]||(P[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",Ot,B(((S=e.point)==null?void 0:S.name)||"Preview")+"/"+B(m.value.length)+") ",1),t("button",{onClick:x,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},P[1]||(P[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))]),t("div",Wt,[t("div",{class:"relative w-full max-w-full",style:ue({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"}),onTouchstart:h,onTouchmove:V,onTouchend:I},[u.value?(n(),r("img",{key:0,src:f(u.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ue({transform:`rotate(${u.value.rotation}deg)`})},null,12,Gt)):y("",!0)],36),m.value.length>1?(n(),r("button",{key:0,onClick:w,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},P[2]||(P[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),m.value.length>1?(n(),r("button",{key:1,onClick:s,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},P[3]||(P[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0)]),t("div",Kt,[e.allowMultiple&&m.value.length<e.maxFiles?(n(),r("button",{key:0,onClick:q,class:"w-full px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium",disabled:e.isUploading}," Tambah Gambar ",8,Xt)):y("",!0),t("div",Zt,[t("button",{onClick:T,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:e.isUploading}," Batal ",8,Jt),e.isUploading?(n(),r("button",Yt,P[4]||(P[4]=[ne(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(n(),r("button",{key:0,onClick:j,class:"flex-1 px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"}," Simpan "))])])])])):y("",!0)}}},es=ie(Qt,[["__scopeId","data-v-551cb9bd"]]),ts=["accept","multiple","disabled"],ss=["disabled"],as={class:"h-full flex flex-col items-center justify-center p-4 text-center"},os={class:"text-xs text-gray-400 mt-1"},ns={key:1,class:"block w-full border-2 border-dashed rounded-lg transition-colors duration-200 border-indigo-300 bg-indigo-50 h-auto p-2","aria-label":"Image gallery"},is={class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ls=["onClick"],rs=["src"],ds={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},us={key:0},cs={key:1,class:"ml-1"},ms=["onClick","disabled"],gs=["disabled"],vs={key:2,class:"mt-1 text-xs text-red-600"},hs={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:R}){const a=e,b=R,l=C(null),m=C(null),v=C(!1),c=C(!1),u=C(!1),f=C([]),x=C(0),s=C(!1),w=z(()=>Number(a.settings.max_files)>1),h=z(()=>a.settings.allowed_types.map(o=>`.${o}`).join(", ")),V=z(()=>{const o=a.settings.camera_aspect_ratio.split(":");if(o.length===2){const $=parseFloat(o[0]),g=parseFloat(o[1]);if(!isNaN($)&&!isNaN(g)&&g!==0)return $/g}return 4/3}),I=z(()=>{const o=[],$=new Set;for(const g of f.value)g.id&&$.add(g.id),o.push(g);for(const g of a.modelValue)g.inspection_id&&String(g.inspection_id)!==String(a.inspectionId)||$.has(g.id)||o.push({...g,rotation:g.rotation||0,isNew:!1,preview:g.preview||(g.image_path?`/${g.image_path}`:null)});return o}),j=o=>o.preview||(o.image_path?`/${o.image_path}`:""),T=()=>{u.value&&(u.value=!1),v.value=!0},q=()=>{v.value=!1,l.value.click()},M=()=>{v.value=!1,c.value=!0},P=()=>{v.value=!1,I.value.length>0&&(u.value=!0)},S=()=>{c.value=!1,I.value.length>0&&(u.value=!0)},p=()=>{u.value=!1,f.value.forEach(o=>{o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview)}),f.value=[]},d=o=>new Promise($=>{const g=new FileReader;g.onload=N=>{const i=new Image;i.onload=()=>{$({file:o,preview:URL.createObjectURL(o),rotation:0,width:i.naturalWidth,height:i.naturalHeight,isNew:!0})},i.onerror=()=>{console.error("Failed to load image for dimensions:",o.name),$({file:o,preview:URL.createObjectURL(o),rotation:0,width:0,height:0,isNew:!0})},i.src=N.target.result},g.readAsDataURL(o)}),_=o=>{const $=o.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes($)},E=async o=>{const g=(a.settings.max_size||2048)*1024;return new Promise(N=>{const i=new Image,F=new FileReader;F.onload=U=>{i.onload=()=>{const L=document.createElement("canvas"),D=L.getContext("2d"),H=Math.max(i.width,i.height);L.width=H,L.height=H,D.fillStyle="white",D.fillRect(0,0,H,H);const X=(H-i.width)/2,Z=(H-i.height)/2;D.drawImage(i,X,Z,i.width,i.height);let de=.9;const te=()=>{L.toBlob(pe=>{if(pe.size>g&&de>.1)de-=.1,te();else{const ke=new File([pe],o.name,{type:"image/jpeg",lastModified:Date.now()});N(ke)}},"image/jpeg",de)};te()},i.src=U.target.result},F.readAsDataURL(o)})},O=async o=>{const $=Array.from(o.target.files);if(!$.length){v.value=!1,I.value.length>0&&(u.value=!0);return}try{const g=$.filter(D=>!_(D));if(g.length>0){const D=g.map(H=>H.name.split(".").pop()).join(", ");alert(`File type not allowed: ${D}. Allowed types: ${a.settings.allowed_types.join(", ")}`),o.target.value="";return}const N=I.value.length,i=a.settings.max_files-N,F=await Promise.all($.slice(0,i).map(async D=>await E(D))),U=await Promise.all(F.map(d)),L=w.value?U:U.slice(0,1);w.value?f.value.push(...L):(f.value.forEach(D=>{D.preview&&D.preview.startsWith("blob:")&&URL.revokeObjectURL(D.preview)}),f.value=L),v.value=!1,L.length>0?(x.value=Math.max(0,I.value.length-L.length),u.value=!0):I.value.length>0&&(u.value=!0),o.target.value=""}catch(g){console.error("Error processing selected images:",g),alert("Failed to process selected images. Please try again."),v.value=!1,I.value.length>0&&(u.value=!0)}},A=async o=>{const $=I.value.length;if(!w.value||$<a.settings.max_files)try{const g=await E(o),N=new Image;N.onload=()=>{const i={file:g,preview:URL.createObjectURL(g),rotation:0,width:N.naturalWidth,height:N.naturalHeight,isNew:!0};w.value?f.value.push(i):(f.value.forEach(F=>{F.preview&&F.preview.startsWith("blob:")&&URL.revokeObjectURL(F.preview)}),f.value=[i]),c.value=!1,v.value=!1,x.value=I.value.length-1,u.value=!0},N.src=URL.createObjectURL(g)}catch(g){console.error("Error processing captured image:",g),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),c.value=!1,v.value=!1,I.value.length>0&&(u.value=!0)},Q=(o=0)=>{x.value=o,u.value=!0},ae=o=>new Promise($=>{if(o.rotation===0||!m.value){if(!o.isNew&&!o.file){$({file:null,width:o.width,height:o.height,isOriginal:!0});return}$({file:o.file,width:o.width,height:o.height});return}const g=new Image;g.onload=async()=>{try{const N=m.value,i=N.getContext("2d"),F=g.width,U=g.height;let L,D;o.rotation===90||o.rotation===270?(L=U,D=F):(L=F,D=U),N.width=L,N.height=D,i.clearRect(0,0,N.width,N.height),i.translate(N.width/2,N.height/2),i.rotate(o.rotation*Math.PI/180),i.drawImage(g,-F/2,-U/2,F,U),i.setTransform(1,0,0,1,0,0);const H=await new Promise(de=>{N.toBlob(de,"image/jpeg",.9)}),X=new File([H],o.file?o.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),Z=await E(X);$({file:Z,width:L,height:D})}catch(N){console.error("Error processing rotated image:",N),$({file:o.file,width:o.width,height:o.height})}},g.onerror=()=>{console.error("Failed to load image for rotation processing:",o.preview),$({file:o.file,width:o.width,height:o.height})},g.src=o.preview}),le=async o=>{var g,N,i,F;s.value=!0;const $=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),s.value=!1;return}try{for(const U of o){if(!U.isNew&&U.rotation===0&&U.id&&U.image_path){$.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:0,preview:U.preview});continue}const{file:L,width:D,height:H,isOriginal:X}=await ae(U);if(X&&!U.isNew){$.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:0,preview:U.preview});continue}const Z=new FormData;Z.append("inspection_id",a.inspectionId),Z.append("point_id",a.pointId),Z.append("image",L),Z.append("width",D),Z.append("height",H),Z.append("rotation",0),U.id&&!U.isNew&&Z.append("image_id",U.id);const te=(await fe.post(route("inspections.upload-image"),Z,{headers:{"Content-Type":"multipart/form-data"}})).data.image;$.push({id:te.id,image_path:te.image_path,width:te.width,height:te.height,rotation:te.rotation,preview:te.public_url}),U.preview&&U.preview.startsWith("blob:")&&URL.revokeObjectURL(U.preview)}b("update:modelValue",$),b("save",a.pointId),b("uploaded",{pointId:a.pointId,images:$}),p()}catch(U){if(console.error("Error during image processing/upload:",U),(N=(g=U.response)==null?void 0:g.data)!=null&&N.message)alert(`Failed to save images: ${U.response.data.message}`);else if((F=(i=U.response)==null?void 0:i.data)!=null&&F.errors){const L=Object.values(U.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${L}`)}else alert(`Failed to save images: ${U.message}`)}finally{s.value=!1}},re=o=>{if(o){if(o.id&&!o.isNew)k(o);else{const $=f.value.findIndex(g=>g.preview&&g.preview===o.preview&&g.isNew||g.id&&g.id===o.id);if($!==-1){const g=f.value.splice($,1)[0];g.preview&&g.preview.startsWith("blob:")&&URL.revokeObjectURL(g.preview)}b("update:modelValue",a.modelValue.filter(g=>!(g.id&&g.id===o.id)&&!(g.preview&&g.preview===o.preview)))}x.value>=I.value.length&&(x.value=Math.max(0,I.value.length-1)),I.value.length===0&&p()}},k=async o=>{var g,N;if(o.id||o.image_path)try{await fe.delete(route("inspections.delete-image"),{data:{image_id:o.id,image_path:o.image_path}})}catch(i){console.error("Error deleting image from server:",i),(N=(g=i.response)==null?void 0:g.data)!=null&&N.message?alert(`Failed to delete image from server: ${i.response.data.message}`):alert(`Failed to delete image from server: ${i.message}`);return}o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview);const $=a.modelValue.filter(i=>i.id!==o.id);b("update:modelValue",$),f.value=f.value.filter(i=>i.isNew&&o.isNew?i.preview!==o.preview:i.id!==o.id),b("removeImage",{image:o}),u.value&&I.value.length===0?p():u.value&&x.value>=I.value.length&&(x.value=Math.max(0,I.value.length-1))};return(o,$)=>(n(),r("div",null,[t("input",{ref_key:"galleryInput",ref:l,type:"file",accept:h.value,class:"hidden",onChange:O,multiple:w.value,disabled:s.value},null,40,ts),t("canvas",{ref_key:"processingCanvas",ref:m,class:"hidden"},null,512),I.value.length===0?(n(),r("label",{key:0,onClick:T,class:ee(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:s.value},[t("div",as,[$[0]||($[0]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),$[1]||($[1]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),$[2]||($[2]=t("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),t("p",os,"Allowed types: "+B(h.value),1)])],8,ss)):(n(),r("div",ns,[t("div",is,[(n(!0),r(G,null,K(I.value,(g,N)=>(n(),r("div",{key:g.id||g.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:i=>Q(N)},[t("img",{src:j(g),class:"w-full h-full object-cover"},null,8,rs),g.isNew||g.rotation!==0?(n(),r("div",ds,[g.isNew?(n(),r("span",us,"BARU")):y("",!0),g.rotation!==0?(n(),r("span",cs,"ROTASI")):y("",!0)])):y("",!0),t("button",{onClick:Ve(i=>k(g),["stop"]),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs shadow-sm hover:bg-red-600 transition-colors z-10","aria-label":"Remove image",disabled:s.value}," × ",8,ms)],8,ls))),128)),w.value&&I.value.length<e.settings.max_files?(n(),r("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:T,disabled:s.value},$[3]||($[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,gs)):y("",!0)])])),e.error?(n(),r("p",vs,B(e.error),1)):y("",!0),se(Ut,{show:v.value,onClose:P,onOpenWebcam:M,onTriggerGallery:q},null,8,["show"]),se(At,{show:c.value,"aspect-ratio":V.value,settings:e.settings,point:e.point,onClose:S,onPhotoCaptured:A},null,8,["show","aspect-ratio","settings","point"]),se(es,{show:u.value,images:I.value,point:e.point,"initial-index":x.value,"allow-multiple":w.value,"max-files":e.settings.max_files,"is-uploading":s.value,"aspect-ratio":V.value,onClose:p,onSaveImages:le,onRemovePreviewImage:re,onTriggerAddMorePhotos:T},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},ve=ie(hs,[["__scopeId","data-v-e3d6963a"]]),ps={key:0,class:"fixed inset-0 z-50 overflow-hidden"},fs={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},bs={class:"px-4 pb-2 border-b border-gray-200"},ws={class:"text-lg font-semibold text-gray-900"},ys={key:0,class:"text-sm text-gray-500 mt-1"},xs={class:"flex-1 overflow-y-auto p-4"},ks={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},$s={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:R}){const a=R,b=()=>{a("close")},l=m=>{m.key==="Escape"&&b()};return he(()=>{document.addEventListener("keydown",l)}),Se(()=>{document.removeEventListener("keydown",l)}),(m,v)=>(n(),Y(Ce,{name:"bottom-sheet"},{default:ce(()=>[e.show?(n(),r("div",ps,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:b}),t("div",fs,[v[0]||(v[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",bs,[t("h3",ws,B(e.title),1),e.subtitle?(n(),r("p",ys,B(e.subtitle),1)):y("",!0)]),t("div",xs,[be(m.$slots,"default",{},void 0,!0)]),m.$slots.footer?(n(),r("div",ks,[be(m.$slots,"footer",{},void 0,!0)])):y("",!0)])])):y("",!0)]),_:3}))}},Is=ie($s,[["__scopeId","data-v-7893c2dc"]]),Vs={class:"space-y-4"},Ss={key:0,class:"mt-2"},Cs={class:"text-sm font-medium text-gray-700 mb-2"},_s={key:0,class:"text-red-500"},Ms={key:0,class:"text-xs text-red-500"},Us={key:1,class:"grid grid-cols-2 gap-2"},qs=["name","value","checked"],Ns={key:2,class:"space-y-2"},Rs={key:0,class:"text-red-500"},Bs={key:1,class:"text-xs text-red-500"},js={key:3,class:"mt-4"},Ps={class:"text-sm font-medium text-gray-700 mb-2"},Fs={key:0,class:"text-red-500"},Ts={key:0,class:"text-xs text-red-500"},Ds={class:"flex gap-2"},Ls=["disabled"],xe={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(e,{emit:R}){const a=e,b=R,l=c=>b("hapus",c),m=z(()=>a.options.find(c=>c.value===a.selectedValue)),v=z(()=>{var u,f,x;if(a.point.input_type==="imageTOradio"&&a.imagesValue.length===0||a.options.length&&!a.selectedValue)return!1;const c=m.value;return!(a.showTextarea&&((u=c==null?void 0:c.settings)!=null&&u.show_textarea)&&(!((f=a.notesValue)!=null&&f.trim())||c.settings.min_length&&a.notesValue.length<c.settings.min_length||c.settings.max_length&&a.notesValue.length>c.settings.max_length)||a.showImageUpload&&((x=c==null?void 0:c.settings)!=null&&x.show_image_upload)&&(a.imagesValue.length===0||c.settings.max_files&&a.imagesValue.length>c.settings.max_files))});return(c,u)=>(n(),Y(Is,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:u[10]||(u[10]=f=>c.$emit("close"))},{footer:ce(()=>[e.selectedPoint?(n(),r("button",{key:0,onClick:u[7]||(u[7]=f=>l(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},u[12]||(u[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ne(" Hapus Data ")]))):y("",!0),t("div",Ds,[t("button",{type:"button",onClick:u[8]||(u[8]=f=>c.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:u[9]||(u[9]=f=>c.$emit("save")),disabled:!v.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Ls)])]),default:ce(()=>{var f,x,s,w,h,V,I,j,T,q,M,P,S,p;return[t("div",Vs,[e.point.input_type==="imageTOradio"?(n(),r("div",Ss,[t("h4",Cs,[(f=e.point.settings)!=null&&f.required?(n(),r("span",_s,"*")):y("",!0)]),se(ve,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":u[0]||(u[0]=d=>c.$emit("update:imagesValue",d)),onSave:u[1]||(u[1]=d=>c.$emit("saveImage",d))},null,8,["model-value","point-id","point","inspection-id","settings"]),(x=e.point.settings)!=null&&x.required&&e.imagesValue.length===0?(n(),r("p",Ms," Foto wajib diupload ")):y("",!0)])):y("",!0),e.options.length?(n(),r("div",Us,[(n(!0),r(G,null,K(e.options,(d,_)=>(n(),r("label",{key:_,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:d.value,checked:e.selectedValue===d.value,onChange:u[2]||(u[2]=E=>c.$emit("update:selectedValue",E.target.value)),class:"hidden peer"},null,40,qs),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===d.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==d.value}])},B(d.label),3)]))),128))])):y("",!0),e.showTextarea&&((w=(s=m.value)==null?void 0:s.settings)!=null&&w.show_textarea)?(n(),r("div",Ns,[(h=m.value.settings)!=null&&h.required?(n(),r("span",Rs,"*")):y("",!0),se(ye,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:m.value.settings,required:(V=m.value.settings)==null?void 0:V.required,"min-length":(I=m.value.settings)==null?void 0:I.min_length,"max-length":(j=m.value.settings)==null?void 0:j.max_length,placeholder:((T=m.value.settings)==null?void 0:T.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":u[3]||(u[3]=d=>c.$emit("update:notesValue",d)),onSave:u[4]||(u[4]=d=>c.$emit("saveTextarea",d))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(q=m.value.settings)!=null&&q.required&&!e.notesValue?(n(),r("p",Bs," Keterangan wajib diisi ")):y("",!0)])):y("",!0),e.showImageUpload&&((P=(M=m.value)==null?void 0:M.settings)!=null&&P.show_image_upload)?(n(),r("div",js,[t("h4",Ps,[u[11]||(u[11]=ne(" Upload Foto ")),(S=m.value.settings)!=null&&S.required?(n(),r("span",Fs,"*")):y("",!0)]),se(ve,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:m.value.settings,"onUpdate:modelValue":u[5]||(u[5]=d=>c.$emit("update:imagesValue",d)),onSave:u[6]||(u[6]=d=>c.$emit("saveImage",d))},null,8,["model-value","point-id","point","inspection-id","settings"]),(p=m.value.settings)!=null&&p.required&&e.imagesValue.length===0?(n(),r("p",Ts," Foto wajib diupload ")):y("",!0)])):y("",!0)])]}),_:1},8,["show","title","subtitle"]))}},As={class:"mt-2 space-y-4"},Es={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Hs=["name","value","checked","onChange","required"],zs={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},Os={key:0,class:"mt-3"},Ws={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Gs=["src"],Ks={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Xs={key:1,class:"mt-2"},Zs={class:"text-sm text-gray-600"},Js={key:2,class:"mt-2 text-sm text-red-600"},Ys={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:R}){const a=e,b=R,l=C(a.notes),m=C([...a.images]),v=C(!1),c=C(""),u=C([]),f=C(""),x=C([]),s=z(()=>a.options.find(S=>S.value===a.modelValue)),w=S=>S.settings&&(S.settings.show_textarea||S.settings.show_image_upload);W(()=>a.notes,S=>{l.value=S}),W(()=>a.images,S=>{m.value=[...S]}),W(()=>a.modelValue,S=>{S&&(f.value=S)});const h=S=>{b("update:modelValue",S.value),w(S)?I():b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:S.value,notes:"",images:[]})},V=S=>S.preview||(S.image_path?`/${S.image_path}`:S),I=()=>{f.value=a.modelValue,c.value=l.value,u.value=[...m.value],x.value=[...m.value],v.value=!0},j=()=>{c.value="",u.value=[],f.value="",v.value=!1},T=S=>{u.value=S,m.value=[...S],b("update:images",[...S]),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:l.value,images:[...S]})},q=S=>{},M=()=>{f.value!==a.modelValue&&b("update:modelValue",f.value),l.value=c.value,b("update:notes",c.value),m.value=[...u.value],b("update:images",[...u.value]),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:f.value,notes:c.value,images:u.value}),v.value=!1},P=S=>{b("hapus",S),v.value=!1};return(S,p)=>{var d,_,E,O;return n(),r("div",As,[t("div",Es,[(n(!0),r(G,null,K(e.options,(A,Q)=>(n(),r("label",{key:Q,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:A.value,checked:e.modelValue===A.value,onChange:ae=>h(A),class:"hidden peer",required:e.required},null,40,Hs),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===A.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==A.value}])},B(A.label),3)]))),128))]),e.modelValue&&s.value&&w(s.value)?(n(),r("div",zs,[t("div",{class:"flex justify-between items-start"},[p[4]||(p[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:I,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((d=s.value.settings)!=null&&d.show_image_upload)?(n(),r("div",Os,[t("div",Ws,[(n(!0),r(G,null,K(e.images,(A,Q)=>(n(),r("div",{key:Q,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:V(A),class:"w-full h-full object-cover rounded"},null,8,Gs),Q===3&&e.images.length>4?(n(),r("span",Ks," +"+B(e.images.length-4),1)):y("",!0)]))),128))])])):y("",!0),e.notes&&((_=s.value.settings)!=null&&_.show_textarea)?(n(),r("div",Xs,[t("p",Zs,B(e.notes),1)])):y("",!0)])):y("",!0),v.value?(n(),Y(xe,{key:(E=e.selectedPoint)==null?void 0:E.id,show:v.value,title:e.pointName||"Detail",subtitle:(O=s.value)==null?void 0:O.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":f.value,"notes-value":c.value,"images-value":u.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":p[0]||(p[0]=A=>f.value=A),"onUpdate:notesValue":p[1]||(p[1]=A=>c.value=A),"onUpdate:imagesValue":p[2]||(p[2]=A=>T(A)),onClose:j,onSave:M,onSaveTextarea:S.handleTextareaSave,onSaveImage:q,onHapus:p[3]||(p[3]=A=>P(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):y("",!0),e.error?(n(),r("p",Js,B(e.error),1)):y("",!0)])}}},Qs={class:"mt-2 space-y-4"},ea={key:0,class:"flex flex-wrap gap-3"},ta={key:1,class:"p-4 border rounded-lg bg-gray-50"},sa={key:0,class:"mt-3"},aa={class:"flex gap-2 overflow-x-auto scrollbar-hide"},oa=["src"],na={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ia={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},la=["name","value","checked"],ra={key:1,class:"mt-2"},da={class:"text-sm text-gray-600"},ua={key:3,class:"mt-2 text-sm text-red-600"},ca={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:R}){const a=e,b=R,l=C(a.notes),m=C([...a.images]),v=C(!1),c=C(""),u=C([]),f=C(""),x=C([]),s=z(()=>a.options.find(q=>q.value===a.modelValue)),w=q=>q.preview||(q.image_path?`/${q.image_path}`:q),h=()=>{f.value=a.modelValue||"",c.value=l.value,u.value=[...m.value],x.value=[...m.value],v.value=!0},V=()=>{c.value="",u.value=[],f.value="",v.value=!1},I=q=>{u.value=q,m.value=[...q],b("update:images",[...q]),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:l.value,images:[...q]})},j=()=>{f.value!==a.modelValue&&b("update:modelValue",f.value),l.value=c.value,b("update:notes",c.value),m.value=[...u.value],b("update:images",[...u.value]),b("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:f.value,notes:c.value,images:u.value}),v.value=!1},T=q=>{b("hapus",q),v.value=!1};return(q,M)=>{var P,S,p;return n(),r("div",Qs,[!e.modelValue&&m.value.length===0&&!l.value?(n(),r("div",ea,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:h},M[4]||(M[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),r("div",ta,[t("div",{class:"flex justify-between items-start"},[M[5]||(M[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:h,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),m.value.length>0?(n(),r("div",sa,[t("div",aa,[(n(!0),r(G,null,K(m.value,(d,_)=>(n(),r("div",{key:_,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:w(d),class:"w-full h-full object-cover rounded"},null,8,oa),_===3&&m.value.length>4?(n(),r("span",na," +"+B(m.value.length-4),1)):y("",!0)]))),128))])])):y("",!0),t("div",ia,[(n(!0),r(G,null,K(e.options,(d,_)=>(n(),r("label",{key:_,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:d.value,checked:e.modelValue===d.value,disabled:!0,class:"hidden peer"},null,8,la),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===d.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==d.value}])},B(d.label),3)]))),128))]),l.value&&((P=s.value.settings)!=null&&P.show_textarea)?(n(),r("div",ra,[t("p",da,B(l.value),1)])):y("",!0)])),v.value?(n(),Y(xe,{key:(S=e.selectedPoint)==null?void 0:S.id,show:v.value,title:e.pointName||"Detail",subtitle:(p=s.value)==null?void 0:p.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":f.value,"notes-value":c.value,"images-value":u.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":M[0]||(M[0]=d=>f.value=d),"onUpdate:notesValue":M[1]||(M[1]=d=>c.value=d),"onUpdate:imagesValue":M[2]||(M[2]=d=>I(d)),onClose:V,onSave:j,onHapus:M[3]||(M[3]=d=>T(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):y("",!0),e.error?(n(),r("p",ua,B(e.error),1)):y("",!0)])}}},ma={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ga={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},va={class:"text-xl font-semibold text-indigo-700"},ha={class:"p-4 space-y-4"},pa={class:"flex items-start justify-between"},fa={class:"block text-sm font-medium text-gray-700"},ba={key:0,class:"text-red-500"},wa={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},ya={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(e,{emit:R}){const a=e,b=R,l=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],m=f=>{var s;const x=a.form.results[f.id];if(!x)return!1;switch(f.input_type){case"text":case"number":case"date":case"account":return!!x.note;case"select":case"radio":return!!x.status;case"image":return((s=x.images)==null?void 0:s.length)>0;default:return!1}},v=(f,x)=>{b("updateResult",{pointId:f,value:x})},c=f=>{b("saveResult",f)},u=f=>{b("hapusPoint",f)};return(f,x)=>(n(),r("div",ma,[t("div",ga,[t("h2",va,B(e.category.name),1)]),t("div",ha,[(n(!0),r(G,null,K(e.category.points,s=>{var w,h,V,I,j,T,q,M,P,S,p,d,_,E,O,A,Q,ae,le,re,k,o,$,g,N;return n(),r("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",pa,[t("label",fa,[ne(B(s.name)+" ",1),(w=s.settings)!=null&&w.is_required?(n(),r("span",ba,"*")):y("",!0)]),m(s)?(n(),r("span",wa," ✓ ")):y("",!0)]),s.input_type==="text"?(n(),Y(ot,{key:0,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[i=>e.form.results[s.id].note=i,i=>v(s.id,i)],required:(h=s.settings)==null?void 0:h.is_required,"min-length":(V=s.settings)==null?void 0:V.min_length,"max-length":(I=s.settings)==null?void 0:I.max_length,pattern:(j=s.settings)==null?void 0:j.pattern,placeholder:((T=s.settings)==null?void 0:T.placeholder)||"Masukan text",error:e.form.errors[`results.${s.id}.note`],onSave:i=>c(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):y("",!0),s.input_type==="number"?(n(),Y(qe,{key:1,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[i=>e.form.results[s.id].note=i,i=>v(s.id,i)],required:(q=s.settings)==null?void 0:q.is_required,min:(M=s.settings)==null?void 0:M.min,max:(P=s.settings)==null?void 0:P.max,step:((S=s.settings)==null?void 0:S.step)||1,placeholder:((p=s.settings)==null?void 0:p.placeholder)||"Masukan number",error:e.form.errors[`results.${s.id}.note`],onSave:i=>c(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):y("",!0),s.input_type==="account"?(n(),Y(mt,{key:2,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[i=>e.form.results[s.id].note=i,i=>v(s.id,i)],required:(d=s.settings)==null?void 0:d.is_required,placeholder:((_=s.settings)==null?void 0:_.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:i=>c(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):y("",!0),s.input_type==="date"?(n(),Y(rt,{key:3,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[i=>e.form.results[s.id].note=i,i=>v(s.id,i)],required:(E=s.settings)==null?void 0:E.is_required,"min-date":(O=s.settings)==null?void 0:O.min_date,"max-date":(A=s.settings)==null?void 0:A.max_date,error:e.form.errors[`results.${s.id}.note`],onSave:i=>c(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):y("",!0),s.input_type==="textarea"?(n(),Y(ye,{key:4,modelValue:e.form.results[s.id].note,"onUpdate:modelValue":[i=>e.form.results[s.id].note=i,i=>v(s.id,i)],required:(Q=s.settings)==null?void 0:Q.is_required,"min-length":(ae=s.settings)==null?void 0:ae.min_length,"max-length":(le=s.settings)==null?void 0:le.max_length,placeholder:((re=s.settings)==null?void 0:re.placeholder)||"Masukkan teks di sini",settings:s.settings,error:e.form.errors[`results.${s.id}.note`],onSave:i=>c(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):y("",!0),s.input_type==="radio"?(n(),Y(Ys,{key:5,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[i=>e.form.results[s.id].status=i,i=>v(s.id,i)],notes:e.form.results[s.id].note,images:e.form.results[s.id].images,required:(k=s.settings)==null?void 0:k.is_required,"point-id":s.id,point:s,"inspection-id":e.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((o=s.settings)==null?void 0:o.radios)||l,error:e.form.errors[`results.${s.id}.status`],"onUpdate:notes":i=>e.form.results[s.id].note=i,"onUpdate:images":i=>e.form.results[s.id].images=i,onSave:i=>c(s.id),onHapus:i=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="imageTOradio"?(n(),Y(ca,{key:6,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[i=>e.form.results[s.id].status=i,i=>v(s.id,i)],notes:e.form.results[s.id].note,images:e.form.results[s.id].images,required:($=s.settings)==null?void 0:$.is_required,"point-id":s.id,"inspection-id":e.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((g=s.settings)==null?void 0:g.radios)||l,error:e.form.errors[`results.${s.id}.status`],"onUpdate:notes":i=>e.form.results[s.id].note=i,"onUpdate:images":i=>e.form.results[s.id].images=i,onSave:i=>c(s.id),onHapus:i=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),se(ve,{modelValue:e.form.results[s.id].images,"onUpdate:modelValue":i=>e.form.results[s.id].images=i,error:e.form.errors[`results.${s.id}.images`],"inspection-id":e.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,"onUpdate:notes":i=>e.form.results[s.id].note=i,"onUpdate:status":i=>e.form.results[s.id].status=i},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"]),s.input_type==="select"?(n(),Y(Vt,{key:7,modelValue:e.form.results[s.id].status,"onUpdate:modelValue":[i=>e.form.results[s.id].status=i,i=>v(s.id,i)],required:(N=s.settings)==null?void 0:N.is_required,error:e.form.errors[`results.${s.id}.status`],onSave:i=>c(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):y("",!0)])}),128))])]))}},Da=ie(ya,[["__scopeId","data-v-e9ae16c6"]]),xa={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ka={class:"p-4 space-y-4-6"},$a={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ia=["value"],Va={class:"p-4 space-y-4-6"},Sa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ca=["value"],_a={key:0,class:"p-4 space-y-4-6"},Ma={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ua=["value"],qa={class:"p-4 space-y-4-6"},La={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const R=e,a=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(w){return console.error("Error parsing settings JSON:",w),{}}return typeof s=="object"&&s!==null?s:{}},b=z(()=>a(R.inspection.settings).conclusion||{}),l=C({flooded:b.value.flooded||"",collision:b.value.collision||"",collision_severity:b.value.collision_severity||"",conclusion_note:R.inspection.notes||""}),m=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],v=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],c=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],u=()=>{const s={flooded:l.value.flooded,collision:l.value.collision,collision_severity:l.value.collision==="yes"?l.value.collision_severity:null,conclusion_note:l.value.conclusion_note};_e.post(route("inspections.updateConclusion",R.inspectionId),s,{preserveScroll:!0,preserveState:!0,onError:w=>{console.error("Error saving conclusion:",w)}})},f=we.debounce(u,500);W([()=>l.value.flooded,()=>l.value.collision,()=>l.value.collision_severity],()=>{u()}),he(()=>{x()}),W(()=>R.inspection,()=>{x()},{deep:!0});const x=()=>{const w=a(R.inspection.settings).conclusion||{};l.value={flooded:w.flooded||"",collision:w.collision||"",collision_severity:w.collision_severity||"",conclusion_note:R.inspection.notes||""}};return(s,w)=>(n(),r("div",xa,[w[9]||(w[9]=t("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[t("h2",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),t("div",ka,[w[5]||(w[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),t("div",$a,[(n(),r(G,null,K(m,h=>t("label",{key:h.value,class:"cursor-pointer"},[oe(t("input",{type:"radio","onUpdate:modelValue":w[0]||(w[0]=V=>l.value.flooded=V),value:h.value,class:"hidden peer"},null,8,Ia),[[ge,l.value.flooded]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.flooded===h.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.flooded!==h.value}])},B(h.label),3)])),64))])]),t("div",Va,[w[7]||(w[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),t("div",Sa,[(n(),r(G,null,K(v,h=>t("label",{key:h.value,class:"cursor-pointer"},[oe(t("input",{type:"radio","onUpdate:modelValue":w[1]||(w[1]=V=>l.value.collision=V),value:h.value,class:"hidden peer"},null,8,Ca),[[ge,l.value.collision]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision===h.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision!==h.value}])},B(h.label),3)])),64))]),l.value.collision==="yes"?(n(),r("div",_a,[w[6]||(w[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),t("div",Ma,[(n(),r(G,null,K(c,h=>t("label",{key:h.value,class:"cursor-pointer"},[oe(t("input",{type:"radio","onUpdate:modelValue":w[2]||(w[2]=V=>l.value.collision_severity=V),value:h.value,class:"hidden peer"},null,8,Ua),[[ge,l.value.collision_severity]]),t("div",{class:ee(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision_severity===h.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision_severity!==h.value}])},B(h.label),3)])),64))])])):y("",!0)]),t("div",qa,[w[8]||(w[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),oe(t("textarea",{"onUpdate:modelValue":w[3]||(w[3]=h=>l.value.conclusion_note=h),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:w[4]||(w[4]=(...h)=>J(f)&&J(f)(...h))},null,544),[[me,l.value.conclusion_note]])])]))}};export{Is as B,Da as C,Ta as V,La as _,xe as a};
