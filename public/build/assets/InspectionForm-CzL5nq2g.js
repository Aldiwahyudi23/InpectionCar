import{d as f,k as B,B as we,x as be,W as ne,z as oe,l as ke,e as g,o as u,a,b as H,f as h,c as z,n as K,F as ie,h as ae,g as le,w as O,t as _,T as re,u as m,p as _e,v as Ce}from"./app-DKBrlfM2.js";import{l as ue}from"./lodash-B6zFz3nX.js";import{V as Se,C as De,_ as Me,B as Ae,a as Ve}from"./ConclusionSection-CIDfeWYu.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"container mx-auto px-4 py-2"},Ee={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Te={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Be=["onClick"],je={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ze={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ne={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Le={class:"relative overflow-hidden"},$e={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},Fe=["disabled"],Ue={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},qe={class:"space-y-4"},Ie={class:"relative"},He={class:"max-h-64 overflow-y-auto"},Ke={key:0,class:"text-center py-4 text-gray-500"},Oe=["onClick"],Xe={class:"font-medium text-gray-900"},Je={class:"text-sm text-gray-500"},We={class:"text-xs text-gray-400 mt-1"},Qe={key:0,class:"text-xs text-green-600 mt-1"},Ge={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup(N){var se;const i=N,C=f(!1),S=f(!1),x=f(""),c=f(null),D=f(""),M=f(""),w=f([]),b=f(""),ce=(t,e)=>t.filter(s=>e?W(s.id):!0),X=B(()=>i.damagePoints||[]),J=B(()=>{if(!x.value.trim())return X.value;const t=x.value.toLowerCase().trim();return X.value.filter(e=>{var s,o,v;return((s=e.name)==null?void 0:s.toLowerCase().includes(t))||((o=e.description)==null?void 0:o.toLowerCase().includes(t))||((v=Q(e))==null?void 0:v.toLowerCase().includes(t))})}),W=t=>{var s;const e=l.results[t];return e&&(e.status||e.note||((s=e.images)==null?void 0:s.length)>0)},Q=t=>{const e=i.components.find(s=>s.id===t.component_id);return e?e.name:"Komponen Tidak Diketahui"},de=t=>t&&Array.isArray(i.existingResults)?i.existingResults.find(e=>e.point_id===t):null,pe=t=>{c.value=t;const e=l.results[t.id]||{};D.value=e.status||"",M.value=e.note||"",w.value=Array.isArray(e.images)?[...e.images]:[],C.value=!1,S.value=!0},ve=()=>{c.value&&(l.results[c.value.id]={...l.results[c.value.id],status:D.value,note:M.value,images:Array.isArray(w.value)?[...w.value]:[]},q(c.value.id),b.value="Data berhasil disimpan!",setTimeout(()=>{b.value=""},1e3)),L()},ge=()=>{C.value=!1,x.value=""},L=()=>{S.value=!1,c.value=null,D.value="",M.value="",w.value=[]},k=we().props.inspection,p=f(((se=i.appMenu[0])==null?void 0:se.id)||"conclusion"),G=f(0),A=B(()=>p.value!=="conclusion"?i.appMenu.find(t=>t.id===p.value):null),l=be((()=>{const t={};return i.appMenu.forEach(e=>{(e.points||[]).forEach(s=>{var v,r;const o=Array.isArray(i.existingResults)?i.existingResults.find(d=>d.point_id===s.id):null;t[s.id]={status:(o==null?void 0:o.status)||"",note:(o==null?void 0:o.note)||"",images:((r=(v=i.existingImages)==null?void 0:v[s.id])==null?void 0:r.map(d=>({image_path:d.image_path,preview:null})))||[]}})}),{inspection_id:i.inspection.id,results:t,overall_note:i.inspection.overall_note||""}})()),Y=t=>t.input_type==="damage"?!0:t.id==="conclusion"?F():t.points.every(e=>{var v,r,d,V,R,P,E,n,j;const s=l.results[e.id];if(!s)return!1;const o=$(e.settings);switch(e.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((v=s.note)!=null&&v.trim());case"select":case"radio":if(!s.status)return!1;const y=(r=o.radios)==null?void 0:r.find(I=>I.value===s.status);return!(y!=null&&y.settings&&(y.settings.show_textarea&&y.settings.required&&!((d=s.note)!=null&&d.trim())||y.settings.show_image_upload&&y.settings.required&&((V=s.images)==null?void 0:V.length)===0));case"imageTOradio":if(((R=s.images)==null?void 0:R.length)===0||!s.status)return!1;const T=(P=o.radios)==null?void 0:P.find(I=>I.value===s.status);return!(T!=null&&T.settings&&T.settings.show_textarea&&T.settings.required&&!((E=s.note)!=null&&E.trim()));case"image":return((n=s.images)==null?void 0:n.length)>0;default:return!!s.status||!!((j=s.note)!=null&&j.trim())}}),$=t=>{if(!t)return{};if(typeof t=="string")try{return JSON.parse(t)||{}}catch(e){return console.error("Error parsing settings JSON:",e),{}}return typeof t=="object"&&t!==null?t:{}},F=()=>{var d;const e=$(i.inspection.settings).conclusion||{},s=!!e.flooded,o=!!e.collision,v=e.collision==="yes"?!!e.collision_severity:!0,r=!!((d=i.inspection.notes)!=null&&d.trim());return s&&o&&v&&r},me=B(()=>{const e=$(i.inspection.settings).conclusion||{};return{flooded:e.flooded||null,collision:e.collision||null,collision_severity:e.collision_severity||null,note:i.inspection.notes||null,isComplete:F()}}),U=t=>{p.value=t},Z=t=>{var o;let e=G.value+t;const s=i.appMenu.length;e>=0&&e<=s&&(G.value=e,p.value=((o=i.appMenu[e])==null?void 0:o.id)||"conclusion")},fe=()=>{let t=0,e=0;const s=d=>{t=d.changedTouches[0].screenX},o=d=>{e=d.changedTouches[0].screenX,v()},v=()=>{e<t-150?Z(1):e>t+150&&Z(-1)},r=document.querySelector(".relative.overflow-hidden");return r&&(r.addEventListener("touchstart",s,!1),r.addEventListener("touchend",o,!1)),()=>{r&&(r.removeEventListener("touchstart",s),r.removeEventListener("touchend",o))}},q=ue.debounce(async t=>{try{await ne.post(route("inspections.save-result"),{inspection_id:i.inspection.id,point_id:t,status:l.results[t].status,note:l.results[t].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(e){console.error("Error menyimpan hasil:",e)}},500),he=({pointId:t,type:e,value:s})=>{l.results[t].hasOwnProperty(e)&&(l.results[t][e]=s),q(t)},ee=async t=>{if(t&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await ne.post(route("inspections.delete-result"),{inspection_id:i.inspection.id,point_id:t},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{l.results[t]&&delete l.results[t],b.value="Data berhasil dihapus!",setTimeout(()=>{b.value=""},2e3)}})}catch(e){console.error("Error menghapus hasil:",e)}L()}},ye=t=>{Object.assign(l.conclusion,t),saveConclusion()},xe=()=>{if(!te.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}l.post(route("inspections.final-submit",{id:i.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:t=>{console.error("Kesalahan pengiriman:",t)}})};oe(p,t=>{const e=document.querySelector(`.flex-shrink-0[data-category-id="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const te=B(()=>{const t=i.appMenu.every(s=>Y(s)),e=F();return t&&e});return oe(x,ue.debounce(()=>{},300)),ke(()=>{fe()}),(t,e)=>{var s,o,v,r,d,V,R,P,E;return u(),g("div",Pe,[a("div",Ee,[a("div",Te,[a("button",{onClick:e[0]||(e[0]=n=>U("vehicle")),class:K(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":p.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="vehicle"}])}," Detail Kendaraan ",2),(u(!0),g(ie,null,ae(N.appMenu,n=>(u(),g("button",{key:n.id,onClick:j=>U(n.id),class:K(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":p.value===n.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!==n.id}])},[le(_(n.name)+" ",1),Y(n)?(u(),g("span",je," ✓ ")):h("",!0)],10,Be))),128)),a("button",{onClick:e[1]||(e[1]=n=>U("conclusion")),class:K(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":p.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="conclusion"}])},[e[7]||(e[7]=le(" Kesimpulan ")),me.value.isComplete?(u(),g("span",ze," ✓ ")):h("",!0)],2)])]),H(re,{name:"fade"},{default:O(()=>[b.value?(u(),g("div",Ne,_(b.value),1)):h("",!0)]),_:1}),a("div",Le,[H(re,{name:"category-slide",mode:"out-in"},{default:O(()=>[p.value==="vehicle"?(u(),z(Se,{key:0,inspection:m(k),CarDetail:N.CarDetail,onUpdateVehicle:t.updateVehicleDetails,onSaveCarDetails:t.saveNewCarDetails},null,8,["inspection","CarDetail","onUpdateVehicle","onSaveCarDetails"])):A.value&&p.value!=="conclusion"?(u(),z(De,{key:A.value.id,category:{...A.value,points:ce(A.value.points||[],A.value.input_type==="damage")},"inspection-id":m(k).id,form:m(l),onSaveResult:m(q),onUpdateResult:he,onHapusPoint:ee,onRemoveImage:t.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):p.value==="conclusion"?(u(),z(Me,{key:2,form:m(l),"inspection-id":m(k).id,inspection:m(k),settings:m(k).settings||{},onUpdateConclusion:ye},null,8,["form","inspection-id","inspection","settings"])):h("",!0)]),_:1})]),p.value==="conclusion"?(u(),g("div",$e,[a("button",{type:"button",onClick:xe,disabled:!te.value||m(l).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[m(l).processing?(u(),g("svg",Ue,e[8]||(e[8]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):h("",!0),a("span",null,_(m(l).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Fe)])):h("",!0),!C.value&&!S.value?(u(),g("button",{key:1,onClick:e[2]||(e[2]=n=>C.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},e[9]||(e[9]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):h("",!0),H(Ae,{show:C.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:ge},{default:O(()=>[a("div",qe,[a("div",Ie,[_e(a("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>x.value=n),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Ce,x.value]]),e[10]||(e[10]=a("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[a("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),a("div",He,[J.value.length===0?(u(),g("div",Ke," Tidak ada point yang ditemukan ")):h("",!0),(u(!0),g(ie,null,ae(J.value,n=>(u(),g("button",{key:n.id,onClick:j=>pe(n),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[a("div",Xe,_(n.name),1),a("div",Je,_(n.description),1),a("div",We,_(Q(n)),1),W(n.id)?(u(),g("div",Qe," ✓ Sudah ada data ")):h("",!0)],8,Oe))),128))])])]),_:1},8,["show"]),S.value?(u(),z(Ve,{key:(s=c.value)==null?void 0:s.id,show:S.value,title:((o=c.value)==null?void 0:o.name)||"Detail Point",subtitle:(v=c.value)==null?void 0:v.description,name:`point-${(r=c.value)==null?void 0:r.id}`,"inspection-id":m(k).id,"point-id":(d=c.value)==null?void 0:d.id,settings:((V=c.value)==null?void 0:V.settings)||{},options:((P=(R=c.value)==null?void 0:R.settings)==null?void 0:P.radios)||[],"selected-Point":c.value,"selected-value":D.value,"images-value":w.value,"notes-value":M.value,point:c.value,"existing-data":de((E=c.value)==null?void 0:E.id),"onUpdate:selectedValue":e[4]||(e[4]=n=>D.value=n),"onUpdate:notesValue":e[5]||(e[5]=n=>M.value=n),"onUpdate:imagesValue":e[6]||(e[6]=n=>w.value=n),onSave:ve,onClose:L,onHapus:ee},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):h("",!0)])}}},ot=Re(Ge,[["__scopeId","data-v-305d8885"]]);export{ot as default};
