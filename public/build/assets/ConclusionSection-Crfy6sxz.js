import{x as et,r as U,e as je,p as Q,E as Te,G as me,c as n,o,d as t,b as v,i as ge,z as we,A as Ie,n as te,t as A,u as le,F as de,l as ue,k as ie,y as Se,w as Ce,L as Ve,a as Ze,g as re,j as Ke,T as tt,m as st,D as _e,W as at,M as Me,B as ot}from"./vendor-Bkx12Y4d.js";import{l as Ue}from"./lodash-DnzYreyA.js";import{_ as nt}from"./PrimaryButton-CtxUKbHz.js";import{_ as it}from"./ActionMessage-CC2Q9mP8.js";import{_ as xe}from"./app-BExo5RVc.js";import{_ as Ge}from"./InputNumber-CHto4VUJ.js";const lt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},rt={key:0,class:"p-4 space-y-2"},dt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},ut={class:"flex items-center space-x-2"},ct={key:0,class:"text-xs text-red-500 font-normal ml-2"},gt={key:1,class:"text-xs text-red-500 font-normal ml-2"},mt={key:2,class:"text-xs text-green-500 font-normal ml-2"},pt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},vt={class:"relative"},ft={key:0,class:"absolute right-3 top-3"},ht={key:1,class:"text-xs text-red-500 font-normal ml-2"},bt={key:2,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},wt={key:0},xt=["onMousedown"],yt={class:"font-medium text-gray-900"},kt={class:"text-sm text-gray-500"},$t={key:1,class:"p-4 text-sm text-gray-500 text-center"},It={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Vt={key:0,class:"mb-4"},Ct=["innerHTML"],St={key:1},_t={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Mt=["onClick"],Ut=["src","alt"],Nt={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},jt={class:"text-white text-xs text-center"},Tt={key:2,class:"text-center py-4 text-gray-500 text-sm"},qt={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Rt=["src","alt"],Bt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Lt={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Dt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},At={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation"],setup(e,{emit:z}){var ve,fe,he,be,ye,$e;const s=e,x=z,p=et({plate_number:((ve=s.inspection)==null?void 0:ve.plate_number)||"",car_id:((fe=s.inspection)==null?void 0:fe.car_id)||null,car_name:((he=s.inspection)==null?void 0:he.car_name)||""}),g=U(((be=s.inspection)==null?void 0:be.plate_number)||""),l=U(((ye=s.inspection)==null?void 0:ye.car_id)||null),d=U((($e=s.inspection)==null?void 0:$e.car_name)||""),r=U(""),I=U(""),h=U(""),$=U(!1),w=U(""),S=U(""),a=U(p.car_name),f=U(!1),C=U(!1),F=U([]),k=U(null),u=U([]),B=U(!1),V=U(0);je(()=>{var M,b,J,L,P;if(O((M=s.inspection)==null?void 0:M.plate_number),(b=s.inspection)!=null&&b.car_id&&((J=s.CarDetail)==null?void 0:J.length)>0){const oe=s.CarDetail.find(ne=>ne.id===s.inspection.car_id);oe&&y(oe)}else!((L=s.inspection)!=null&&L.car_id)&&((P=s.inspection)!=null&&P.car_name)&&(a.value=s.inspection.car_name);window.addEventListener("keydown",E),x("update:validation",ee.value)}),Te(()=>{window.removeEventListener("keydown",E)});const O=M=>{if(!M){r.value="",I.value="",h.value="";return}const b=M.toUpperCase().trim(),J=b.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(J)r.value=J[1]||"",I.value=J[2]||"",h.value=J[3]||"";else{let L="area",P="",oe="",ne="";for(const ae of b)L==="area"&&/[A-Z]/.test(ae)?P+=ae:L==="area"&&/[0-9]/.test(ae)?(L="number",oe+=ae):L==="number"&&/[0-9]/.test(ae)?oe+=ae:L==="number"&&/[A-Z]/.test(ae)?(L="suffix",ne+=ae):L==="suffix"&&/[A-Z]/.test(ae)&&(ne+=ae);r.value=P,I.value=oe,h.value=ne}H()},H=()=>{const M=`${r.value}${I.value}${h.value}`;p.plate_number=M,G()},K=M=>{M==="area"?r.value=r.value.toUpperCase().replace(/[^A-Z]/g,""):M==="number"?I.value=I.value.replace(/[^0-9]/g,""):M==="suffix"&&(h.value=h.value.toUpperCase().replace(/[^A-Z]/g,"")),H()},X=Q(()=>{const M=p.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(M)}),se=Q(()=>!a.value||a.value.trim()===""),Z=Q(()=>p.plate_number.length>0&&!X.value?"Format plat nomor tidak valid.":null),ee=Q(()=>{const M=!p.plate_number||p.plate_number.trim()==="",b=!a.value||a.value.trim()==="";return M||b||!X.value||$.value}),ce=Q(()=>{const M=p.plate_number!==g.value,b=p.car_id!==l.value||a.value!==d.value;return M||b}),pe=Q(()=>ce.value&&!ee.value),N=M=>{var J,L,P;if(!M)return"";const b=[];return(J=M.brand)!=null&&J.name&&b.push(M.brand.name),(L=M.model)!=null&&L.name&&b.push(M.model.name),(P=M.type)!=null&&P.name&&b.push(M.type.name),M.cc&&b.push(`${M.cc}cc`),M.transmission&&b.push(M.transmission),M.fuel_type&&b.push(M.fuel_type),M.year&&b.push(M.year.toString()),M.production_period&&b.push(`(${M.production_period})`),b.join(" ")},R=Ue.debounce(()=>{if(!a.value.trim()){F.value=[],f.value=!1;return}C.value=!0;try{const M=a.value.toLowerCase().trim();F.value=s.CarDetail.filter(b=>N(b).toLowerCase().includes(M)),f.value=!0}finally{C.value=!1}},300),i=()=>{setTimeout(()=>{f.value=!1},200)},y=async M=>{k.value=M,a.value=N(M),p.car_id=M.id,p.car_name=N(M),f.value=!1,await D(M.id),G(),x("update:validation",ee.value)},m=M=>!M||!M.file_path?"":`/storage/${M.file_path}`,D=async M=>{try{const b=await fetch(`/api/cars/${M}/images`);if(b.ok){const J=await b.json();u.value=Array.isArray(J)?J:[]}else u.value=[]}catch(b){console.error("Error loading car images:",b),u.value=[]}},_=M=>{V.value=M,B.value=!0,document.body.style.overflow="hidden"},W=()=>{B.value=!1,document.body.style.overflow=""},T=()=>{V.value=(V.value+1)%u.value.length},j=()=>{V.value=(V.value-1+u.value.length)%u.value.length},E=M=>{if(B.value)switch(M.key){case"Escape":W();break;case"ArrowRight":T();break;case"ArrowLeft":j();break}},G=()=>{const M={plate_number:p.plate_number,car_id:p.car_id,car_name:p.car_name};x("update-vehicle",M)},Y=()=>{s.inspection&&p.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0})};return me([()=>p.plate_number,()=>p.car_name],M=>{w.value="",$.value=!1,S.value="";const b=M[0];if(b&&b.length>=6){const J=s.allInspections.filter(L=>{var P;return L.plate_number===b&&L.id!==((P=s.inspection)==null?void 0:P.id)});if(J.length>0){const L=["draft","in_progress","pending","pending_review","revision"],P=J.find(oe=>L.includes(oe.status));if(P)$.value=!0,w.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${P.status.replace(/_/g," ").toUpperCase()}.`;else{const oe=J.filter(ne=>["approved","rejected","completed","cancelled"].includes(ne.status));if(oe.length>0){oe.sort((ae,ke)=>new Date(ke.created_at)-new Date(ae.created_at));const ne=oe[0];if(ne.car_id){const ae=s.CarDetail.find(ke=>ke.id===ne.car_id);ae&&y(ae)}else ne.car_name&&(a.value=ne.car_name,p.car_name=ne.car_name);S.value=`Nomor plat ini sudah pernah diperiksa ${oe.length} kali sebelumnya.`}}}}x("update:validation",ee.value)},{deep:!0}),(M,b)=>{var J;return o(),n("div",lt,[b[21]||(b[21]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),e.inspection?(o(),n("div",rt,[t("div",dt,[b[10]||(b[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",ut,[we(t("input",{"onUpdate:modelValue":b[0]||(b[0]=L=>r.value=L),type:"text",placeholder:"Contoh: B",class:te(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!X.value||$.value}]),onInput:b[1]||(b[1]=L=>K("area")),maxlength:"2"},null,34),[[Ie,r.value]]),we(t("input",{"onUpdate:modelValue":b[2]||(b[2]=L=>I.value=L),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:te(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!X.value||$.value}]),onInput:b[3]||(b[3]=L=>K("number")),maxlength:"4"},null,34),[[Ie,I.value]]),we(t("input",{"onUpdate:modelValue":b[4]||(b[4]=L=>h.value=L),type:"text",placeholder:"ABC",class:te(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!X.value||$.value}]),onInput:b[5]||(b[5]=L=>K("suffix")),maxlength:"3"},null,34),[[Ie,h.value]])]),Z.value?(o(),n("span",ct,A(Z.value),1)):v("",!0),w.value?(o(),n("span",gt,A(w.value),1)):v("",!0),S.value?(o(),n("span",mt,A(S.value),1)):v("",!0)]),t("div",pt,[b[13]||(b[13]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",vt,[we(t("input",{"onUpdate:modelValue":b[6]||(b[6]=L=>a.value=L),type:"text",placeholder:"Cari atau ketik nama mobil...",class:te(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":se.value}]),onInput:b[7]||(b[7]=(...L)=>le(R)&&le(R)(...L)),onFocus:b[8]||(b[8]=L=>f.value=!0),onBlur:i},null,34),[[Ie,a.value]]),C.value?(o(),n("div",ft,b[11]||(b[11]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):v("",!0),se.value?(o(),n("span",ht,"Nama mobil tidak boleh kosong.")):v("",!0),f.value?(o(),n("div",bt,[F.value.length>0?(o(),n("div",wt,[(o(!0),n(de,null,ue(F.value,L=>(o(),n("div",{key:L.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:P=>y(L)},[t("div",yt,A(N(L)),1),t("div",kt,A(L.year)+" • "+A(L.cc)+"cc • "+A(L.transmission)+" • "+A(L.fuel_type),1)],40,xt))),128))])):(o(),n("div",$t,b[12]||(b[12]=[ie(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),ie(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):v("",!0)])]),le(p).car_id&&k.value?(o(),n("div",It,[k.value.description?(o(),n("div",Vt,[b[14]||(b[14]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:k.value.description},null,8,Ct)])):v("",!0),u.value.length>0?(o(),n("div",St,[b[15]||(b[15]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",_t,[(o(!0),n(de,null,ue(u.value,(L,P)=>(o(),n("div",{key:L.id||P,class:"relative group cursor-pointer",onClick:oe=>_(P)},[t("img",{src:m(L),alt:L.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ut),L.note?(o(),n("div",Nt,[t("p",jt,A(L.note),1)])):v("",!0)],8,Mt))),128))])])):(o(),n("div",Tt," Tidak ada gambar tersedia untuk mobil ini "))])):v("",!0),B.value?(o(),n("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:W},[t("div",qt,[t("button",{onClick:W,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},b[16]||(b[16]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),u.value.length>1?(o(),n("button",{key:0,onClick:Se(j,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},b[17]||(b[17]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):v("",!0),u.value.length>1?(o(),n("button",{key:1,onClick:Se(T,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},b[18]||(b[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):v("",!0),t("img",{src:m(u.value[V.value]),alt:"Car Image "+(V.value+1),class:"max-w-full max-h-full object-contain",onClick:b[9]||(b[9]=Se(()=>{},["stop"]))},null,8,Rt),u.value.length>1?(o(),n("div",Bt,A(V.value+1)+" / "+A(u.value.length),1)):v("",!0),(J=u.value[V.value])!=null&&J.note?(o(),n("div",Lt,A(u.value[V.value].note),1)):v("",!0)])])):v("",!0),ge(nt,{type:"button",onClick:Y,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!pe.value},{default:Ce(()=>[le(p).processing?(o(),n("svg",Dt,b[19]||(b[19]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):v("",!0),t("span",null,A(le(p).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),ge(it,{on:le(p).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:Ce(()=>b[20]||(b[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ie(" Tersimpan. ")])),_:1,__:[20]},8,["on"])]),_:1},8,["disabled"])])):v("",!0)])}}},Lo=xe(At,[["__scopeId","data-v-64409708"]]),Ft={class:"mt-1"},zt=["value","required","minlength","maxlength","allowSpace","placeholder"],Et={key:0,class:"mt-2 text-sm text-red-600"},Xe={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,x=z,p=Q(()=>{if(!s.modelValue)return"";let l=s.modelValue;switch(s.allowSpace||(l=l.replace(/\s+/g,"")),s.textTransform){case"uppercase":return l.toUpperCase();case"lowercase":return l.toLowerCase();case"capitalize":return l.replace(/\b\w/g,d=>d.toUpperCase());default:return l}}),g=l=>{let d=l.target.value;switch(s.allowSpace||(d=d.replace(/\s+/g,"")),s.textTransform){case"uppercase":d=d.toUpperCase();break;case"lowercase":d=d.toLowerCase();break;case"capitalize":d=d.replace(/\b\w/g,r=>r.toUpperCase());break}x("update:modelValue",d),x("save",s.pointId)};return(l,d)=>(o(),n("div",Ft,[t("input",{value:p.value,onInput:g,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,allowSpace:e.allowSpace,placeholder:e.placeholder,class:te(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:e.textTransform==="uppercase",lowercase:e.textTransform==="lowercase",capitalize:e.textTransform==="capitalize"}])},null,42,zt),e.error?(o(),n("p",Et,A(e.error),1)):v("",!0)]))}},Ht={class:"mt-1"},Ot=["value","required","min","max"],Wt={key:0,class:"mt-2 text-sm text-red-600"},Ye={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,x=z,p=g=>{x("update:modelValue",g.target.value),x("save",s.pointId)};return(g,l)=>(o(),n("div",Ht,[t("input",{value:e.modelValue,onChange:p,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ot),e.error?(o(),n("p",Wt,A(e.error),1)):v("",!0)]))}},Zt={class:"mt-1"},Kt=["value","required","placeholder"],Gt={key:0,class:"mt-2 text-sm text-red-600"},Je={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,x=z,p=U(""),g=Q(()=>{var h,$,w,S;return{currency_symbol:((h=s.settings)==null?void 0:h.currency_symbol)||"Rp",thousands_separator:(($=s.settings)==null?void 0:$.thousands_separator)||",",min_value:((w=s.settings)==null?void 0:w.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((S=s.settings)==null?void 0:S.max_value)!==void 0?Number(s.settings.max_value):1e9}}),l=h=>{if(h==null||h==="")return"";const $=Number(h);if(isNaN($))return"";let w=$.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return g.value.thousands_separator!==","&&(w=w.replace(/,/g,g.value.thousands_separator)),w},d=h=>h?h.replace(/[^\d]/g,""):"",r=Q(()=>p.value?`${g.value.currency_symbol} ${l(p.value)}`:""),I=h=>{let $=d(h.target.value),w=Number($);g.value.min_value!==void 0&&w<g.value.min_value&&($=g.value.min_value.toString()),g.value.max_value!==void 0&&w>g.value.max_value&&($=g.value.max_value.toString()),p.value=$,x("update:modelValue",$),x("save",s.pointId)};return me(()=>s.modelValue,h=>{h!=null&&(p.value=h.toString())},{immediate:!0}),(h,$)=>(o(),n("div",Zt,[t("input",{value:r.value,onInput:I,type:"text",required:e.required,placeholder:e.placeholder,class:te(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",e.error?"border-red-300":"border-gray-300"])},null,42,Kt),e.error?(o(),n("p",Gt,A(e.error),1)):v("",!0)]))}},Xt={class:"mt-1 space-y-3"},Yt={key:0,class:"space-y-2"},Jt={class:"flex flex-wrap gap-2"},Qt=["onClick"],Pt=["value","required","minlength","maxlength","placeholder"],es={class:"flex justify-between items-center mt-1"},ts={class:"text-xs text-gray-500"},ss={key:0,class:"text-xs text-red-600"},Qe={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,x=z,p=U([]),g=U(""),l=h=>p.value.some($=>$.value===h),d=h=>{l(h.value)?p.value=p.value.filter(a=>a.value!==h.value):p.value.push(h);const w=[...p.value.map(a=>a.value)];g.value.trim()&&w.push(g.value.trim());const S=w.join(", ");x("update:modelValue",S),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:S})},r=h=>{const $=h.target.value;x("update:modelValue",$),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:$}),I($)},I=h=>{var a,f,C,F;if(!h){p.value=[],g.value="";return}const $=h.split(",").map(k=>k.trim()).filter(k=>k),w=((f=(a=s.settings)==null?void 0:a.damage_options)==null?void 0:f.map(k=>k.value))||[];p.value=((F=(C=s.settings)==null?void 0:C.damage_options)==null?void 0:F.filter(k=>$.includes(k.value)))||[];const S=$.filter(k=>!w.includes(k));g.value=S.join(", ")};return me(()=>s.modelValue,h=>{h!=null&&I(h)},{immediate:!0}),(h,$)=>{var w,S,a;return o(),n("div",Xt,[(w=e.settings)!=null&&w.enable_damage&&((S=e.settings)!=null&&S.damage_options)?(o(),n("div",Yt,[$[0]||($[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",Jt,[(o(!0),n(de,null,ue(e.settings.damage_options,(f,C)=>(o(),n("button",{key:C,type:"button",onClick:F=>d(f),class:te(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":l(f.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!l(f.value)}])},A(f.label),11,Qt))),128))])])):v("",!0),t("div",null,[t("textarea",{value:e.modelValue,onInput:r,required:e.required,minlength:e.minLength,maxlength:e.maxLength,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Pt),t("div",es,[t("span",ts,A(((a=e.modelValue)==null?void 0:a.length)||0)+"/"+A(e.maxLength||400),1),e.error?(o(),n("p",ss,A(e.error),1)):v("",!0)])])])}}},as={class:"mt-1"},os=["value","required"],ns={key:0,class:"mt-2 text-sm text-red-600"},is={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:z}){const s=e,x=z,p=g=>{x("update:modelValue",g.target.value),x("save",s.pointId)};return(g,l)=>(o(),n("div",as,[t("select",{value:e.modelValue,onChange:p,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},l[0]||(l[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,os),e.error?(o(),n("p",ns,A(e.error),1)):v("",!0)]))}},ls=xe(is,[["__scopeId","data-v-c34a74db"]]),rs={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},ds={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},us={class:"text-xs text-gray-500 mt-2 text-center"},cs={class:"flex flex-row space-x-4 mb-6"},gs={class:"mt-4 text-right"},ms={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(e){return(z,s)=>e.show?(o(),n("div",rs,[t("div",ds,[s[7]||(s[7]=t("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),t("p",us,[s[3]||(s[3]=ie("Ambil Foto Maksimal: ")),t("b",null,A(e.settings.max_files),1),s[4]||(s[4]=ie(" Dengan Rasio & Ukuran: ")),t("b",null,A(e.settings.camera_aspect_ratio),1)]),t("div",cs,[t("button",{onClick:s[0]||(s[0]=x=>z.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[5]||(s[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:s[1]||(s[1]=x=>z.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[6]||(s[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",gs,[t("button",{onClick:s[2]||(s[2]=x=>z.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):v("",!0)}},ps={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},vs={class:"webcam-content-box"},fs={class:"webcam-header"},hs={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},bs={class:"inspection-point-name"},ws={key:0,class:"screen-flash-overlay"},xs={key:2,class:"zoom-controls"},ys=["max"],ks={class:"webcam-footer"},$s={class:"camera-controls"},Is=["disabled"],Vs={class:"camera-icon-container"},Cs={key:0,class:"camera-spinner"},Ss={key:1,class:"camera-body"},_s={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(e,{emit:z}){const s=e,x=z,p=U(null),g=U(null);let l=null,d=null;const r=U("environment"),I=U(!1),h=U(!1),$=U(!1),w=U(!1),S=U(!1),a=U({}),f=U(!1),C=U(1),F=U(1),k=U(!1),u=Q(()=>{var N;return((N=s.settings)==null?void 0:N.max_size)||2048}),B=Q(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),V=Q(()=>{if(!s.aspectRatio)return{};const N=s.aspectRatio,R=N>1?80:60,i=N>1?80/N:60*N;return{width:`${R}%`,height:`${i}%`}}),O=async()=>{l&&l.getTracks().forEach(N=>N.stop());try{const N={facingMode:r.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};l=await navigator.mediaDevices.getUserMedia({video:N,audio:!1}),d=l.getVideoTracks()[0],p.value.srcObject=l,p.value.onloadedmetadata=async()=>{await K(),await p.value.play()}}catch(N){console.error("Error accessing camera: ",N),alert("Failed to access camera. Please allow camera permission."),x("close")}},H=()=>{l&&l.getTracks().forEach(N=>N.stop()),x("close")},K=async()=>{if(d)try{const N=await navigator.mediaDevices.enumerateDevices();I.value=N.filter(i=>i.kind==="videoinput").length>1;const R=d.getCapabilities();R.zoom?(k.value=!0,F.value=R.zoom.max,console.log(`Zoom supported. Max zoom: ${F.value}`)):(k.value=!1,console.warn("Zoom is not supported by this camera.")),h.value=R.torch||R.fillLightMode&&R.fillLightMode.includes("torch")}catch(N){console.error("Error checking camera capabilities:",N)}},X=async N=>{if(!d)return;const R=p.value.getBoundingClientRect(),i=N.clientX-R.left,y=N.clientY-R.top;S.value=!0,a.value={left:`${i}px`,top:`${y}px`,transform:"translate(-50%, -50%)"};try{if(d.getCapabilities().pointsOfInterest){const D=i/R.width,_=y/R.height;await d.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:D,y:_}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(m){console.warn("Manual focus failed:",m)}setTimeout(()=>{S.value=!1,d.getCapabilities().focusMode.includes("continuous")&&d.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},se=async N=>{if(!d||!k.value)return;const R=Math.min(Math.max(N,1),F.value);C.value=R;try{await d.applyConstraints({advanced:[{zoom:R}]})}catch(i){console.error("Failed to set zoom:",i)}},Z=async()=>{if(!(!d||!h.value))try{r.value==="user"?($.value=!$.value,w.value=$.value):(await d.applyConstraints({advanced:[{torch:!$.value}]}),$.value=!$.value)}catch(N){console.error("Flash toggle failed:",N)}},ee=async()=>{I.value&&(r.value=r.value==="environment"?"user":"environment",l&&l.getTracks().forEach(N=>N.stop()),await O())},ce=async N=>new Promise(R=>{const i=u.value*1024;if(N.size<=i){R(N);return}const y=new Image,m=new FileReader;m.onload=D=>{y.onload=()=>{const _=document.createElement("canvas"),W=_.getContext("2d"),T=Math.sqrt(i/N.size);_.width=y.width*T,_.height=y.height*T,W.drawImage(y,0,0,_.width,_.height);let j=.9;const E=()=>{_.toBlob(G=>{G.size>i&&j>.1?(j-=.1,E()):R(G)},"image/jpeg",j)};E()},y.src=D.target.result},m.readAsDataURL(N)}),pe=async()=>{if(!(f.value||!p.value||!g.value)){f.value=!0;try{const N=p.value,R=g.value,i=N.videoWidth,y=N.videoHeight;let m,D,_,W;i/y>s.aspectRatio?(D=y,m=y*s.aspectRatio,_=(i-m)/2,W=0):(m=i,D=i/s.aspectRatio,_=0,W=(y-D)/2),R.width=m,R.height=D,R.getContext("2d").drawImage(N,_,W,m,D,0,0,m,D);const j=await new Promise(G=>{R.toBlob(G,"image/jpeg",1)}),E=await ce(j);if(E){const G=new File([E],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});x("photoCaptured",G),w.value=!0,setTimeout(()=>{w.value=!1},100)}}catch(N){console.error("Error capturing photo:",N),alert("Failed to capture photo. Please try again.")}finally{f.value=!1}}};return me(()=>s.show,N=>{N?O():H()}),Te(()=>{l&&l.getTracks().forEach(N=>N.stop())}),(N,R)=>{var i;return e.show?(o(),n("div",ps,[t("div",vs,[t("div",fs,[t("p",hs,A(e.settings.camera_aspect_ratio),1),t("div",bs,A(((i=e.point)==null?void 0:i.name)||"Camera"),1),t("button",{onClick:H,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},R[2]||(R[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:Ve(B.value),onClick:X,onTouchstart:X},[t("video",{ref_key:"webcamVideo",ref:p,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:g,class:"hidden"},null,512),w.value?(o(),n("div",ws)):v("",!0),t("div",{class:"aspect-ratio-guide",style:Ve(V.value)},null,4),S.value?(o(),n("div",{key:1,class:"focus-indicator",style:Ve(a.value)},R[3]||(R[3]=[t("div",{class:"focus-ring"},null,-1)]),4)):v("",!0),R[4]||(R[4]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),k.value?(o(),n("div",xs,[we(t("input",{type:"range",min:"1",max:F.value,step:"0.1","onUpdate:modelValue":R[0]||(R[0]=y=>C.value=y),onInput:R[1]||(R[1]=y=>se(parseFloat(y.target.value))),class:"zoom-slider"},null,40,ys),[[Ie,C.value]])])):v("",!0)],36),t("div",ks,[t("div",$s,[e.settings.enable_flash&&h.value?(o(),n("button",{key:0,onClick:Z,class:te(["control-button",{active:$.value,disabled:!h.value}])},R[5]||(R[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):v("",!0),t("button",{onClick:pe,class:"capture-button",disabled:f.value},[t("div",Vs,[f.value?(o(),n("div",Cs)):(o(),n("div",Ss,R[6]||(R[6]=[t("div",{class:"camera-lens"},null,-1),t("div",{class:"camera-flash"},null,-1)])))])],8,Is),e.settings.enable_camera_switch&&I.value?(o(),n("button",{key:1,onClick:ee,class:"control-button"},R[7]||(R[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):v("",!0)])])])])):v("",!0)}}},Ms=xe(_s,[["__scopeId","data-v-b94530cf"]]),Us={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Ns={class:"w-full h-full flex flex-col"},js={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Ts={class:"text-lg font-semibold"},qs={class:"flex items-center gap-2"},Rs={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Bs=["src"],Ls={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Ds={class:"flex justify-between items-center w-full"},As=["disabled"],Fs={key:1,class:"flex-1"},zs=["disabled"],Es={class:"flex gap-3 w-full"},Hs={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},Os={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(e,{emit:z}){const s=e,x=z,p=U(0),g=U([]),l=Q(()=>g.value.length>0?g.value[p.value]:null);me(()=>s.images,f=>{g.value=f.map(C=>({...C,rotation:C.rotation||0})),f.length===0&&s.show&&w()},{deep:!0,immediate:!0}),me(()=>s.show,f=>{f&&s.images.length>0&&(p.value=s.initialIndex)});const d=f=>f.preview||(f.image_path?`/${f.image_path}`:""),r=()=>{if(l.value){const f=(l.value.rotation+90)%360;g.value[p.value].rotation=f,x("update:images",g.value)}},I=()=>{p.value=p.value<g.value.length-1?p.value+1:0},h=()=>{p.value=p.value>0?p.value-1:g.value.length-1},$=()=>{s.isUploading||x("saveImages",g.value)},w=()=>{s.isUploading||x("close")},S=()=>{if(l.value&&!s.isUploading){const f=l.value,C=g.value.findIndex(F=>F.isNew&&f.isNew&&F.preview===f.preview||!F.isNew&&!f.isNew&&F.id===f.id);C!==-1&&(x("removePreviewImage",f),g.value.splice(C,1),x("update:images",g.value)),p.value>=g.value.length&&(p.value=Math.max(0,g.value.length-1)),g.value.length===0&&x("close")}},a=()=>{s.isUploading||x("triggerAddMorePhotos")};return(f,C)=>{var F;return e.show?(o(),n("div",Us,[t("div",Ns,[t("div",js,[t("button",{onClick:w,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},C[0]||(C[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("div",Ts,A(((F=e.point)==null?void 0:F.name)||"Preview")+" ("+A(p.value+1)+"/"+A(g.value.length)+") ",1),t("div",qs,[l.value&&l.value.isNew?(o(),n("button",{key:0,onClick:S,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},C[1]||(C[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):v("",!0),l.value&&l.value.isNew?(o(),n("button",{key:1,onClick:r,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},C[2]||(C[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))):v("",!0)])]),t("div",Rs,[t("div",{class:"relative w-full max-w-full",style:Ve({paddingTop:e.aspectRatio?100/e.aspectRatio+"%":"75%"})},[l.value?(o(),n("img",{key:0,src:d(l.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Ve({transform:`rotate(${l.value.rotation}deg)`})},null,12,Bs)):v("",!0)],4),g.value.length>1?(o(),n("button",{key:0,onClick:h,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},C[3]||(C[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):v("",!0),g.value.length>1?(o(),n("button",{key:1,onClick:I,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},C[4]||(C[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):v("",!0)]),t("div",Ls,[t("div",Ds,[l.value&&!l.value.isNew?(o(),n("button",{key:0,onClick:S,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:e.isUploading},C[5]||(C[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ie(" Hapus Foto ")]),8,As)):(o(),n("div",Fs)),e.allowMultiple&&g.value.length<e.maxFiles?(o(),n("button",{key:2,onClick:a,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:e.isUploading},C[6]||(C[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ie(" Tambah Foto ")]),8,zs)):v("",!0)]),t("div",Es,[e.isUploading?(o(),n("button",Hs,C[7]||(C[7]=[ie(" Menyimpan"),t("span",{class:"loading-dots ml-1"},[t("span",null,"."),t("span",null,"."),t("span",null,".")],-1)]))):(o(),n("button",{key:0,onClick:$,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):v("",!0)}}},Ws=xe(Os,[["__scopeId","data-v-41f87672"]]),Zs=["accept","multiple","disabled"],Ks={class:"text-xs text-gray-500 mb-2"},Gs=["disabled"],Xs={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Ys={class:"text-xs text-gray-400 mt-1"},Js={key:0,class:"flex items-center gap-4"},Qs=["src"],Ps=["disabled"],ea={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ta=["disabled"],sa=["onClick"],aa=["src"],oa={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},na={key:0},ia={key:1,class:"ml-1"},la={key:2,class:"mt-1 text-xs text-red-600"},ra={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(e,{emit:z}){const s=e,x=z,p=U(null),g=U(null),l=U(!1),d=U(!1),r=U(!1),I=U([]),h=U(0),$=U(!1),w=Q(()=>Number(s.settings.max_files)>1),S=Q(()=>s.settings.allowed_types.map(i=>`.${i}`).join(", ")),a=Q(()=>{const i=s.settings.camera_aspect_ratio.split(":");if(i.length===2){const y=parseFloat(i[0]),m=parseFloat(i[1]);if(!isNaN(y)&&!isNaN(m)&&m!==0)return y/m}return 3/4}),f=Q(()=>{const i=[],y=new Set;for(const m of I.value)m.id&&y.add(m.id),i.push(m);for(const m of s.modelValue)y.has(m.id)||i.push({...m,rotation:m.rotation||0,isNew:!1,preview:m.preview||(m.image_path?`/${m.image_path}`:null)});return i}),C=i=>i.preview||(i.image_path?`/${i.image_path}`:""),F=()=>{r.value&&(r.value=!1),l.value=!0},k=()=>{l.value=!1,p.value.click()},u=()=>{l.value=!1,d.value=!0},B=()=>{l.value=!1,f.value.length>0&&(r.value=!0)},V=()=>{d.value=!1,f.value.length>0&&(r.value=!0)},O=()=>{r.value=!1,I.value.forEach(i=>{i.preview&&i.preview.startsWith("blob:")&&URL.revokeObjectURL(i.preview)}),I.value=[]},H=i=>new Promise(y=>{const m=new FileReader;m.onload=D=>{const _=new Image;_.onload=()=>{y({file:i,preview:URL.createObjectURL(i),rotation:0,width:_.naturalWidth,height:_.naturalHeight,isNew:!0})},_.onerror=()=>{console.error("Failed to load image for dimensions:",i.name),y({file:i,preview:URL.createObjectURL(i),rotation:0,width:0,height:0,isNew:!0})},_.src=D.target.result},m.readAsDataURL(i)}),K=i=>{const y=i.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(y)},X=async i=>{const m=(s.settings.max_size||2048)*1024;return new Promise(D=>{const _=new Image,W=new FileReader;W.onload=T=>{_.onload=()=>{const j=document.createElement("canvas"),E=j.getContext("2d"),G=Math.max(_.width,_.height);j.width=G,j.height=G,E.fillStyle="white",E.fillRect(0,0,G,G);const Y=(G-_.width)/2,ve=(G-_.height)/2;E.drawImage(_,Y,ve,_.width,_.height);let fe=.9;const he=()=>{j.toBlob(be=>{if(be.size>m&&fe>.1)fe-=.1,he();else{const ye=new File([be],i.name,{type:"image/jpeg",lastModified:Date.now()});D(ye)}},"image/jpeg",fe)};he()},_.src=T.target.result},W.readAsDataURL(i)})},se=async i=>{const y=Array.from(i.target.files);if(!y.length){l.value=!1,f.value.length>0&&(r.value=!0);return}try{const m=y.filter(E=>!K(E));if(m.length>0){const E=m.map(G=>G.name.split(".").pop()).join(", ");alert(`File type not allowed: ${E}. Allowed types: ${s.settings.allowed_types.join(", ")}`),i.target.value="";return}const D=f.value.length,_=s.settings.max_files-D,W=await Promise.all(y.slice(0,_).map(async E=>await X(E))),T=await Promise.all(W.map(H)),j=w.value?T:T.slice(0,1);w.value?I.value.push(...j):(I.value.forEach(E=>{E.preview&&E.preview.startsWith("blob:")&&URL.revokeObjectURL(E.preview)}),I.value=j),l.value=!1,j.length>0?(h.value=Math.max(0,f.value.length-j.length),r.value=!0):f.value.length>0&&(r.value=!0),i.target.value=""}catch(m){console.error("Error processing selected images:",m),alert("Failed to process selected images. Please try again."),l.value=!1,f.value.length>0&&(r.value=!0)}},Z=async i=>{const y=f.value.length;if(!w.value||y<s.settings.max_files)try{const m=await X(i),D=new Image;D.onload=()=>{const _={file:m,preview:URL.createObjectURL(m),rotation:0,width:D.naturalWidth,height:D.naturalHeight,isNew:!0};w.value?I.value.push(_):(I.value.forEach(W=>{W.preview&&W.preview.startsWith("blob:")&&URL.revokeObjectURL(W.preview)}),I.value=[_]),d.value=!1,l.value=!1,h.value=f.value.length-1,r.value=!0},D.src=URL.createObjectURL(m)}catch(m){console.error("Error processing captured image:",m),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),d.value=!1,l.value=!1,f.value.length>0&&(r.value=!0)},ee=(i=0)=>{h.value=i,r.value=!0},ce=i=>new Promise(y=>{if(i.rotation===0||!g.value){if(!i.isNew&&!i.file){y({file:null,width:i.width,height:i.height,isOriginal:!0});return}y({file:i.file,width:i.width,height:i.height});return}const m=new Image;m.onload=async()=>{try{const D=g.value,_=D.getContext("2d"),W=m.width,T=m.height;let j,E;i.rotation===90||i.rotation===270?(j=T,E=W):(j=W,E=T),D.width=j,D.height=E,_.clearRect(0,0,D.width,D.height),_.translate(D.width/2,D.height/2),_.rotate(i.rotation*Math.PI/180),_.drawImage(m,-W/2,-T/2,W,T),_.setTransform(1,0,0,1,0,0);const G=await new Promise(fe=>{D.toBlob(fe,"image/jpeg",.9)}),Y=new File([G],i.file?i.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),ve=await X(Y);y({file:ve,width:j,height:E})}catch(D){console.error("Error processing rotated image:",D),y({file:i.file,width:i.width,height:i.height})}},m.onerror=()=>{console.error("Failed to load image for rotation processing:",i.preview),y({file:i.file,width:i.width,height:i.height})},m.src=i.preview}),pe=async i=>{var D,_,W,T;$.value=!0;const y=[],m=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),$.value=!1;return}try{for(const j of i){if(!j.isNew&&j.rotation===0&&j.id&&j.image_path){y.push({id:j.id,image_path:j.image_path,width:j.width,height:j.height,rotation:0,preview:j.preview});continue}const{file:E,width:G,height:Y,isOriginal:ve}=await ce(j);if(ve&&!j.isNew){y.push({id:j.id,image_path:j.image_path,width:j.width,height:j.height,rotation:0,preview:j.preview});continue}E&&m.push({file:E,width:G,height:Y,rotation:0})}if(m.length>0){const j=new FormData;j.append("inspection_id",s.inspectionId),j.append("point_id",s.pointId),m.forEach(Y=>{j.append("images[]",Y.file)});const G=(await Ze.post(route("inspections.upload-image"),j,{headers:{"Content-Type":"multipart/form-data"}})).data.images;for(const Y of G)y.push({id:Y.image_id,image_path:Y.path,width:Y.width||0,height:Y.height||0,rotation:Y.rotation||0,preview:Y.public_url});m.forEach(Y=>{Y.file&&Y.file.preview&&Y.file.preview.startsWith("blob:")&&URL.revokeObjectURL(Y.file.preview)})}x("update:modelValue",y),x("save",s.pointId),x("uploaded",{pointId:s.pointId,images:y}),O()}catch(j){if(console.error("Error during image processing/upload:",j),(_=(D=j.response)==null?void 0:D.data)!=null&&_.message)alert(`Failed to save images: ${j.response.data.message}`);else if((T=(W=j.response)==null?void 0:W.data)!=null&&T.errors){const E=Object.values(j.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${E}`)}else alert(`Failed to save images: ${j.message}`)}finally{$.value=!1}},N=i=>{if(i){if(i.id&&!i.isNew)R(i);else{const y=I.value.findIndex(m=>m.preview&&m.preview===i.preview&&m.isNew||m.id&&m.id===i.id);if(y!==-1){const m=I.value.splice(y,1)[0];m.preview&&m.preview.startsWith("blob:")&&URL.revokeObjectURL(m.preview)}x("update:modelValue",s.modelValue.filter(m=>!(m.id&&m.id===i.id)&&!(m.preview&&m.preview===i.preview)))}h.value>=f.value.length&&(h.value=Math.max(0,f.value.length-1)),f.value.length===0&&O()}},R=async i=>{var m,D;if(i.id||i.image_path)try{await Ze.delete(route("inspections.delete-image"),{data:{image_id:i.id,image_path:i.image_path}})}catch(_){console.error("Error deleting image from server:",_),(D=(m=_.response)==null?void 0:m.data)!=null&&D.message?alert(`Failed to delete image from server: ${_.response.data.message}`):alert(`Failed to delete image from server: ${_.message}`);return}i.preview&&i.preview.startsWith("blob:")&&URL.revokeObjectURL(i.preview);const y=s.modelValue.filter(_=>_.id!==i.id);x("update:modelValue",y),I.value=I.value.filter(_=>_.isNew&&i.isNew?_.preview!==i.preview:_.id!==i.id),x("removeImage",{image:i}),r.value&&f.value.length===0?O():r.value&&h.value>=f.value.length&&(h.value=Math.max(0,f.value.length-1))};return(i,y)=>(o(),n("div",null,[t("input",{ref_key:"galleryInput",ref:p,type:"file",accept:S.value,class:"hidden",onChange:se,multiple:w.value,disabled:$.value},null,40,Zs),t("canvas",{ref_key:"processingCanvas",ref:g,class:"hidden"},null,512),t("p",Ks,"Foto Maksimal: "+A(e.settings.max_files)+" | Rasio: "+A(e.settings.camera_aspect_ratio),1),f.value.length===0?(o(),n("label",{key:0,onClick:F,class:te(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:$.value},[t("div",Xs,[y[2]||(y[2]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),y[3]||(y[3]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),t("p",Ys,"Tipe: "+A(S.value),1)])],8,Gs)):(o(),n("div",{key:1,class:te(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":e.settings.max_files==1,"bg-transparent":e.settings.max_files>1}]),"aria-label":"Image gallery"},[e.settings.max_files===1?(o(),n("div",Js,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:y[0]||(y[0]=m=>ee(0))},[t("img",{src:C(f.value[0]),class:"w-full h-full object-cover"},null,8,Qs)]),t("button",{onClick:y[1]||(y[1]=Se(m=>R(f.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:$.value},y[4]||(y[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ie(" Hapus Foto ")]),8,Ps)])):(o(),n("div",ea,[w.value&&f.value.length<e.settings.max_files?(o(),n("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:F,disabled:$.value},y[5]||(y[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,ta)):v("",!0),(o(!0),n(de,null,ue(f.value,(m,D)=>(o(),n("div",{key:m.id||m.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:_=>ee(D)},[t("img",{src:C(m),class:"w-full h-full object-cover"},null,8,aa),m.isNew||m.rotation!==0?(o(),n("div",oa,[m.isNew?(o(),n("span",na,"BARU")):v("",!0),m.rotation!==0?(o(),n("span",ia,"ROTASI")):v("",!0)])):v("",!0)],8,sa))),128))]))],2)),e.error?(o(),n("p",la,A(e.error),1)):v("",!0),ge(ms,{show:l.value,settings:e.settings,onClose:B,onOpenWebcam:u,onTriggerGallery:k},null,8,["show","settings"]),ge(Ms,{show:d.value,"aspect-ratio":a.value,settings:e.settings,point:e.point,onClose:V,onPhotoCaptured:Z},null,8,["show","aspect-ratio","settings","point"]),ge(Ws,{show:r.value,images:f.value,point:e.point,"initial-index":h.value,"allow-multiple":w.value,"max-files":e.settings.max_files,"is-uploading":$.value,"aspect-ratio":a.value,onClose:O,onSaveImages:pe,onRemovePreviewImage:N,onTriggerAddMorePhotos:F},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},Ne=xe(ra,[["__scopeId","data-v-771b7e31"]]),da={key:0,class:"fixed inset-0 z-50 overflow-hidden"},ua={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},ca={class:"px-4 pb-2 border-b border-gray-200"},ga={class:"text-lg font-semibold text-gray-900"},ma={key:0,class:"text-sm text-gray-500 mt-1"},pa={class:"flex-1 overflow-y-auto p-4"},va={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},fa={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(e,{emit:z}){const s=z,x=()=>{s("close")},p=g=>{g.key==="Escape"&&x()};return je(()=>{document.addEventListener("keydown",p)}),Te(()=>{document.removeEventListener("keydown",p)}),(g,l)=>(o(),re(tt,{name:"bottom-sheet"},{default:Ce(()=>[e.show?(o(),n("div",da,[t("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:x}),t("div",ua,[l[0]||(l[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",ca,[t("h3",ga,A(e.title),1),e.subtitle?(o(),n("p",ma,A(e.subtitle),1)):v("",!0)]),t("div",pa,[Ke(g.$slots,"default",{},void 0,!0)]),g.$slots.footer?(o(),n("div",va,[Ke(g.$slots,"footer",{},void 0,!0)])):v("",!0)])])):v("",!0)]),_:3}))}},ha=xe(fa,[["__scopeId","data-v-7893c2dc"]]),ba={class:"space-y-4"},wa={key:0,class:"mt-2"},xa={key:1,class:"mt-2"},ya={key:2,class:"mt-2"},ka={key:3,class:"mt-2"},$a={key:4,class:"mt-2"},Ia={class:"text-sm font-medium text-gray-700 mb-2"},Va={key:0,class:"text-red-500"},Ca={key:0,class:"text-xs text-red-500"},Sa=["name","value","checked"],_a={key:6,class:"space-y-2"},Ma={key:0,class:"text-red-500"},Ua={key:1,class:"text-xs text-red-500"},Na={key:7,class:"mt-4"},ja={class:"text-sm font-medium text-gray-700 mb-2"},Ta={key:0,class:"text-red-500"},qa={key:0,class:"text-xs text-red-500"},Ra={class:"flex gap-2"},Ba=["disabled"],Pe={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(e,{emit:z}){const s=e,x=z,p=d=>x("hapus",d),g=Q(()=>s.options.find(d=>d.value===s.selectedValue)),l=Q(()=>{var r,I,h,$,w,S,a;if(s.point.input_type==="text"&&(!((r=s.notesValue)!=null&&r.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((I=s.notesValue)!=null&&I.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((h=s.notesValue)!=null&&h.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!(($=s.notesValue)!=null&&$.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date)||s.point.input_type==="imageTOradio"&&s.imagesValue.length===0||s.options.length&&!s.selectedValue)return!1;const d=g.value;return!(s.showTextarea&&((w=d==null?void 0:d.settings)!=null&&w.show_textarea)&&(!((S=s.notesValue)!=null&&S.trim())||d.settings.min_length&&s.notesValue.length<d.settings.min_length||d.settings.max_length&&s.notesValue.length>d.settings.max_length)||s.showImageUpload&&((a=d==null?void 0:d.settings)!=null&&a.show_image_upload)&&(s.imagesValue.length===0||d.settings.max_files&&s.imagesValue.length>d.settings.max_files))});return(d,r)=>(o(),re(ha,{show:e.show,title:e.title,subtitle:e.subtitle,onClose:r[18]||(r[18]=I=>d.$emit("close"))},{footer:Ce(()=>[e.selectedPoint?(o(),n("button",{key:0,onClick:r[15]||(r[15]=I=>p(e.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},r[20]||(r[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ie(" Hapus Data ")]))):v("",!0),t("div",Ra,[t("button",{type:"button",onClick:r[16]||(r[16]=I=>d.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:r[17]||(r[17]=I=>d.$emit("save")),disabled:!l.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Ba)])]),default:Ce(()=>{var I,h,$,w,S,a,f,C,F,k,u,B,V,O,H,K,X,se,Z,ee,ce,pe,N,R,i,y,m,D,_,W;return[t("div",ba,[e.point.input_type==="text"?(o(),n("div",wa,[ge(Xe,{"model-value":e.notesValue,required:(I=e.point.settings)==null?void 0:I.is_required,"min-length":(h=e.point.settings)==null?void 0:h.min_length,"max-length":($=e.point.settings)==null?void 0:$.max_length,allowSpace:(w=e.point.settings)==null?void 0:w.allow_space,textTransform:(S=e.point.settings)==null?void 0:S.text_transform,placeholder:((a=e.point.settings)==null?void 0:a.placeholder)||"Masukan text",error:d.error,"onUpdate:modelValue":r[0]||(r[0]=T=>d.$emit("update:notesValue",T)),onSave:r[1]||(r[1]=T=>d.$emit("saveText",T))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):v("",!0),e.point.input_type==="number"?(o(),n("div",xa,[ge(Ge,{"model-value":e.notesValue,required:(f=e.point.settings)==null?void 0:f.is_required,min:(C=e.point.settings)==null?void 0:C.min,max:(F=e.point.settings)==null?void 0:F.max,step:((k=e.point.settings)==null?void 0:k.step)||1,placeholder:((u=e.point.settings)==null?void 0:u.placeholder)||"Masukan number",error:d.error,"onUpdate:modelValue":r[2]||(r[2]=T=>d.$emit("update:notesValue",T)),onSave:r[3]||(r[3]=T=>d.$emit("saveNumber",T))},null,8,["model-value","required","min","max","step","placeholder","error"])])):v("",!0),e.point.input_type==="account"?(o(),n("div",ya,[ge(Je,{"model-value":e.notesValue,required:(B=e.point.settings)==null?void 0:B.is_required,placeholder:((V=e.point.settings)==null?void 0:V.placeholder)||"Masukkan nilai",error:d.error,"point-id":e.pointId,settings:e.point.settings,"onUpdate:modelValue":r[4]||(r[4]=T=>d.$emit("update:notesValue",T)),onSave:r[5]||(r[5]=T=>d.$emit("saveAccount",T))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):v("",!0),e.point.input_type==="date"?(o(),n("div",ka,[ge(Ye,{"model-value":e.notesValue,required:(O=e.point.settings)==null?void 0:O.is_required,"min-date":(H=e.point.settings)==null?void 0:H.min_date,"max-date":(K=e.point.settings)==null?void 0:K.max_date,error:d.error,"onUpdate:modelValue":r[6]||(r[6]=T=>d.$emit("update:notesValue",T)),onSave:r[7]||(r[7]=T=>d.$emit("saveDate",T))},null,8,["model-value","required","min-date","max-date","error"])])):v("",!0),e.point.input_type==="imageTOradio"?(o(),n("div",$a,[t("h4",Ia,[(X=e.point.settings)!=null&&X.required?(o(),n("span",Va,"*")):v("",!0)]),ge(Ne,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point.inspection_point,"inspection-id":e.inspectionId,settings:e.point.settings,"onUpdate:modelValue":r[8]||(r[8]=T=>d.$emit("update:imagesValue",T)),onSave:r[9]||(r[9]=T=>d.$emit("saveImage",T))},null,8,["model-value","point-id","point","inspection-id","settings"]),(se=e.point.settings)!=null&&se.required&&e.imagesValue.length===0?(o(),n("p",Ca," Foto wajib diupload ")):v("",!0)])):v("",!0),e.options.length?(o(),n("div",{key:5,class:te(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(o(!0),n(de,null,ue(e.options,(T,j)=>(o(),n("label",{key:j,class:"cursor-pointer"},[t("input",{type:"radio",name:e.name,value:T.value,checked:e.selectedValue===T.value,onChange:r[10]||(r[10]=E=>d.$emit("update:selectedValue",E.target.value)),class:"hidden peer"},null,40,Sa),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.selectedValue===T.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.selectedValue!==T.value}])},A(T.label),3)]))),128))],2)):v("",!0),e.showTextarea&&((ee=(Z=g.value)==null?void 0:Z.settings)!=null&&ee.show_textarea)?(o(),n("div",_a,[(ce=g.value.settings)!=null&&ce.required?(o(),n("span",Ma,"*")):v("",!0),ge(Qe,{"model-value":e.notesValue,"point-id":e.pointId,"inspection-id":e.inspectionId,settings:g.value.settings,required:(pe=g.value.settings)==null?void 0:pe.required,"min-length":(N=g.value.settings)==null?void 0:N.min_length,"max-length":(R=g.value.settings)==null?void 0:R.max_length,placeholder:((i=g.value.settings)==null?void 0:i.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":r[11]||(r[11]=T=>d.$emit("update:notesValue",T)),onSave:r[12]||(r[12]=T=>d.$emit("saveTextarea",T))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(y=g.value.settings)!=null&&y.required&&!e.notesValue?(o(),n("p",Ua," Keterangan wajib diisi ")):v("",!0)])):v("",!0),e.showImageUpload&&((D=(m=g.value)==null?void 0:m.settings)!=null&&D.show_image_upload)?(o(),n("div",Na,[t("h4",ja,[r[19]||(r[19]=ie(" Upload Foto ")),(_=g.value.settings)!=null&&_.required?(o(),n("span",Ta,"*")):v("",!0)]),ge(Ne,{"model-value":e.imagesValue,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,settings:g.value.settings,"onUpdate:modelValue":r[13]||(r[13]=T=>d.$emit("update:imagesValue",T)),onSave:r[14]||(r[14]=T=>d.$emit("saveImage",T))},null,8,["model-value","point-id","point","inspection-id","settings"]),(W=g.value.settings)!=null&&W.required&&e.imagesValue.length===0?(o(),n("p",qa," Foto wajib diupload ")):v("",!0)])):v("",!0)])]}),_:1},8,["show","title","subtitle"]))}},La={class:"mt-2 space-y-2"},Da=["name","value","checked","onChange","required"],Aa={key:0,class:"p-2 rounded-lg bg-gray-50"},Fa={key:0,class:"mt-2"},za={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Ea=["src"],Ha={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Oa={key:1,class:"mt-2"},Wa={class:"text-sm text-gray-600"},Za={key:2,class:"mt-2 text-sm text-red-600"},Ka={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:z}){const s=e,x=z,p=U(s.notes),g=U([...s.images]),l=U(!1),d=U(""),r=U([]),I=U(""),h=U([]),$=Q(()=>s.options.find(V=>V.value===s.modelValue)),w=V=>V.settings&&(V.settings.show_textarea||V.settings.show_image_upload);me(()=>s.notes,V=>{p.value=V}),me(()=>s.images,V=>{g.value=[...V]}),me(()=>s.modelValue,V=>{V&&(I.value=V)});const S=V=>{x("update:modelValue",V.value),w(V)?f():x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:V.value,notes:"",images:[]})},a=V=>V.preview||(V.image_path?`/${V.image_path}`:V),f=()=>{I.value=s.modelValue,d.value=p.value,r.value=[...g.value],h.value=[...g.value],l.value=!0},C=()=>{d.value="",r.value=[],I.value="",l.value=!1},F=V=>{r.value=V,g.value=[...V],x("update:images",[...V]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:p.value,images:[...V]})},k=V=>{},u=()=>{I.value!==s.modelValue&&x("update:modelValue",I.value),p.value=d.value,x("update:notes",d.value),g.value=[...r.value],x("update:images",[...r.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:I.value,notes:d.value,images:r.value}),l.value=!1},B=V=>{x("hapus",V),l.value=!1};return(V,O)=>{var H,K,X,se;return o(),n("div",La,[t("div",{class:te(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(o(!0),n(de,null,ue(e.options,(Z,ee)=>(o(),n("label",{key:ee,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:Z.value,checked:e.modelValue===Z.value,onChange:ce=>S(Z),class:"hidden peer",required:e.required},null,40,Da),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===Z.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==Z.value}])},A(Z.label),3)]))),128))],2),e.modelValue&&$.value&&w($.value)?(o(),n("div",Aa,[t("div",{class:"flex justify-between items-start"},[O[4]||(O[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:f,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),e.images.length>0&&((H=$.value.settings)!=null&&H.show_image_upload)?(o(),n("div",Fa,[t("div",za,[(o(!0),n(de,null,ue(e.images,(Z,ee)=>(o(),n("div",{key:ee,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:a(Z),class:"w-full h-full object-cover rounded"},null,8,Ea),ee===3&&e.images.length>4?(o(),n("span",Ha," +"+A(e.images.length-4),1)):v("",!0)]))),128))])])):v("",!0),e.notes&&((K=$.value.settings)!=null&&K.show_textarea)?(o(),n("div",Oa,[t("p",Wa,A(e.notes),1)])):v("",!0)])):v("",!0),l.value?(o(),re(Pe,{key:(X=e.selectedPoint)==null?void 0:X.id,show:l.value,title:e.pointName||"Detail",subtitle:(se=$.value)==null?void 0:se.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":I.value,"notes-value":d.value,"images-value":r.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":O[0]||(O[0]=Z=>I.value=Z),"onUpdate:notesValue":O[1]||(O[1]=Z=>d.value=Z),"onUpdate:imagesValue":O[2]||(O[2]=Z=>F(Z)),onClose:C,onSave:u,onSaveTextarea:V.handleTextareaSave,onSaveImage:k,onHapus:O[3]||(O[3]=Z=>B(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):v("",!0),e.error?(o(),n("p",Za,A(e.error),1)):v("",!0)])}}},Ga={class:"mt-2 space-y-2"},Xa={key:0,class:"flex flex-wrap gap-3"},Ya={key:1,class:"p-2"},Ja={key:0,class:"mt-2"},Qa={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Pa=["src"],eo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},to=["name","value","checked"],so={key:1,class:"mt-2"},ao={class:"text-sm text-gray-600"},oo={key:3,class:"mt-2 text-sm text-red-600"},no={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(e,{emit:z}){const s=e,x=z,p=U(s.notes),g=U([...s.images]),l=U(!1),d=U(""),r=U([]),I=U(""),h=U([]),$=Q(()=>s.options.find(k=>k.value===s.modelValue)),w=k=>k.preview||(k.image_path?`/${k.image_path}`:k);me(()=>s.notes,k=>{p.value=k});const S=()=>{I.value=s.modelValue||"",d.value=p.value,r.value=[...g.value],h.value=[...g.value],l.value=!0},a=()=>{d.value="",r.value=[],I.value="",l.value=!1},f=k=>{r.value=k,g.value=[...k],x("update:images",[...k]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:p.value,images:[...k]})},C=()=>{I.value!==s.modelValue&&x("update:modelValue",I.value),p.value=d.value,x("update:notes",d.value),g.value=[...r.value],x("update:images",[...r.value]),x("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:I.value,notes:d.value,images:r.value}),l.value=!1},F=k=>{x("hapus",k),l.value=!1};return(k,u)=>{var B,V,O;return o(),n("div",Ga,[!e.modelValue&&g.value.length===0&&!p.value?(o(),n("div",Xa,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:S},u[4]||(u[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(o(),n("div",Ya,[t("div",{class:"flex justify-between items-start"},[u[5]||(u[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:S,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),g.value.length>0?(o(),n("div",Ja,[t("div",Qa,[(o(!0),n(de,null,ue(g.value,(H,K)=>(o(),n("div",{key:K,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:w(H),class:"w-full h-full object-cover rounded"},null,8,Pa),K===3&&g.value.length>4?(o(),n("span",eo," +"+A(g.value.length-4),1)):v("",!0)]))),128))])])):v("",!0),t("div",{class:te(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(e.options.length,3)}`])},[(o(!0),n(de,null,ue(e.options,(H,K)=>(o(),n("label",{key:K,class:"cursor-pointer"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:H.value,checked:e.modelValue===H.value,disabled:!0,class:"hidden peer"},null,8,to),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":e.modelValue===H.value,"border-gray-300 text-gray-700 hover:bg-gray-50":e.modelValue!==H.value}])},A(H.label),3)]))),128))],2),p.value&&((B=$.value.settings)!=null&&B.show_textarea)?(o(),n("div",so,[t("p",ao,A(p.value),1)])):v("",!0)])),l.value?(o(),re(Pe,{key:(V=e.selectedPoint)==null?void 0:V.id,show:l.value,title:e.pointName||"Detail",subtitle:(O=$.value)==null?void 0:O.description,name:"modal-radio-"+e.pointId,options:e.options,"selected-value":I.value,"notes-value":d.value,"images-value":r.value,"point-id":e.pointId,point:e.point,"inspection-id":e.inspectionId,"selected-point":e.selectedPoint,"onUpdate:selectedValue":u[0]||(u[0]=H=>I.value=H),"onUpdate:notesValue":u[1]||(u[1]=H=>d.value=H),"onUpdate:imagesValue":u[2]||(u[2]=H=>f(H)),onClose:a,onSave:C,onHapus:u[3]||(u[3]=H=>F(e.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):v("",!0),e.error?(o(),n("p",oo,A(e.error),1)):v("",!0)])}}},io={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},lo={class:"bg-indigo-200 px-6 py-2 border-b"},ro={class:"text-xl font-semibold text-indigo-700"},uo={class:"p-4 space-y-4"},co={class:"flex items-start justify-between"},go={class:"block text-sm font-medium text-gray-700"},mo={key:0,class:"text-red-500"},po={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},vo={key:0,class:"text-center py-8 text-gray-500"},fo={key:0,class:"text-xs text-gray-400"},ho={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(e,{emit:z}){const s=e,x=z,p=st(),g=Q(()=>{var S;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(S=s.category.points)==null?void 0:S.length}),!s.category.isDamageMenu)return console.log("Menu biasa - tampilkan semua points"),s.category.points||[];const w=(s.category.points||[]).filter(a=>{var F,k;const f=(F=a.inspection_point)==null?void 0:F.id,C=l(f);return console.log(`Point ${f} (${(k=a.inspection_point)==null?void 0:k.name}): hasData = ${C}`),C});return console.log("Filtered damage points:",w),w}),l=w=>{if(!w)return console.log("hasPointData: pointId is null/undefined"),!1;const S=p.props.existingResults[w]!==void 0,a=p.props.existingImages[w]&&p.props.existingImages[w].length>0,f=s.form.results[w]&&(s.form.results[w].status||s.form.results[w].note),C=s.form.images[w]&&s.form.images[w].length>0,F=S||a||f||C;return console.log(`Point ${w} data check:`,{hasServerResult:S,hasServerImages:a,hasLocalResult:f,hasLocalImages:C,finalResult:F}),F},d=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],r=w=>{var f,C,F,k,u,B,V,O,H;const S=s.form.results[(f=w.inspection_point)==null?void 0:f.id],a=s.form.images[(C=w.inspection_point)==null?void 0:C.id];if(!S)return!1;switch(w.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!S.note;case"select":case"radio":if(!S.status)return!1;const K=(k=(F=w.settings)==null?void 0:F.radios)==null?void 0:k.find(se=>se.value===S.status);return!(K!=null&&K.settings&&(K.settings.show_textarea&&!((u=S.note)!=null&&u.trim())||K.settings.show_image_upload&&(a==null?void 0:a.length)===0));case"imageTOradio":if((a==null?void 0:a.length)===0||!S.status)return!1;const X=(V=(B=w.settings)==null?void 0:B.radios)==null?void 0:V.find(se=>se.value===S.status);return!(X!=null&&X.settings&&X.settings.show_textarea&&!((O=S.note)!=null&&O.trim()));case"image":return(a==null?void 0:a.length)>0;default:return!!S.status||!!((H=S.note)!=null&&H.trim())}},I=(w,S,a)=>{x("updateResult",{pointId:w,type:a,value:S})},h=w=>{x("saveResult",w)},$=w=>{x("hapusPoint",w)};return(w,S)=>(o(),n("div",io,[t("div",lo,[t("h3",ro,A(e.category.name),1)]),t("div",uo,[(o(!0),n(de,null,ue(g.value,a=>{var f,C,F,k,u,B,V,O,H,K,X,se,Z,ee,ce,pe,N,R,i,y,m,D,_,W,T,j,E,G,Y,ve,fe,he,be,ye,$e,M,b,J,L,P,oe,ne,ae,ke,qe,Re,Be,Le,De,Ae,Fe,ze,Ee,He,Oe,We;return o(),n("div",{key:a.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",co,[t("label",go,[ie(A((f=a.inspection_point)==null?void 0:f.name)+" ",1),(C=a.settings)!=null&&C.is_required?(o(),n("span",mo,"*")):v("",!0)]),r(a)?(o(),n("span",po," ✓ ")):v("",!0)]),a.input_type==="text"?(o(),re(Xe,{key:0,modelValue:e.form.results[(F=a.inspection_point)==null?void 0:F.id].note,"onUpdate:modelValue":[q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].note=q},q=>{var c;return I((c=a.inspection_point)==null?void 0:c.id,q,"note")}],required:(k=a.settings)==null?void 0:k.is_required,"min-length":(u=a.settings)==null?void 0:u.min_length,"max-length":(B=a.settings)==null?void 0:B.max_length,allowSpace:(V=a.settings)==null?void 0:V.allow_space,textTransform:(O=a.settings)==null?void 0:O.text_transform,placeholder:((H=a.settings)==null?void 0:H.placeholder)||"Masukan text",error:e.form.errors[`results.${(K=a.inspection_point)==null?void 0:K.id}.note`],onSave:q=>{var c;return h((c=a.inspection_point)==null?void 0:c.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):v("",!0),a.input_type==="number"?(o(),re(Ge,{key:1,modelValue:e.form.results[(X=a.inspection_point)==null?void 0:X.id].note,"onUpdate:modelValue":[q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].note=q},q=>{var c;return I((c=a.inspection_point)==null?void 0:c.id,q,"note")}],required:(se=a.settings)==null?void 0:se.is_required,min:(Z=a.settings)==null?void 0:Z.min,max:(ee=a.settings)==null?void 0:ee.max,step:((ce=a.settings)==null?void 0:ce.step)||1,placeholder:((pe=a.settings)==null?void 0:pe.placeholder)||"Masukan number",error:e.form.errors[`results.${(N=a.inspection_point)==null?void 0:N.id}.note`],onSave:q=>{var c;return h((c=a.inspection_point)==null?void 0:c.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):v("",!0),a.input_type==="account"?(o(),re(Je,{key:2,modelValue:e.form.results[(R=a.inspection_point)==null?void 0:R.id].note,"onUpdate:modelValue":[q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].note=q},q=>{var c;return I((c=a.inspection_point)==null?void 0:c.id,q,"note")}],required:(i=a.settings)==null?void 0:i.is_required,placeholder:((y=a.settings)==null?void 0:y.placeholder)||"Masukkan nilai",error:e.form.errors[`results.${(m=a.inspection_point)==null?void 0:m.id}.note`],"point-id":(D=a.inspection_point)==null?void 0:D.id,settings:a.settings,onSave:q=>{var c;return h((c=a.inspection_point)==null?void 0:c.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):v("",!0),a.input_type==="date"?(o(),re(Ye,{key:3,modelValue:e.form.results[(_=a.inspection_point)==null?void 0:_.id].note,"onUpdate:modelValue":[q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].note=q},q=>{var c;return I((c=a.inspection_point)==null?void 0:c.id,q,"note")}],required:(W=a.settings)==null?void 0:W.is_required,"min-date":(T=a.settings)==null?void 0:T.min_date,"max-date":(j=a.settings)==null?void 0:j.max_date,error:e.form.errors[`results.${(E=a.inspection_point)==null?void 0:E.id}.note`],onSave:q=>{var c;return h((c=a.inspection_point)==null?void 0:c.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):v("",!0),a.input_type==="textarea"?(o(),re(Qe,{key:4,modelValue:e.form.results[(G=a.inspection_point)==null?void 0:G.id].note,"onUpdate:modelValue":[q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].note=q},q=>{var c;return I((c=a.inspection_point)==null?void 0:c.id,q,"note")}],required:(Y=a.settings)==null?void 0:Y.is_required,"min-length":(ve=a.settings)==null?void 0:ve.min_length,"max-length":(fe=a.settings)==null?void 0:fe.max_length,placeholder:((he=a.settings)==null?void 0:he.placeholder)||"Masukkan teks di sini",settings:a.settings,error:e.form.errors[`results.${(be=a.inspection_point)==null?void 0:be.id}.note`],onSave:q=>{var c;return h((c=a.inspection_point)==null?void 0:c.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):v("",!0),a.input_type==="radio"?(o(),re(Ka,{key:5,modelValue:e.form.results[(ye=a.inspection_point)==null?void 0:ye.id].status,"onUpdate:modelValue":[q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].status=q},q=>{var c;return I((c=a.inspection_point)==null?void 0:c.id,q,"status")}],notes:e.form.results[($e=a.inspection_point)==null?void 0:$e.id].note,images:e.form.images[(M=a.inspection_point)==null?void 0:M.id],required:(b=a.settings)==null?void 0:b.is_required,"point-id":(J=a.inspection_point)==null?void 0:J.id,point:a.inspection_point,"inspection-id":e.inspectionId,settings:a.settings,"point-name":(L=a.inspection_point)==null?void 0:L.name,"selected-point":a.input_type==="damage"?a.inspection_point:null,options:((P=a.settings)==null?void 0:P.radios)||d,error:e.form.errors[`results.${(oe=a.inspection_point)==null?void 0:oe.id}.status`],"onUpdate:notes":q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].note=q},"onUpdate:images":q=>{var c;return e.form.images[(c=a.inspection_point)==null?void 0:c.id]=q},onSave:q=>{var c;return h((c=a.inspection_point)==null?void 0:c.id)},onHapus:q=>{var c;return $((c=a.inspection_point)==null?void 0:c.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):v("",!0),a.input_type==="imageTOradio"?(o(),re(no,{key:6,modelValue:e.form.results[(ne=a.inspection_point)==null?void 0:ne.id].status,"onUpdate:modelValue":[q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].status=q},q=>{var c;return I((c=a.inspection_point)==null?void 0:c.id,q,"status")}],notes:e.form.results[(ae=a.inspection_point)==null?void 0:ae.id].note,images:e.form.images[(ke=a.inspection_point)==null?void 0:ke.id],required:(qe=a.settings)==null?void 0:qe.is_required,"point-id":(Re=a.inspection_point)==null?void 0:Re.id,"inspection-id":e.inspectionId,settings:a.settings,"point-name":(Be=a.inspection_point)==null?void 0:Be.name,point:a,"selected-point":a.input_type==="damage"?a.inspection_point:null,options:((Le=a.settings)==null?void 0:Le.radios)||d,error:e.form.errors[`results.${(De=a.inspection_point)==null?void 0:De.id}.status`],"onUpdate:notes":q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].note=q},"onUpdate:images":q=>{var c;return e.form.images[(c=a.inspection_point)==null?void 0:c.id]=q},onSave:q=>{var c;return h((c=a.inspection_point)==null?void 0:c.id)},onHapus:q=>{var c;return $((c=a.inspection_point)==null?void 0:c.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):v("",!0),a.input_type==="image"?(o(),re(Ne,{key:7,modelValue:e.form.images[(Ae=a.inspection_point)==null?void 0:Ae.id],"onUpdate:modelValue":q=>{var c;return e.form.images[(c=a.inspection_point)==null?void 0:c.id]=q},error:e.form.errors[`images.${(Fe=a.inspection_point)==null?void 0:Fe.id}`],"inspection-id":e.inspectionId,"point-id":(ze=a.inspection_point)==null?void 0:ze.id,point:a.inspection_point,"point-name":(Ee=a.inspection_point)==null?void 0:Ee.name,settings:a.settings,"onUpdate:notes":q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].note=q},"onUpdate:status":q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].status=q}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):v("",!0),a.input_type==="select"?(o(),re(ls,{key:8,modelValue:e.form.results[(He=a.inspection_point)==null?void 0:He.id].status,"onUpdate:modelValue":[q=>{var c;return e.form.results[(c=a.inspection_point)==null?void 0:c.id].status=q},q=>{var c;return I((c=a.inspection_point)==null?void 0:c.id,q,"status")}],required:(Oe=a.settings)==null?void 0:Oe.is_required,error:e.form.errors[`results.${(We=a.inspection_point)==null?void 0:We.id}.status`],onSave:q=>{var c;return h((c=a.inspection_point)==null?void 0:c.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):v("",!0)])}),128)),g.value.length===0?(o(),n("div",vo,[S[0]||(S[0]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),S[1]||(S[1]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),e.category.isDamageMenu?(o(),n("p",fo,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):v("",!0)])):v("",!0)])]))}},Do=xe(ho,[["__scopeId","data-v-cdbefdf5"]]),bo={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},wo={class:"p-4 space-y-4-6"},xo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},yo=["value"],ko={class:"p-4 space-y-4-6"},$o={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Io=["value"],Vo={key:0,class:"p-4 space-y-4"},Co={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},So=["value"],_o={class:"p-4 space-y-2"},Mo={class:"flex gap-1 mb-2 p-2 bg-gray-100 rounded-md"},Uo={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(e){const z=e,s=U(null),x=U(!1),p=k=>{if(!k)return{};if(typeof k=="string")try{return JSON.parse(k)||{}}catch(u){return console.error("Error parsing settings JSON:",u),{}}return typeof k=="object"&&k!==null?k:{}},g=Q(()=>p(z.inspection.settings).conclusion||{}),l=U({flooded:g.value.flooded||"",collision:g.value.collision||"",collision_severity:g.value.collision_severity||"",conclusion_note:z.inspection.notes||""}),d=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],r=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],I=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];je(()=>{F(),_e(()=>{h()})});const h=()=>{s.value&&l.value.conclusion_note&&(s.value.innerHTML=l.value.conclusion_note)},$=Ue.debounce(()=>{if(s.value){const k=window.getSelection();k.rangeCount>0&&k.getRangeAt(0),l.value.conclusion_note=s.value.innerHTML,C()}},500),w=k=>{k.preventDefault(),document.execCommand("insertParagraph",!1,null)},S=k=>{k.preventDefault();const u=(k.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,u)},a=k=>{if(!s.value)return;s.value.focus();const u=window.getSelection();switch(u.rangeCount>0&&u.getRangeAt(0),k){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"underline":document.execCommand("underline",!1,null);break}$()},f=()=>{x.value=!1,s.value&&(l.value.conclusion_note=s.value.innerHTML,C())},C=Ue.debounce(()=>{const k={flooded:l.value.flooded,collision:l.value.collision,collision_severity:l.value.collision==="yes"?l.value.collision_severity:null,conclusion_note:l.value.conclusion_note};at.post(route("inspections.updateConclusion",z.inspectionId),k,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{_e(()=>{if(s.value){const u=document.createRange(),B=window.getSelection();u.selectNodeContents(s.value),u.collapse(!1),B.removeAllRanges(),B.addRange(u)}})},onError:u=>{console.error("Error saving conclusion:",u)}})},500);me([()=>l.value.flooded,()=>l.value.collision,()=>l.value.collision_severity],()=>{C()});const F=()=>{const u=p(z.inspection.settings).conclusion||{};l.value={flooded:u.flooded||"",collision:u.collision||"",collision_severity:u.collision_severity||"",conclusion_note:z.inspection.notes||""}};return me(()=>z.inspection,()=>{F(),_e(()=>{h()})},{deep:!0}),(k,u)=>(o(),n("div",bo,[u[18]||(u[18]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[t("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),t("div",wo,[u[11]||(u[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ie(" Apakah kendaraan pernah terkena banjir? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",xo,[(o(),n(de,null,ue(d,B=>t("label",{key:B.value,class:"cursor-pointer"},[we(t("input",{type:"radio","onUpdate:modelValue":u[0]||(u[0]=V=>l.value.flooded=V),value:B.value,class:"hidden peer",onChange:u[1]||(u[1]=(...V)=>le(C)&&le(C)(...V))},null,40,yo),[[Me,l.value.flooded]]),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.flooded===B.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.flooded!==B.value}])},A(B.label),3)])),64))])]),t("div",ko,[u[13]||(u[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ie(" Apakah kendaraan pernah mengalami tabrakan? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",$o,[(o(),n(de,null,ue(r,B=>t("label",{key:B.value,class:"cursor-pointer"},[we(t("input",{type:"radio","onUpdate:modelValue":u[2]||(u[2]=V=>l.value.collision=V),value:B.value,class:"hidden peer",onChange:u[3]||(u[3]=(...V)=>le(C)&&le(C)(...V))},null,40,Io),[[Me,l.value.collision]]),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision===B.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision!==B.value}])},A(B.label),3)])),64))]),l.value.collision==="yes"?(o(),n("div",Vo,[u[12]||(u[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ie("Tingkat kerusakan: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Co,[(o(),n(de,null,ue(I,B=>t("label",{key:B.value,class:"cursor-pointer"},[we(t("input",{type:"radio","onUpdate:modelValue":u[4]||(u[4]=V=>l.value.collision_severity=V),value:B.value,class:"hidden peer",onChange:u[5]||(u[5]=(...V)=>le(C)&&le(C)(...V))},null,40,So),[[Me,l.value.collision_severity]]),t("div",{class:te(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision_severity===B.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision_severity!==B.value}])},A(B.label),3)])),64))])])):v("",!0)]),t("div",_o,[u[17]||(u[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),t("div",Mo,[t("button",{type:"button",onClick:u[6]||(u[6]=B=>a("bold")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Bold"},u[14]||(u[14]=[t("strong",null,"B",-1)])),t("button",{type:"button",onClick:u[7]||(u[7]=B=>a("italic")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Italic"},u[15]||(u[15]=[t("em",null,"I",-1)])),t("button",{type:"button",onClick:u[8]||(u[8]=B=>a("underline")),class:"p-2 rounded hover:bg-gray-200 transition-colors",title:"Underline"},u[16]||(u[16]=[t("u",null,"U",-1)]))]),t("div",{ref_key:"editorRef",ref:s,contenteditable:"true",class:te(["w-full min-h-[120px] p-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 prose max-w-none",{"bg-white":!x.value,"bg-blue-50":x.value}]),onInput:u[9]||(u[9]=(...B)=>le($)&&le($)(...B)),onBlur:f,onFocus:u[10]||(u[10]=B=>x.value=!0),onKeydown:ot(w,["enter"]),onPaste:S,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},Ao=xe(Uo,[["__scopeId","data-v-d6653a95"]]);export{ha as B,Do as C,Lo as V,Pe as _,Ao as a};
