import{d as f,k as j,q as ke,x as _e,W as N,s as ie,y as Ce,e as g,o as u,a,b as H,f as h,c as $,n as O,F as ae,h as le,g as re,t as w,w as X,T as ue,u as m,l as Se,z as De}from"./app-AyoF6FYC.js";import{l as J,_ as Me,C as Ae,a as Re,B as Pe,b as Ee}from"./ConclusionSection-Bme5c8Fr.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Te={class:"container mx-auto px-4 py-2"},je={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},ze={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Be=["onClick"],Ne={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},$e={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Le={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Fe={class:"relative overflow-hidden"},qe={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},Ue=["disabled"],Ie={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ke={class:"space-y-4"},He={class:"relative"},Oe={class:"max-h-64 overflow-y-auto"},Xe={key:0,class:"text-center py-4 text-gray-500"},Je=["onClick"],We={class:"font-medium text-gray-900"},Qe={class:"text-sm text-gray-500"},Ge={class:"text-xs text-gray-400 mt-1"},Ye={key:0,class:"text-xs text-green-600 mt-1"},Ze={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup(z){var oe;const i=z,C=f(!1),S=f(!1),b=f(""),c=f(null),D=f(""),M=f(""),k=f([]),_=f(""),ce=(t,e)=>t.filter(s=>e?G(s.id):!0),W=j(()=>i.damagePoints||[]),Q=j(()=>{if(!b.value.trim())return W.value;const t=b.value.toLowerCase().trim();return W.value.filter(e=>{var s,o,v;return((s=e.name)==null?void 0:s.toLowerCase().includes(t))||((o=e.description)==null?void 0:o.toLowerCase().includes(t))||((v=Y(e))==null?void 0:v.toLowerCase().includes(t))})}),G=t=>{var s;const e=l.results[t];return e&&(e.status||e.note||((s=e.images)==null?void 0:s.length)>0)},Y=t=>{const e=i.components.find(s=>s.id===t.component_id);return e?e.name:"Komponen Tidak Diketahui"},de=t=>t&&Array.isArray(i.existingResults)?i.existingResults.find(e=>e.point_id===t):null,pe=t=>{c.value=t;const e=l.results[t.id]||{};D.value=e.status||"",M.value=e.note||"",k.value=Array.isArray(e.images)?[...e.images]:[],C.value=!1,S.value=!0},ve=()=>{c.value&&(l.results[c.value.id]={...l.results[c.value.id],status:D.value,note:M.value,images:Array.isArray(k.value)?[...k.value]:[]},I(c.value.id),_.value="Data berhasil disimpan!",setTimeout(()=>{_.value=""},1e3)),L()},ge=()=>{C.value=!1,b.value=""},L=()=>{S.value=!1,c.value=null,D.value="",M.value="",k.value=[]},y=ke().props.inspection,p=f(((oe=i.appMenu[0])==null?void 0:oe.id)||"conclusion"),Z=f(0),A=j(()=>p.value!=="conclusion"?i.appMenu.find(t=>t.id===p.value):null),l=_e((()=>{const t={};return i.appMenu.forEach(e=>{(e.points||[]).forEach(s=>{var v,r;const o=Array.isArray(i.existingResults)?i.existingResults.find(d=>d.point_id===s.id):null;t[s.id]={status:(o==null?void 0:o.status)||"",note:(o==null?void 0:o.note)||"",images:((r=(v=i.existingImages)==null?void 0:v[s.id])==null?void 0:r.map(d=>({image_path:d.image_path,preview:null})))||[]}})}),{inspection_id:i.inspection.id,results:t,overall_note:i.inspection.overall_note||""}})()),ee=t=>t.input_type==="damage"?!0:t.id==="conclusion"?q():t.points.every(e=>{var v,r,d,R,P,E,V,n,B;const s=l.results[e.id];if(!s)return!1;const o=F(e.settings);switch(e.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((v=s.note)!=null&&v.trim());case"select":case"radio":if(!s.status)return!1;const x=(r=o.radios)==null?void 0:r.find(K=>K.value===s.status);return!(x!=null&&x.settings&&(x.settings.show_textarea&&x.settings.required&&!((d=s.note)!=null&&d.trim())||x.settings.show_image_upload&&x.settings.required&&((R=s.images)==null?void 0:R.length)===0));case"imageTOradio":if(((P=s.images)==null?void 0:P.length)===0||!s.status)return!1;const T=(E=o.radios)==null?void 0:E.find(K=>K.value===s.status);return!(T!=null&&T.settings&&T.settings.show_textarea&&T.settings.required&&!((V=s.note)!=null&&V.trim()));case"image":return((n=s.images)==null?void 0:n.length)>0;default:return!!s.status||!!((B=s.note)!=null&&B.trim())}}),F=t=>{if(!t)return{};if(typeof t=="string")try{return JSON.parse(t)||{}}catch(e){return console.error("Error parsing settings JSON:",e),{}}return typeof t=="object"&&t!==null?t:{}},q=()=>{var d;const e=F(i.inspection.settings).conclusion||{},s=!!e.flooded,o=!!e.collision,v=e.collision==="yes"?!!e.collision_severity:!0,r=!!((d=i.inspection.notes)!=null&&d.trim());return s&&o&&v&&r},me=j(()=>{const e=F(i.inspection.settings).conclusion||{};return{flooded:e.flooded||null,collision:e.collision||null,collision_severity:e.collision_severity||null,note:i.inspection.notes||null,isComplete:q()}}),U=t=>{p.value=t},te=t=>{var o;let e=Z.value+t;const s=i.appMenu.length;e>=0&&e<=s&&(Z.value=e,p.value=((o=i.appMenu[e])==null?void 0:o.id)||"conclusion")},fe=()=>{let t=0,e=0;const s=d=>{t=d.changedTouches[0].screenX},o=d=>{e=d.changedTouches[0].screenX,v()},v=()=>{e<t-150?te(1):e>t+150&&te(-1)},r=document.querySelector(".relative.overflow-hidden");return r&&(r.addEventListener("touchstart",s,!1),r.addEventListener("touchend",o,!1)),()=>{r&&(r.removeEventListener("touchstart",s),r.removeEventListener("touchend",o))}},I=J.debounce(async t=>{try{await N.post(route("inspections.save-result"),{inspection_id:i.inspection.id,point_id:t,status:l.results[t].status,note:l.results[t].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(e){console.error("Error menyimpan hasil:",e)}},500),he=({pointId:t,type:e,value:s})=>{l.results[t].hasOwnProperty(e)&&(l.results[t][e]=s),I(t)},se=async t=>{if(t&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await N.post(route("inspections.delete-result"),{inspection_id:i.inspection.id,point_id:t},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{l.results[t]&&delete l.results[t],_.value="Data berhasil dihapus!",setTimeout(()=>{_.value=""},2e3)}})}catch(e){console.error("Error menghapus hasil:",e)}L()}},ye=t=>{N.post(route("inspections.update-vehicle"),{inspection_id:y.id,...t},{preserveScroll:!0,onSuccess:()=>{console.log("Data kendaraan berhasil diupdate")}})},xe=t=>{Object.assign(l.conclusion,t),we()},we=J.debounce(()=>{N.post(route("inspections.save-conclusion"),{inspection_id:y.id,...l.conclusion},{preserveScroll:!0,onSuccess:()=>{console.log("Kesimpulan berhasil disimpan")}})},500),be=()=>{if(!ne.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}l.post(route("inspections.final-submit",{id:i.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:t=>{console.error("Kesalahan pengiriman:",t)}})};ie(p,t=>{const e=document.querySelector(`.flex-shrink-0[data-category-id="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const ne=j(()=>{const t=i.appMenu.every(s=>ee(s)),e=q();return t&&e});return ie(b,J.debounce(()=>{},300)),Ce(()=>{fe()}),(t,e)=>{var s,o,v,r,d,R,P,E,V;return u(),g("div",Te,[a("div",je,[a("div",ze,[a("button",{onClick:e[0]||(e[0]=n=>U("vehicle")),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":p.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="vehicle"}])}," Detail Kendaraan ",2),(u(!0),g(ae,null,le(z.appMenu,n=>(u(),g("button",{key:n.id,onClick:B=>U(n.id),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":p.value===n.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!==n.id}])},[re(w(n.name)+" ",1),ee(n)?(u(),g("span",Ne," ✓ ")):h("",!0)],10,Be))),128)),a("button",{onClick:e[1]||(e[1]=n=>U("conclusion")),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":p.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":p.value!=="conclusion"}])},[re(" Kesimpulan "+w(z.CarDetail)+" ",1),me.value.isComplete?(u(),g("span",$e," ✓ ")):h("",!0)],2)])]),H(ue,{name:"fade"},{default:X(()=>[_.value?(u(),g("div",Le,w(_.value),1)):h("",!0)]),_:1}),a("div",Fe,[H(ue,{name:"category-slide",mode:"out-in"},{default:X(()=>[p.value==="vehicle"?(u(),$(Me,{key:0,inspection:m(y),CarDetail:z.CarDetail,onUpdateVehicle:ye,onSaveCarDetails:t.saveNewCarDetails},null,8,["inspection","CarDetail","onSaveCarDetails"])):A.value&&p.value!=="conclusion"?(u(),$(Ae,{key:A.value.id,category:{...A.value,points:ce(A.value.points||[],A.value.input_type==="damage")},"inspection-id":m(y).id,form:m(l),onSaveResult:m(I),onUpdateResult:he,onHapusPoint:se,onRemoveImage:t.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):p.value==="conclusion"?(u(),$(Re,{key:2,form:m(l),"inspection-id":m(y).id,inspection:m(y),settings:m(y).settings||{},onUpdateConclusion:xe},null,8,["form","inspection-id","inspection","settings"])):h("",!0)]),_:1})]),p.value==="conclusion"?(u(),g("div",qe,[a("button",{type:"button",onClick:be,disabled:!ne.value||m(l).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[m(l).processing?(u(),g("svg",Ie,e[7]||(e[7]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):h("",!0),a("span",null,w(m(l).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Ue)])):h("",!0),!C.value&&!S.value?(u(),g("button",{key:1,onClick:e[2]||(e[2]=n=>C.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},e[8]||(e[8]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):h("",!0),H(Pe,{show:C.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:ge},{default:X(()=>[a("div",Ke,[a("div",He,[Se(a("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>b.value=n),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[De,b.value]]),e[9]||(e[9]=a("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[a("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),a("div",Oe,[Q.value.length===0?(u(),g("div",Xe," Tidak ada point yang ditemukan ")):h("",!0),(u(!0),g(ae,null,le(Q.value,n=>(u(),g("button",{key:n.id,onClick:B=>pe(n),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[a("div",We,w(n.name),1),a("div",Qe,w(n.description),1),a("div",Ge,w(Y(n)),1),G(n.id)?(u(),g("div",Ye," ✓ Sudah ada data ")):h("",!0)],8,Je))),128))])])]),_:1},8,["show"]),S.value?(u(),$(Ee,{key:(s=c.value)==null?void 0:s.id,show:S.value,title:((o=c.value)==null?void 0:o.name)||"Detail Point",subtitle:(v=c.value)==null?void 0:v.description,name:`point-${(r=c.value)==null?void 0:r.id}`,"inspection-id":m(y).id,"point-id":(d=c.value)==null?void 0:d.id,settings:((R=c.value)==null?void 0:R.settings)||{},options:((E=(P=c.value)==null?void 0:P.settings)==null?void 0:E.radios)||[],"selected-Point":c.value,"selected-value":D.value,"images-value":k.value,"notes-value":M.value,point:c.value,"existing-data":de((V=c.value)==null?void 0:V.id),"onUpdate:selectedValue":e[4]||(e[4]=n=>D.value=n),"onUpdate:notesValue":e[5]||(e[5]=n=>M.value=n),"onUpdate:imagesValue":e[6]||(e[6]=n=>k.value=n),onSave:ve,onClose:L,onHapus:se},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):h("",!0)])}}},it=Ve(Ze,[["__scopeId","data-v-2826c90d"]]);export{it as default};
