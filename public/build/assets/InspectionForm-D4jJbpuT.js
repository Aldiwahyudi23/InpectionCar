import{d as b,k as T,x as D,W as f,A as K,B as N,e as p,o as c,a as i,F as I,h as L,n as x,b as P,w as X,c as q,f as w,u as m,l as $,q as G,g as j,t as _,T as H}from"./app-CpVICqcR.js";import{l as A}from"./lodash-BMR6rUjK.js";import{C as W}from"./CategorySection-By8Jcv_0.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"container mx-auto px-4 py-2"},Y={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Z={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},ee=["onClick","data-category-id"],te={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ae={class:"relative overflow-hidden"},se={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},ne={class:"mb-4"},oe={class:"mt-6"},re={class:"list-disc pl-5"},ie={key:0},le={key:1},ue={class:"flex justify-end gap-4 mt-8"},ce=["disabled"],de={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},pe={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object},setup(y){var C;const s=y,l=b(((C=s.appMenu[0])==null?void 0:C.id)||"summary"),h=b(0);b(null);const v=T(()=>l.value!=="summary"?s.appMenu.find(a=>a.id===l.value):null),r=D((()=>{const a={};return s.appMenu.forEach(t=>{(t.points||[]).forEach(e=>{var o,u;if(e.input_type!=="damage"){const n=Array.isArray(s.existingResults)?s.existingResults.find(d=>d.point_id===e.id):null;a[e.id]={status:(n==null?void 0:n.status)||"",note:(n==null?void 0:n.note)||"",images:((u=(o=s.existingImages)==null?void 0:o[e.id])==null?void 0:u.map(d=>({image_path:d.image_path,preview:null})))||[]}}})}),{inspection_id:s.inspection.id,results:a,overall_note:s.inspection.overall_note||""}})()),k=A.debounce(()=>{f.post(route("inspections.save-overall-note"),{inspection_id:s.inspection.id,overall_note:r.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:a=>{console.error("Error menyimpan catatan keseluruhan:",a)}})},800),g=a=>a.points.every(t=>{var o;if(t.input_type==="damage")return!0;const e=r.results[t.id];if(!e)return!1;switch(t.input_type){case"text":case"number":case"date":case"account":return!!e.note;case"select":case"radio":return!!e.status;case"image":return((o=e.images)==null?void 0:o.length)>0;default:return!!e.status||!!e.note}}),S=a=>{if(a==="summary")h.value=s.appMenu.length;else{const t=s.appMenu.findIndex(e=>e.id===a);t>=0&&(h.value=t)}l.value=a},E=a=>{let t=h.value+a;const e=s.appMenu.length;t>=0&&t<=e&&(h.value=t,t===e?l.value="summary":l.value=s.appMenu[t].id)},B=()=>{let a=0,t=0;const e=d=>{a=d.changedTouches[0].screenX},o=d=>{t=d.changedTouches[0].screenX,u()},u=()=>{t<a-100?E(1):t>a+100&&E(-1)},n=document.querySelector(".relative.overflow-hidden");return n&&(n.addEventListener("touchstart",e,!1),n.addEventListener("touchend",o,!1)),()=>{n&&(n.removeEventListener("touchstart",e),n.removeEventListener("touchend",o))}},M=A.debounce(async a=>{try{await f.post(route("inspections.save-result"),{inspection_id:s.inspection.id,point_id:a,status:r.results[a].status,note:r.results[a].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(t){console.error("Error menyimpan hasil:",t)}},500),F=({pointId:a,type:t,value:e})=>{r.results[a].hasOwnProperty(t)&&(r.results[a][t]=e),M(a)},U=async(a,t)=>{const e=a.target.files[0];if(!e)return;const o=URL.createObjectURL(e);try{const u=new FormData;u.append("inspection_id",s.inspection.id),u.append("point_id",t),u.append("image",e),await f.post(route("inspections.upload-image"),u,{preserveScroll:!0,onSuccess:n=>{var R;const d=((R=n.props.flash)==null?void 0:R.imagePath)||n.props.imagePath;d?r.results[t].images.push({image_path:d,preview:o}):console.error("Path gambar tidak dikembalikan dari unggahan")},onError:n=>{console.error("Error mengunggah gambar:",n),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(u){console.error("Error mengunggah gambar:",u),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{a.target.value=""}},V=async(a,t)=>{const e=r.results[a].images[t];if(e)try{await f.delete(route("inspections.delete-image"),{data:{image_path:e.image_path,point_id:a,inspection_id:s.inspection.id},preserveScroll:!0,onSuccess:()=>{r.results[a].images.splice(t,1),e.preview&&URL.revokeObjectURL(e.preview)},onError:o=>{console.error("Error menghapus gambar:",o),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(o){console.error("Error menghapus gambar:",o),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},z=()=>{r.post(route("inspections.final-submit",{inspection:s.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:a=>{console.error("Kesalahan pengiriman:",a)}})};K(()=>{B()}),N(l,a=>{const t=document.querySelector(`.flex-shrink-0[data-category-id="${a}"]`);t&&t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const O=T(()=>s.appMenu.every(a=>g(a)));return(a,t)=>(c(),p("div",Q,[i("div",Y,[i("div",Z,[(c(!0),p(I,null,L(y.appMenu,e=>(c(),p("button",{key:e.id,onClick:o=>S(e.id),class:x(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":l.value===e.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":l.value!==e.id}]),"data-category-id":e.id},[j(_(e.name)+" ",1),g(e)?(c(),p("span",te," ✓ ")):w("",!0)],10,ee))),128)),i("button",{onClick:t[0]||(t[0]=e=>S("summary")),class:x(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":l.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":l.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),i("div",ae,[P(H,{name:"category-slide",mode:"out-in"},{default:X(()=>[v.value&&l.value!=="summary"?(c(),q(W,{key:v.value.id,category:v.value,form:m(r),onSaveResult:m(M),onUpdateResult:F,onRemoveImage:V,onHandleImageUpload:t[1]||(t[1]=(e,o)=>U(e,o,v.value.name))},null,8,["category","form","onSaveResult"])):l.value==="summary"?(c(),p("div",se,[t[7]||(t[7]=i("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),i("div",ne,[t[4]||(t[4]=i("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),$(i("textarea",{id:"overall_note","onUpdate:modelValue":t[2]||(t[2]=e=>m(r).overall_note=e),onInput:t[3]||(t[3]=(...e)=>m(k)&&m(k)(...e)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[G,m(r).overall_note]])]),i("div",oe,[t[5]||(t[5]=i("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Menu:",-1)),i("ul",re,[(c(!0),p(I,null,L(y.appMenu,e=>(c(),p("li",{key:e.id,class:x({"text-green-600":g(e),"text-red-600":!g(e)})},[j(_(e.name)+" ",1),g(e)?(c(),p("span",ie,"(Selesai ✓)")):(c(),p("span",le,"(Belum Selesai ✗)"))],2))),128))])]),i("div",ue,[i("button",{type:"button",onClick:z,disabled:!O.value||m(r).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[m(r).processing?(c(),p("svg",de,t[6]||(t[6]=[i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):w("",!0),i("span",null,_(m(r).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ce)])])):w("",!0)]),_:1})])]))}},ye=J(pe,[["__scopeId","data-v-4290d795"]]);export{ye as default};
