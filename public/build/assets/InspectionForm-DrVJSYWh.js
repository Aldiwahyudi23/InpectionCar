import{x as Ue,d as M,m as xe,z as ee,e as i,o,a as e,f as b,b as re,p as ce,v as we,u as G,F as se,h as ae,t as q,g as ie,w as me,l as Z,n as ne,B as je,C as ye,k as Pe,D as _e,E as De,c as Y,r as Me,T as Ie,G as $e,W as Ve,H as qe}from"./app-_R21N0S2.js";import{l as be}from"./lodash-6aZbXDMZ.js";import{_ as Be}from"./PrimaryButton-Bugsu4uD.js";import{_ as Te}from"./ActionMessage-C_igAytT.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ae}from"./InputNumber-CJGiarJJ.js";const Fe={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Le={key:0,class:"p-4 space-y-4"},Ee={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},He={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},ze={class:"relative"},Oe={key:0,class:"absolute right-3 top-3"},We={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ke={key:0},Xe=["onMousedown"],Ge={class:"font-medium text-gray-900"},Je={class:"text-sm text-gray-500"},Ze={key:1,class:"p-4 text-sm text-gray-500 text-center"},Qe={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ye={key:0,class:"mb-4"},et={class:"text-gray-600 text-sm"},tt={key:1},st={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},at=["src","alt"],ot={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},nt={class:"text-white text-xs text-center"},it={key:2,class:"text-center py-4 text-gray-500 text-sm"},lt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},rt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(t,{emit:_}){var R,A,B,k;const a=t,x=_,l=Ue({plate_number:((R=a.inspection)==null?void 0:R.plate_number)||"",car_id:((A=a.inspection)==null?void 0:A.car_id)||null,car_name:((k=(B=a.inspection)==null?void 0:B.car)==null?void 0:k.name)||""}),r=M(l.car_name),f=M(!1),p=M(!1),d=M([]),y=M(null),V=M([]);xe(()=>{var g,m,N,J;if((g=a.inspection)!=null&&g.car_id&&((m=a.CarDetail)==null?void 0:m.length)>0){const L=a.CarDetail.find(W=>W.id===a.inspection.car_id);L&&U(L)}else!((N=a.inspection)!=null&&N.car_id)&&((J=a.inspection)!=null&&J.car_name)&&(r.value=a.inspection.car_name)}),ee(r,g=>{l.car_id&&s(y.value)!==g&&(l.car_id=null,y.value=null,V.value=[]),l.car_name=g});const s=g=>{var N,J,L;if(!g)return"";const m=[];return(N=g.brand)!=null&&N.name&&m.push(g.brand.name),(J=g.model)!=null&&J.name&&m.push(g.model.name),(L=g.type)!=null&&L.name&&m.push(g.type.name),g.cc&&m.push(`${g.cc}cc`),g.transmission&&m.push(g.transmission),g.fuel_type&&m.push(g.fuel_type),g.year&&m.push(g.year.toString()),g.production_period&&m.push(`(${g.production_period})`),m.join(" ")},$=be.debounce(()=>{if(!r.value.trim()){d.value=[],f.value=!1;return}p.value=!0;try{const g=r.value.toLowerCase().trim();d.value=a.CarDetail.filter(m=>s(m).toLowerCase().includes(g)),f.value=!0}finally{p.value=!1}},300),w=()=>{setTimeout(()=>{f.value=!1},200)},U=async g=>{y.value=g,r.value=s(g),l.car_id=g.id,l.car_name=s(g),f.value=!1,await C(g.id),E()},C=async g=>{try{const m=await fetch(`/api/cars/${g}/images`);m.ok?V.value=await m.json():V.value=[]}catch{V.value=[]}},E=()=>{const g={plate_number:l.plate_number,car_id:l.car_id,car_name:l.car_name};x("update-vehicle",g)},F=()=>{a.inspection&&l.post(route("inspections.updateVehicleDetails",{inspection:a.inspection.id}),{preserveScroll:!0})};return ee(()=>a.inspection,g=>{var m;if(g)if(l.plate_number=g.plate_number||"",l.car_id=g.car_id||null,g.car_id&&((m=a.CarDetail)==null?void 0:m.length)>0){const N=a.CarDetail.find(J=>J.id===g.car_id);N&&U(N)}else g.car_name&&(r.value=g.car_name,l.car_name=g.car_name)},{deep:!0}),(g,m)=>(o(),i("div",Fe,[m[13]||(m[13]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(o(),i("div",Le,[e("div",Ee,[m[5]||(m[5]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nomor Plat Kendaraan ",-1)),ce(e("input",{"onUpdate:modelValue":m[0]||(m[0]=N=>G(l).plate_number=N),type:"text",placeholder:"Contoh: B 1234 ABC",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:E},null,544),[[we,G(l).plate_number]])]),e("div",He,[m[8]||(m[8]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",ze,[ce(e("input",{"onUpdate:modelValue":m[1]||(m[1]=N=>r.value=N),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:m[2]||(m[2]=(...N)=>G($)&&G($)(...N)),onFocus:m[3]||(m[3]=N=>f.value=!0),onBlur:w},null,544),[[we,r.value]]),p.value?(o(),i("div",Oe,m[6]||(m[6]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):b("",!0),f.value?(o(),i("div",We,[d.value.length>0?(o(),i("div",Ke,[(o(!0),i(se,null,ae(d.value,N=>(o(),i("div",{key:N.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:J=>U(N)},[e("div",Ge,q(s(N)),1),e("div",Je,q(N.year)+" • "+q(N.cc)+"cc • "+q(N.transmission)+" • "+q(N.fuel_type),1)],40,Xe))),128))])):(o(),i("div",Ze,m[7]||(m[7]=[ie(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),ie(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):b("",!0)]),ce(e("input",{type:"hidden","onUpdate:modelValue":m[4]||(m[4]=N=>G(l).car_id=N)},null,512),[[we,G(l).car_id]])]),G(l).car_id&&y.value?(o(),i("div",Qe,[y.value.description?(o(),i("div",Ye,[m[9]||(m[9]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("p",et,q(y.value.description),1)])):b("",!0),V.value.length>0?(o(),i("div",tt,[m[10]||(m[10]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",st,[(o(!0),i(se,null,ae(V.value,N=>(o(),i("div",{key:N.id,class:"relative group"},[e("img",{src:N.file_path,alt:N.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200"},null,8,at),N.note?(o(),i("div",ot,[e("p",nt,q(N.note),1)])):b("",!0)]))),128))])])):(o(),i("div",it," Tidak ada gambar tersedia untuk mobil ini "))])):b("",!0),re(Be,{type:"button",onClick:F,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},{default:me(()=>[G(l).processing?(o(),i("svg",lt,m[11]||(m[11]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):b("",!0),e("span",null,q(G(l).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),re(Te,{on:G(l).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:me(()=>m[12]||(m[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ie(" Tersimpan. ")])),_:1,__:[12]},8,["on"])]),_:1})])):b("",!0)]))}},ut=ge(rt,[["__scopeId","data-v-7573ffe7"]]),dt={class:"mt-1"},ct=["value","required","minlength","maxlength","pattern","placeholder"],mt={key:0,class:"mt-2 text-sm text-red-600"},gt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:_}){const a=t,x=_,l=r=>{x("update:modelValue",r.target.value),x("save",a.pointId)};return(r,f)=>(o(),i("div",dt,[e("input",{value:t.modelValue,onInput:l,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,pattern:t.pattern,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ct),t.error?(o(),i("p",mt,q(t.error),1)):b("",!0)]))}},vt={class:"mt-1"},pt=["value","required","min","max"],ht={key:0,class:"mt-2 text-sm text-red-600"},ft={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:_}){const a=t,x=_,l=r=>{x("update:modelValue",r.target.value),x("save",a.pointId)};return(r,f)=>(o(),i("div",vt,[e("input",{value:t.modelValue,onChange:l,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,pt),t.error?(o(),i("p",ht,q(t.error),1)):b("",!0)]))}},wt={class:"mt-1"},yt=["value","required","placeholder"],bt={key:0,class:"mt-2 text-sm text-red-600"},xt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:_}){const a=t,x=_,l=M(""),r=M(!1),f=Z(()=>{var w,U,C,E;return{currency_symbol:((w=a.settings)==null?void 0:w.currency_symbol)||"Rp",thousands_separator:((U=a.settings)==null?void 0:U.thousands_separator)||",",min_value:((C=a.settings)==null?void 0:C.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((E=a.settings)==null?void 0:E.max_value)!==void 0?Number(a.settings.max_value):1e9}}),p=w=>{if(w==null||w==="")return"";const U=Number(w);if(isNaN(U))return"";let C=U.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return f.value.thousands_separator!==","&&(C=C.replace(/,/g,f.value.thousands_separator)),C},d=w=>w?w.replace(/[^\d]/g,""):"",y=Z(()=>{if(r.value)return l.value;const w=p(a.modelValue);return w?`${f.value.currency_symbol} ${w}`:""}),V=w=>{const U=w.target.value;l.value=U;const C=d(U);x("update:modelValue",C),x("save",a.pointId)},s=()=>{var w;r.value=!0,l.value=((w=a.modelValue)==null?void 0:w.toString())||""},$=()=>{r.value=!1;const w=d(l.value);if(w){const U=Number(w);let C=w;f.value.min_value!==void 0&&U<f.value.min_value&&(C=f.value.min_value.toString()),f.value.max_value!==void 0&&U>f.value.max_value&&(C=f.value.max_value.toString()),C!==w&&(x("update:modelValue",C),x("save",a.pointId))}};return ee(()=>a.modelValue,w=>{!r.value&&w!==void 0&&w!==null&&(l.value=w.toString())},{immediate:!0}),(w,U)=>(o(),i("div",wt,[e("input",{value:y.value,onInput:V,onBlur:$,onFocus:s,type:"text",required:t.required,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,yt),t.error?(o(),i("p",bt,q(t.error),1)):b("",!0)]))}},kt={class:"mt-1 space-y-3"},$t={key:0,class:"space-y-2"},It={class:"flex flex-wrap gap-2"},Vt=["onClick"],Ct=["value","required","minlength","maxlength","placeholder"],St={class:"flex justify-between items-center mt-1"},_t={class:"text-xs text-gray-500"},Mt={key:0,class:"text-xs text-red-600"},Ne={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:_}){const a=t,x=_,l=M([]),r=M(""),f=V=>l.value.some(s=>s.value===V),p=V=>{f(V.value)?l.value=l.value.filter(U=>U.value!==V.value):l.value.push(V);const $=[...l.value.map(U=>U.value)];r.value.trim()&&$.push(r.value.trim());const w=$.join(", ");x("update:modelValue",w),x("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:w})},d=V=>{const s=V.target.value;x("update:modelValue",s),x("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:s}),y(s)},y=V=>{var U,C,E,F;if(!V){l.value=[],r.value="";return}const s=V.split(",").map(R=>R.trim()).filter(R=>R),$=((C=(U=a.settings)==null?void 0:U.damage_options)==null?void 0:C.map(R=>R.value))||[];l.value=((F=(E=a.settings)==null?void 0:E.damage_options)==null?void 0:F.filter(R=>s.includes(R.value)))||[];const w=s.filter(R=>!$.includes(R));r.value=w.join(", ")};return ee(()=>a.modelValue,V=>{V!=null&&y(V)},{immediate:!0}),(V,s)=>{var $,w,U;return o(),i("div",kt,[($=t.settings)!=null&&$.enable_damage&&((w=t.settings)!=null&&w.damage_options)?(o(),i("div",$t,[s[0]||(s[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",It,[(o(!0),i(se,null,ae(t.settings.damage_options,(C,E)=>(o(),i("button",{key:E,type:"button",onClick:F=>p(C),class:ne(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":f(C.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!f(C.value)}])},q(C.label),11,Vt))),128))])])):b("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:d,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Ct),e("div",St,[e("span",_t,q(((U=t.modelValue)==null?void 0:U.length)||0)+"/"+q(t.maxLength||400),1),t.error?(o(),i("p",Mt,q(t.error),1)):b("",!0)])])])}}},Ut={class:"mt-1"},Nt=["value","required"],Rt={key:0,class:"mt-2 text-sm text-red-600"},jt={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:_}){const a=t,x=_,l=r=>{x("update:modelValue",r.target.value),x("save",a.pointId)};return(r,f)=>(o(),i("div",Ut,[e("select",{value:t.modelValue,onChange:l,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},f[0]||(f[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Nt),t.error?(o(),i("p",Rt,q(t.error),1)):b("",!0)]))}},Pt=ge(jt,[["__scopeId","data-v-c34a74db"]]),Dt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},qt={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Bt={class:"flex flex-row space-x-4 mb-6"},Tt={class:"mt-4 text-right"},At={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(_,a)=>t.show?(o(),i("div",Dt,[e("div",qt,[a[5]||(a[5]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),e("div",Bt,[e("button",{onClick:a[0]||(a[0]=x=>_.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[3]||(a[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:a[1]||(a[1]=x=>_.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[4]||(a[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",Tt,[e("button",{onClick:a[2]||(a[2]=x=>_.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):b("",!0)}},Ft={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Lt={class:"webcam-content-box"},Et={class:"webcam-header"},Ht={class:"inspection-point-name"},zt={key:0,class:"screen-flash-overlay"},Ot={key:2,class:"focus-status"},Wt={class:"webcam-footer"},Kt={class:"camera-controls"},Xt=["disabled"],Gt={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,inspectionPoint:String,point:Object,pointname:String},emits:["close","photoCaptured"],setup(t,{emit:_}){const a=t,x=_,l=M(null),r=M(null);let f=null,p=null;const d=M("environment"),y=M(!1),V=M(!1),s=M(!1),$=M(!1),w=M(a.inspectionPoint||"Camera"),U=M(!1),C=M({}),E=M(""),F=M("continuous"),R=M("high"),A=Z(()=>{switch(R.value){case"high":return{width:1920,height:1080};case"medium":return{width:1280,height:720};case"low":return{width:640,height:480};default:return{width:1920,height:1080}}}),B=Z(()=>a.aspectRatio?{aspectRatio:`${a.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),k=Z(()=>{if(!a.aspectRatio)return{};const S=a.aspectRatio,n=S>1?80:60,I=S>1?80/S:60*S;return{width:`${n}%`,height:`${I}%`}}),g=Z(()=>{var S;return((S=a.settings)==null?void 0:S.max_size)||2048}),m=async()=>{f&&f.getTracks().forEach(S=>S.stop()),s.value=!1,U.value=!1,E.value="";try{const S={facingMode:d.value,width:{ideal:A.value.width},height:{ideal:A.value.height},aspectRatio:{ideal:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30}};R.value==="high"&&(S.width={ideal:1920,max:3840},S.height={ideal:1080,max:2160},S.frameRate={ideal:30,max:60}),F.value!=="manual"&&(S.advanced=[{focusMode:F.value}]),d.value==="environment"&&(S.advanced||(S.advanced=[]),S.advanced.push({focusMode:F.value})),f=await navigator.mediaDevices.getUserMedia({video:S,audio:!1}),p=f.getVideoTracks()[0],l.value.srcObject=f,l.value.onloadedmetadata=async()=>{await J(),(F.value==="continuous"||F.value==="single-shot")&&await L()}}catch(S){console.error("Error accessing camera: ",S),alert("Failed to access camera. Please allow camera permission."),x("close")}},N=()=>{f&&f.getTracks().forEach(S=>S.stop()),x("close")},J=async()=>{if(p)try{const S=await navigator.mediaDevices.enumerateDevices();y.value=S.filter(h=>h.kind==="videoinput").length>1;const n=p.getCapabilities();V.value=n.torch||n.fillLightMode&&n.fillLightMode.includes("torch");const I=n.focusDistance||{};console.log("Camera capabilities:",n)}catch(S){console.error("Error checking camera capabilities:",S)}},L=async()=>{if(p)try{const S=p.getCapabilities();S.focusMode&&S.focusMode.includes("continuous")&&(await p.applyConstraints({advanced:[{focusMode:"continuous"}]}),E.value="Auto Focus Enabled",setTimeout(()=>{E.value=""},2e3))}catch(S){console.warn("Auto focus not supported:",S)}},W=async()=>{if(!(!p||!a.settings.enable_flash)){if(d.value==="user"){s.value=!s.value,$.value=s.value;return}try{p.getCapabilities().torch&&(await p.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value)}catch(S){console.error("Flash toggle failed:",S)}}},te=async()=>{y.value&&(d.value=d.value==="environment"?"user":"environment",w.value=`${a.inspectionPoint||"Camera"} (${d.value==="environment"?"Rear":"Front"})`,await m())},le=async()=>{if(!p)return;const S=p.getCapabilities();if(S.focusMode&&S.focusMode.includes("continuous"))try{await p.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(n){console.warn("Focus not supported",n)}},de=async S=>new Promise(n=>{const I=g.value*1024;if(S.size<=I){n(S);return}const h=new Image,D=new FileReader;D.onload=u=>{h.onload=()=>{const H=document.createElement("canvas"),P=H.getContext("2d"),O=Math.sqrt(I/S.size);H.width=h.width*O,H.height=h.height*O,P.drawImage(h,0,0,H.width,H.height);let v=.9;const c=()=>{H.toBlob(j=>{j.size>I&&v>.1?(v-=.1,c()):n(j)},"image/png",v)};c()},h.src=u.target.result},D.readAsDataURL(S)}),ue=async()=>{const S=l.value,n=r.value;if(!(!S||!n||S.readyState!==4))try{const I=n.getContext("2d"),h=S.videoWidth,D=S.videoHeight;let u,H,P,O;h/D>a.aspectRatio?(H=D,u=D*a.aspectRatio,P=(h-u)/2,O=0):(u=h,H=h/a.aspectRatio,P=0,O=(D-H)/2),n.width=u,n.height=H,I.drawImage(S,P,O,u,H,0,0,u,H);const v=await new Promise(j=>{n.toBlob(j,"image/png",1)}),c=await de(v);if(c){const j=new File([c],`capture_${Date.now()}.png`,{type:"image/png",lastModified:Date.now()});x("photoCaptured",j),$.value=!0,setTimeout(()=>{$.value=!1},100)}}catch(I){console.error("Error capturing photo:",I),alert("Failed to capture photo. Please try again.")}};return ee(()=>a.show,S=>{S?m():N()}),ee(()=>a.inspectionPoint,S=>{w.value=S||"Camera"}),ee(()=>a.aspectRatio,()=>{a.show&&m()}),je(()=>{f&&f.getTracks().forEach(S=>S.stop())}),(S,n)=>{var I;return t.show?(o(),i("div",Ft,[e("div",Lt,[e("div",Et,[e("div",Ht,q(((I=t.point)==null?void 0:I.name)||"Camera"),1),e("button",{onClick:N,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},n[0]||(n[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:ye(B.value),onClick:le},[e("video",{ref_key:"webcamVideo",ref:l,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:r,class:"hidden"},null,512),$.value?(o(),i("div",zt)):b("",!0),e("div",{class:"aspect-ratio-guide",style:ye(k.value)},null,4),U.value?(o(),i("div",{key:1,class:"focus-indicator",style:ye(C.value)},n[1]||(n[1]=[e("div",{class:"focus-ring"},null,-1)]),4)):b("",!0),n[2]||(n[2]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),E.value?(o(),i("div",Ot,q(E.value),1)):b("",!0)],4),e("div",Wt,[e("div",Kt,[t.settings.enable_flash?(o(),i("button",{key:0,onClick:W,disabled:!V.value,class:ne(["control-button",{active:s.value,disabled:!V.value}])},n[3]||(n[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),10,Xt)):b("",!0),e("button",{onClick:ue,class:"capture-button"},n[4]||(n[4]=[e("div",{class:"camera-icon-container"},[e("div",{class:"camera-body"},[e("div",{class:"camera-lens"}),e("div",{class:"camera-flash"})])],-1)])),t.settings.enable_camera_switch&&y.value?(o(),i("button",{key:1,onClick:te,class:"control-button"},n[5]||(n[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):b("",!0)])])])])):b("",!0)}}},Jt=ge(Gt,[["__scopeId","data-v-73221082"]]),Zt={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Qt={class:"w-full h-full flex flex-col"},Yt={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},es={class:"text-lg font-semibold"},ts={class:"flex items-center gap-2"},ss={class:"flex-1 flex items-center justify-center overflow-hidden relative"},as=["src"],os={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},ns={class:"flex justify-between items-center w-full"},is=["disabled"],ls={key:1,class:"flex-1"},rs=["disabled"],us={class:"flex gap-3 w-full"},ds=["disabled"],cs={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},ms={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos"],setup(t,{emit:_}){const a=t,x=_,l=M(0),r=M([]),f=M(0),p=M(0),d=Z(()=>r.value.length>0?r.value[l.value]:null);ee(()=>a.images,B=>{r.value=B.map(k=>({...k})),a.show&&B.length>0?l.value=B.length-1:l.value=0,B.length===0&&a.show&&F()},{deep:!0,immediate:!0}),ee(()=>a.show,B=>{B&&a.images.length>0&&(l.value=a.images.length-1)});const y=B=>B.preview||(B.image_path?`/${B.image_path}`:""),V=()=>{d.value&&(d.value.rotation=(d.value.rotation+90)%360)},s=()=>{l.value=l.value<r.value.length-1?l.value+1:0},$=()=>{l.value=l.value>0?l.value-1:r.value.length-1},w=B=>{f.value=B.touches[0].clientX},U=B=>{p.value=B.touches[0].clientX},C=()=>{f.value-p.value>50?s():p.value-f.value>50&&$(),f.value=0,p.value=0},E=()=>{a.isUploading||x("saveImages",r.value)},F=()=>{a.isUploading||x("close")},R=()=>{if(d.value&&!a.isUploading){const B=d.value;x("removePreviewImage",B);const k=r.value.findIndex(g=>g.isNew&&B.isNew&&g.preview===B.preview||!g.isNew&&!B.isNew&&g.id===B.id);k!==-1&&r.value.splice(k,1),l.value>=r.value.length&&(l.value=Math.max(0,r.value.length-1)),r.value.length===0&&x("close")}},A=()=>{a.isUploading||x("triggerAddMorePhotos")};return(B,k)=>{var g;return t.show?(o(),i("div",Zt,[e("div",Qt,[e("div",Yt,[e("button",{onClick:F,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},k[0]||(k[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",es,q(((g=t.point)==null?void 0:g.name)||"Preview")+" ("+q(l.value+1)+"/"+q(r.value.length)+") ",1),e("div",ts,[d.value&&d.value.isNew?(o(),i("button",{key:0,onClick:R,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},k[1]||(k[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):b("",!0),e("button",{onClick:V,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},k[2]||(k[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))])]),e("div",ss,[e("div",{class:"relative w-full max-w-full",style:ye({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"}),onTouchstart:w,onTouchmove:U,onTouchend:C},[d.value?(o(),i("img",{key:0,src:y(d.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ye({transform:`rotate(${d.value.rotation}deg)`})},null,12,as)):b("",!0)],36),r.value.length>1?(o(),i("button",{key:0,onClick:$,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},k[3]||(k[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):b("",!0),r.value.length>1?(o(),i("button",{key:1,onClick:s,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},k[4]||(k[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):b("",!0)]),e("div",os,[e("div",ns,[d.value&&!d.value.isNew?(o(),i("button",{key:0,onClick:R,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},k[5]||(k[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ie(" Hapus Foto ")]),8,is)):(o(),i("div",ls)),t.allowMultiple&&r.value.length<t.maxFiles?(o(),i("button",{key:2,onClick:A,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},k[6]||(k[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ie(" Tambah Foto ")]),8,rs)):b("",!0)]),e("div",us,[e("button",{onClick:F,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:t.isUploading}," Batal ",8,ds),t.isUploading?(o(),i("button",cs,k[7]||(k[7]=[ie(" Menyimpan"),e("span",{class:"loading-dots ml-1"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1)]))):(o(),i("button",{key:0,onClick:E,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):b("",!0)}}},gs=ge(ms,[["__scopeId","data-v-c3d47220"]]),vs=["accept","multiple","disabled"],ps=["disabled"],hs={class:"h-full flex flex-col items-center justify-center p-4 text-center"},fs={class:"text-xs text-gray-400 mt-1"},ws={key:0,class:"flex items-center gap-4"},ys=["src"],bs=["disabled"],xs={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ks=["disabled"],$s=["onClick"],Is=["src"],Vs={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Cs={key:0},Ss={key:1,class:"ml-1"},_s={key:2,class:"mt-1 text-xs text-red-600"},Ms={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(t,{emit:_}){const a=t,x=_,l=M(null),r=M(null),f=M(!1),p=M(!1),d=M(!1),y=M([]),V=M(0),s=M(!1),$=Z(()=>Number(a.settings.max_files)>1),w=Z(()=>a.settings.allowed_types.map(n=>`.${n}`).join(", ")),U=Z(()=>{const n=a.settings.camera_aspect_ratio.split(":");if(n.length===2){const I=parseFloat(n[0]),h=parseFloat(n[1]);if(!isNaN(I)&&!isNaN(h)&&h!==0)return I/h}return 4/3});ee(()=>a.modelValue,n=>{if(!n||n.length===0)y.value=[];else{const I=n.filter(D=>!D.isNew),h=y.value.filter(D=>D.isNew);y.value=[...h,...I]}},{immediate:!0,deep:!0});const C=Z(()=>{const n=[],I=new Set;for(const h of y.value)h.id&&I.add(h.id),n.push(h);for(const h of a.modelValue)h.inspection_id&&String(h.inspection_id)==String(a.inspectionId)||I.has(h.id)||n.push({...h,rotation:h.rotation||0,isNew:!1,preview:h.preview||(h.image_path?`/${h.image_path}`:null)});return n}),E=n=>n.preview||(n.image_path?`/${n.image_path}`:""),F=()=>{d.value&&(d.value=!1),f.value=!0},R=()=>{f.value=!1,l.value.click()},A=()=>{f.value=!1,p.value=!0},B=()=>{f.value=!1,C.value.length>0&&(d.value=!0)},k=()=>{p.value=!1,C.value.length>0&&(d.value=!0)},g=()=>{d.value=!1,y.value.forEach(n=>{n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview)}),y.value=[]},m=n=>new Promise(I=>{const h=new FileReader;h.onload=D=>{const u=new Image;u.onload=()=>{I({file:n,preview:URL.createObjectURL(n),rotation:0,width:u.naturalWidth,height:u.naturalHeight,isNew:!0})},u.onerror=()=>{console.error("Failed to load image for dimensions:",n.name),I({file:n,preview:URL.createObjectURL(n),rotation:0,width:0,height:0,isNew:!0})},u.src=D.target.result},h.readAsDataURL(n)}),N=n=>{const I=n.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes(I)},J=async n=>{const h=(a.settings.max_size||2048)*1024;return new Promise(D=>{const u=new Image,H=new FileReader;H.onload=P=>{u.onload=()=>{const O=document.createElement("canvas"),v=O.getContext("2d"),c=Math.max(u.width,u.height);O.width=c,O.height=c,v.fillStyle="white",v.fillRect(0,0,c,c);const j=(c-u.width)/2,T=(c-u.height)/2;v.drawImage(u,j,T,u.width,u.height);let K=.9;const X=()=>{O.toBlob(Q=>{if(Q.size>h&&K>.1)K-=.1,X();else{const oe=new File([Q],n.name,{type:"image/jpeg",lastModified:Date.now()});D(oe)}},"image/jpeg",K)};X()},u.src=P.target.result},H.readAsDataURL(n)})},L=async n=>{const I=Array.from(n.target.files);if(!I.length){f.value=!1,C.value.length>0&&(d.value=!0);return}try{const h=I.filter(v=>!N(v));if(h.length>0){const v=h.map(c=>c.name.split(".").pop()).join(", ");alert(`File type not allowed: ${v}. Allowed types: ${a.settings.allowed_types.join(", ")}`),n.target.value="";return}const D=C.value.length,u=a.settings.max_files-D,H=await Promise.all(I.slice(0,u).map(async v=>await J(v))),P=await Promise.all(H.map(m)),O=$.value?P:P.slice(0,1);$.value?y.value.push(...O):(y.value.forEach(v=>{v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}),y.value=O),f.value=!1,O.length>0?(V.value=Math.max(0,C.value.length-O.length),d.value=!0):C.value.length>0&&(d.value=!0),n.target.value=""}catch(h){console.error("Error processing selected images:",h),alert("Failed to process selected images. Please try again."),f.value=!1,C.value.length>0&&(d.value=!0)}},W=async n=>{const I=C.value.length;if(!$.value||I<a.settings.max_files)try{const h=await J(n),D=new Image;D.onload=()=>{const u={file:h,preview:URL.createObjectURL(h),rotation:0,width:D.naturalWidth,height:D.naturalHeight,isNew:!0};$.value?y.value.push(u):(y.value.forEach(H=>{H.preview&&H.preview.startsWith("blob:")&&URL.revokeObjectURL(H.preview)}),y.value=[u]),p.value=!1,f.value=!1,V.value=C.value.length-1,d.value=!0},D.src=URL.createObjectURL(h)}catch(h){console.error("Error processing captured image:",h),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),p.value=!1,f.value=!1,C.value.length>0&&(d.value=!0)},te=(n=0)=>{V.value=n,d.value=!0},le=n=>new Promise(I=>{if(n.rotation===0||!r.value){if(!n.isNew&&!n.file){I({file:null,width:n.width,height:n.height,isOriginal:!0});return}I({file:n.file,width:n.width,height:n.height});return}const h=new Image;h.onload=async()=>{try{const D=r.value,u=D.getContext("2d"),H=h.width,P=h.height;let O,v;n.rotation===90||n.rotation===270?(O=P,v=H):(O=H,v=P),D.width=O,D.height=v,u.clearRect(0,0,D.width,D.height),u.translate(D.width/2,D.height/2),u.rotate(n.rotation*Math.PI/180),u.drawImage(h,-H/2,-P/2,H,P),u.setTransform(1,0,0,1,0,0);const c=await new Promise(K=>{D.toBlob(K,"image/jpeg",.9)}),j=new File([c],n.file?n.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),T=await J(j);I({file:T,width:O,height:v})}catch(D){console.error("Error processing rotated image:",D),I({file:n.file,width:n.width,height:n.height})}},h.onerror=()=>{console.error("Failed to load image for rotation processing:",n.preview),I({file:n.file,width:n.width,height:n.height})},h.src=n.preview}),de=async n=>{var h,D,u,H;s.value=!0;const I=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),s.value=!1;return}try{for(const P of n){if(!P.isNew&&P.rotation===0&&P.id&&P.image_path){I.push({id:P.id,image_path:P.image_path,width:P.width,height:P.height,rotation:0,preview:P.preview});continue}const{file:O,width:v,height:c,isOriginal:j}=await le(P);if(j&&!P.isNew){I.push({id:P.id,image_path:P.image_path,width:P.width,height:P.height,rotation:0,preview:P.preview});continue}const T=new FormData;T.append("inspection_id",a.inspectionId),T.append("point_id",a.pointId),T.append("image",O),T.append("width",v),T.append("height",c),T.append("rotation",0),P.id&&!P.isNew&&T.append("image_id",P.id);const X=(await _e.post(route("inspections.upload-image"),T,{headers:{"Content-Type":"multipart/form-data"}})).data.image;I.push({id:X.id,image_path:X.image_path,width:X.width,height:X.height,rotation:X.rotation,preview:X.public_url}),P.preview&&P.preview.startsWith("blob:")&&URL.revokeObjectURL(P.preview)}x("update:modelValue",I),x("save",a.pointId),x("uploaded",{pointId:a.pointId,images:I}),g()}catch(P){if(console.error("Error during image processing/upload:",P),(D=(h=P.response)==null?void 0:h.data)!=null&&D.message)alert(`Failed to save images: ${P.response.data.message}`);else if((H=(u=P.response)==null?void 0:u.data)!=null&&H.errors){const O=Object.values(P.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${O}`)}else alert(`Failed to save images: ${P.message}`)}finally{s.value=!1}},ue=n=>{if(n){if(n.id&&!n.isNew)S(n);else{const I=y.value.findIndex(h=>h.preview&&h.preview===n.preview&&h.isNew||h.id&&h.id===n.id);if(I!==-1){const h=y.value.splice(I,1)[0];h.preview&&h.preview.startsWith("blob:")&&URL.revokeObjectURL(h.preview)}x("update:modelValue",a.modelValue.filter(h=>!(h.id&&h.id===n.id)&&!(h.preview&&h.preview===n.preview)))}V.value>=C.value.length&&(V.value=Math.max(0,C.value.length-1)),C.value.length===0&&g()}},S=async n=>{var h,D;if(n.id||n.image_path)try{await _e.delete(route("inspections.delete-image"),{data:{image_id:n.id,image_path:n.image_path}})}catch(u){console.error("Error deleting image from server:",u),(D=(h=u.response)==null?void 0:h.data)!=null&&D.message?alert(`Failed to delete image from server: ${u.response.data.message}`):alert(`Failed to delete image from server: ${u.message}`);return}n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview);const I=a.modelValue.filter(u=>u.id!==n.id);x("update:modelValue",I),y.value=y.value.filter(u=>u.isNew&&n.isNew?u.preview!==n.preview:u.id!==n.id),x("removeImage",{image:n}),d.value&&C.value.length===0?g():d.value&&V.value>=C.value.length&&(V.value=Math.max(0,C.value.length-1))};return(n,I)=>(o(),i("div",null,[e("input",{ref_key:"galleryInput",ref:l,type:"file",accept:w.value,class:"hidden",onChange:L,multiple:$.value,disabled:s.value},null,40,vs),e("canvas",{ref_key:"processingCanvas",ref:r,class:"hidden"},null,512),C.value.length===0?(o(),i("label",{key:0,onClick:F,class:ne(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:s.value},[e("div",hs,[I[2]||(I[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),I[3]||(I[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),I[4]||(I[4]=e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),e("p",fs,"Allowed types: "+q(w.value),1)])],8,ps)):(o(),i("div",{key:1,class:ne(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[t.settings.max_files===1?(o(),i("div",ws,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:I[0]||(I[0]=h=>te(0))},[e("img",{src:E(C.value[0]),class:"w-full h-full object-cover"},null,8,ys)]),e("button",{onClick:I[1]||(I[1]=Pe(h=>S(C.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:s.value},I[5]||(I[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ie(" Hapus Foto ")]),8,bs)])):(o(),i("div",xs,[$.value&&C.value.length<t.settings.max_files?(o(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:F,disabled:s.value},I[6]||(I[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,ks)):b("",!0),(o(!0),i(se,null,ae(C.value,(h,D)=>(o(),i("div",{key:h.id||h.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:u=>te(D)},[e("img",{src:E(h),class:"w-full h-full object-cover"},null,8,Is),h.isNew||h.rotation!==0?(o(),i("div",Vs,[h.isNew?(o(),i("span",Cs,"BARU")):b("",!0),h.rotation!==0?(o(),i("span",Ss,"ROTASI")):b("",!0)])):b("",!0)],8,$s))),128))]))],2)),t.error?(o(),i("p",_s,q(t.error),1)):b("",!0),re(At,{show:f.value,onClose:B,onOpenWebcam:A,onTriggerGallery:R},null,8,["show"]),re(Jt,{show:p.value,"aspect-ratio":U.value,settings:t.settings,point:t.point,onClose:k,onPhotoCaptured:W},null,8,["show","aspect-ratio","settings","point"]),re(gs,{show:d.value,images:C.value,point:t.point,"initial-index":V.value,"allow-multiple":$.value,"max-files":t.settings.max_files,"is-uploading":s.value,"aspect-ratio":U.value,onClose:g,onSaveImages:de,onRemovePreviewImage:ue,onTriggerAddMorePhotos:F},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},Ce=ge(Ms,[["__scopeId","data-v-f8e05d93"]]),Us={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Ns={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Rs={class:"px-4 pb-2 border-b border-gray-200"},js={class:"text-lg font-semibold text-gray-900"},Ps={key:0,class:"text-sm text-gray-500 mt-1"},Ds={class:"flex-1 overflow-y-auto p-4"},qs={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Bs={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:_}){const a=_,x=()=>{a("close")},l=r=>{r.key==="Escape"&&x()};return xe(()=>{document.addEventListener("keydown",l)}),De(()=>{document.removeEventListener("keydown",l)}),(r,f)=>(o(),Y(Ie,{name:"bottom-sheet"},{default:me(()=>[t.show?(o(),i("div",Us,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:x}),e("div",Ns,[f[0]||(f[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Rs,[e("h3",js,q(t.title),1),t.subtitle?(o(),i("p",Ps,q(t.subtitle),1)):b("",!0)]),e("div",Ds,[Me(r.$slots,"default",{},void 0,!0)]),r.$slots.footer?(o(),i("div",qs,[Me(r.$slots,"footer",{},void 0,!0)])):b("",!0)])])):b("",!0)]),_:3}))}},Re=ge(Bs,[["__scopeId","data-v-7893c2dc"]]),Ts={class:"space-y-4"},As={key:0,class:"mt-2"},Fs={class:"text-sm font-medium text-gray-700 mb-2"},Ls={key:0,class:"text-red-500"},Es={key:0,class:"text-xs text-red-500"},Hs={key:1,class:"grid grid-cols-2 gap-2"},zs=["name","value","checked"],Os={key:2,class:"space-y-2"},Ws={key:0,class:"text-red-500"},Ks={key:1,class:"text-xs text-red-500"},Xs={key:3,class:"mt-4"},Gs={class:"text-sm font-medium text-gray-700 mb-2"},Js={key:0,class:"text-red-500"},Zs={key:0,class:"text-xs text-red-500"},Qs={class:"flex gap-2"},Ys=["disabled"],Se={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(t,{emit:_}){const a=t,x=_,l=p=>x("hapus",p),r=Z(()=>a.options.find(p=>p.value===a.selectedValue)),f=Z(()=>{var d,y,V;if(a.point.input_type==="imageTOradio"&&a.imagesValue.length===0||a.options.length&&!a.selectedValue)return!1;const p=r.value;return!(a.showTextarea&&((d=p==null?void 0:p.settings)!=null&&d.show_textarea)&&(!((y=a.notesValue)!=null&&y.trim())||p.settings.min_length&&a.notesValue.length<p.settings.min_length||p.settings.max_length&&a.notesValue.length>p.settings.max_length)||a.showImageUpload&&((V=p==null?void 0:p.settings)!=null&&V.show_image_upload)&&(a.imagesValue.length===0||p.settings.max_files&&a.imagesValue.length>p.settings.max_files))});return(p,d)=>(o(),Y(Re,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:d[10]||(d[10]=y=>p.$emit("close"))},{footer:me(()=>[t.selectedPoint?(o(),i("button",{key:0,onClick:d[7]||(d[7]=y=>l(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},d[12]||(d[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ie(" Hapus Data ")]))):b("",!0),e("div",Qs,[e("button",{type:"button",onClick:d[8]||(d[8]=y=>p.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:d[9]||(d[9]=y=>p.$emit("save")),disabled:!f.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Ys)])]),default:me(()=>{var y,V,s,$,w,U,C,E,F,R,A,B,k,g;return[e("div",Ts,[t.point.input_type==="imageTOradio"?(o(),i("div",As,[e("h4",Fs,[(y=t.point.settings)!=null&&y.required?(o(),i("span",Ls,"*")):b("",!0)]),re(Ce,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":d[0]||(d[0]=m=>p.$emit("update:imagesValue",m)),onSave:d[1]||(d[1]=m=>p.$emit("saveImage",m))},null,8,["model-value","point-id","point","inspection-id","settings"]),(V=t.point.settings)!=null&&V.required&&t.imagesValue.length===0?(o(),i("p",Es," Foto wajib diupload ")):b("",!0)])):b("",!0),t.options.length?(o(),i("div",Hs,[(o(!0),i(se,null,ae(t.options,(m,N)=>(o(),i("label",{key:N,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:m.value,checked:t.selectedValue===m.value,onChange:d[2]||(d[2]=J=>p.$emit("update:selectedValue",J.target.value)),class:"hidden peer"},null,40,zs),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===m.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==m.value}])},q(m.label),3)]))),128))])):b("",!0),t.showTextarea&&(($=(s=r.value)==null?void 0:s.settings)!=null&&$.show_textarea)?(o(),i("div",Os,[(w=r.value.settings)!=null&&w.required?(o(),i("span",Ws,"*")):b("",!0),re(Ne,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:r.value.settings,required:(U=r.value.settings)==null?void 0:U.required,"min-length":(C=r.value.settings)==null?void 0:C.min_length,"max-length":(E=r.value.settings)==null?void 0:E.max_length,placeholder:((F=r.value.settings)==null?void 0:F.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":d[3]||(d[3]=m=>p.$emit("update:notesValue",m)),onSave:d[4]||(d[4]=m=>p.$emit("saveTextarea",m))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(R=r.value.settings)!=null&&R.required&&!t.notesValue?(o(),i("p",Ks," Keterangan wajib diisi ")):b("",!0)])):b("",!0),t.showImageUpload&&((B=(A=r.value)==null?void 0:A.settings)!=null&&B.show_image_upload)?(o(),i("div",Xs,[e("h4",Gs,[d[11]||(d[11]=ie(" Upload Foto ")),(k=r.value.settings)!=null&&k.required?(o(),i("span",Js,"*")):b("",!0)]),re(Ce,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:r.value.settings,"onUpdate:modelValue":d[5]||(d[5]=m=>p.$emit("update:imagesValue",m)),onSave:d[6]||(d[6]=m=>p.$emit("saveImage",m))},null,8,["model-value","point-id","point","inspection-id","settings"]),(g=r.value.settings)!=null&&g.required&&t.imagesValue.length===0?(o(),i("p",Zs," Foto wajib diupload ")):b("",!0)])):b("",!0)])]}),_:1},8,["show","title","subtitle"]))}},ea={class:"mt-2 space-y-4"},ta={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},sa=["name","value","checked","onChange","required"],aa={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},oa={key:0,class:"mt-3"},na={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},ia=["src"],la={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ra={key:1,class:"mt-2"},ua={class:"text-sm text-gray-600"},da={key:2,class:"mt-2 text-sm text-red-600"},ca={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:_}){const a=t,x=_,l=M(a.notes),r=M([...a.images]),f=M(!1),p=M(""),d=M([]),y=M(""),V=M([]),s=Z(()=>a.options.find(k=>k.value===a.modelValue)),$=k=>k.settings&&(k.settings.show_textarea||k.settings.show_image_upload);ee(()=>a.notes,k=>{l.value=k}),ee(()=>a.images,k=>{r.value=[...k]}),ee(()=>a.modelValue,k=>{k&&(y.value=k)});const w=k=>{x("update:modelValue",k.value),$(k)?C():x("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:k.value,notes:"",images:[]})},U=k=>k.preview||(k.image_path?`/${k.image_path}`:k),C=()=>{y.value=a.modelValue,p.value=l.value,d.value=[...r.value],V.value=[...r.value],f.value=!0},E=()=>{p.value="",d.value=[],y.value="",f.value=!1},F=k=>{d.value=k,r.value=[...k],x("update:images",[...k]),x("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:l.value,images:[...k]})},R=k=>{},A=()=>{y.value!==a.modelValue&&x("update:modelValue",y.value),l.value=p.value,x("update:notes",p.value),r.value=[...d.value],x("update:images",[...d.value]),x("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:y.value,notes:p.value,images:d.value}),f.value=!1},B=k=>{x("hapus",k),f.value=!1};return(k,g)=>{var m,N,J,L;return o(),i("div",ea,[e("div",ta,[(o(!0),i(se,null,ae(t.options,(W,te)=>(o(),i("label",{key:te,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:W.value,checked:t.modelValue===W.value,onChange:le=>w(W),class:"hidden peer",required:t.required},null,40,sa),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===W.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==W.value}])},q(W.label),3)]))),128))]),t.modelValue&&s.value&&$(s.value)?(o(),i("div",aa,[e("div",{class:"flex justify-between items-start"},[g[4]||(g[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:C,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((m=s.value.settings)!=null&&m.show_image_upload)?(o(),i("div",oa,[e("div",na,[(o(!0),i(se,null,ae(t.images,(W,te)=>(o(),i("div",{key:te,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:U(W),class:"w-full h-full object-cover rounded"},null,8,ia),te===3&&t.images.length>4?(o(),i("span",la," +"+q(t.images.length-4),1)):b("",!0)]))),128))])])):b("",!0),t.notes&&((N=s.value.settings)!=null&&N.show_textarea)?(o(),i("div",ra,[e("p",ua,q(t.notes),1)])):b("",!0)])):b("",!0),f.value?(o(),Y(Se,{key:(J=t.selectedPoint)==null?void 0:J.id,show:f.value,title:t.pointName||"Detail",subtitle:(L=s.value)==null?void 0:L.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":y.value,"notes-value":p.value,"images-value":d.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":g[0]||(g[0]=W=>y.value=W),"onUpdate:notesValue":g[1]||(g[1]=W=>p.value=W),"onUpdate:imagesValue":g[2]||(g[2]=W=>F(W)),onClose:E,onSave:A,onSaveTextarea:k.handleTextareaSave,onSaveImage:R,onHapus:g[3]||(g[3]=W=>B(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):b("",!0),t.error?(o(),i("p",da,q(t.error),1)):b("",!0)])}}},ma={class:"mt-2 space-y-4"},ga={key:0,class:"flex flex-wrap gap-3"},va={key:1,class:"p-4 border rounded-lg bg-gray-50"},pa={key:0,class:"mt-3"},ha={class:"flex gap-2 overflow-x-auto scrollbar-hide"},fa=["src"],wa={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ya={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},ba=["name","value","checked"],xa={key:1,class:"mt-2"},ka={class:"text-sm text-gray-600"},$a={key:3,class:"mt-2 text-sm text-red-600"},Ia={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:_}){const a=t,x=_,l=M(a.notes),r=M([...a.images]),f=M(!1),p=M(""),d=M([]),y=M(""),V=M([]),s=Z(()=>a.options.find(R=>R.value===a.modelValue)),$=R=>R.preview||(R.image_path?`/${R.image_path}`:R),w=()=>{y.value=a.modelValue||"",p.value=l.value,d.value=[...r.value],V.value=[...r.value],f.value=!0},U=()=>{p.value="",d.value=[],y.value="",f.value=!1},C=R=>{d.value=R,r.value=[...R],x("update:images",[...R]),x("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:l.value,images:[...R]})},E=()=>{y.value!==a.modelValue&&x("update:modelValue",y.value),l.value=p.value,x("update:notes",p.value),r.value=[...d.value],x("update:images",[...d.value]),x("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:y.value,notes:p.value,images:d.value}),f.value=!1},F=R=>{x("hapus",R),f.value=!1};return(R,A)=>{var B,k,g;return o(),i("div",ma,[!t.modelValue&&r.value.length===0&&!l.value?(o(),i("div",ga,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:w},A[4]||(A[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(o(),i("div",va,[e("div",{class:"flex justify-between items-start"},[A[5]||(A[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:w,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),r.value.length>0?(o(),i("div",pa,[e("div",ha,[(o(!0),i(se,null,ae(r.value,(m,N)=>(o(),i("div",{key:N,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:$(m),class:"w-full h-full object-cover rounded"},null,8,fa),N===3&&r.value.length>4?(o(),i("span",wa," +"+q(r.value.length-4),1)):b("",!0)]))),128))])])):b("",!0),e("div",ya,[(o(!0),i(se,null,ae(t.options,(m,N)=>(o(),i("label",{key:N,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:m.value,checked:t.modelValue===m.value,disabled:!0,class:"hidden peer"},null,8,ba),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===m.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==m.value}])},q(m.label),3)]))),128))]),l.value&&((B=s.value.settings)!=null&&B.show_textarea)?(o(),i("div",xa,[e("p",ka,q(l.value),1)])):b("",!0)])),f.value?(o(),Y(Se,{key:(k=t.selectedPoint)==null?void 0:k.id,show:f.value,title:t.pointName||"Detail",subtitle:(g=s.value)==null?void 0:g.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":y.value,"notes-value":p.value,"images-value":d.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":A[0]||(A[0]=m=>y.value=m),"onUpdate:notesValue":A[1]||(A[1]=m=>p.value=m),"onUpdate:imagesValue":A[2]||(A[2]=m=>C(m)),onClose:U,onSave:E,onHapus:A[3]||(A[3]=m=>F(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):b("",!0),t.error?(o(),i("p",$a,q(t.error),1)):b("",!0)])}}},Va={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ca={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},Sa={class:"text-xl font-semibold text-indigo-700"},_a={class:"p-4 space-y-4"},Ma={class:"flex items-start justify-between"},Ua={class:"block text-sm font-medium text-gray-700"},Na={key:0,class:"text-red-500"},Ra={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},ja={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:_}){const a=t,x=_,l=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],r=y=>{var $,w,U,C,E;const V=a.form.results[y.id],s=a.form.images[y.id];if(!V)return!1;switch(y.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!V.note;case"select":case"radio":if(!V.status)return!1;const F=($=y.settings.radios)==null?void 0:$.find(A=>A.value===V.status);return!(F!=null&&F.settings&&(F.settings.show_textarea&&!((w=V.note)!=null&&w.trim())||F.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!V.status)return!1;const R=(U=y.settings.radios)==null?void 0:U.find(A=>A.value===V.status);return!(R!=null&&R.settings&&R.settings.show_textarea&&!((C=V.note)!=null&&C.trim()));case"image":return s.length>0;default:return!!V.status||!!((E=V.note)!=null&&E.trim())}},f=(y,V)=>{x("updateResult",{pointId:y,value:V})},p=y=>{x("saveResult",y)},d=y=>{x("hapusPoint",y)};return(y,V)=>(o(),i("div",Va,[e("div",Ca,[e("h2",Sa,q(t.category.name),1)]),e("div",_a,[(o(!0),i(se,null,ae(t.category.points,s=>{var $,w,U,C,E,F,R,A,B,k,g,m,N,J,L,W,te,le,de,ue,S,n,I,h,D;return o(),i("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",Ma,[e("label",Ua,[ie(q(s.name)+" ",1),($=s.settings)!=null&&$.is_required?(o(),i("span",Na,"*")):b("",!0)]),r(s)?(o(),i("span",Ra," ✓ ")):b("",!0)]),s.input_type==="text"?(o(),Y(gt,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>f(s.id,u)],required:(w=s.settings)==null?void 0:w.is_required,"min-length":(U=s.settings)==null?void 0:U.min_length,"max-length":(C=s.settings)==null?void 0:C.max_length,pattern:(E=s.settings)==null?void 0:E.pattern,placeholder:((F=s.settings)==null?void 0:F.placeholder)||"Masukan text",error:t.form.errors[`results.${s.id}.note`],onSave:u=>p(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):b("",!0),s.input_type==="number"?(o(),Y(Ae,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>f(s.id,u)],required:(R=s.settings)==null?void 0:R.is_required,min:(A=s.settings)==null?void 0:A.min,max:(B=s.settings)==null?void 0:B.max,step:((k=s.settings)==null?void 0:k.step)||1,placeholder:((g=s.settings)==null?void 0:g.placeholder)||"Masukan number",error:t.form.errors[`results.${s.id}.note`],onSave:u=>p(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):b("",!0),s.input_type==="account"?(o(),Y(xt,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>f(s.id,u)],required:(m=s.settings)==null?void 0:m.is_required,placeholder:((N=s.settings)==null?void 0:N.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:u=>p(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):b("",!0),s.input_type==="date"?(o(),Y(ft,{key:3,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>f(s.id,u)],required:(J=s.settings)==null?void 0:J.is_required,"min-date":(L=s.settings)==null?void 0:L.min_date,"max-date":(W=s.settings)==null?void 0:W.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:u=>p(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):b("",!0),s.input_type==="textarea"?(o(),Y(Ne,{key:4,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[u=>t.form.results[s.id].note=u,u=>f(s.id,u)],required:(te=s.settings)==null?void 0:te.is_required,"min-length":(le=s.settings)==null?void 0:le.min_length,"max-length":(de=s.settings)==null?void 0:de.max_length,placeholder:((ue=s.settings)==null?void 0:ue.placeholder)||"Masukkan teks di sini",settings:s.settings,error:t.form.errors[`results.${s.id}.note`],onSave:u=>p(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):b("",!0),s.input_type==="radio"?(o(),Y(ca,{key:5,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[u=>t.form.results[s.id].status=u,u=>f(s.id,u)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(S=s.settings)==null?void 0:S.is_required,"point-id":s.id,point:s,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((n=s.settings)==null?void 0:n.radios)||l,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":u=>t.form.results[s.id].note=u,"onUpdate:images":u=>t.form.images[s.id].images=u,onSave:u=>p(s.id),onHapus:u=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):b("",!0),s.input_type==="imageTOradio"?(o(),Y(Ia,{key:6,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[u=>t.form.results[s.id].status=u,u=>f(s.id,u)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(I=s.settings)==null?void 0:I.is_required,"point-id":s.id,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((h=s.settings)==null?void 0:h.radios)||l,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":u=>t.form.results[s.id].note=u,"onUpdate:images":u=>t.form.images[s.id]=u,onSave:u=>p(s.id),onHapus:u=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):b("",!0),s.input_type==="image"?(o(),Y(Ce,{key:7,modelValue:t.form.images[s.id],"onUpdate:modelValue":u=>t.form.images[s.id]=u,error:t.form.errors[`images.${s.id}`],"inspection-id":t.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,"onUpdate:notes":u=>t.form.results[s.id].note=u,"onUpdate:status":u=>t.form.results[s.id].status=u},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):b("",!0),s.input_type==="select"?(o(),Y(Pt,{key:8,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[u=>t.form.results[s.id].status=u,u=>f(s.id,u)],required:(D=s.settings)==null?void 0:D.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:u=>p(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):b("",!0)])}),128))])]))}},Pa=ge(ja,[["__scopeId","data-v-c6590056"]]),Da={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},qa={class:"p-4 space-y-4-6"},Ba={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ta=["value"],Aa={class:"p-4 space-y-4-6"},Fa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},La=["value"],Ea={key:0,class:"p-4 space-y-4-6"},Ha={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},za=["value"],Oa={class:"p-4 space-y-4-6"},Wa={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(t){const _=t,a=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch($){return console.error("Error parsing settings JSON:",$),{}}return typeof s=="object"&&s!==null?s:{}},x=Z(()=>a(_.inspection.settings).conclusion||{}),l=M({flooded:x.value.flooded||"",collision:x.value.collision||"",collision_severity:x.value.collision_severity||"",conclusion_note:_.inspection.notes||""}),r=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],f=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],p=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],d=()=>{const s={flooded:l.value.flooded,collision:l.value.collision,collision_severity:l.value.collision==="yes"?l.value.collision_severity:null,conclusion_note:l.value.conclusion_note};Ve.post(route("inspections.updateConclusion",_.inspectionId),s,{preserveScroll:!0,preserveState:!0,onError:$=>{console.error("Error saving conclusion:",$)}})},y=be.debounce(d,500);ee([()=>l.value.flooded,()=>l.value.collision,()=>l.value.collision_severity],()=>{d()}),xe(()=>{V()}),ee(()=>_.inspection,()=>{V()},{deep:!0});const V=()=>{const $=a(_.inspection.settings).conclusion||{};l.value={flooded:$.flooded||"",collision:$.collision||"",collision_severity:$.collision_severity||"",conclusion_note:_.inspection.notes||""}};return(s,$)=>(o(),i("div",Da,[$[9]||($[9]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),e("div",qa,[$[5]||($[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),e("div",Ba,[(o(),i(se,null,ae(r,w=>e("label",{key:w.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":$[0]||($[0]=U=>l.value.flooded=U),value:w.value,class:"hidden peer"},null,8,Ta),[[$e,l.value.flooded]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.flooded===w.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.flooded!==w.value}])},q(w.label),3)])),64))])]),e("div",Aa,[$[7]||($[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),e("div",Fa,[(o(),i(se,null,ae(f,w=>e("label",{key:w.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":$[1]||($[1]=U=>l.value.collision=U),value:w.value,class:"hidden peer"},null,8,La),[[$e,l.value.collision]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision===w.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision!==w.value}])},q(w.label),3)])),64))]),l.value.collision==="yes"?(o(),i("div",Ea,[$[6]||($[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),e("div",Ha,[(o(),i(se,null,ae(p,w=>e("label",{key:w.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":$[2]||($[2]=U=>l.value.collision_severity=U),value:w.value,class:"hidden peer"},null,8,za),[[$e,l.value.collision_severity]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision_severity===w.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision_severity!==w.value}])},q(w.label),3)])),64))])])):b("",!0)]),e("div",Oa,[$[8]||($[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),ce(e("textarea",{"onUpdate:modelValue":$[3]||($[3]=w=>l.value.conclusion_note=w),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:$[4]||($[4]=(...w)=>G(y)&&G(y)(...w))},null,544),[[we,l.value.conclusion_note]])])]))}},Ka={class:"container mx-auto px-4 py-2"},Xa={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},Ga={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},Ja=["onClick"],Za={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Qa={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ya={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},eo={class:"relative overflow-hidden"},to={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},so=["disabled"],ao={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},oo={class:"space-y-4"},no={class:"relative"},io={class:"max-h-64 overflow-y-auto"},lo={key:0,class:"text-center py-4 text-gray-500"},ro=["onClick"],uo={class:"font-medium text-gray-900"},co={class:"text-sm text-gray-500"},mo={class:"text-xs text-gray-400 mt-1"},go={key:0,class:"text-xs text-green-600 mt-1"},vo={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup(t){var O;const _=t,a=M(!1),x=M(!1),l=M(""),r=M(null),f=M(""),p=M(""),d=M([]),y=M(""),V=(v,c)=>v.filter(j=>c?w(j.id):!0),s=Z(()=>_.damagePoints||[]),$=Z(()=>{if(!l.value.trim())return s.value;const v=l.value.toLowerCase().trim();return s.value.filter(c=>{var j,T,K;return((j=c.name)==null?void 0:j.toLowerCase().includes(v))||((T=c.description)==null?void 0:T.toLowerCase().includes(v))||((K=U(c))==null?void 0:K.toLowerCase().includes(v))})}),w=v=>{var j;const c=L.results[v];return c&&(c.status||c.note||((j=c.images)==null?void 0:j.length)>0)},U=v=>{const c=_.components.find(j=>j.id===v.component_id);return c?c.name:"Komponen Tidak Diketahui"},C=v=>v&&Array.isArray(_.existingResults)?_.existingResults.find(c=>c.point_id===v):null,E=v=>{r.value=v;const c=L.results[v.id]||{};f.value=c.status||"",p.value=c.note||"",d.value=Array.isArray(c.images)?[...c.images]:[],a.value=!1,x.value=!0},F=()=>{r.value&&(L.results[r.value.id]={...L.results[r.value.id],status:f.value,note:p.value,images:Array.isArray(d.value)?[...d.value]:[]},I(r.value.id),y.value="Data berhasil disimpan!",setTimeout(()=>{y.value=""},1e3)),A()},R=()=>{a.value=!1,l.value=""},A=()=>{x.value=!1,r.value=null,f.value="",p.value="",d.value=[]},k=qe().props.inspection,g=M(((O=_.appMenu[0])==null?void 0:O.id)||"conclusion"),m=M(0),N=Z(()=>g.value!=="conclusion"?_.appMenu.find(v=>v.id===g.value):null);function J(){const v={},c={};return _.appMenu.forEach(j=>{(j.points||[]).forEach(T=>{var Q;const K=Array.isArray(_.existingResults)?_.existingResults.find(oe=>oe.point_id===T.id):null;v[T.id]={status:(K==null?void 0:K.status)||"",note:(K==null?void 0:K.note)||""};const X=((Q=_.existingImages)==null?void 0:Q[T.id])||[];c[T.id]=X.map(oe=>({id:oe.id,image_path:oe.image_path,preview:`/${oe.image_path}`,rotation:oe.rotation||0,isNew:!1}))})}),{inspection_id:_.inspection.id,results:v,images:c,overall_note:_.inspection.overall_note||""}}const L=Ue(J()),W=v=>v.input_type==="damage"?!0:v.id==="conclusion"?le():v.points.every(c=>{var X,Q,oe,pe,he,fe;const j=L.results[c.id],T=L.images[c.id];if(!j)return!1;const K=te(c.settings);switch(c.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((X=j.note)!=null&&X.trim());case"select":case"radio":if(!j.status)return!1;const z=(Q=K.radios)==null?void 0:Q.find(ke=>ke.value===j.status);return!(z!=null&&z.settings&&(z.settings.show_textarea&&!((oe=j.note)!=null&&oe.trim())||z.settings.show_image_upload&&(T==null?void 0:T.length)===0));case"imageTOradio":if((T==null?void 0:T.length)===0||!j.status)return!1;const ve=(pe=K.radios)==null?void 0:pe.find(ke=>ke.value===j.status);return!(ve!=null&&ve.settings&&ve.settings.show_textarea&&ve.settings.required&&!((he=j.note)!=null&&he.trim()));case"image":return(T==null?void 0:T.length)>0;default:return!!j.status||!!((fe=j.note)!=null&&fe.trim())}}),te=v=>{if(!v)return{};if(typeof v=="string")try{return JSON.parse(v)||{}}catch(c){return console.error("Error parsing settings JSON:",c),{}}return typeof v=="object"&&v!==null?v:{}},le=()=>{var Q;const c=te(_.inspection.settings).conclusion||{},j=!!c.flooded,T=!!c.collision,K=c.collision==="yes"?!!c.collision_severity:!0,X=!!((Q=_.inspection.notes)!=null&&Q.trim());return j&&T&&K&&X},de=Z(()=>{const c=te(_.inspection.settings).conclusion||{};return{flooded:c.flooded||null,collision:c.collision||null,collision_severity:c.collision_severity||null,note:_.inspection.notes||null,isComplete:le()}}),ue=v=>{g.value=v},S=v=>{var T;let c=m.value+v;const j=_.appMenu.length;c>=0&&c<=j&&(m.value=c,g.value=((T=_.appMenu[c])==null?void 0:T.id)||"conclusion")},n=()=>{let v=0,c=0;const j=Q=>{v=Q.changedTouches[0].screenX},T=Q=>{c=Q.changedTouches[0].screenX,K()},K=()=>{c<v-150?S(1):c>v+150&&S(-1)},X=document.querySelector(".relative.overflow-hidden");return X&&(X.addEventListener("touchstart",j,!1),X.addEventListener("touchend",T,!1)),()=>{X&&(X.removeEventListener("touchstart",j),X.removeEventListener("touchend",T))}},I=be.debounce(async v=>{try{await Ve.post(route("inspections.save-result"),{inspection_id:_.inspection.id,point_id:v,status:L.results[v].status,note:L.results[v].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(c){console.error("Error menyimpan hasil:",c)}},500),h=({pointId:v,type:c,value:j})=>{L.results[v].hasOwnProperty(c)&&(L.results[v][c]=j),I(v)},D=async v=>{if(v&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await Ve.post(route("inspections.delete-result"),{inspection_id:_.inspection.id,point_id:v},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{L.results[v]&&delete L.results[v],y.value="Data berhasil dihapus!",setTimeout(()=>{y.value=""},2e3)}})}catch(c){console.error("Error menghapus hasil:",c)}A()}},u=v=>{Object.assign(L.conclusion,v),saveConclusion()},H=()=>{if(!P.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}L.post(route("inspections.final-submit",{id:_.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:v=>{console.error("Kesalahan pengiriman:",v)}})};ee(g,v=>{const c=document.querySelector(`.flex-shrink-0[data-category-id="${v}"]`);c&&c.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const P=Z(()=>{const v=_.appMenu.every(j=>W(j)),c=le();return v&&c});return ee(l,be.debounce(()=>{},300)),xe(()=>{n()}),(v,c)=>{var j,T,K,X,Q,oe,pe,he,fe;return o(),i("div",Ka,[e("div",Xa,[e("div",Ga,[e("button",{onClick:c[0]||(c[0]=z=>ue("vehicle")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!=="vehicle"}])}," Detail Kendaraan ",2),(o(!0),i(se,null,ae(t.appMenu,z=>(o(),i("button",{key:z.id,onClick:ve=>ue(z.id),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value===z.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!==z.id}])},[ie(q(z.name)+" ",1),W(z)?(o(),i("span",Za," ✓ ")):b("",!0)],10,Ja))),128)),e("button",{onClick:c[1]||(c[1]=z=>ue("conclusion")),class:ne(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":g.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":g.value!=="conclusion"}])},[c[7]||(c[7]=ie(" Kesimpulan ")),de.value.isComplete?(o(),i("span",Qa," ✓ ")):b("",!0)],2)])]),re(Ie,{name:"fade"},{default:me(()=>[y.value?(o(),i("div",Ya,q(y.value),1)):b("",!0)]),_:1}),e("div",eo,[re(Ie,{name:"category-slide",mode:"out-in"},{default:me(()=>[g.value==="vehicle"?(o(),Y(ut,{key:0,inspection:G(k),CarDetail:t.CarDetail,onUpdateVehicle:v.updateVehicleDetails,onSaveCarDetails:v.saveNewCarDetails},null,8,["inspection","CarDetail","onUpdateVehicle","onSaveCarDetails"])):N.value&&g.value!=="conclusion"?(o(),Y(Pa,{key:N.value.id,category:{...N.value,points:V(N.value.points||[],N.value.input_type==="damage")},"inspection-id":G(k).id,form:G(L),onSaveResult:G(I),onUpdateResult:h,onHapusPoint:D,onRemoveImage:v.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):g.value==="conclusion"?(o(),Y(Wa,{key:2,form:G(L),"inspection-id":G(k).id,inspection:G(k),settings:G(k).settings||{},onUpdateConclusion:u},null,8,["form","inspection-id","inspection","settings"])):b("",!0)]),_:1})]),g.value==="conclusion"?(o(),i("div",to,[e("button",{type:"button",onClick:H,disabled:!P.value||G(L).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[G(L).processing?(o(),i("svg",ao,c[8]||(c[8]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):b("",!0),e("span",null,q(G(L).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,so)])):b("",!0),!a.value&&!x.value?(o(),i("button",{key:1,onClick:c[2]||(c[2]=z=>a.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},c[9]||(c[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):b("",!0),re(Re,{show:a.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:R},{default:me(()=>[e("div",oo,[e("div",no,[ce(e("input",{"onUpdate:modelValue":c[3]||(c[3]=z=>l.value=z),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[we,l.value]]),c[10]||(c[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",io,[$.value.length===0?(o(),i("div",lo," Tidak ada point yang ditemukan ")):b("",!0),(o(!0),i(se,null,ae($.value,z=>(o(),i("button",{key:z.id,onClick:ve=>E(z),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",uo,q(z.name),1),e("div",co,q(z.description),1),e("div",mo,q(U(z)),1),w(z.id)?(o(),i("div",go," ✓ Sudah ada data ")):b("",!0)],8,ro))),128))])])]),_:1},8,["show"]),x.value?(o(),Y(Se,{key:(j=r.value)==null?void 0:j.id,show:x.value,title:((T=r.value)==null?void 0:T.name)||"Detail Point",subtitle:(K=r.value)==null?void 0:K.description,name:`point-${(X=r.value)==null?void 0:X.id}`,"inspection-id":G(k).id,"point-id":(Q=r.value)==null?void 0:Q.id,settings:((oe=r.value)==null?void 0:oe.settings)||{},options:((he=(pe=r.value)==null?void 0:pe.settings)==null?void 0:he.radios)||[],"selected-Point":r.value,"selected-value":f.value,"images-value":G(L).images[r.value.id],"notes-value":p.value,point:r.value,"existing-data":C((fe=r.value)==null?void 0:fe.id),"onUpdate:selectedValue":c[4]||(c[4]=z=>f.value=z),"onUpdate:notesValue":c[5]||(c[5]=z=>p.value=z),"onUpdate:imagesValue":c[6]||(c[6]=z=>G(L).images[r.value.id]=z),onSave:F,onClose:A,onHapus:D},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):b("",!0)])}}},xo=ge(vo,[["__scopeId","data-v-f5189791"]]);export{xo as default};
