import{x as H,W as k,e as i,o as n,a as s,t as m,F as b,h as y,u as r,f as u,j as L,g as W,l as x,s as C,y as G,z as P,n as J,B as D}from"./app-WLRSsGwh.js";import{l as K}from"./lodash-CUegu-7E.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"container mx-auto px-4 py-8"},Y={class:"bg-white rounded-xl shadow-md overflow-hidden p-6 mb-8"},Z={class:"text-xl font-semibold text-indigo-600"},ee={class:"bg-indigo-50 px-6 py-4 border-b border-indigo-100"},se={class:"text-xl font-semibold text-indigo-700"},te={class:"p-6 space-y-8"},re={class:"flex items-start justify-between"},oe={class:"block text-sm font-medium text-gray-700"},ie={key:0,class:"text-red-500"},ne={key:0,class:"mt-1"},ae=["onUpdate:modelValue","onInput","required","minlength","maxlength","pattern","placeholder"],le={key:0,class:"mt-2 text-sm text-red-600"},de={key:1,class:"mt-1"},ue=["onUpdate:modelValue","onInput","required","min","max","step","placeholder"],ce={key:0,class:"mt-2 text-sm text-red-600"},me={key:2,class:"mt-1"},ge=["onUpdate:modelValue","onChange","required","min","max"],pe={key:0,class:"mt-2 text-sm text-red-600"},he={key:3,class:"mt-1"},_e=["onUpdate:modelValue","onChange"],be={key:0,class:"mt-2 text-sm text-red-600"},xe={key:4,class:"mt-2"},fe={class:"flex flex-col gap-2 sm:flex-row sm:items-center"},ye=["name","value","onUpdate:modelValue","onChange","required"],ve={class:"text-sm text-gray-700"},we={key:0,class:"mt-2 text-sm text-red-600"},ke={key:5,class:"mt-4"},Ce=["onChange","id"],$e=["for"],Ve={key:1,class:"relative w-full h-full flex items-center justify-center"},Se={class:"flex flex-wrap gap-2 p-2"},Ue=["src"],qe={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 rounded-lg transition duration-200 flex items-center justify-center"},je=["onClick"],Ee={key:0,class:"mt-2 text-sm text-red-600"},Ae={class:"flex justify-end gap-4"},Me=["disabled"],ze={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Be={__name:"Create",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(v){const h=v,t=H((()=>{const l={};return h.categories.forEach(o=>{(o.points||[]).forEach(c=>{var e,g;const d=Array.isArray(h.existingResults)?h.existingResults.find(p=>p.point_id===c.id):null;l[c.id]={status:(d==null?void 0:d.status)||"",note:(d==null?void 0:d.note)||"",images:((g=(e=h.existingImages)==null?void 0:e[c.id])==null?void 0:g.map(p=>({image_path:p.image_path,preview:null})))||[]}})}),{inspection_id:h.inspection.id,results:l}})()),$=K.debounce(l=>{f(l)},1e3),f=async l=>{try{const o=await k.post(route("inspections.save-result"),{inspection_id:h.inspection.id,point_id:l,status:t.results[l].status,note:t.results[l].note},{preserveScroll:!0,preserveState:!0});console.log("Saved successfully:",o)}catch(o){console.error("Error saving result:",o)}},N=async(l,o)=>{const c=l.target.files[0];if(!c)return;const d=URL.createObjectURL(c);try{t.transform(e=>{const g=new FormData;return g.append("inspection_id",e.inspection_id),g.append("point_id",o),g.append("image",c),k.post(route("inspections.upload-image"),g,{preserveScroll:!0,onSuccess:p=>{t.results[o].images.push({image_path:p.props.imagePath,preview:d})}}),e})}catch(e){console.error("Error uploading image:",e)}finally{l.target.value=""}},O=async(l,o)=>{const c=t.results[l].images[o];try{await k.delete(route("inspections.delete-image"),{data:{image_path:c.image_path,point_id:l,inspection_id:h.inspection.id},preserveScroll:!0,onSuccess:()=>{t.results[l].images.splice(o,1)}})}catch(d){console.error("Error deleting image:",d)}},T=()=>{t.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{D().props.flash.success="Inspection submitted successfully!"},onError:()=>{D().props.flash.error="There were errors in your submission."}})};return(l,o)=>{var c;return n(),i("div",X,[s("div",Y,[o[0]||(o[0]=s("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Vehicle Inspection",-1)),s("h2",Z,m(((c=v.inspection.car)==null?void 0:c.brand_id)||"Unknown Vehicle"),1)]),s("form",{onSubmit:L(T,["prevent"]),class:"space-y-8"},[(n(!0),i(b,null,y(v.categories,d=>(n(),i("div",{key:d.id,class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},[s("div",ee,[s("h2",se,m(d.name),1)]),s("div",te,[(n(!0),i(b,null,y(d.points,e=>{var g,p,V,S,U,q,j,E,A,M,z,B,I,R,F;return n(),i("div",{key:e.id,class:"space-y-4 pb-6 border-b border-gray-100 last:border-0 last:pb-0"},[s("div",re,[s("label",oe,[W(m(e.name)+" ",1),(g=e.settings)!=null&&g.is_required?(n(),i("span",ie,"*")):u("",!0)])]),e.input_type==="text"?(n(),i("div",ne,[x(s("input",{"onUpdate:modelValue":a=>r(t).results[e.id].note=a,onInput:a=>r($)(e.id),type:"text",required:(p=e.settings)==null?void 0:p.is_required,minlength:(V=e.settings)==null?void 0:V.min_length,maxlength:(S=e.settings)==null?void 0:S.max_length,pattern:(U=e.settings)==null?void 0:U.pattern,placeholder:((q=e.settings)==null?void 0:q.placeholder)||"Enter text",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ae),[[C,r(t).results[e.id].note]]),r(t).errors[`results.${e.id}.note`]?(n(),i("p",le,m(r(t).errors[`results.${e.id}.note`]),1)):u("",!0)])):u("",!0),e.input_type==="number"?(n(),i("div",de,[x(s("input",{"onUpdate:modelValue":a=>r(t).results[e.id].note=a,onInput:a=>r($)(e.id),type:"number",required:(j=e.settings)==null?void 0:j.is_required,min:(E=e.settings)==null?void 0:E.min,max:(A=e.settings)==null?void 0:A.max,step:((M=e.settings)==null?void 0:M.step)||1,placeholder:((z=e.settings)==null?void 0:z.placeholder)||"Enter number",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ue),[[C,r(t).results[e.id].note,void 0,{number:!0}]]),r(t).errors[`results.${e.id}.note`]?(n(),i("p",ce,m(r(t).errors[`results.${e.id}.note`]),1)):u("",!0)])):u("",!0),e.input_type==="date"?(n(),i("div",me,[x(s("input",{"onUpdate:modelValue":a=>r(t).results[e.id].note=a,onChange:a=>f(e.id),type:"date",required:(B=e.settings)==null?void 0:B.is_required,min:(I=e.settings)==null?void 0:I.min_date,max:(R=e.settings)==null?void 0:R.max_date,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ge),[[C,r(t).results[e.id].note]]),r(t).errors[`results.${e.id}.note`]?(n(),i("p",pe,m(r(t).errors[`results.${e.id}.note`]),1)):u("",!0)])):u("",!0),e.input_type==="select"?(n(),i("div",he,[x(s("select",{"onUpdate:modelValue":a=>r(t).results[e.id].status=a,onChange:a=>f(e.id),class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},o[1]||(o[1]=[s("option",{value:"",disabled:""},"Select status",-1),s("option",{value:"good"},"Good",-1),s("option",{value:"bad"},"Bad",-1),s("option",{value:"na"},"N/A",-1)]),40,_e),[[G,r(t).results[e.id].status]]),r(t).errors[`results.${e.id}.status`]?(n(),i("p",be,m(r(t).errors[`results.${e.id}.status`]),1)):u("",!0)])):u("",!0),e.input_type==="radio"?(n(),i("div",xe,[s("div",fe,[(n(!0),i(b,null,y(((F=e.settings)==null?void 0:F.radios)||[],a=>{var _;return n(),i("label",{key:a.value,class:"inline-flex items-center space-x-2"},[x(s("input",{type:"radio",name:"radio-"+e.id,value:a.value,"onUpdate:modelValue":w=>r(t).results[e.id].status=w,onChange:w=>f(e.id),required:(_=e.settings)==null?void 0:_.is_required,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,ye),[[P,r(t).results[e.id].status]]),s("span",ve,m(a.label),1)])}),128))]),r(t).errors[`results.${e.id}.status`]?(n(),i("p",we,m(r(t).errors[`results.${e.id}.status`]),1)):u("",!0)])):u("",!0),e.input_type==="image"?(n(),i("div",ke,[s("input",{type:"file",onChange:a=>N(a,e.id),accept:"image/*",class:"hidden",id:"image-upload-"+e.id,ref_for:!0,ref:"imageUpload-"+e.id},null,40,Ce),s("label",{for:"image-upload-"+e.id,class:J(["flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-xl cursor-pointer transition duration-200",{"border-gray-300 hover:border-indigo-400 bg-gray-50 hover:bg-indigo-50":r(t).results[e.id].images.length===0,"border-indigo-300 bg-indigo-50":r(t).results[e.id].images.length>0}])},[r(t).results[e.id].images.length===0?(n(),i(b,{key:0},[o[2]||(o[2]=s("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),o[3]||(o[3]=s("p",{class:"text-sm text-gray-500 font-medium"},"Upload Image",-1)),o[4]||(o[4]=s("p",{class:"text-xs text-gray-400 mt-1"},"Click to browse or drag and drop",-1))],64)):(n(),i("div",Ve,[s("div",Se,[(n(!0),i(b,null,y(r(t).results[e.id].images,(a,_)=>(n(),i("div",{key:_,class:"relative group"},[s("img",{src:a.preview||"/storage/"+a.image_path,class:"h-20 w-20 object-cover rounded-lg border border-gray-200 shadow-sm"},null,8,Ue),s("div",qe,[s("button",{onClick:L(w=>O(e.id,_),["stop"]),type:"button",class:"opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full h-6 w-6 flex items-center justify-center transition duration-200 transform group-hover:scale-100 scale-90"}," Ã— ",8,je)])]))),128))]),o[5]||(o[5]=s("div",{class:"absolute bottom-2 right-2"},[s("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"}," + Add More ")],-1))]))],10,$e),r(t).errors[`results.${e.id}.images`]?(n(),i("p",Ee,m(r(t).errors[`results.${e.id}.images`]),1)):u("",!0)])):u("",!0)])}),128))])]))),128)),s("div",Ae,[s("button",{type:"submit",disabled:r(t).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[r(t).processing?(n(),i("svg",ze,o[6]||(o[6]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):u("",!0),s("span",null,m(r(t).processing?"Submitting...":"Final Submit Inspection"),1)],8,Me)])],32)])}}},De=Q(Be,[["__scopeId","data-v-35babf44"]]);export{De as default};
