import{x as Ct,r as _,g as Ue,q as oe,E as Be,G as pe,c as o,o as s,d as e,b as l,k as be,z as $e,A as Re,n as ne,t as C,u as Ee,e as Et,F as ye,m as ke,f as fe,y as Pe,w as Te,M as Ve,N as kt,a as Le,j as Ie,l as yt,T as De,L as Vt,p as Mt,O as xt,D as wt,J as je,B as Rt}from"./vendor-lhzHoW6A.js";import{l as It}from"./lodash-DrtvmM31.js";import{_ as Ut}from"./PrimaryButton-DFMRt6cP.js";import{_ as Pt}from"./ActionMessage-DmI1ZVVZ.js";import{_ as Ne}from"./app-CcWkXkHq.js";const Dt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Bt={key:0,class:"p-4 space-y-2"},Lt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},jt={class:"flex items-center space-x-2"},Ot={key:0,class:"text-xs text-red-500 font-normal ml-2"},Ft={key:1,class:"text-xs text-red-500 font-normal ml-2"},qt={key:2,class:"text-xs text-green-500 font-normal ml-2"},Ht={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},Kt={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Gt={class:"col-span-2 flex space-x-3"},zt={class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},Wt={class:"flex items-start"},Zt={class:"text-sm text-blue-700"},Jt={class:"mt-1"},Yt={key:0,class:"inline-flex items-center px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-medium mr-2"},Xt={key:1,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium mr-2"},Qt={key:2,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium"},ea={key:3,class:"text-blue-600"},ta={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},aa={class:"relative"},na={key:0,class:"absolute right-3 top-3"},sa={key:1,class:"text-xs text-red-500 font-normal ml-2"},oa={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},ia={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},la={key:0},ra=["onMousedown"],da={class:"font-medium text-gray-900"},ua={class:"text-sm text-gray-500"},ca={key:1,class:"p-4 text-sm text-gray-500 text-center"},pa={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},ga={key:0,class:"mb-4"},ma=["innerHTML"],va={key:1},fa={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ha=["onClick"],ba=["src","alt"],ya={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},xa={class:"text-white text-xs text-center"},wa={key:2,class:"text-center py-4 text-gray-500 text-sm"},ka={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Ia=["src","alt"],_a={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Aa={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Sa={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},$a={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges","update:vehicle-type"],setup(t,{emit:W}){var de,we,_e,Ae,Se,Ce;const a=t,y=W,r=Ct({plate_number:((de=a.inspection)==null?void 0:de.plate_number)||"",car_id:((we=a.inspection)==null?void 0:we.car_id)||null,car_name:((_e=a.inspection)==null?void 0:_e.car_name)||""}),g=_(((Ae=a.inspection)==null?void 0:Ae.plate_number)||""),m=_(((Se=a.inspection)==null?void 0:Se.car_id)||null),u=_(((Ce=a.inspection)==null?void 0:Ce.car_name)||""),i=_(""),x=_(""),I=_(""),b=_(null),E=_({rear_door:!1}),F=_(!1),B=_(""),K=_(""),q=_(r.car_name),N=_(!1),w=_(!1),H=_([]),O=_(null),V=_([]),D=_(!1),z=_(0);Ue(()=>{var k,h,le,j,ue;if($((k=a.inspection)==null?void 0:k.plate_number),(h=a.inspection)!=null&&h.car_id&&((le=a.CarDetail)==null?void 0:le.length)>0){const me=a.CarDetail.find(ve=>ve.id===a.inspection.car_id);me&&d(me)}else!((j=a.inspection)!=null&&j.car_id)&&((ue=a.inspection)!=null&&ue.car_name)&&(q.value=a.inspection.car_name,r.car_id=null);window.addEventListener("keydown",X),ge(),y("update:hasUnsavedChanges",te.value),y("update:validation",ae.value)}),Be(()=>{window.removeEventListener("keydown",X)});const ge=()=>{try{const k=localStorage.getItem("vehicle_features");if(k){const h=JSON.parse(k);E.value.rear_door=h.rear_door||!1,h.pick_up?b.value="pick_up":h.box?b.value="box":b.value=null}else E.value.rear_door=!1,b.value=null;c()}catch(k){console.error("Error loading vehicle type from localStorage:",k),E.value.rear_door=!1,b.value=null,c()}},A=()=>{E.value.rear_door=!E.value.rear_door,n()},p=k=>{b.value===k?b.value=null:b.value=k,n()},n=()=>{try{const k={rear_door:E.value.rear_door,pick_up:b.value==="pick_up",box:b.value==="box"};localStorage.setItem("vehicle_features",JSON.stringify(k)),c(),console.log("Vehicle features saved to localStorage:",k)}catch(k){console.error("Error saving vehicle type to localStorage:",k)}},c=()=>{const k={rear_door:E.value.rear_door,pick_up:b.value==="pick_up",box:b.value==="box"};y("update:vehicle-type",k)},$=k=>{if(!k){i.value="",x.value="",I.value="";return}const h=k.toUpperCase().trim(),le=h.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(le)i.value=le[1]||"",x.value=le[2]||"",I.value=le[3]||"";else{let j="area",ue="",me="",ve="";for(const ce of h)j==="area"&&/[A-Z]/.test(ce)?ue+=ce:j==="area"&&/[0-9]/.test(ce)?(j="number",me+=ce):j==="number"&&/[0-9]/.test(ce)?me+=ce:j==="number"&&/[A-Z]/.test(ce)?(j="suffix",ve+=ce):j==="suffix"&&/[A-Z]/.test(ce)&&(ve+=ce);i.value=ue,x.value=me,I.value=ve}J()},J=()=>{const k=`${i.value}${x.value}${I.value}`;r.plate_number=k,G()},M=k=>{k==="area"?i.value=i.value.toUpperCase().replace(/[^A-Z]/g,""):k==="number"?x.value=x.value.replace(/[^0-9]/g,""):k==="suffix"&&(I.value=I.value.toUpperCase().replace(/[^A-Z]/g,"")),J()},R=oe(()=>{const k=r.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(k)}),Z=oe(()=>!q.value||q.value.trim()===""),ee=oe(()=>r.plate_number.length>0&&!R.value?"Format plat nomor tidak valid.":null),ae=oe(()=>{const k=!r.plate_number||r.plate_number.trim()==="",h=!q.value||q.value.trim()==="";return k||h||!R.value||F.value}),te=oe(()=>{const k=r.plate_number!==g.value,h=r.car_id!==m.value||q.value!==u.value;return k||h}),se=oe(()=>te.value&&!ae.value),ie=k=>{var le,j,ue;if(!k)return"";const h=[];return(le=k.brand)!=null&&le.name&&h.push(k.brand.name),(j=k.model)!=null&&j.name&&h.push(k.model.name),(ue=k.type)!=null&&ue.name&&h.push(k.type.name),k.cc&&h.push((k.cc/1e3).toFixed(1)),k.transmission&&h.push(k.transmission),k.year&&h.push(k.year.toString()),k.fuel_type&&h.push(k.fuel_type),k.production_period&&h.push(`(${k.production_period})`),h.join(" ")},L=()=>{r.car_id&&(r.car_id=null,O.value=null,V.value=[]),xe()},xe=It.debounce(()=>{if(!q.value.trim()){H.value=[],N.value=!1;return}w.value=!0;try{const k=q.value.toLowerCase().trim();H.value=a.CarDetail.filter(h=>ie(h).toLowerCase().includes(k)),N.value=!0}finally{w.value=!1}},300),he=()=>{setTimeout(()=>{N.value=!1,r.car_name=q.value,G()},200)},d=async k=>{O.value=k,q.value=ie(k),r.car_id=k.id,r.car_name=ie(k),N.value=!1,await f(k.id),G(),y("update:hasUnsavedChanges",te.value),y("update:validation",ae.value)},S=k=>!k||!k.file_path?"":`/storage/${k.file_path}`,f=async k=>{try{const h=await fetch(`/api/cars/${k}/images`);if(h.ok){const le=await h.json();V.value=Array.isArray(le)?le:[]}else V.value=[]}catch(h){console.error("Error loading car images:",h),V.value=[]}},T=k=>{z.value=k,D.value=!0,document.body.style.overflow="hidden"},U=()=>{D.value=!1,document.body.style.overflow=""},Q=()=>{z.value=(z.value+1)%V.value.length},Y=()=>{z.value=(z.value-1+V.value.length)%V.value.length},X=k=>{if(D.value)switch(k.key){case"Escape":U();break;case"ArrowRight":Q();break;case"ArrowLeft":Y();break}},G=()=>{const k={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name};y("update-vehicle",k)},re=()=>{a.inspection&&r.post(route("inspections.updateVehicleDetails",{inspection:a.inspection.id}),{preserveScroll:!0,onSuccess:()=>{g.value=r.plate_number,m.value=r.car_id,u.value=r.car_name,y("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:k=>{console.error("Gagal menyimpan data:",k)}})};return pe([()=>r.plate_number,()=>r.car_name],k=>{B.value="",F.value=!1,K.value="";const h=k[0];if(h&&h.length>=6){const le=a.allInspections.filter(j=>{var ue;return j.plate_number===h&&j.id!==((ue=a.inspection)==null?void 0:ue.id)});if(le.length>0){const j=["draft","in_progress","pending","pending_review","revision"],ue=le.find(me=>j.includes(me.status));if(ue)F.value=!0,B.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${ue.status.replace(/_/g," ").toUpperCase()}.`;else{const me=le.filter(ve=>["approved","rejected","completed","cancelled"].includes(ve.status));if(me.length>0){me.sort((ce,Me)=>new Date(Me.created_at)-new Date(ce.created_at));const ve=me[0];if(ve.car_id){const ce=a.CarDetail.find(Me=>Me.id===ve.car_id);ce&&d(ce)}else ve.car_name&&(q.value=ve.car_name,r.car_name=ve.car_name,r.car_id=null);K.value=`Nomor plat ini sudah pernah diperiksa ${me.length} kali sebelumnya.`}}}}y("update:hasUnsavedChanges",te.value),y("update:validation",ae.value)},{deep:!0}),pe([()=>E.value.rear_door,()=>b.value],()=>{n()}),(k,h)=>{var le;return s(),o("div",Dt,[h[27]||(h[27]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),t.inspection?(s(),o("div",Bt,[e("div",Lt,[h[11]||(h[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),e("div",jt,[$e(e("input",{"onUpdate:modelValue":h[0]||(h[0]=j=>i.value=j),type:"text",placeholder:"Contoh: B",class:ne(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!R.value||F.value}]),onInput:h[1]||(h[1]=j=>M("area")),maxlength:"2"},null,34),[[Re,i.value]]),$e(e("input",{"onUpdate:modelValue":h[2]||(h[2]=j=>x.value=j),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:ne(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!R.value||F.value}]),onInput:h[3]||(h[3]=j=>M("number")),maxlength:"4"},null,34),[[Re,x.value]]),$e(e("input",{"onUpdate:modelValue":h[4]||(h[4]=j=>I.value=j),type:"text",placeholder:"ABC",class:ne(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!R.value||F.value}]),onInput:h[5]||(h[5]=j=>M("suffix")),maxlength:"3"},null,34),[[Re,I.value]])]),ee.value?(s(),o("span",Ot,C(ee.value),1)):l("",!0),B.value?(s(),o("span",Ft,C(B.value),1)):l("",!0),K.value?(s(),o("span",qt,C(K.value),1)):l("",!0)]),e("div",Ht,[h[15]||(h[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Jenis Kendaraan ",-1)),e("div",Kt,[e("div",{class:ne(["w-full px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":E.value.rear_door,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":!E.value.rear_door}]),onClick:A},h[12]||(h[12]=[e("span",null,"Pintu Belakang",-1)]),2),e("div",Gt,[e("div",{class:ne(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":b.value==="pick_up","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":b.value!=="pick_up"}]),onClick:h[6]||(h[6]=j=>p("pick_up"))}," Pick Up ",2),e("div",{class:ne(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":b.value==="box","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":b.value!=="box"}]),onClick:h[7]||(h[7]=j=>p("box"))}," Box ",2)])]),e("div",zt,[e("div",Wt,[h[14]||(h[14]=e("svg",{class:"w-4 h-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),e("div",Zt,[h[13]||(h[13]=e("p",{class:"font-medium"},"Status Kendaraan:",-1)),e("p",Jt,[E.value.rear_door?(s(),o("span",Yt," ✓ Mobil Pada Umum nya yang memiliki Pintu Belakang ")):l("",!0),b.value==="pick_up"?(s(),o("span",Xt," ✓ Pick Up ")):l("",!0),b.value==="box"?(s(),o("span",Qt," ✓ Box ")):l("",!0),!E.value.rear_door&&!b.value?(s(),o("span",ea," Pilih jenis kendaraan agar point bisa menyesuaikan dengan tipe kendaraan anda ")):l("",!0)])])])])]),e("div",ta,[h[19]||(h[19]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",aa,[$e(e("input",{"onUpdate:modelValue":h[8]||(h[8]=j=>q.value=j),type:"text",placeholder:"Cari atau ketik nama mobil...",class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":Z.value}]),onInput:L,onFocus:h[9]||(h[9]=j=>N.value=!0),onBlur:he},null,34),[[Re,q.value]]),w.value?(s(),o("div",na,h[16]||(h[16]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):l("",!0),Z.value?(s(),o("span",sa,"Nama mobil tidak boleh kosong.")):l("",!0),!Ee(r).car_id&&q.value?(s(),o("div",oa,h[17]||(h[17]=[Et('<div class="flex items-start" data-v-93565d5f><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-93565d5f><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-93565d5f></path></svg><div data-v-93565d5f><p class="text-yellow-800 font-medium mb-1" data-v-93565d5f>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-93565d5f> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-93565d5f>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-93565d5f> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-93565d5f> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-93565d5f>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-93565d5f>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):l("",!0),N.value?(s(),o("div",ia,[H.value.length>0?(s(),o("div",la,[(s(!0),o(ye,null,ke(H.value,j=>(s(),o("div",{key:j.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:ue=>d(j)},[e("div",da,C(ie(j)),1),e("div",ua,C(j.year)+" • "+C(j.cc)+"cc • "+C(j.transmission)+" • "+C(j.fuel_type),1)],40,ra))),128))])):(s(),o("div",ca,h[18]||(h[18]=[fe(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),fe(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):l("",!0)])]),Ee(r).car_id&&O.value?(s(),o("div",pa,[O.value.description?(s(),o("div",ga,[h[20]||(h[20]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:O.value.description},null,8,ma)])):l("",!0),V.value.length>0?(s(),o("div",va,[h[21]||(h[21]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",fa,[(s(!0),o(ye,null,ke(V.value,(j,ue)=>(s(),o("div",{key:j.id||ue,class:"relative group cursor-pointer",onClick:me=>T(ue)},[e("img",{src:S(j),alt:j.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ba),j.note?(s(),o("div",ya,[e("p",xa,C(j.note),1)])):l("",!0)],8,ha))),128))])])):(s(),o("div",wa," Tidak ada gambar tersedia untuk mobil ini "))])):l("",!0),D.value?(s(),o("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:U},[e("div",ka,[e("button",{onClick:U,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},h[22]||(h[22]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),V.value.length>1?(s(),o("button",{key:0,onClick:Pe(Y,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},h[23]||(h[23]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):l("",!0),V.value.length>1?(s(),o("button",{key:1,onClick:Pe(Q,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},h[24]||(h[24]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):l("",!0),e("img",{src:S(V.value[z.value]),alt:"Car Image "+(z.value+1),class:"max-w-full max-h-full object-contain",onClick:h[10]||(h[10]=Pe(()=>{},["stop"]))},null,8,Ia),V.value.length>1?(s(),o("div",_a,C(z.value+1)+" / "+C(V.value.length),1)):l("",!0),(le=V.value[z.value])!=null&&le.note?(s(),o("div",Aa,C(V.value[z.value].note),1)):l("",!0)])])):l("",!0),be(Ut,{type:"button",onClick:re,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!se.value},{default:Te(()=>[Ee(r).processing?(s(),o("svg",Sa,h[25]||(h[25]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):l("",!0),e("span",null,C(Ee(r).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),be(Pt,{on:Ee(r).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:Te(()=>h[26]||(h[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),fe(" Tersimpan. ")])),_:1,__:[26]},8,["on"])]),_:1},8,["disabled"])])):l("",!0)])}}},Ti=Ne($a,[["__scopeId","data-v-93565d5f"]]),Ta={class:"mt-1"},Na=["value","required","minlength","maxlength","allowSpace","placeholder"],Ca={key:0,class:"mt-2 text-sm text-red-600"},_t={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:W}){const a=t,y=W,r=oe(()=>{if(!a.modelValue)return"";let m=a.modelValue;switch(a.allowSpace||(m=m.replace(/\s+/g,"")),a.textTransform){case"uppercase":return m.toUpperCase();case"lowercase":return m.toLowerCase();case"capitalize":return m.replace(/\b\w/g,u=>u.toUpperCase());default:return m}}),g=m=>{let u=m.target.value;switch(a.allowSpace||(u=u.replace(/\s+/g,"")),a.textTransform){case"uppercase":u=u.toUpperCase();break;case"lowercase":u=u.toLowerCase();break;case"capitalize":u=u.replace(/\b\w/g,i=>i.toUpperCase());break}y("update:modelValue",u),y("save",a.pointId)};return(m,u)=>(s(),o("div",Ta,[e("input",{value:r.value,onInput:g,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,Na),t.error?(s(),o("p",Ca,C(t.error),1)):l("",!0)]))}},Ea={class:"mt-1"},Va=["value","required","min","max","step","placeholder"],Ma={key:0,class:"mt-2 text-sm text-red-600"},At={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:W}){const a=t,y=W,r=g=>{const m=g.target.value;y("update:modelValue",m),y("save",a.pointId)};return(g,m)=>(s(),o("div",Ea,[e("input",{value:t.modelValue,onInput:r,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Va),t.error?(s(),o("p",Ma,C(t.error),1)):l("",!0)]))}},Ra={class:"mt-1"},Ua=["value","required","min","max"],Pa={key:0,class:"mt-2 text-sm text-red-600"},St={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:W}){const a=t,y=W,r=g=>{y("update:modelValue",g.target.value),y("save",a.pointId)};return(g,m)=>(s(),o("div",Ra,[e("input",{value:t.modelValue,onChange:r,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ua),t.error?(s(),o("p",Pa,C(t.error),1)):l("",!0)]))}},Da={class:"mt-1"},Ba=["value","required","placeholder"],La={key:0,class:"mt-2 text-sm text-red-600"},$t={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:W}){const a=t,y=W,r=_(""),g=oe(()=>{var I,b,E,F;return{currency_symbol:((I=a.settings)==null?void 0:I.currency_symbol)||"Rp",thousands_separator:((b=a.settings)==null?void 0:b.thousands_separator)||",",min_value:((E=a.settings)==null?void 0:E.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((F=a.settings)==null?void 0:F.max_value)!==void 0?Number(a.settings.max_value):1e9}}),m=I=>{if(I==null||I==="")return"";const b=Number(I);if(isNaN(b))return"";let E=b.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return g.value.thousands_separator!==","&&(E=E.replace(/,/g,g.value.thousands_separator)),E},u=I=>I?I.replace(/[^\d]/g,""):"",i=oe(()=>r.value?`${g.value.currency_symbol} ${m(r.value)}`:""),x=I=>{let b=u(I.target.value),E=Number(b);g.value.min_value!==void 0&&E<g.value.min_value&&(b=g.value.min_value.toString()),g.value.max_value!==void 0&&E>g.value.max_value&&(b=g.value.max_value.toString()),r.value=b,y("update:modelValue",b),y("save",a.pointId)};return pe(()=>a.modelValue,I=>{I!=null&&(r.value=I.toString())},{immediate:!0}),(I,b)=>(s(),o("div",Da,[e("input",{value:i.value,onInput:x,type:"text",required:t.required,placeholder:t.placeholder,class:ne(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,Ba),t.error?(s(),o("p",La,C(t.error),1)):l("",!0)]))}},ja={class:"mt-1 space-y-3"},Oa={key:0,class:"space-y-2"},Fa={class:"flex flex-wrap gap-2"},qa=["onClick"],Ha=["value","required","minlength","maxlength","placeholder"],Ka={class:"flex justify-between items-center mt-1"},Ga={class:"text-xs text-gray-500"},za={key:0,class:"text-xs text-red-600"},Tt={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:W}){const a=t,y=W,r=_([]),g=_(""),m=I=>r.value.some(b=>b.value===I),u=I=>{m(I.value)?r.value=r.value.filter(B=>B.value!==I.value):r.value.push(I);const E=[...r.value.map(B=>B.value)];g.value.trim()&&E.push(g.value.trim());const F=E.join(", ");y("update:modelValue",F),y("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:F})},i=I=>{const b=I.target.value;y("update:modelValue",b),y("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:b}),x(b)},x=I=>{var B,K,q,N;if(!I){r.value=[],g.value="";return}const b=I.split(",").map(w=>w.trim()).filter(w=>w),E=((K=(B=a.settings)==null?void 0:B.damage_options)==null?void 0:K.map(w=>w.value))||[];r.value=((N=(q=a.settings)==null?void 0:q.damage_options)==null?void 0:N.filter(w=>b.includes(w.value)))||[];const F=b.filter(w=>!E.includes(w));g.value=F.join(", ")};return pe(()=>a.modelValue,I=>{I!=null&&x(I)},{immediate:!0}),(I,b)=>{var E,F,B;return s(),o("div",ja,[(E=t.settings)!=null&&E.enable_damage&&((F=t.settings)!=null&&F.damage_options)?(s(),o("div",Oa,[b[0]||(b[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",Fa,[(s(!0),o(ye,null,ke(t.settings.damage_options,(K,q)=>(s(),o("button",{key:q,type:"button",onClick:N=>u(K),class:ne(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":m(K.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!m(K.value)}])},C(K.label),11,qa))),128))])])):l("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:i,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Ha),e("div",Ka,[e("span",Ga,C(((B=t.modelValue)==null?void 0:B.length)||0)+"/"+C(t.maxLength||400),1),t.error?(s(),o("p",za,C(t.error),1)):l("",!0)])])])}}},Wa={class:"mt-1"},Za=["value","required"],Ja={key:0,class:"mt-2 text-sm text-red-600"},Ya={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:W}){const a=t,y=W,r=g=>{y("update:modelValue",g.target.value),y("save",a.pointId)};return(g,m)=>(s(),o("div",Wa,[e("select",{value:t.modelValue,onChange:r,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},m[0]||(m[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Za),t.error?(s(),o("p",Ja,C(t.error),1)):l("",!0)]))}},Xa=Ne(Ya,[["__scopeId","data-v-1b6c0201"]]),Qa={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},en={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},tn={class:"text-xs text-gray-500 mt-2 text-center"},an={class:"flex flex-row space-x-4 mb-6"},nn={class:"mt-4 text-right"},sn={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(W,a)=>t.show?(s(),o("div",Qa,[e("div",en,[a[7]||(a[7]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),e("p",tn,[a[3]||(a[3]=fe("Ambil Foto Maksimal: ")),e("b",null,C(t.settings.max_files),1),a[4]||(a[4]=fe(" Dengan Rasio & Ukuran: ")),e("b",null,C(t.settings.camera_aspect_ratio),1)]),e("div",an,[e("button",{onClick:a[0]||(a[0]=y=>W.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[5]||(a[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:a[1]||(a[1]=y=>W.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[6]||(a[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",nn,[e("button",{onClick:a[2]||(a[2]=y=>W.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):l("",!0)}},on={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},ln={class:"webcam-content-box"},rn={class:"webcam-header"},dn={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},un={class:"inspection-point-name"},cn={key:0,class:"screen-flash-overlay"},pn={key:2,class:"zoom-controls"},gn=["max"],mn={class:"webcam-footer"},vn={class:"camera-controls"},fn=["disabled"],hn={class:"camera-icon-container"},bn={key:0,class:"camera-spinner"},yn={key:1,class:"camera-body"},xn={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:W}){const a=t,y=W,r=_(null),g=_(null);let m=null,u=null;const i=_("environment"),x=_(!1),I=_(!1),b=_(!1),E=_(!1),F=_(!1),B=_({}),K=_(!1),q=_(1),N=_(1),w=_(!1),H=oe(()=>{var M;return((M=a.settings)==null?void 0:M.max_size)||2048}),O=oe(()=>a.aspectRatio?{aspectRatio:`${a.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),V=oe(()=>{if(!a.aspectRatio)return{};const M=a.aspectRatio,R=M>1?80:60,Z=M>1?80/M:60*M;return{width:`${R}%`,height:`${Z}%`}}),D=async()=>{m&&m.getTracks().forEach(M=>M.stop());try{const M={facingMode:i.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};m=await navigator.mediaDevices.getUserMedia({video:M,audio:!1}),u=m.getVideoTracks()[0],r.value.srcObject=m,r.value.onloadedmetadata=async()=>{await ge(),await r.value.play()}}catch(M){console.error("Error accessing camera: ",M),alert("Failed to access camera. Please allow camera permission."),y("close")}},z=()=>{m&&m.getTracks().forEach(M=>M.stop()),y("close")},ge=async()=>{if(u)try{const M=await navigator.mediaDevices.enumerateDevices();x.value=M.filter(Z=>Z.kind==="videoinput").length>1;const R=u.getCapabilities();R.zoom?(w.value=!0,N.value=R.zoom.max,console.log(`Zoom supported. Max zoom: ${N.value}`)):(w.value=!1,console.warn("Zoom is not supported by this camera.")),I.value=R.torch||R.fillLightMode&&R.fillLightMode.includes("torch")}catch(M){console.error("Error checking camera capabilities:",M)}},A=async M=>{if(!u)return;const R=r.value.getBoundingClientRect(),Z=M.clientX-R.left,ee=M.clientY-R.top;F.value=!0,B.value={left:`${Z}px`,top:`${ee}px`,transform:"translate(-50%, -50%)"};try{if(u.getCapabilities().pointsOfInterest){const te=Z/R.width,se=ee/R.height;await u.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:te,y:se}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(ae){console.warn("Manual focus failed:",ae)}setTimeout(()=>{F.value=!1,u.getCapabilities().focusMode.includes("continuous")&&u.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},p=async M=>{if(!u||!w.value)return;const R=Math.min(Math.max(M,1),N.value);q.value=R;try{await u.applyConstraints({advanced:[{zoom:R}]})}catch(Z){console.error("Failed to set zoom:",Z)}},n=async()=>{if(!(!u||!I.value))try{i.value==="user"?(b.value=!b.value,E.value=b.value):(await u.applyConstraints({advanced:[{torch:!b.value}]}),b.value=!b.value)}catch(M){console.error("Flash toggle failed:",M)}},c=async()=>{x.value&&(i.value=i.value==="environment"?"user":"environment",m&&m.getTracks().forEach(M=>M.stop()),await D())},$=async M=>new Promise(R=>{const Z=H.value*1024;if(M.size<=Z){R(M);return}const ee=new Image,ae=new FileReader;ae.onload=te=>{ee.onload=()=>{const se=document.createElement("canvas"),ie=se.getContext("2d"),L=Math.sqrt(Z/M.size);se.width=ee.width*L,se.height=ee.height*L,ie.drawImage(ee,0,0,se.width,se.height);let xe=.9;const he=()=>{se.toBlob(d=>{d.size>Z&&xe>.1?(xe-=.1,he()):R(d)},"image/jpeg",xe)};he()},ee.src=te.target.result},ae.readAsDataURL(M)}),J=async()=>{if(!(K.value||!r.value||!g.value)){K.value=!0;try{const M=r.value,R=g.value,Z=M.videoWidth,ee=M.videoHeight;let ae,te,se,ie;Z/ee>a.aspectRatio?(te=ee,ae=ee*a.aspectRatio,se=(Z-ae)/2,ie=0):(ae=Z,te=Z/a.aspectRatio,se=0,ie=(ee-te)/2),R.width=ae,R.height=te,R.getContext("2d").drawImage(M,se,ie,ae,te,0,0,ae,te);const xe=await new Promise(d=>{R.toBlob(d,"image/jpeg",1)}),he=await $(xe);if(he){const d=new File([he],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});y("photoCaptured",d),E.value=!0,setTimeout(()=>{E.value=!1},100)}}catch(M){console.error("Error capturing photo:",M),alert("Failed to capture photo. Please try again.")}finally{K.value=!1}}};return pe(()=>a.show,M=>{M?D():z()}),Be(()=>{m&&m.getTracks().forEach(M=>M.stop())}),(M,R)=>{var Z;return t.show?(s(),o("div",on,[e("div",ln,[e("div",rn,[e("p",dn,C(t.settings.camera_aspect_ratio),1),e("div",un,C(((Z=t.point)==null?void 0:Z.name)||"Camera"),1),e("button",{onClick:z,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},R[2]||(R[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:Ve(O.value),onClick:A,onTouchstart:A},[e("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:g,class:"hidden"},null,512),E.value?(s(),o("div",cn)):l("",!0),e("div",{class:"aspect-ratio-guide",style:Ve(V.value)},null,4),F.value?(s(),o("div",{key:1,class:"focus-indicator",style:Ve(B.value)},R[3]||(R[3]=[e("div",{class:"focus-ring"},null,-1)]),4)):l("",!0),R[4]||(R[4]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),w.value?(s(),o("div",pn,[$e(e("input",{type:"range",min:"1",max:N.value,step:"0.1","onUpdate:modelValue":R[0]||(R[0]=ee=>q.value=ee),onInput:R[1]||(R[1]=ee=>p(parseFloat(ee.target.value))),class:"zoom-slider"},null,40,gn),[[Re,q.value]])])):l("",!0)],36),e("div",mn,[e("div",vn,[t.settings.enable_flash&&I.value?(s(),o("button",{key:0,onClick:n,class:ne(["control-button",{active:b.value,disabled:!I.value}])},R[5]||(R[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):l("",!0),e("button",{onClick:J,class:"capture-button",disabled:K.value},[e("div",hn,[K.value?(s(),o("div",bn)):(s(),o("div",yn,R[6]||(R[6]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,fn),t.settings.enable_camera_switch&&x.value?(s(),o("button",{key:1,onClick:c,class:"control-button"},R[7]||(R[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):l("",!0)])])])])):l("",!0)}}},wn=Ne(xn,[["__scopeId","data-v-d307c818"]]),kn={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},In={class:"w-full h-full flex flex-col"},_n={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},An=["disabled"],Sn={class:"text-lg font-semibold"},$n={class:"flex items-center gap-2"},Tn=["disabled"],Nn=["disabled"],Cn={key:0,class:"bg-blue-900 bg-opacity-50 text-white p-3"},En={class:"flex items-center justify-between mb-2"},Vn={class:"text-xs"},Mn={class:"w-full bg-blue-700 bg-opacity-50 rounded-full h-2"},Rn={class:"text-xs mt-1 text-blue-300"},Un={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Pn=["src"],Dn={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Bn={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},Ln=["disabled"],jn=["disabled"],On=["disabled"],Fn={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},qn={class:"flex justify-between items-center w-full"},Hn=["disabled"],Kn={key:1,class:"flex-1"},Gn=["disabled"],zn={class:"flex gap-3 w-full"},Wn={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},Zn={class:"flex items-center gap-2"},Jn={key:0,class:"text-center"},Yn={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images","retryImage"],setup(t,{emit:W}){const a=t,y=W,r=_(0),g=_([]),m=oe(()=>g.value.length>0?g.value[r.value]:null);pe(()=>a.images,N=>{g.value=N.map(w=>({...w,rotation:w.rotation||0})),N.length===0&&a.show&&E()},{deep:!0,immediate:!0}),pe(()=>a.show,N=>{N&&a.images.length>0&&(r.value=a.initialIndex)}),pe(()=>a.uploadProgress,N=>{N===100&&console.log("Upload completed")});const u=N=>N.preview||(N.image_path?`/${N.image_path}`:""),i=()=>{if(m.value&&!a.isUploading){const N=(m.value.rotation+90)%360;g.value[r.value].rotation=N,y("update:images",g.value)}},x=()=>{a.isUploading||(r.value=r.value<g.value.length-1?r.value+1:0)},I=()=>{a.isUploading||(r.value=r.value>0?r.value-1:g.value.length-1)},b=()=>{a.isUploading||y("saveImages",g.value)},E=()=>{a.isUploading||y("close")},F=()=>{if(m.value&&!a.isUploading){const N=m.value,w=g.value.findIndex(H=>H.isNew&&N.isNew&&H.preview===N.preview||!H.isNew&&!N.isNew&&H.id===N.id);w!==-1&&(y("removePreviewImage",N),g.value.splice(w,1),y("update:images",g.value)),r.value>=g.value.length&&(r.value=Math.max(0,g.value.length-1)),g.value.length===0&&y("close")}},B=()=>{a.isUploading||y("triggerAddMorePhotos")},K=()=>{m.value&&!a.isUploading&&y("retryImage",m.value)},q=N=>{N.key==="Escape"&&!a.isUploading&&E()};return Ue(()=>{document.addEventListener("keydown",q)}),Be(()=>{document.removeEventListener("keydown",q)}),(N,w)=>{var H;return t.show?(s(),o("div",kn,[e("div",In,[e("div",_n,[e("button",{onClick:E,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},w[0]||(w[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,An),e("div",Sn,C(((H=t.point)==null?void 0:H.name)||"Preview")+" ("+C(r.value+1)+"/"+C(g.value.length)+") ",1),e("div",$n,[m.value&&m.value.isNew?(s(),o("button",{key:0,onClick:F,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:t.isUploading},w[1]||(w[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,Tn)):l("",!0),m.value&&m.value.isNew?(s(),o("button",{key:1,onClick:i,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},w[2]||(w[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,Nn)):l("",!0)])]),t.isUploading?(s(),o("div",Cn,[e("div",En,[w[3]||(w[3]=e("span",{class:"text-sm font-medium"},"Mengupload gambar...",-1)),e("span",Vn,C(t.uploadProgress)+"%",1)]),e("div",Mn,[e("div",{class:"bg-blue-400 h-2 rounded-full transition-all duration-300",style:Ve({width:t.uploadProgress+"%"})},null,4)]),e("p",Rn,C(t.currentUpload)+"/"+C(t.totalUpload)+" gambar terupload",1)])):l("",!0),e("div",Un,[e("div",{class:"relative w-full max-w-full",style:Ve({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"})},[m.value?(s(),o("img",{key:0,src:u(m.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Ve({transform:`rotate(${m.value.rotation}deg)`})},null,12,Pn)):l("",!0),m.value&&m.value.isUploading?(s(),o("div",Dn,w[4]||(w[4]=[e("div",{class:"text-center text-white"},[e("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e("p",{class:"text-sm"},"Mengupload...")],-1)]))):l("",!0),m.value&&m.value.isFailed?(s(),o("div",Bn,[w[5]||(w[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),w[6]||(w[6]=e("p",{class:"text-lg font-medium mb-2"},"Upload Gagal",-1)),e("button",{onClick:K,class:"px-4 py-2 bg-white text-red-600 rounded-lg font-medium hover:bg-gray-100 transition-colors",disabled:t.isUploading}," Coba Lagi ",8,Ln)])):l("",!0)],4),g.value.length>1&&!t.isUploading?(s(),o("button",{key:0,onClick:I,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},w[7]||(w[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,jn)):l("",!0),g.value.length>1&&!t.isUploading?(s(),o("button",{key:1,onClick:x,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},w[8]||(w[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,On)):l("",!0)]),e("div",Fn,[e("div",qn,[m.value&&!m.value.isNew?(s(),o("button",{key:0,onClick:F,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},w[9]||(w[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),fe(" Hapus Foto ")]),8,Hn)):(s(),o("div",Kn)),t.allowMultiple&&g.value.length<t.maxFiles&&!t.isUploading?(s(),o("button",{key:2,onClick:B,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},w[10]||(w[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),fe(" Tambah Foto ")]),8,Gn)):l("",!0)]),e("div",zn,[t.isUploading?(s(),o("button",Wn,[e("div",Zn,[w[11]||(w[11]=e("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),e("span",null,"Mengupload... "+C(t.uploadProgress)+"%",1)])])):(s(),o("button",{key:0,onClick:b,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),t.isUploading?(s(),o("div",Jn,w[12]||(w[12]=[e("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):l("",!0)])])])):l("",!0)}}},Xn=Ne(Yn,[["__scopeId","data-v-581782f4"]]),Qn=["accept","multiple","disabled"],es={class:"text-xs text-gray-500 mb-2"},ts=["disabled"],as={class:"h-full flex flex-col items-center justify-center p-4 text-center"},ns={class:"text-xs text-gray-400 mt-1"},ss={key:0,class:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},os={class:"flex items-center justify-between mb-2"},is={class:"text-xs text-blue-600"},ls={class:"w-full bg-blue-200 rounded-full h-2"},rs={class:"text-xs text-blue-600 mt-1"},ds={key:1,class:"flex items-center gap-4"},us=["src"],cs={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},ps=["disabled"],gs={key:2,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ms=["disabled"],vs=["onClick"],fs=["src"],hs={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},bs={key:0},ys={key:1,class:"ml-1"},xs={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},ws={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},ks={key:2,class:"mt-1 text-xs text-red-600"},Is={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(t,{emit:W}){const a=t,y=W,r=_(null),g=_(null),m=_(!1),u=_(!1),i=_(!1),x=_([]),I=_(0),b=_(!1),E=_(0),F=_(0),B=_(0),K=kt("imageSourceSetting",_("all")),q=`inspection-${a.inspectionId}-point-${a.pointId}-backup`,N=oe(()=>Number(a.settings.max_files)>1),w=oe(()=>a.settings.allowed_types.map(d=>`.${d}`).join(", ")),H=oe(()=>{const d=a.settings.camera_aspect_ratio.split(":");if(d.length===2){const S=parseFloat(d[0]),f=parseFloat(d[1]);if(!isNaN(S)&&!isNaN(f)&&f!==0)return S/f}return 3/4}),O=oe(()=>{const d=[],S=new Set;for(const f of a.modelValue)f.id&&S.add(f.id),d.push({...f,rotation:f.rotation||0,isNew:!1,isUploaded:!0,preview:f.preview||(f.image_path?`/${f.image_path}`:null)});for(const f of x.value)f.id&&S.add(f.id),d.push({...f,isUploading:f.isUploading||!1});return d}),V=d=>d.preview||(d.image_path?`/${d.image_path}`:""),D=()=>{i.value&&(i.value=!1),K.value==="camera"?ge():K.value==="gallery"?z():m.value=!0},z=()=>{m.value=!1,r.value.click()},ge=()=>{m.value=!1,u.value=!0},A=()=>{m.value=!1,O.value.length>0&&(i.value=!0)},p=()=>{u.value=!1,O.value.length>0&&(i.value=!0)},n=()=>{i.value=!1,b.value||(x.value.forEach(d=>{d.preview&&d.preview.startsWith("blob:")&&URL.revokeObjectURL(d.preview)}),x.value=[])},c=d=>new Promise(S=>{const f=new FileReader;f.onload=T=>{const U=new Image;U.onload=()=>{S({file:d,preview:URL.createObjectURL(d),rotation:0,width:U.naturalWidth,height:U.naturalHeight,isNew:!0})},U.onerror=()=>{console.error("Failed to load image for dimensions:",d.name),S({file:d,preview:URL.createObjectURL(d),rotation:0,width:0,height:0,isNew:!0})},U.src=T.target.result},f.readAsDataURL(d)}),$=d=>{const S=d.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes(S)},J=async d=>{const f=(a.settings.max_size||2048)*1024;return new Promise(T=>{const U=new Image,Q=new FileReader;Q.onload=Y=>{U.onload=()=>{const X=document.createElement("canvas"),G=X.getContext("2d"),re=Math.max(U.width,U.height);X.width=re,X.height=re,G.fillStyle="white",G.fillRect(0,0,re,re);const de=(re-U.width)/2,we=(re-U.height)/2;G.drawImage(U,de,we,U.width,U.height);let _e=.9;const Ae=()=>{X.toBlob(Se=>{if(Se.size>f&&_e>.1)_e-=.1,Ae();else{const Ce=new File([Se],d.name,{type:"image/jpeg",lastModified:Date.now()});T(Ce)}},"image/jpeg",_e)};Ae()},U.src=Y.target.result},Q.readAsDataURL(d)})},M=async d=>{const S=Array.from(d.target.files);if(!S.length){m.value=!1,O.value.length>0&&(i.value=!0);return}try{const f=S.filter(G=>!$(G));if(f.length>0){const G=f.map(re=>re.name.split(".").pop()).join(", ");alert(`File type not allowed: ${G}. Allowed types: ${a.settings.allowed_types.join(", ")}`),d.target.value="";return}const T=O.value.length,U=a.settings.max_files-T,Q=await Promise.all(S.slice(0,U).map(async G=>await J(G))),Y=await Promise.all(Q.map(c)),X=N.value?Y:Y.slice(0,1);N.value?x.value.push(...X):(x.value.forEach(G=>{G.preview&&G.preview.startsWith("blob:")&&URL.revokeObjectURL(G.preview)}),x.value=X),m.value=!1,X.length>0?(I.value=Math.max(0,O.value.length-X.length),i.value=!0):O.value.length>0&&(i.value=!0),d.target.value=""}catch(f){console.error("Error processing selected images:",f),alert("Failed to process selected images. Please try again."),m.value=!1,O.value.length>0&&(i.value=!0)}},R=async d=>{const S=O.value.length;if(!N.value||S<a.settings.max_files)try{const f=await J(d),T=new Image;T.onload=()=>{const U={file:f,preview:URL.createObjectURL(f),rotation:0,width:T.naturalWidth,height:T.naturalHeight,isNew:!0};N.value?x.value.push(U):(x.value.forEach(Q=>{Q.preview&&Q.preview.startsWith("blob:")&&URL.revokeObjectURL(Q.preview)}),x.value=[U]),u.value=!1,m.value=!1,I.value=O.value.length-1,i.value=!0},T.src=URL.createObjectURL(f)}catch(f){console.error("Error processing captured image:",f),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),u.value=!1,m.value=!1,O.value.length>0&&(i.value=!0)},Z=(d=0)=>{I.value=d,i.value=!0},ee=d=>new Promise(S=>{if(d.rotation===0||!g.value){if(!d.isNew&&!d.file){S({file:null,width:d.width,height:d.height,isOriginal:!0});return}S({file:d.file,width:d.width,height:d.height});return}const f=new Image;f.onload=async()=>{try{const T=g.value,U=T.getContext("2d"),Q=f.width,Y=f.height;let X,G;d.rotation===90||d.rotation===270?(X=Y,G=Q):(X=Q,G=Y),T.width=X,T.height=G,U.clearRect(0,0,T.width,T.height),U.translate(T.width/2,T.height/2),U.rotate(d.rotation*Math.PI/180),U.drawImage(f,-Q/2,-Y/2,Q,Y),U.setTransform(1,0,0,1,0,0);const re=await new Promise(_e=>{T.toBlob(_e,"image/jpeg",.9)}),de=new File([re],d.file?d.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),we=await J(de);S({file:we,width:X,height:G})}catch(T){console.error("Error processing rotated image:",T),S({file:d.file,width:d.width,height:d.height})}},f.onerror=()=>{console.error("Failed to load image for rotation processing:",d.preview),S({file:d.file,width:d.width,height:d.height})},f.src=d.preview}),ae=d=>{try{const S={images:d.map(f=>{var T;return{fileName:((T=f.file)==null?void 0:T.name)||`image-${Date.now()}.jpg`,rotation:f.rotation||0,width:f.width||0,height:f.height||0,timestamp:Date.now()}}),inspectionId:a.inspectionId,pointId:a.pointId};localStorage.setItem(q,JSON.stringify(S))}catch(S){console.error("Error saving backup:",S)}},te=()=>{localStorage.removeItem(q)},se=async d=>{b.value=!0;const S=[],f=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),b.value=!1;return}try{ae(d);for(const T of d){if(!T.isNew&&T.rotation===0&&T.id&&T.image_path){S.push({id:T.id,image_path:T.image_path,width:T.width,height:T.height,rotation:0,preview:T.preview,isUploaded:!0});continue}const{file:U,width:Q,height:Y,isOriginal:X}=await ee(T);if(X&&!T.isNew){S.push({id:T.id,image_path:T.image_path,width:T.width,height:T.height,rotation:T.rotation||0,preview:T.preview,isUploaded:!0});continue}U&&f.push({file:U,width:Q,height:Y,rotation:T.rotation||0,originalImage:T})}n(),f.length>0?await ie(f,S):(y("update:modelValue",S),y("save",a.pointId))}catch(T){console.error("Error during image processing:",T),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{b.value=!1}},ie=async(d,S)=>{B.value=d.length,F.value=0,E.value=0;const f=[...S];let T=0;try{for(let U=0;U<d.length;U++){const Q=d[U],Y=new FormData;Y.append("inspection_id",a.inspectionId),Y.append("point_id",a.pointId),Y.append("images[]",Q.file);const X=x.value.findIndex(G=>{var re;return G.preview===((re=Q.originalImage)==null?void 0:re.preview)});X!==-1&&(x.value[X].isUploading=!0,x.value[X].isFailed=!1);try{const re=(await Le.post(route("inspections.upload-image"),Y,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:de=>{if(de.total){const we=Math.round(de.loaded*100/de.total);E.value=Math.round((U+de.loaded/de.total)/d.length*100),F.value=U+1}}})).data.images;if(re&&re.length>0){const de=re[0];if(f.push({id:de.image_id,image_path:de.path,width:de.width||Q.width||0,height:de.height||Q.height||0,rotation:Q.rotation||0,preview:de.public_url,isUploaded:!0}),X!==-1){const we=x.value.splice(X,1)[0];we.preview&&we.preview.startsWith("blob:")&&URL.revokeObjectURL(we.preview)}T++}}catch(G){console.error(`Error uploading image ${U+1}:`,G),X!==-1&&(x.value[X].isUploading=!1,x.value[X].isFailed=!0)}}T>0&&(y("update:modelValue",f),y("save",a.pointId),y("uploaded",{pointId:a.pointId,images:f,newImagesCount:T})),T===d.length&&te(),console.log(`✅ Successfully uploaded ${T}/${d.length} images`)}catch(U){console.error("Error in upload process:",U),d.forEach(Q=>{const Y=x.value.findIndex(X=>{var G;return X.preview===((G=Q.originalImage)==null?void 0:G.preview)});Y!==-1&&(x.value[Y].isUploading=!1,x.value[Y].isFailed=!0)})}finally{E.value=0,F.value=0,B.value=0,b.value=!1}},L=async d=>{if(!d||!d.file){console.error("No file to retry upload");return}b.value=!0;const S=[...a.modelValue];try{const f=new FormData;f.append("inspection_id",a.inspectionId),f.append("point_id",a.pointId),f.append("images[]",d.file);const T=x.value.findIndex(Y=>Y.preview===d.preview);T!==-1&&(x.value[T].isUploading=!0,x.value[T].isFailed=!1);const Q=(await Le.post(route("inspections.upload-image"),f,{headers:{"Content-Type":"multipart/form-data"}})).data.images;if(Q&&Q.length>0){const Y=Q[0];if(S.push({id:Y.image_id,image_path:Y.path,width:Y.width||d.width||0,height:Y.height||d.height||0,rotation:d.rotation||0,preview:Y.public_url,isUploaded:!0}),T!==-1){const G=x.value.splice(T,1)[0];G.preview&&G.preview.startsWith("blob:")&&URL.revokeObjectURL(G.preview)}y("update:modelValue",S),y("save",a.pointId),y("uploaded",{pointId:a.pointId,images:S,newImagesCount:1}),x.value.some(G=>G.isFailed)||te(),console.log("✅ Successfully retried upload for 1 image")}}catch(f){console.error("Error retrying upload:",f),previewIndex!==-1&&(x.value[previewIndex].isUploading=!1,x.value[previewIndex].isFailed=!0)}finally{b.value=!1}},xe=d=>{if(d){if(d.id&&!d.isNew)he(d);else{const S=x.value.findIndex(f=>f.preview&&f.preview===d.preview&&f.isNew||f.id&&f.id===d.id);if(S!==-1){const f=x.value.splice(S,1)[0];f.preview&&f.preview.startsWith("blob:")&&URL.revokeObjectURL(f.preview)}y("update:modelValue",a.modelValue.filter(f=>!(f.id&&f.id===d.id)&&!(f.preview&&f.preview===d.preview)))}I.value>=O.value.length&&(I.value=Math.max(0,O.value.length-1)),O.value.length===0&&n()}},he=async d=>{var f,T;if(d.id||d.image_path)try{await Le.delete(route("inspections.delete-image"),{data:{image_id:d.id,image_path:d.image_path}})}catch(U){console.error("Error deleting image from server:",U),(T=(f=U.response)==null?void 0:f.data)!=null&&T.message?alert(`Failed to delete image from server: ${U.response.data.message}`):alert(`Failed to delete image from server: ${U.message}`);return}d.preview&&d.preview.startsWith("blob:")&&URL.revokeObjectURL(d.preview);const S=a.modelValue.filter(U=>U.id!==d.id);y("update:modelValue",S),x.value=x.value.filter(U=>U.isNew&&d.isNew?U.preview!==d.preview:U.id!==d.id),y("removeImage",{image:d}),i.value&&O.value.length===0?n():i.value&&I.value>=O.value.length&&(I.value=Math.max(0,O.value.length-1))};return Ue(()=>{try{localStorage.getItem(q)&&console.log("Found backup images, ready for recovery if needed")}catch(d){console.error("Error loading backup:",d)}}),(d,S)=>(s(),o("div",null,[e("input",{ref_key:"galleryInput",ref:r,type:"file",accept:w.value,class:"hidden",onChange:M,multiple:N.value,disabled:b.value},null,40,Qn),e("canvas",{ref_key:"processingCanvas",ref:g,class:"hidden"},null,512),e("p",es,"Foto Maksimal: "+C(t.settings.max_files)+" | Rasio: "+C(t.settings.camera_aspect_ratio),1),O.value.length===0?(s(),o("label",{key:0,onClick:D,class:ne(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:b.value},[e("div",as,[S[2]||(S[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),S[3]||(S[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),e("p",ns,"Tipe: "+C(w.value),1)])],8,ts)):(s(),o("div",{key:1,class:ne(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[b.value?(s(),o("div",ss,[e("div",os,[S[4]||(S[4]=e("span",{class:"text-sm font-medium text-blue-700"},"Mengupload gambar...",-1)),e("span",is,C(E.value)+"%",1)]),e("div",ls,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Ve({width:E.value+"%"})},null,4)]),e("p",rs,C(F.value)+"/"+C(B.value)+" gambar terupload",1)])):l("",!0),t.settings.max_files===1?(s(),o("div",ds,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:S[0]||(S[0]=f=>Z(0))},[e("img",{src:V(O.value[0]),class:"w-full h-full object-cover"},null,8,us),O.value[0].isUploading?(s(),o("div",cs,S[5]||(S[5]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):l("",!0)]),e("button",{onClick:S[1]||(S[1]=Pe(f=>he(O.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:b.value},S[6]||(S[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),fe(" Hapus Foto ")]),8,ps)])):(s(),o("div",gs,[N.value&&O.value.length<t.settings.max_files?(s(),o("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:D,disabled:b.value},S[7]||(S[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,ms)):l("",!0),(s(!0),o(ye,null,ke(O.value,(f,T)=>(s(),o("div",{key:f.id||f.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:U=>f.isFailed?L(f):Z(T)},[e("img",{src:V(f),class:"w-full h-full object-cover"},null,8,fs),f.isNew||f.rotation!==0?(s(),o("div",hs,[f.isNew?(s(),o("span",bs,"BARU")):l("",!0),f.rotation!==0?(s(),o("span",ys,"ROTASI")):l("",!0)])):l("",!0),f.isUploading?(s(),o("div",xs,S[8]||(S[8]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):l("",!0),f.isFailed?(s(),o("div",ws,S[9]||(S[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),e("span",{class:"text-xs font-medium"},"Retry",-1)]))):l("",!0)],8,vs))),128))]))],2)),t.error?(s(),o("p",ks,C(t.error),1)):l("",!0),be(sn,{show:m.value,settings:t.settings,onClose:A,onOpenWebcam:ge,onTriggerGallery:z},null,8,["show","settings"]),be(wn,{show:u.value,"aspect-ratio":H.value,settings:t.settings,point:t.point,onClose:p,onPhotoCaptured:R},null,8,["show","aspect-ratio","settings","point"]),be(Xn,{show:i.value,images:O.value,point:t.point,"initial-index":I.value,"allow-multiple":N.value,"max-files":t.settings.max_files,"is-uploading":b.value,"aspect-ratio":H.value,"upload-progress":E.value,"current-upload":F.value,"total-upload":B.value,onClose:n,onSaveImages:se,onRemovePreviewImage:xe,onTriggerAddMorePhotos:D,onRetryImage:L},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},Oe=Ne(Is,[["__scopeId","data-v-a1838a9b"]]),_s={key:0,class:"fixed inset-0 z-50 overflow-hidden"},As={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Ss={class:"px-4 pb-2 border-b border-gray-200"},$s={class:"text-lg font-semibold text-gray-900"},Ts={key:0,class:"text-sm text-gray-500 mt-1"},Ns={class:"flex-1 overflow-y-auto p-4"},Cs={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Es={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},setup(t){return(W,a)=>(s(),Ie(De,{name:"bottom-sheet"},{default:Te(()=>[t.show?(s(),o("div",_s,[a[1]||(a[1]=e("div",{class:"absolute inset-0 bg-black bg-opacity-50"},null,-1)),e("div",As,[a[0]||(a[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Ss,[e("h3",$s,C(t.title),1),t.subtitle?(s(),o("p",Ts,C(t.subtitle),1)):l("",!0)]),e("div",Ns,[yt(W.$slots,"default",{},void 0,!0)]),W.$slots.footer?(s(),o("div",Cs,[yt(W.$slots,"footer",{},void 0,!0)])):l("",!0)])])):l("",!0)]),_:3}))}},Vs=Ne(Es,[["__scopeId","data-v-fd942535"]]),Ms={class:"space-y-4"},Rs={key:0,class:"mt-2"},Us={key:1,class:"mt-2"},Ps={key:2,class:"mt-2"},Ds={key:3,class:"mt-2"},Bs={key:4,class:"mt-2"},Ls={class:"text-sm font-medium text-gray-700 mb-2"},js={key:0,class:"text-red-500"},Os={key:0,class:"text-xs text-red-500"},Fs=["name","value","checked"],qs={key:6,class:"space-y-2"},Hs={key:0,class:"text-red-500"},Ks={key:1,class:"text-xs text-red-500"},Gs={key:7,class:"mt-4"},zs={class:"text-sm font-medium text-gray-700 mb-2"},Ws={key:0,class:"text-red-500"},Zs={key:0,class:"text-xs text-red-500"},Js={class:"flex gap-2"},Ys=["disabled"],Nt={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(t,{emit:W}){const a=t,y=W,r=u=>y("hapus",u),g=oe(()=>a.options.find(u=>u.value===a.selectedValue)),m=oe(()=>{var i,x,I,b,E,F,B;if(a.point.input_type==="text"&&(!((i=a.notesValue)!=null&&i.trim())||a.point.settings.min_length&&a.notesValue.length<a.point.settings.min_length||a.point.settings.max_length&&a.notesValue.length>a.point.settings.max_length)||a.point.input_type==="number"&&(!((x=a.notesValue)!=null&&x.trim())||a.point.settings.min&&a.notesValue.length<a.point.settings.min||a.point.settings.max&&a.notesValue.length>a.point.settings.max)||a.point.input_type==="account"&&(!((I=a.notesValue)!=null&&I.trim())||a.point.settings.min_value&&a.notesValue.length<a.point.settings.min_value||a.point.settings.max_value&&a.notesValue.length>a.point.settings.max_value)||a.point.input_type==="date"&&(!((b=a.notesValue)!=null&&b.trim())||a.point.settings.min_date&&a.notesValue.length<a.point.settings.min_date||a.point.settings.max_date&&a.notesValue.length>a.point.settings.max_date))return!1;if(a.point.input_type==="imageTOradio"){if(a.imagesValue.length===0)return!1;const K=a.imagesValue.some(N=>N.status==="error"),q=a.imagesValue.some(N=>N.status==="uploading");if(K||q)return!1}if(a.options.length&&!a.selectedValue)return!1;const u=g.value;if(a.showTextarea&&((E=u==null?void 0:u.settings)!=null&&E.show_textarea)&&(!((F=a.notesValue)!=null&&F.trim())||u.settings.min_length&&a.notesValue.length<u.settings.min_length||u.settings.max_length&&a.notesValue.length>u.settings.max_length))return!1;if(a.showImageUpload&&((B=u==null?void 0:u.settings)!=null&&B.show_image_upload)){if(a.imagesValue.length===0||u.settings.max_files&&a.imagesValue.length>u.settings.max_files)return!1;const K=a.imagesValue.some(N=>N.status==="error"),q=a.imagesValue.some(N=>N.status==="uploading");if(K||q)return!1}return!0});return(u,i)=>(s(),Ie(Vs,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:i[18]||(i[18]=x=>u.$emit("close"))},{footer:Te(()=>[t.selectedPoint?(s(),o("button",{key:0,onClick:i[15]||(i[15]=x=>r(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},i[20]||(i[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),fe(" Hapus Data ")]))):l("",!0),e("div",Js,[e("button",{type:"button",onClick:i[16]||(i[16]=x=>u.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:i[17]||(i[17]=x=>u.$emit("save")),disabled:!m.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Ys)])]),default:Te(()=>{var x,I,b,E,F,B,K,q,N,w,H,O,V,D,z,ge,A,p,n,c,$,J,M,R,Z,ee,ae,te,se,ie;return[e("div",Ms,[t.point.input_type==="text"?(s(),o("div",Rs,[be(_t,{"model-value":t.notesValue,required:(x=t.point.settings)==null?void 0:x.is_required,"min-length":(I=t.point.settings)==null?void 0:I.min_length,"max-length":(b=t.point.settings)==null?void 0:b.max_length,allowSpace:(E=t.point.settings)==null?void 0:E.allow_space,textTransform:(F=t.point.settings)==null?void 0:F.text_transform,placeholder:((B=t.point.settings)==null?void 0:B.placeholder)||"Masukan text",error:u.error,"onUpdate:modelValue":i[0]||(i[0]=L=>u.$emit("update:notesValue",L)),onSave:i[1]||(i[1]=L=>u.$emit("saveText",L))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):l("",!0),t.point.input_type==="number"?(s(),o("div",Us,[be(At,{"model-value":t.notesValue,required:(K=t.point.settings)==null?void 0:K.is_required,min:(q=t.point.settings)==null?void 0:q.min,max:(N=t.point.settings)==null?void 0:N.max,step:((w=t.point.settings)==null?void 0:w.step)||1,placeholder:((H=t.point.settings)==null?void 0:H.placeholder)||"Masukan number",error:u.error,"onUpdate:modelValue":i[2]||(i[2]=L=>u.$emit("update:notesValue",L)),onSave:i[3]||(i[3]=L=>u.$emit("saveNumber",L))},null,8,["model-value","required","min","max","step","placeholder","error"])])):l("",!0),t.point.input_type==="account"?(s(),o("div",Ps,[be($t,{"model-value":t.notesValue,required:(O=t.point.settings)==null?void 0:O.is_required,placeholder:((V=t.point.settings)==null?void 0:V.placeholder)||"Masukkan nilai",error:u.error,"point-id":t.pointId,settings:t.point.settings,"onUpdate:modelValue":i[4]||(i[4]=L=>u.$emit("update:notesValue",L)),onSave:i[5]||(i[5]=L=>u.$emit("saveAccount",L))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):l("",!0),t.point.input_type==="date"?(s(),o("div",Ds,[be(St,{"model-value":t.notesValue,required:(D=t.point.settings)==null?void 0:D.is_required,"min-date":(z=t.point.settings)==null?void 0:z.min_date,"max-date":(ge=t.point.settings)==null?void 0:ge.max_date,error:u.error,"onUpdate:modelValue":i[6]||(i[6]=L=>u.$emit("update:notesValue",L)),onSave:i[7]||(i[7]=L=>u.$emit("saveDate",L))},null,8,["model-value","required","min-date","max-date","error"])])):l("",!0),t.point.input_type==="imageTOradio"?(s(),o("div",Bs,[e("h4",Ls,[(A=t.point.settings)!=null&&A.required?(s(),o("span",js,"*")):l("",!0)]),be(Oe,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point.inspection_point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":i[8]||(i[8]=L=>u.$emit("update:imagesValue",L)),onSave:i[9]||(i[9]=L=>u.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(p=t.point.settings)!=null&&p.required&&t.imagesValue.length===0?(s(),o("p",Os," Foto wajib diupload ")):l("",!0)])):l("",!0),t.options.length?(s(),o("div",{key:5,class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(s(!0),o(ye,null,ke(t.options,(L,xe)=>(s(),o("label",{key:xe,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:L.value,checked:t.selectedValue===L.value,onChange:i[10]||(i[10]=he=>u.$emit("update:selectedValue",he.target.value)),class:"hidden peer"},null,40,Fs),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==L.value}])},C(L.label),3)]))),128))],2)):l("",!0),t.showTextarea&&((c=(n=g.value)==null?void 0:n.settings)!=null&&c.show_textarea)?(s(),o("div",qs,[($=g.value.settings)!=null&&$.required?(s(),o("span",Hs,"*")):l("",!0),be(Tt,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:g.value.settings,required:(J=g.value.settings)==null?void 0:J.required,"min-length":(M=g.value.settings)==null?void 0:M.min_length,"max-length":(R=g.value.settings)==null?void 0:R.max_length,placeholder:((Z=g.value.settings)==null?void 0:Z.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":i[11]||(i[11]=L=>u.$emit("update:notesValue",L)),onSave:i[12]||(i[12]=L=>u.$emit("saveTextarea",L))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(ee=g.value.settings)!=null&&ee.required&&!t.notesValue?(s(),o("p",Ks," Keterangan wajib diisi ")):l("",!0)])):l("",!0),t.showImageUpload&&((te=(ae=g.value)==null?void 0:ae.settings)!=null&&te.show_image_upload)?(s(),o("div",Gs,[e("h4",zs,[i[19]||(i[19]=fe(" Upload Foto ")),(se=g.value.settings)!=null&&se.required?(s(),o("span",Ws,"*")):l("",!0)]),be(Oe,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:g.value.settings,"onUpdate:modelValue":i[13]||(i[13]=L=>u.$emit("update:imagesValue",L)),onSave:i[14]||(i[14]=L=>u.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(ie=g.value.settings)!=null&&ie.required&&t.imagesValue.length===0?(s(),o("p",Zs," Foto wajib diupload ")):l("",!0)])):l("",!0)])]}),_:1},8,["show","title","subtitle"]))}},Xs={class:"mt-2 space-y-2"},Qs=["name","value","checked","onChange","required"],eo={key:0,class:"p-2 rounded-lg bg-gray-50"},to={key:0,class:"mt-2"},ao={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},no=["src"],so={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},oo={key:1,class:"mt-2"},io={class:"text-sm text-gray-600"},lo={key:2,class:"mt-2 text-sm text-red-600"},ro={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:W}){const a=t,y=W,r=_(a.notes),g=_([...a.images]),m=_(!1),u=_(""),i=_([]),x=_(""),I=_([]),b=oe(()=>a.options.find(V=>V.value===a.modelValue)),E=V=>V.settings&&(V.settings.show_textarea||V.settings.show_image_upload);pe(()=>a.notes,V=>{r.value=V}),pe(()=>a.images,V=>{g.value=[...V]}),pe(()=>a.modelValue,V=>{V&&(x.value=V)});const F=V=>{y("update:modelValue",V.value),E(V)?K():y("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:V.value,notes:"",images:[]})},B=V=>V.preview||(V.image_path?`/${V.image_path}`:V),K=()=>{x.value=a.modelValue,u.value=r.value,i.value=[...g.value],I.value=[...g.value],m.value=!0},q=()=>{u.value="",i.value=[],x.value="",m.value=!1},N=V=>{i.value=V,g.value=[...V],y("update:images",[...V]),y("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:r.value,images:[...V]})},w=V=>{},H=()=>{x.value!==a.modelValue&&y("update:modelValue",x.value),r.value=u.value,y("update:notes",u.value),g.value=[...i.value],y("update:images",[...i.value]),y("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:x.value,notes:u.value,images:i.value}),m.value=!1},O=V=>{x.value="",u.value="",i.value=[],r.value="",g.value=[],y("update:modelValue",""),y("update:notes",""),y("update:images",[]),y("hapus",V),m.value=!1};return(V,D)=>{var z,ge,A;return s(),o("div",Xs,[e("div",{class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(s(!0),o(ye,null,ke(t.options,(p,n)=>(s(),o("label",{key:n,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:p.value,checked:t.modelValue===p.value,onChange:c=>F(p),class:"hidden peer",required:t.required},null,40,Qs),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===p.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==p.value}])},C(p.label),3)]))),128))],2),t.modelValue&&b.value&&E(b.value)?(s(),o("div",eo,[e("div",{class:"flex justify-between items-start"},[D[4]||(D[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:K,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((z=b.value.settings)!=null&&z.show_image_upload)?(s(),o("div",to,[e("div",ao,[(s(!0),o(ye,null,ke(t.images,(p,n)=>(s(),o("div",{key:n,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:B(p),class:"w-full h-full object-cover rounded"},null,8,no),n===3&&t.images.length>4?(s(),o("span",so," +"+C(t.images.length-4),1)):l("",!0)]))),128))])])):l("",!0),t.notes&&((ge=b.value.settings)!=null&&ge.show_textarea)?(s(),o("div",oo,[e("p",io,C(t.notes),1)])):l("",!0)])):l("",!0),m.value?(s(),Ie(Nt,{key:(A=t.selectedPoint)==null?void 0:A.id,show:m.value,title:t.pointName||"Detail",subtitle:t.subtitle||"",name:"modal-radio-"+t.pointId,options:t.options,"selected-value":x.value,"notes-value":u.value,"images-value":i.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":D[0]||(D[0]=p=>x.value=p),"onUpdate:notesValue":D[1]||(D[1]=p=>u.value=p),"onUpdate:imagesValue":D[2]||(D[2]=p=>N(p)),onClose:q,onSave:H,onSaveTextarea:V.handleTextareaSave,onSaveImage:w,onHapus:D[3]||(D[3]=p=>O(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):l("",!0),t.error?(s(),o("p",lo,C(t.error),1)):l("",!0)])}}},uo={class:"mt-2 space-y-2"},co={key:0,class:"flex flex-wrap gap-3"},po={key:1,class:"p-2"},go={key:0,class:"mt-2"},mo={class:"flex gap-2 overflow-x-auto scrollbar-hide"},vo=["src"],fo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ho=["name","value","checked"],bo={key:1,class:"mt-2"},yo={class:"text-sm text-gray-600"},xo={key:3,class:"mt-2 text-sm text-red-600"},wo={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:W}){const a=t,y=W,r=_(a.notes),g=_([...a.images]),m=_(!1),u=_(""),i=_([]),x=_(""),I=_([]),b=oe(()=>a.options.find(w=>w.value===a.modelValue)),E=w=>w.preview||(w.image_path?`/${w.image_path}`:w);pe(()=>a.notes,w=>{r.value=w});const F=()=>{x.value=a.modelValue||"",u.value=r.value,i.value=[...g.value],I.value=[...g.value],m.value=!0},B=()=>{u.value="",i.value=[],x.value="",m.value=!1},K=w=>{i.value=w,g.value=[...w],y("update:images",[...w]),y("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:r.value,images:[...w]})},q=()=>{x.value!==a.modelValue&&y("update:modelValue",x.value),r.value=u.value,y("update:notes",u.value),g.value=[...i.value],y("update:images",[...i.value]),y("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:x.value,notes:u.value,images:i.value}),m.value=!1},N=w=>{x.value="",u.value="",i.value=[],r.value="",g.value=[],y("update:modelValue",""),y("update:notes",""),y("update:images",[]),y("hapus",w),m.value=!1};return(w,H)=>{var O,V;return s(),o("div",uo,[!t.modelValue&&g.value.length===0&&!r.value?(s(),o("div",co,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:F},H[4]||(H[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(s(),o("div",po,[e("div",{class:"flex justify-between items-start"},[H[5]||(H[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:F,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),g.value.length>0?(s(),o("div",go,[e("div",mo,[(s(!0),o(ye,null,ke(g.value,(D,z)=>(s(),o("div",{key:z,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:E(D),class:"w-full h-full object-cover rounded"},null,8,vo),z===3&&g.value.length>4?(s(),o("span",fo," +"+C(g.value.length-4),1)):l("",!0)]))),128))])])):l("",!0),e("div",{class:ne(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(s(!0),o(ye,null,ke(t.options,(D,z)=>(s(),o("label",{key:z,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:D.value,checked:t.modelValue===D.value,disabled:!0,class:"hidden peer"},null,8,ho),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===D.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==D.value}])},C(D.label),3)]))),128))],2),r.value&&((O=b.value.settings)!=null&&O.show_textarea)?(s(),o("div",bo,[e("p",yo,C(r.value),1)])):l("",!0)])),m.value?(s(),Ie(Nt,{key:(V=t.selectedPoint)==null?void 0:V.id,show:m.value,title:t.pointName||"Detail",subtitle:t.subtitle||"",name:"modal-radio-"+t.pointId,options:t.options,"selected-value":x.value,"notes-value":u.value,"images-value":i.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":H[0]||(H[0]=D=>x.value=D),"onUpdate:notesValue":H[1]||(H[1]=D=>u.value=D),"onUpdate:imagesValue":H[2]||(H[2]=D=>K(D)),onClose:B,onSave:q,onHapus:H[3]||(H[3]=D=>N(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):l("",!0),t.error?(s(),o("p",xo,C(t.error),1)):l("",!0)])}}},ko={class:"text-base font-semibold text-indigo-700"},Io={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},_o={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ao={class:"text-base font-semibold text-indigo-700"},So={class:"p-4 space-y-4"},$o={key:0,class:"flex justify-end py-1"},To=["onClick"],No={key:1,class:"space-y-2"},Co={class:"flex items-start justify-between"},Eo={class:"flex-1"},Vo={class:"block text-sm font-medium text-gray-700"},Mo={key:0,class:"text-red-500"},Ro={key:1,class:"italic text-xs text-gray-400 ml-2"},Uo={key:0,class:"mt-1"},Po={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800"},Do={key:0},Bo={key:1},Lo={key:2},jo={key:3},Oo={key:4},Fo={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},qo={key:9,class:"p-3 bg-gray-100 rounded text-sm text-gray-600"},Ho={class:"text-xs mt-1 list-disc list-inside"},Ko={key:0},Go={key:1},zo={key:2},Wo={key:3},Zo={key:4},Jo={key:0,class:"text-center py-8 text-gray-500"},Yo={key:0,class:"text-xs text-gray-400"},Xo={__name:"CategorySection",props:{category:Object,form:Object,head:Object,inspectionId:String,selectedPoint:Object,car:Object},emits:["updateResult","removeImage","hapusPoint"],setup(t,{emit:W}){const a=t,y=W,r=kt("vehicleFeatures",_(null));r.value=JSON.parse(localStorage.getItem("vehicle_features")||"{}"),Vt("vehicleFeatures",r);const g=_(!1),m=_([]),u=_(!0),i=_(null),x=Mt(),I={MT:"Manual Transmission (MT)",AT:"Automatic Transmission (AT)",CVT:"Continuously Variable Transmission (CVT)","e-CVT":"Electronic CVT (e-CVT)",DCT:"Dual Clutch Transmission (DCT)",AMT:"Automated Manual Transmission (AMT)",IVT:"Intelligent Variable Transmission (IVT)",SSG:"Seamless Shift Gearbox (SSG)",AGS:"Auto Gear Shift (AGS)",DHT:"Dedicated Hybrid Transmission (DHT)"};Ue(()=>{const A=new IntersectionObserver(([p])=>{u.value=p.isIntersecting},{threshold:.1});i.value&&A.observe(i.value),Be(()=>{i.value&&A.unobserve(i.value)})});const b=()=>{g.value=!g.value,g.value||(m.value=[])},E=oe(()=>(a.category.points||[]).some(A=>A.is_default===!1)),F=A=>!A||!Array.isArray(A)?[]:A.map(p=>I[p]||p),B=A=>{var $,J;const p=A.settings;if(!K(A))return!0;const n=($=a.car)==null?void 0:$.transmission,c=(J=a.car)==null?void 0:J.fuel_type;return!(p.transmission&&Array.isArray(p.transmission)&&p.transmission.length>0&&n&&!p.transmission.includes(n)||p.fuel_type&&p.fuel_type.trim()!==""&&c&&p.fuel_type!==c||p.rear_door&&(!r.value||!r.value.rear_door)||p.pick_up&&(!r.value||!r.value.pick_up)||p.box&&(!r.value||!r.value.box))},K=A=>{const p=A.settings;return!!(p!=null&&p.transmission&&Array.isArray(p.transmission)&&p.transmission.length>0||p!=null&&p.fuel_type&&p.fuel_type.trim()!==""||p!=null&&p.rear_door||p!=null&&p.pick_up||p!=null&&p.box)},q=A=>K(A)&&(g.value||B(A)),N=oe(()=>{const A=a.category.points||[],p=[];let n=[];return g.value?a.category.isDamageMenu?A.filter(c=>{var $;return c.is_default||H(($=c.inspection_point)==null?void 0:$.id)||g.value}):A:a.category.isDamageMenu?A.filter(c=>{var J;const $=(J=c.inspection_point)==null?void 0:J.id;return H($)||c.is_default||m.value.includes($)}):(A.forEach(c=>{var ae;const $=(ae=c.inspection_point)==null?void 0:ae.id,J=H($),M=m.value.includes($),Z=!K(c)||B(c);(c.is_default||J||M)&&Z?(n.length>0&&(p.push({is_link:!0,count:n.length,hiddenIds:n.map(te=>te.inspection_point.id)}),n.forEach(te=>{m.value.includes(te.inspection_point.id)&&p.push(te)}),n=[]),p.push(c)):(!K(c)||B(c))&&n.push(c)}),n.length>0&&(p.push({is_link:!0,count:n.length,hiddenIds:n.map(c=>c.inspection_point.id)}),n.forEach(c=>{m.value.includes(c.inspection_point.id)&&p.push(c)})),p.filter(c=>{var $,J;return c.is_link||c.is_default||H(($=c.inspection_point)==null?void 0:$.id)||m.value.includes((J=c.inspection_point)==null?void 0:J.id)}))});oe(()=>N.value.filter(A=>!A.is_link));const w=A=>{g.value=!1,A.forEach(p=>{m.value.includes(p)||m.value.push(p)})},H=A=>{if(!A)return!1;const p=x.props.existingResults[A]!==void 0,n=x.props.existingImages[A]&&x.props.existingImages[A].length>0,c=a.form.results[A]&&(a.form.results[A].status||a.form.results[A].note),$=a.form.images[A]&&a.form.images[A].length>0;return p||n||c||$},O=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],V=A=>{var c,$,J,M,R,Z,ee,ae,te;const p=a.form.results[(c=A.inspection_point)==null?void 0:c.id],n=a.form.images[($=A.inspection_point)==null?void 0:$.id];if(!p)return!1;switch(A.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!p.note;case"select":case"radio":if(!p.status)return!1;const se=(M=(J=A.settings)==null?void 0:J.radios)==null?void 0:M.find(L=>L.value===p.status);return!(se!=null&&se.settings&&(se.settings.show_textarea&&!((R=p.note)!=null&&R.trim())||se.settings.show_image_upload&&(n==null?void 0:n.length)===0));case"imageTOradio":if((n==null?void 0:n.length)===0||!p.status)return!1;const ie=(ee=(Z=A.settings)==null?void 0:Z.radios)==null?void 0:ee.find(L=>L.value===p.status);return!(ie!=null&&ie.settings&&ie.settings.show_textarea&&!((ae=p.note)!=null&&ae.trim()));case"image":return(n==null?void 0:n.length)>0;default:return!!p.status||!!((te=p.note)!=null&&te.trim())}},D=(A,p,n)=>{y("updateResult",{pointId:A,type:n,value:p})},z=A=>{console.log("Save result for point:",A)},ge=A=>{y("hapusPoint",A)};return pe(()=>a.form.results,A=>{},{deep:!0}),pe(()=>a.form.images,A=>{},{deep:!0}),pe(()=>a.car,A=>{console.log("Car data updated:",A)},{deep:!0}),pe(r,A=>{console.log("Vehicle features updated:",A)},{deep:!0}),(A,p)=>(s(),o(ye,null,[a.head==="vertical"?(s(),o("div",{key:0,class:ne(["px-6 py-2 border-b flex items-center justify-between bg-indigo-200","fixed top-0 left-0 right-0 z-20"])},[e("h4",ko,C(t.category.name),1),E.value?(s(),o("button",{key:0,onClick:b,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},C(g.value?"Sembunyikan Semua":"Tampilkan Point Lain"),1)):l("",!0)])):l("",!0),e("div",{class:ne(["bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100",a.head==="vertical"?"pt-6":""])},[!u.value&&E.value?(s(),o("button",{key:0,onClick:b,class:"fixed top-3 right-2 z-50 bg-indigo-600 text-white p-2 rounded-full shadow-lg"},[g.value?(s(),o("svg",Io,p[0]||(p[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)]))):(s(),o("svg",_o,p[1]||(p[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.006-3.362M9.88 9.88a3 3 0 104.24 4.24M6.1 6.1l11.8 11.8"},null,-1)])))])):l("",!0),a.head==="horizontal"?(s(),o("div",{key:1,ref_key:"categoryHeader",ref:i,class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",Ao,C(t.category.name),1),E.value?(s(),o("button",{key:0,onClick:b,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},C(g.value?"Sembunyikan":"Tampilkan Point Lain"),1)):l("",!0)],512)):l("",!0),e("div",So,[(s(!0),o(ye,null,ke(N.value,(n,c)=>{var $,J,M,R,Z,ee,ae,te,se,ie,L,xe,he,d,S,f,T,U,Q,Y,X,G,re,de,we,_e,Ae,Se,Ce,k,h,le,j,ue,me,ve,ce,Me,Fe,qe,He,Ke,Ge,ze,We,Ze,Je,Ye,Xe,Qe,et,tt,at,nt,st,ot,it,lt,rt,dt,ut,ct,pt,gt,mt,vt,ft,ht,bt;return s(),o("div",{key:c,class:ne(["space-y-2 last:border-0 last:pb-0",n.is_link?"pb-0":"pb-2 border-b border-gray-100"])},[n.is_link?(s(),o("div",$o,[e("button",{onClick:P=>w(n.hiddenIds),class:"text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline focus:outline-none"}," Tampilkan "+C(n.count)+" Point Tersembunyi ",9,To)])):(s(),o("div",No,[e("div",Co,[e("div",Eo,[e("label",Vo,[fe(C(($=n.inspection_point)==null?void 0:$.name)+" ",1),(J=n.settings)!=null&&J.is_required?(s(),o("span",Mo,"*")):l("",!0),!n.is_default&&!H((M=n.inspection_point)==null?void 0:M.id)?(s(),o("span",Ro," (opsional) ")):l("",!0)]),q(n)?(s(),o("div",Uo,[K(n)?(s(),o("div",Po,[(R=n.settings)!=null&&R.transmission?(s(),o("div",Do,C(n.settings.transmission.join(", ")),1)):l("",!0),(Z=n.settings)!=null&&Z.fuel_type?(s(),o("div",Bo,C(n.settings.fuel_type),1)):l("",!0),(ee=n.settings)!=null&&ee.rear_door?(s(),o("div",Lo," Pintu Belakang ")):l("",!0),(ae=n.settings)!=null&&ae.pick_up?(s(),o("div",jo," Tipe Pick Up ")):l("",!0),(te=n.settings)!=null&&te.box?(s(),o("div",Oo," Memiliki Box ")):l("",!0)])):l("",!0)])):l("",!0)]),V(n)?(s(),o("span",Fo," ✓ ")):l("",!0)]),n.input_type==="text"&&B(n)?(s(),Ie(_t,{key:0,modelValue:t.form.results[(se=n.inspection_point)==null?void 0:se.id].note,"onUpdate:modelValue":[P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].note=P},P=>{var v;return D((v=n.inspection_point)==null?void 0:v.id,P,"note")}],required:(ie=n.settings)==null?void 0:ie.is_required,"min-length":(L=n.settings)==null?void 0:L.min_length,"max-length":(xe=n.settings)==null?void 0:xe.max_length,allowSpace:(he=n.settings)==null?void 0:he.allow_space,textTransform:(d=n.settings)==null?void 0:d.text_transform,placeholder:((S=n.settings)==null?void 0:S.placeholder)||"Masukan text",error:t.form.errors[`results.${(f=n.inspection_point)==null?void 0:f.id}.note`],onSave:P=>{var v;return z((v=n.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):l("",!0),n.input_type==="number"&&B(n)?(s(),Ie(At,{key:1,modelValue:t.form.results[(T=n.inspection_point)==null?void 0:T.id].note,"onUpdate:modelValue":[P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].note=P},P=>{var v;return D((v=n.inspection_point)==null?void 0:v.id,P,"note")}],required:(U=n.settings)==null?void 0:U.is_required,min:(Q=n.settings)==null?void 0:Q.min,max:(Y=n.settings)==null?void 0:Y.max,step:((X=n.settings)==null?void 0:X.step)||1,placeholder:((G=n.settings)==null?void 0:G.placeholder)||"Masukan number",error:t.form.errors[`results.${(re=n.inspection_point)==null?void 0:re.id}.note`],onSave:P=>{var v;return z((v=n.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):l("",!0),n.input_type==="account"&&B(n)?(s(),Ie($t,{key:2,modelValue:t.form.results[(de=n.inspection_point)==null?void 0:de.id].note,"onUpdate:modelValue":[P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].note=P},P=>{var v;return D((v=n.inspection_point)==null?void 0:v.id,P,"note")}],required:(we=n.settings)==null?void 0:we.is_required,placeholder:((_e=n.settings)==null?void 0:_e.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${(Ae=n.inspection_point)==null?void 0:Ae.id}.note`],"point-id":(Se=n.inspection_point)==null?void 0:Se.id,settings:n.settings,onSave:P=>{var v;return z((v=n.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):l("",!0),n.input_type==="date"&&B(n)?(s(),Ie(St,{key:3,modelValue:t.form.results[(Ce=n.inspection_point)==null?void 0:Ce.id].note,"onUpdate:modelValue":[P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].note=P},P=>{var v;return D((v=n.inspection_point)==null?void 0:v.id,P,"note")}],required:(k=n.settings)==null?void 0:k.is_required,"min-date":(h=n.settings)==null?void 0:h.min_date,"max-date":(le=n.settings)==null?void 0:le.max_date,error:t.form.errors[`results.${(j=n.inspection_point)==null?void 0:j.id}.note`],onSave:P=>{var v;return z((v=n.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):l("",!0),n.input_type==="textarea"&&B(n)?(s(),Ie(Tt,{key:4,modelValue:t.form.results[(ue=n.inspection_point)==null?void 0:ue.id].note,"onUpdate:modelValue":[P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].note=P},P=>{var v;return D((v=n.inspection_point)==null?void 0:v.id,P,"note")}],required:(me=n.settings)==null?void 0:me.is_required,"min-length":(ve=n.settings)==null?void 0:ve.min_length,"max-length":(ce=n.settings)==null?void 0:ce.max_length,placeholder:((Me=n.settings)==null?void 0:Me.placeholder)||"Masukkan teks di sini",settings:n.settings,error:t.form.errors[`results.${(Fe=n.inspection_point)==null?void 0:Fe.id}.note`],onSave:P=>{var v;return z((v=n.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):l("",!0),n.input_type==="radio"&&B(n)?(s(),Ie(ro,{key:5,modelValue:t.form.results[(qe=n.inspection_point)==null?void 0:qe.id].status,"onUpdate:modelValue":[P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].status=P},P=>{var v;return D((v=n.inspection_point)==null?void 0:v.id,P,"status")}],notes:t.form.results[(He=n.inspection_point)==null?void 0:He.id].note,images:t.form.images[(Ke=n.inspection_point)==null?void 0:Ke.id],required:(Ge=n.settings)==null?void 0:Ge.is_required,"point-id":(ze=n.inspection_point)==null?void 0:ze.id,point:n.inspection_point,"inspection-id":t.inspectionId,settings:n.settings,"point-name":(We=n.inspection_point)==null?void 0:We.name,subtitle:(Ze=n.inspection_point)==null?void 0:Ze.description,"selected-point":n.inspection_point??null,options:((Je=n.settings)==null?void 0:Je.radios)||O,error:t.form.errors[`results.${(Ye=n.inspection_point)==null?void 0:Ye.id}.status`],"onUpdate:notes":P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].note=P},"onUpdate:images":P=>{var v;return t.form.images[(v=n.inspection_point)==null?void 0:v.id]=P},onSave:P=>{var v;return z((v=n.inspection_point)==null?void 0:v.id)},onHapus:P=>{var v;return ge((v=n.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","subtitle","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):l("",!0),n.input_type==="imageTOradio"&&B(n)?(s(),Ie(wo,{key:6,modelValue:t.form.results[(Xe=n.inspection_point)==null?void 0:Xe.id].status,"onUpdate:modelValue":[P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].status=P},P=>{var v;return D((v=n.inspection_point)==null?void 0:v.id,P,"status")}],notes:t.form.results[(Qe=n.inspection_point)==null?void 0:Qe.id].note,images:t.form.images[(et=n.inspection_point)==null?void 0:et.id],required:(tt=n.settings)==null?void 0:tt.is_required,"point-id":(at=n.inspection_point)==null?void 0:at.id,"inspection-id":t.inspectionId,settings:n.settings,"point-name":(nt=n.inspection_point)==null?void 0:nt.name,subtitle:(st=n.inspection_point)==null?void 0:st.description,point:n,"selected-point":n.inspection_point??null,options:((ot=n.settings)==null?void 0:ot.radios)||O,error:t.form.errors[`results.${(it=n.inspection_point)==null?void 0:it.id}.status`],"onUpdate:notes":P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].note=P},"onUpdate:images":P=>{var v;return t.form.images[(v=n.inspection_point)==null?void 0:v.id]=P},onSave:P=>{var v;return z((v=n.inspection_point)==null?void 0:v.id)},onHapus:P=>{var v;return ge((v=n.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","subtitle","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):l("",!0),n.input_type==="image"&&B(n)?(s(),Ie(Oe,{key:7,modelValue:t.form.images[(lt=n.inspection_point)==null?void 0:lt.id],"onUpdate:modelValue":P=>{var v;return t.form.images[(v=n.inspection_point)==null?void 0:v.id]=P},error:t.form.errors[`images.${(rt=n.inspection_point)==null?void 0:rt.id}`],"inspection-id":t.inspectionId,"point-id":(dt=n.inspection_point)==null?void 0:dt.id,point:n.inspection_point,"point-name":(ut=n.inspection_point)==null?void 0:ut.name,settings:n.settings,"onUpdate:notes":P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].note=P},"onUpdate:status":P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].status=P}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):l("",!0),n.input_type==="select"&&B(n)?(s(),Ie(Xa,{key:8,modelValue:t.form.results[(ct=n.inspection_point)==null?void 0:ct.id].status,"onUpdate:modelValue":[P=>{var v;return t.form.results[(v=n.inspection_point)==null?void 0:v.id].status=P},P=>{var v;return D((v=n.inspection_point)==null?void 0:v.id,P,"status")}],required:(pt=n.settings)==null?void 0:pt.is_required,error:t.form.errors[`results.${(gt=n.inspection_point)==null?void 0:gt.id}.status`],onSave:P=>{var v;return z((v=n.inspection_point)==null?void 0:v.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):l("",!0),!B(n)&&K(n)?(s(),o("div",qo,[p[2]||(p[2]=e("p",{class:"font-medium"},"Tidak tersedia untuk kendaraan ini",-1)),p[3]||(p[3]=e("p",{class:"text-xs mt-1"},"Point ini hanya tersedia untuk:",-1)),e("ul",Ho,[(mt=n.settings)!=null&&mt.transmission?(s(),o("li",Ko," Transmisi: "+C(F(n.settings.transmission).join(", ")),1)):l("",!0),(vt=n.settings)!=null&&vt.fuel_type?(s(),o("li",Go," Bahan bakar: "+C(n.settings.fuel_type),1)):l("",!0),(ft=n.settings)!=null&&ft.rear_door?(s(),o("li",zo,"Kendaraan dengan pintu belakang")):l("",!0),(ht=n.settings)!=null&&ht.pick_up?(s(),o("li",Wo,"Tipe pick up")):l("",!0),(bt=n.settings)!=null&&bt.box?(s(),o("li",Zo,"Kendaraan dengan box")):l("",!0)])])):l("",!0)]))],2)}),128)),N.value.filter(n=>!n.is_link).length===0?(s(),o("div",Jo,[p[4]||(p[4]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),p[5]||(p[5]=e("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),t.category.isDamageMenu?(s(),o("p",Yo,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):l("",!0)])):l("",!0)])],2)],64))}},Ni=Ne(Xo,[["__scopeId","data-v-3faa49ae"]]),Qo={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ei={class:"p-4 space-y-4-6"},ti={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ai=["value"],ni={class:"p-4 space-y-4-6"},si={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},oi=["value"],ii={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},li={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ri=["value"],di={class:"p-4 space-y-2"},ui={class:"flex items-center justify-between mb-2"},ci={key:0,class:"mb-4 p-4 bg-white border border-gray-200 rounded-lg shadow-lg"},pi={class:"flex items-center justify-between mb-3"},gi={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto"},mi=["onClick"],vi={class:"text-sm font-medium text-gray-800 mb-1"},fi={class:"text-xs text-gray-600 line-clamp-2"},hi={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},bi={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},yi={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},xi={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},wi={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},ki={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(t,{emit:W}){const a=t,y=W,r=_(null),g=_(!1),m=_(!1),u=xt({bold:!1,italic:!1,underline:!1}),i=xt({flooded:"",collision:"",collision_severity:"",notes:""}),x=_([{id:1,name:"Kendaraan Normal",description:"Template untuk kendaraan dalam kondisi normal tanpa masalah signifikan (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi kendaraan secara umum: <strong>BAIK</strong><br>
- Tidak ditemukan indikasi kerusakan signifikan<br>
- Semua sistem berfungsi dengan normal<br>
- Rekomendasi: Perawatan rutin sesuai jadwal

<p><strong>B. HAL PENTING SEBELUM PEMBAYARAN:</strong></p>
- Untuk menghindari kemungkinan yang terjadi di luar inspeksi (misalnya bunyi tidak wajar, fungsi elektrikal, lampu indikator, dan fitur penunjang ADAS/Cruise Control/dll.), **DIWAJIBKAN** untuk melakukan **Test Drive Terlebih Dahulu** sebelum pembayaran/transaksi.<br>
- Pastikan knalpot **Tidak Berasap** (khusus untuk mobil bensin).`},{id:2,name:"Kendaraan Bekas Tabrakan Ringan",description:"Template untuk kendaraan dengan riwayat tabrakan ringan (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat tabrakan dengan tingkat kerusakan: <strong>RINGAN</strong><br>
- Area yang terdampak: {DAMAGED_AREA}<br>
- Perbaikan yang dilakukan: {REPAIR_DETAILS}<br>
- Rekomendasi: Perbaikan tambahan pada area yang terdampak

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- {REPAIR_SHORT_TERM}<br>
- Estimasi Biaya: {REPAIR_COST_SHORT_TERM}
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- {REPAIR_LONG_TERM}<br>
- Estimasi Biaya: {REPAIR_COST_LONG_TERM}
<p><em>Not: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>

<p><strong>B. HAL PENTING SEBELUM PEMBAYARAN:</strong></p>
- Untuk menghindari kemungkinan yang terjadi di luar inspeksi (misalnya bunyi tidak wajar, fungsi elektrikal, lampu indikator, dan fitur penunjang ADAS/Cruise Control/dll.), **DIWAJIBKAN** untuk melakukan **Test Drive Terlebih Dahulu** sebelum pembayaran/transaksi.<br>
- Pastikan knalpot **Tidak Berasap** (khusus untuk mobil bensin).`},{id:3,name:"Kendaraan Bekas Banjir",description:"Template untuk kendaraan dengan riwayat terkena banjir (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat terkena banjir<br>
- Tingkat paparan air: {WATER_LEVEL}<br>
- Komponen yang terdampak: {AFFECTED_COMPONENTS}<br>
- Rekomendasi: Pengecekan sistem elektrik dan interior secara berkala

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- {REPAIR_SHORT_TERM}<br>
- Estimasi Biaya: {REPAIR_COST_SHORT_TERM}
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- {REPAIR_LONG_TERM}<br>
- Estimasi Biaya: {REPAIR_COST_LONG_TERM}
<p><em>Not: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>

<p><strong>B. HAL PENTING SEBELUM PEMBAYARAN:</strong></p>
- Untuk menghindari kemungkinan yang terjadi di luar inspeksi (misalnya bunyi tidak wajar, fungsi elektrikal, lampu indikator, dan fitur penunjang ADAS/Cruise Control/dll.), **DIWAJIBKAN** untuk melakukan **Test Drive Terlebih Dahulu** sebelum pembayaran/transaksi.<br>
- Pastikan knalpot **Tidak Berasap** (khusus untuk mobil bensin).`},{id:4,name:"Kendaraan dengan Multiple Issues",description:"Template untuk kendaraan dengan beberapa masalah umum (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi umum kendaraan: {OVERALL_CONDITION}<br>
- Masalah utama yang ditemukan: {MAIN_ISSUES}<br>
- Komponen yang perlu perhatian: {ATTENTION_NEEDED}<br>
- Status Tabrak/Banjir: {ACCIDENT_FLOOD_STATUS}<br>
- Rekomendasi: {RECOMMENDATION}

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- {REPAIR_SHORT_TERM}<br>
- Estimasi Biaya: {REPAIR_COST_SHORT_TERM}
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- {REPAIR_LONG_TERM}<br>
- Estimasi Biaya: {REPAIR_COST_LONG_TERM}
<p><em>Not: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>

<p><strong>B. HAL PENTING SEBELUM PEMBAYARAN:</strong></p>
- Untuk menghindari kemungkinan yang terjadi di luar inspeksi (misalnya bunyi tidak wajar, fungsi elektrikal, lampu indikator, dan fitur penunjang ADAS/Cruise Control/dll.), **DIWAJIBKAN** untuk melakukan **Test Drive Terlebih Dahulu** sebelum pembayaran/transaksi.<br>
- Pastikan knalpot **Tidak Berasap** (khusus untuk mobil bensin).`},{id:5,name:"Template Singkat",description:"Template ringkas untuk kesimpulan cepat (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Status Keseluruhan Kendaraan: {OVERALL_STATUS}<br>
- Catatan Utama: {ADDITIONAL_NOTES}<br>
- Status Tabrak/Banjir: {ACCIDENT_FLOOD_STATUS}

<p><strong>B. HAL PENTING SEBELUM PEMBAYARAN:</strong></p>
- Untuk menghindari kemungkinan yang terjadi di luar inspeksi (misalnya bunyi tidak wajar, fungsi elektrikal, lampu indikator, dan fitur penunjang ADAS/Cruise Control/dll.), **DIWAJIBKAN** untuk melakukan **Test Drive Terlebih Dahulu** sebelum pembayaran/transaksi.<br>
- Pastikan knalpot **Tidak Berasap** (khusus untuk mobil bensin).`},{id:6,name:"Template Teknis Detail",description:"Template detail untuk laporan teknis lengkap (Lengkap A, C, B)",content:`<p><strong>A. LAPORAN HASIL INSPEKSI TEKNIS:</strong></p>
- Tanggal Inspeksi: {INSPECTION_DATE}<br>
- Kondisi Mesin: {ENGINE_CONDITION}<br>
- Kondisi Transmisi: {TRANSMISSION_CONDITION}<br>
- Kondisi Suspensi: {SUSPENSION_CONDITION}<br>
- Kondisi Rem: {BRAKE_CONDITION}<br>
- Kondisi Body: {BODY_CONDITION}<br>
- Kondisi Interior: {INTERIOR_CONDITION}<br>
- Kesimpulan Akhir: {FINAL_CONCLUSION}

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- {REPAIR_SHORT_TERM}<br>
- Estimasi Biaya: {REPAIR_COST_SHORT_TERM}
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- {REPAIR_LONG_TERM}<br>
- Estimasi Biaya: {REPAIR_COST_LONG_TERM}
<p><em>Not: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>

<p><strong>B. HAL PENTING SEBELUM PEMBAYARAN:</strong></p>
- Untuk menghindari kemungkinan yang terjadi di luar inspeksi (misalnya bunyi tidak wajar, fungsi elektrikal, lampu indikator, dan fitur penunjang ADAS/Cruise Control/dll.), **DIWAJIBKAN** untuk melakukan **Test Drive Terlebih Dahulu** sebelum pembayaran/transaksi.<br>
- Pastikan knalpot **Tidak Berasap** (khusus untuk mobil bensin).`}]);_(["{PLATE_NUMBER}","{CAR_NAME}","{INSPECTION_DATE}","{DAMAGED_AREA}","{REPAIR_DETAILS}","{WATER_LEVEL}","{AFFECTED_COMPONENTS}","{OVERALL_CONDITION}","{MAIN_ISSUES}","{ATTENTION_NEEDED}","{REPAIR_COST_ESTIMATE}","{RECOMMENDATION}","{OVERALL_STATUS}","{ADDITIONAL_NOTES}","{ENGINE_CONDITION}","{TRANSMISSION_CONDITION}","{SUSPENSION_CONDITION}","{BRAKE_CONDITION}","{BODY_CONDITION}","{INTERIOR_CONDITION}","{FINAL_CONCLUSION}"]);const I=n=>{if(!n)return{};if(typeof n=="string")try{return JSON.parse(n)||{}}catch(c){return console.error("Error parsing settings JSON:",c),{}}return typeof n=="object"&&n!==null?n:{}};oe(()=>I(a.inspection.settings).conclusion||{});const b=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],E=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],F=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Ue(()=>{K(),wt(()=>{B(),w()})});const B=()=>{r.value&&i.notes&&(r.value.innerHTML=i.notes)},K=()=>{const c=I(a.inspection.settings).conclusion||{},$=a.form.conclusion||{};i.flooded=$.flooded||c.flooded||"",i.collision=$.collision||c.collision||"",i.collision_severity=$.collision_severity||c.collision_severity||"",i.notes=$.notes||a.inspection.notes||""},q=n=>{if(!r.value)return;let c=n.content;c=c.replace(/{PLATE_NUMBER}/g,a.inspection.plate_number||"[NOMOR_PLAT]").replace(/{CAR_NAME}/g,a.inspection.car_name||"[NAMA_MOBIL]").replace(/{INSPECTION_DATE}/g,new Date().toLocaleDateString("id-ID")).replace(/{FLOOD_STATUS}/g,i.flooded==="yes"?"Pernah terkena banjir":"Tidak pernah terkena banjir").replace(/{COLLISION_STATUS}/g,i.collision==="yes"?"Pernah mengalami tabrakan":"Tidak pernah mengalami tabrakan"),r.value.innerHTML=c,i.notes=c,m.value=!1,wt(()=>{r.value.focus(),p()})},N=()=>{r.value&&(r.value.innerHTML="",i.notes="",p())},w=()=>{if(!r.value)return;const n=window.getSelection();n.rangeCount===0||n.isCollapsed||(u.bold=document.queryCommandState("bold"),u.italic=document.queryCommandState("italic"),u.underline=document.queryCommandState("underline"))},H=n=>{if(!r.value)return;r.value.focus();const c=u[n];switch(n){case"bold":document.execCommand("bold",!1,!c);break;case"italic":document.execCommand("italic",!1,!c);break;case"underline":document.execCommand("underline",!1,!c);break}setTimeout(()=>{w(),O()},10)},O=It.debounce(()=>{r.value&&(i.notes=r.value.innerHTML,p())},200),V=n=>{n.preventDefault(),document.execCommand("insertParagraph",!1,null)},D=n=>{n.preventDefault();const c=(n.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,c)},z=()=>{g.value=!0},ge=()=>{g.value=!1,r.value&&(i.notes=r.value.innerHTML,p())},A=()=>{p()},p=()=>{const n={flooded:i.flooded,collision:i.collision,collision_severity:i.collision==="yes"?i.collision_severity:null,notes:i.notes};y("updateConclusion",n)};return pe(()=>a.form.conclusion,n=>{n&&(i.flooded=n.flooded!==void 0?n.flooded:i.flooded,i.collision=n.collision!==void 0?n.collision:i.collision,i.collision_severity=n.collision_severity!==void 0?n.collision_severity:i.collision_severity,i.notes=n.notes!==void 0?n.notes:i.notes,r.value&&n.notes!==void 0&&r.value.innerHTML!==n.notes&&(r.value.innerHTML=n.notes))},{deep:!0,immediate:!0}),pe([()=>i.flooded,()=>i.collision,()=>i.collision_severity,()=>i.notes],()=>{p()},{deep:!0}),(n,c)=>(s(),o("div",Qo,[c[21]||(c[21]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),e("div",ei,[c[10]||(c[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[fe(" Apakah kendaraan pernah terkena banjir? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ti,[(s(),o(ye,null,ke(b,$=>e("label",{key:$.value,class:"cursor-pointer"},[$e(e("input",{type:"radio","onUpdate:modelValue":c[0]||(c[0]=J=>i.flooded=J),value:$.value,class:"hidden peer",onChange:A},null,40,ai),[[je,i.flooded]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":i.flooded===$.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":i.flooded!==$.value}])},C($.label),3)])),64))])]),e("div",ni,[c[12]||(c[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[fe(" Apakah kendaraan pernah mengalami tabrakan? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",si,[(s(),o(ye,null,ke(E,$=>e("label",{key:$.value,class:"cursor-pointer"},[$e(e("input",{type:"radio","onUpdate:modelValue":c[1]||(c[1]=J=>i.collision=J),value:$.value,class:"hidden peer",onChange:A},null,40,oi),[[je,i.collision]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":i.collision===$.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":i.collision!==$.value}])},C($.label),3)])),64))]),be(De,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:Te(()=>[i.collision==="yes"?(s(),o("div",ii,[c[11]||(c[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[fe("Tingkat kerusakan: "),e("span",{class:"text-red-500"},"*")],-1)),e("div",li,[(s(),o(ye,null,ke(F,$=>e("label",{key:$.value,class:"cursor-pointer"},[$e(e("input",{type:"radio","onUpdate:modelValue":c[2]||(c[2]=J=>i.collision_severity=J),value:$.value,class:"hidden peer",onChange:A},null,40,ri),[[je,i.collision_severity]]),e("div",{class:ne(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":i.collision_severity===$.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":i.collision_severity!==$.value}])},C($.label),3)])),64))])])):l("",!0)]),_:1})]),e("div",di,[e("div",ui,[c[14]||(c[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Catatan Kesimpulan",-1)),e("button",{type:"button",onClick:c[3]||(c[3]=$=>m.value=!m.value),class:"flex items-center gap-2 px-3 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-all duration-200"},c[13]||(c[13]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),fe(" Template ")]))]),be(De,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:Te(()=>[m.value?(s(),o("div",ci,[e("div",pi,[c[16]||(c[16]=e("h5",{class:"text-sm font-semibold text-gray-700"},"Pilih Template Kesimpulan",-1)),e("button",{onClick:c[4]||(c[4]=$=>m.value=!1),class:"text-gray-400 hover:text-gray-600"},c[15]||(c[15]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",gi,[(s(!0),o(ye,null,ke(x.value,$=>(s(),o("button",{key:$.id,onClick:J=>q($),class:"p-3 text-left border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-all duration-150"},[e("div",vi,C($.name),1),e("div",fi,C($.description),1)],8,mi))),128))])])):l("",!0)]),_:1}),e("div",hi,[e("button",{type:"button",onClick:c[5]||(c[5]=$=>H("bold")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",u.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},c[17]||(c[17]=[e("strong",null,"B",-1)]),2),e("button",{type:"button",onClick:c[6]||(c[6]=$=>H("italic")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",u.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},c[18]||(c[18]=[e("em",null,"I",-1)]),2),e("button",{type:"button",onClick:c[7]||(c[7]=$=>H("underline")),class:ne(["p-2 rounded transition-all duration-150 ease-in-out font-medium",u.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},c[19]||(c[19]=[e("u",null,"U",-1)]),2),e("button",{type:"button",onClick:c[8]||(c[8]=$=>N()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Template"}," 🗑️ Clear ")]),be(De,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:Te(()=>[Object.values(u).some($=>$)?(s(),o("div",bi,[c[20]||(c[20]=fe(" Format aktif: ")),u.bold?(s(),o("span",yi,"Bold")):l("",!0),u.italic?(s(),o("span",xi,"Italic")):l("",!0),u.underline?(s(),o("span",wi,"Underline")):l("",!0)])):l("",!0)]),_:1}),e("div",{ref_key:"editorRef",ref:r,contenteditable:"true",class:ne(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!g.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":g.value}]),onInput:c[9]||(c[9]=(...$)=>Ee(O)&&Ee(O)(...$)),onBlur:ge,onFocus:z,onKeydown:Rt(V,["enter"]),onPaste:D,onMouseup:w,onKeyup:w,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},Ci=Ne(ki,[["__scopeId","data-v-b366fe44"]]);export{Vs as B,Ni as C,Ti as V,Nt as _,Ci as a};
