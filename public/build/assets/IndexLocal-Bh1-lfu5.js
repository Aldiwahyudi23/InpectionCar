import{x as Tt,r as w,g as Je,q as ne,E as ot,G as be,c as n,o,d as e,b as c,k as _e,z as Ne,A as Pe,n as se,t as A,u as X,e as es,F as Me,m as Ue,f as $e,y as at,w as qe,L as Be,M as ts,a as _t,j as Ve,l as Mt,T as lt,p as ss,N as Ut,D as Nt,J as ut,B as as,O as os,I as Dt,S as ns,W as ct}from"./vendor-CwaeDJfC.js";import{l as Lt}from"./lodash-DfwitXkl.js";import{_ as is}from"./PrimaryButton-DTE9tPxx.js";import{_ as ls}from"./ActionMessage-PedWn-P3.js";import{_ as Ee}from"./app-BQU-ZWgR.js";import{u as jt}from"./useDraggableButton-B7ftwxmu.js";const rs={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ds={key:0,class:"p-4 space-y-2"},us={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},cs={class:"flex items-center space-x-2"},gs={key:0,class:"text-xs text-red-500 font-normal ml-2"},ms={key:1,class:"text-xs text-red-500 font-normal ml-2"},ps={key:2,class:"text-xs text-green-500 font-normal ml-2"},vs={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},fs={class:"relative"},hs={key:0,class:"absolute right-3 top-3"},bs={key:1,class:"text-xs text-red-500 font-normal ml-2"},ys={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},xs={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ws={key:0},ks=["onMousedown"],$s={class:"font-medium text-gray-900"},Cs={class:"text-sm text-gray-500"},Is={key:1,class:"p-4 text-sm text-gray-500 text-center"},Ss={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Vs={key:0,class:"mb-4"},_s=["innerHTML"],Ms={key:1},Us={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Ds=["onClick"],js=["src","alt"],Ts={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Ns={class:"text-white text-xs text-center"},Ls={key:2,class:"text-center py-4 text-gray-500 text-sm"},qs={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},As=["src","alt"],Bs={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Es={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Rs={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Fs={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges"],setup(t,{emit:Q}){var W,me,oe,G,ie,pe;const s=t,y=Q,d=Tt({plate_number:((W=s.inspection)==null?void 0:W.plate_number)||"",car_id:((me=s.inspection)==null?void 0:me.car_id)||null,car_name:((oe=s.inspection)==null?void 0:oe.car_name)||""}),m=w(((G=s.inspection)==null?void 0:G.plate_number)||""),p=w(((ie=s.inspection)==null?void 0:ie.car_id)||null),r=w(((pe=s.inspection)==null?void 0:pe.car_name)||""),g=w(""),S=w(""),V=w(""),k=w(!1),B=w(""),Z=w(""),h=w(d.car_name),I=w(!1),a=w(!1),$=w([]),_=w(null),E=w([]),K=w(!1),D=w(0);Je(()=>{var x,v,j,H,N;if(ee((x=s.inspection)==null?void 0:x.plate_number),(v=s.inspection)!=null&&v.car_id&&((j=s.CarDetail)==null?void 0:j.length)>0){const he=s.CarDetail.find(we=>we.id===s.inspection.car_id);he&&ce(he)}else!((H=s.inspection)!=null&&H.car_id)&&((N=s.inspection)!=null&&N.car_name)&&(h.value=s.inspection.car_name,d.car_id=null);window.addEventListener("keydown",C),y("update:hasUnsavedChanges",Ce.value),y("update:validation",ue.value)}),ot(()=>{window.removeEventListener("keydown",C)});const ee=x=>{if(!x){g.value="",S.value="",V.value="";return}const v=x.toUpperCase().trim(),j=v.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(j)g.value=j[1]||"",S.value=j[2]||"",V.value=j[3]||"";else{let H="area",N="",he="",we="";for(const xe of v)H==="area"&&/[A-Z]/.test(xe)?N+=xe:H==="area"&&/[0-9]/.test(xe)?(H="number",he+=xe):H==="number"&&/[0-9]/.test(xe)?he+=xe:H==="number"&&/[A-Z]/.test(xe)?(H="suffix",we+=xe):H==="suffix"&&/[A-Z]/.test(xe)&&(we+=xe);g.value=N,S.value=he,V.value=we}Y()},Y=()=>{const x=`${g.value}${S.value}${V.value}`;d.plate_number=x,b()},T=x=>{x==="area"?g.value=g.value.toUpperCase().replace(/[^A-Z]/g,""):x==="number"?S.value=S.value.replace(/[^0-9]/g,""):x==="suffix"&&(V.value=V.value.toUpperCase().replace(/[^A-Z]/g,"")),Y()},M=ne(()=>{const x=d.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(x)}),F=ne(()=>!h.value||h.value.trim()===""),P=ne(()=>d.plate_number.length>0&&!M.value?"Format plat nomor tidak valid.":null),ue=ne(()=>{const x=!d.plate_number||d.plate_number.trim()==="",v=!h.value||h.value.trim()==="";return x||v||!M.value||k.value}),Ce=ne(()=>{const x=d.plate_number!==m.value,v=d.car_id!==p.value||h.value!==r.value;return x||v}),ke=ne(()=>Ce.value&&!ue.value),R=x=>{var j,H,N;if(!x)return"";const v=[];return(j=x.brand)!=null&&j.name&&v.push(x.brand.name),(H=x.model)!=null&&H.name&&v.push(x.model.name),(N=x.type)!=null&&N.name&&v.push(x.type.name),x.cc&&v.push((x.cc/1e3).toFixed(1)),x.transmission&&v.push(x.transmission),x.year&&v.push(x.year.toString()),x.fuel_type&&v.push(x.fuel_type),x.production_period&&v.push(`(${x.production_period})`),v.join(" ")},O=()=>{d.car_id&&(d.car_id=null,_.value=null,E.value=[]),ae()},ae=Lt.debounce(()=>{if(!h.value.trim()){$.value=[],I.value=!1;return}a.value=!0;try{const x=h.value.toLowerCase().trim();$.value=s.CarDetail.filter(v=>R(v).toLowerCase().includes(x)),I.value=!0}finally{a.value=!1}},300),le=()=>{setTimeout(()=>{I.value=!1,d.car_name=h.value,b()},200)},ce=async x=>{_.value=x,h.value=R(x),d.car_id=x.id,d.car_name=R(x),I.value=!1,await re(x.id),b(),y("update:hasUnsavedChanges",Ce.value),y("update:validation",ue.value)},ge=x=>!x||!x.file_path?"":`/storage/${x.file_path}`,re=async x=>{try{const v=await fetch(`/api/cars/${x}/images`);if(v.ok){const j=await v.json();E.value=Array.isArray(j)?j:[]}else E.value=[]}catch(v){console.error("Error loading car images:",v),E.value=[]}},ye=x=>{D.value=x,K.value=!0,document.body.style.overflow="hidden"},L=()=>{K.value=!1,document.body.style.overflow=""},fe=()=>{D.value=(D.value+1)%E.value.length},u=()=>{D.value=(D.value-1+E.value.length)%E.value.length},C=x=>{if(K.value)switch(x.key){case"Escape":L();break;case"ArrowRight":fe();break;case"ArrowLeft":u();break}},b=()=>{const x={plate_number:d.plate_number,car_id:d.car_id,car_name:d.car_name};y("update-vehicle",x)},q=()=>{s.inspection&&d.post(route("inspections.updateVehicleDetails",{inspection:s.inspection.id}),{preserveScroll:!0,onSuccess:()=>{m.value=d.plate_number,p.value=d.car_id,r.value=d.car_name,y("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:x=>{console.error("Gagal menyimpan data:",x)}})};return be([()=>d.plate_number,()=>d.car_name],x=>{B.value="",k.value=!1,Z.value="";const v=x[0];if(v&&v.length>=6){const j=s.allInspections.filter(H=>{var N;return H.plate_number===v&&H.id!==((N=s.inspection)==null?void 0:N.id)});if(j.length>0){const H=["draft","in_progress","pending","pending_review","revision"],N=j.find(he=>H.includes(he.status));if(N)k.value=!0,B.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${N.status.replace(/_/g," ").toUpperCase()}.`;else{const he=j.filter(we=>["approved","rejected","completed","cancelled"].includes(we.status));if(he.length>0){he.sort((xe,Re)=>new Date(Re.created_at)-new Date(xe.created_at));const we=he[0];if(we.car_id){const xe=s.CarDetail.find(Re=>Re.id===we.car_id);xe&&ce(xe)}else we.car_name&&(h.value=we.car_name,d.car_name=we.car_name,d.car_id=null);Z.value=`Nomor plat ini sudah pernah diperiksa ${he.length} kali sebelumnya.`}}}}y("update:hasUnsavedChanges",Ce.value),y("update:validation",ue.value)},{deep:!0}),(x,v)=>{var j;return o(),n("div",rs,[v[21]||(v[21]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(o(),n("div",ds,[e("div",us,[v[9]||(v[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),e("div",cs,[Ne(e("input",{"onUpdate:modelValue":v[0]||(v[0]=H=>g.value=H),type:"text",placeholder:"Contoh: B",class:se(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||k.value}]),onInput:v[1]||(v[1]=H=>T("area")),maxlength:"2"},null,34),[[Pe,g.value]]),Ne(e("input",{"onUpdate:modelValue":v[2]||(v[2]=H=>S.value=H),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:se(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||k.value}]),onInput:v[3]||(v[3]=H=>T("number")),maxlength:"4"},null,34),[[Pe,S.value]]),Ne(e("input",{"onUpdate:modelValue":v[4]||(v[4]=H=>V.value=H),type:"text",placeholder:"ABC",class:se(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!M.value||k.value}]),onInput:v[5]||(v[5]=H=>T("suffix")),maxlength:"3"},null,34),[[Pe,V.value]])]),P.value?(o(),n("span",gs,A(P.value),1)):c("",!0),B.value?(o(),n("span",ms,A(B.value),1)):c("",!0),Z.value?(o(),n("span",ps,A(Z.value),1)):c("",!0)]),e("div",vs,[v[13]||(v[13]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",fs,[Ne(e("input",{"onUpdate:modelValue":v[6]||(v[6]=H=>h.value=H),type:"text",placeholder:"Cari atau ketik nama mobil...",class:se(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":F.value}]),onInput:O,onFocus:v[7]||(v[7]=H=>I.value=!0),onBlur:le},null,34),[[Pe,h.value]]),a.value?(o(),n("div",hs,v[10]||(v[10]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),F.value?(o(),n("span",bs,"Nama mobil tidak boleh kosong.")):c("",!0),!X(d).car_id&&h.value?(o(),n("div",ys,v[11]||(v[11]=[es('<div class="flex items-start" data-v-1fd1424d><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-1fd1424d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-1fd1424d></path></svg><div data-v-1fd1424d><p class="text-yellow-800 font-medium mb-1" data-v-1fd1424d>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-1fd1424d> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-1fd1424d>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-1fd1424d> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-1fd1424d> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-1fd1424d>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-1fd1424d>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):c("",!0),I.value?(o(),n("div",xs,[$.value.length>0?(o(),n("div",ws,[(o(!0),n(Me,null,Ue($.value,H=>(o(),n("div",{key:H.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:N=>ce(H)},[e("div",$s,A(R(H)),1),e("div",Cs,A(H.year)+" • "+A(H.cc)+"cc • "+A(H.transmission)+" • "+A(H.fuel_type),1)],40,ks))),128))])):(o(),n("div",Is,v[12]||(v[12]=[$e(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),$e(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),X(d).car_id&&_.value?(o(),n("div",Ss,[_.value.description?(o(),n("div",Vs,[v[14]||(v[14]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:_.value.description},null,8,_s)])):c("",!0),E.value.length>0?(o(),n("div",Ms,[v[15]||(v[15]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",Us,[(o(!0),n(Me,null,Ue(E.value,(H,N)=>(o(),n("div",{key:H.id||N,class:"relative group cursor-pointer",onClick:he=>ye(N)},[e("img",{src:ge(H),alt:H.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,js),H.note?(o(),n("div",Ts,[e("p",Ns,A(H.note),1)])):c("",!0)],8,Ds))),128))])])):(o(),n("div",Ls," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),K.value?(o(),n("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:L},[e("div",qs,[e("button",{onClick:L,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},v[16]||(v[16]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),E.value.length>1?(o(),n("button",{key:0,onClick:at(u,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},v[17]||(v[17]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),E.value.length>1?(o(),n("button",{key:1,onClick:at(fe,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},v[18]||(v[18]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),e("img",{src:ge(E.value[D.value]),alt:"Car Image "+(D.value+1),class:"max-w-full max-h-full object-contain",onClick:v[8]||(v[8]=at(()=>{},["stop"]))},null,8,As),E.value.length>1?(o(),n("div",Bs,A(D.value+1)+" / "+A(E.value.length),1)):c("",!0),(j=E.value[D.value])!=null&&j.note?(o(),n("div",Es,A(E.value[D.value].note),1)):c("",!0)])])):c("",!0),_e(is,{type:"button",onClick:q,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!ke.value},{default:qe(()=>[X(d).processing?(o(),n("svg",Rs,v[19]||(v[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,A(X(d).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),_e(ls,{on:X(d).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:qe(()=>v[20]||(v[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),$e(" Tersimpan. ")])),_:1,__:[20]},8,["on"])]),_:1},8,["disabled"])])):c("",!0)])}}},zs=Ee(Fs,[["__scopeId","data-v-1fd1424d"]]),Os={class:"mt-1"},Hs=["value","required","minlength","maxlength","allowSpace","placeholder"],Ks={key:0,class:"mt-2 text-sm text-red-600"},qt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,y=Q,d=ne(()=>{if(!s.modelValue)return"";let p=s.modelValue;switch(s.allowSpace||(p=p.replace(/\s+/g,"")),s.textTransform){case"uppercase":return p.toUpperCase();case"lowercase":return p.toLowerCase();case"capitalize":return p.replace(/\b\w/g,r=>r.toUpperCase());default:return p}}),m=p=>{let r=p.target.value;switch(s.allowSpace||(r=r.replace(/\s+/g,"")),s.textTransform){case"uppercase":r=r.toUpperCase();break;case"lowercase":r=r.toLowerCase();break;case"capitalize":r=r.replace(/\b\w/g,g=>g.toUpperCase());break}y("update:modelValue",r),y("save",s.pointId)};return(p,r)=>(o(),n("div",Os,[e("input",{value:d.value,onInput:m,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:se(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,Hs),t.error?(o(),n("p",Ks,A(t.error),1)):c("",!0)]))}},Ws={class:"mt-1"},Zs=["value","required","min","max","step","placeholder"],Gs={key:0,class:"mt-2 text-sm text-red-600"},At={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,y=Q,d=m=>{const p=m.target.value;y("update:modelValue",p),y("save",s.pointId)};return(m,p)=>(o(),n("div",Ws,[e("input",{value:t.modelValue,onInput:d,type:"number",required:t.required,min:t.min,max:t.max,step:t.step,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Zs),t.error?(o(),n("p",Gs,A(t.error),1)):c("",!0)]))}},Ps={class:"mt-1"},Js=["value","required","min","max"],Xs={key:0,class:"mt-2 text-sm text-red-600"},Bt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,y=Q,d=m=>{y("update:modelValue",m.target.value),y("save",s.pointId)};return(m,p)=>(o(),n("div",Ps,[e("input",{value:t.modelValue,onChange:d,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Js),t.error?(o(),n("p",Xs,A(t.error),1)):c("",!0)]))}},Ys={class:"mt-1"},Qs=["value","required","placeholder"],ea={key:0,class:"mt-2 text-sm text-red-600"},Et={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,y=Q,d=w(""),m=ne(()=>{var V,k,B,Z;return{currency_symbol:((V=s.settings)==null?void 0:V.currency_symbol)||"Rp",thousands_separator:((k=s.settings)==null?void 0:k.thousands_separator)||",",min_value:((B=s.settings)==null?void 0:B.min_value)!==void 0?Number(s.settings.min_value):0,max_value:((Z=s.settings)==null?void 0:Z.max_value)!==void 0?Number(s.settings.max_value):1e9}}),p=V=>{if(V==null||V==="")return"";const k=Number(V);if(isNaN(k))return"";let B=k.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return m.value.thousands_separator!==","&&(B=B.replace(/,/g,m.value.thousands_separator)),B},r=V=>V?V.replace(/[^\d]/g,""):"",g=ne(()=>d.value?`${m.value.currency_symbol} ${p(d.value)}`:""),S=V=>{let k=r(V.target.value),B=Number(k);m.value.min_value!==void 0&&B<m.value.min_value&&(k=m.value.min_value.toString()),m.value.max_value!==void 0&&B>m.value.max_value&&(k=m.value.max_value.toString()),d.value=k,y("update:modelValue",k),y("save",s.pointId)};return be(()=>s.modelValue,V=>{V!=null&&(d.value=V.toString())},{immediate:!0}),(V,k)=>(o(),n("div",Ys,[e("input",{value:g.value,onInput:S,type:"text",required:t.required,placeholder:t.placeholder,class:se(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,Qs),t.error?(o(),n("p",ea,A(t.error),1)):c("",!0)]))}},ta={class:"mt-1 space-y-3"},sa={key:0,class:"space-y-2"},aa={class:"flex flex-wrap gap-2"},oa=["onClick"],na=["value","required","minlength","maxlength","placeholder"],ia={class:"flex justify-between items-center mt-1"},la={class:"text-xs text-gray-500"},ra={key:0,class:"text-xs text-red-600"},Rt={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,y=Q,d=w([]),m=w(""),p=V=>d.value.some(k=>k.value===V),r=V=>{p(V.value)?d.value=d.value.filter(h=>h.value!==V.value):d.value.push(V);const B=[...d.value.map(h=>h.value)];m.value.trim()&&B.push(m.value.trim());const Z=B.join(", ");y("update:modelValue",Z),y("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:Z})},g=V=>{const k=V.target.value;y("update:modelValue",k),y("save",{pointId:s.pointId,inspectionId:s.inspectionId,notes:k}),S(k)},S=V=>{var h,I,a,$;if(!V){d.value=[],m.value="";return}const k=V.split(",").map(_=>_.trim()).filter(_=>_),B=((I=(h=s.settings)==null?void 0:h.damage_options)==null?void 0:I.map(_=>_.value))||[];d.value=(($=(a=s.settings)==null?void 0:a.damage_options)==null?void 0:$.filter(_=>k.includes(_.value)))||[];const Z=k.filter(_=>!B.includes(_));m.value=Z.join(", ")};return be(()=>s.modelValue,V=>{V!=null&&S(V)},{immediate:!0}),(V,k)=>{var B,Z,h;return o(),n("div",ta,[(B=t.settings)!=null&&B.enable_damage&&((Z=t.settings)!=null&&Z.damage_options)?(o(),n("div",sa,[k[0]||(k[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",aa,[(o(!0),n(Me,null,Ue(t.settings.damage_options,(I,a)=>(o(),n("button",{key:a,type:"button",onClick:$=>r(I),class:se(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":p(I.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!p(I.value)}])},A(I.label),11,oa))),128))])])):c("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:g,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,na),e("div",ia,[e("span",la,A(((h=t.modelValue)==null?void 0:h.length)||0)+"/"+A(t.maxLength||400),1),t.error?(o(),n("p",ra,A(t.error),1)):c("",!0)])])])}}},da={class:"mt-1"},ua=["value","required"],ca={key:0,class:"mt-2 text-sm text-red-600"},ga={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:Q}){const s=t,y=Q,d=m=>{y("update:modelValue",m.target.value),y("save",s.pointId)};return(m,p)=>(o(),n("div",da,[e("select",{value:t.modelValue,onChange:d,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},p[0]||(p[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,ua),t.error?(o(),n("p",ca,A(t.error),1)):c("",!0)]))}},ma=Ee(ga,[["__scopeId","data-v-1b6c0201"]]),pa={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},va={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},fa={class:"text-xs text-gray-500 mt-2 text-center"},ha={class:"flex flex-row space-x-4 mb-6"},ba={class:"mt-4 text-right"},ya={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(Q,s)=>t.show?(o(),n("div",pa,[e("div",va,[s[7]||(s[7]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),e("p",fa,[s[3]||(s[3]=$e("Ambil Foto Maksimal: ")),e("b",null,A(t.settings.max_files),1),s[4]||(s[4]=$e(" Dengan Rasio & Ukuran: ")),e("b",null,A(t.settings.camera_aspect_ratio),1)]),e("div",ha,[e("button",{onClick:s[0]||(s[0]=y=>Q.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:s[1]||(s[1]=y=>Q.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",ba,[e("button",{onClick:s[2]||(s[2]=y=>Q.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):c("",!0)}},xa={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},wa={class:"webcam-content-box"},ka={class:"webcam-header"},$a={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},Ca={class:"inspection-point-name"},Ia={key:0,class:"screen-flash-overlay"},Sa={key:2,class:"zoom-controls"},Va=["max"],_a={class:"webcam-footer"},Ma={class:"camera-controls"},Ua=["disabled"],Da={class:"camera-icon-container"},ja={key:0,class:"camera-spinner"},Ta={key:1,class:"camera-body"},Na={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:Q}){const s=t,y=Q,d=w(null),m=w(null);let p=null,r=null;const g=w("environment"),S=w(!1),V=w(!1),k=w(!1),B=w(!1),Z=w(!1),h=w({}),I=w(!1),a=w(1),$=w(1),_=w(!1),E=ne(()=>{var R;return((R=s.settings)==null?void 0:R.max_size)||2048}),K=ne(()=>s.aspectRatio?{aspectRatio:`${s.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),D=ne(()=>{if(!s.aspectRatio)return{};const R=s.aspectRatio,O=R>1?80:60,ae=R>1?80/R:60*R;return{width:`${O}%`,height:`${ae}%`}}),ee=async()=>{p&&p.getTracks().forEach(R=>R.stop());try{const R={facingMode:g.value,width:{ideal:1280},height:{ideal:720},aspectRatio:{ideal:s.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};p=await navigator.mediaDevices.getUserMedia({video:R,audio:!1}),r=p.getVideoTracks()[0],d.value.srcObject=p,d.value.onloadedmetadata=async()=>{await T(),await d.value.play()}}catch(R){console.error("Error accessing camera: ",R),alert("Failed to access camera. Please allow camera permission."),y("close")}},Y=()=>{p&&p.getTracks().forEach(R=>R.stop()),y("close")},T=async()=>{if(r)try{const R=await navigator.mediaDevices.enumerateDevices();S.value=R.filter(ae=>ae.kind==="videoinput").length>1;const O=r.getCapabilities();O.zoom?(_.value=!0,$.value=O.zoom.max,console.log(`Zoom supported. Max zoom: ${$.value}`)):(_.value=!1,console.warn("Zoom is not supported by this camera.")),V.value=O.torch||O.fillLightMode&&O.fillLightMode.includes("torch")}catch(R){console.error("Error checking camera capabilities:",R)}},M=async R=>{if(!r)return;const O=d.value.getBoundingClientRect(),ae=R.clientX-O.left,le=R.clientY-O.top;Z.value=!0,h.value={left:`${ae}px`,top:`${le}px`,transform:"translate(-50%, -50%)"};try{if(r.getCapabilities().pointsOfInterest){const ge=ae/O.width,re=le/O.height;await r.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:ge,y:re}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(ce){console.warn("Manual focus failed:",ce)}setTimeout(()=>{Z.value=!1,r.getCapabilities().focusMode.includes("continuous")&&r.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},F=async R=>{if(!r||!_.value)return;const O=Math.min(Math.max(R,1),$.value);a.value=O;try{await r.applyConstraints({advanced:[{zoom:O}]})}catch(ae){console.error("Failed to set zoom:",ae)}},P=async()=>{if(!(!r||!V.value))try{g.value==="user"?(k.value=!k.value,B.value=k.value):(await r.applyConstraints({advanced:[{torch:!k.value}]}),k.value=!k.value)}catch(R){console.error("Flash toggle failed:",R)}},ue=async()=>{S.value&&(g.value=g.value==="environment"?"user":"environment",p&&p.getTracks().forEach(R=>R.stop()),await ee())},Ce=async R=>new Promise(O=>{const ae=E.value*1024;if(R.size<=ae){O(R);return}const le=new Image,ce=new FileReader;ce.onload=ge=>{le.onload=()=>{const re=document.createElement("canvas"),ye=re.getContext("2d"),L=Math.sqrt(ae/R.size);re.width=le.width*L,re.height=le.height*L,ye.drawImage(le,0,0,re.width,re.height);let fe=.9;const u=()=>{re.toBlob(C=>{C.size>ae&&fe>.1?(fe-=.1,u()):O(C)},"image/jpeg",fe)};u()},le.src=ge.target.result},ce.readAsDataURL(R)}),ke=async()=>{if(!(I.value||!d.value||!m.value)){I.value=!0;try{const R=d.value,O=m.value,ae=R.videoWidth,le=R.videoHeight;let ce,ge,re,ye;ae/le>s.aspectRatio?(ge=le,ce=le*s.aspectRatio,re=(ae-ce)/2,ye=0):(ce=ae,ge=ae/s.aspectRatio,re=0,ye=(le-ge)/2),O.width=ce,O.height=ge,O.getContext("2d").drawImage(R,re,ye,ce,ge,0,0,ce,ge);const fe=await new Promise(C=>{O.toBlob(C,"image/jpeg",1)}),u=await Ce(fe);if(u){const C=new File([u],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});y("photoCaptured",C),B.value=!0,setTimeout(()=>{B.value=!1},100)}}catch(R){console.error("Error capturing photo:",R),alert("Failed to capture photo. Please try again.")}finally{I.value=!1}}};return be(()=>s.show,R=>{R?ee():Y()}),ot(()=>{p&&p.getTracks().forEach(R=>R.stop())}),(R,O)=>{var ae;return t.show?(o(),n("div",xa,[e("div",wa,[e("div",ka,[e("p",$a,A(t.settings.camera_aspect_ratio),1),e("div",Ca,A(((ae=t.point)==null?void 0:ae.name)||"Camera"),1),e("button",{onClick:Y,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},O[2]||(O[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:Be(K.value),onClick:M,onTouchstart:M},[e("video",{ref_key:"webcamVideo",ref:d,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:m,class:"hidden"},null,512),B.value?(o(),n("div",Ia)):c("",!0),e("div",{class:"aspect-ratio-guide",style:Be(D.value)},null,4),Z.value?(o(),n("div",{key:1,class:"focus-indicator",style:Be(h.value)},O[3]||(O[3]=[e("div",{class:"focus-ring"},null,-1)]),4)):c("",!0),O[4]||(O[4]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),_.value?(o(),n("div",Sa,[Ne(e("input",{type:"range",min:"1",max:$.value,step:"0.1","onUpdate:modelValue":O[0]||(O[0]=le=>a.value=le),onInput:O[1]||(O[1]=le=>F(parseFloat(le.target.value))),class:"zoom-slider"},null,40,Va),[[Pe,a.value]])])):c("",!0)],36),e("div",_a,[e("div",Ma,[t.settings.enable_flash&&V.value?(o(),n("button",{key:0,onClick:P,class:se(["control-button",{active:k.value,disabled:!V.value}])},O[5]||(O[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):c("",!0),e("button",{onClick:ke,class:"capture-button",disabled:I.value},[e("div",Da,[I.value?(o(),n("div",ja)):(o(),n("div",Ta,O[6]||(O[6]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,Ua),t.settings.enable_camera_switch&&S.value?(o(),n("button",{key:1,onClick:ue,class:"control-button"},O[7]||(O[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):c("",!0)])])])])):c("",!0)}}},La=Ee(Na,[["__scopeId","data-v-d4ce43b5"]]),qa={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Aa={class:"w-full h-full flex flex-col"},Ba={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Ea=["disabled"],Ra={class:"text-lg font-semibold"},Fa={class:"flex items-center gap-2"},za=["disabled"],Oa=["disabled"],Ha={key:0,class:"bg-blue-900 bg-opacity-50 text-white p-3"},Ka={class:"flex items-center justify-between mb-2"},Wa={class:"text-xs"},Za={class:"w-full bg-blue-700 bg-opacity-50 rounded-full h-2"},Ga={class:"text-xs mt-1 text-blue-300"},Pa={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Ja=["src"],Xa={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Ya=["disabled"],Qa=["disabled"],eo={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},to={class:"flex justify-between items-center w-full"},so=["disabled"],ao={key:1,class:"flex-1"},oo=["disabled"],no={class:"flex gap-3 w-full"},io={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},lo={class:"flex items-center gap-2"},ro={key:0,class:"text-center"},uo={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(t,{emit:Q}){const s=t,y=Q,d=w(0),m=w([]),p=ne(()=>m.value.length>0?m.value[d.value]:null);be(()=>s.images,a=>{m.value=a.map($=>({...$,rotation:$.rotation||0})),a.length===0&&s.show&&B()},{deep:!0,immediate:!0}),be(()=>s.show,a=>{a&&s.images.length>0&&(d.value=s.initialIndex)}),be(()=>s.uploadProgress,a=>{a===100&&console.log("Upload completed")});const r=a=>a.preview||(a.image_path?`/${a.image_path}`:""),g=()=>{if(p.value&&!s.isUploading){const a=(p.value.rotation+90)%360;m.value[d.value].rotation=a,y("update:images",m.value)}},S=()=>{s.isUploading||(d.value=d.value<m.value.length-1?d.value+1:0)},V=()=>{s.isUploading||(d.value=d.value>0?d.value-1:m.value.length-1)},k=()=>{s.isUploading||y("saveImages",m.value)},B=()=>{s.isUploading||y("close")},Z=()=>{if(p.value&&!s.isUploading){const a=p.value,$=m.value.findIndex(_=>_.isNew&&a.isNew&&_.preview===a.preview||!_.isNew&&!a.isNew&&_.id===a.id);$!==-1&&(y("removePreviewImage",a),m.value.splice($,1),y("update:images",m.value)),d.value>=m.value.length&&(d.value=Math.max(0,m.value.length-1)),m.value.length===0&&y("close")}},h=()=>{s.isUploading||y("triggerAddMorePhotos")},I=a=>{a.key==="Escape"&&!s.isUploading&&B()};return Je(()=>{document.addEventListener("keydown",I)}),ot(()=>{document.removeEventListener("keydown",I)}),(a,$)=>{var _;return t.show?(o(),n("div",qa,[e("div",Aa,[e("div",Ba,[e("button",{onClick:B,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},$[0]||($[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ea),e("div",Ra,A(((_=t.point)==null?void 0:_.name)||"Preview")+" ("+A(d.value+1)+"/"+A(m.value.length)+") ",1),e("div",Fa,[p.value&&p.value.isNew?(o(),n("button",{key:0,onClick:Z,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:t.isUploading},$[1]||($[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,za)):c("",!0),p.value&&p.value.isNew?(o(),n("button",{key:1,onClick:g,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},$[2]||($[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,Oa)):c("",!0)])]),t.isUploading?(o(),n("div",Ha,[e("div",Ka,[$[3]||($[3]=e("span",{class:"text-sm font-medium"},"Mengupload gambar...",-1)),e("span",Wa,A(t.uploadProgress)+"%",1)]),e("div",Za,[e("div",{class:"bg-blue-400 h-2 rounded-full transition-all duration-300",style:Be({width:t.uploadProgress+"%"})},null,4)]),e("p",Ga,A(t.currentUpload)+"/"+A(t.totalUpload)+" gambar terupload",1)])):c("",!0),e("div",Pa,[e("div",{class:"relative w-full max-w-full",style:Be({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"})},[p.value?(o(),n("img",{key:0,src:r(p.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Be({transform:`rotate(${p.value.rotation}deg)`})},null,12,Ja)):c("",!0),p.value&&p.value.isUploading?(o(),n("div",Xa,$[4]||($[4]=[e("div",{class:"text-center text-white"},[e("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e("p",{class:"text-sm"},"Mengupload...")],-1)]))):c("",!0)],4),m.value.length>1&&!t.isUploading?(o(),n("button",{key:0,onClick:V,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},$[5]||($[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,Ya)):c("",!0),m.value.length>1&&!t.isUploading?(o(),n("button",{key:1,onClick:S,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},$[6]||($[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,Qa)):c("",!0)]),e("div",eo,[e("div",to,[p.value&&!p.value.isNew?(o(),n("button",{key:0,onClick:Z,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},$[7]||($[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),$e(" Hapus Foto ")]),8,so)):(o(),n("div",ao)),t.allowMultiple&&m.value.length<t.maxFiles&&!t.isUploading?(o(),n("button",{key:2,onClick:h,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},$[8]||($[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),$e(" Tambah Foto ")]),8,oo)):c("",!0)]),e("div",no,[t.isUploading?(o(),n("button",io,[e("div",lo,[$[9]||($[9]=e("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),e("span",null,"Mengupload... "+A(t.uploadProgress)+"%",1)])])):(o(),n("button",{key:0,onClick:k,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),t.isUploading?(o(),n("div",ro,$[10]||($[10]=[e("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):c("",!0)])])])):c("",!0)}}},co=Ee(uo,[["__scopeId","data-v-2a7c58b1"]]),go=["accept","multiple","disabled"],mo={class:"text-xs text-gray-500 mb-2"},po=["disabled"],vo={class:"h-full flex flex-col items-center justify-center p-4 text-center"},fo={class:"text-xs text-gray-400 mt-1"},ho={key:0,class:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},bo={class:"flex items-center justify-between mb-2"},yo={class:"text-xs text-blue-600"},xo={class:"w-full bg-blue-200 rounded-full h-2"},wo={class:"text-xs text-blue-600 mt-1"},ko={key:1,class:"flex items-center gap-4"},$o=["src"],Co={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Io=["disabled"],So={key:2,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Vo=["disabled"],_o=["onClick"],Mo=["src"],Uo={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Do={key:0},jo={key:1,class:"ml-1"},To={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},No={key:2,class:"mt-1 text-xs text-red-600"},Lo={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(t,{emit:Q}){const s=t,y=Q,d=w(null),m=w(null),p=w(!1),r=w(!1),g=w(!1),S=w([]),V=w(0),k=w(!1),B=w(0),Z=w(0),h=w(0),I=ts("imageSourceSetting",w("all")),a=`inspection-${s.inspectionId}-point-${s.pointId}-backup`,$=ne(()=>Number(s.settings.max_files)>1),_=ne(()=>s.settings.allowed_types.map(u=>`.${u}`).join(", ")),E=ne(()=>{const u=s.settings.camera_aspect_ratio.split(":");if(u.length===2){const C=parseFloat(u[0]),b=parseFloat(u[1]);if(!isNaN(C)&&!isNaN(b)&&b!==0)return C/b}return 3/4}),K=ne(()=>{const u=[],C=new Set;for(const b of s.modelValue)b.id&&C.add(b.id),u.push({...b,rotation:b.rotation||0,isNew:!1,isUploaded:!0,preview:b.preview||(b.image_path?`/${b.image_path}`:null)});for(const b of S.value)b.id&&C.add(b.id),u.push({...b,isUploading:b.isUploading||!1});return u}),D=u=>u.preview||(u.image_path?`/${u.image_path}`:""),ee=()=>{g.value&&(g.value=!1),I.value==="camera"?T():I.value==="gallery"?Y():p.value=!0},Y=()=>{p.value=!1,d.value.click()},T=()=>{p.value=!1,r.value=!0},M=()=>{p.value=!1,K.value.length>0&&(g.value=!0)},F=()=>{r.value=!1,K.value.length>0&&(g.value=!0)},P=()=>{g.value=!1,k.value||(S.value.forEach(u=>{u.preview&&u.preview.startsWith("blob:")&&URL.revokeObjectURL(u.preview)}),S.value=[])},ue=u=>new Promise(C=>{const b=new FileReader;b.onload=q=>{const W=new Image;W.onload=()=>{C({file:u,preview:URL.createObjectURL(u),rotation:0,width:W.naturalWidth,height:W.naturalHeight,isNew:!0})},W.onerror=()=>{console.error("Failed to load image for dimensions:",u.name),C({file:u,preview:URL.createObjectURL(u),rotation:0,width:0,height:0,isNew:!0})},W.src=q.target.result},b.readAsDataURL(u)}),Ce=u=>{const C=u.name.split(".").pop().toLowerCase();return s.settings.allowed_types.includes(C)},ke=async u=>{const b=(s.settings.max_size||2048)*1024;return new Promise(q=>{const W=new Image,me=new FileReader;me.onload=oe=>{W.onload=()=>{const G=document.createElement("canvas"),ie=G.getContext("2d"),pe=Math.max(W.width,W.height);G.width=pe,G.height=pe,ie.fillStyle="white",ie.fillRect(0,0,pe,pe);const x=(pe-W.width)/2,v=(pe-W.height)/2;ie.drawImage(W,x,v,W.width,W.height);let j=.9;const H=()=>{G.toBlob(N=>{if(N.size>b&&j>.1)j-=.1,H();else{const he=new File([N],u.name,{type:"image/jpeg",lastModified:Date.now()});q(he)}},"image/jpeg",j)};H()},W.src=oe.target.result},me.readAsDataURL(u)})},R=async u=>{const C=Array.from(u.target.files);if(!C.length){p.value=!1,K.value.length>0&&(g.value=!0);return}try{const b=C.filter(ie=>!Ce(ie));if(b.length>0){const ie=b.map(pe=>pe.name.split(".").pop()).join(", ");alert(`File type not allowed: ${ie}. Allowed types: ${s.settings.allowed_types.join(", ")}`),u.target.value="";return}const q=K.value.length,W=s.settings.max_files-q,me=await Promise.all(C.slice(0,W).map(async ie=>await ke(ie))),oe=await Promise.all(me.map(ue)),G=$.value?oe:oe.slice(0,1);$.value?S.value.push(...G):(S.value.forEach(ie=>{ie.preview&&ie.preview.startsWith("blob:")&&URL.revokeObjectURL(ie.preview)}),S.value=G),p.value=!1,G.length>0?(V.value=Math.max(0,K.value.length-G.length),g.value=!0):K.value.length>0&&(g.value=!0),u.target.value=""}catch(b){console.error("Error processing selected images:",b),alert("Failed to process selected images. Please try again."),p.value=!1,K.value.length>0&&(g.value=!0)}},O=async u=>{const C=K.value.length;if(!$.value||C<s.settings.max_files)try{const b=await ke(u),q=new Image;q.onload=()=>{const W={file:b,preview:URL.createObjectURL(b),rotation:0,width:q.naturalWidth,height:q.naturalHeight,isNew:!0};$.value?S.value.push(W):(S.value.forEach(me=>{me.preview&&me.preview.startsWith("blob:")&&URL.revokeObjectURL(me.preview)}),S.value=[W]),r.value=!1,p.value=!1,V.value=K.value.length-1,g.value=!0},q.src=URL.createObjectURL(b)}catch(b){console.error("Error processing captured image:",b),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${s.settings.max_files} files allowed.`),r.value=!1,p.value=!1,K.value.length>0&&(g.value=!0)},ae=(u=0)=>{V.value=u,g.value=!0},le=u=>new Promise(C=>{if(u.rotation===0||!m.value){if(!u.isNew&&!u.file){C({file:null,width:u.width,height:u.height,isOriginal:!0});return}C({file:u.file,width:u.width,height:u.height});return}const b=new Image;b.onload=async()=>{try{const q=m.value,W=q.getContext("2d"),me=b.width,oe=b.height;let G,ie;u.rotation===90||u.rotation===270?(G=oe,ie=me):(G=me,ie=oe),q.width=G,q.height=ie,W.clearRect(0,0,q.width,q.height),W.translate(q.width/2,q.height/2),W.rotate(u.rotation*Math.PI/180),W.drawImage(b,-me/2,-oe/2,me,oe),W.setTransform(1,0,0,1,0,0);const pe=await new Promise(j=>{q.toBlob(j,"image/jpeg",.9)}),x=new File([pe],u.file?u.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),v=await ke(x);C({file:v,width:G,height:ie})}catch(q){console.error("Error processing rotated image:",q),C({file:u.file,width:u.width,height:u.height})}},b.onerror=()=>{console.error("Failed to load image for rotation processing:",u.preview),C({file:u.file,width:u.width,height:u.height})},b.src=u.preview}),ce=u=>{try{const C={images:u.map(b=>{var q;return{fileName:((q=b.file)==null?void 0:q.name)||`image-${Date.now()}.jpg`,rotation:b.rotation||0,width:b.width||0,height:b.height||0,timestamp:Date.now()}}),inspectionId:s.inspectionId,pointId:s.pointId};localStorage.setItem(a,JSON.stringify(C))}catch(C){console.error("Error saving backup:",C)}},ge=()=>{localStorage.removeItem(a)},re=async u=>{k.value=!0;const C=[],b=[];if(!s.pointId){alert("Error: Point ID is missing. Cannot upload image."),k.value=!1;return}try{ce(u);for(const q of u){if(!q.isNew&&q.rotation===0&&q.id&&q.image_path){C.push({id:q.id,image_path:q.image_path,width:q.width,height:q.height,rotation:0,preview:q.preview,isUploaded:!0});continue}const{file:W,width:me,height:oe,isOriginal:G}=await le(q);if(G&&!q.isNew){C.push({id:q.id,image_path:q.image_path,width:q.width,height:q.height,rotation:q.rotation||0,preview:q.preview,isUploaded:!0});continue}W&&b.push({file:W,width:me,height:oe,rotation:q.rotation||0,originalImage:q})}P(),b.length>0?await ye(b,C):(y("update:modelValue",C),y("save",s.pointId))}catch(q){console.error("Error during image processing:",q),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{k.value=!1}},ye=async(u,C)=>{var b,q,W,me;h.value=u.length,Z.value=0,B.value=0;try{const oe=new FormData;oe.append("inspection_id",s.inspectionId),oe.append("point_id",s.pointId),u.forEach((x,v)=>{oe.append("images[]",x.file);const j=S.value.findIndex(H=>{var N;return H.preview===((N=x.originalImage)==null?void 0:N.preview)});j!==-1&&(S.value[j].isUploading=!0)});const ie=(await _t.post(route("inspections.upload-image"),oe,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:x=>{x.total&&(B.value=Math.round(x.loaded*100/x.total),Z.value=Math.floor(x.loaded/x.total*u.length))}})).data.images,pe=[...C];for(let x=0;x<ie.length;x++){const v=ie[x],j=(b=u[x])==null?void 0:b.originalImage;pe.push({id:v.image_id,image_path:v.path,width:v.width||(j==null?void 0:j.width)||0,height:v.height||(j==null?void 0:j.height)||0,rotation:((q=u[x])==null?void 0:q.rotation)||0,preview:v.public_url,isUploaded:!0}),j!=null&&j.preview&&j.preview.startsWith("blob:")&&URL.revokeObjectURL(j.preview)}S.value=S.value.filter(x=>!u.some(v=>{var j;return((j=v.originalImage)==null?void 0:j.preview)===x.preview})),y("update:modelValue",pe),y("save",s.pointId),y("uploaded",{pointId:s.pointId,images:pe,newImagesCount:ie.length}),ge(),console.log(`✅ Successfully uploaded ${ie.length} images`)}catch(oe){throw console.error("Error uploading images:",oe),S.value.forEach(G=>{G.isUploading=!1}),(me=(W=oe.response)==null?void 0:W.data)!=null&&me.message?alert(`Upload gagal: ${oe.response.data.message}. Data tersimpan secara lokal.`):alert(`Upload gagal: ${oe.message}. Data tersimpan secara lokal.`),oe}finally{B.value=0,Z.value=0,h.value=0}},L=u=>{if(u){if(u.id&&!u.isNew)fe(u);else{const C=S.value.findIndex(b=>b.preview&&b.preview===u.preview&&b.isNew||b.id&&b.id===u.id);if(C!==-1){const b=S.value.splice(C,1)[0];b.preview&&b.preview.startsWith("blob:")&&URL.revokeObjectURL(b.preview)}y("update:modelValue",s.modelValue.filter(b=>!(b.id&&b.id===u.id)&&!(b.preview&&b.preview===u.preview)))}V.value>=K.value.length&&(V.value=Math.max(0,K.value.length-1)),K.value.length===0&&P()}},fe=async u=>{var b,q;if(u.id||u.image_path)try{await _t.delete(route("inspections.delete-image"),{data:{image_id:u.id,image_path:u.image_path}})}catch(W){console.error("Error deleting image from server:",W),(q=(b=W.response)==null?void 0:b.data)!=null&&q.message?alert(`Failed to delete image from server: ${W.response.data.message}`):alert(`Failed to delete image from server: ${W.message}`);return}u.preview&&u.preview.startsWith("blob:")&&URL.revokeObjectURL(u.preview);const C=s.modelValue.filter(W=>W.id!==u.id);y("update:modelValue",C),S.value=S.value.filter(W=>W.isNew&&u.isNew?W.preview!==u.preview:W.id!==u.id),y("removeImage",{image:u}),g.value&&K.value.length===0?P():g.value&&V.value>=K.value.length&&(V.value=Math.max(0,K.value.length-1))};return Je(()=>{try{localStorage.getItem(a)&&console.log("Found backup images, ready for recovery if needed")}catch(u){console.error("Error loading backup:",u)}}),(u,C)=>(o(),n("div",null,[e("input",{ref_key:"galleryInput",ref:d,type:"file",accept:_.value,class:"hidden",onChange:R,multiple:$.value,disabled:k.value},null,40,go),e("canvas",{ref_key:"processingCanvas",ref:m,class:"hidden"},null,512),e("p",mo,"Foto Maksimal: "+A(t.settings.max_files)+" | Rasio: "+A(t.settings.camera_aspect_ratio),1),K.value.length===0?(o(),n("label",{key:0,onClick:ee,class:se(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:k.value},[e("div",vo,[C[2]||(C[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),C[3]||(C[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),e("p",fo,"Tipe: "+A(_.value),1)])],8,po)):(o(),n("div",{key:1,class:se(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[k.value?(o(),n("div",ho,[e("div",bo,[C[4]||(C[4]=e("span",{class:"text-sm font-medium text-blue-700"},"Mengupload gambar...",-1)),e("span",yo,A(B.value)+"%",1)]),e("div",xo,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Be({width:B.value+"%"})},null,4)]),e("p",wo,A(Z.value)+"/"+A(h.value)+" gambar terupload",1)])):c("",!0),t.settings.max_files===1?(o(),n("div",ko,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:C[0]||(C[0]=b=>ae(0))},[e("img",{src:D(K.value[0]),class:"w-full h-full object-cover"},null,8,$o),K.value[0].isUploading?(o(),n("div",Co,C[5]||(C[5]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0)]),e("button",{onClick:C[1]||(C[1]=at(b=>fe(K.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:k.value},C[6]||(C[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),$e(" Hapus Foto ")]),8,Io)])):(o(),n("div",So,[$.value&&K.value.length<t.settings.max_files?(o(),n("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:ee,disabled:k.value},C[7]||(C[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Vo)):c("",!0),(o(!0),n(Me,null,Ue(K.value,(b,q)=>(o(),n("div",{key:b.id||b.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:W=>ae(q)},[e("img",{src:D(b),class:"w-full h-full object-cover"},null,8,Mo),b.isNew||b.rotation!==0?(o(),n("div",Uo,[b.isNew?(o(),n("span",Do,"BARU")):c("",!0),b.rotation!==0?(o(),n("span",jo,"ROTASI")):c("",!0)])):c("",!0),b.isUploading?(o(),n("div",To,C[8]||(C[8]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0)],8,_o))),128))]))],2)),t.error?(o(),n("p",No,A(t.error),1)):c("",!0),_e(ya,{show:p.value,settings:t.settings,onClose:M,onOpenWebcam:T,onTriggerGallery:Y},null,8,["show","settings"]),_e(La,{show:r.value,"aspect-ratio":E.value,settings:t.settings,point:t.point,onClose:F,onPhotoCaptured:O},null,8,["show","aspect-ratio","settings","point"]),_e(co,{show:g.value,images:K.value,point:t.point,"initial-index":V.value,"allow-multiple":$.value,"max-files":t.settings.max_files,"is-uploading":k.value,"aspect-ratio":E.value,"upload-progress":B.value,"current-upload":Z.value,"total-upload":h.value,onClose:P,onSaveImages:re,onRemovePreviewImage:L,onTriggerAddMorePhotos:ee},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},gt=Ee(Lo,[["__scopeId","data-v-5786fae2"]]),qo={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Ao={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Bo={class:"px-4 pb-2 border-b border-gray-200"},Eo={class:"text-lg font-semibold text-gray-900"},Ro={key:0,class:"text-sm text-gray-500 mt-1"},Fo={class:"flex-1 overflow-y-auto p-4"},zo={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Oo={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:Q}){const s=Q,y=()=>{s("close")},d=m=>{m.key==="Escape"&&y()};return Je(()=>{document.addEventListener("keydown",d)}),ot(()=>{document.removeEventListener("keydown",d)}),(m,p)=>(o(),Ve(lt,{name:"bottom-sheet"},{default:qe(()=>[t.show?(o(),n("div",qo,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:y}),e("div",Ao,[p[0]||(p[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Bo,[e("h3",Eo,A(t.title),1),t.subtitle?(o(),n("p",Ro,A(t.subtitle),1)):c("",!0)]),e("div",Fo,[Mt(m.$slots,"default",{},void 0,!0)]),m.$slots.footer?(o(),n("div",zo,[Mt(m.$slots,"footer",{},void 0,!0)])):c("",!0)])])):c("",!0)]),_:3}))}},Ft=Ee(Oo,[["__scopeId","data-v-d08f0b98"]]),Ho={class:"space-y-4"},Ko={key:0,class:"mt-2"},Wo={key:1,class:"mt-2"},Zo={key:2,class:"mt-2"},Go={key:3,class:"mt-2"},Po={key:4,class:"mt-2"},Jo={class:"text-sm font-medium text-gray-700 mb-2"},Xo={key:0,class:"text-red-500"},Yo={key:0,class:"text-xs text-red-500"},Qo=["name","value","checked"],en={key:6,class:"space-y-2"},tn={key:0,class:"text-red-500"},sn={key:1,class:"text-xs text-red-500"},an={key:7,class:"mt-4"},on={class:"text-sm font-medium text-gray-700 mb-2"},nn={key:0,class:"text-red-500"},ln={key:0,class:"text-xs text-red-500"},rn={class:"flex gap-2"},dn=["disabled"],mt={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(t,{emit:Q}){const s=t,y=Q,d=r=>y("hapus",r),m=ne(()=>s.options.find(r=>r.value===s.selectedValue)),p=ne(()=>{var g,S,V,k,B,Z,h;if(s.point.input_type==="text"&&(!((g=s.notesValue)!=null&&g.trim())||s.point.settings.min_length&&s.notesValue.length<s.point.settings.min_length||s.point.settings.max_length&&s.notesValue.length>s.point.settings.max_length)||s.point.input_type==="number"&&(!((S=s.notesValue)!=null&&S.trim())||s.point.settings.min&&s.notesValue.length<s.point.settings.min||s.point.settings.max&&s.notesValue.length>s.point.settings.max)||s.point.input_type==="account"&&(!((V=s.notesValue)!=null&&V.trim())||s.point.settings.min_value&&s.notesValue.length<s.point.settings.min_value||s.point.settings.max_value&&s.notesValue.length>s.point.settings.max_value)||s.point.input_type==="date"&&(!((k=s.notesValue)!=null&&k.trim())||s.point.settings.min_date&&s.notesValue.length<s.point.settings.min_date||s.point.settings.max_date&&s.notesValue.length>s.point.settings.max_date)||s.point.input_type==="imageTOradio"&&s.imagesValue.length===0||s.options.length&&!s.selectedValue)return!1;const r=m.value;return!(s.showTextarea&&((B=r==null?void 0:r.settings)!=null&&B.show_textarea)&&(!((Z=s.notesValue)!=null&&Z.trim())||r.settings.min_length&&s.notesValue.length<r.settings.min_length||r.settings.max_length&&s.notesValue.length>r.settings.max_length)||s.showImageUpload&&((h=r==null?void 0:r.settings)!=null&&h.show_image_upload)&&(s.imagesValue.length===0||r.settings.max_files&&s.imagesValue.length>r.settings.max_files))});return(r,g)=>(o(),Ve(Ft,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:g[18]||(g[18]=S=>r.$emit("close"))},{footer:qe(()=>[t.selectedPoint?(o(),n("button",{key:0,onClick:g[15]||(g[15]=S=>d(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},g[20]||(g[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),$e(" Hapus Data ")]))):c("",!0),e("div",rn,[e("button",{type:"button",onClick:g[16]||(g[16]=S=>r.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:g[17]||(g[17]=S=>r.$emit("save")),disabled:!p.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,dn)])]),default:qe(()=>{var S,V,k,B,Z,h,I,a,$,_,E,K,D,ee,Y,T,M,F,P,ue,Ce,ke,R,O,ae,le,ce,ge,re,ye;return[e("div",Ho,[t.point.input_type==="text"?(o(),n("div",Ko,[_e(qt,{"model-value":t.notesValue,required:(S=t.point.settings)==null?void 0:S.is_required,"min-length":(V=t.point.settings)==null?void 0:V.min_length,"max-length":(k=t.point.settings)==null?void 0:k.max_length,allowSpace:(B=t.point.settings)==null?void 0:B.allow_space,textTransform:(Z=t.point.settings)==null?void 0:Z.text_transform,placeholder:((h=t.point.settings)==null?void 0:h.placeholder)||"Masukan text",error:r.error,"onUpdate:modelValue":g[0]||(g[0]=L=>r.$emit("update:notesValue",L)),onSave:g[1]||(g[1]=L=>r.$emit("saveText",L))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):c("",!0),t.point.input_type==="number"?(o(),n("div",Wo,[_e(At,{"model-value":t.notesValue,required:(I=t.point.settings)==null?void 0:I.is_required,min:(a=t.point.settings)==null?void 0:a.min,max:($=t.point.settings)==null?void 0:$.max,step:((_=t.point.settings)==null?void 0:_.step)||1,placeholder:((E=t.point.settings)==null?void 0:E.placeholder)||"Masukan number",error:r.error,"onUpdate:modelValue":g[2]||(g[2]=L=>r.$emit("update:notesValue",L)),onSave:g[3]||(g[3]=L=>r.$emit("saveNumber",L))},null,8,["model-value","required","min","max","step","placeholder","error"])])):c("",!0),t.point.input_type==="account"?(o(),n("div",Zo,[_e(Et,{"model-value":t.notesValue,required:(K=t.point.settings)==null?void 0:K.is_required,placeholder:((D=t.point.settings)==null?void 0:D.placeholder)||"Masukkan nilai",error:r.error,"point-id":t.pointId,settings:t.point.settings,"onUpdate:modelValue":g[4]||(g[4]=L=>r.$emit("update:notesValue",L)),onSave:g[5]||(g[5]=L=>r.$emit("saveAccount",L))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):c("",!0),t.point.input_type==="date"?(o(),n("div",Go,[_e(Bt,{"model-value":t.notesValue,required:(ee=t.point.settings)==null?void 0:ee.is_required,"min-date":(Y=t.point.settings)==null?void 0:Y.min_date,"max-date":(T=t.point.settings)==null?void 0:T.max_date,error:r.error,"onUpdate:modelValue":g[6]||(g[6]=L=>r.$emit("update:notesValue",L)),onSave:g[7]||(g[7]=L=>r.$emit("saveDate",L))},null,8,["model-value","required","min-date","max-date","error"])])):c("",!0),t.point.input_type==="imageTOradio"?(o(),n("div",Po,[e("h4",Jo,[(M=t.point.settings)!=null&&M.required?(o(),n("span",Xo,"*")):c("",!0)]),_e(gt,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point.inspection_point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":g[8]||(g[8]=L=>r.$emit("update:imagesValue",L)),onSave:g[9]||(g[9]=L=>r.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(F=t.point.settings)!=null&&F.required&&t.imagesValue.length===0?(o(),n("p",Yo," Foto wajib diupload ")):c("",!0)])):c("",!0),t.options.length?(o(),n("div",{key:5,class:se(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Me,null,Ue(t.options,(L,fe)=>(o(),n("label",{key:fe,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:L.value,checked:t.selectedValue===L.value,onChange:g[10]||(g[10]=u=>r.$emit("update:selectedValue",u.target.value)),class:"hidden peer"},null,40,Qo),e("div",{class:se(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===L.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==L.value}])},A(L.label),3)]))),128))],2)):c("",!0),t.showTextarea&&((ue=(P=m.value)==null?void 0:P.settings)!=null&&ue.show_textarea)?(o(),n("div",en,[(Ce=m.value.settings)!=null&&Ce.required?(o(),n("span",tn,"*")):c("",!0),_e(Rt,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:m.value.settings,required:(ke=m.value.settings)==null?void 0:ke.required,"min-length":(R=m.value.settings)==null?void 0:R.min_length,"max-length":(O=m.value.settings)==null?void 0:O.max_length,placeholder:((ae=m.value.settings)==null?void 0:ae.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":g[11]||(g[11]=L=>r.$emit("update:notesValue",L)),onSave:g[12]||(g[12]=L=>r.$emit("saveTextarea",L))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(le=m.value.settings)!=null&&le.required&&!t.notesValue?(o(),n("p",sn," Keterangan wajib diisi ")):c("",!0)])):c("",!0),t.showImageUpload&&((ge=(ce=m.value)==null?void 0:ce.settings)!=null&&ge.show_image_upload)?(o(),n("div",an,[e("h4",on,[g[19]||(g[19]=$e(" Upload Foto ")),(re=m.value.settings)!=null&&re.required?(o(),n("span",nn,"*")):c("",!0)]),_e(gt,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:m.value.settings,"onUpdate:modelValue":g[13]||(g[13]=L=>r.$emit("update:imagesValue",L)),onSave:g[14]||(g[14]=L=>r.$emit("saveImage",L))},null,8,["model-value","point-id","point","inspection-id","settings"]),(ye=m.value.settings)!=null&&ye.required&&t.imagesValue.length===0?(o(),n("p",ln," Foto wajib diupload ")):c("",!0)])):c("",!0)])]}),_:1},8,["show","title","subtitle"]))}},un={class:"mt-2 space-y-2"},cn=["name","value","checked","onChange","required"],gn={key:0,class:"p-2 rounded-lg bg-gray-50"},mn={key:0,class:"mt-2"},pn={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},vn=["src"],fn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},hn={key:1,class:"mt-2"},bn={class:"text-sm text-gray-600"},yn={key:2,class:"mt-2 text-sm text-red-600"},xn={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:Q}){const s=t,y=Q,d=w(s.notes),m=w([...s.images]),p=w(!1),r=w(""),g=w([]),S=w(""),V=w([]),k=ne(()=>s.options.find(D=>D.value===s.modelValue)),B=D=>D.settings&&(D.settings.show_textarea||D.settings.show_image_upload);be(()=>s.notes,D=>{d.value=D}),be(()=>s.images,D=>{m.value=[...D]}),be(()=>s.modelValue,D=>{D&&(S.value=D)});const Z=D=>{y("update:modelValue",D.value),B(D)?I():y("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:D.value,notes:"",images:[]})},h=D=>D.preview||(D.image_path?`/${D.image_path}`:D),I=()=>{S.value=s.modelValue,r.value=d.value,g.value=[...m.value],V.value=[...m.value],p.value=!0},a=()=>{r.value="",g.value=[],S.value="",p.value=!1},$=D=>{g.value=D,m.value=[...D],y("update:images",[...D]),y("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:d.value,images:[...D]})},_=D=>{},E=()=>{S.value!==s.modelValue&&y("update:modelValue",S.value),d.value=r.value,y("update:notes",r.value),m.value=[...g.value],y("update:images",[...g.value]),y("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:S.value,notes:r.value,images:g.value}),p.value=!1},K=D=>{S.value="",r.value="",g.value=[],d.value="",m.value=[],y("update:modelValue",""),y("update:notes",""),y("update:images",[]),y("hapus",D),p.value=!1};return(D,ee)=>{var Y,T,M,F;return o(),n("div",un,[e("div",{class:se(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Me,null,Ue(t.options,(P,ue)=>(o(),n("label",{key:ue,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:P.value,checked:t.modelValue===P.value,onChange:Ce=>Z(P),class:"hidden peer",required:t.required},null,40,cn),e("div",{class:se(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===P.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==P.value}])},A(P.label),3)]))),128))],2),t.modelValue&&k.value&&B(k.value)?(o(),n("div",gn,[e("div",{class:"flex justify-between items-start"},[ee[4]||(ee[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:I,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((Y=k.value.settings)!=null&&Y.show_image_upload)?(o(),n("div",mn,[e("div",pn,[(o(!0),n(Me,null,Ue(t.images,(P,ue)=>(o(),n("div",{key:ue,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:h(P),class:"w-full h-full object-cover rounded"},null,8,vn),ue===3&&t.images.length>4?(o(),n("span",fn," +"+A(t.images.length-4),1)):c("",!0)]))),128))])])):c("",!0),t.notes&&((T=k.value.settings)!=null&&T.show_textarea)?(o(),n("div",hn,[e("p",bn,A(t.notes),1)])):c("",!0)])):c("",!0),p.value?(o(),Ve(mt,{key:(M=t.selectedPoint)==null?void 0:M.id,show:p.value,title:t.pointName||"Detail",subtitle:(F=k.value)==null?void 0:F.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":S.value,"notes-value":r.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":ee[0]||(ee[0]=P=>S.value=P),"onUpdate:notesValue":ee[1]||(ee[1]=P=>r.value=P),"onUpdate:imagesValue":ee[2]||(ee[2]=P=>$(P)),onClose:a,onSave:E,onSaveTextarea:D.handleTextareaSave,onSaveImage:_,onHapus:ee[3]||(ee[3]=P=>K(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):c("",!0),t.error?(o(),n("p",yn,A(t.error),1)):c("",!0)])}}},wn={class:"mt-2 space-y-2"},kn={key:0,class:"flex flex-wrap gap-3"},$n={key:1,class:"p-2"},Cn={key:0,class:"mt-2"},In={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Sn=["src"],Vn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},_n=["name","value","checked"],Mn={key:1,class:"mt-2"},Un={class:"text-sm text-gray-600"},Dn={key:3,class:"mt-2 text-sm text-red-600"},jn={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:Q}){const s=t,y=Q,d=w(s.notes),m=w([...s.images]),p=w(!1),r=w(""),g=w([]),S=w(""),V=w([]),k=ne(()=>s.options.find(_=>_.value===s.modelValue)),B=_=>_.preview||(_.image_path?`/${_.image_path}`:_);be(()=>s.notes,_=>{d.value=_});const Z=()=>{S.value=s.modelValue||"",r.value=d.value,g.value=[...m.value],V.value=[...m.value],p.value=!0},h=()=>{r.value="",g.value=[],S.value="",p.value=!1},I=_=>{g.value=_,m.value=[..._],y("update:images",[..._]),y("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:s.modelValue,notes:d.value,images:[..._]})},a=()=>{S.value!==s.modelValue&&y("update:modelValue",S.value),d.value=r.value,y("update:notes",r.value),m.value=[...g.value],y("update:images",[...g.value]),y("save",{pointId:s.pointId,inspectionId:s.inspectionId,value:S.value,notes:r.value,images:g.value}),p.value=!1},$=_=>{S.value="",r.value="",g.value=[],d.value="",m.value=[],y("update:modelValue",""),y("update:notes",""),y("update:images",[]),y("hapus",_),p.value=!1};return(_,E)=>{var K,D,ee;return o(),n("div",wn,[!t.modelValue&&m.value.length===0&&!d.value?(o(),n("div",kn,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:Z},E[4]||(E[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(o(),n("div",$n,[e("div",{class:"flex justify-between items-start"},[E[5]||(E[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:Z,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),m.value.length>0?(o(),n("div",Cn,[e("div",In,[(o(!0),n(Me,null,Ue(m.value,(Y,T)=>(o(),n("div",{key:T,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:B(Y),class:"w-full h-full object-cover rounded"},null,8,Sn),T===3&&m.value.length>4?(o(),n("span",Vn," +"+A(m.value.length-4),1)):c("",!0)]))),128))])])):c("",!0),e("div",{class:se(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(o(!0),n(Me,null,Ue(t.options,(Y,T)=>(o(),n("label",{key:T,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:Y.value,checked:t.modelValue===Y.value,disabled:!0,class:"hidden peer"},null,8,_n),e("div",{class:se(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===Y.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==Y.value}])},A(Y.label),3)]))),128))],2),d.value&&((K=k.value.settings)!=null&&K.show_textarea)?(o(),n("div",Mn,[e("p",Un,A(d.value),1)])):c("",!0)])),p.value?(o(),Ve(mt,{key:(D=t.selectedPoint)==null?void 0:D.id,show:p.value,title:t.pointName||"Detail",subtitle:(ee=k.value)==null?void 0:ee.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":S.value,"notes-value":r.value,"images-value":g.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":E[0]||(E[0]=Y=>S.value=Y),"onUpdate:notesValue":E[1]||(E[1]=Y=>r.value=Y),"onUpdate:imagesValue":E[2]||(E[2]=Y=>I(Y)),onClose:h,onSave:a,onHapus:E[3]||(E[3]=Y=>$(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):c("",!0),t.error?(o(),n("p",Dn,A(t.error),1)):c("",!0)])}}},Tn={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Nn={class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},Ln={class:"text-xl font-semibold text-indigo-700"},qn={class:"p-4 space-y-4"},An={class:"flex items-start justify-between"},Bn={class:"block text-sm font-medium text-gray-700"},En={key:0,class:"text-red-500"},Rn={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Fn={key:0,class:"text-center py-8 text-gray-500"},zn={key:0,class:"text-xs text-gray-400"},On={__name:"CategoryCadangan",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(t,{emit:Q}){const s=t,y=Q,d=w(!1),m=ss(),p=ne(()=>(s.category.points||[]).some(h=>h.is_default===!1)),r=ne(()=>{var I;if(console.log("CategorySection - Filtering points:",{categoryName:s.category.name,isDamageMenu:s.category.isDamageMenu,allPoints:s.category.points,allPointsCount:(I=s.category.points)==null?void 0:I.length}),!s.category.isDamageMenu){const a=(s.category.points||[]).filter($=>{var K;const _=(K=$.inspection_point)==null?void 0:K.id,E=g(_);return d.value||$.is_default||E?!0:(console.log(`Non-damage Point ${_}: is_default=${$.is_default}, hasData=${E}`),!1)});return console.log("Filtered non-damage points:",a),a}const h=(s.category.points||[]).filter(a=>{var E;const $=(E=a.inspection_point)==null?void 0:E.id,_=g($);return d.value||a.is_default||!a.is_default&&_?!0:(console.log(`Damage Point ${$}: hasData=${_}`),_)});return console.log("Filtered damage points:",h),h}),g=h=>{if(!h)return console.log("hasPointData: pointId is null/undefined"),!1;const I=m.props.existingResults[h]!==void 0,a=m.props.existingImages[h]&&m.props.existingImages[h].length>0,$=s.form.results[h]&&(s.form.results[h].status||s.form.results[h].note),_=s.form.images[h]&&s.form.images[h].length>0,E=I||a||$||_;return console.log(`Point ${h} data check:`,{hasServerResult:I,hasServerImages:a,hasLocalResult:$,hasLocalImages:_,finalResult:E}),E},S=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],V=h=>{var $,_,E,K,D,ee,Y,T,M;const I=s.form.results[($=h.inspection_point)==null?void 0:$.id],a=s.form.images[(_=h.inspection_point)==null?void 0:_.id];if(!I)return!1;switch(h.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!I.note;case"select":case"radio":if(!I.status)return!1;const F=(K=(E=h.settings)==null?void 0:E.radios)==null?void 0:K.find(ue=>ue.value===I.status);return!(F!=null&&F.settings&&(F.settings.show_textarea&&!((D=I.note)!=null&&D.trim())||F.settings.show_image_upload&&(a==null?void 0:a.length)===0));case"imageTOradio":if((a==null?void 0:a.length)===0||!I.status)return!1;const P=(Y=(ee=h.settings)==null?void 0:ee.radios)==null?void 0:Y.find(ue=>ue.value===I.status);return!(P!=null&&P.settings&&P.settings.show_textarea&&!((T=I.note)!=null&&T.trim()));case"image":return(a==null?void 0:a.length)>0;default:return!!I.status||!!((M=I.note)!=null&&M.trim())}};be(()=>s.form.results,h=>{Object.keys(h).forEach(I=>{!h[I]||!h[I].status&&h[I].note})},{deep:!0}),be(()=>s.form.images,h=>{Object.keys(h).forEach(I=>{!h[I]||h[I].length})},{deep:!0});const k=(h,I,a)=>{y("updateResult",{pointId:h,type:a,value:I})},B=h=>{y("saveResult",h)},Z=h=>{y("hapusPoint",h)};return(h,I)=>(o(),n("div",Tn,[e("div",Nn,[e("h3",Ln,A(t.category.name),1),p.value?(o(),n("button",{key:0,onClick:I[0]||(I[0]=a=>d.value=!d.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},A(d.value?"Sembunyikan Point Yang Tidak Perlu":"Tampilkan Point Tersembunyi"),1)):c("",!0)]),e("div",qn,[(o(!0),n(Me,null,Ue(r.value,a=>{var $,_,E,K,D,ee,Y,T,M,F,P,ue,Ce,ke,R,O,ae,le,ce,ge,re,ye,L,fe,u,C,b,q,W,me,oe,G,ie,pe,x,v,j,H,N,he,we,xe,Re,Oe,Xe,Ye,Qe,nt,Ke,et,tt,We,Ie,Te,He,Ze;return o(),n("div",{key:a.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",An,[e("label",Bn,[$e(A(($=a.inspection_point)==null?void 0:$.name)+" ",1),(_=a.settings)!=null&&_.is_required?(o(),n("span",En,"*")):c("",!0)]),V(a)?(o(),n("span",Rn," ✓ ")):c("",!0)]),a.input_type==="text"?(o(),Ve(qt,{key:0,modelValue:t.form.results[(E=a.inspection_point)==null?void 0:E.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(K=a.settings)==null?void 0:K.is_required,"min-length":(D=a.settings)==null?void 0:D.min_length,"max-length":(ee=a.settings)==null?void 0:ee.max_length,allowSpace:(Y=a.settings)==null?void 0:Y.allow_space,textTransform:(T=a.settings)==null?void 0:T.text_transform,placeholder:((M=a.settings)==null?void 0:M.placeholder)||"Masukan text",error:t.form.errors[`results.${(F=a.inspection_point)==null?void 0:F.id}.note`],onSave:z=>{var f;return B((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):c("",!0),a.input_type==="number"?(o(),Ve(At,{key:1,modelValue:t.form.results[(P=a.inspection_point)==null?void 0:P.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(ue=a.settings)==null?void 0:ue.is_required,min:(Ce=a.settings)==null?void 0:Ce.min,max:(ke=a.settings)==null?void 0:ke.max,step:((R=a.settings)==null?void 0:R.step)||1,placeholder:((O=a.settings)==null?void 0:O.placeholder)||"Masukan number",error:t.form.errors[`results.${(ae=a.inspection_point)==null?void 0:ae.id}.note`],onSave:z=>{var f;return B((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):c("",!0),a.input_type==="account"?(o(),Ve(Et,{key:2,modelValue:t.form.results[(le=a.inspection_point)==null?void 0:le.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(ce=a.settings)==null?void 0:ce.is_required,placeholder:((ge=a.settings)==null?void 0:ge.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${(re=a.inspection_point)==null?void 0:re.id}.note`],"point-id":(ye=a.inspection_point)==null?void 0:ye.id,settings:a.settings,onSave:z=>{var f;return B((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):c("",!0),a.input_type==="date"?(o(),Ve(Bt,{key:3,modelValue:t.form.results[(L=a.inspection_point)==null?void 0:L.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(fe=a.settings)==null?void 0:fe.is_required,"min-date":(u=a.settings)==null?void 0:u.min_date,"max-date":(C=a.settings)==null?void 0:C.max_date,error:t.form.errors[`results.${(b=a.inspection_point)==null?void 0:b.id}.note`],onSave:z=>{var f;return B((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):c("",!0),a.input_type==="textarea"?(o(),Ve(Rt,{key:4,modelValue:t.form.results[(q=a.inspection_point)==null?void 0:q.id].note,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"note")}],required:(W=a.settings)==null?void 0:W.is_required,"min-length":(me=a.settings)==null?void 0:me.min_length,"max-length":(oe=a.settings)==null?void 0:oe.max_length,placeholder:((G=a.settings)==null?void 0:G.placeholder)||"Masukkan teks di sini",settings:a.settings,error:t.form.errors[`results.${(ie=a.inspection_point)==null?void 0:ie.id}.note`],onSave:z=>{var f;return B((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):c("",!0),a.input_type==="radio"?(o(),Ve(xn,{key:5,modelValue:t.form.results[(pe=a.inspection_point)==null?void 0:pe.id].status,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"status")}],notes:t.form.results[(x=a.inspection_point)==null?void 0:x.id].note,images:t.form.images[(v=a.inspection_point)==null?void 0:v.id],required:(j=a.settings)==null?void 0:j.is_required,"point-id":(H=a.inspection_point)==null?void 0:H.id,point:a.inspection_point,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(N=a.inspection_point)==null?void 0:N.name,"selected-point":a.inspection_point??null,options:((he=a.settings)==null?void 0:he.radios)||S,error:t.form.errors[`results.${(we=a.inspection_point)==null?void 0:we.id}.status`],"onUpdate:notes":z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},"onUpdate:images":z=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=z},onSave:z=>{var f;return B((f=a.inspection_point)==null?void 0:f.id)},onHapus:z=>{var f;return Z((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="imageTOradio"?(o(),Ve(jn,{key:6,modelValue:t.form.results[(xe=a.inspection_point)==null?void 0:xe.id].status,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"status")}],notes:t.form.results[(Re=a.inspection_point)==null?void 0:Re.id].note,images:t.form.images[(Oe=a.inspection_point)==null?void 0:Oe.id],required:(Xe=a.settings)==null?void 0:Xe.is_required,"point-id":(Ye=a.inspection_point)==null?void 0:Ye.id,"inspection-id":t.inspectionId,settings:a.settings,"point-name":(Qe=a.inspection_point)==null?void 0:Qe.name,point:a,"selected-point":a.inspection_point??null,options:((nt=a.settings)==null?void 0:nt.radios)||S,error:t.form.errors[`results.${(Ke=a.inspection_point)==null?void 0:Ke.id}.status`],"onUpdate:notes":z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},"onUpdate:images":z=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=z},onSave:z=>{var f;return B((f=a.inspection_point)==null?void 0:f.id)},onHapus:z=>{var f;return Z((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),a.input_type==="image"?(o(),Ve(gt,{key:7,modelValue:t.form.images[(et=a.inspection_point)==null?void 0:et.id],"onUpdate:modelValue":z=>{var f;return t.form.images[(f=a.inspection_point)==null?void 0:f.id]=z},error:t.form.errors[`images.${(tt=a.inspection_point)==null?void 0:tt.id}`],"inspection-id":t.inspectionId,"point-id":(We=a.inspection_point)==null?void 0:We.id,point:a.inspection_point,"point-name":(Ie=a.inspection_point)==null?void 0:Ie.name,settings:a.settings,"onUpdate:notes":z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].note=z},"onUpdate:status":z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=z}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):c("",!0),a.input_type==="select"?(o(),Ve(ma,{key:8,modelValue:t.form.results[(Te=a.inspection_point)==null?void 0:Te.id].status,"onUpdate:modelValue":[z=>{var f;return t.form.results[(f=a.inspection_point)==null?void 0:f.id].status=z},z=>{var f;return k((f=a.inspection_point)==null?void 0:f.id,z,"status")}],required:(He=a.settings)==null?void 0:He.is_required,error:t.form.errors[`results.${(Ze=a.inspection_point)==null?void 0:Ze.id}.status`],onSave:z=>{var f;return B((f=a.inspection_point)==null?void 0:f.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):c("",!0)])}),128)),r.value.length===0?(o(),n("div",Fn,[I[1]||(I[1]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),I[2]||(I[2]=e("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),t.category.isDamageMenu?(o(),n("p",zn,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):c("",!0)])):c("",!0)])]))}},Hn=Ee(On,[["__scopeId","data-v-819f08b2"]]),Kn={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Wn={class:"p-4 space-y-4-6"},Zn={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Gn=["value"],Pn={class:"p-4 space-y-4-6"},Jn={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Xn=["value"],Yn={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},Qn={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ei=["value"],ti={class:"p-4 space-y-2"},si={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},ai={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},oi={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},ni={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},ii={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},li={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(t,{emit:Q}){const s=t,y=Q,d=w(null),m=w(!1),p=Ut({bold:!1,italic:!1,underline:!1}),r=Ut({flooded:"",collision:"",collision_severity:"",notes:""}),g=T=>{if(!T)return{};if(typeof T=="string")try{return JSON.parse(T)||{}}catch(M){return console.error("Error parsing settings JSON:",M),{}}return typeof T=="object"&&T!==null?T:{}};ne(()=>g(s.inspection.settings).conclusion||{});const S=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],V=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],k=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Je(()=>{Z(),Nt(()=>{B(),h()})});const B=()=>{d.value&&r.notes&&(d.value.innerHTML=r.notes)},Z=()=>{const M=g(s.inspection.settings).conclusion||{},F=s.form.conclusion||{};r.flooded=F.flooded||M.flooded||"",r.collision=F.collision||M.collision||"",r.collision_severity=F.collision_severity||M.collision_severity||"",r.notes=F.notes||s.inspection.notes||""},h=()=>{if(!d.value)return;const T=window.getSelection();T.rangeCount===0||T.isCollapsed||(p.bold=document.queryCommandState("bold"),p.italic=document.queryCommandState("italic"),p.underline=document.queryCommandState("underline"))},I=T=>{if(!d.value)return;d.value.focus();const M=p[T];switch(T){case"bold":document.execCommand("bold",!1,!M);break;case"italic":document.execCommand("italic",!1,!M);break;case"underline":document.execCommand("underline",!1,!M);break}setTimeout(()=>{h(),$()},10)},a=()=>{d.value&&(d.value.focus(),document.execCommand("removeFormat",!1,null),Object.keys(p).forEach(T=>{p[T]=!1}),$())},$=Lt.debounce(()=>{d.value&&(r.notes=d.value.innerHTML,Y())},200),_=T=>{T.preventDefault(),document.execCommand("insertParagraph",!1,null)},E=T=>{T.preventDefault();const M=(T.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,M)},K=()=>{m.value=!0},D=()=>{m.value=!1,d.value&&(r.notes=d.value.innerHTML,Y())},ee=()=>{Y()},Y=()=>{const T={flooded:r.flooded,collision:r.collision,collision_severity:r.collision==="yes"?r.collision_severity:null,notes:r.notes};y("updateConclusion",T)};return be(()=>s.form.conclusion,T=>{T&&(r.flooded=T.flooded!==void 0?T.flooded:r.flooded,r.collision=T.collision!==void 0?T.collision:r.collision,r.collision_severity=T.collision_severity!==void 0?T.collision_severity:r.collision_severity,r.notes=T.notes!==void 0?T.notes:r.notes,d.value&&T.notes!==void 0&&d.value.innerHTML!==T.notes&&(d.value.innerHTML=T.notes))},{deep:!0,immediate:!0}),be([()=>r.flooded,()=>r.collision,()=>r.collision_severity,()=>r.notes],()=>{Y()},{deep:!0}),(T,M)=>(o(),n("div",Kn,[M[16]||(M[16]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),e("div",Wn,[M[8]||(M[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e(" Apakah kendaraan pernah terkena banjir? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Zn,[(o(),n(Me,null,Ue(S,F=>e("label",{key:F.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[0]||(M[0]=P=>r.flooded=P),value:F.value,class:"hidden peer",onChange:ee},null,40,Gn),[[ut,r.flooded]]),e("div",{class:se(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":r.flooded===F.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":r.flooded!==F.value}])},A(F.label),3)])),64))])]),e("div",Pn,[M[10]||(M[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e(" Apakah kendaraan pernah mengalami tabrakan? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Jn,[(o(),n(Me,null,Ue(V,F=>e("label",{key:F.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[1]||(M[1]=P=>r.collision=P),value:F.value,class:"hidden peer",onChange:ee},null,40,Xn),[[ut,r.collision]]),e("div",{class:se(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":r.collision===F.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":r.collision!==F.value}])},A(F.label),3)])),64))]),_e(lt,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:qe(()=>[r.collision==="yes"?(o(),n("div",Yn,[M[9]||(M[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[$e("Tingkat kerusakan: "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Qn,[(o(),n(Me,null,Ue(k,F=>e("label",{key:F.value,class:"cursor-pointer"},[Ne(e("input",{type:"radio","onUpdate:modelValue":M[2]||(M[2]=P=>r.collision_severity=P),value:F.value,class:"hidden peer",onChange:ee},null,40,ei),[[ut,r.collision_severity]]),e("div",{class:se(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":r.collision_severity===F.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":r.collision_severity!==F.value}])},A(F.label),3)])),64))])])):c("",!0)]),_:1})]),e("div",ti,[M[15]||(M[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),e("div",si,[e("button",{type:"button",onClick:M[3]||(M[3]=F=>I("bold")),class:se(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},M[11]||(M[11]=[e("strong",null,"B",-1)]),2),e("button",{type:"button",onClick:M[4]||(M[4]=F=>I("italic")),class:se(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},M[12]||(M[12]=[e("em",null,"I",-1)]),2),e("button",{type:"button",onClick:M[5]||(M[5]=F=>I("underline")),class:se(["p-2 rounded transition-all duration-150 ease-in-out font-medium",p.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},M[13]||(M[13]=[e("u",null,"U",-1)]),2),e("button",{type:"button",onClick:M[6]||(M[6]=F=>a()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Formatting"}," 🗑️ Clear ")]),_e(lt,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:qe(()=>[Object.values(p).some(F=>F)?(o(),n("div",ai,[M[14]||(M[14]=$e(" Format aktif: ")),p.bold?(o(),n("span",oi,"Bold")):c("",!0),p.italic?(o(),n("span",ni,"Italic")):c("",!0),p.underline?(o(),n("span",ii,"Underline")):c("",!0)])):c("",!0)]),_:1}),e("div",{ref_key:"editorRef",ref:d,contenteditable:"true",class:se(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!m.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":m.value}]),onInput:M[7]||(M[7]=(...F)=>X($)&&X($)(...F)),onBlur:D,onFocus:K,onKeydown:as(_,["enter"]),onPaste:E,onMouseup:h,onKeyup:h,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},ri=Ee(li,[["__scopeId","data-v-e687622b"]]),di={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},ui={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},ci={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},gi={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},mi={class:"flex items-center space-x-2 flex-shrink-0"},pi=["aria-checked"],vi={class:"flex items-center space-x-2 flex-shrink-0"},fi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},hi=["onClick","data-category"],bi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},yi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},xi={key:3,class:"fixed inset-0 z-30"},wi={class:"mt-2 space-y-2"},ki={class:"flex items-center space-x-2"},$i=["aria-checked"],Ci={class:"flex items-center space-x-2"},Ii={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Si=["onClick"],Vi={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},_i={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Mi={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Ui={class:"relative overflow-hidden"},Di={key:1},ji=["disabled"],Ti={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ni={class:"space-y-4"},Li={class:"relative"},qi={class:"max-h-64 overflow-y-auto"},Ai={key:0,class:"text-center py-4 text-gray-500"},Bi=["onClick"],Ei={class:"font-medium text-gray-900"},Ri={class:"text-sm text-gray-500"},Fi={class:"text-xs text-gray-400 mt-1"},zi={key:0,class:"text-xs text-green-600 mt-1"},Oi={__name:"IndexLocal",props:{inspection:Object,inspectionId:Object,category:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(t){var ht,bt,yt,xt,wt,kt,$t,Ct,It,St;const Q=i=>{if(!i)return{};if(typeof i=="string")try{return JSON.parse(i)||{}}catch(l){return console.error("Error parsing settings JSON:",l),{}}return typeof i=="object"&&i!==null?i:{}},s=t,y=ne(()=>`inspection_data_${s.inspection.id}`),d=ne(()=>`swipe_toggle_${s.inspection.id}`),m=ne(()=>`image_source_${s.inspection.id}`),p=()=>{try{const i=localStorage.getItem(y.value);return i?JSON.parse(i):{}}catch(i){return console.error("Error reading local storage:",i),{}}},r=i=>{try{localStorage.setItem(y.value,JSON.stringify(i))}catch(l){console.error("Error writing to local storage:",l)}},g=()=>{try{localStorage.removeItem(y.value),localStorage.removeItem(d.value),localStorage.removeItem(m.value)}catch(i){console.error("Error clearing local storage:",i)}},S=()=>{try{const i=localStorage.getItem(d.value);return i?JSON.parse(i):!0}catch(i){return console.error("Error reading swipe toggle state:",i),!0}},V=i=>{try{localStorage.setItem(d.value,JSON.stringify(i))}catch(l){console.error("Error writing swipe toggle state:",l)}},k=()=>{try{return localStorage.getItem(m.value)||"all"}catch(i){return console.error("Error reading image source setting:",i),"all"}},B=i=>{try{localStorage.setItem(m.value,i)}catch(l){console.error("Error writing image source setting:",l)}},Z=w(((bt=(ht=s.category)==null?void 0:ht.settings)==null?void 0:bt.menu_model)||"horizontal"),h=w(((xt=(yt=s.category)==null?void 0:yt.settings)==null?void 0:xt.position)||"top"),I=w(!1),a=w(!1),{pos:$,dragging:_,startLongPress:E,cancelLongPress:K,onDrag:D,stopDrag:ee,handleClick:Y}=jt("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),T=i=>{Y(i)&&M()},M=()=>{I.value=!I.value},F=()=>{I.value=!1},P=i=>i?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:ue,dragging:Ce,startLongPress:ke,cancelLongPress:R,onDrag:O,stopDrag:ae,handleClick:le}=jt("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),ce=i=>{le(i)&&(ge.value=!0)},ge=w(!1),re=w(!1),ye=w(""),L=w(null),fe=w(""),u=w(""),C=w(""),b=w(!1),q=w(null),W=(i,l)=>{b.value=!0,q.value=l,ct.visit(i,{onFinish:()=>{b.value=!1,q.value=null}})},me=ne(()=>s.appMenus.some(i=>i.input_type==="damage")),oe=ne(()=>["vehicle",...s.appMenus.map(i=>i.id),"conclusion"]),G=w(oe.value[0]),ie=w(0);be(G,i=>{ie.value=oe.value.indexOf(i)});const pe=ne(()=>{if(G.value==="vehicle"||G.value==="conclusion")return null;const i=s.appMenus.find(l=>l.id===G.value);return i?{...i,points:x(i.menu_point,i.input_type==="damage")}:null}),x=(i,l)=>l?(i||[]).filter(J=>{const te=J.inspection_point_id;return Ye(te)}):i||[],v=w({plate_number:s.inspection.plate_number,car_id:s.inspection.car_id,car_name:s.inspection.car_name}),j=w({notes:s.inspection.overall_note||"",flooded:((kt=(wt=Q(s.inspection.settings))==null?void 0:wt.conclusion)==null?void 0:kt.flooded)||null,collision:((Ct=($t=Q(s.inspection.settings))==null?void 0:$t.conclusion)==null?void 0:Ct.collision)||null,collision_severity:((St=(It=Q(s.inspection.settings))==null?void 0:It.conclusion)==null?void 0:St.collision_severity)||null}),N=Tt((()=>{const i=[...s.appMenus.flatMap(Ae=>Ae.menu_point||[]),...s.damagePoints||[]],l={},J={};i.forEach(Ae=>{const Le=Ae.inspection_point_id,je=s.existingResults[Le];l[Le]={status:(je==null?void 0:je.status)||"",note:(je==null?void 0:je.note)||""},J[Le]=s.existingImages[Le]||[]});const te=p(),de={...l,...te.results||{}},Se={...J,...te.images||{}},De={...v.value,...te.vehicleDetails||{}},ve=te.overall_note!==void 0?te.overall_note:s.inspection.overall_note||"";return{inspection_id:s.inspection.id,results:de,images:Se,overall_note:ve,plate_number:De.plate_number,car_id:De.car_id,car_name:De.car_name}})());be(N,i=>{r({results:i.results,images:i.images,overall_note:i.overall_note,vehicleDetails:v.value,conclusion:j.value})},{deep:!0}),be(v,i=>{N.plate_number=i.plate_number,N.car_id=i.car_id,N.car_name=i.car_name},{deep:!0}),be(j,i=>{N.overall_note=i.notes},{deep:!0});const he=w(!1),we=i=>{he.value=i},xe=w(!1),Re=i=>{xe.value=i},Oe=ne(()=>{var de;const i=v.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(v.value.plate_number),l=!!((de=v.value.car_name)!=null&&de.trim()),J=!xe.value,te=!he.value;return i&&l&&J&&te}),Xe=ne(()=>{if(!ye.value.trim())return s.damagePoints||[];const i=ye.value.toLowerCase().trim();return(s.damagePoints||[]).filter(l=>{var J,te,de,Se,De;return((te=(J=l.inspection_point)==null?void 0:J.name)==null?void 0:te.toLowerCase().includes(i))||((Se=(de=l.inspection_point)==null?void 0:de.description)==null?void 0:Se.toLowerCase().includes(i))||((De=Qe(l))==null?void 0:De.toLowerCase().includes(i))})}),Ye=i=>{const l=N.results[i]&&(N.results[i].status||N.results[i].note),J=N.images[i]&&N.images[i].length>0;return l||J},Qe=i=>{var l;return((l=i.inspection_point.component)==null?void 0:l.name)||"Komponen Tidak Diketahui"},nt=i=>N.results[i]||null,Ke=()=>{var Se;const i=j.value,l=!!i.flooded,J=!!i.collision,te=i.collision==="yes"?!!i.collision_severity:!0,de=!!((Se=i.notes)!=null&&Se.trim());return l&&J&&te&&de},et=ne(()=>({flooded:j.value.flooded||null,collision:j.value.collision||null,collision_severity:j.value.collision_severity||null,note:j.value.notes||null,isComplete:Ke()})),tt=ne(()=>{const i=Oe.value,l=s.appMenus.every(te=>We(te)),J=Ke();return i&&l&&J}),We=i=>i.id==="conclusion"?Ke():i.id==="vehicle"?Oe.value:(x(i.menu_point,!1)||[]).filter(J=>J.is_default).every(J=>{var De,ve,Ae,Le,je,st;const te=N.results[J.inspection_point_id],de=N.images[J.inspection_point_id];if(!te)return!1;const Se=Q(J.settings);switch(J.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((De=te.note)!=null&&De.trim());case"select":case"radio":if(!te.status)return!1;const Fe=(ve=Se.radios)==null?void 0:ve.find(U=>U.value===te.status);return!(Fe!=null&&Fe.settings&&(Fe.settings.show_textarea&&!((Ae=te.note)!=null&&Ae.trim())||Fe.settings.show_image_upload&&(de==null?void 0:de.length)===0));case"imageTOradio":if((de==null?void 0:de.length)===0||!te.status)return!1;const ze=(Le=Se.radios)==null?void 0:Le.find(U=>U.value===te.status);return!(ze!=null&&ze.settings&&ze.settings.show_textarea&&ze.settings.required&&!((je=te.note)!=null&&je.trim()));case"image":return(de==null?void 0:de.length)>0;default:return!!te.status||!!((st=te.note)!=null&&st.trim())}}),Ie=w(!0),Te=w("all"),He=w(null),Ze=w([]);os("imageSourceSetting",Te);const z=i=>(i.preventDefault(),i.returnValue="Apakah Anda yakin ingin keluar dari inspeksi? Data inspeksi Anda telah disimpan secara lokal.",i.returnValue),f=()=>{Ie.value=!Ie.value,V(Ie.value)},pt=()=>{B(Te.value),console.log("Image source setting updated to:",Te.value)},it=()=>{He.value&&Nt(()=>{const i=He.value.querySelector(`[data-category="${G.value}"]`);if(!i)return;const l=He.value,J=l.clientWidth,te=i.offsetLeft,de=i.clientWidth,Se=te-J/2+de/2;l.scrollTo({left:Se,behavior:"smooth"})})},zt=i=>{L.value=i;const l=i.inspection_point_id,J=N.results[l]||{};fe.value=J.status||"",u.value=J.note||"",ge.value=!1,re.value=!0},Ot=i=>{L.value&&(N.images[L.value.inspection_point_id]=i)},Ht=()=>{if(L.value){const i=L.value.inspection_point_id;N.results[i]={...N.results[i],status:fe.value,note:u.value},C.value="Data berhasil disimpan di lokal!",setTimeout(()=>C.value="",1e3)}rt()},Kt=({pointId:i,type:l,value:J})=>{var te;(te=N.results[i])!=null&&te.hasOwnProperty(l)&&(N.results[i][l]=J)},vt=async i=>{if(i&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await ct.post(route("inspections.delete-result"),{inspection_id:s.inspection.id,point_id:i},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{N.results[i]&&(N.results[i]={status:"",note:""}),N.images[i]&&(N.images[i]=[]),C.value="Data berhasil dihapus!",setTimeout(()=>C.value="",1e3)},onError:l=>{console.error("Error menghapus hasil:",l)}})}catch(l){console.error("Error menghapus hasil:",l)}rt()}},Wt=i=>{Object.assign(v.value,i),we(!0)},Zt=i=>{console.log("Save car details locally:",i)},Gt=i=>{console.log("Received conclusion data from child:",i),j.value={...j.value,...i},N.overall_note=i.notes||"",console.log("Conclusion state updated:",j.value)},Pt=()=>{if(!tt.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}if(!confirm("Apakah Anda yakin ingin mengirim semua data inspeksi? Data lokal akan dihapus setelah berhasil dikirim."))return;a.value=!0;const i={...N.data(),overall_note:j.value.notes,conclusion:{notes:j.value.notes,flooded:j.value.flooded,collision:j.value.collision,collision_severity:j.value.collision_severity}};ct.post(route("inspections.final-submit-local",{id:s.inspection.id}),i,{preserveScroll:!0,onSuccess:()=>{g()},onError:l=>{console.error("Kesalahan pengiriman:",l),a.value=!1}})},Jt=({pointId:i,imageId:l})=>{N.images[i]&&(N.images[i]=N.images[i].filter(J=>J.id!==l))},Xt=()=>{ge.value=!1,ye.value=""},rt=()=>{re.value=!1,L.value=null,fe.value="",u.value=""},Yt=()=>{},Ge=i=>{G.value=i,it()},ft=i=>{let l=ie.value+i;l>=0&&l<oe.value.length&&(G.value=oe.value[l],it())},Qt=()=>{let i=0,l=0,J=null;const te=ve=>{Ie.value&&(i=ve.changedTouches[0].screenX)},de=ve=>{Ie.value&&(l=ve.changedTouches[0].screenX,Se())},Se=()=>{if(!Ie.value)return;const ve=250;l<i-ve?ft(1):l>i+ve&&ft(-1)},De=()=>{const ve=document.querySelector(".relative.overflow-hidden");return ve&&(ve.addEventListener("touchstart",te,!1),ve.addEventListener("touchend",de,!1)),()=>{ve&&(ve.removeEventListener("touchstart",te),ve.removeEventListener("touchend",de))}};return J=De(),be(Ie,ve=>{J&&J(),ve&&(J=De())}),()=>{J&&J()}};return be(G,(i,l)=>{it()}),be(G,i=>{ie.value=oe.value.indexOf(i)}),Je(()=>{const i=p();if(Ie.value=S(),Te.value=k(),i.vehicleDetails&&(Object.assign(v.value,i.vehicleDetails),N.plate_number=i.vehicleDetails.plate_number,N.car_id=i.vehicleDetails.car_id,N.car_name=i.vehicleDetails.car_name),i.conclusion)console.log("Loading conclusion from localStorage:",i.conclusion),Object.assign(j.value,i.conclusion),N.overall_note=i.conclusion.notes||"";else{const J=Q(s.inspection.settings).conclusion||{};j.value={notes:s.inspection.notes||"",flooded:J.flooded||"",collision:J.collision||"",collision_severity:J.collision_severity||""},N.overall_note=s.inspection.notes||""}i.results&&Object.assign(N.results,i.results),i.images&&Object.assign(N.images,i.images),Qt(),window.addEventListener("beforeunload",z),setTimeout(()=>{it()},100)}),ot(()=>{window.removeEventListener("beforeunload",z)}),(i,l)=>{var J,te,de,Se,De,ve,Ae,Le,je,st,Fe,ze;return o(),n("div",di,[X(Ce)||X(_)?(o(),n("div",ui)):c("",!0),Z.value==="vertical"?(o(),n("button",{key:1,onMousedown:l[0]||(l[0]=(...U)=>X(E)&&X(E)(...U)),onMouseup:l[1]||(l[1]=(...U)=>X(ee)&&X(ee)(...U)),onMouseleave:l[2]||(l[2]=(...U)=>X(K)&&X(K)(...U)),onMousemove:l[3]||(l[3]=(...U)=>X(D)&&X(D)(...U)),onTouchstart:l[4]||(l[4]=(...U)=>X(E)&&X(E)(...U)),onTouchend:l[5]||(l[5]=(...U)=>X(ee)&&X(ee)(...U)),onTouchmove:l[6]||(l[6]=(...U)=>X(D)&&X(D)(...U)),onClick:T,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:Be({left:X($).x+"px",top:X($).y+"px"}),"aria-label":"Toggle vertical menu"},[I.value?(o(),n("svg",gi,l[25]||(l[25]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(o(),n("svg",ci,l[24]||(l[24]=[e("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):c("",!0),Z.value==="horizontal"?(o(),n("div",{key:2,class:se(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":h.value==="top","fixed bottom-0 left-0 right-0":h.value==="bottom"}])},[e("div",{ref_key:"menuContainer",ref:He,class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2",onScroll:Yt},[e("div",mi,[l[26]||(l[26]=e("span",{class:"text-sm text-gray-600"},"Swipe",-1)),e("button",{onClick:f,type:"button",class:se(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Ie.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Ie.value},[e("span",{"aria-hidden":"true",class:se(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Ie.value?"translate-x-5":"translate-x-0"])},null,2)],10,pi)]),e("div",vi,[l[28]||(l[28]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ne(e("select",{"onUpdate:modelValue":l[7]||(l[7]=U=>Te.value=U),onChange:pt,class:"text-sm border border-gray-300 rounded-md px-5 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},l[27]||(l[27]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[Dt,Te.value]])]),e("button",{ref_key:"menuItems",ref:Ze,onClick:l[8]||(l[8]=U=>Ge("vehicle")),class:se(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":G.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":G.value!=="vehicle"}]),"data-category":"vehicle"},[l[29]||(l[29]=$e(" Detail Kendaraan ")),Oe.value?(o(),n("span",fi," ✓ ")):c("",!0)],2),(o(!0),n(Me,null,Ue(t.appMenus,U=>(o(),n("button",{key:U.id,ref_for:!0,ref_key:"menuItems",ref:Ze,onClick:dt=>Ge(U.id),class:se(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":G.value===U.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":G.value!==U.id}]),"data-category":U.id},[$e(A(U.name)+" ",1),We(U)?(o(),n("span",bi," ✓ ")):c("",!0)],10,hi))),128)),e("button",{ref_key:"menuItems",ref:Ze,onClick:l[9]||(l[9]=U=>Ge("conclusion")),class:se(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":G.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":G.value!=="conclusion"}]),"data-category":"conclusion"},[l[30]||(l[30]=$e(" Kesimpulan ")),et.value.isComplete?(o(),n("span",yi," ✓ ")):c("",!0)],2)],544)],2)):c("",!0),Z.value==="vertical"&&I.value?(o(),n("div",xi,[e("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:F}),e("div",{class:se(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":h.value==="top-right","top-16 left-4":h.value==="top-left","bottom-16 right-4":h.value==="bottom-right","bottom-16 left-4":h.value==="bottom-left"}])},[e("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[l[31]||(l[31]=e("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),e("button",{onClick:F,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),e("div",wi,[e("div",ki,[l[32]||(l[32]=e("span",{class:"text-sm text-gray-600"},"Swipe Gesture",-1)),e("button",{onClick:f,type:"button",class:se(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",Ie.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":Ie.value},[e("span",{"aria-hidden":"true",class:se(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",Ie.value?"translate-x-5":"translate-x-0"])},null,2)],10,$i)]),e("div",Ci,[l[34]||(l[34]=e("span",{class:"text-sm text-gray-600"},"Sumber",-1)),Ne(e("select",{"onUpdate:modelValue":l[10]||(l[10]=U=>Te.value=U),onChange:pt,class:"text-sm border border-gray-300 rounded-md px-6 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},l[33]||(l[33]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[Dt,Te.value]])]),e("button",{onClick:l[11]||(l[11]=U=>{Ge("vehicle"),F()}),class:se([P(G.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[l[35]||(l[35]=e("span",null,"Detail Kendaraan",-1)),Oe.value?(o(),n("span",Ii,"✓")):c("",!0)],2),(o(!0),n(Me,null,Ue(t.appMenus,U=>(o(),n("button",{key:`vmenu-${U.id}`,onClick:()=>{Ge(U.id),F()},class:se([P(G.value===U.id),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[e("span",null,A(U.name),1),We(U)?(o(),n("span",Vi,"✓")):c("",!0)],10,Si))),128)),e("button",{onClick:l[12]||(l[12]=U=>{Ge("conclusion"),F()}),class:se([P(G.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[l[36]||(l[36]=e("span",null,"Kesimpulan",-1)),et.value.isComplete?(o(),n("span",_i,"✓")):c("",!0)],2)])],2)])):c("",!0),e("div",{class:se(["max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1",{"pb-4 pt-1":h.value==="top","pb-20 pt-4":h.value==="bottom","pb-4 pt-4":Z.value==="vertical"}])},[_e(lt,{name:"fade"},{default:qe(()=>[C.value?(o(),n("div",Mi,A(C.value),1)):c("",!0)]),_:1}),e("div",Ui,[G.value==="vehicle"?(o(),Ve(zs,{key:0,inspection:t.inspection,CarDetail:t.CarDetail,allInspections:s.allInspections,onUpdateVehicle:Wt,onSaveCarDetails:Zt,"onUpdate:validation":Re,"onUpdate:hasUnsavedChanges":we},null,8,["inspection","CarDetail","allInspections"])):pe.value&&G.value!=="conclusion"?(o(),Ve(Hn,{key:pe.value.id,category:pe.value,"inspection-id":t.inspection.id,form:X(N),onUpdateResult:Kt,onHapusPoint:vt,onRemoveImage:Jt},null,8,["category","inspection-id","form"])):G.value==="conclusion"?(o(),Ve(ri,{key:2,form:{conclusion:j.value},"inspection-id":t.inspection.id,inspection:t.inspection,settings:t.inspection.settings||{},onUpdateConclusion:Gt},null,8,["form","inspection-id","inspection","settings"])):c("",!0)]),G.value==="conclusion"?(o(),n("div",{key:0,class:se(["flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md",{"mb-4":h.value==="top","mb-20":h.value==="bottom"}])},[_e(X(ns),{href:i.route("inspections.pending",t.inspectionId),as:"button",type:"button",disabled:b.value&&q.value==="pending",onClick:l[13]||(l[13]=at(U=>W(i.route("inspections.pending",t.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:qe(()=>[b.value&&q.value==="pending"?(o(),n(Me,{key:0},[l[37]||(l[37]=e("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),l[38]||(l[38]=e("span",null,"Memproses...",-1))],64)):(o(),n("span",Di,"Tunda"))]),_:1},8,["href","disabled"]),e("button",{type:"button",onClick:Pt,disabled:!tt.value||a.value,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[a.value?(o(),n("svg",Ti,l[39]||(l[39]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),e("span",null,A(a.value?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ji)],2)):c("",!0),me.value?(o(),n("button",{key:1,onMousedown:l[14]||(l[14]=(...U)=>X(ke)&&X(ke)(...U)),onMouseup:l[15]||(l[15]=(...U)=>X(ae)&&X(ae)(...U)),onMouseleave:l[16]||(l[16]=(...U)=>X(R)&&X(R)(...U)),onMousemove:l[17]||(l[17]=(...U)=>X(O)&&X(O)(...U)),onTouchstart:l[18]||(l[18]=(...U)=>X(ke)&&X(ke)(...U)),onTouchend:l[19]||(l[19]=(...U)=>X(ae)&&X(ae)(...U)),onTouchmove:l[20]||(l[20]=(...U)=>X(O)&&X(O)(...U)),onClick:ce,class:"fixed z-10 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:Be({left:X(ue).x+"px",top:X(ue).y+"px"})},l[40]||(l[40]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):c("",!0),_e(Ft,{show:ge.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:Xt},{default:qe(()=>[e("div",Ni,[e("div",Li,[Ne(e("input",{"onUpdate:modelValue":l[21]||(l[21]=U=>ye.value=U),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[Pe,ye.value]]),l[41]||(l[41]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",qi,[Xe.value.length===0?(o(),n("div",Ai," Tidak ada point yang ditemukan ")):c("",!0),(o(!0),n(Me,null,Ue(Xe.value,U=>{var dt,Vt;return o(),n("button",{key:U.id,onClick:Hi=>zt(U),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",Ei,A((dt=U.inspection_point)==null?void 0:dt.name),1),e("div",Ri,A((Vt=U.inspection_point)==null?void 0:Vt.description),1),e("div",Fi,A(Qe(U)),1),Ye(U.inspection_point_id)?(o(),n("div",zi," ✓ Sudah ada data ")):c("",!0)],8,Bi)}),128))])])]),_:1},8,["show"]),re.value?(o(),Ve(mt,{key:(J=L.value)==null?void 0:J.id,show:re.value,title:((de=(te=L.value)==null?void 0:te.inspection_point)==null?void 0:de.name)||"Detail Point",subtitle:(De=(Se=L.value)==null?void 0:Se.inspection_point)==null?void 0:De.description,name:`point-${(ve=L.value)==null?void 0:ve.id}`,"inspection-id":t.inspection.id,"point-id":(Ae=L.value)==null?void 0:Ae.inspection_point_id,settings:((Le=L.value)==null?void 0:Le.settings)||{},options:((st=(je=L.value)==null?void 0:je.settings)==null?void 0:st.radios)||[],"selected-Point":L.value,"selected-value":fe.value,"images-value":X(N).images[(Fe=L.value)==null?void 0:Fe.inspection_point_id],"notes-value":u.value,point:L.value,"existing-data":nt((ze=L.value)==null?void 0:ze.inspection_point_id),"onUpdate:selectedValue":l[22]||(l[22]=U=>fe.value=U),"onUpdate:notesValue":l[23]||(l[23]=U=>u.value=U),"onUpdate:imagesValue":Ot,onSave:Ht,onClose:rt,onHapus:vt},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):c("",!0)],2)])}}},Xi=Ee(Oi,[["__scopeId","data-v-9335d8cc"]]);export{Xi as default};
