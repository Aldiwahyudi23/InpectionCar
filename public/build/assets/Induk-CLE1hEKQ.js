import{r as _,p as lt,q as E,G as Pe,c as m,o as l,d as r,b as h,t as N,F as $e,m as Ze,j as U,f as Qe,x as rt,W as de,g as ut,u as d,N as st,n as O,k as Ge,w as Je,T as nt,y as dt,S as ct,z as pt,A as gt}from"./vendor-DZyPVqc7.js";import{l as it}from"./lodash-CwXbc5n4.js";import{_ as mt,a as ft,b as vt,c as ht,d as yt,e as xt,I as bt,f as wt,V as kt,C as _t,B as Ct,g as Vt}from"./ConclusionSection-DxHkEYzh.js";import{_ as at}from"./app-Cg-OenIi.js";import{_ as Dt}from"./InputNumber-MsqIT8vb.js";import{u as ot}from"./useDraggableButton-BCGMf6rx.js";import"./PrimaryButton-DYuTiD-E.js";import"./ActionMessage-Dtpus4ld.js";const St={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},$t={class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},Mt={class:"text-xl font-semibold text-indigo-700"},Ut={class:"p-4 space-y-4"},jt={class:"flex items-start justify-between"},Tt={class:"block text-sm font-medium text-gray-700"},qt={key:0,class:"text-red-500"},Rt={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},zt={key:0,class:"text-center py-8 text-gray-500"},Lt={key:0,class:"text-xs text-gray-400"},Bt={__name:"CategoryCadangan",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage","hapusPoint"],setup(a,{emit:f}){const b=a,S=f,T=_(!1),te=lt(),Ye=E(()=>(b.category.points||[]).some(u=>u.is_default===!1)),G=E(()=>{var c;if(console.log("CategorySection - Filtering points:",{categoryName:b.category.name,isDamageMenu:b.category.isDamageMenu,allPoints:b.category.points,allPointsCount:(c=b.category.points)==null?void 0:c.length}),!b.category.isDamageMenu){const e=(b.category.points||[]).filter(C=>{var M;const k=(M=C.inspection_point)==null?void 0:M.id,V=ce(k);return T.value||C.is_default||V?!0:(console.log(`Non-damage Point ${k}: is_default=${C.is_default}, hasData=${V}`),!1)});return console.log("Filtered non-damage points:",e),e}const u=(b.category.points||[]).filter(e=>{var V;const C=(V=e.inspection_point)==null?void 0:V.id,k=ce(C);return T.value||e.is_default||!e.is_default&&k?!0:(console.log(`Damage Point ${C}: hasData=${k}`),k)});return console.log("Filtered damage points:",u),u}),ce=u=>{if(!u)return console.log("hasPointData: pointId is null/undefined"),!1;const c=te.props.existingResults[u]!==void 0,e=te.props.existingImages[u]&&te.props.existingImages[u].length>0,C=b.form.results[u]&&(b.form.results[u].status||b.form.results[u].note),k=b.form.images[u]&&b.form.images[u].length>0,V=c||e||C||k;return console.log(`Point ${u} data check:`,{hasServerResult:c,hasServerImages:e,hasLocalResult:C,hasLocalImages:k,finalResult:V}),V},J=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],se=u=>{var C,k,V,M,L,Z,Q,B,H;const c=b.form.results[(C=u.inspection_point)==null?void 0:C.id],e=b.form.images[(k=u.inspection_point)==null?void 0:k.id];if(!c)return!1;switch(u.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!c.note;case"select":case"radio":if(!c.status)return!1;const $=(M=(V=u.settings)==null?void 0:V.radios)==null?void 0:M.find(j=>j.value===c.status);return!($!=null&&$.settings&&($.settings.show_textarea&&!((L=c.note)!=null&&L.trim())||$.settings.show_image_upload&&(e==null?void 0:e.length)===0));case"imageTOradio":if((e==null?void 0:e.length)===0||!c.status)return!1;const x=(Q=(Z=u.settings)==null?void 0:Z.radios)==null?void 0:Q.find(j=>j.value===c.status);return!(x!=null&&x.settings&&x.settings.show_textarea&&!((B=c.note)!=null&&B.trim()));case"image":return(e==null?void 0:e.length)>0;default:return!!c.status||!!((H=c.note)!=null&&H.trim())}};Pe(()=>b.form.results,u=>{Object.keys(u).forEach(c=>{!u[c]||!u[c].status&&u[c].note})},{deep:!0}),Pe(()=>b.form.images,u=>{Object.keys(u).forEach(c=>{!u[c]||u[c].length})},{deep:!0});const R=(u,c,e)=>{S("updateResult",{pointId:u,type:e,value:c})},z=u=>{S("saveResult",u)},Me=u=>{S("hapusPoint",u)};return(u,c)=>(l(),m("div",St,[r("div",$t,[r("h3",Mt,N(a.category.name),1),Ye.value?(l(),m("button",{key:0,onClick:c[0]||(c[0]=e=>T.value=!T.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},N(T.value?"Sembunyikan Point Yang Tidak Perlu":"Tampilkan Point Tersembunyi"),1)):h("",!0)]),r("div",Ut,[(l(!0),m($e,null,Ze(G.value,e=>{var C,k,V,M,L,Z,Q,B,H,$,x,j,F,I,Y,X,Ue,je,pe,w,Te,ne,ie,oe,ge,qe,me,Re,P,fe,ve,he,ze,Le,Be,He,Oe,ae,ye,p,le,re,ue,xe,be,A,ee,Ne,we,Ae,Ee,Fe,Ie,Ke,We,ke;return l(),m("div",{key:e.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[r("div",jt,[r("label",Tt,[Qe(N((C=e.inspection_point)==null?void 0:C.name)+" ",1),(k=e.settings)!=null&&k.is_required?(l(),m("span",qt,"*")):h("",!0)]),se(e)?(l(),m("span",Rt," âœ“ ")):h("",!0)]),e.input_type==="text"?(l(),U(mt,{key:0,modelValue:a.form.results[(V=e.inspection_point)==null?void 0:V.id].note,"onUpdate:modelValue":[o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].note=o},o=>{var n;return R((n=e.inspection_point)==null?void 0:n.id,o,"note")}],required:(M=e.settings)==null?void 0:M.is_required,"min-length":(L=e.settings)==null?void 0:L.min_length,"max-length":(Z=e.settings)==null?void 0:Z.max_length,allowSpace:(Q=e.settings)==null?void 0:Q.allow_space,textTransform:(B=e.settings)==null?void 0:B.text_transform,placeholder:((H=e.settings)==null?void 0:H.placeholder)||"Masukan text",error:a.form.errors[`results.${($=e.inspection_point)==null?void 0:$.id}.note`],onSave:o=>{var n;return z((n=e.inspection_point)==null?void 0:n.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):h("",!0),e.input_type==="number"?(l(),U(Dt,{key:1,modelValue:a.form.results[(x=e.inspection_point)==null?void 0:x.id].note,"onUpdate:modelValue":[o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].note=o},o=>{var n;return R((n=e.inspection_point)==null?void 0:n.id,o,"note")}],required:(j=e.settings)==null?void 0:j.is_required,min:(F=e.settings)==null?void 0:F.min,max:(I=e.settings)==null?void 0:I.max,step:((Y=e.settings)==null?void 0:Y.step)||1,placeholder:((X=e.settings)==null?void 0:X.placeholder)||"Masukan number",error:a.form.errors[`results.${(Ue=e.inspection_point)==null?void 0:Ue.id}.note`],onSave:o=>{var n;return z((n=e.inspection_point)==null?void 0:n.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):h("",!0),e.input_type==="account"?(l(),U(ft,{key:2,modelValue:a.form.results[(je=e.inspection_point)==null?void 0:je.id].note,"onUpdate:modelValue":[o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].note=o},o=>{var n;return R((n=e.inspection_point)==null?void 0:n.id,o,"note")}],required:(pe=e.settings)==null?void 0:pe.is_required,placeholder:((w=e.settings)==null?void 0:w.placeholder)||"Masukkan nilai",error:a.form.errors[`results.${(Te=e.inspection_point)==null?void 0:Te.id}.note`],"point-id":(ne=e.inspection_point)==null?void 0:ne.id,settings:e.settings,onSave:o=>{var n;return z((n=e.inspection_point)==null?void 0:n.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):h("",!0),e.input_type==="date"?(l(),U(vt,{key:3,modelValue:a.form.results[(ie=e.inspection_point)==null?void 0:ie.id].note,"onUpdate:modelValue":[o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].note=o},o=>{var n;return R((n=e.inspection_point)==null?void 0:n.id,o,"note")}],required:(oe=e.settings)==null?void 0:oe.is_required,"min-date":(ge=e.settings)==null?void 0:ge.min_date,"max-date":(qe=e.settings)==null?void 0:qe.max_date,error:a.form.errors[`results.${(me=e.inspection_point)==null?void 0:me.id}.note`],onSave:o=>{var n;return z((n=e.inspection_point)==null?void 0:n.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):h("",!0),e.input_type==="textarea"?(l(),U(ht,{key:4,modelValue:a.form.results[(Re=e.inspection_point)==null?void 0:Re.id].note,"onUpdate:modelValue":[o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].note=o},o=>{var n;return R((n=e.inspection_point)==null?void 0:n.id,o,"note")}],required:(P=e.settings)==null?void 0:P.is_required,"min-length":(fe=e.settings)==null?void 0:fe.min_length,"max-length":(ve=e.settings)==null?void 0:ve.max_length,placeholder:((he=e.settings)==null?void 0:he.placeholder)||"Masukkan teks di sini",settings:e.settings,error:a.form.errors[`results.${(ze=e.inspection_point)==null?void 0:ze.id}.note`],onSave:o=>{var n;return z((n=e.inspection_point)==null?void 0:n.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):h("",!0),e.input_type==="radio"?(l(),U(yt,{key:5,modelValue:a.form.results[(Le=e.inspection_point)==null?void 0:Le.id].status,"onUpdate:modelValue":[o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].status=o},o=>{var n;return R((n=e.inspection_point)==null?void 0:n.id,o,"status")}],notes:a.form.results[(Be=e.inspection_point)==null?void 0:Be.id].note,images:a.form.images[(He=e.inspection_point)==null?void 0:He.id],required:(Oe=e.settings)==null?void 0:Oe.is_required,"point-id":(ae=e.inspection_point)==null?void 0:ae.id,point:e.inspection_point,"inspection-id":a.inspectionId,settings:e.settings,"point-name":(ye=e.inspection_point)==null?void 0:ye.name,"selected-point":e.inspection_point??null,options:((p=e.settings)==null?void 0:p.radios)||J,error:a.form.errors[`results.${(le=e.inspection_point)==null?void 0:le.id}.status`],"onUpdate:notes":o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].note=o},"onUpdate:images":o=>{var n;return a.form.images[(n=e.inspection_point)==null?void 0:n.id]=o},onSave:o=>{var n;return z((n=e.inspection_point)==null?void 0:n.id)},onHapus:o=>{var n;return Me((n=e.inspection_point)==null?void 0:n.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):h("",!0),e.input_type==="imageTOradio"?(l(),U(xt,{key:6,modelValue:a.form.results[(re=e.inspection_point)==null?void 0:re.id].status,"onUpdate:modelValue":[o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].status=o},o=>{var n;return R((n=e.inspection_point)==null?void 0:n.id,o,"status")}],notes:a.form.results[(ue=e.inspection_point)==null?void 0:ue.id].note,images:a.form.images[(xe=e.inspection_point)==null?void 0:xe.id],required:(be=e.settings)==null?void 0:be.is_required,"point-id":(A=e.inspection_point)==null?void 0:A.id,"inspection-id":a.inspectionId,settings:e.settings,"point-name":(ee=e.inspection_point)==null?void 0:ee.name,point:e,"selected-point":e.inspection_point??null,options:((Ne=e.settings)==null?void 0:Ne.radios)||J,error:a.form.errors[`results.${(we=e.inspection_point)==null?void 0:we.id}.status`],"onUpdate:notes":o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].note=o},"onUpdate:images":o=>{var n;return a.form.images[(n=e.inspection_point)==null?void 0:n.id]=o},onSave:o=>{var n;return z((n=e.inspection_point)==null?void 0:n.id)},onHapus:o=>{var n;return Me((n=e.inspection_point)==null?void 0:n.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):h("",!0),e.input_type==="image"?(l(),U(bt,{key:7,modelValue:a.form.images[(Ae=e.inspection_point)==null?void 0:Ae.id],"onUpdate:modelValue":o=>{var n;return a.form.images[(n=e.inspection_point)==null?void 0:n.id]=o},error:a.form.errors[`images.${(Ee=e.inspection_point)==null?void 0:Ee.id}`],"inspection-id":a.inspectionId,"point-id":(Fe=e.inspection_point)==null?void 0:Fe.id,point:e.inspection_point,"point-name":(Ie=e.inspection_point)==null?void 0:Ie.name,settings:e.settings,"onUpdate:notes":o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].note=o},"onUpdate:status":o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].status=o}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):h("",!0),e.input_type==="select"?(l(),U(wt,{key:8,modelValue:a.form.results[(Ke=e.inspection_point)==null?void 0:Ke.id].status,"onUpdate:modelValue":[o=>{var n;return a.form.results[(n=e.inspection_point)==null?void 0:n.id].status=o},o=>{var n;return R((n=e.inspection_point)==null?void 0:n.id,o,"status")}],required:(We=e.settings)==null?void 0:We.is_required,error:a.form.errors[`results.${(ke=e.inspection_point)==null?void 0:ke.id}.status`],onSave:o=>{var n;return z((n=e.inspection_point)==null?void 0:n.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):h("",!0)])}),128)),G.value.length===0?(l(),m("div",zt,[c[1]||(c[1]=r("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),c[2]||(c[2]=r("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),a.category.isDamageMenu?(l(),m("p",Lt,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):h("",!0)])):h("",!0)])]))}},Ht=at(Bt,[["__scopeId","data-v-e09c094b"]]),Ot={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Nt={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},At={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Et={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Ft={class:"flex overflow-x-auto scrollbar-hide py-3 px-4"},It={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Kt=["onClick"],Wt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Gt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Jt={key:3,class:"fixed inset-0 z-30"},Zt={class:"mt-2 space-y-2"},Qt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Yt=["onClick"],Xt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Pt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},es={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},ts={class:"relative overflow-hidden"},ss={key:1},ns=["disabled"],is={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},os={class:"space-y-4"},as={class:"relative"},ls={class:"max-h-64 overflow-y-auto"},rs={key:0,class:"text-center py-4 text-gray-500"},us=["onClick"],ds={class:"font-medium text-gray-900"},cs={class:"text-sm text-gray-500"},ps={class:"text-xs text-gray-400 mt-1"},gs={key:0,class:"text-xs text-green-600 mt-1"},ms={__name:"Induk",props:{inspection:Object,inspectionId:Object,category:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(a){var ke,o,n,et;const f=a,b=_(((o=(ke=f.category)==null?void 0:ke.settings)==null?void 0:o.menu_model)||"horizontal"),S=_(((et=(n=f.category)==null?void 0:n.settings)==null?void 0:et.position)||"top"),T=_(!1),{pos:te,dragging:Ye,startLongPress:G,cancelLongPress:ce,onDrag:J,stopDrag:se,handleClick:R}=ot("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),z=s=>{R(s)&&Me()},Me=()=>{T.value=!T.value},u=()=>{T.value=!1},c=s=>s?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:e,dragging:C,startLongPress:k,cancelLongPress:V,onDrag:M,stopDrag:L,handleClick:Z}=ot("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),Q=s=>{Z(s)&&(B.value=!0)},B=_(!1),H=_(!1),$=_(""),x=_(null),j=_(""),F=_(""),I=_(""),Y=_(!1),X=_(null),Ue=(s,t)=>{Y.value=!0,X.value=t,de.visit(s,{onFinish:()=>{Y.value=!1,X.value=null}})},je=E(()=>f.appMenus.some(s=>s.input_type==="damage")),pe=E(()=>["vehicle",...f.appMenus.map(s=>s.id),"conclusion"]),w=_(pe.value[0]),Te=_(0);Pe(w,s=>{Te.value=pe.value.indexOf(s)});const ne=E(()=>{if(w.value==="vehicle"||w.value==="conclusion")return null;const s=f.appMenus.find(t=>t.id===w.value);return s?{...s,points:ie(s.menu_point,s.input_type==="damage")}:null}),ie=(s,t)=>t?(s||[]).filter(v=>{const g=v.inspection_point_id;return ve(g)}):s||[],oe=_({plate_number:f.inspection.plate_number,car_id:f.inspection.car_id,car_name:f.inspection.car_name}),ge=_(!1),qe=s=>{ge.value=s},me=_(!1),Re=s=>{me.value=s},P=E(()=>{var y;const s=oe.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(oe.value.plate_number),t=!!((y=oe.value.car_name)!=null&&y.trim()),v=!me.value,g=!ge.value;return s&&t&&v&&g}),fe=E(()=>{if(!$.value.trim())return f.damagePoints||[];const s=$.value.toLowerCase().trim();return(f.damagePoints||[]).filter(t=>{var v,g,y,D,q;return((g=(v=t.inspection_point)==null?void 0:v.name)==null?void 0:g.toLowerCase().includes(s))||((D=(y=t.inspection_point)==null?void 0:y.description)==null?void 0:D.toLowerCase().includes(s))||((q=he(t))==null?void 0:q.toLowerCase().includes(s))})}),ve=s=>{const t=f.existingResults&&f.existingResults[s]!==void 0,v=f.existingImages&&f.existingImages[s]&&f.existingImages[s].length>0,g=p.results[s]&&(p.results[s].status||p.results[s].note),y=p.images[s]&&p.images[s].length>0;return t||v||g||y},he=s=>{var t;return((t=s.inspection_point.component)==null?void 0:t.name)||"Komponen Tidak Diketahui"},ze=s=>f.existingResults[s]||null,Le=s=>{x.value=s;const t=s.inspection_point_id,v=p.results[t]||{};j.value=v.status||"",F.value=v.note||"",B.value=!1,H.value=!0},Be=s=>{x.value&&(p.images[x.value.inspection_point_id]=s)},He=()=>{if(x.value){const s=x.value.inspection_point_id;p.results[s]={...p.results[s],status:j.value,note:F.value},ee(s),I.value="Data berhasil disimpan!",setTimeout(()=>I.value="",1e3)}ae()},Oe=()=>{B.value=!1,$.value=""},ae=()=>{H.value=!1,x.value=null,j.value="",F.value=""},ye=()=>{const s={},t={};return[...f.appMenus.flatMap(g=>g.menu_point||[]),...f.damagePoints||[]].forEach(g=>{const y=g.inspection_point_id,D=f.existingResults[y];s[y]={status:(D==null?void 0:D.status)||"",note:(D==null?void 0:D.note)||""},t[y]=f.existingImages[y]||[]}),{inspection_id:f.inspection.id,results:s,images:t,overall_note:f.inspection.overall_note||""}},p=rt(ye()),le=s=>s.input_type==="damage"?ie(s.menu_point,!0).length>0:s.id==="conclusion"?ue():s.id==="vehicle"?P():(ie(s.menu_point,!1)||[]).filter(v=>v.is_default).every(v=>{var q,_e,Ce,Ve,De,Se;const g=p.results[v.inspection_point_id],y=p.images[v.inspection_point_id];if(!g)return!1;const D=re(v.settings);switch(v.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((q=g.note)!=null&&q.trim());case"select":case"radio":if(!g.status)return!1;const K=(_e=D.radios)==null?void 0:_e.find(i=>i.value===g.status);return!(K!=null&&K.settings&&(K.settings.show_textarea&&!((Ce=g.note)!=null&&Ce.trim())||K.settings.show_image_upload&&(y==null?void 0:y.length)===0));case"imageTOradio":if((y==null?void 0:y.length)===0||!g.status)return!1;const W=(Ve=D.radios)==null?void 0:Ve.find(i=>i.value===g.status);return!(W!=null&&W.settings&&W.settings.show_textarea&&W.settings.required&&!((De=g.note)!=null&&De.trim()));case"image":return(y==null?void 0:y.length)>0;default:return!!g.status||!!((Se=g.note)!=null&&Se.trim())}}),re=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(t){return console.error("Error parsing settings JSON:",t),{}}return typeof s=="object"&&s!==null?s:{}},ue=()=>{var q;const t=re(f.inspection.settings).conclusion||{},v=!!t.flooded,g=!!t.collision,y=t.collision==="yes"?!!t.collision_severity:!0,D=!!((q=f.inspection.notes)!=null&&q.trim());return v&&g&&y&&D},xe=E(()=>{const t=re(f.inspection.settings).conclusion||{};return{flooded:t.flooded||null,collision:t.collision||null,collision_severity:t.collision_severity||null,note:f.inspection.notes||null,isComplete:ue()}}),be=E(()=>{const s=P.value,t=f.appMenus.every(g=>le(g)),v=ue();return s&&t&&v}),A=s=>{w.value=s},ee=it.debounce(async s=>{var t,v;try{await de.post(route("inspections.save-result"),{inspection_id:f.inspection.id,point_id:s,status:(t=p.results[s])==null?void 0:t.status,note:(v=p.results[s])==null?void 0:v.note,images:p.images[s]},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{de.reload({only:["existingResults","existingImages"]})}})}catch(g){console.error("Error menyimpan hasil:",g)}},500),Ne=({pointId:s,type:t,value:v})=>{var g;(g=p.results[s])!=null&&g.hasOwnProperty(t)&&(p.results[s][t]=v),ee(s)},we=async s=>{if(s&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await de.post(route("inspections.delete-result"),{inspection_id:f.inspection.id,point_id:s},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{p.results[s]&&(p.results[s]={status:"",note:""}),p.images[s]&&(p.images[s]=[]),I.value="Data berhasil dihapus!",setTimeout(()=>{de.reload({only:["existingResults","existingImages"],onSuccess:()=>{Object.assign(p,ye())}})},100)},onError:t=>{console.error("Error menghapus hasil:",t)}})}catch(t){console.error("Error menghapus hasil:",t)}ae()}},Ae=s=>{console.log("Update vehicle:",s)},Ee=s=>{console.log("Save car details:",s)},Fe=s=>{Object.assign(p.conclusion,s),Ie()},Ie=it.debounce(async()=>{try{await de.post(route("inspections.save-conclusion"),{inspection_id:f.inspection.id,...p.conclusion},{preserveScroll:!0,preserveState:!0})}catch(s){console.error("Error menyimpan kesimpulan:",s)}},500),Ke=()=>{if(!be.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}p.post(route("inspections.final-submit",{id:f.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:s=>{console.error("Kesalahan pengiriman:",s)}})},We=({pointId:s,imageId:t})=>{p.images[s]&&(p.images[s]=p.images[s].filter(v=>v.id!==t),ee(s))};return ut(()=>{}),(s,t)=>{var v,g,y,D,q,_e,Ce,Ve,De,Se,K,W;return l(),m("div",Ot,[d(C)||d(Ye)?(l(),m("div",Nt)):h("",!0),b.value==="vertical"?(l(),m("button",{key:1,onMousedown:t[0]||(t[0]=(...i)=>d(G)&&d(G)(...i)),onMouseup:t[1]||(t[1]=(...i)=>d(se)&&d(se)(...i)),onMouseleave:t[2]||(t[2]=(...i)=>d(ce)&&d(ce)(...i)),onMousemove:t[3]||(t[3]=(...i)=>d(J)&&d(J)(...i)),onTouchstart:t[4]||(t[4]=(...i)=>d(G)&&d(G)(...i)),onTouchend:t[5]||(t[5]=(...i)=>d(se)&&d(se)(...i)),onTouchmove:t[6]||(t[6]=(...i)=>d(J)&&d(J)(...i)),onClick:z,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:st({left:d(te).x+"px",top:d(te).y+"px"}),"aria-label":"Toggle vertical menu"},[T.value?(l(),m("svg",Et,t[23]||(t[23]=[r("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(l(),m("svg",At,t[22]||(t[22]=[r("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):h("",!0),b.value==="horizontal"?(l(),m("div",{key:2,class:O(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":S.value==="top","fixed bottom-0 left-0 right-0":S.value==="bottom"}])},[r("div",Ft,[r("button",{onClick:t[7]||(t[7]=i=>A("vehicle")),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":w.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":w.value!=="vehicle"}])},[t[24]||(t[24]=Qe(" Detail Kendaraan ")),P.value?(l(),m("span",It," âœ“ ")):h("",!0)],2),(l(!0),m($e,null,Ze(a.appMenus,i=>(l(),m("button",{key:i.id,onClick:Xe=>A(i.id),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":w.value===i.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":w.value!==i.id}])},[Qe(N(i.name)+" ",1),le(i)?(l(),m("span",Wt," âœ“ ")):h("",!0)],10,Kt))),128)),r("button",{onClick:t[8]||(t[8]=i=>A("conclusion")),class:O(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":w.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":w.value!=="conclusion"}])},[t[25]||(t[25]=Qe(" Kesimpulan ")),xe.value.isComplete?(l(),m("span",Gt," âœ“ ")):h("",!0)],2)])],2)):h("",!0),b.value==="vertical"&&T.value?(l(),m("div",Jt,[r("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:u}),r("div",{class:O(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":S.value==="top-right","top-16 left-4":S.value==="top-left","bottom-16 right-4":S.value==="bottom-right","bottom-16 left-4":S.value==="bottom-left"}])},[r("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[t[26]||(t[26]=r("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),r("button",{onClick:u,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),r("div",Zt,[r("button",{onClick:t[9]||(t[9]=i=>{A("vehicle"),u()}),class:O([c(w.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[t[27]||(t[27]=r("span",null,"Detail Kendaraan",-1)),P.value?(l(),m("span",Qt,"âœ“")):h("",!0)],2),(l(!0),m($e,null,Ze(a.appMenus,i=>(l(),m("button",{key:`vmenu-${i.id}`,onClick:()=>{A(i.id),u()},class:O([c(w.value===i.id),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[r("span",null,N(i.name),1),le(i)?(l(),m("span",Xt,"âœ“")):h("",!0)],10,Yt))),128)),r("button",{onClick:t[10]||(t[10]=i=>{A("conclusion"),u()}),class:O([c(w.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[t[28]||(t[28]=r("span",null,"Kesimpulan",-1)),xe.value.isComplete?(l(),m("span",Pt,"âœ“")):h("",!0)],2)])],2)])):h("",!0),r("div",{class:O(["max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1",{"pb-4 pt-1":S.value==="top","pb-20 pt-4":S.value==="bottom","pb-4 pt-4":b.value==="vertical"}])},[Ge(nt,{name:"fade"},{default:Je(()=>[I.value?(l(),m("div",es,N(I.value),1)):h("",!0)]),_:1}),r("div",ts,[Ge(nt,{name:"category-slide",mode:"out-in"},{default:Je(()=>[w.value==="vehicle"?(l(),U(kt,{key:0,inspection:a.inspection,CarDetail:a.CarDetail,allInspections:f.allInspections,onUpdateVehicle:Ae,onSaveCarDetails:Ee,"onUpdate:validation":Re,"onUpdate:hasUnsavedChanges":qe},null,8,["inspection","CarDetail","allInspections"])):ne.value&&w.value!=="conclusion"?(l(),U(Ht,{key:ne.value.id,category:ne.value,"inspection-id":a.inspection.id,form:d(p),onSaveResult:d(ee),onUpdateResult:Ne,onHapusPoint:we,onRemoveImage:We},null,8,["category","inspection-id","form","onSaveResult"])):w.value==="conclusion"?(l(),U(_t,{key:2,form:d(p),"inspection-id":a.inspection.id,inspection:a.inspection,settings:a.inspection.settings||{},onUpdateConclusion:Fe},null,8,["form","inspection-id","inspection","settings"])):h("",!0)]),_:1})]),w.value==="conclusion"?(l(),m("div",{key:0,class:O(["flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md",{"mb-4":S.value==="top","mb-20":S.value==="bottom"}])},[Ge(d(ct),{href:s.route("inspections.pending",a.inspectionId),as:"button",type:"button",disabled:Y.value&&X.value==="pending",onClick:t[11]||(t[11]=dt(i=>Ue(s.route("inspections.pending",a.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:Je(()=>[Y.value&&X.value==="pending"?(l(),m($e,{key:0},[t[29]||(t[29]=r("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 \r
                5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 \r
                5.824 3 7.938l3-2.647z`})],-1)),t[30]||(t[30]=r("span",null,"Memproses...",-1))],64)):(l(),m("span",ss,"Tunda"))]),_:1},8,["href","disabled"]),r("button",{type:"button",onClick:Ke,disabled:!be.value||d(p).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[d(p).processing?(l(),m("svg",is,t[31]||(t[31]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 \r
              5.373 0 12h4zm2 5.291A7.962 7.962 0 \r
              014 12H0c0 3.042 1.135 5.824 3 \r
              7.938l3-2.647z`},null,-1)]))):h("",!0),r("span",null,N(d(p).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ns)],2)):h("",!0),je.value?(l(),m("button",{key:1,onMousedown:t[12]||(t[12]=(...i)=>d(k)&&d(k)(...i)),onMouseup:t[13]||(t[13]=(...i)=>d(L)&&d(L)(...i)),onMouseleave:t[14]||(t[14]=(...i)=>d(V)&&d(V)(...i)),onMousemove:t[15]||(t[15]=(...i)=>d(M)&&d(M)(...i)),onTouchstart:t[16]||(t[16]=(...i)=>d(k)&&d(k)(...i)),onTouchend:t[17]||(t[17]=(...i)=>d(L)&&d(L)(...i)),onTouchmove:t[18]||(t[18]=(...i)=>d(M)&&d(M)(...i)),onClick:Q,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:st({left:d(e).x+"px",top:d(e).y+"px"})},t[32]||(t[32]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):h("",!0),Ge(Ct,{show:B.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:Oe},{default:Je(()=>[r("div",os,[r("div",as,[pt(r("input",{"onUpdate:modelValue":t[19]||(t[19]=i=>$.value=i),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[gt,$.value]]),t[33]||(t[33]=r("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[r("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),r("div",ls,[fe.value.length===0?(l(),m("div",rs," Tidak ada point yang ditemukan ")):h("",!0),(l(!0),m($e,null,Ze(fe.value,i=>{var Xe,tt;return l(),m("button",{key:i.id,onClick:fs=>Le(i),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[r("div",ds,N((Xe=i.inspection_point)==null?void 0:Xe.name),1),r("div",cs,N((tt=i.inspection_point)==null?void 0:tt.description),1),r("div",ps,N(he(i)),1),ve(i.inspection_point_id)?(l(),m("div",gs," âœ“ Sudah ada data ")):h("",!0)],8,us)}),128))])])]),_:1},8,["show"]),H.value?(l(),U(Vt,{key:(v=x.value)==null?void 0:v.id,show:H.value,title:((y=(g=x.value)==null?void 0:g.inspection_point)==null?void 0:y.name)||"Detail Point",subtitle:(q=(D=x.value)==null?void 0:D.inspection_point)==null?void 0:q.description,name:`point-${(_e=x.value)==null?void 0:_e.id}`,"inspection-id":a.inspection.id,"point-id":(Ce=x.value)==null?void 0:Ce.inspection_point_id,settings:((Ve=x.value)==null?void 0:Ve.settings)||{},options:((Se=(De=x.value)==null?void 0:De.settings)==null?void 0:Se.radios)||[],"selected-Point":x.value,"selected-value":j.value,"images-value":d(p).images[(K=x.value)==null?void 0:K.inspection_point_id],"notes-value":F.value,point:x.value,"existing-data":ze((W=x.value)==null?void 0:W.inspection_point_id),"onUpdate:selectedValue":t[20]||(t[20]=i=>j.value=i),"onUpdate:notesValue":t[21]||(t[21]=i=>F.value=i),"onUpdate:imagesValue":Be,onSave:He,onClose:ae,onHapus:we},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):h("",!0)],2)])}}},Cs=at(ms,[["__scopeId","data-v-a3347351"]]);export{Cs as default};
