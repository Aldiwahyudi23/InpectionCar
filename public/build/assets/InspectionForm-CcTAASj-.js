import{x as je,d as _,m as ke,z as Ne,A as ae,e as i,o as n,a as e,f as y,b as de,p as ce,v as we,u as Z,F as oe,h as ne,t as q,g as ue,k as be,w as me,l as Q,n as ie,C as Pe,D as ye,E as Me,c as se,r as Ue,T as Ie,G as Ce,W as Se,H as De}from"./app-Ch5resOI.js";import{l as xe}from"./lodash-DJMY3jkO.js";import{_ as qe}from"./PrimaryButton-BdEPUOuK.js";import{_ as Ae}from"./ActionMessage-BMLCqKcI.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Le}from"./InputNumber-DqYQUmoG.js";const Be={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Fe={key:0,class:"p-4 space-y-4"},Ee={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},ze={class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},He={class:"relative"},Oe={key:0,class:"absolute right-3 top-3"},We={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ke={key:0},Xe=["onMousedown"],Ge={class:"font-medium text-gray-900"},Je={class:"text-sm text-gray-500"},Ze={key:1,class:"p-4 text-sm text-gray-500 text-center"},Qe={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ye={key:0,class:"mb-4"},et=["innerHTML"],tt={key:1},st={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},at=["onClick"],ot=["src","alt"],nt={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},it={class:"text-white text-xs text-center"},lt={key:2,class:"text-center py-4 text-gray-500 text-sm"},rt={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},ut=["src","alt"],dt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},ct={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},mt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},gt={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array},emits:["update-vehicle"],setup(t,{emit:V}){var H,W,Y,le;const a=t,$=V,l=je({plate_number:((H=a.inspection)==null?void 0:H.plate_number)||"",car_id:((W=a.inspection)==null?void 0:W.car_id)||null,car_name:((le=(Y=a.inspection)==null?void 0:Y.car)==null?void 0:le.name)||""}),r=_(l.car_name),h=_(!1),u=_(!1),d=_([]),w=_(null),m=_([]),s=_(!1),p=_(0);ke(()=>{var S,C,x,o;if((S=a.inspection)!=null&&S.car_id&&((C=a.CarDetail)==null?void 0:C.length)>0){const b=a.CarDetail.find(g=>g.id===a.inspection.car_id);b&&z(b)}else!((x=a.inspection)!=null&&x.car_id)&&((o=a.inspection)!=null&&o.car_name)&&(r.value=a.inspection.car_name);window.addEventListener("keydown",N)}),Ne(()=>{window.removeEventListener("keydown",N)}),ae(r,S=>{l.car_id&&I(w.value)!==S&&(l.car_id=null,w.value=null,m.value=[]),l.car_name=S});const I=S=>{var x,o,b;if(!S)return"";const C=[];return(x=S.brand)!=null&&x.name&&C.push(S.brand.name),(o=S.model)!=null&&o.name&&C.push(S.model.name),(b=S.type)!=null&&b.name&&C.push(S.type.name),S.cc&&C.push(`${S.cc}cc`),S.transmission&&C.push(S.transmission),S.fuel_type&&C.push(S.fuel_type),S.year&&C.push(S.year.toString()),S.production_period&&C.push(`(${S.production_period})`),C.join(" ")},A=xe.debounce(()=>{if(!r.value.trim()){d.value=[],h.value=!1;return}u.value=!0;try{const S=r.value.toLowerCase().trim();d.value=a.CarDetail.filter(C=>I(C).toLowerCase().includes(S)),h.value=!0}finally{u.value=!1}},300),j=()=>{setTimeout(()=>{h.value=!1},200)},z=async S=>{w.value=S,r.value=I(S),l.car_id=S.id,l.car_name=I(S),h.value=!1,await R(S.id),X()},F=S=>!S||!S.file_path?"":`/storage/${S.file_path}`,R=async S=>{try{const C=await fetch(`/api/cars/${S}/images`);if(C.ok){const x=await C.json();m.value=Array.isArray(x)?x:[]}else m.value=[]}catch(C){console.error("Error loading car images:",C),m.value=[]}},E=S=>{p.value=S,s.value=!0,document.body.style.overflow="hidden"},L=()=>{s.value=!1,document.body.style.overflow=""},k=()=>{p.value=(p.value+1)%m.value.length},U=()=>{p.value=(p.value-1+m.value.length)%m.value.length},N=S=>{if(s.value)switch(S.key){case"Escape":L();break;case"ArrowRight":k();break;case"ArrowLeft":U();break}},X=()=>{const S={plate_number:l.plate_number,car_id:l.car_id,car_name:l.car_name};$("update-vehicle",S)},te=()=>{a.inspection&&l.post(route("inspections.updateVehicleDetails",{inspection:a.inspection.id}),{preserveScroll:!0})};return ae(()=>a.inspection,S=>{var C;if(S)if(l.plate_number=S.plate_number||"",l.car_id=S.car_id||null,S.car_id&&((C=a.CarDetail)==null?void 0:C.length)>0){const x=a.CarDetail.find(o=>o.id===S.car_id);x&&z(x)}else S.car_name&&(r.value=S.car_name,l.car_name=S.car_name)},{deep:!0}),(S,C)=>{var x;return n(),i("div",Be,[C[17]||(C[17]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(n(),i("div",Fe,[e("div",Ee,[C[6]||(C[6]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nomor Plat Kendaraan ",-1)),ce(e("input",{"onUpdate:modelValue":C[0]||(C[0]=o=>Z(l).plate_number=o),type:"text",placeholder:"Contoh: B 1234 ABC",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:X},null,544),[[we,Z(l).plate_number]])]),e("div",ze,[C[9]||(C[9]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",He,[ce(e("input",{"onUpdate:modelValue":C[1]||(C[1]=o=>r.value=o),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",onInput:C[2]||(C[2]=(...o)=>Z(A)&&Z(A)(...o)),onFocus:C[3]||(C[3]=o=>h.value=!0),onBlur:j},null,544),[[we,r.value]]),u.value?(n(),i("div",Oe,C[7]||(C[7]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):y("",!0),h.value?(n(),i("div",We,[d.value.length>0?(n(),i("div",Ke,[(n(!0),i(oe,null,ne(d.value,o=>(n(),i("div",{key:o.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:b=>z(o)},[e("div",Ge,q(I(o)),1),e("div",Je,q(o.year)+" • "+q(o.cc)+"cc • "+q(o.transmission)+" • "+q(o.fuel_type),1)],40,Xe))),128))])):(n(),i("div",Ze,C[8]||(C[8]=[ue(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),ue(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):y("",!0)]),ce(e("input",{type:"hidden","onUpdate:modelValue":C[4]||(C[4]=o=>Z(l).car_id=o)},null,512),[[we,Z(l).car_id]])]),Z(l).car_id&&w.value?(n(),i("div",Qe,[w.value.description?(n(),i("div",Ye,[C[10]||(C[10]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:w.value.description},null,8,et)])):y("",!0),m.value.length>0?(n(),i("div",tt,[C[11]||(C[11]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",st,[(n(!0),i(oe,null,ne(m.value,(o,b)=>(n(),i("div",{key:o.id||b,class:"relative group cursor-pointer",onClick:g=>E(b)},[e("img",{src:F(o),alt:o.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ot),o.note?(n(),i("div",nt,[e("p",it,q(o.note),1)])):y("",!0)],8,at))),128))])])):(n(),i("div",lt," Tidak ada gambar tersedia untuk mobil ini "))])):y("",!0),s.value?(n(),i("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:L},[e("div",rt,[e("button",{onClick:L,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},C[12]||(C[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),m.value.length>1?(n(),i("button",{key:0,onClick:be(U,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},C[13]||(C[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),m.value.length>1?(n(),i("button",{key:1,onClick:be(k,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},C[14]||(C[14]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0),e("img",{src:F(m.value[p.value]),alt:"Car Image "+(p.value+1),class:"max-w-full max-h-full object-contain",onClick:C[5]||(C[5]=be(()=>{},["stop"]))},null,8,ut),m.value.length>1?(n(),i("div",dt,q(p.value+1)+" / "+q(m.value.length),1)):y("",!0),(x=m.value[p.value])!=null&&x.note?(n(),i("div",ct,q(m.value[p.value].note),1)):y("",!0)])])):y("",!0),de(qe,{type:"button",onClick:te,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},{default:me(()=>[Z(l).processing?(n(),i("svg",mt,C[15]||(C[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),e("span",null,q(Z(l).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),de(Ae,{on:Z(l).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:me(()=>C[16]||(C[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ue(" Tersimpan. ")])),_:1,__:[16]},8,["on"])]),_:1})])):y("",!0)])}}},vt=ge(gt,[["__scopeId","data-v-04b281af"]]),pt={class:"mt-1"},ht=["value","required","minlength","maxlength","allowSpace","placeholder"],ft={key:0,class:"mt-2 text-sm text-red-600"},wt={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,$=V,l=Q(()=>{if(!a.modelValue)return"";let h=a.modelValue;switch(a.allowSpace||(h=h.replace(/\s+/g,"")),a.textTransform){case"uppercase":return h.toUpperCase();case"lowercase":return h.toLowerCase();case"capitalize":return h.replace(/\b\w/g,u=>u.toUpperCase());default:return h}}),r=h=>{let u=h.target.value;switch(a.allowSpace||(u=u.replace(/\s+/g,"")),a.textTransform){case"uppercase":u=u.toUpperCase();break;case"lowercase":u=u.toLowerCase();break;case"capitalize":u=u.replace(/\b\w/g,d=>d.toUpperCase());break}$("update:modelValue",u),$("save",a.pointId)};return(h,u)=>(n(),i("div",pt,[e("input",{value:l.value,onInput:r,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:ie(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,ht),t.error?(n(),i("p",ft,q(t.error),1)):y("",!0)]))}},yt={class:"mt-1"},bt=["value","required","min","max"],xt={key:0,class:"mt-2 text-sm text-red-600"},kt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,$=V,l=r=>{$("update:modelValue",r.target.value),$("save",a.pointId)};return(r,h)=>(n(),i("div",yt,[e("input",{value:t.modelValue,onChange:l,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,bt),t.error?(n(),i("p",xt,q(t.error),1)):y("",!0)]))}},$t={class:"mt-1"},Ct=["value","required","placeholder"],It={key:0,class:"mt-2 text-sm text-red-600"},St={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,$=V,l=_(""),r=Q(()=>{var m,s,p,I;return{currency_symbol:((m=a.settings)==null?void 0:m.currency_symbol)||"Rp",thousands_separator:((s=a.settings)==null?void 0:s.thousands_separator)||",",min_value:((p=a.settings)==null?void 0:p.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((I=a.settings)==null?void 0:I.max_value)!==void 0?Number(a.settings.max_value):1e9}}),h=m=>{if(m==null||m==="")return"";const s=Number(m);if(isNaN(s))return"";let p=s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return r.value.thousands_separator!==","&&(p=p.replace(/,/g,r.value.thousands_separator)),p},u=m=>m?m.replace(/[^\d]/g,""):"",d=Q(()=>l.value?`${r.value.currency_symbol} ${h(l.value)}`:""),w=m=>{let s=u(m.target.value),p=Number(s);r.value.min_value!==void 0&&p<r.value.min_value&&(s=r.value.min_value.toString()),r.value.max_value!==void 0&&p>r.value.max_value&&(s=r.value.max_value.toString()),l.value=s,$("update:modelValue",s),$("save",a.pointId)};return ae(()=>a.modelValue,m=>{m!=null&&(l.value=m.toString())},{immediate:!0}),(m,s)=>(n(),i("div",$t,[e("input",{value:d.value,onInput:w,type:"text",required:t.required,placeholder:t.placeholder,class:ie(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,Ct),t.error?(n(),i("p",It,q(t.error),1)):y("",!0)]))}},Vt={class:"mt-1 space-y-3"},_t={key:0,class:"space-y-2"},Mt={class:"flex flex-wrap gap-2"},Ut=["onClick"],jt=["value","required","minlength","maxlength","placeholder"],Nt={class:"flex justify-between items-center mt-1"},Rt={class:"text-xs text-gray-500"},Tt={key:0,class:"text-xs text-red-600"},Re={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,$=V,l=_([]),r=_(""),h=m=>l.value.some(s=>s.value===m),u=m=>{h(m.value)?l.value=l.value.filter(A=>A.value!==m.value):l.value.push(m);const p=[...l.value.map(A=>A.value)];r.value.trim()&&p.push(r.value.trim());const I=p.join(", ");$("update:modelValue",I),$("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:I})},d=m=>{const s=m.target.value;$("update:modelValue",s),$("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:s}),w(s)},w=m=>{var A,j,z,F;if(!m){l.value=[],r.value="";return}const s=m.split(",").map(R=>R.trim()).filter(R=>R),p=((j=(A=a.settings)==null?void 0:A.damage_options)==null?void 0:j.map(R=>R.value))||[];l.value=((F=(z=a.settings)==null?void 0:z.damage_options)==null?void 0:F.filter(R=>s.includes(R.value)))||[];const I=s.filter(R=>!p.includes(R));r.value=I.join(", ")};return ae(()=>a.modelValue,m=>{m!=null&&w(m)},{immediate:!0}),(m,s)=>{var p,I,A;return n(),i("div",Vt,[(p=t.settings)!=null&&p.enable_damage&&((I=t.settings)!=null&&I.damage_options)?(n(),i("div",_t,[s[0]||(s[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",Mt,[(n(!0),i(oe,null,ne(t.settings.damage_options,(j,z)=>(n(),i("button",{key:z,type:"button",onClick:F=>u(j),class:ie(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":h(j.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!h(j.value)}])},q(j.label),11,Ut))),128))])])):y("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:d,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,jt),e("div",Nt,[e("span",Rt,q(((A=t.modelValue)==null?void 0:A.length)||0)+"/"+q(t.maxLength||400),1),t.error?(n(),i("p",Tt,q(t.error),1)):y("",!0)])])])}}},Pt={class:"mt-1"},Dt=["value","required"],qt={key:0,class:"mt-2 text-sm text-red-600"},At={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:V}){const a=t,$=V,l=r=>{$("update:modelValue",r.target.value),$("save",a.pointId)};return(r,h)=>(n(),i("div",Pt,[e("select",{value:t.modelValue,onChange:l,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},h[0]||(h[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Dt),t.error?(n(),i("p",qt,q(t.error),1)):y("",!0)]))}},Lt=ge(At,[["__scopeId","data-v-c34a74db"]]),Bt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Ft={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Et={class:"flex flex-row space-x-4 mb-6"},zt={class:"mt-4 text-right"},Ht={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(V,a)=>t.show?(n(),i("div",Bt,[e("div",Ft,[a[5]||(a[5]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6 text-center"},"Pilih Sumber Gambar",-1)),e("div",Et,[e("button",{onClick:a[0]||(a[0]=$=>V.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[3]||(a[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:a[1]||(a[1]=$=>V.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[4]||(a[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",zt,[e("button",{onClick:a[2]||(a[2]=$=>V.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):y("",!0)}},Ot={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Wt={class:"webcam-content-box"},Kt={class:"webcam-header"},Xt={class:"inspection-point-name"},Gt={key:0,class:"screen-flash-overlay"},Jt={key:2,class:"focus-status"},Zt={class:"webcam-footer"},Qt={class:"camera-controls"},Yt=["disabled"],es={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,inspectionPoint:String,point:Object,pointname:String},emits:["close","photoCaptured"],setup(t,{emit:V}){const a=t,$=V,l=_(null),r=_(null);let h=null,u=null;const d=_("environment"),w=_(!1),m=_(!1),s=_(!1),p=_(!1),I=_(a.inspectionPoint||"Camera"),A=_(!1),j=_({}),z=_(""),F=_("continuous"),R=_("high"),E=Q(()=>{switch(R.value){case"high":return{width:1920,height:1080};case"medium":return{width:1280,height:720};case"low":return{width:640,height:480};default:return{width:1920,height:1080}}}),L=Q(()=>a.aspectRatio?{aspectRatio:`${a.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),k=Q(()=>{if(!a.aspectRatio)return{};const x=a.aspectRatio,o=x>1?80:60,b=x>1?80/x:60*x;return{width:`${o}%`,height:`${b}%`}}),U=Q(()=>{var x;return((x=a.settings)==null?void 0:x.max_size)||2048}),N=async()=>{h&&h.getTracks().forEach(x=>x.stop()),s.value=!1,A.value=!1,z.value="";try{const x={facingMode:d.value,width:{ideal:E.value.width},height:{ideal:E.value.height},aspectRatio:{ideal:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30}};R.value==="high"&&(x.width={ideal:1920,max:3840},x.height={ideal:1080,max:2160},x.frameRate={ideal:30,max:60}),F.value!=="manual"&&(x.advanced=[{focusMode:F.value}]),d.value==="environment"&&(x.advanced||(x.advanced=[]),x.advanced.push({focusMode:F.value})),h=await navigator.mediaDevices.getUserMedia({video:x,audio:!1}),u=h.getVideoTracks()[0],l.value.srcObject=h,l.value.onloadedmetadata=async()=>{await te(),(F.value==="continuous"||F.value==="single-shot")&&await H()}}catch(x){console.error("Error accessing camera: ",x),alert("Failed to access camera. Please allow camera permission."),$("close")}},X=()=>{h&&h.getTracks().forEach(x=>x.stop()),$("close")},te=async()=>{if(u)try{const x=await navigator.mediaDevices.enumerateDevices();w.value=x.filter(g=>g.kind==="videoinput").length>1;const o=u.getCapabilities();m.value=o.torch||o.fillLightMode&&o.fillLightMode.includes("torch");const b=o.focusDistance||{};console.log("Camera capabilities:",o)}catch(x){console.error("Error checking camera capabilities:",x)}},H=async()=>{if(u)try{const x=u.getCapabilities();x.focusMode&&x.focusMode.includes("continuous")&&(await u.applyConstraints({advanced:[{focusMode:"continuous"}]}),z.value="Auto Focus Enabled",setTimeout(()=>{z.value=""},2e3))}catch(x){console.warn("Auto focus not supported:",x)}},W=async()=>{if(!(!u||!a.settings.enable_flash)){if(d.value==="user"){s.value=!s.value,p.value=s.value;return}try{u.getCapabilities().torch&&(await u.applyConstraints({advanced:[{torch:!s.value}]}),s.value=!s.value)}catch(x){console.error("Flash toggle failed:",x)}}},Y=async()=>{w.value&&(d.value=d.value==="environment"?"user":"environment",I.value=`${a.inspectionPoint||"Camera"} (${d.value==="environment"?"Rear":"Front"})`,await N())},le=async()=>{if(!u)return;const x=u.getCapabilities();if(x.focusMode&&x.focusMode.includes("continuous"))try{await u.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(o){console.warn("Focus not supported",o)}},S=async x=>new Promise(o=>{const b=U.value*1024;if(x.size<=b){o(x);return}const g=new Image,D=new FileReader;D.onload=M=>{g.onload=()=>{const f=document.createElement("canvas"),P=f.getContext("2d"),K=Math.sqrt(b/x.size);f.width=g.width*K,f.height=g.height*K,P.drawImage(g,0,0,f.width,f.height);let v=.9;const c=()=>{f.toBlob(T=>{T.size>b&&v>.1?(v-=.1,c()):o(T)},"image/png",v)};c()},g.src=M.target.result},D.readAsDataURL(x)}),C=async()=>{const x=l.value,o=r.value;if(!(!x||!o||x.readyState!==4))try{const b=o.getContext("2d"),g=x.videoWidth,D=x.videoHeight;let M,f,P,K;g/D>a.aspectRatio?(f=D,M=D*a.aspectRatio,P=(g-M)/2,K=0):(M=g,f=g/a.aspectRatio,P=0,K=(D-f)/2),o.width=M,o.height=f,b.drawImage(x,P,K,M,f,0,0,M,f);const v=await new Promise(T=>{o.toBlob(T,"image/png",1)}),c=await S(v);if(c){const T=new File([c],`capture_${Date.now()}.png`,{type:"image/png",lastModified:Date.now()});$("photoCaptured",T),p.value=!0,setTimeout(()=>{p.value=!1},100)}}catch(b){console.error("Error capturing photo:",b),alert("Failed to capture photo. Please try again.")}};return ae(()=>a.show,x=>{x?N():X()}),ae(()=>a.inspectionPoint,x=>{I.value=x||"Camera"}),ae(()=>a.aspectRatio,()=>{a.show&&N()}),Pe(()=>{h&&h.getTracks().forEach(x=>x.stop())}),(x,o)=>{var b;return t.show?(n(),i("div",Ot,[e("div",Wt,[e("div",Kt,[e("div",Xt,q(((b=t.point)==null?void 0:b.name)||"Camera"),1),e("button",{onClick:X,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},o[0]||(o[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:ye(L.value),onClick:le},[e("video",{ref_key:"webcamVideo",ref:l,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:r,class:"hidden"},null,512),p.value?(n(),i("div",Gt)):y("",!0),e("div",{class:"aspect-ratio-guide",style:ye(k.value)},null,4),A.value?(n(),i("div",{key:1,class:"focus-indicator",style:ye(j.value)},o[1]||(o[1]=[e("div",{class:"focus-ring"},null,-1)]),4)):y("",!0),o[2]||(o[2]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),z.value?(n(),i("div",Jt,q(z.value),1)):y("",!0)],4),e("div",Zt,[e("div",Qt,[t.settings.enable_flash?(n(),i("button",{key:0,onClick:W,disabled:!m.value,class:ie(["control-button",{active:s.value,disabled:!m.value}])},o[3]||(o[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),10,Yt)):y("",!0),e("button",{onClick:C,class:"capture-button"},o[4]||(o[4]=[e("div",{class:"camera-icon-container"},[e("div",{class:"camera-body"},[e("div",{class:"camera-lens"}),e("div",{class:"camera-flash"})])],-1)])),t.settings.enable_camera_switch&&w.value?(n(),i("button",{key:1,onClick:Y,class:"control-button"},o[5]||(o[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):y("",!0)])])])])):y("",!0)}}},ts=ge(es,[["__scopeId","data-v-73221082"]]),ss={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},as={class:"w-full h-full flex flex-col"},os={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},ns={class:"text-lg font-semibold"},is={class:"flex items-center gap-2"},ls={class:"flex-1 flex items-center justify-center overflow-hidden relative"},rs=["src"],us={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},ds={class:"flex justify-between items-center w-full"},cs=["disabled"],ms={key:1,class:"flex-1"},gs=["disabled"],vs={class:"flex gap-3 w-full"},ps=["disabled"],hs={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium",disabled:""},fs={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos"],setup(t,{emit:V}){const a=t,$=V,l=_(0),r=_([]),h=_(0),u=_(0),d=Q(()=>r.value.length>0?r.value[l.value]:null);ae(()=>a.images,L=>{r.value=L.map(k=>({...k})),a.show&&L.length>0?l.value=L.length-1:l.value=0,L.length===0&&a.show&&F()},{deep:!0,immediate:!0}),ae(()=>a.show,L=>{L&&a.images.length>0&&(l.value=a.images.length-1)});const w=L=>L.preview||(L.image_path?`/${L.image_path}`:""),m=()=>{d.value&&(d.value.rotation=(d.value.rotation+90)%360)},s=()=>{l.value=l.value<r.value.length-1?l.value+1:0},p=()=>{l.value=l.value>0?l.value-1:r.value.length-1},I=L=>{h.value=L.touches[0].clientX},A=L=>{u.value=L.touches[0].clientX},j=()=>{h.value-u.value>50?s():u.value-h.value>50&&p(),h.value=0,u.value=0},z=()=>{a.isUploading||$("saveImages",r.value)},F=()=>{a.isUploading||$("close")},R=()=>{if(d.value&&!a.isUploading){const L=d.value;$("removePreviewImage",L);const k=r.value.findIndex(U=>U.isNew&&L.isNew&&U.preview===L.preview||!U.isNew&&!L.isNew&&U.id===L.id);k!==-1&&r.value.splice(k,1),l.value>=r.value.length&&(l.value=Math.max(0,r.value.length-1)),r.value.length===0&&$("close")}},E=()=>{a.isUploading||$("triggerAddMorePhotos")};return(L,k)=>{var U;return t.show?(n(),i("div",ss,[e("div",as,[e("div",os,[e("button",{onClick:F,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},k[0]||(k[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",ns,q(((U=t.point)==null?void 0:U.name)||"Preview")+" ("+q(l.value+1)+"/"+q(r.value.length)+") ",1),e("div",is,[d.value&&d.value.isNew?(n(),i("button",{key:0,onClick:R,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image"},k[1]||(k[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):y("",!0),e("button",{onClick:m,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors"},k[2]||(k[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))])]),e("div",ls,[e("div",{class:"relative w-full max-w-full",style:ye({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"}),onTouchstart:I,onTouchmove:A,onTouchend:j},[d.value?(n(),i("img",{key:0,src:w(d.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:ye({transform:`rotate(${d.value.rotation}deg)`})},null,12,rs)):y("",!0)],36),r.value.length>1?(n(),i("button",{key:0,onClick:p,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},k[3]||(k[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):y("",!0),r.value.length>1?(n(),i("button",{key:1,onClick:s,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors"},k[4]||(k[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):y("",!0)]),e("div",us,[e("div",ds,[d.value&&!d.value.isNew?(n(),i("button",{key:0,onClick:R,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},k[5]||(k[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,cs)):(n(),i("div",ms)),t.allowMultiple&&r.value.length<t.maxFiles?(n(),i("button",{key:2,onClick:E,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},k[6]||(k[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ue(" Tambah Foto ")]),8,gs)):y("",!0)]),e("div",vs,[e("button",{onClick:F,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",disabled:t.isUploading}," Batal ",8,ps),t.isUploading?(n(),i("button",hs,k[7]||(k[7]=[ue(" Menyimpan"),e("span",{class:"loading-dots ml-1"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1)]))):(n(),i("button",{key:0,onClick:z,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium"}," Simpan "))])])])])):y("",!0)}}},ws=ge(fs,[["__scopeId","data-v-65578d6b"]]),ys=["accept","multiple","disabled"],bs=["disabled"],xs={class:"h-full flex flex-col items-center justify-center p-4 text-center"},ks={class:"text-xs text-gray-400 mt-1"},$s={key:0,class:"flex items-center gap-4"},Cs=["src"],Is=["disabled"],Ss={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Vs=["disabled"],_s=["onClick"],Ms=["src"],Us={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},js={key:0},Ns={key:1,class:"ml-1"},Rs={key:2,class:"mt-1 text-xs text-red-600"},Ts={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded"],setup(t,{emit:V}){const a=t,$=V,l=_(null),r=_(null),h=_(!1),u=_(!1),d=_(!1),w=_([]),m=_(0),s=_(!1),p=Q(()=>Number(a.settings.max_files)>1),I=Q(()=>a.settings.allowed_types.map(o=>`.${o}`).join(", ")),A=Q(()=>{const o=a.settings.camera_aspect_ratio.split(":");if(o.length===2){const b=parseFloat(o[0]),g=parseFloat(o[1]);if(!isNaN(b)&&!isNaN(g)&&g!==0)return b/g}return 4/3});ae(()=>a.modelValue,o=>{if(!o||o.length===0)w.value=[];else{const b=o.filter(D=>!D.isNew),g=w.value.filter(D=>D.isNew);w.value=[...g,...b]}},{immediate:!0,deep:!0});const j=Q(()=>{const o=[],b=new Set;for(const g of w.value)g.id&&b.add(g.id),o.push(g);for(const g of a.modelValue)g.inspection_id&&String(g.inspection_id)==String(a.inspectionId)||b.has(g.id)||o.push({...g,rotation:g.rotation||0,isNew:!1,preview:g.preview||(g.image_path?`/${g.image_path}`:null)});return o}),z=o=>o.preview||(o.image_path?`/${o.image_path}`:""),F=()=>{d.value&&(d.value=!1),h.value=!0},R=()=>{h.value=!1,l.value.click()},E=()=>{h.value=!1,u.value=!0},L=()=>{h.value=!1,j.value.length>0&&(d.value=!0)},k=()=>{u.value=!1,j.value.length>0&&(d.value=!0)},U=()=>{d.value=!1,w.value.forEach(o=>{o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview)}),w.value=[]},N=o=>new Promise(b=>{const g=new FileReader;g.onload=D=>{const M=new Image;M.onload=()=>{b({file:o,preview:URL.createObjectURL(o),rotation:0,width:M.naturalWidth,height:M.naturalHeight,isNew:!0})},M.onerror=()=>{console.error("Failed to load image for dimensions:",o.name),b({file:o,preview:URL.createObjectURL(o),rotation:0,width:0,height:0,isNew:!0})},M.src=D.target.result},g.readAsDataURL(o)}),X=o=>{const b=o.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes(b)},te=async o=>{const g=(a.settings.max_size||2048)*1024;return new Promise(D=>{const M=new Image,f=new FileReader;f.onload=P=>{M.onload=()=>{const K=document.createElement("canvas"),v=K.getContext("2d"),c=Math.max(M.width,M.height);K.width=c,K.height=c,v.fillStyle="white",v.fillRect(0,0,c,c);const T=(c-M.width)/2,B=(c-M.height)/2;v.drawImage(M,T,B,M.width,M.height);let G=.9;const J=()=>{K.toBlob(ee=>{if(ee.size>g&&G>.1)G-=.1,J();else{const re=new File([ee],o.name,{type:"image/jpeg",lastModified:Date.now()});D(re)}},"image/jpeg",G)};J()},M.src=P.target.result},f.readAsDataURL(o)})},H=async o=>{const b=Array.from(o.target.files);if(!b.length){h.value=!1,j.value.length>0&&(d.value=!0);return}try{const g=b.filter(v=>!X(v));if(g.length>0){const v=g.map(c=>c.name.split(".").pop()).join(", ");alert(`File type not allowed: ${v}. Allowed types: ${a.settings.allowed_types.join(", ")}`),o.target.value="";return}const D=j.value.length,M=a.settings.max_files-D,f=await Promise.all(b.slice(0,M).map(async v=>await te(v))),P=await Promise.all(f.map(N)),K=p.value?P:P.slice(0,1);p.value?w.value.push(...K):(w.value.forEach(v=>{v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}),w.value=K),h.value=!1,K.length>0?(m.value=Math.max(0,j.value.length-K.length),d.value=!0):j.value.length>0&&(d.value=!0),o.target.value=""}catch(g){console.error("Error processing selected images:",g),alert("Failed to process selected images. Please try again."),h.value=!1,j.value.length>0&&(d.value=!0)}},W=async o=>{const b=j.value.length;if(!p.value||b<a.settings.max_files)try{const g=await te(o),D=new Image;D.onload=()=>{const M={file:g,preview:URL.createObjectURL(g),rotation:0,width:D.naturalWidth,height:D.naturalHeight,isNew:!0};p.value?w.value.push(M):(w.value.forEach(f=>{f.preview&&f.preview.startsWith("blob:")&&URL.revokeObjectURL(f.preview)}),w.value=[M]),u.value=!1,h.value=!1,m.value=j.value.length-1,d.value=!0},D.src=URL.createObjectURL(g)}catch(g){console.error("Error processing captured image:",g),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),u.value=!1,h.value=!1,j.value.length>0&&(d.value=!0)},Y=(o=0)=>{m.value=o,d.value=!0},le=o=>new Promise(b=>{if(o.rotation===0||!r.value){if(!o.isNew&&!o.file){b({file:null,width:o.width,height:o.height,isOriginal:!0});return}b({file:o.file,width:o.width,height:o.height});return}const g=new Image;g.onload=async()=>{try{const D=r.value,M=D.getContext("2d"),f=g.width,P=g.height;let K,v;o.rotation===90||o.rotation===270?(K=P,v=f):(K=f,v=P),D.width=K,D.height=v,M.clearRect(0,0,D.width,D.height),M.translate(D.width/2,D.height/2),M.rotate(o.rotation*Math.PI/180),M.drawImage(g,-f/2,-P/2,f,P),M.setTransform(1,0,0,1,0,0);const c=await new Promise(G=>{D.toBlob(G,"image/jpeg",.9)}),T=new File([c],o.file?o.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),B=await te(T);b({file:B,width:K,height:v})}catch(D){console.error("Error processing rotated image:",D),b({file:o.file,width:o.width,height:o.height})}},g.onerror=()=>{console.error("Failed to load image for rotation processing:",o.preview),b({file:o.file,width:o.width,height:o.height})},g.src=o.preview}),S=async o=>{var g,D,M,f;s.value=!0;const b=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),s.value=!1;return}try{for(const P of o){if(!P.isNew&&P.rotation===0&&P.id&&P.image_path){b.push({id:P.id,image_path:P.image_path,width:P.width,height:P.height,rotation:0,preview:P.preview});continue}const{file:K,width:v,height:c,isOriginal:T}=await le(P);if(T&&!P.isNew){b.push({id:P.id,image_path:P.image_path,width:P.width,height:P.height,rotation:0,preview:P.preview});continue}const B=new FormData;B.append("inspection_id",a.inspectionId),B.append("point_id",a.pointId),B.append("image",K),B.append("width",v),B.append("height",c),B.append("rotation",0),P.id&&!P.isNew&&B.append("image_id",P.id);const J=(await Me.post(route("inspections.upload-image"),B,{headers:{"Content-Type":"multipart/form-data"}})).data.image;b.push({id:J.id,image_path:J.image_path,width:J.width,height:J.height,rotation:J.rotation,preview:J.public_url}),P.preview&&P.preview.startsWith("blob:")&&URL.revokeObjectURL(P.preview)}$("update:modelValue",b),$("save",a.pointId),$("uploaded",{pointId:a.pointId,images:b}),U()}catch(P){if(console.error("Error during image processing/upload:",P),(D=(g=P.response)==null?void 0:g.data)!=null&&D.message)alert(`Failed to save images: ${P.response.data.message}`);else if((f=(M=P.response)==null?void 0:M.data)!=null&&f.errors){const K=Object.values(P.response.data.errors).flat().join(`
`);alert(`Failed to save images:
${K}`)}else alert(`Failed to save images: ${P.message}`)}finally{s.value=!1}},C=o=>{if(o){if(o.id&&!o.isNew)x(o);else{const b=w.value.findIndex(g=>g.preview&&g.preview===o.preview&&g.isNew||g.id&&g.id===o.id);if(b!==-1){const g=w.value.splice(b,1)[0];g.preview&&g.preview.startsWith("blob:")&&URL.revokeObjectURL(g.preview)}$("update:modelValue",a.modelValue.filter(g=>!(g.id&&g.id===o.id)&&!(g.preview&&g.preview===o.preview)))}m.value>=j.value.length&&(m.value=Math.max(0,j.value.length-1)),j.value.length===0&&U()}},x=async o=>{var g,D;if(o.id||o.image_path)try{await Me.delete(route("inspections.delete-image"),{data:{image_id:o.id,image_path:o.image_path}})}catch(M){console.error("Error deleting image from server:",M),(D=(g=M.response)==null?void 0:g.data)!=null&&D.message?alert(`Failed to delete image from server: ${M.response.data.message}`):alert(`Failed to delete image from server: ${M.message}`);return}o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview);const b=a.modelValue.filter(M=>M.id!==o.id);$("update:modelValue",b),w.value=w.value.filter(M=>M.isNew&&o.isNew?M.preview!==o.preview:M.id!==o.id),$("removeImage",{image:o}),d.value&&j.value.length===0?U():d.value&&m.value>=j.value.length&&(m.value=Math.max(0,j.value.length-1))};return(o,b)=>(n(),i("div",null,[e("input",{ref_key:"galleryInput",ref:l,type:"file",accept:I.value,class:"hidden",onChange:H,multiple:p.value,disabled:s.value},null,40,ys),e("canvas",{ref_key:"processingCanvas",ref:r,class:"hidden"},null,512),j.value.length===0?(n(),i("label",{key:0,onClick:F,class:ie(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:s.value},[e("div",xs,[b[2]||(b[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),b[3]||(b[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),b[4]||(b[4]=e("p",{class:"text-xs text-gray-500"},"Click to open options",-1)),e("p",ks,"Allowed types: "+q(I.value),1)])],8,bs)):(n(),i("div",{key:1,class:ie(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[t.settings.max_files===1?(n(),i("div",$s,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:b[0]||(b[0]=g=>Y(0))},[e("img",{src:z(j.value[0]),class:"w-full h-full object-cover"},null,8,Cs)]),e("button",{onClick:b[1]||(b[1]=be(g=>x(j.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:s.value},b[5]||(b[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ue(" Hapus Foto ")]),8,Is)])):(n(),i("div",Ss,[p.value&&j.value.length<t.settings.max_files?(n(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:F,disabled:s.value},b[6]||(b[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Vs)):y("",!0),(n(!0),i(oe,null,ne(j.value,(g,D)=>(n(),i("div",{key:g.id||g.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:M=>Y(D)},[e("img",{src:z(g),class:"w-full h-full object-cover"},null,8,Ms),g.isNew||g.rotation!==0?(n(),i("div",Us,[g.isNew?(n(),i("span",js,"BARU")):y("",!0),g.rotation!==0?(n(),i("span",Ns,"ROTASI")):y("",!0)])):y("",!0)],8,_s))),128))]))],2)),t.error?(n(),i("p",Rs,q(t.error),1)):y("",!0),de(Ht,{show:h.value,onClose:L,onOpenWebcam:E,onTriggerGallery:R},null,8,["show"]),de(ts,{show:u.value,"aspect-ratio":A.value,settings:t.settings,point:t.point,onClose:k,onPhotoCaptured:W},null,8,["show","aspect-ratio","settings","point"]),de(ws,{show:d.value,images:j.value,point:t.point,"initial-index":m.value,"allow-multiple":p.value,"max-files":t.settings.max_files,"is-uploading":s.value,"aspect-ratio":A.value,onClose:U,onSaveImages:S,onRemovePreviewImage:C,onTriggerAddMorePhotos:F},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio"])]))}},Ve=ge(Ts,[["__scopeId","data-v-f8e05d93"]]),Ps={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Ds={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},qs={class:"px-4 pb-2 border-b border-gray-200"},As={class:"text-lg font-semibold text-gray-900"},Ls={key:0,class:"text-sm text-gray-500 mt-1"},Bs={class:"flex-1 overflow-y-auto p-4"},Fs={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Es={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:V}){const a=V,$=()=>{a("close")},l=r=>{r.key==="Escape"&&$()};return ke(()=>{document.addEventListener("keydown",l)}),Ne(()=>{document.removeEventListener("keydown",l)}),(r,h)=>(n(),se(Ie,{name:"bottom-sheet"},{default:me(()=>[t.show?(n(),i("div",Ps,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:$}),e("div",Ds,[h[0]||(h[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",qs,[e("h3",As,q(t.title),1),t.subtitle?(n(),i("p",Ls,q(t.subtitle),1)):y("",!0)]),e("div",Bs,[Ue(r.$slots,"default",{},void 0,!0)]),r.$slots.footer?(n(),i("div",Fs,[Ue(r.$slots,"footer",{},void 0,!0)])):y("",!0)])])):y("",!0)]),_:3}))}},Te=ge(Es,[["__scopeId","data-v-7893c2dc"]]),zs={class:"space-y-4"},Hs={key:0,class:"mt-2"},Os={class:"text-sm font-medium text-gray-700 mb-2"},Ws={key:0,class:"text-red-500"},Ks={key:0,class:"text-xs text-red-500"},Xs={key:1,class:"grid grid-cols-2 gap-2"},Gs=["name","value","checked"],Js={key:2,class:"space-y-2"},Zs={key:0,class:"text-red-500"},Qs={key:1,class:"text-xs text-red-500"},Ys={key:3,class:"mt-4"},ea={class:"text-sm font-medium text-gray-700 mb-2"},ta={key:0,class:"text-red-500"},sa={key:0,class:"text-xs text-red-500"},aa={class:"flex gap-2"},oa=["disabled"],_e={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage"],setup(t,{emit:V}){const a=t,$=V,l=u=>$("hapus",u),r=Q(()=>a.options.find(u=>u.value===a.selectedValue)),h=Q(()=>{var d,w,m;if(a.point.input_type==="imageTOradio"&&a.imagesValue.length===0||a.options.length&&!a.selectedValue)return!1;const u=r.value;return!(a.showTextarea&&((d=u==null?void 0:u.settings)!=null&&d.show_textarea)&&(!((w=a.notesValue)!=null&&w.trim())||u.settings.min_length&&a.notesValue.length<u.settings.min_length||u.settings.max_length&&a.notesValue.length>u.settings.max_length)||a.showImageUpload&&((m=u==null?void 0:u.settings)!=null&&m.show_image_upload)&&(a.imagesValue.length===0||u.settings.max_files&&a.imagesValue.length>u.settings.max_files))});return(u,d)=>(n(),se(Te,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:d[10]||(d[10]=w=>u.$emit("close"))},{footer:me(()=>[t.selectedPoint?(n(),i("button",{key:0,onClick:d[7]||(d[7]=w=>l(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},d[12]||(d[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ue(" Hapus Data ")]))):y("",!0),e("div",aa,[e("button",{type:"button",onClick:d[8]||(d[8]=w=>u.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:d[9]||(d[9]=w=>u.$emit("save")),disabled:!h.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,oa)])]),default:me(()=>{var w,m,s,p,I,A,j,z,F,R,E,L,k,U;return[e("div",zs,[t.point.input_type==="imageTOradio"?(n(),i("div",Hs,[e("h4",Os,[(w=t.point.settings)!=null&&w.required?(n(),i("span",Ws,"*")):y("",!0)]),de(Ve,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":d[0]||(d[0]=N=>u.$emit("update:imagesValue",N)),onSave:d[1]||(d[1]=N=>u.$emit("saveImage",N))},null,8,["model-value","point-id","point","inspection-id","settings"]),(m=t.point.settings)!=null&&m.required&&t.imagesValue.length===0?(n(),i("p",Ks," Foto wajib diupload ")):y("",!0)])):y("",!0),t.options.length?(n(),i("div",Xs,[(n(!0),i(oe,null,ne(t.options,(N,X)=>(n(),i("label",{key:X,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:N.value,checked:t.selectedValue===N.value,onChange:d[2]||(d[2]=te=>u.$emit("update:selectedValue",te.target.value)),class:"hidden peer"},null,40,Gs),e("div",{class:ie(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===N.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==N.value}])},q(N.label),3)]))),128))])):y("",!0),t.showTextarea&&((p=(s=r.value)==null?void 0:s.settings)!=null&&p.show_textarea)?(n(),i("div",Js,[(I=r.value.settings)!=null&&I.required?(n(),i("span",Zs,"*")):y("",!0),de(Re,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:r.value.settings,required:(A=r.value.settings)==null?void 0:A.required,"min-length":(j=r.value.settings)==null?void 0:j.min_length,"max-length":(z=r.value.settings)==null?void 0:z.max_length,placeholder:((F=r.value.settings)==null?void 0:F.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":d[3]||(d[3]=N=>u.$emit("update:notesValue",N)),onSave:d[4]||(d[4]=N=>u.$emit("saveTextarea",N))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(R=r.value.settings)!=null&&R.required&&!t.notesValue?(n(),i("p",Qs," Keterangan wajib diisi ")):y("",!0)])):y("",!0),t.showImageUpload&&((L=(E=r.value)==null?void 0:E.settings)!=null&&L.show_image_upload)?(n(),i("div",Ys,[e("h4",ea,[d[11]||(d[11]=ue(" Upload Foto ")),(k=r.value.settings)!=null&&k.required?(n(),i("span",ta,"*")):y("",!0)]),de(Ve,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:r.value.settings,"onUpdate:modelValue":d[5]||(d[5]=N=>u.$emit("update:imagesValue",N)),onSave:d[6]||(d[6]=N=>u.$emit("saveImage",N))},null,8,["model-value","point-id","point","inspection-id","settings"]),(U=r.value.settings)!=null&&U.required&&t.imagesValue.length===0?(n(),i("p",sa," Foto wajib diupload ")):y("",!0)])):y("",!0)])]}),_:1},8,["show","title","subtitle"]))}},na={class:"mt-2 space-y-4"},ia={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},la=["name","value","checked","onChange","required"],ra={key:0,class:"mt-4 p-4 border rounded-lg bg-gray-50"},ua={key:0,class:"mt-3"},da={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},ca=["src"],ma={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},ga={key:1,class:"mt-2"},va={class:"text-sm text-gray-600"},pa={key:2,class:"mt-2 text-sm text-red-600"},ha={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:V}){const a=t,$=V,l=_(a.notes),r=_([...a.images]),h=_(!1),u=_(""),d=_([]),w=_(""),m=_([]),s=Q(()=>a.options.find(k=>k.value===a.modelValue)),p=k=>k.settings&&(k.settings.show_textarea||k.settings.show_image_upload);ae(()=>a.notes,k=>{l.value=k}),ae(()=>a.images,k=>{r.value=[...k]}),ae(()=>a.modelValue,k=>{k&&(w.value=k)});const I=k=>{$("update:modelValue",k.value),p(k)?j():$("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:k.value,notes:"",images:[]})},A=k=>k.preview||(k.image_path?`/${k.image_path}`:k),j=()=>{w.value=a.modelValue,u.value=l.value,d.value=[...r.value],m.value=[...r.value],h.value=!0},z=()=>{u.value="",d.value=[],w.value="",h.value=!1},F=k=>{d.value=k,r.value=[...k],$("update:images",[...k]),$("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:l.value,images:[...k]})},R=k=>{},E=()=>{w.value!==a.modelValue&&$("update:modelValue",w.value),l.value=u.value,$("update:notes",u.value),r.value=[...d.value],$("update:images",[...d.value]),$("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:w.value,notes:u.value,images:d.value}),h.value=!1},L=k=>{$("hapus",k),h.value=!1};return(k,U)=>{var N,X,te,H;return n(),i("div",na,[e("div",ia,[(n(!0),i(oe,null,ne(t.options,(W,Y)=>(n(),i("label",{key:Y,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:W.value,checked:t.modelValue===W.value,onChange:le=>I(W),class:"hidden peer",required:t.required},null,40,la),e("div",{class:ie(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===W.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==W.value}])},q(W.label),3)]))),128))]),t.modelValue&&s.value&&p(s.value)?(n(),i("div",ra,[e("div",{class:"flex justify-between items-start"},[U[4]||(U[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:j,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((N=s.value.settings)!=null&&N.show_image_upload)?(n(),i("div",ua,[e("div",da,[(n(!0),i(oe,null,ne(t.images,(W,Y)=>(n(),i("div",{key:Y,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:A(W),class:"w-full h-full object-cover rounded"},null,8,ca),Y===3&&t.images.length>4?(n(),i("span",ma," +"+q(t.images.length-4),1)):y("",!0)]))),128))])])):y("",!0),t.notes&&((X=s.value.settings)!=null&&X.show_textarea)?(n(),i("div",ga,[e("p",va,q(t.notes),1)])):y("",!0)])):y("",!0),h.value?(n(),se(_e,{key:(te=t.selectedPoint)==null?void 0:te.id,show:h.value,title:t.pointName||"Detail",subtitle:(H=s.value)==null?void 0:H.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":w.value,"notes-value":u.value,"images-value":d.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":U[0]||(U[0]=W=>w.value=W),"onUpdate:notesValue":U[1]||(U[1]=W=>u.value=W),"onUpdate:imagesValue":U[2]||(U[2]=W=>F(W)),onClose:z,onSave:E,onSaveTextarea:k.handleTextareaSave,onSaveImage:R,onHapus:U[3]||(U[3]=W=>L(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):y("",!0),t.error?(n(),i("p",pa,q(t.error),1)):y("",!0)])}}},fa={class:"mt-2 space-y-4"},wa={key:0,class:"flex flex-wrap gap-3"},ya={key:1,class:"p-4 border rounded-lg bg-gray-50"},ba={key:0,class:"mt-3"},xa={class:"flex gap-2 overflow-x-auto scrollbar-hide"},ka=["src"],$a={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Ca={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full mt-4"},Ia=["name","value","checked"],Sa={key:1,class:"mt-2"},Va={class:"text-sm text-gray-600"},_a={key:3,class:"mt-2 text-sm text-red-600"},Ma={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:V}){const a=t,$=V,l=_(a.notes),r=_([...a.images]),h=_(!1),u=_(""),d=_([]),w=_(""),m=_([]),s=Q(()=>a.options.find(R=>R.value===a.modelValue)),p=R=>R.preview||(R.image_path?`/${R.image_path}`:R),I=()=>{w.value=a.modelValue||"",u.value=l.value,d.value=[...r.value],m.value=[...r.value],h.value=!0},A=()=>{u.value="",d.value=[],w.value="",h.value=!1},j=R=>{d.value=R,r.value=[...R],$("update:images",[...R]),$("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:l.value,images:[...R]})},z=()=>{w.value!==a.modelValue&&$("update:modelValue",w.value),l.value=u.value,$("update:notes",u.value),r.value=[...d.value],$("update:images",[...d.value]),$("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:w.value,notes:u.value,images:d.value}),h.value=!1},F=R=>{$("hapus",R),h.value=!1};return(R,E)=>{var L,k,U;return n(),i("div",fa,[!t.modelValue&&r.value.length===0&&!l.value?(n(),i("div",wa,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:I},E[4]||(E[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),i("div",ya,[e("div",{class:"flex justify-between items-start"},[E[5]||(E[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:I,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),r.value.length>0?(n(),i("div",ba,[e("div",xa,[(n(!0),i(oe,null,ne(r.value,(N,X)=>(n(),i("div",{key:X,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:p(N),class:"w-full h-full object-cover rounded"},null,8,ka),X===3&&r.value.length>4?(n(),i("span",$a," +"+q(r.value.length-4),1)):y("",!0)]))),128))])])):y("",!0),e("div",Ca,[(n(!0),i(oe,null,ne(t.options,(N,X)=>(n(),i("label",{key:X,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:N.value,checked:t.modelValue===N.value,disabled:!0,class:"hidden peer"},null,8,Ia),e("div",{class:ie(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===N.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==N.value}])},q(N.label),3)]))),128))]),l.value&&((L=s.value.settings)!=null&&L.show_textarea)?(n(),i("div",Sa,[e("p",Va,q(l.value),1)])):y("",!0)])),h.value?(n(),se(_e,{key:(k=t.selectedPoint)==null?void 0:k.id,show:h.value,title:t.pointName||"Detail",subtitle:(U=s.value)==null?void 0:U.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":w.value,"notes-value":u.value,"images-value":d.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":E[0]||(E[0]=N=>w.value=N),"onUpdate:notesValue":E[1]||(E[1]=N=>u.value=N),"onUpdate:imagesValue":E[2]||(E[2]=N=>j(N)),onClose:A,onSave:z,onHapus:E[3]||(E[3]=N=>F(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):y("",!0),t.error?(n(),i("p",_a,q(t.error),1)):y("",!0)])}}},Ua={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},ja={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},Na={class:"text-xl font-semibold text-indigo-700"},Ra={class:"p-4 space-y-4"},Ta={class:"flex items-start justify-between"},Pa={class:"block text-sm font-medium text-gray-700"},Da={key:0,class:"text-red-500"},qa={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Aa={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object},emits:["saveResult","updateResult","removeImage"],setup(t,{emit:V}){const a=t,$=V,l=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],r=w=>{var p,I,A,j,z;const m=a.form.results[w.id],s=a.form.images[w.id];if(!m)return!1;switch(w.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!m.note;case"select":case"radio":if(!m.status)return!1;const F=(p=w.settings.radios)==null?void 0:p.find(E=>E.value===m.status);return!(F!=null&&F.settings&&(F.settings.show_textarea&&!((I=m.note)!=null&&I.trim())||F.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!m.status)return!1;const R=(A=w.settings.radios)==null?void 0:A.find(E=>E.value===m.status);return!(R!=null&&R.settings&&R.settings.show_textarea&&!((j=m.note)!=null&&j.trim()));case"image":return s.length>0;default:return!!m.status||!!((z=m.note)!=null&&z.trim())}},h=(w,m)=>{$("updateResult",{pointId:w,value:m})},u=w=>{$("saveResult",w)},d=w=>{$("hapusPoint",w)};return(w,m)=>(n(),i("div",Ua,[e("div",ja,[e("h2",Na,q(t.category.name),1)]),e("div",Ra,[(n(!0),i(oe,null,ne(t.category.points,s=>{var p,I,A,j,z,F,R,E,L,k,U,N,X,te,H,W,Y,le,S,C,x,o,b,g,D,M;return n(),i("div",{key:s.id,class:"space-y-2 pb-4 border-b border-gray-100 last:border-0 last:pb-0"},[e("div",Ta,[e("label",Pa,[ue(q(s.name)+" ",1),(p=s.settings)!=null&&p.is_required?(n(),i("span",Da,"*")):y("",!0)]),r(s)?(n(),i("span",qa," ✓ ")):y("",!0)]),s.input_type==="text"?(n(),se(wt,{key:0,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[f=>t.form.results[s.id].note=f,f=>h(s.id,f)],required:(I=s.settings)==null?void 0:I.is_required,"min-length":(A=s.settings)==null?void 0:A.min_length,"max-length":(j=s.settings)==null?void 0:j.max_length,allowSpace:(z=s.settings)==null?void 0:z.allow_space,textTransform:(F=s.settings)==null?void 0:F.text_transform,placeholder:((R=s.settings)==null?void 0:R.placeholder)||"Masukan text",error:t.form.errors[`results.${s.id}.note`],onSave:f=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):y("",!0),s.input_type==="number"?(n(),se(Le,{key:1,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[f=>t.form.results[s.id].note=f,f=>h(s.id,f)],required:(E=s.settings)==null?void 0:E.is_required,min:(L=s.settings)==null?void 0:L.min,max:(k=s.settings)==null?void 0:k.max,step:((U=s.settings)==null?void 0:U.step)||1,placeholder:((N=s.settings)==null?void 0:N.placeholder)||"Masukan number",error:t.form.errors[`results.${s.id}.note`],onSave:f=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):y("",!0),s.input_type==="account"?(n(),se(St,{key:2,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[f=>t.form.results[s.id].note=f,f=>h(s.id,f)],required:(X=s.settings)==null?void 0:X.is_required,placeholder:((te=s.settings)==null?void 0:te.placeholder)||"Masukkan nilai",error:t.form.errors[`results.${s.id}.note`],"point-id":s.id,settings:s.settings,onSave:f=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):y("",!0),s.input_type==="date"?(n(),se(kt,{key:3,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[f=>t.form.results[s.id].note=f,f=>h(s.id,f)],required:(H=s.settings)==null?void 0:H.is_required,"min-date":(W=s.settings)==null?void 0:W.min_date,"max-date":(Y=s.settings)==null?void 0:Y.max_date,error:t.form.errors[`results.${s.id}.note`],onSave:f=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):y("",!0),s.input_type==="textarea"?(n(),se(Re,{key:4,modelValue:t.form.results[s.id].note,"onUpdate:modelValue":[f=>t.form.results[s.id].note=f,f=>h(s.id,f)],required:(le=s.settings)==null?void 0:le.is_required,"min-length":(S=s.settings)==null?void 0:S.min_length,"max-length":(C=s.settings)==null?void 0:C.max_length,placeholder:((x=s.settings)==null?void 0:x.placeholder)||"Masukkan teks di sini",settings:s.settings,error:t.form.errors[`results.${s.id}.note`],onSave:f=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):y("",!0),s.input_type==="radio"?(n(),se(ha,{key:5,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[f=>t.form.results[s.id].status=f,f=>h(s.id,f)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(o=s.settings)==null?void 0:o.is_required,"point-id":s.id,point:s,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((b=s.settings)==null?void 0:b.radios)||l,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":f=>t.form.results[s.id].note=f,"onUpdate:images":f=>t.form.images[s.id]=f,onSave:f=>u(s.id),onHapus:f=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="imageTOradio"?(n(),se(Ma,{key:6,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[f=>t.form.results[s.id].status=f,f=>h(s.id,f)],notes:t.form.results[s.id].note,images:t.form.images[s.id],required:(g=s.settings)==null?void 0:g.is_required,"point-id":s.id,"inspection-id":t.inspectionId,settings:s.settings,"point-name":s.name,point:s,"selected-point":s.app_menu.input_type==="damage"?s:null,options:((D=s.settings)==null?void 0:D.radios)||l,error:t.form.errors[`results.${s.id}.status`],"onUpdate:notes":f=>t.form.results[s.id].note=f,"onUpdate:images":f=>t.form.images[s.id]=f,onSave:f=>u(s.id),onHapus:f=>d(s.id)},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):y("",!0),s.input_type==="image"?(n(),se(Ve,{key:7,modelValue:t.form.images[s.id],"onUpdate:modelValue":f=>t.form.images[s.id]=f,error:t.form.errors[`images.${s.id}`],"inspection-id":t.inspectionId,"point-id":s.id,point:s,"point-name":s.name,settings:s.settings,"onUpdate:notes":f=>t.form.results[s.id].note=f,"onUpdate:status":f=>t.form.results[s.id].status=f},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):y("",!0),s.input_type==="select"?(n(),se(Lt,{key:8,modelValue:t.form.results[s.id].status,"onUpdate:modelValue":[f=>t.form.results[s.id].status=f,f=>h(s.id,f)],required:(M=s.settings)==null?void 0:M.is_required,error:t.form.errors[`results.${s.id}.status`],onSave:f=>u(s.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):y("",!0)])}),128))])]))}},La=ge(Aa,[["__scopeId","data-v-54d0f511"]]),Ba={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Fa={class:"p-4 space-y-4-6"},Ea={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},za=["value"],Ha={class:"p-4 space-y-4-6"},Oa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Wa=["value"],Ka={key:0,class:"p-4 space-y-4-6"},Xa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Ga=["value"],Ja={class:"p-4 space-y-4-6"},Za={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(t){const V=t,a=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(p){return console.error("Error parsing settings JSON:",p),{}}return typeof s=="object"&&s!==null?s:{}},$=Q(()=>a(V.inspection.settings).conclusion||{}),l=_({flooded:$.value.flooded||"",collision:$.value.collision||"",collision_severity:$.value.collision_severity||"",conclusion_note:V.inspection.notes||""}),r=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],h=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],u=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}],d=()=>{const s={flooded:l.value.flooded,collision:l.value.collision,collision_severity:l.value.collision==="yes"?l.value.collision_severity:null,conclusion_note:l.value.conclusion_note};Se.post(route("inspections.updateConclusion",V.inspectionId),s,{preserveScroll:!0,preserveState:!0,onError:p=>{console.error("Error saving conclusion:",p)}})},w=xe.debounce(d,500);ae([()=>l.value.flooded,()=>l.value.collision,()=>l.value.collision_severity],()=>{d()}),ke(()=>{m()}),ae(()=>V.inspection,()=>{m()},{deep:!0});const m=()=>{const p=a(V.inspection.settings).conclusion||{};l.value={flooded:p.flooded||"",collision:p.collision||"",collision_severity:p.collision_severity||"",conclusion_note:V.inspection.notes||""}};return(s,p)=>(n(),i("div",Ba,[p[9]||(p[9]=e("div",{class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},[e("h2",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi ")],-1)),e("div",Fa,[p[5]||(p[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah terkena banjir? ",-1)),e("div",Ea,[(n(),i(oe,null,ne(r,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":p[0]||(p[0]=A=>l.value.flooded=A),value:I.value,class:"hidden peer"},null,8,za),[[Ce,l.value.flooded]]),e("div",{class:ie(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.flooded===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.flooded!==I.value}])},q(I.label),3)])),64))])]),e("div",Ha,[p[7]||(p[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Apakah kendaraan pernah mengalami tabrakan? ",-1)),e("div",Oa,[(n(),i(oe,null,ne(h,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":p[1]||(p[1]=A=>l.value.collision=A),value:I.value,class:"hidden peer"},null,8,Wa),[[Ce,l.value.collision]]),e("div",{class:ie(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision!==I.value}])},q(I.label),3)])),64))]),l.value.collision==="yes"?(n(),i("div",Ka,[p[6]||(p[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tingkat kerusakan:",-1)),e("div",Xa,[(n(),i(oe,null,ne(u,I=>e("label",{key:I.value,class:"cursor-pointer"},[ce(e("input",{type:"radio","onUpdate:modelValue":p[2]||(p[2]=A=>l.value.collision_severity=A),value:I.value,class:"hidden peer"},null,8,Ga),[[Ce,l.value.collision_severity]]),e("div",{class:ie(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":l.value.collision_severity===I.value,"border-gray-300 text-gray-700 hover:bg-gray-50":l.value.collision_severity!==I.value}])},q(I.label),3)])),64))])])):y("",!0)]),e("div",Ja,[p[8]||(p[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),ce(e("textarea",{"onUpdate:modelValue":p[3]||(p[3]=I=>l.value.conclusion_note=I),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tambahkan catatan kesimpulan inspeksi di sini...",onInput:p[4]||(p[4]=(...I)=>Z(w)&&Z(w)(...I))},null,544),[[we,l.value.conclusion_note]])])]))}},Qa={class:"container mx-auto px-4 py-2"},Ya={class:"sticky top-0 z-10 bg-white shadow-sm mb-2"},eo={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},to=["onClick"],so={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ao={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},oo={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},no={class:"relative overflow-hidden"},io={key:0,class:"flex justify-end gap-4 mt-8 p-6 bg-white rounded-xl shadow-md"},lo=["disabled"],ro={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},uo={class:"space-y-4"},co={class:"relative"},mo={class:"max-h-64 overflow-y-auto"},go={key:0,class:"text-center py-4 text-gray-500"},vo=["onClick"],po={class:"font-medium text-gray-900"},ho={class:"text-sm text-gray-500"},fo={class:"text-xs text-gray-400 mt-1"},wo={key:0,class:"text-xs text-green-600 mt-1"},yo={__name:"InspectionForm",props:{inspection:Object,appMenu:Array,existingResults:Array,existingImages:Object,CarDetail:Array,components:Array,damagePoints:Array},setup(t){var K;const V=t,a=_(!1),$=_(!1),l=_(""),r=_(null),h=_(""),u=_(""),d=_([]),w=_(""),m=(v,c)=>v.filter(T=>c?I(T.id):!0),s=Q(()=>V.damagePoints||[]),p=Q(()=>{if(!l.value.trim())return s.value;const v=l.value.toLowerCase().trim();return s.value.filter(c=>{var T,B,G;return((T=c.name)==null?void 0:T.toLowerCase().includes(v))||((B=c.description)==null?void 0:B.toLowerCase().includes(v))||((G=A(c))==null?void 0:G.toLowerCase().includes(v))})}),I=v=>{var T;const c=H.results[v];return c&&(c.status||c.note||((T=c.images)==null?void 0:T.length)>0)},A=v=>{const c=V.components.find(T=>T.id===v.component_id);return c?c.name:"Komponen Tidak Diketahui"},j=v=>v&&Array.isArray(V.existingResults)?V.existingResults.find(c=>c.point_id===v):null,z=v=>{r.value=v;const c=H.results[v.id]||{};h.value=c.status||"",u.value=c.note||"",d.value=Array.isArray(c.images)?[...c.images]:[],a.value=!1,$.value=!0},F=()=>{r.value&&(H.results[r.value.id]={...H.results[r.value.id],status:h.value,note:u.value,images:Array.isArray(d.value)?[...d.value]:[]},b(r.value.id),w.value="Data berhasil disimpan!",setTimeout(()=>{w.value=""},1e3)),E()},R=()=>{a.value=!1,l.value=""},E=()=>{$.value=!1,r.value=null,h.value="",u.value="",d.value=[]},k=De().props.inspection,U=_(((K=V.appMenu[0])==null?void 0:K.id)||"conclusion"),N=_(0),X=Q(()=>U.value!=="conclusion"?V.appMenu.find(v=>v.id===U.value):null);function te(){const v={},c={};return V.appMenu.forEach(T=>{(T.points||[]).forEach(B=>{var ee;const G=Array.isArray(V.existingResults)?V.existingResults.find(re=>re.point_id===B.id):null;v[B.id]={status:(G==null?void 0:G.status)||"",note:(G==null?void 0:G.note)||""};const J=((ee=V.existingImages)==null?void 0:ee[B.id])||[];c[B.id]=J.map(re=>({id:re.id,image_path:re.image_path,preview:`/${re.image_path}`,rotation:re.rotation||0,isNew:!1}))})}),{inspection_id:V.inspection.id,results:v,images:c,overall_note:V.inspection.overall_note||""}}const H=je(te()),W=v=>v.input_type==="damage"?!0:v.id==="conclusion"?le():v.points.every(c=>{var J,ee,re,pe,he,fe;const T=H.results[c.id],B=H.images[c.id];if(!T)return!1;const G=Y(c.settings);switch(c.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((J=T.note)!=null&&J.trim());case"select":case"radio":if(!T.status)return!1;const O=(ee=G.radios)==null?void 0:ee.find($e=>$e.value===T.status);return!(O!=null&&O.settings&&(O.settings.show_textarea&&!((re=T.note)!=null&&re.trim())||O.settings.show_image_upload&&(B==null?void 0:B.length)===0));case"imageTOradio":if((B==null?void 0:B.length)===0||!T.status)return!1;const ve=(pe=G.radios)==null?void 0:pe.find($e=>$e.value===T.status);return!(ve!=null&&ve.settings&&ve.settings.show_textarea&&ve.settings.required&&!((he=T.note)!=null&&he.trim()));case"image":return(B==null?void 0:B.length)>0;default:return!!T.status||!!((fe=T.note)!=null&&fe.trim())}}),Y=v=>{if(!v)return{};if(typeof v=="string")try{return JSON.parse(v)||{}}catch(c){return console.error("Error parsing settings JSON:",c),{}}return typeof v=="object"&&v!==null?v:{}},le=()=>{var ee;const c=Y(V.inspection.settings).conclusion||{},T=!!c.flooded,B=!!c.collision,G=c.collision==="yes"?!!c.collision_severity:!0,J=!!((ee=V.inspection.notes)!=null&&ee.trim());return T&&B&&G&&J},S=Q(()=>{const c=Y(V.inspection.settings).conclusion||{};return{flooded:c.flooded||null,collision:c.collision||null,collision_severity:c.collision_severity||null,note:V.inspection.notes||null,isComplete:le()}}),C=v=>{U.value=v},x=v=>{var B;let c=N.value+v;const T=V.appMenu.length;c>=0&&c<=T&&(N.value=c,U.value=((B=V.appMenu[c])==null?void 0:B.id)||"conclusion")},o=()=>{let v=0,c=0;const T=ee=>{v=ee.changedTouches[0].screenX},B=ee=>{c=ee.changedTouches[0].screenX,G()},G=()=>{c<v-150?x(1):c>v+150&&x(-1)},J=document.querySelector(".relative.overflow-hidden");return J&&(J.addEventListener("touchstart",T,!1),J.addEventListener("touchend",B,!1)),()=>{J&&(J.removeEventListener("touchstart",T),J.removeEventListener("touchend",B))}},b=xe.debounce(async v=>{try{await Se.post(route("inspections.save-result"),{inspection_id:V.inspection.id,point_id:v,status:H.results[v].status,note:H.results[v].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"]})}catch(c){console.error("Error menyimpan hasil:",c)}},500),g=({pointId:v,type:c,value:T})=>{H.results[v].hasOwnProperty(c)&&(H.results[v][c]=T),b(v)},D=async v=>{if(v&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await Se.post(route("inspections.delete-result"),{inspection_id:V.inspection.id,point_id:v},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{H.results[v]&&delete H.results[v],w.value="Data berhasil dihapus!",setTimeout(()=>{w.value=""},2e3)}})}catch(c){console.error("Error menghapus hasil:",c)}E()}},M=v=>{Object.assign(H.conclusion,v),saveConclusion()},f=()=>{if(!P.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}H.post(route("inspections.final-submit",{id:V.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:v=>{console.error("Kesalahan pengiriman:",v)}})};ae(U,v=>{const c=document.querySelector(`.flex-shrink-0[data-category-id="${v}"]`);c&&c.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});const P=Q(()=>{const v=V.appMenu.every(T=>W(T)),c=le();return v&&c});return ae(l,xe.debounce(()=>{},300)),ke(()=>{o()}),(v,c)=>{var T,B,G,J,ee,re,pe,he,fe;return n(),i("div",Qa,[e("div",Ya,[e("div",eo,[e("button",{onClick:c[0]||(c[0]=O=>C("vehicle")),class:ie(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":U.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":U.value!=="vehicle"}])}," Detail Kendaraan ",2),(n(!0),i(oe,null,ne(t.appMenu,O=>(n(),i("button",{key:O.id,onClick:ve=>C(O.id),class:ie(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":U.value===O.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":U.value!==O.id}])},[ue(q(O.name)+" ",1),W(O)?(n(),i("span",so," ✓ ")):y("",!0)],10,to))),128)),e("button",{onClick:c[1]||(c[1]=O=>C("conclusion")),class:ie(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":U.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":U.value!=="conclusion"}])},[c[7]||(c[7]=ue(" Kesimpulan ")),S.value.isComplete?(n(),i("span",ao," ✓ ")):y("",!0)],2)])]),de(Ie,{name:"fade"},{default:me(()=>[w.value?(n(),i("div",oo,q(w.value),1)):y("",!0)]),_:1}),e("div",no,[de(Ie,{name:"category-slide",mode:"out-in"},{default:me(()=>[U.value==="vehicle"?(n(),se(vt,{key:0,inspection:Z(k),CarDetail:t.CarDetail,onUpdateVehicle:v.updateVehicleDetails,onSaveCarDetails:v.saveNewCarDetails},null,8,["inspection","CarDetail","onUpdateVehicle","onSaveCarDetails"])):X.value&&U.value!=="conclusion"?(n(),se(La,{key:X.value.id,category:{...X.value,points:m(X.value.points||[],X.value.input_type==="damage")},"inspection-id":Z(k).id,form:Z(H),onSaveResult:Z(b),onUpdateResult:g,onHapusPoint:D,onRemoveImage:v.removeImage},null,8,["category","inspection-id","form","onSaveResult","onRemoveImage"])):U.value==="conclusion"?(n(),se(Za,{key:2,form:Z(H),"inspection-id":Z(k).id,inspection:Z(k),settings:Z(k).settings||{},onUpdateConclusion:M},null,8,["form","inspection-id","inspection","settings"])):y("",!0)]),_:1})]),U.value==="conclusion"?(n(),i("div",io,[e("button",{type:"button",onClick:f,disabled:!P.value||Z(H).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[Z(H).processing?(n(),i("svg",ro,c[8]||(c[8]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),e("span",null,q(Z(H).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,lo)])):y("",!0),!a.value&&!$.value?(n(),i("button",{key:1,onClick:c[2]||(c[2]=O=>a.value=!0),class:"fixed bottom-4 right-4 z-20 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors"},c[9]||(c[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]))):y("",!0),de(Te,{show:a.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:R},{default:me(()=>[e("div",uo,[e("div",co,[ce(e("input",{"onUpdate:modelValue":c[3]||(c[3]=O=>l.value=O),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[we,l.value]]),c[10]||(c[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",mo,[p.value.length===0?(n(),i("div",go," Tidak ada point yang ditemukan ")):y("",!0),(n(!0),i(oe,null,ne(p.value,O=>(n(),i("button",{key:O.id,onClick:ve=>z(O),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",po,q(O.name),1),e("div",ho,q(O.description),1),e("div",fo,q(A(O)),1),I(O.id)?(n(),i("div",wo," ✓ Sudah ada data ")):y("",!0)],8,vo))),128))])])]),_:1},8,["show"]),$.value?(n(),se(_e,{key:(T=r.value)==null?void 0:T.id,show:$.value,title:((B=r.value)==null?void 0:B.name)||"Detail Point",subtitle:(G=r.value)==null?void 0:G.description,name:`point-${(J=r.value)==null?void 0:J.id}`,"inspection-id":Z(k).id,"point-id":(ee=r.value)==null?void 0:ee.id,settings:((re=r.value)==null?void 0:re.settings)||{},options:((he=(pe=r.value)==null?void 0:pe.settings)==null?void 0:he.radios)||[],"selected-Point":r.value,"selected-value":h.value,"images-value":Z(H).images[r.value.id],"notes-value":u.value,point:r.value,"existing-data":j((fe=r.value)==null?void 0:fe.id),"onUpdate:selectedValue":c[4]||(c[4]=O=>h.value=O),"onUpdate:notesValue":c[5]||(c[5]=O=>u.value=O),"onUpdate:imagesValue":c[6]||(c[6]=O=>Z(H).images[r.value.id]=O),onSave:F,onClose:E,onHapus:D},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):y("",!0)])}}},So=ge(yo,[["__scopeId","data-v-f5189791"]]);export{So as default};
