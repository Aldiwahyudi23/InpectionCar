import{e as i,o as l,a as t,f as p,t as $,F as U,h as A,d as _,k as P,j as F,n as N,C as W,g as z,c as R,x as J,W as D,q as Q,D as Y,b as Z,w as ee,u as I,l as te,s as ae,T as se,B as G}from"./app-DmKXgDnP.js";import{l as H}from"./lodash-CJblAGAt.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"mt-1"},oe=["value","required","minlength","maxlength","pattern","placeholder"],ne={key:0,class:"mt-2 text-sm text-red-600"},le={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:g}){const d=e,f=g,x=b=>{f("update:modelValue",b.target.value),f("save",d.pointId)};return(b,s)=>(l(),i("div",re,[t("input",{value:e.modelValue,onInput:x,type:"text",required:e.required,minlength:e.minLength,maxlength:e.maxLength,pattern:e.pattern,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,oe),e.error?(l(),i("p",ne,$(e.error),1)):p("",!0)]))}},ie={class:"mt-1"},ue=["value","required","min","max","step","placeholder"],de={key:0,class:"mt-2 text-sm text-red-600"},ce={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:g}){const d=e,f=g,x=b=>{const s=b.target.value;f("update:modelValue",s),f("save",d.pointId)};return(b,s)=>(l(),i("div",ie,[t("input",{value:e.modelValue,onInput:x,type:"number",required:e.required,min:e.min,max:e.max,step:e.step,placeholder:e.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ue),e.error?(l(),i("p",de,$(e.error),1)):p("",!0)]))}},me={class:"mt-1"},ge=["value","required","min","max"],ve={key:0,class:"mt-2 text-sm text-red-600"},he={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:g}){const d=e,f=g,x=b=>{f("update:modelValue",b.target.value),f("save",d.pointId)};return(b,s)=>(l(),i("div",me,[t("input",{value:e.modelValue,onChange:x,type:"date",required:e.required,min:e.minDate,max:e.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ge),e.error?(l(),i("p",ve,$(e.error),1)):p("",!0)]))}},fe={class:"mt-1"},pe=["value","required"],xe={key:0,class:"mt-2 text-sm text-red-600"},be={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(e,{emit:g}){const d=e,f=g,x=b=>{f("update:modelValue",b.target.value),f("save",d.pointId)};return(b,s)=>(l(),i("div",fe,[t("select",{value:e.modelValue,onChange:x,required:e.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},s[0]||(s[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,pe),e.error?(l(),i("p",xe,$(e.error),1)):p("",!0)]))}},ye=K(be,[["__scopeId","data-v-c34a74db"]]),we={class:"mt-2"},ke={class:"flex flex-col gap-2 sm:flex-row sm:items-center"},$e=["name","value","checked","onChange","required"],Se={class:"text-sm text-gray-700"},Ve={key:0,class:"mt-2 text-sm text-red-600"},Ie={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number],options:{type:Array,default:()=>[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}]}},emits:["update:modelValue","save"],setup(e,{emit:g}){const d=e,f=g,x=b=>{f("update:modelValue",b),f("save",d.pointId)};return(b,s)=>(l(),i("div",we,[t("div",ke,[(l(!0),i(U,null,A(e.options,m=>(l(),i("label",{key:m.value,class:"inline-flex items-center space-x-2"},[t("input",{type:"radio",name:"radio-"+e.pointId,value:m.value,checked:e.modelValue===m.value,onChange:S=>x(m.value),required:e.required,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,$e),t("span",Se,$(m.label),1)]))),128))]),e.error?(l(),i("p",Ve,$(e.error),1)):p("",!0)]))}},_e={key:0,class:"text-center"},Ce={key:1,class:"space-y-3"},je={class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3"},qe=["src"],Re=["onClick"],Ue={key:0,class:"text-center pt-2"},Be={key:0,class:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4"},Ee={class:"bg-white rounded-xl p-6 shadow-2xl w-full max-w-sm text-center transform transition-all scale-95 opacity-0 animate-scale-in"},Le={key:1,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4"},Te={class:"relative w-full max-w-2xl mx-auto bg-gray-900 rounded-lg shadow-2xl overflow-hidden animate-fade-in-up"},ze={class:"relative h-96 sm:h-[450px] flex items-center justify-center p-4"},Ae=["src"],Me={key:1,class:"text-white text-lg font-semibold"},Ne={key:4,class:"absolute bottom-4 left-0 right-0 flex justify-center space-x-2"},Oe={class:"bg-gray-800 p-4 flex justify-around items-center border-t border-gray-700"},De=["accept","capture"],Ke={__name:"InputImage",props:{modelValue:Array,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({max_files:1,max_size:2048,allowed_types:["jpg","jpeg","png"]})}},emits:["update:modelValue","handleImageUpload","removeImage"],setup(e,{emit:g}){const d=e,f=g,x=_(!1),b=_(!1),s=_([]),m=_(0),S=_(null),y=_(""),k=P(()=>d.settings.allowed_types.map(o=>`image/${o}`).join(",")),r=()=>{x.value=!1,y.value="environment",S.value.click()},C=()=>{x.value=!1,y.value="",S.value.click()},B=o=>{const a=Array.from(o.target.files);if(a.length===0)return;const v=a.filter(V=>{const O=V.type.split("/").pop().toLowerCase(),c=d.settings.allowed_types.includes(O),X=V.size/1024<=d.settings.max_size;return c?X?!0:(alert(`Ukuran file terlalu besar: ${V.name}. Maksimal ${d.settings.max_size}KB.`),!1):(alert(`Tipe file tidak diizinkan: ${V.name}. Hanya ${d.settings.allowed_types.join(", ")} yang diizinkan.`),!1)});if(v.length===0){o.target.value="";return}const h=d.modelValue.length,w=s.value.length,q=h+w,M=v.slice(0,d.settings.max_files-q);M.length===0&&v.length>0&&alert(`Anda telah mencapai batas maksimum ${d.settings.max_files} gambar.`),s.value=[...s.value,...M.map(V=>({file:V,preview:URL.createObjectURL(V),rotation:0}))],s.value.length>0&&(m.value=s.value.length-1,b.value=!0),o.target.value=""},E=()=>{s.value.length!==0&&(m.value=(m.value-1+s.value.length)%s.value.length)},L=()=>{s.value.length!==0&&(m.value=(m.value+1)%s.value.length)},T=()=>{if(s.value.length===0)return;const o=s.value[m.value];o.rotation=(o.rotation+90)%360},j=()=>{if(s.value.length===0)return;const o=s.value.splice(m.value,1)[0];URL.revokeObjectURL(o.preview),s.value.length===0?(b.value=!1,m.value=0):m.value>=s.value.length&&(m.value=s.value.length-1)},u=()=>{s.value.forEach(o=>URL.revokeObjectURL(o.preview)),s.value=[],m.value=0,b.value=!1},n=()=>{s.value.forEach(o=>{f("handleImageUpload",{file:o.file,pointId:d.pointId,rotation:o.rotation})}),s.value.forEach(o=>URL.revokeObjectURL(o.preview)),s.value=[],m.value=0,b.value=!1};return(o,a)=>(l(),i(U,null,[t("label",{onClick:a[1]||(a[1]=v=>x.value=!0),class:N(["block w-full border-2 border-dashed rounded-xl cursor-pointer transition-all duration-200 p-4",{"border-gray-300 hover:border-indigo-400 bg-gray-50 text-gray-700":e.modelValue.length===0,"border-indigo-400 bg-indigo-50 text-indigo-800":e.modelValue.length>0,"min-h-32 flex flex-col items-center justify-center":e.modelValue.length===0}])},[e.modelValue.length===0?(l(),i("div",_e,a[4]||(a[4]=[t("svg",{class:"w-10 h-10 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("p",{class:"text-sm font-medium"},"Upload Gambar",-1),t("p",{class:"text-xs text-gray-500 mt-1"},"Klik untuk pilih Kamera atau Galeri",-1)]))):(l(),i("div",Ce,[t("div",je,[(l(!0),i(U,null,A(e.modelValue,(v,h)=>(l(),i("div",{key:v.image_path||h,class:"relative aspect-square rounded-lg overflow-hidden shadow-sm"},[t("img",{src:v.preview||"/storage/"+v.image_path,class:"w-full h-full object-cover"},null,8,qe),t("button",{onClick:F(w=>o.$emit("removeImage",h),["stop"]),type:"button",class:"absolute -top-1 -right-1 bg-red-600 text-white rounded-full h-6 w-6 flex items-center justify-center text-sm font-bold z-10 opacity-90 hover:opacity-100 transition-opacity duration-200"}," × ",8,Re)]))),128))]),e.modelValue.length<e.settings.max_files?(l(),i("div",Ue,[t("span",{onClick:a[0]||(a[0]=F(v=>x.value=!0,["stop"])),class:"inline-block px-4 py-2 rounded-full text-sm font-medium bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition-colors duration-200 cursor-pointer shadow-sm"}," + Tambah Gambar ")])):p("",!0)]))],2),x.value?(l(),i("div",Be,[t("div",Ee,[a[7]||(a[7]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Pilih Sumber Gambar",-1)),t("div",{class:"flex justify-around gap-6"},[t("button",{onClick:r,class:"flex flex-col items-center p-3 text-indigo-600 hover:text-indigo-800 transition-colors duration-200"},a[5]||(a[5]=[t("svg",{class:"w-8 h-8 mb-2",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:C,class:"flex flex-col items-center p-3 text-green-600 hover:text-green-800 transition-colors duration-200"},a[6]||(a[6]=[t("svg",{class:"w-8 h-8 mb-2",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v16h16V4H4zm4 4h8v8H8V8z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("button",{onClick:a[2]||(a[2]=v=>x.value=!1),class:"mt-6 text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors duration-200"},"Batal")])])):p("",!0),b.value?(l(),i("div",Le,[t("div",Te,[t("div",ze,[s.value.length>0?(l(),i("img",{key:0,src:s.value[m.value].preview,style:W({transform:`rotate(${s.value[m.value].rotation}deg)`}),class:"max-h-full max-w-full object-contain transition-transform duration-300 ease-in-out"},null,12,Ae)):(l(),i("p",Me,"Tidak ada gambar untuk direview.")),s.value.length>1?(l(),i("button",{key:2,onClick:E,class:"absolute left-4 top-1/2 -translate-y-1/2 bg-gray-800 bg-opacity-60 text-white p-3 rounded-full hover:bg-opacity-80 focus:outline-none transition-colors duration-200"},a[8]||(a[8]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):p("",!0),s.value.length>1?(l(),i("button",{key:3,onClick:L,class:"absolute right-4 top-1/2 -translate-y-1/2 bg-gray-800 bg-opacity-60 text-white p-3 rounded-full hover:bg-opacity-80 focus:outline-none transition-colors duration-200"},a[9]||(a[9]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):p("",!0),s.value.length>1?(l(),i("div",Ne,[(l(!0),i(U,null,A(s.value,(v,h)=>(l(),i("span",{key:"indicator-"+h,class:N(["block w-2.5 h-2.5 rounded-full transition-colors duration-300",{"bg-white shadow":h===m.value,"bg-gray-500":h!==m.value}])},null,2))),128))])):p("",!0)]),t("div",Oe,[s.value.length>0?(l(),i("button",{key:0,onClick:j,class:"flex flex-col items-center text-red-400 hover:text-red-300 transition-colors duration-200 text-sm font-medium py-2 px-3 rounded-md hover:bg-gray-700"},a[10]||(a[10]=[t("svg",{class:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),z(" Hapus ")]))):p("",!0),e.modelValue.length+s.value.length<e.settings.max_files?(l(),i("button",{key:1,onClick:a[3]||(a[3]=v=>x.value=!0),class:"flex flex-col items-center text-blue-400 hover:text-blue-300 transition-colors duration-200 text-sm font-medium py-2 px-3 rounded-md hover:bg-gray-700"},a[11]||(a[11]=[t("svg",{class:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),z(" Tambah ")]))):p("",!0),s.value.length>0?(l(),i("button",{key:2,onClick:T,class:"flex flex-col items-center text-gray-300 hover:text-white transition-colors duration-200 text-sm font-medium py-2 px-3 rounded-md hover:bg-gray-700"},a[12]||(a[12]=[t("svg",{class:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004 12c0 2.21.896 4.202 2.396 5.604M18 20v-5h-.582m-15.356-2A8.001 8.001 0 0020 12c0-2.21-.896-4.202-2.396-5.604"})],-1),z(" Rotasi ")]))):p("",!0)]),t("div",{class:"bg-gray-900 p-4 flex justify-end gap-3 border-t border-gray-700"},[t("button",{onClick:u,class:"bg-gray-700 text-gray-300 px-5 py-2 rounded-md text-sm font-medium hover:bg-gray-600 transition-colors duration-200 shadow-md"},"Batal"),t("button",{onClick:n,class:"bg-indigo-600 text-white px-5 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 transition-colors duration-200 shadow-md"},"Simpan")])])])):p("",!0),t("input",{ref_key:"fileInput",ref:S,type:"file",accept:k.value,capture:y.value,onChange:B,hidden:""},null,40,De)],64))}},Fe=K(Ke,[["__scopeId","data-v-8d535be3"]]),Ge={class:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100"},He={class:"bg-indigo-50 px-6 py-2 border-b border-indigo-100"},Pe={class:"text-xl font-semibold text-indigo-700"},Xe={class:"p-6 space-y-8"},We={class:"flex items-start justify-between"},Je={class:"block text-sm font-medium text-gray-700"},Qe={key:0,class:"text-red-500"},Ye={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Ze={__name:"CategorySection",props:{category:Object,form:Object},emits:["saveResult","updateResult","removeImage"],setup(e,{emit:g}){const d=e,f=g,x=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],b=y=>{var r;const k=d.form.results[y.id];if(!k)return!1;switch(y.input_type){case"text":case"number":case"date":return!!k.note;case"select":case"radio":return!!k.status;case"image":return((r=k.images)==null?void 0:r.length)>0;default:return!1}},s=(y,k)=>{f("updateResult",{pointId:y,value:k})},m=y=>{f("saveResult",y)},S=(y,k)=>{f("removeImage",{pointId:y,imageIndex:k})};return(y,k)=>(l(),i("div",Ge,[t("div",He,[t("h2",Pe,$(e.category.name),1)]),t("div",Xe,[(l(!0),i(U,null,A(e.category.points,r=>{var C,B,E,L,T,j,u,n,o,a,v,h,w,q,M,V,O;return l(),i("div",{key:r.id,class:"space-y-4 pb-6 border-b border-gray-100 last:border-0 last:pb-0"},[t("div",We,[t("label",Je,[z($(r.name)+" ",1),(C=r.settings)!=null&&C.is_required?(l(),i("span",Qe,"*")):p("",!0)]),b(r)?(l(),i("span",Ye," ✓ ")):p("",!0)]),r.input_type==="text"?(l(),R(le,{key:0,modelValue:e.form.results[r.id].note,"onUpdate:modelValue":[c=>e.form.results[r.id].note=c,c=>s(r.id,c)],required:(B=r.settings)==null?void 0:B.is_required,"min-length":(E=r.settings)==null?void 0:E.min_length,"max-length":(L=r.settings)==null?void 0:L.max_length,pattern:(T=r.settings)==null?void 0:T.pattern,placeholder:((j=r.settings)==null?void 0:j.placeholder)||"Enter text",error:e.form.errors[`results.${r.id}.note`],onSave:c=>m(r.id)},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","pattern","placeholder","error","onSave"])):p("",!0),r.input_type==="number"?(l(),R(ce,{key:1,modelValue:e.form.results[r.id].note,"onUpdate:modelValue":[c=>e.form.results[r.id].note=c,c=>s(r.id,c)],required:(u=r.settings)==null?void 0:u.is_required,min:(n=r.settings)==null?void 0:n.min,max:(o=r.settings)==null?void 0:o.max,step:((a=r.settings)==null?void 0:a.step)||1,placeholder:((v=r.settings)==null?void 0:v.placeholder)||"Enter number",error:e.form.errors[`results.${r.id}.note`],onSave:c=>m(r.id)},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):p("",!0),r.input_type==="date"?(l(),R(he,{key:2,modelValue:e.form.results[r.id].note,"onUpdate:modelValue":[c=>e.form.results[r.id].note=c,c=>s(r.id,c)],required:(h=r.settings)==null?void 0:h.is_required,"min-date":(w=r.settings)==null?void 0:w.min_date,"max-date":(q=r.settings)==null?void 0:q.max_date,error:e.form.errors[`results.${r.id}.note`],onSave:c=>m(r.id)},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):p("",!0),r.input_type==="select"?(l(),R(ye,{key:3,modelValue:e.form.results[r.id].status,"onUpdate:modelValue":[c=>e.form.results[r.id].status=c,c=>s(r.id,c)],required:(M=r.settings)==null?void 0:M.is_required,error:e.form.errors[`results.${r.id}.status`],onSave:c=>m(r.id)},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):p("",!0),r.input_type==="radio"?(l(),R(Ie,{key:4,modelValue:e.form.results[r.id].status,"onUpdate:modelValue":[c=>e.form.results[r.id].status=c,c=>s(r.id,c)],required:(V=r.settings)==null?void 0:V.is_required,options:((O=r.settings)==null?void 0:O.radios)||x,error:e.form.errors[`results.${r.id}.status`],onSave:c=>m(r.id)},null,8,["modelValue","onUpdate:modelValue","required","options","error","onSave"])):p("",!0),r.input_type==="image"?(l(),R(Fe,{key:5,modelValue:e.form.results[r.id].images,"onUpdate:modelValue":[c=>e.form.results[r.id].images=c,c=>s(r.id,c)],error:e.form.errors[`results.${r.id}.images`],onSave:c=>m(r.id),onRemoveImage:c=>S(r.id,c)},null,8,["modelValue","onUpdate:modelValue","error","onSave","onRemoveImage"])):p("",!0)])}),128))])]))}},et=K(Ze,[["__scopeId","data-v-0537cb06"]]),tt={class:"container mx-auto px-4 py-8"},at={class:"bg-white rounded-xl shadow-md overflow-hidden p-6 mb-8"},st={class:"text-xl font-semibold text-indigo-600"},rt={class:"sticky top-0 z-10 bg-white shadow-sm mb-6"},ot={class:"flex overflow-x-auto scrollbar-hide py-3 px-4 space-x-2"},nt=["onClick","data-category-id"],lt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},it={class:"relative overflow-hidden"},ut={key:"summary-section",class:"bg-white rounded-xl shadow-md p-6"},dt={class:"mb-4"},ct={class:"mt-6"},mt={class:"list-disc pl-5"},gt={key:0},vt={key:1},ht={class:"flex justify-end gap-4 mt-8"},ft=["disabled"],pt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},xt={__name:"InspectionForm",props:{inspection:Object,categories:Array,existingResults:Array,existingImages:Object},setup(e){var j;const g=e,d=_(((j=g.categories[0])==null?void 0:j.id)||"summary"),f=_(0);_(null);const x=P(()=>d.value!=="summary"?g.categories.find(u=>u.id===d.value):null),s=J((()=>{const u={};return g.categories.forEach(n=>{(n.points||[]).forEach(o=>{var v,h;const a=Array.isArray(g.existingResults)?g.existingResults.find(w=>w.point_id===o.id):null;u[o.id]={status:(a==null?void 0:a.status)||"",note:(a==null?void 0:a.note)||"",images:((h=(v=g.existingImages)==null?void 0:v[o.id])==null?void 0:h.map(w=>({image_path:w.image_path,preview:null})))||[]}})}),{inspection_id:g.inspection.id,results:u,overall_note:g.inspection.overall_note||""}})()),m=H.debounce(()=>{D.post(route("inspections.save-overall-note"),{inspection_id:g.inspection.id,overall_note:s.overall_note},{preserveScroll:!0,preserveState:!0,only:["inspection"],onSuccess:()=>{},onError:u=>{console.error("Error menyimpan catatan keseluruhan:",u)}})},800),S=u=>u.points.every(n=>{var a;const o=s.results[n.id];if(!o)return!1;switch(n.input_type){case"text":case"number":case"date":return!!o.note;case"select":case"radio":return!!o.status;case"image":return((a=o.images)==null?void 0:a.length)>0;default:return!!o.status||!!o.note}}),y=u=>{if(u==="summary")f.value=g.categories.length;else{const n=g.categories.findIndex(o=>o.id===u);n>=0&&(f.value=n)}d.value=u},k=u=>{let n=f.value+u;const o=g.categories.length;n>=0&&n<=o&&(f.value=n,n===o?d.value="summary":d.value=g.categories[n].id)},r=()=>{let u=0,n=0;const o=w=>{u=w.changedTouches[0].screenX},a=w=>{n=w.changedTouches[0].screenX,v()},v=()=>{n<u-50?k(1):n>u+50&&k(-1)},h=document.querySelector(".relative.overflow-hidden");return h&&(h.addEventListener("touchstart",o,!1),h.addEventListener("touchend",a,!1)),()=>{h&&(h.removeEventListener("touchstart",o),h.removeEventListener("touchend",a))}},C=H.debounce(async u=>{try{await D.post(route("inspections.save-result"),{inspection_id:g.inspection.id,point_id:u,status:s.results[u].status,note:s.results[u].note},{preserveScroll:!0,preserveState:!0,only:["existingResults"],onSuccess:()=>{}})}catch(n){console.error("Error menyimpan hasil:",n)}},500),B=({pointId:u,type:n,value:o})=>{s.results[u].hasOwnProperty(n)&&(s.results[u][n]=o),C(u)},E=async(u,n)=>{const o=u.target.files[0];if(!o)return;const a=URL.createObjectURL(o);try{const v=new FormData;v.append("inspection_id",g.inspection.id),v.append("point_id",n),v.append("image",o),await D.post(route("inspections.upload-image"),v,{preserveScroll:!0,onSuccess:h=>{var q;const w=((q=h.props.flash)==null?void 0:q.imagePath)||h.props.imagePath;w?s.results[n].images.push({image_path:w,preview:a}):console.error("Path gambar tidak dikembalikan dari unggahan, tidak dapat memperbarui UI.")},onError:h=>{console.error("Error mengunggah gambar:",h),alert("Gagal mengunggah gambar. Silakan coba lagi.")}})}catch(v){console.error("Error mengunggah gambar:",v),alert("Terjadi kesalahan tak terduga saat mengunggah gambar.")}finally{u.target.value=""}},L=async(u,n)=>{const o=s.results[u].images[n];if(o)try{await D.delete(route("inspections.delete-image"),{data:{image_path:o.image_path,point_id:u,inspection_id:g.inspection.id},preserveScroll:!0,onSuccess:()=>{s.results[u].images.splice(n,1),o.preview&&URL.revokeObjectURL(o.preview)},onError:a=>{console.error("Error menghapus gambar:",a),alert("Gagal menghapus gambar. Silakan coba lagi.")}})}catch(a){console.error("Error menghapus gambar:",a),alert("Terjadi kesalahan tak terduga saat menghapus gambar.")}},T=()=>{s.post(route("inspections.final-submit"),{preserveScroll:!0,onSuccess:()=>{G().props.flash.success="Inspeksi berhasil dikirim!"},onError:u=>{console.error("Kesalahan pengiriman:",u),G().props.flash.error="Ada kesalahan dalam pengiriman Anda. Harap periksa semua bidang."}})};return Q(()=>{r()}),Y(d,u=>{const n=document.querySelector(`.flex-shrink-0[data-category-id="${u}"]`);n&&n.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}),(u,n)=>{var o;return l(),i("div",tt,[t("div",at,[n[3]||(n[3]=t("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Pemeriksaan Kendaraan",-1)),t("h2",st,$(((o=e.inspection.car)==null?void 0:o.brand_id)||"Kendaraan Tidak Dikenal"),1)]),t("div",rt,[t("div",ot,[(l(!0),i(U,null,A(e.categories,a=>(l(),i("button",{key:a.id,onClick:v=>y(a.id),class:N(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":d.value===a.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":d.value!==a.id}]),"data-category-id":a.id},[z($(a.name)+" ",1),S(a)?(l(),i("span",lt," ✓ ")):p("",!0)],10,nt))),128)),t("button",{onClick:n[0]||(n[0]=a=>y("summary")),class:N(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-indigo-600 text-white":d.value==="summary","bg-gray-100 text-gray-700 hover:bg-gray-200":d.value!=="summary"}]),"data-category-id":"summary"}," Kesimpulan ",2)])]),t("div",it,[Z(se,{name:"category-slide",mode:"out-in"},{default:ee(()=>[x.value&&d.value!=="summary"?(l(),R(et,{key:x.value.id,category:x.value,form:I(s),onSaveResult:I(C),onUpdateResult:B,onRemoveImage:L,onHandleImageUpload:E},null,8,["category","form","onSaveResult"])):d.value==="summary"?(l(),i("div",ut,[n[7]||(n[7]=t("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Kesimpulan Inspeksi",-1)),t("div",dt,[n[4]||(n[4]=t("label",{for:"overall_note",class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan Keseluruhan Inspeksi:",-1)),te(t("textarea",{id:"overall_note","onUpdate:modelValue":n[1]||(n[1]=a=>I(s).overall_note=a),onInput:n[2]||(n[2]=(...a)=>I(m)&&I(m)(...a)),rows:"5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Tambahkan catatan penting atau ringkasan inspeksi di sini..."},null,544),[[ae,I(s).overall_note]])]),t("div",ct,[n[5]||(n[5]=t("h4",{class:"text-lg font-semibold text-gray-700 mb-3"},"Status Kategori:",-1)),t("ul",mt,[(l(!0),i(U,null,A(e.categories,a=>(l(),i("li",{key:a.id,class:N({"text-green-600":S(a),"text-red-600":!S(a)})},[z($(a.name)+" ",1),S(a)?(l(),i("span",gt,"(Selesai ✓)")):(l(),i("span",vt,"(Belum Selesai ✗)"))],2))),128))])]),t("div",ht,[t("button",{type:"button",onClick:T,disabled:I(s).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[I(s).processing?(l(),i("svg",pt,n[6]||(n[6]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):p("",!0),t("span",null,$(I(s).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,ft)])])):p("",!0)]),_:1})])])}}},kt=K(xt,[["__scopeId","data-v-533185cd"]]);export{kt as default};
